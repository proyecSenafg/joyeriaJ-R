(window.webpackJsonptheoWebApp=window.webpackJsonptheoWebApp||[]).push([[3],{"+nk0":function(e,t,o){var n,r=t,i=o("oAGj"),a=o("gXiO");r.ControllerEvent=(n=function(e){this.type=e,a.CoreObject.call(this)},i.defineClass({name:"ControllerEvent",ctor:n,superName:"CoreObject"}),n)},"01gE":function(e,t,o){var n,r=t,i=o("oAGj"),a=o("Nk+Q"),l=o("CMNw"),s=o("UUXZ"),u=o("PSFa"),c=o("JzRL"),h=o("elwG"),d=o("qUXk"),g=o("u+mS"),p=o("eLsM"),f=o("hsXA"),m=o("G9CY"),y=o("JU+l"),v=o("9X7Y"),S=o("aKgf");r.GroupSelectionDesignController=(n=function(e,t){d.DesignController.call(this),this.handles=new f.StandardHandlesHandler(e,t,this),this.drag=new g.MultiObjectDragHandler(e,t,this),this.click=new h.StandardClickHandler(e),this.resize=new y.MultiObjectResizeHandler(e,t,e.selection.asFormaArray(),this),this.actions=new l.StandardActionHandler(e),this.rotate=new v.StandardRotateHandler(e,t,this),this.attributes=new u.StandardAttributesHandler(e),this.featureSets=new p.StandardFeatureSetHandler(e),this.actionFeedback=new a.StandardActionFeedbackHandler(t),this.annotations=new s.StandardAnnotationsHandler(t),this.view=new S.StandardViewHandler(e,t),this.move=new m.StandardMoveHandler(e,t,this),this.activePage=new c.StandardActivePageHandler(e,t)},i.defineClass({name:"GroupSelectionDesignController",ctor:n,superName:"DesignController"}),n)},"06HC":function(e,t,o){var n,r=t,i=o("oAGj"),a=o("ascj"),l=o("JgVS"),s=o("cEEQ"),u=o("c+uM"),c=o("tGKA");r.ShadowDecorationStrategy=(n=function(){l.BaseDecorationStrategy.call(this)},i.defineClass({name:"ShadowDecorationStrategy",ctor:n,superName:"BaseDecorationStrategy",statics:{_implements:function(e){return"LockupDecorationStrategy"==e}},props:{rotatePoint:function(e,t,o){var n=o*Math.PI/180;return{x:Math.cos(n)*(e.x-t.x)-Math.sin(n)*(e.y-t.y)+t.x,y:Math.sin(n)*(e.x-t.x)+Math.cos(n)*(e.y-t.y)+t.y}},supportsConfiguration:function(e){return!1},decorate:function(e,t){for(var o=[],n=t.avgTextPointSize,r=e.style.shadowAngle,h=n/16*e.style.shadowOffset+.02*n,d=this.rotatePoint({x:0,y:-h},{x:0,y:0},r),g=i.iter(i.range(0,t.items.length,!1));!g.done;g.next()){var p=g.value,f=t.items[p];if(f.type==s.LockupItemType.Text){var m,y,v=e.style.textLook;if(null!=(m=f.characterStyle)&&(y=e.style.characterStyles[m])&&(v=y.textLook==u.LockupTextLook.UNSET?v:y.textLook),u.LockupStyle.isShadowLook(v)){h=v==u.LockupTextLook.KnockoutAndShadow||v==u.LockupTextLook.KnockoutShadowOutline?.08*f.pointSize*(1.7*e.style.shadowOffset+.25)/2:v==u.LockupTextLook.ShadowAndOutline?n/8*e.style.shadowOffset+.02*n:n/16*e.style.shadowOffset+.02*n,d=this.rotatePoint({x:0,y:-h},{x:0,y:0},r);var S=f.placement;(f=f.clone()).colorRole=a.ColorRole.Shadow,f.placement=new c.Matrix2D(S.a,S.b,S.c,S.d,S.tx+d.x,S.ty+d.y),o.push(f)}}}return new l.DecorationResults(o)}}}),n)},"0PPJ":function(e,t,o){var n,r=t,i=o("oAGj"),a=o("SpAV"),l=o("q5zr");r.MaskSubstitutionController=(n=function(){this.substitutions_={}},i.defineClass({name:"MaskSubstitutionController",ctor:n,props:{attach:function(e){var t=this,o=e.controller.undoRedoMgr,n=e;o.registerPatch((function(e){null!=n&&null!=o&&(t.performSubstitutions(n,o),e())}))},substitute:function(e,t,o,n){a.CoreAssertDebugOnly.isTrue(null==this.substitutions_[e],"Requesting substitution for the same url twice",{originalUrl:e},"MaskSubstitutionController.substitute","MaskSubstitutionController.swift",36),this.substitutions_[e]={componentID:t,url:o,mimeType:n}},performSubstitutions:function(e,t){var o=this;e.content.root.visitAll((function(e){var n,r,a;if((n=i.as(e,l.ImageContentNode))&&null!=(r=n.url)&&null!=(a=o.substitutions_[r])){var s=n.componentID!=a.componentID,u=n.url!=a.url,c=n.mimeType!=a.mimeType;(s||u||c)&&(t.beginPatch(),s&&(n.componentID=a.componentID),u&&(n.url=a.url),c&&(n.mimeType=a.mimeType),t.endPatch())}}))}}}),n)},"16hp":function(e,t,o){var n,r=t,i=o("oAGj"),a=o("CaSj"),l=o("UGKO"),s=o("FNB+"),u=o("cmoc"),c=o("eiag"),h=o("xe42"),d=o("OYRJ"),g=o("9Lk3"),p=o("pnSN"),f=o("fdtz"),m=o("lmwz"),y=o("fNpk"),v=o("3DEm"),S=o("K0Rh"),C=o("sIWg"),T=o("1NAc");r.FormaPlacementSuggester=(n=function(e,t){a.DesignSuggester.call(this,e,t),this.maxSuggestions=3},i.defineClass({name:"FormaPlacementSuggester",ctor:n,superName:"DesignSuggester",statics:{KIND:{get:function(){return"FormaPlacementSuggester"}},createPlacementInputs:function(e,t){var o,n,r,a=[],l=[],h=[],d=[],m=[],v=[],C=(o=i.opt(i.opt(t.root,(function(e){return e.frame})),(function(e){return e.maxX})))||null!=o?o:1/0,T=(n=i.opt(i.opt(t.root,(function(e){return e.frame})),(function(e){return e.maxY})))||null!=n?n:1/0,A=t;A.kind==S.RootForma.KIND&&(r=i.as(A.childAt(0),p.GroupForma))&&i.as(r.controller,g.GridController)&&(A=r);for(var F=i.iter(A.visitAsArray(s.FormaTraversal.JustChildren));!F.done;F.next()){var k=F.value;if(!i.eq(s._equality_Forma_Forma,e,k)&&null!=k.controller){var L=k.finalFrame;null!=L?((k.isBackgroundImage()||g.GridController.isBackgroundColoredCell(k))&&v.push(k),L.minX<0&&L.maxX>C||L.minY<0&&L.maxY>T||(k instanceof u.FrameForma&&(l.push(L),m.push(k),e.originalID!=k.originalID&&d.push(L)),k.isTypeLockup()&&(a.push(L),e.originalID!=k.originalID&&d.push(L)),null!=k.controller&&k.controller.floating&&k.kind!=f.ImageForma.KIND&&e.originalID!=k.originalID&&(h.push(L),d.push(L)))):y.LegacyCoreAssert.fail("something is wrong with this document. a forma has a nil frame",void 0,"FormaPlacementSuggester.createPlacementInputs","FormaPlacementSuggester.swift",212)}}return new c.FormaPlacementInput(e,d,h,a,l,m,v)},createPlacementSuggestion:function(e,t,o,n,r){for(var a=0,l=0,s=0,u=i.iter(i.range(0,n.imageRects.length,!1));!u.done;u.next()){var c=u.value,g=n.imageRects[c];if(null!=(M=t.intersectionWith(g))&&M.area==t.area&&g.area>t.area){var p=n.images[c];a=v.MathUtils.maxDouble(a,p.controller.getAverageEdge(t)),l=v.MathUtils.maxDouble(l,p.controller.getFaceIntersections(t))}else null!=M&&(s+=M.area)}for(var f=o,m=0,y=i.iter(n.backgroundRegions);!y.done;y.next()){var S=y.value;(M=t.intersectionWith(S.finalFrame))&&(Math.abs(M.area-t.area)>100?m+=1:f=S.finalFrame)}r.setFeature(h.FormaPlacementScore.Features.REGION_BOUNDARY_OVERLAP,i.toDouble(m)),r.setFeature(h.FormaPlacementScore.Features.DISTANCE_TO_CENTER,t.center.distanceTo(o.center)/Math.max(o.width,o.height)),r.setFeature(h.FormaPlacementScore.Features.FACE,l),r.setFeature(h.FormaPlacementScore.Features.EDGE,a),r.setFeature(h.FormaPlacementScore.Features.IMAGE_EDGE_OVERLAP,s/o.area),r.setFeature(h.FormaPlacementScore.Features.SIZE,t.area/o.area);var C=1-Math.abs(t.width/o.width-2*t.height/o.height);r.setFeature(h.FormaPlacementScore.Features.ASPECT_RATIO,C);var T=t.minX-f.minX,A=f.maxX-t.maxX,F=1-Math.abs(T-A)/f.width;F<.98&&(F=0),r.setFeature(h.FormaPlacementScore.Features.XSYMM,F);var k=t.minY-f.minY,L=f.maxY-t.maxY,b=1-Math.abs(k-L)/f.height;b<.98&&(b=0),r.setFeature(h.FormaPlacementScore.Features.YSYMM,b);for(var _=0,R=i.iter(n.textRects);!R.done;R.next()){var I=R.value;Math.abs(I.center.x-t.center.x)<3&&(_+=1),Math.abs(I.minY-t.minY)<3?_+=.25:Math.abs(I.center.y-t.center.y)<3&&(_+=.1)}r.setFeature(h.FormaPlacementScore.Features.ALIGNMENT,_);for(var w=0,D=i.iter(n.textRects);!D.done;D.next()){var x=D.value;null!=(M=t.intersectionWith(x))&&(w+=M.area)}r.setFeature(h.FormaPlacementScore.Features.TEXT_OVERLAP,w/o.area);for(var P=0,E=i.iter(n.floatingRects);!E.done;E.next()){var M,N=E.value;(M=t.intersectionWith(N))&&(P+=M.area)}return r.setFeature(h.FormaPlacementScore.Features.FLOATING_ELEMENT_OVERLAP,P/o.area),new d.FormaPlacementSuggestion(e,t,r)}},props:{createSuggestions:function(){return this.createPlacementSuggestions(!0)},createPlacementSuggestions:function(e,t){if(void 0===t&&(t=null),null==this.group.frame)return[];var o=this.group.frame;this.group.kind==S.RootForma.KIND&&(o=C.TheoRect.fromSize(this.group.page.pageSize));var r,a=t;null==a&&this.forma.isImage()&&(r=m.ImageFacade.getImageFormaForForma(this.forma))&&(a=i.opt(r.bounds,(function(e){return e.aspectRatio})));var s=n.createPlacementInputs(this.forma,this.group),u=i.clone(this.getSearchLocations(this.forma,o,s,e,a));if(0==u.length){var c,d=o;if(null!=(c=a)){var g=o.fitAspectRatioWithin(c);d=C.TheoRect.fromSize(g).offset(o.origin)}u.push(d)}for(var p,f=-1/0,y=new h.FormaPlacementScore(s),T=[],A=i.iter(u);!A.done;A.next()){var F=A.value,k=n.createPlacementSuggestion(this.forma,F,o,s,y);k.weightedScore.reject()||(T.push(k),y=new h.FormaPlacementScore(s)),k.score>f&&(f=k.score,p=k,y=new h.FormaPlacementScore(s))}if(e)return n.createPlacementSuggestion(this.forma,p.location,o,s,y),[i.as(p,l.IDesignSuggestion)];var L=[];L.push(p),i.sortInPlace(T,(function(e,t){return e.score>t.score}));for(var b=T.length,_=0,R=i.iter(i.range(0,this.maxSuggestions,!1));!R.done;R.next()){var I=null;for(_+=1;_<b;){for(var w=9999,D=i.iter(i.range(0,L.length,!1));!D.done;D.next()){var x=D.value;w=v.MathUtils.minDouble(w,T[_].distanceTo(L[x]))}if(w>.1){I=T[_];break}_+=1}if(null==I)break;L.push(I)}return L=L.slice(1,L.length),i.sortInPlace(L,(function(e,t){return e.location.center.x<t.location.center.x})),i.info("finished suggester"),[i.as(p,l.IDesignSuggestion)].concat(L)},fastPlacement:function(){var e=i.clone(this.createPlacementSuggestions(!0));return e.length>0?e[0]:null},getSearchLocations:function(e,t,o,n,r){var a;void 0===r&&(r=null);var l=[],s=[],u=[],c=[],h=C.TheoRect.fromXXYY(v.MathUtils.minDouble(t.width/4,200),t.width-10,v.MathUtils.minDouble(t.height/4,100),t.height-10);n&&(h=C.TheoRect.fromXXYY(v.MathUtils.minDouble(t.width/4,200),t.width-10,v.MathUtils.minDouble(t.height/4,100),t.height-10));var d=!1,g=t.area/10,p=t.area/5,f=h.minX,m=h.maxX,S=h.minY,A=h.maxY,F=t.width/20,k=t.height/20,L=n?5:8;null!=r&&(L*=L);var b=h.width/L,_=h.height/L;n&&(F=v.MathUtils.maxDouble(t.width/20,30),k=v.MathUtils.maxDouble(t.height/20,30)),s.push((t.minX+t.maxX)/2),u.push((t.minY+t.maxY)/2);var R=o.otherRects.concat(o.backgroundRegions.map((function(e){return e.finalFrame}),this));n&&R.length>10&&(R=(R=i.sort(R,(function(e,t){return e.area>t.area}))).slice(0,10));for(var I=i.iter(R);!I.done;I.next()){var w=I.value;s.push(w.center.x),u.push(w.center.y),u.push(w.minY)}for(var D=t.minX+5;D<t.maxX-5;)s.push(D),D+=F;for(var x=t.minY+5;x<t.maxY-5;)u.push(x),x+=k;var P=f;if(null==r)for(;P<m;){for(var E=S;E<A;)P*E>=g&&P*E<=p&&c.push(new T.TheoSize(P,E)),E+=_;P+=b}else{var M,N=0,G=!(!(a=i.opt(e.controller,(function(e){return e.floating})))&&null==a)&&a;if(e.isShape()&&G&&(r>=5||r<=.2)){var B=new T.TheoSize(m,A).multiply(.75).fitAspectRatioWithin(r);c.push(B),d=!0}else for(;P<m;){var O=P*(E=P/r);if(O>=g&&O<=p)c.push(new T.TheoSize(P,E));else if(0==c.length){var U=O<g?O/g:p/O;U>N&&(N=U,M=new T.TheoSize(P,E))}P+=b}0==c.length&&null!=M&&c.push(M)}for(var H=i.iter(s);!H.done;H.next())for(var z=H.value,Y=i.iter(u);!Y.done;Y.next())for(var W=Y.value,V=i.iter(c);!V.done;V.next()){var K=V.value;if(P=K.width,E=K.height,D=z-K.width/2,x=W-K.height/2,!(D+P>=t.maxX-5||x+E>=t.maxY-5||D<=t.minX+5||x<=t.minY+5)&&(!(P/E<.5)||d)){var X=C.TheoRect.fromXYWH(D,x,P,E);null!=r&&y.LegacyCoreAssert.isTrue(Math.abs(X.aspectRatio-r)<.001,"invalid candidate location: does not match aspect ratio",void 0,"FormaPlacementSuggester.getSearchLocations","FormaPlacementSuggester.swift",550),l.push(X)}}return l}}}),n)},"1HsO":function(e,t,o){var n,r,i,a,l,s,u,c,h,d,g=t,p=o("oAGj"),f=o("gXiO");g.BaseHandle=(n=function(){f.CoreObject.call(this)},p.defineClass({name:"BaseHandle",ctor:n,superName:"CoreObject"}),n),g.TransformType=p.defineEnum("TransformType",{None:0,RotateAboutCenter:1,Translate:2,ProportionalScaleAboutCenter:3,TopLeftCornerTranslate:4,TopRightCornerTranslate:5,BottomLeftCornerTranslate:6,BottomRightCornerTranslate:7,LeftSideTranslate:8,RightSideTranslate:9,TopSideTranslate:10,BottomSideTranslate:11,LetterSpacing:12,LineSpacing:13}),g.BoxReference=(r=function(e,t){this.placement=e,this.bounds=t},p.defineClass({name:"BoxReference",ctor:r,superName:"CoreObject"}),r),g.BoxHandleDisplayHint=p.defineEnum("BoxHandleDisplayHint",{ThinOutline:0,WideOutline:1,GroupOutlineColor:2,TextFrame:3,Shape:4,PreferLeftSideHandle:5,SuppressRotationHandle:6,SuppressTranslationHandle:7,SuppressResizeAnimation:8,CropMode:9}),g.BoxTransformHandles=(i=function(e,t,o,n,r){this.reference=e,this.allowedTransforms=p.clone(t),this.displayHints=p.clone(o),this.activeTransform=n,this.handlesTarget=r},p.defineClass({name:"BoxTransformHandles",ctor:i,superName:"BaseHandle"}),i),g.BoxTransformMultipleFormae=(a=function(e,t,o,n,r,i){this.formaIDs=p.clone(i),g.BoxTransformHandles.call(this,e,t,o,n,r)},p.defineClass({name:"BoxTransformMultipleFormae",ctor:a,superName:"BoxTransformHandles"}),a),g.HandleTransformStage=p.defineEnum("HandleTransformStage",{Begin:0,Update:1,End:2}),g.HandleTransformEvent=(l=function(e,t){this.viewportScale=1,this.handle=e,this.stage=t},p.defineClass({name:"HandleTransformEvent",ctor:l,superName:"CoreObject"}),l),g.TranslateTransformEvent=(s=function(e,t,o){this.event=o,g.HandleTransformEvent.call(this,e,t)},p.defineClass({name:"TranslateTransformEvent",ctor:s,superName:"HandleTransformEvent"}),s),g.MoveTransformEvent=(u=function(e,t,o){this.totalDelta=o,g.HandleTransformEvent.call(this,e,t)},p.defineClass({name:"MoveTransformEvent",ctor:u,superName:"HandleTransformEvent"}),u),g.RotateAboutCenterTransformEvent=(c=function(e,t,o,n){void 0===n&&(n=!0),this.totalDeltaRadians=o,this.doSnapping=n,g.HandleTransformEvent.call(this,e,t)},p.defineClass({name:"RotateAboutCenterTransformEvent",ctor:c,superName:"HandleTransformEvent"}),c),g.CornerTranslateTransformEvent=(h=function(e,t,o,n){this.transformType=o,this.position=n,g.HandleTransformEvent.call(this,e,t)},p.defineClass({name:"CornerTranslateTransformEvent",ctor:h,superName:"HandleTransformEvent"}),h),g.SideTranslateTransformEvent=(d=function(e,t,o,n){this.transformType=o,this.position=n,g.HandleTransformEvent.call(this,e,t)},p.defineClass({name:"SideTranslateTransformEvent",ctor:d,superName:"HandleTransformEvent"}),d)},"25Jq":function(e,t,o){var n,r=t,i=o("oAGj"),a=o("Nk+Q"),l=o("CMNw"),s=o("UUXZ"),u=o("PSFa"),c=o("JzRL"),h=o("elwG"),d=o("qUXk"),g=o("u+mS"),p=o("eLsM"),f=o("hsXA"),m=o("G9CY"),y=o("JU+l"),v=o("9X7Y"),S=o("aKgf");r.SingleSelectionDesignController=(n=function(e,t){d.DesignController.call(this),this.handles=new f.StandardHandlesHandler(e,t,this),this.drag=new g.DragFacadeBasedDragHandler(e,t,this),this.click=new h.StandardClickHandler(e),this.resize=new y.SingleItemResizeHandler(e,t,e.selection.formaAt(0),this),this.move=new m.StandardMoveHandler(e,t,this),this.rotate=new v.StandardRotateHandler(e,t,this),this.actions=new l.StandardActionHandler(e),this.attributes=new u.StandardAttributesHandler(e),this.featureSets=new p.StandardFeatureSetHandler(e),this.actionFeedback=new a.StandardActionFeedbackHandler(t),this.annotations=new s.StandardAnnotationsHandler(t),this.view=new S.StandardViewHandler(e,t),this.activePage=new c.StandardActivePageHandler(e,t)},i.defineClass({name:"SingleSelectionDesignController",ctor:n,superName:"DesignController"}),n)},"2Srg":function(e,t,o){var n,r=t,i=o("oAGj"),a=o("cmoc"),l=o("cYVN");r.ImageRoleData=(n=function(e,t,o){l.RoleData.call(this,e,t,o)},i.defineClass({name:"ImageRoleData",ctor:n,superName:"RoleData",statics:{getImageRoleData:function(e){return e instanceof a.FrameForma?new n(e,[],{}):null}}}),n)},"2wfq":function(e,t,o){o("oAGj")},"35Q0":function(e,t,o){var n,r,i,a,l=t,s=o("oAGj"),u=o("cZuM"),c=o("gXiO"),h=o("iCxV"),d=o("IUM5"),g=o("c+uM"),p=o("u2iI"),f=o("oKI3");l.TAG_SHAPE_ID="shape-id",l.ShapeCategory=s.defineEnum("ShapeCategory",{None:0,Circle:1,Square:2,Social:3,Cutout:4,Banner:5,Decorative:6,Other:7,Avoid:8}),l.TagGroup=s.defineEnum("TagGroup",{none:0,banner:1,circle:2,square:3,other:4,decorative:5,unused:6}),l.TheoShape=(n=function(){},s.defineClass({name:"TheoShape",ctor:n,props:{init_f4eb:function(e,t,o,n,r,i,a,l,u,c,h,d,g,p,f){void 0===p&&(p=!1),void 0===f&&(f=!1),this.id=e,this.name=t,this.deprecated=o,this.filled=n,this.centered=r,this.alignmentEdges=i,this.formality=u,this.drama=c,this.maxScale=h,this.minAspect=d,this.maxAspect=g,this.category=a,this.tags=s.clone(l),this.clockwise=p,this.premium=f},init_implicit:function(e,t,o,n,r,i,a,l,u,c,h,d,g,p,f){this.id=e,this.name=t,this.deprecated=o,this.filled=n,this.centered=r,this.formality=i,this.drama=a,this.alignmentEdges=l,this.category=u,this.tags=s.clone(c),this.clockwise=h,this.premium=d,this.maxScale=g,this.maxAspect=p,this.minAspect=f}}}),n),l.ShapeLibraryDataStructures=(r=function(){this.nonSvgBackingShapes=[l.TheoShape.init_f4eb("none","None",!1,!1,!0,u.AlignmentEdges.All,l.ShapeCategory.None,[l.TagGroup.none],5,1,1,0,100),l.TheoShape.init_f4eb("row","Row",!1,!0,!1,u.AlignmentEdges.All,l.ShapeCategory.None,[l.TagGroup.none],5,2,1,0,100),l.TheoShape.init_f4eb("bannerHorizontal","Horizontal Banner",!1,!0,!1,u.AlignmentEdges.All,l.ShapeCategory.Banner,[l.TagGroup.unused],5,2,1,1,100),l.TheoShape.init_f4eb("bannerVertical","Vertical Banner",!1,!0,!1,u.AlignmentEdges.All,l.ShapeCategory.Banner,[l.TagGroup.unused],5,2,1,0,1),l.TheoShape.init_f4eb("knockout","Text Knockout",!1,!0,!1,u.AlignmentEdges.All,l.ShapeCategory.Cutout,[l.TagGroup.unused],5,2,1,0,100)],this.svgBackingShapes=[l.TheoShape.init_f4eb("circle","Circle",!0,!0,!0,u.AlignmentEdges.All,l.ShapeCategory.Circle,[l.TagGroup.unused],5,1,.5,.5,2),l.TheoShape.init_f4eb("circle1","Circle1",!0,!1,!0,u.AlignmentEdges.All,l.ShapeCategory.Circle,[l.TagGroup.unused],5,6,.5,.5,2),l.TheoShape.init_f4eb("circle2","Circle2",!0,!1,!0,u.AlignmentEdges.All,l.ShapeCategory.Circle,[l.TagGroup.unused],7,6,.5,.5,2),l.TheoShape.init_f4eb("circle3","Circle3",!0,!1,!0,u.AlignmentEdges.All,l.ShapeCategory.Circle,[l.TagGroup.unused],8,6,.5,.5,2),l.TheoShape.init_f4eb("circle4","Circle4",!0,!1,!0,u.AlignmentEdges.All,l.ShapeCategory.Circle,[l.TagGroup.unused],1,6,.5,.5,2),l.TheoShape.init_f4eb("circle5","Circle5",!0,!1,!0,u.AlignmentEdges.All,l.ShapeCategory.Circle,[l.TagGroup.unused],2,8,.5,.5,2),l.TheoShape.init_f4eb("circle6","Circle6",!0,!1,!0,u.AlignmentEdges.All,l.ShapeCategory.Circle,[l.TagGroup.unused],7,8,.5,.5,2),l.TheoShape.init_f4eb("circle8","Circle8",!0,!1,!0,u.AlignmentEdges.All,l.ShapeCategory.Circle,[l.TagGroup.unused],1,10,.5,.5,2),l.TheoShape.init_f4eb("rect1","Rect1",!0,!1,!1,u.AlignmentEdges.All,l.ShapeCategory.None,[l.TagGroup.unused],5,5,.5,0,100),l.TheoShape.init_f4eb("rect2","Rect2",!0,!1,!1,u.AlignmentEdges.All,l.ShapeCategory.None,[l.TagGroup.unused],5,5,.5,0,100),l.TheoShape.init_f4eb("rect3-9sliced","Rect3-9",!0,!1,!1,u.AlignmentEdges.All,l.ShapeCategory.None,[l.TagGroup.unused],5,5,.5,0,100),l.TheoShape.init_f4eb("rect3","Rect3",!0,!1,!1,u.AlignmentEdges.All,l.ShapeCategory.None,[l.TagGroup.unused],5,5,.5,0,100),l.TheoShape.init_f4eb("rect4","Rect4",!0,!1,!1,u.AlignmentEdges.All,l.ShapeCategory.None,[l.TagGroup.unused],5,5,.5,0,100),l.TheoShape.init_f4eb("rect5","Rect5",!0,!1,!1,u.AlignmentEdges.All,l.ShapeCategory.None,[l.TagGroup.unused],5,5,.5,0,100),l.TheoShape.init_f4eb("rect6","Rect6",!0,!1,!1,u.AlignmentEdges.All,l.ShapeCategory.None,[l.TagGroup.unused],5,5,.5,0,100),l.TheoShape.init_f4eb("ornamental_003","Circle",!0,!1,!0,u.AlignmentEdges.All,l.ShapeCategory.None,[l.TagGroup.unused],6,7,.5,0,100),l.TheoShape.init_f4eb("shape_001","Circle",!0,!0,!0,u.AlignmentEdges.All,l.ShapeCategory.None,[l.TagGroup.unused],5,3,.5,0,100),l.TheoShape.init_f4eb("shape_004","Tag",!0,!0,!0,u.AlignmentEdges.All,l.ShapeCategory.None,[l.TagGroup.unused],5,2,.5,0,100),l.TheoShape.init_f4eb("shape_005","Gift",!0,!0,!0,u.AlignmentEdges.All,l.ShapeCategory.None,[l.TagGroup.unused],5,2,.5,0,100),l.TheoShape.init_f4eb("shape_006","Calendar",!0,!0,!0,u.AlignmentEdges.All,l.ShapeCategory.None,[l.TagGroup.unused],5,2,.5,0,100),l.TheoShape.init_f4eb("shape_007","Circle",!0,!0,!0,u.AlignmentEdges.All,l.ShapeCategory.None,[l.TagGroup.unused],3,3,.5,0,100),l.TheoShape.init_f4eb("shape_008","Circle",!0,!0,!0,u.AlignmentEdges.All,l.ShapeCategory.None,[l.TagGroup.unused],3,3,.5,0,100),l.TheoShape.init_f4eb("shape_009","Circle",!0,!0,!0,u.AlignmentEdges.All,l.ShapeCategory.None,[l.TagGroup.unused],3,3,.5,0,100),l.TheoShape.init_f4eb("shape_011","Shield",!0,!0,!0,u.AlignmentEdges.All,l.ShapeCategory.None,[l.TagGroup.unused],5,3,.5,0,100),l.TheoShape.init_f4eb("circle_001","Circle",!1,!0,!0,u.AlignmentEdges.All,l.ShapeCategory.Circle,[l.TagGroup.circle],5,1,.6,.5,2),l.TheoShape.init_f4eb("circle_002","Circle",!1,!0,!0,u.AlignmentEdges.All,l.ShapeCategory.Circle,[l.TagGroup.circle],5,6,.6,.5,2,!0),l.TheoShape.init_f4eb("circle_003","Circle",!1,!0,!0,u.AlignmentEdges.All,l.ShapeCategory.Circle,[l.TagGroup.circle],7,6,.6,.5,2,!0),l.TheoShape.init_f4eb("circle_004","Circle",!1,!0,!0,u.AlignmentEdges.All,l.ShapeCategory.Circle,[l.TagGroup.decorative],8,6,.6,.5,2,!0),l.TheoShape.init_f4eb("circle_005","Circle",!1,!1,!0,u.AlignmentEdges.All,l.ShapeCategory.Decorative,[l.TagGroup.decorative],1,6,.6,.5,2),l.TheoShape.init_f4eb("circle_006","Circle",!1,!1,!0,u.AlignmentEdges.All,l.ShapeCategory.Decorative,[l.TagGroup.decorative],2,8,.6,.5,2),l.TheoShape.init_f4eb("circle_007","Circle",!1,!1,!0,u.AlignmentEdges.All,l.ShapeCategory.Decorative,[l.TagGroup.decorative],7,8,.6,.5,2),l.TheoShape.init_f4eb("circle_008","Circle",!1,!1,!0,u.AlignmentEdges.All,l.ShapeCategory.Decorative,[l.TagGroup.decorative],1,10,.6,.5,2),l.TheoShape.init_f4eb("square_001","Circle",!1,!0,!0,u.AlignmentEdges.All,l.ShapeCategory.Square,[l.TagGroup.square],5,1,.7,0,100),l.TheoShape.init_f4eb("square_002","Circle",!1,!1,!0,u.AlignmentEdges.All,l.ShapeCategory.Cutout,[l.TagGroup.square],5,1,.7,0,100),l.TheoShape.init_f4eb("square_003","Circle",!1,!0,!0,u.AlignmentEdges.All,l.ShapeCategory.Square,[l.TagGroup.decorative],7,5,.7,0,100,!0),l.TheoShape.init_f4eb("square_004","Circle",!1,!0,!0,u.AlignmentEdges.All,l.ShapeCategory.Square,[l.TagGroup.square,l.TagGroup.other],4,4,.7,0,100),l.TheoShape.init_f4eb("square_005","Circle",!1,!0,!0,u.AlignmentEdges.All,l.ShapeCategory.Square,[l.TagGroup.other,l.TagGroup.banner],4,8,.7,0,100),l.TheoShape.init_f4eb("buttonoutline","Circle",!1,!1,!0,u.AlignmentEdges.All,l.ShapeCategory.Cutout,[l.TagGroup.other],5,5,.7,0,100),l.TheoShape.init_f4eb("button","Circle",!1,!0,!0,u.AlignmentEdges.All,l.ShapeCategory.Other,[l.TagGroup.other],5,5,.7,0,100),l.TheoShape.init_f4eb("diamond_001","Circle",!1,!0,!0,u.AlignmentEdges.All,l.ShapeCategory.Avoid,[l.TagGroup.other],5,8,.6,.25,4),l.TheoShape.init_f4eb("diamond_002","Circle",!1,!1,!0,u.AlignmentEdges.All,l.ShapeCategory.Cutout,[l.TagGroup.other],5,9,.6,.25,4),l.TheoShape.init_f4eb("ribbon_h_001","Circle",!1,!0,!0,u.AlignmentEdges.All,l.ShapeCategory.Banner,[l.TagGroup.banner],5,5,.8,3,100),l.TheoShape.init_f4eb("ribbon_h_002","Circle",!1,!1,!0,u.AlignmentEdges.All,l.ShapeCategory.Cutout,[l.TagGroup.banner],5,6,.8,3,100),l.TheoShape.init_f4eb("ribbon_h_003","Circle",!1,!0,!0,u.AlignmentEdges.All,l.ShapeCategory.Banner,[l.TagGroup.banner],5,4,.8,3,100),l.TheoShape.init_f4eb("ribbon_h_004","Circle",!1,!0,!0,u.AlignmentEdges.All,l.ShapeCategory.Banner,[l.TagGroup.banner],5,4,.8,3,100,!0),l.TheoShape.init_f4eb("ribbon_h_005","Circle",!1,!0,!0,u.AlignmentEdges.All,l.ShapeCategory.Banner,[l.TagGroup.banner],5,6,.8,3,100),l.TheoShape.init_f4eb("ornamental_001","Circle",!1,!1,!0,u.AlignmentEdges.TopAndBottom,l.ShapeCategory.Decorative,[l.TagGroup.decorative],3,4,.7,0,100),l.TheoShape.init_f4eb("ornamental_002","Circle",!1,!1,!0,u.AlignmentEdges.All,l.ShapeCategory.Decorative,[l.TagGroup.decorative],8,8,.7,0,100,!0),l.TheoShape.init_f4eb("shape_002","Circle",!1,!0,!0,u.AlignmentEdges.All,l.ShapeCategory.Avoid,[l.TagGroup.decorative],5,3,.7,0,100,!0),l.TheoShape.init_f4eb("shape_003","VerticalBanner",!1,!0,!0,u.AlignmentEdges.All,l.ShapeCategory.Avoid,[l.TagGroup.decorative],5,3,.5,0,1),l.TheoShape.init_f4eb("shape_010","Hexagon",!1,!0,!0,u.AlignmentEdges.All,l.ShapeCategory.Avoid,[l.TagGroup.square],9,6,.7,0,100),l.TheoShape.init_f4eb("shape_013","Speech Bubble",!1,!0,!0,u.AlignmentEdges.All,l.ShapeCategory.Avoid,[l.TagGroup.decorative],5,3,.4,.5,2,!0),l.TheoShape.init_f4eb("divider_001","Circle",!1,!1,!0,u.AlignmentEdges.All,l.ShapeCategory.Cutout,[l.TagGroup.other],5,5,.8,0,100),l.TheoShape.init_f4eb("divider_002","Circle",!1,!1,!0,u.AlignmentEdges.All,l.ShapeCategory.Cutout,[l.TagGroup.other],1,2,.5,0,100),l.TheoShape.init_f4eb("divider_003","Circle",!1,!1,!0,u.AlignmentEdges.All,l.ShapeCategory.Cutout,[l.TagGroup.other],5,1,.8,0,100),l.TheoShape.init_f4eb("Social_Facebook","Circle",!1,!1,!1,u.AlignmentEdges.LeftAndTopAndBottom,l.ShapeCategory.Social,[l.TagGroup.unused],5,5,.5,99,100),l.TheoShape.init_f4eb("Social_Instagram","Circle",!1,!1,!1,u.AlignmentEdges.LeftAndTopAndBottom,l.ShapeCategory.Social,[l.TagGroup.unused],5,5,.5,99,100),l.TheoShape.init_f4eb("Social_Pinterest","Circle",!1,!1,!1,u.AlignmentEdges.LeftAndTopAndBottom,l.ShapeCategory.Social,[l.TagGroup.unused],5,5,.5,99,100),l.TheoShape.init_f4eb("Social_Twitter","Circle",!1,!1,!1,u.AlignmentEdges.LeftAndTopAndBottom,l.ShapeCategory.Social,[l.TagGroup.unused],5,5,.5,99,100),l.TheoShape.init_f4eb("Social_GPlus","Circle",!1,!1,!1,u.AlignmentEdges.LeftAndTopAndBottom,l.ShapeCategory.Social,[l.TagGroup.unused],5,5,.5,99,100),l.TheoShape.init_f4eb("Social_Linkedin","Circle",!1,!1,!1,u.AlignmentEdges.LeftAndTopAndBottom,l.ShapeCategory.Social,[l.TagGroup.unused],5,5,.5,99,100),l.TheoShape.init_f4eb("Social_Periscope","Circle",!1,!1,!1,u.AlignmentEdges.LeftAndTopAndBottom,l.ShapeCategory.Social,[l.TagGroup.unused],5,5,.5,99,100),l.TheoShape.init_f4eb("Social_Snapchat","Circle",!1,!1,!1,u.AlignmentEdges.LeftAndTopAndBottom,l.ShapeCategory.Social,[l.TagGroup.unused],5,5,.5,99,100),l.TheoShape.init_f4eb("Social_Tumblr","Circle",!1,!1,!1,u.AlignmentEdges.LeftAndTopAndBottom,l.ShapeCategory.Social,[l.TagGroup.unused],5,5,.5,99,100),l.TheoShape.init_f4eb("Social_Youtube","Circle",!1,!1,!1,u.AlignmentEdges.LeftAndTopAndBottom,l.ShapeCategory.Social,[l.TagGroup.unused],5,5,.5,99,100),l.TheoShape.init_f4eb("inline_001","Inline",!1,!1,!0,u.AlignmentEdges.All,l.ShapeCategory.None,[l.TagGroup.unused],1,5,.5,0,100,void 0,!0),l.TheoShape.init_f4eb("inline_002","Inline",!1,!1,!0,u.AlignmentEdges.TopAndBottom,l.ShapeCategory.None,[l.TagGroup.unused],1,5,.5,0,100,void 0,!0),l.TheoShape.init_f4eb("inline_003","Inline",!1,!1,!0,u.AlignmentEdges.All,l.ShapeCategory.None,[l.TagGroup.unused],1,5,.5,0,100,void 0,!0),l.TheoShape.init_f4eb("inline_004","Inline",!1,!1,!0,u.AlignmentEdges.All,l.ShapeCategory.None,[l.TagGroup.unused],1,5,.5,0,100,void 0,!0),l.TheoShape.init_f4eb("inline_005","Inline",!1,!0,!0,u.AlignmentEdges.All,l.ShapeCategory.None,[l.TagGroup.unused],1,5,.5,0,100,!0,!0),l.TheoShape.init_f4eb("inline_006","Inline",!1,!0,!0,u.AlignmentEdges.All,l.ShapeCategory.None,[l.TagGroup.unused],1,5,.5,0,100,!0,!0),l.TheoShape.init_f4eb("pacific_001","Inline",!1,!1,!0,u.AlignmentEdges.All,l.ShapeCategory.None,[l.TagGroup.unused],1,5,.5,0,100,void 0,!0),l.TheoShape.init_f4eb("pacific_002","Inline",!1,!1,!0,u.AlignmentEdges.All,l.ShapeCategory.None,[l.TagGroup.unused],1,5,.5,0,100,void 0,!0),l.TheoShape.init_f4eb("pacific_003","Inline",!1,!1,!0,u.AlignmentEdges.All,l.ShapeCategory.None,[l.TagGroup.unused],1,5,.5,0,100,void 0,!0),l.TheoShape.init_f4eb("pacific_004","Inline",!1,!1,!0,u.AlignmentEdges.All,l.ShapeCategory.None,[l.TagGroup.unused],1,5,.5,0,100,void 0,!0),l.TheoShape.init_f4eb("pacific_005","Inline",!1,!0,!0,u.AlignmentEdges.All,l.ShapeCategory.None,[l.TagGroup.unused],1,5,.5,0,100,!0,!0),l.TheoShape.init_f4eb("pacific_006","Inline",!1,!0,!0,u.AlignmentEdges.All,l.ShapeCategory.None,[l.TagGroup.unused],1,5,.5,0,100,!0,!0)],this.seperatorShapes=[l.TheoShape.init_f4eb("square_001","Circle",!1,!0,!0,u.AlignmentEdges.All,l.ShapeCategory.Square,[l.TagGroup.square],5,1,.7,0,100),l.TheoShape.init_f4eb("circle_001","Circle",!1,!0,!0,u.AlignmentEdges.All,l.ShapeCategory.Circle,[l.TagGroup.circle],5,1,.6,.5,2),l.TheoShape.init_f4eb("pacific_006","Inline",!1,!0,!0,u.AlignmentEdges.All,l.ShapeCategory.None,[l.TagGroup.unused],1,5,.5,0,100,!0,!0)],this.DisplayOrderForCategories=[l.ShapeLibrary.CategoryBasic,l.ShapeLibrary.CategoryBanner,l.ShapeLibrary.CategoryDecorative,l.ShapeLibrary.CategorySocial],this.DisplayOrderForShapesByCategory={BASIC:["circle_001","circle_002","circle_003","shape_010","diamond_001","diamond_002","square_001","square_002","square_004","buttonoutline","button","square_005","divider_001","divider_002"],BANNER:["ribbon_h_001","ribbon_h_002","ribbon_h_003","ribbon_h_004","ribbon_h_005","shape_003"],DECORATIVE:["circle_004","circle_005","circle_006","circle_007","circle_008","ornamental_001","ornamental_002","square_003","shape_002","shape_013","inline_001","inline_002","inline_003","inline_004","inline_005","inline_006","pacific_001","pacific_002","pacific_003","pacific_004","pacific_005","pacific_006"],SOCIAL:["Social_Facebook","Social_Instagram","Social_Pinterest","Social_Twitter","Social_Youtube","Social_Snapchat","Social_Linkedin","Social_Tumblr","Social_GPlus","Social_Periscope"]},this.DisplayOrderForCharStyleShapesByCategory={BASIC:["square_002","square_004","buttonoutline","button","square_005","divider_001","divider_002","pacific_006"],BANNER:["ribbon_h_001","ribbon_h_002","ribbon_h_003","ribbon_h_004","ribbon_h_005"],DECORATIVE:["circle_001","circle_002","circle_003","shape_010","diamond_001","diamond_002","square_001","circle_004","circle_005","circle_006","circle_007","circle_008","ornamental_002","square_003","inline_001","inline_002","inline_003","inline_004","inline_005","inline_006","pacific_001","pacific_002","pacific_003","pacific_004","pacific_005"],SOCIAL:[]},this.DisplayOrderForSmallSetCharStyleShapesByCategory={BASIC:["square_002","square_004","buttonoutline","button","square_005","divider_001","divider_002","pacific_006"],BANNER:["ribbon_h_001","ribbon_h_002","ribbon_h_003","ribbon_h_004","ribbon_h_005"],DECORATIVE:["square_003","inline_001","inline_003","inline_005","inline_006","pacific_001","pacific_002","ornamental_002","diamond_001","diamond_002","square_001","circle_008"],SOCIAL:[]},this.DisplayOrderForLetterGridShapesByCategory={BASIC:["circle_001","circle_002","circle_003","shape_010","diamond_001","diamond_002","square_001","square_002","square_004","square_005","divider_001","divider_002"],BANNER:[],DECORATIVE:["circle_004","circle_005","pacific_006"],SOCIAL:[]},this.DisplayOrderForSymmetricPathsShapesByCategory={BASIC:["circle_001","circle_002","circle_003","shape_010","diamond_001","diamond_002","square_001","square_002","square_004","square_005","divider_001","divider_002"],BANNER:["ribbon_h_001","ribbon_h_002","ribbon_h_003","ribbon_h_004","ribbon_h_005","shape_003"],DECORATIVE:["circle_004","circle_005","circle_006","circle_007","circle_008","ornamental_001","ornamental_002","square_003","shape_002","shape_013","inline_001","inline_002","inline_003","inline_004","inline_005","inline_006","pacific_001","pacific_002","pacific_003","pacific_004","pacific_005","pacific_006"],SOCIAL:["Social_Facebook","Social_Instagram","Social_Pinterest","Social_Twitter","Social_Youtube","Social_Snapchat","Social_Linkedin","Social_Tumblr","Social_GPlus","Social_Periscope"]},this.DisplayOrderForAsymmetricPathsShapesByCategory={BASIC:["shape_010","diamond_001","diamond_002","square_001","square_002","square_004","square_005","divider_001","divider_002"],BANNER:["ribbon_h_001","ribbon_h_002","ribbon_h_003","ribbon_h_004","ribbon_h_005","shape_003"],DECORATIVE:["ornamental_001","ornamental_002","square_003","shape_002","shape_013","inline_001","inline_002","inline_003","inline_004","inline_005","inline_006","pacific_001","pacific_002","pacific_003","pacific_004","pacific_005","pacific_006"],SOCIAL:["Social_Facebook","Social_Instagram","Social_Pinterest","Social_Twitter","Social_Youtube","Social_Snapchat","Social_Linkedin","Social_Tumblr","Social_GPlus","Social_Periscope"]},this.DisplayOrderForAutoLayoutShapesByCategory={BASIC:["square_001","square_002","square_004","square_005","divider_001","divider_002"],BANNER:["ribbon_h_001","ribbon_h_002","ribbon_h_003","ribbon_h_004","ribbon_h_005","shape_003"],DECORATIVE:["ornamental_001","ornamental_002","square_003","shape_002","shape_013","inline_001","inline_002","inline_003","inline_004","inline_005","inline_006","pacific_001","pacific_002","pacific_003","pacific_004","pacific_005","pacific_006"],SOCIAL:[]},this.NonSuggestableBackingShapes=["Social_Facebook","Social_Instagram","Social_Pinterest","Social_Twitter","Social_Youtube","Social_Snapchat","Social_Linkedin","Social_Tumblr","Social_GPlus","Social_Periscope","shape_002","shape_003","shape_013","ornamental_001","knockout"],this.LockupBackingShapeIDs=[],this.BrowsableBackingShapes=[],this.FilledBackingShapes=[],this.shapeDictionary={},this.nonSvgBackingShapeIDs=[]},s.defineClass({name:"ShapeLibraryDataStructures",ctor:r,props:{init_d41d:function(){this.FilledBackingShapes.push(l.ShapeLibrary.Square),this.FilledBackingShapes.push(l.ShapeLibrary.Circle);for(var e=s.iter(this.svgBackingShapes);!e.done;e.next()){var t=e.value;this.LockupBackingShapeIDs.push(t.id),this.shapeDictionary[t.id]=t,t.deprecated||(this.BrowsableBackingShapes.push(t.id),t.filled&&this.FilledBackingShapes.push(t.id))}for(var o=s.iter(this.nonSvgBackingShapes);!o.done;o.next())t=o.value,this.shapeDictionary[t.id]=t,this.nonSvgBackingShapeIDs.push(t.id);this.ShapeIDToCategory={};for(var n=s.iter(this.DisplayOrderForCategories);!n.done;n.next())for(var r=n.value,i=s.iter(this.DisplayOrderForShapesByCategory[r]);!i.done;i.next()){var a=i.value;this.ShapeIDToCategory[a]=r}},init_implicit:function(e,t,o,n,r,i,a,c,h,d,g,p,f,m,y,v,S,C){void 0===e&&(e=[l.TheoShape.init_f4eb("none","None",!1,!1,!0,u.AlignmentEdges.All,l.ShapeCategory.None,[l.TagGroup.none],5,1,1,0,100),l.TheoShape.init_f4eb("row","Row",!1,!0,!1,u.AlignmentEdges.All,l.ShapeCategory.None,[l.TagGroup.none],5,2,1,0,100),l.TheoShape.init_f4eb("bannerHorizontal","Horizontal Banner",!1,!0,!1,u.AlignmentEdges.All,l.ShapeCategory.Banner,[l.TagGroup.unused],5,2,1,1,100),l.TheoShape.init_f4eb("bannerVertical","Vertical Banner",!1,!0,!1,u.AlignmentEdges.All,l.ShapeCategory.Banner,[l.TagGroup.unused],5,2,1,0,1),l.TheoShape.init_f4eb("knockout","Text Knockout",!1,!0,!1,u.AlignmentEdges.All,l.ShapeCategory.Cutout,[l.TagGroup.unused],5,2,1,0,100)]),void 0===t&&(t=[l.TheoShape.init_f4eb("circle","Circle",!0,!0,!0,u.AlignmentEdges.All,l.ShapeCategory.Circle,[l.TagGroup.unused],5,1,.5,.5,2),l.TheoShape.init_f4eb("circle1","Circle1",!0,!1,!0,u.AlignmentEdges.All,l.ShapeCategory.Circle,[l.TagGroup.unused],5,6,.5,.5,2),l.TheoShape.init_f4eb("circle2","Circle2",!0,!1,!0,u.AlignmentEdges.All,l.ShapeCategory.Circle,[l.TagGroup.unused],7,6,.5,.5,2),l.TheoShape.init_f4eb("circle3","Circle3",!0,!1,!0,u.AlignmentEdges.All,l.ShapeCategory.Circle,[l.TagGroup.unused],8,6,.5,.5,2),l.TheoShape.init_f4eb("circle4","Circle4",!0,!1,!0,u.AlignmentEdges.All,l.ShapeCategory.Circle,[l.TagGroup.unused],1,6,.5,.5,2),l.TheoShape.init_f4eb("circle5","Circle5",!0,!1,!0,u.AlignmentEdges.All,l.ShapeCategory.Circle,[l.TagGroup.unused],2,8,.5,.5,2),l.TheoShape.init_f4eb("circle6","Circle6",!0,!1,!0,u.AlignmentEdges.All,l.ShapeCategory.Circle,[l.TagGroup.unused],7,8,.5,.5,2),l.TheoShape.init_f4eb("circle8","Circle8",!0,!1,!0,u.AlignmentEdges.All,l.ShapeCategory.Circle,[l.TagGroup.unused],1,10,.5,.5,2),l.TheoShape.init_f4eb("rect1","Rect1",!0,!1,!1,u.AlignmentEdges.All,l.ShapeCategory.None,[l.TagGroup.unused],5,5,.5,0,100),l.TheoShape.init_f4eb("rect2","Rect2",!0,!1,!1,u.AlignmentEdges.All,l.ShapeCategory.None,[l.TagGroup.unused],5,5,.5,0,100),l.TheoShape.init_f4eb("rect3-9sliced","Rect3-9",!0,!1,!1,u.AlignmentEdges.All,l.ShapeCategory.None,[l.TagGroup.unused],5,5,.5,0,100),l.TheoShape.init_f4eb("rect3","Rect3",!0,!1,!1,u.AlignmentEdges.All,l.ShapeCategory.None,[l.TagGroup.unused],5,5,.5,0,100),l.TheoShape.init_f4eb("rect4","Rect4",!0,!1,!1,u.AlignmentEdges.All,l.ShapeCategory.None,[l.TagGroup.unused],5,5,.5,0,100),l.TheoShape.init_f4eb("rect5","Rect5",!0,!1,!1,u.AlignmentEdges.All,l.ShapeCategory.None,[l.TagGroup.unused],5,5,.5,0,100),l.TheoShape.init_f4eb("rect6","Rect6",!0,!1,!1,u.AlignmentEdges.All,l.ShapeCategory.None,[l.TagGroup.unused],5,5,.5,0,100),l.TheoShape.init_f4eb("ornamental_003","Circle",!0,!1,!0,u.AlignmentEdges.All,l.ShapeCategory.None,[l.TagGroup.unused],6,7,.5,0,100),l.TheoShape.init_f4eb("shape_001","Circle",!0,!0,!0,u.AlignmentEdges.All,l.ShapeCategory.None,[l.TagGroup.unused],5,3,.5,0,100),l.TheoShape.init_f4eb("shape_004","Tag",!0,!0,!0,u.AlignmentEdges.All,l.ShapeCategory.None,[l.TagGroup.unused],5,2,.5,0,100),l.TheoShape.init_f4eb("shape_005","Gift",!0,!0,!0,u.AlignmentEdges.All,l.ShapeCategory.None,[l.TagGroup.unused],5,2,.5,0,100),l.TheoShape.init_f4eb("shape_006","Calendar",!0,!0,!0,u.AlignmentEdges.All,l.ShapeCategory.None,[l.TagGroup.unused],5,2,.5,0,100),l.TheoShape.init_f4eb("shape_007","Circle",!0,!0,!0,u.AlignmentEdges.All,l.ShapeCategory.None,[l.TagGroup.unused],3,3,.5,0,100),l.TheoShape.init_f4eb("shape_008","Circle",!0,!0,!0,u.AlignmentEdges.All,l.ShapeCategory.None,[l.TagGroup.unused],3,3,.5,0,100),l.TheoShape.init_f4eb("shape_009","Circle",!0,!0,!0,u.AlignmentEdges.All,l.ShapeCategory.None,[l.TagGroup.unused],3,3,.5,0,100),l.TheoShape.init_f4eb("shape_011","Shield",!0,!0,!0,u.AlignmentEdges.All,l.ShapeCategory.None,[l.TagGroup.unused],5,3,.5,0,100),l.TheoShape.init_f4eb("circle_001","Circle",!1,!0,!0,u.AlignmentEdges.All,l.ShapeCategory.Circle,[l.TagGroup.circle],5,1,.6,.5,2),l.TheoShape.init_f4eb("circle_002","Circle",!1,!0,!0,u.AlignmentEdges.All,l.ShapeCategory.Circle,[l.TagGroup.circle],5,6,.6,.5,2,!0),l.TheoShape.init_f4eb("circle_003","Circle",!1,!0,!0,u.AlignmentEdges.All,l.ShapeCategory.Circle,[l.TagGroup.circle],7,6,.6,.5,2,!0),l.TheoShape.init_f4eb("circle_004","Circle",!1,!0,!0,u.AlignmentEdges.All,l.ShapeCategory.Circle,[l.TagGroup.decorative],8,6,.6,.5,2,!0),l.TheoShape.init_f4eb("circle_005","Circle",!1,!1,!0,u.AlignmentEdges.All,l.ShapeCategory.Decorative,[l.TagGroup.decorative],1,6,.6,.5,2),l.TheoShape.init_f4eb("circle_006","Circle",!1,!1,!0,u.AlignmentEdges.All,l.ShapeCategory.Decorative,[l.TagGroup.decorative],2,8,.6,.5,2),l.TheoShape.init_f4eb("circle_007","Circle",!1,!1,!0,u.AlignmentEdges.All,l.ShapeCategory.Decorative,[l.TagGroup.decorative],7,8,.6,.5,2),l.TheoShape.init_f4eb("circle_008","Circle",!1,!1,!0,u.AlignmentEdges.All,l.ShapeCategory.Decorative,[l.TagGroup.decorative],1,10,.6,.5,2),l.TheoShape.init_f4eb("square_001","Circle",!1,!0,!0,u.AlignmentEdges.All,l.ShapeCategory.Square,[l.TagGroup.square],5,1,.7,0,100),l.TheoShape.init_f4eb("square_002","Circle",!1,!1,!0,u.AlignmentEdges.All,l.ShapeCategory.Cutout,[l.TagGroup.square],5,1,.7,0,100),l.TheoShape.init_f4eb("square_003","Circle",!1,!0,!0,u.AlignmentEdges.All,l.ShapeCategory.Square,[l.TagGroup.decorative],7,5,.7,0,100,!0),l.TheoShape.init_f4eb("square_004","Circle",!1,!0,!0,u.AlignmentEdges.All,l.ShapeCategory.Square,[l.TagGroup.square,l.TagGroup.other],4,4,.7,0,100),l.TheoShape.init_f4eb("square_005","Circle",!1,!0,!0,u.AlignmentEdges.All,l.ShapeCategory.Square,[l.TagGroup.other,l.TagGroup.banner],4,8,.7,0,100),l.TheoShape.init_f4eb("buttonoutline","Circle",!1,!1,!0,u.AlignmentEdges.All,l.ShapeCategory.Cutout,[l.TagGroup.other],5,5,.7,0,100),l.TheoShape.init_f4eb("button","Circle",!1,!0,!0,u.AlignmentEdges.All,l.ShapeCategory.Other,[l.TagGroup.other],5,5,.7,0,100),l.TheoShape.init_f4eb("diamond_001","Circle",!1,!0,!0,u.AlignmentEdges.All,l.ShapeCategory.Avoid,[l.TagGroup.other],5,8,.6,.25,4),l.TheoShape.init_f4eb("diamond_002","Circle",!1,!1,!0,u.AlignmentEdges.All,l.ShapeCategory.Cutout,[l.TagGroup.other],5,9,.6,.25,4),l.TheoShape.init_f4eb("ribbon_h_001","Circle",!1,!0,!0,u.AlignmentEdges.All,l.ShapeCategory.Banner,[l.TagGroup.banner],5,5,.8,3,100),l.TheoShape.init_f4eb("ribbon_h_002","Circle",!1,!1,!0,u.AlignmentEdges.All,l.ShapeCategory.Cutout,[l.TagGroup.banner],5,6,.8,3,100),l.TheoShape.init_f4eb("ribbon_h_003","Circle",!1,!0,!0,u.AlignmentEdges.All,l.ShapeCategory.Banner,[l.TagGroup.banner],5,4,.8,3,100),l.TheoShape.init_f4eb("ribbon_h_004","Circle",!1,!0,!0,u.AlignmentEdges.All,l.ShapeCategory.Banner,[l.TagGroup.banner],5,4,.8,3,100,!0),l.TheoShape.init_f4eb("ribbon_h_005","Circle",!1,!0,!0,u.AlignmentEdges.All,l.ShapeCategory.Banner,[l.TagGroup.banner],5,6,.8,3,100),l.TheoShape.init_f4eb("ornamental_001","Circle",!1,!1,!0,u.AlignmentEdges.TopAndBottom,l.ShapeCategory.Decorative,[l.TagGroup.decorative],3,4,.7,0,100),l.TheoShape.init_f4eb("ornamental_002","Circle",!1,!1,!0,u.AlignmentEdges.All,l.ShapeCategory.Decorative,[l.TagGroup.decorative],8,8,.7,0,100,!0),l.TheoShape.init_f4eb("shape_002","Circle",!1,!0,!0,u.AlignmentEdges.All,l.ShapeCategory.Avoid,[l.TagGroup.decorative],5,3,.7,0,100,!0),l.TheoShape.init_f4eb("shape_003","VerticalBanner",!1,!0,!0,u.AlignmentEdges.All,l.ShapeCategory.Avoid,[l.TagGroup.decorative],5,3,.5,0,1),l.TheoShape.init_f4eb("shape_010","Hexagon",!1,!0,!0,u.AlignmentEdges.All,l.ShapeCategory.Avoid,[l.TagGroup.square],9,6,.7,0,100),l.TheoShape.init_f4eb("shape_013","Speech Bubble",!1,!0,!0,u.AlignmentEdges.All,l.ShapeCategory.Avoid,[l.TagGroup.decorative],5,3,.4,.5,2,!0),l.TheoShape.init_f4eb("divider_001","Circle",!1,!1,!0,u.AlignmentEdges.All,l.ShapeCategory.Cutout,[l.TagGroup.other],5,5,.8,0,100),l.TheoShape.init_f4eb("divider_002","Circle",!1,!1,!0,u.AlignmentEdges.All,l.ShapeCategory.Cutout,[l.TagGroup.other],1,2,.5,0,100),l.TheoShape.init_f4eb("divider_003","Circle",!1,!1,!0,u.AlignmentEdges.All,l.ShapeCategory.Cutout,[l.TagGroup.other],5,1,.8,0,100),l.TheoShape.init_f4eb("Social_Facebook","Circle",!1,!1,!1,u.AlignmentEdges.LeftAndTopAndBottom,l.ShapeCategory.Social,[l.TagGroup.unused],5,5,.5,99,100),l.TheoShape.init_f4eb("Social_Instagram","Circle",!1,!1,!1,u.AlignmentEdges.LeftAndTopAndBottom,l.ShapeCategory.Social,[l.TagGroup.unused],5,5,.5,99,100),l.TheoShape.init_f4eb("Social_Pinterest","Circle",!1,!1,!1,u.AlignmentEdges.LeftAndTopAndBottom,l.ShapeCategory.Social,[l.TagGroup.unused],5,5,.5,99,100),l.TheoShape.init_f4eb("Social_Twitter","Circle",!1,!1,!1,u.AlignmentEdges.LeftAndTopAndBottom,l.ShapeCategory.Social,[l.TagGroup.unused],5,5,.5,99,100),l.TheoShape.init_f4eb("Social_GPlus","Circle",!1,!1,!1,u.AlignmentEdges.LeftAndTopAndBottom,l.ShapeCategory.Social,[l.TagGroup.unused],5,5,.5,99,100),l.TheoShape.init_f4eb("Social_Linkedin","Circle",!1,!1,!1,u.AlignmentEdges.LeftAndTopAndBottom,l.ShapeCategory.Social,[l.TagGroup.unused],5,5,.5,99,100),l.TheoShape.init_f4eb("Social_Periscope","Circle",!1,!1,!1,u.AlignmentEdges.LeftAndTopAndBottom,l.ShapeCategory.Social,[l.TagGroup.unused],5,5,.5,99,100),l.TheoShape.init_f4eb("Social_Snapchat","Circle",!1,!1,!1,u.AlignmentEdges.LeftAndTopAndBottom,l.ShapeCategory.Social,[l.TagGroup.unused],5,5,.5,99,100),l.TheoShape.init_f4eb("Social_Tumblr","Circle",!1,!1,!1,u.AlignmentEdges.LeftAndTopAndBottom,l.ShapeCategory.Social,[l.TagGroup.unused],5,5,.5,99,100),l.TheoShape.init_f4eb("Social_Youtube","Circle",!1,!1,!1,u.AlignmentEdges.LeftAndTopAndBottom,l.ShapeCategory.Social,[l.TagGroup.unused],5,5,.5,99,100),l.TheoShape.init_f4eb("inline_001","Inline",!1,!1,!0,u.AlignmentEdges.All,l.ShapeCategory.None,[l.TagGroup.unused],1,5,.5,0,100,void 0,!0),l.TheoShape.init_f4eb("inline_002","Inline",!1,!1,!0,u.AlignmentEdges.TopAndBottom,l.ShapeCategory.None,[l.TagGroup.unused],1,5,.5,0,100,void 0,!0),l.TheoShape.init_f4eb("inline_003","Inline",!1,!1,!0,u.AlignmentEdges.All,l.ShapeCategory.None,[l.TagGroup.unused],1,5,.5,0,100,void 0,!0),l.TheoShape.init_f4eb("inline_004","Inline",!1,!1,!0,u.AlignmentEdges.All,l.ShapeCategory.None,[l.TagGroup.unused],1,5,.5,0,100,void 0,!0),l.TheoShape.init_f4eb("inline_005","Inline",!1,!0,!0,u.AlignmentEdges.All,l.ShapeCategory.None,[l.TagGroup.unused],1,5,.5,0,100,!0,!0),l.TheoShape.init_f4eb("inline_006","Inline",!1,!0,!0,u.AlignmentEdges.All,l.ShapeCategory.None,[l.TagGroup.unused],1,5,.5,0,100,!0,!0),l.TheoShape.init_f4eb("pacific_001","Inline",!1,!1,!0,u.AlignmentEdges.All,l.ShapeCategory.None,[l.TagGroup.unused],1,5,.5,0,100,void 0,!0),l.TheoShape.init_f4eb("pacific_002","Inline",!1,!1,!0,u.AlignmentEdges.All,l.ShapeCategory.None,[l.TagGroup.unused],1,5,.5,0,100,void 0,!0),l.TheoShape.init_f4eb("pacific_003","Inline",!1,!1,!0,u.AlignmentEdges.All,l.ShapeCategory.None,[l.TagGroup.unused],1,5,.5,0,100,void 0,!0),l.TheoShape.init_f4eb("pacific_004","Inline",!1,!1,!0,u.AlignmentEdges.All,l.ShapeCategory.None,[l.TagGroup.unused],1,5,.5,0,100,void 0,!0),l.TheoShape.init_f4eb("pacific_005","Inline",!1,!0,!0,u.AlignmentEdges.All,l.ShapeCategory.None,[l.TagGroup.unused],1,5,.5,0,100,!0,!0),l.TheoShape.init_f4eb("pacific_006","Inline",!1,!0,!0,u.AlignmentEdges.All,l.ShapeCategory.None,[l.TagGroup.unused],1,5,.5,0,100,!0,!0)]),void 0===o&&(o=[l.TheoShape.init_f4eb("square_001","Circle",!1,!0,!0,u.AlignmentEdges.All,l.ShapeCategory.Square,[l.TagGroup.square],5,1,.7,0,100),l.TheoShape.init_f4eb("circle_001","Circle",!1,!0,!0,u.AlignmentEdges.All,l.ShapeCategory.Circle,[l.TagGroup.circle],5,1,.6,.5,2),l.TheoShape.init_f4eb("pacific_006","Inline",!1,!0,!0,u.AlignmentEdges.All,l.ShapeCategory.None,[l.TagGroup.unused],1,5,.5,0,100,!0,!0)]),void 0===n&&(n=[l.ShapeLibrary.CategoryBasic,l.ShapeLibrary.CategoryBanner,l.ShapeLibrary.CategoryDecorative,l.ShapeLibrary.CategorySocial]),void 0===r&&(r={BASIC:["circle_001","circle_002","circle_003","shape_010","diamond_001","diamond_002","square_001","square_002","square_004","buttonoutline","button","square_005","divider_001","divider_002"],BANNER:["ribbon_h_001","ribbon_h_002","ribbon_h_003","ribbon_h_004","ribbon_h_005","shape_003"],DECORATIVE:["circle_004","circle_005","circle_006","circle_007","circle_008","ornamental_001","ornamental_002","square_003","shape_002","shape_013","inline_001","inline_002","inline_003","inline_004","inline_005","inline_006","pacific_001","pacific_002","pacific_003","pacific_004","pacific_005","pacific_006"],SOCIAL:["Social_Facebook","Social_Instagram","Social_Pinterest","Social_Twitter","Social_Youtube","Social_Snapchat","Social_Linkedin","Social_Tumblr","Social_GPlus","Social_Periscope"]}),void 0===i&&(i={BASIC:["square_002","square_004","buttonoutline","button","square_005","divider_001","divider_002","pacific_006"],BANNER:["ribbon_h_001","ribbon_h_002","ribbon_h_003","ribbon_h_004","ribbon_h_005"],DECORATIVE:["circle_001","circle_002","circle_003","shape_010","diamond_001","diamond_002","square_001","circle_004","circle_005","circle_006","circle_007","circle_008","ornamental_002","square_003","inline_001","inline_002","inline_003","inline_004","inline_005","inline_006","pacific_001","pacific_002","pacific_003","pacific_004","pacific_005"],SOCIAL:[]}),void 0===a&&(a={BASIC:["square_002","square_004","buttonoutline","button","square_005","divider_001","divider_002","pacific_006"],BANNER:["ribbon_h_001","ribbon_h_002","ribbon_h_003","ribbon_h_004","ribbon_h_005"],DECORATIVE:["square_003","inline_001","inline_003","inline_005","inline_006","pacific_001","pacific_002","ornamental_002","diamond_001","diamond_002","square_001","circle_008"],SOCIAL:[]}),void 0===c&&(c={BASIC:["circle_001","circle_002","circle_003","shape_010","diamond_001","diamond_002","square_001","square_002","square_004","square_005","divider_001","divider_002"],BANNER:[],DECORATIVE:["circle_004","circle_005","pacific_006"],SOCIAL:[]}),void 0===h&&(h={BASIC:["circle_001","circle_002","circle_003","shape_010","diamond_001","diamond_002","square_001","square_002","square_004","square_005","divider_001","divider_002"],BANNER:["ribbon_h_001","ribbon_h_002","ribbon_h_003","ribbon_h_004","ribbon_h_005","shape_003"],DECORATIVE:["circle_004","circle_005","circle_006","circle_007","circle_008","ornamental_001","ornamental_002","square_003","shape_002","shape_013","inline_001","inline_002","inline_003","inline_004","inline_005","inline_006","pacific_001","pacific_002","pacific_003","pacific_004","pacific_005","pacific_006"],SOCIAL:["Social_Facebook","Social_Instagram","Social_Pinterest","Social_Twitter","Social_Youtube","Social_Snapchat","Social_Linkedin","Social_Tumblr","Social_GPlus","Social_Periscope"]}),void 0===d&&(d={BASIC:["shape_010","diamond_001","diamond_002","square_001","square_002","square_004","square_005","divider_001","divider_002"],BANNER:["ribbon_h_001","ribbon_h_002","ribbon_h_003","ribbon_h_004","ribbon_h_005","shape_003"],DECORATIVE:["ornamental_001","ornamental_002","square_003","shape_002","shape_013","inline_001","inline_002","inline_003","inline_004","inline_005","inline_006","pacific_001","pacific_002","pacific_003","pacific_004","pacific_005","pacific_006"],SOCIAL:["Social_Facebook","Social_Instagram","Social_Pinterest","Social_Twitter","Social_Youtube","Social_Snapchat","Social_Linkedin","Social_Tumblr","Social_GPlus","Social_Periscope"]}),void 0===g&&(g={BASIC:["square_001","square_002","square_004","square_005","divider_001","divider_002"],BANNER:["ribbon_h_001","ribbon_h_002","ribbon_h_003","ribbon_h_004","ribbon_h_005","shape_003"],DECORATIVE:["ornamental_001","ornamental_002","square_003","shape_002","shape_013","inline_001","inline_002","inline_003","inline_004","inline_005","inline_006","pacific_001","pacific_002","pacific_003","pacific_004","pacific_005","pacific_006"],SOCIAL:[]}),void 0===p&&(p=["Social_Facebook","Social_Instagram","Social_Pinterest","Social_Twitter","Social_Youtube","Social_Snapchat","Social_Linkedin","Social_Tumblr","Social_GPlus","Social_Periscope","shape_002","shape_003","shape_013","ornamental_001","knockout"]),void 0===m&&(m=[]),void 0===y&&(y=[]),void 0===v&&(v=[]),void 0===S&&(S={}),void 0===C&&(C=[]),this.nonSvgBackingShapes=s.clone(e),this.svgBackingShapes=s.clone(t),this.seperatorShapes=s.clone(o),this.DisplayOrderForCategories=s.clone(n),this.DisplayOrderForShapesByCategory=s.clone(r),this.DisplayOrderForCharStyleShapesByCategory=s.clone(i),this.DisplayOrderForSmallSetCharStyleShapesByCategory=s.clone(a),this.DisplayOrderForLetterGridShapesByCategory=s.clone(c),this.DisplayOrderForSymmetricPathsShapesByCategory=s.clone(h),this.DisplayOrderForAsymmetricPathsShapesByCategory=s.clone(d),this.DisplayOrderForAutoLayoutShapesByCategory=s.clone(g),this.NonSuggestableBackingShapes=s.clone(p),this.ShapeIDToCategory=s.clone(f),this.LockupBackingShapeIDs=s.clone(m),this.BrowsableBackingShapes=s.clone(y),this.FilledBackingShapes=s.clone(v),this.shapeDictionary=s.clone(S),this.nonSvgBackingShapeIDs=s.clone(C)},clone:function(){return r.init_implicit(this.nonSvgBackingShapes,this.svgBackingShapes,this.seperatorShapes,this.DisplayOrderForCategories,this.DisplayOrderForShapesByCategory,this.DisplayOrderForCharStyleShapesByCategory,this.DisplayOrderForSmallSetCharStyleShapesByCategory,this.DisplayOrderForLetterGridShapesByCategory,this.DisplayOrderForSymmetricPathsShapesByCategory,this.DisplayOrderForAsymmetricPathsShapesByCategory,this.DisplayOrderForAutoLayoutShapesByCategory,this.NonSuggestableBackingShapes,this.ShapeIDToCategory,this.LockupBackingShapeIDs,this.BrowsableBackingShapes,this.FilledBackingShapes,this.shapeDictionary,this.nonSvgBackingShapeIDs)}}}),r),l.ShapeLibrary=(i=function(){c.CoreObject.call(this)},a={},s.defineClass({name:"ShapeLibrary",ctor:i,superName:"CoreObject",statics:{CategoryBasic:"BASIC",CategoryBanner:"BANNER",CategoryDecorative:"DECORATIVE",CategorySocial:"SOCIAL",CategoryExclusive:"EXCLUSIVE",CategoryFullCanvas:"FULL_CANVAS",Square:"square",Circle:"circle",shapeLibraryDataStructures:{get:function(){return void 0===a.shapeLibraryDataStructures&&(a.shapeLibraryDataStructures=l.ShapeLibraryDataStructures.init_d41d()),a.shapeLibraryDataStructures}},LockupBackingShapeIDs:{get:function(){return void 0===a.LockupBackingShapeIDs&&(a.LockupBackingShapeIDs=i.shapeLibraryDataStructures.LockupBackingShapeIDs),a.LockupBackingShapeIDs},set:function(e){a.LockupBackingShapeIDs=e}},NonSvgBackingShapeIDs:{get:function(){return void 0===a.NonSvgBackingShapeIDs&&(a.NonSvgBackingShapeIDs=i.shapeLibraryDataStructures.nonSvgBackingShapeIDs),a.NonSvgBackingShapeIDs},set:function(e){a.NonSvgBackingShapeIDs=e}},BrowsableBackingShapes:{get:function(){return void 0===a.BrowsableBackingShapes&&(a.BrowsableBackingShapes=i.shapeLibraryDataStructures.BrowsableBackingShapes),a.BrowsableBackingShapes},set:function(e){a.BrowsableBackingShapes=e}},FilledBackingShapes:{get:function(){return void 0===a.FilledBackingShapes&&(a.FilledBackingShapes=i.shapeLibraryDataStructures.FilledBackingShapes),a.FilledBackingShapes},set:function(e){a.FilledBackingShapes=e}},shapeDictionary:{get:function(){return void 0===a.shapeDictionary&&(a.shapeDictionary=i.shapeLibraryDataStructures.shapeDictionary),a.shapeDictionary},set:function(e){a.shapeDictionary=e}},NonSuggestableBackingShapes:{get:function(){return void 0===a.NonSuggestableBackingShapes&&(a.NonSuggestableBackingShapes=i.shapeLibraryDataStructures.NonSuggestableBackingShapes),a.NonSuggestableBackingShapes},set:function(e){a.NonSuggestableBackingShapes=e}},SeperatorShapes:{get:function(){return void 0===a.SeperatorShapes&&(a.SeperatorShapes=i.shapeLibraryDataStructures.seperatorShapes),a.SeperatorShapes},set:function(e){a.SeperatorShapes=e}},SVG_ROUNDED_RECT_ID:"SVG_ROUNDED_RECT",SVG_ROUNDED_RECT2PATHS_ID:"SVG_ROUNDED_RECT2PATHS",SVG_CIRCLE_CORNERS_ID:"SVG_CIRCLE_CORNERS",SVG_CIRCLE_CORNERS_FILL_ID:"SVG_CIRCLE_CORNERS_FILL",SVG_CIRCLE_CORNERS_FILL_NOSLICE_ID:"SVG_CIRCLE_CORNERS_FILL_NOSLICE",SVG_SIMPLE_ARROW_ID:"SVG_SIMPLE_ARROW",SVG_V_LINE_ID:"SVG_VLINE",SVG_H_LINE_ID:"SVG_H_LINE",getSVGData:function(e){var t="<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 215 213' sliceBox='100 100 10 10' stroke-base-weight='18.0' stroke-multiplier-min='0.1' stroke-multiplier-max='2.0' prescale-base='32.0' prescale-min='0.05' prescale-max='2.0'><defs><style>.cls-1{fill:none;stroke:#000;stroke-miterlimit:10;stroke-width:18px;}</style></defs><path class='cls-1' d='M174,140.5h-.5v-65h.5A32.5,32.5,0,1,0,141.5,43a33.74,33.74,0,0,0,.19,3.5H74.31A33.74,33.74,0,0,0,74.5,43,32.5,32.5,0,1,0,42,75.5h.5v65H42a32.5,32.5,0,1,0,32.49,33h67a32.5,32.5,0,1,0,32.49-33Z' transform='translate(-0.5 -1.5)'/></svg>";switch(e){case"SVG_ROUNDED_RECT":return"<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 215 213' sliceBox='100 100 10 10' stroke-base-weight='18.0' stroke-multiplier-initial='0.0' stroke-multiplier-min='0.0' stroke-multiplier-max='2.0' prescale-base='28.0' prescale-min='0.05' prescale-max='2.0'><defs><style>.cls-1{fill:#F0F;stroke:#000;stroke-miterlimit:10;stroke-width:18px;}</style></defs><path class='cls-1' d='M174,204c17.9-0.3,32.3-15,32-33l0-129.5C206,23.6,191.4,9,173.5,9h-132C23.6,9,9,23.6,9,41.5l0,130C9,189.4,23.5,204,41.5,204L174,204z'/></svg>";case"SVG_ROUNDED_RECT2PATHS":return"<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 215 213' sliceBox='100 100 10 10' stroke-base-weight='18.0' stroke-multiplier-initial='0.0' stroke-multiplier-min='0.0' stroke-multiplier-max='2.0' prescale-base='28.0' prescale-min='0.05' prescale-max='2.0'><defs><style>.cls-1{fill:#F0F;stroke:#000;stroke-miterlimit:10;stroke-width:18px;}</style><style>.cls-2{fill:none;stroke:#000;stroke-miterlimit:10;stroke-width:18px;}</style></defs><path class='cls-1' d='M174,204c17.9-0.3,32.3-15,32-33l0-129.5C206,23.6,191.4,9,173.5,9h-132C23.6,9,9,23.6,9,41.5l0,130C9,189.4,23.5,204,41.5,204L174,204z'/><path class='cls-2' d='M174,204c17.9-0.3,32.3-15,32-33l0-129.5C206,23.6,191.4,9,173.5,9h-132C23.6,9,9,23.6,9,41.5l0,130C9,189.4,23.5,204,41.5,204L174,204z'/></svg>";case"SVG_CIRCLE_CORNERS":return t;case"SVG_CIRCLE_CORNERS_FILL":return"<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 215 213' sliceBox='100 100 10 10' stroke-base-weight='18.0' stroke-multiplier-min='0.1' stroke-multiplier-max='3.0' prescale-base='32.0' prescale-min='0.05' prescale-max='2.0'><defs><style>.cls-1{fill:none;stroke:#000;stroke-miterlimit:10;stroke-width:18px;}</style></defs><title>Untitled-1</title><path class='cls-1' d='M174,140.5h-.5v-65h.5A32.5,32.5,0,1,0,141.5,43a33.74,33.74,0,0,0,.19,3.5H74.31A33.74,33.74,0,0,0,74.5,43,32.5,32.5,0,1,0,42,75.5h.5v65H42a32.5,32.5,0,1,0,32.49,33h67a32.5,32.5,0,1,0,32.49-33Z' transform='translate(-0.5 -1.5)'/><rect x='73.75' y='73.75' width='67.51' height='67.51' stroke-width='9.0'/></svg>";case"SVG_CIRCLE_CORNERS_FILL_NOSLICE":return"<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 215 213' stroke-base-weight='18.0' stroke-multiplier-min='0.1' stroke-multiplier-max='2.0' prescale-base='32.0' prescale-min='0.05' prescale-max='2.0'><defs><style>.cls-1{fill:none;stroke:#000;stroke-miterlimit:10;stroke-width:18px;}</style></defs><title>Untitled-1</title><path class='cls-1' d='M174,140.5h-.5v-65h.5A32.5,32.5,0,1,0,141.5,43a33.74,33.74,0,0,0,.19,3.5H74.31A33.74,33.74,0,0,0,74.5,43,32.5,32.5,0,1,0,42,75.5h.5v65H42a32.5,32.5,0,1,0,32.49,33h67a32.5,32.5,0,1,0,32.49-33Z' transform='translate(-0.5 -1.5)'/><rect x='73.75' y='73.75' width='67.51' height='67.51' stroke-width='9.0'/></svg>";case"SVG_SIMPLE_ARROW":return"<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 124 98' sliceBox='0 0 10 98' stroke-base-weight='20.0' stroke-multiplier-min='0.1' stroke-multiplier-max='2.0' prescale-base='1.0' prescale-min='0.05' prescale-max='4.0'><defs><style>.cls-1{fill:#fff;stroke:#000;stroke-miterlimit:10;stroke-width:20px;}</style></defs><title>arrow</title><line class='cls-1' y1='49' x2='61' y2='49'/><path d='M37,98C68,54,37,0,37,0l87,49Z' transform='translate(0 0)'/></svg>";case"SVG_VLINE":return"<svg id='Layer_1' data-name='Layer 1' xmlns='http://www.w3.org/2000/svg' width='579.78' height='604.61' viewBox='0 0 579.78 604.61' stroke-base-weight='2.0' stroke-multiplier-initial='1.0' stroke-multiplier-min='0.25' stroke-multiplier-max='16.0'><defs><style>.cls-1 {fill: #fff; stroke: #231f20; stroke-miterlimit: 10; stroke-width: 10px;}</style></defs><polygon class='cls-1' points='290.45 6.97 572.85 281.87 290.45 597.12 6.94 281.87 290.45 6.97'/></svg>";case"SVG_H_LINE":return"<svg id='Layer_1' data-name='Layer 1' xmlns='http://www.w3.org/2000/svg' width='576.74' height='616.19' viewBox='0 0 576.74 616.19' stroke-base-weight='20.0' stroke-multiplier-min='0.1' stroke-multiplier-max='5.0'><defs><style>.cls-1 { fill: #fff; stroke: #231f20; stroke-miterlimit: 10; stroke-width: 10px; }</style></defs><polyline class='cls-1' points='4.93 1.46 103.9 596.74 247.12 207.71 390.34 596.74 571.96 1.46'/></svg>";default:return t}},getShapeDataForArtworkId:function(e){var t="none";return null!=e&&(t=e),i.shapeDictionary[t]},applyToShapeForma:function(e,t){var o;null!=(o=s.opt(h.Host.resourceUtils,(function(e){return e.urlForResource(d.CATEGORY_ID_SHAPE,t)})))&&(i.applyURLToShapeForma(e,o),e.shapeLibraryID=t)},applyURLToShapeForma:function(e,t){var o,n;(o=h.Host.pathUtils.artworkFromURL(t,!1))&&(e.canonicalArtwork=o.artwork,e.sliceBox=o.sliceBox,e.contentRegion=o.contentRegion,(n=s.as(e.style,p.ShapeStyle))&&n.copyCustomAttributes(o.customAttributes)&&(n.shapeType=o.shapeType))},categoryForShapeID:function(e){return i.shapeLibraryDataStructures.ShapeIDToCategory[e]},displayOrderForCategories:function(){return i.shapeLibraryDataStructures.DisplayOrderForCategories},displayOrderForCompatibleShapeIDs:function(e,t,o,n,r){return g.LockupStyle.isLetterGrid(t)?i.displayOrderForLetterGridShapeIDs(e,n,r):g.LockupStyle.isPath(t)?i.displayOrderForPathShapeIDs(e,o,n,r):g.LockupStyle.isAutoLayout(t)?i.displayOrderForAutoLayoutShapeIDs(e,n,r):n?i.displayOrderForCharStyleShapeIDs(e,r):i.displayOrderForShapeIDs(e)},getCategorySlice:function(e,t){return e[t]||[]},displayOrderForShapeIDs:function(e){return i.getCategorySlice(i.shapeLibraryDataStructures.DisplayOrderForShapesByCategory,e)},displayOrderForCharStyleShapeIDs:function(e,t){var o=s.clone(t?i.shapeLibraryDataStructures.DisplayOrderForSmallSetCharStyleShapesByCategory:i.shapeLibraryDataStructures.DisplayOrderForCharStyleShapesByCategory);return i.getCategorySlice(o,e)},displayOrderForLetterGridShapeIDs:function(e,t,o){return i.getCategorySlice(i.shapeLibraryDataStructures.DisplayOrderForLetterGridShapesByCategory,e)},displayOrderForPathShapeIDs:function(e,t,o,n){if(o)return[];var r=s.clone(f.TextPathLibrary.isPathSymmetric(t)?i.shapeLibraryDataStructures.DisplayOrderForSymmetricPathsShapesByCategory:i.shapeLibraryDataStructures.DisplayOrderForAsymmetricPathsShapesByCategory);return i.getCategorySlice(r,e)},displayOrderForAutoLayoutShapeIDs:function(e,t,o){return i.getCategorySlice(i.shapeLibraryDataStructures.DisplayOrderForAutoLayoutShapesByCategory,e)},isBackingShapeStyleCompatible:function(e,t,o){return g.LockupStyle.isLetterGrid(e.layout)?i.isBackingShapeLetterGridCompatible(t,o):g.LockupStyle.isPath(e.layout)?i.isBackingShapePathCompatible(e.pathID,t,o):!g.LockupStyle.isAutoLayout(e.layout)||i.isBackingShapeAutoLayoutCompatible(t,o)},isSVGIncluded:function(e,t){var o;if(null!=(o=e))for(var n=s.iter(i.shapeLibraryDataStructures.DisplayOrderForCategories);!n.done;n.next())for(var r=n.value,a=s.clone(t[r]),l=s.iter(a);!l.done;l.next())if(l.value==o)return!0;return!1},isBackingShapeLetterGridCompatible:function(e,t){return e!=g.LockupBacking.SVGBackground?e==g.LockupBacking.None:i.isSVGIncluded(t,i.shapeLibraryDataStructures.DisplayOrderForLetterGridShapesByCategory)},isBackingShapePathCompatible:function(e,t,o){if(t==g.LockupBacking.Rows)return!1;if(t!=g.LockupBacking.SVGBackground)return!0;var n=s.clone(f.TextPathLibrary.isPathSymmetric(e)?i.shapeLibraryDataStructures.DisplayOrderForSymmetricPathsShapesByCategory:i.shapeLibraryDataStructures.DisplayOrderForAsymmetricPathsShapesByCategory);return i.isSVGIncluded(o,n)},isBackingShapeAutoLayoutCompatible:function(e,t){return e!=g.LockupBacking.Rows&&(e!=g.LockupBacking.SVGBackground?e==g.LockupBacking.None:i.isSVGIncluded(t,i.shapeLibraryDataStructures.DisplayOrderForAutoLayoutShapesByCategory))}}}),i)},"36r7":function(e,t,o){var n,r,i=t,a=o("oAGj"),l=o("7siz"),s=o("iCxV"),u=o("Q+4n"),c=o("oKlP"),h=o("1NAc");i.View=(n=function(e,t,o,n,r){void 0===e&&(e=!0),void 0===t&&(t=!1),void 0===o&&(o=1),void 0===n&&(n=c.TheoPoint.ZERO),void 0===r&&(r=h.TheoSize.Zero),this.fit=e,this.fill=t,this.scale=o,this.offset=n,this.viewSize=r},a.defineClass({name:"View",ctor:n,superName:"CoreObject"}),n),i.IViewModel=a.defineProtocol("IViewModel",{getFit:"() -> Boolean",getFill:"() -> Boolean",getScale:"() -> Double",getOffset:"() -> TheoPoint",getViewSize:"() -> TheoSize",getMargin:"() -> Double",getPanInsets:"() -> TheoInsets"}),i.IMutableViewModel=a.defineProtocol("IMutableViewModel",{setFit:"(Boolean) -> Void",setFill:"(Boolean) -> Void",setScale:"(Double) -> Void",setOffset:"(TheoPoint) -> Void",setViewSize:"(TheoSize) -> Void"}),i.ViewState=(r=function(e){void 0===e&&(e=null),this.view=null!=e?new i.View(e.fit,e.fill,e.scale,e.offset,e.viewSize):new i.View},a.defineClass({name:"ViewState",ctor:r,superName:"EditorStateMember",statics:{_implements:function(e){return"IMutableViewModel"==e||"IViewModel"==e}},props:{clone:function(){return new r(this.view)},diff:function(e){return this.view.fit==e.view.fit&&this.view.fill==e.view.fill&&this.view.scale==e.view.scale&&this.view.offset==e.view.offset&&this.view.viewSize==e.view.viewSize?[]:[l.EditorModelChangedMessage.CHG_VIEW_STATE]},getFit:function(){return this.view.fit},getFill:function(){return this.view.fill},getScale:function(){return this.view.scale},getOffset:function(){return this.view.offset},getViewSize:function(){return this.view.viewSize},getMargin:function(){var e;return((e=a.opt(s.Host.platform,(function(e){return e.isMobile})))||null!=e)&&e?0:80},getPanInsets:function(){var e;return((e=a.opt(s.Host.platform,(function(e){return e.isMobile})))||null!=e)&&e?u.TheoInsets.Zero:new u.TheoInsets(0,313,0,280)},setFit:function(e){this.beforeChange(),this.view.fit=e,this.view.fill=!1,this.afterChange()},setFill:function(e){this.beforeChange(),this.view.fill=e,this.view.fit=!1,this.afterChange()},setScale:function(e){this.beforeChange(),this.view.scale=e,this.afterChange()},setOffset:function(e){this.beforeChange(),this.view.offset=e,this.afterChange()},setViewSize:function(e){this.beforeChange(),this.view.viewSize=e,this.afterChange()}}}),r)},"3UhB":function(e,t,o){var n,r=t,i=o("oAGj"),a=o("6h7+"),l=o("kYI4"),s=o("gXiO"),u=o("ascj"),c=o("FNB+"),h=o("QgZx"),d=o("6Rk9"),g=o("53P9"),p=o("iCxV"),f=o("8vXU"),m=o("rxGp"),y=o("fNpk"),v=o("c+uM"),S=o("KdeS"),C=o("mGL3"),T=o("enh0"),A=o("Vm85"),F=o("VJ9E"),k=o("8t9B"),L=o("uUew"),b=o("sIWg");r.TypeLockupUtils=(n=function(){s.CoreObject.call(this)},i.defineClass({name:"TypeLockupUtils",ctor:n,superName:"CoreObject",statics:{measurementResizeCache_:null,enableMeasurementResizeCache:function(){n.measurementResizeCache_={}},disableMeasurementResizeCache:function(){n.measurementResizeCache_=null},replaceFontsInDocument:function(e,t){var o=p.Host.textModelUtils.defaultFont(),r=n.createTheoFont(o,null);e.visitAll(c.FormaTraversal.PreOrder,(function(e){if(e.style instanceof v.LockupStyle){var o,n=!1,a=e.style,l=i.opt(a.font,(function(e){return e.fontData.postScriptName}));null!=l&&t.includes(l)&&(a.font=r,n=!0);for(var s=i.iter(a.characterStyles);!s.done;s.next()){var u=s.value;if(null!=u.font){var c=i.opt(u.font,(function(e){return e.fontData.postScriptName}));null!=c&&t.includes(c)&&(u.font=r,n=!0)}}n&&(o=i.as(e.controller,k.TypeLockupController))&&o.styleChanged()}}))},fontsInDocument:function(e){var t=new C.OrderedFontSet;return e.visitAll(c.FormaTraversal.PreOrder,(function(e){var o;(o=i.as(e,T.TextForma))&&t.append(o.fontDescriptor)})),t},sizesInDocument:function(e,t,o){void 0===t&&(t=null),void 0===o&&(o=!1);var n=[];return e.visitAll(c.FormaTraversal.PreOrder,(function(e){var r;if((r=i.as(e,T.TextForma))&&r.lockupForma!=t&&!(o&&r.rowIndex>0)){var a=r.fontSize*r.lockupForma.placement.extractedScale.scale.x;n.includes(a)||n.push(a)}})),i.sortInPlace(n),n},userFontSizesInDocument:function(e,t,o){void 0===t&&(t=null),void 0===o&&(o=!1);var r=[];return e.visitAll(c.FormaTraversal.PreOrder,(function(e){var a,l;(a=i.as(e,T.TextForma))&&a.lockupForma!=t&&null!=(l=n.userFontSizeForTextForma(a,o))&&(r.includes(l)||r.push(l))})),i.sortInPlace(r),r},userFontSizeForTextForma:function(e,t){if(void 0===t&&(t=!1),!(t&&e.rowIndex>0)){var o=e.fontSize*e.lockupForma.placement.extractedScale.scale.x;return A.TextFacade.toUserFontSize(o,e.page)}return null},applyFontToController:function(e,t){var o=this,n=e.fontData;n.availability==h.FontAvailability.LOADED?(a.BadgeFacade.logFontChange(i.opt(t.styleController.forma,(function(e){return e.source})),e.fontData.postScriptName),t.styleController.targetedLockupStyle.font=e,null!=e.sparkElementID?l.BrandingFacade.brandDocumentForElement(t.forma.page.document,e.sparkElementID,l.AUTHORING_CONTEXT_TYPE_FONT):l.BrandingFacade.unBrandDocumentIfNoBrandedElements(t.forma.page.document),t.styleController.targetedLockupStyle!==t.styleController.forma.style&&(e.isEqual(t.styleController.forma.style.font)&&(t.styleController.targetedLockupStyle.font=null),t.styleChanged())):n.availability==h.FontAvailability.LOADABLE&&p.Host.fontProvider.loadFont(n,(function(){return o.applyFontToController(e,t)}),(function(){return p.Host.logging.logForCategory(m.LogCategories.kFont,"applyFontToController, Failed to load font",f.LogLevelEnum.WARN_LEVEL)}))},createTheoFont:function(e,t){if(null!=t)for(var o=i.iter(t.fonts);!o.done;o.next()){var n=o.value;if(null!=n.descriptor&&n.descriptor.isEqual(e))return F.TheoFont.init_a314(n)}return F.TheoFont.init_9e5c(e)},getFontDescriptorFromPostScriptName:function(e,t){var o,n;return(o=i.opt(p.Host.fontProvider,(function(t){return t.getIncludedFonts(e.page.document)})))&&null!=(n=o.getIndexOfPostScriptName(t))?o.fontAt(n):null},calculateFontRole:function(e,t){var o,r,a=null;if(null!=e){var l=n.createTheoFont(e,t);a=l.getSparkFontRole(),i.isEmpty((o=a)||null!=o?o:"")&&l.hasSparkFontRole("custom")&&(a="custom")}return i.isEmpty((r=a)||null!=r?r:"")?"":a},calculateFaceWithHighestRole:function(e,t){for(var o=["headline-font","body-font","body-font-italic","body-font-bold","body-font-bold-italic","secondary-font","custom"],r=null,a="",l=i.iter(e);!l.done;l.next()){var s=l.value,u=n.calculateFontRole(s,t);if(0==i.isEmpty(u)){var c=i.indexOf(o,u);null!=c&&(i.isEmpty(a)||c<i.indexOf(o,a))&&(a=u,r=s)}}return r},isLTRCharacter:function(e){return e>="A"&&e<="Z"||e>="a"&&e<="z"||e>=""&&e<=""||e>=""&&e<=""||e>=""&&e<=""||e>=""&&e<=""||e>=""&&e<=""||e>=""&&e<=""||e>=""&&e<=""||e>=""&&e<=""},isRTLCharacter:function(e){return e>=""&&e<=""||e>=""&&e<=""||e>=""&&e<=""},isTextRightToLeft:function(e){for(var t=0,o=0,r=i.iter(i.chars(e));!r.done;r.next()){var a=r.value;n.isLTRCharacter(a)?t+=1:n.isRTLCharacter(a)&&(o+=1)}return o>0&&o>t},canBreakAnywhere:function(e){return e>=""&&e<=""||e>=""&&e<=""||e>=""&&e<=""},isWhiteSpace:function(e){for(var t=i.iter(i.chars(e));!t.done;t.next()){var o=t.value;if(!n.isWhiteSpace(o))return!1}return!0},isWhiteSpace:function(e){return e>="\t"&&e<="\r"||" "==e||""==e||""==e||""==e||e>=""&&e<=""||"\u2028"==e||"\u2029"==e||""==e||""==e||""==e},iskinsokuBefore:function(e){return"!"==e||")"==e||"."==e||":"==e||";"==e||"?"==e||""==e||""==e||""==e||""==e||""==e||""==e||""==e||""==e||""==e||""==e||""==e||""==e||""==e||""==e||""==e||""==e||""==e||""==e||""==e||""==e||""==e||""==e||""==e||""==e},iskinsokuAfter:function(e){return"("==e||"["==e||"{"==e||""==e||""==e||""==e||""==e||""==e||""==e||""==e||""==e||""==e||""==e||""==e||""==e||""==e},lineBreaks:function(e,t,o){for(var r=0,a=0,l=!1,s=!0,u=i.iter(i.chars(e));!u.done;u.next()){var c=u.value;n.iskinsokuBefore(c)?s=!0:n.iskinsokuAfter(c)?(r!=a&&s&&(t.push(new L.TextRange(r,a)),r=a),l=c.charCodeAt(0)>=12288,s=!1):n.canBreakAnywhere(c)?(r!=a&&s&&(t.push(new L.TextRange(r,a)),r=a),l=!0,s=!0):n.isWhiteSpace(c)?(r!=a&&t.push(new L.TextRange(r,a)),"\n"==c&&o&&t.push(new L.TextRange(a,a+1)),r=a+1,l=!1,s=!0):l&&s?(r!=a&&(t.push(new L.TextRange(r,a)),r=a),l=!1,s=!0):(l=!1,s=!0),a+=1,c.charCodeAt(0)>65535&&(a+=1)}r!=a&&t.push(new L.TextRange(r,a))},getBreakRanges:function(e){var t=[];return n.lineBreaks(e,t,!0),t},getWordRanges:function(e,t){var o=[];if(n.lineBreaks(e,o,!1),L.TextRange.makeRangesContiguous(o),1==o.length){o.splice(0);for(var r=0,a=-1,l=-1,s=-1,u=0,c=!0,h=i.clone(g.GraphemeUtils.splitGraphemes(e)),d=i.iter(h);!d.done;d.next()){var p=d.value,f=p.toLowerCase()!=p;f&&!c&&(o.push(new L.TextRange(u,r)),u=r),c=f,r+=1,"."==p?(o.push(new L.TextRange(u,r)),u=r,-1==a&&(a=r),l=r,s=o.length-1,c=!0):"/"==p&&(o.push(new L.TextRange(u,r-1)),o.push(new L.TextRange(r-1,r)),u=r)}o.push(new L.TextRange(u,h.length)),((t==k.HighlightMethod.Bracket||t==k.HighlightMethod.InsideBracket)&&-1!=a&&-1!=l||-1!=a&&a==l)&&(o[s]=new L.TextRange(o[s].start,l-1),o[s+1]=new L.TextRange(l-1,o[s+1].end))}return o},computeLockupMeasurements:function(e,t,o,r,a,l,s,u,c,h){var d;if(void 0===c&&(c=1),void 0===h&&(h=!1),d=i.opt(n.measurementResizeCache_,(function(t){return t[e]})))return d;for(var f=t,m=32*o,y=32*f.spaceWidthRatio/m,v=a,C=h,T=r?e.toUpperCase():e,A=n.isTextRightToLeft(T),F=n.getBreakRanges(T),_=[],R=null!=u[k.TypeLockupController.HIGHLIGHT_STYLE]&&null!=u[k.TypeLockupController.HIGHLIGHT_STYLE].font,I=i.iter(F);!I.done;I.next()){var w=I.value,D=w,x="",P=!1;v=a,C=h;for(var E=i.iter(s);!E.done;E.next()){var M=E.value;(w.start>=M.start&&w.start<M.end||w.start<=M.start&&w.end>=M.start)&&((M.end<w.end||M.start>w.start)&&(v=!0,C=!0),x=k.TypeLockupController.HIGHLIGHT_STYLE),w.end!=M.end&&w.end!=M.end-1&&w.end!=M.start&&w.end!=M.start-1||(P=!0)}var N=32;f=""!=x&&null!=u[x]&&null!=u[x].font?u[x].font.fontData:t,""!=x&&null!=u[x]&&(N=32*c);var G=e.substr(w.start,w.length);A&&"\n"!=G&&(G=""+G);var B=r?G.toUpperCase():G;if(w.end<e.length)for(var O=e.substr(w.end),U=0,H=i.iter(i.chars(O));!H.done;H.next()){var z=H.value;if(!n.isWhiteSpace(z)&&"\n"!=z){0==U&&(y=0);break}if((R||1!=c)&&P){var Y=32*c*(i.opt(u[k.TypeLockupController.HIGHLIGHT_STYLE].font,(function(e){return e.fontData}))||t).spaceWidthRatio/m;y=(32*t.spaceWidthRatio/m+Y)/2}else y=N*f.spaceWidthRatio/m;U+=1,D=new L.TextRange(w.start,w.end+U)}else y=N*f.spaceWidthRatio/m;if(v&&!A){var W=0,V=N*l/m,K=i.clone(p.Host.textModelUtils.getGlyphPositions(B,t,32,!C)),X=i.opt(i.opt(u[k.TypeLockupController.HIGHLIGHT_STYLE],(function(e){return e.font})),(function(e){return e.fontData}))||t,j=null;null!=u[k.TypeLockupController.HIGHLIGHT_STYLE]&&(j=i.clone(p.Host.textModelUtils.getGlyphPositions(B,X,32*c,!C)));for(var q=i.clone(K),Z=i.clone(g.GraphemeUtils.splitGraphemes(B)),J=i.iter(Z);!J.done;J.next()){var Q=J.value,$=new L.TextRange(W+w.start,W+w.start+1);x="";for(var ee=i.iter(s);!ee.done;ee.next())M=ee.value,$.start>=M.start&&$.start<M.end&&(x=k.TypeLockupController.HIGHLIGHT_STYLE);""!=x&&null!=u[x]?(N=32*c,q=i.clone(j)):(N=32,q=i.clone(K)),""!=x&&null!=u[x]&&null!=u[x].font?f.isEqual(X)||(f=X):f.isEqual(t)||(f=t);var te=p.Host.textModelUtils.measureBoundsForLayout(Q,f,N,0),oe=(Y=(q[W+1]-q[W]-te.width)/m+V,!1);W==Z.length-1&&(Y=y,V>0&&(Y+=2*V),oe=!0);var ne=""!=x&&null!=u[x]&&-1!=u[x].spacing&&0!=u[x].spacing?c:1,re=new S.LockupWordInfo(Q,te.width/m,Y,x,ne,G.includes("\n"),oe,$);_.push(re),W+=1}}else{var ie=p.Host.textModelUtils.measureBoundsForLayout(B,f,N,l);0!=l&&(ie=new b.TheoRect(ie.minX,ie.minY,ie.maxX-0,ie.maxY),V=N*l/m,0==y?y=V:l>0&&(y+=2*V));var ae=""!=x&&null!=u[x]&&-1!=u[x].spacing&&0!=u[x].spacing?c:1;if(re=new S.LockupWordInfo(G,ie.width/m,y,x,ae,G.includes("\n"),!0,D),""!=x&&null!=u[x]&&-1!=u[x].spacing&&0!=u[x].spacing&&u[x].lineBreakAtCharacterStyleSizeChange&&i.opt(i.last(_),(function(e){return""==e.characterStyle}))&&!G.includes("\n")){var le=new S.LockupWordInfo("\n",0,0,x,ae,!0,!0,new L.TextRange(w.start,w.start));_.push(le)}if(_.push(re),""!=x&&null!=u[x]&&-1!=u[x].spacing&&0!=u[x].spacing&&u[x].lineBreakAtCharacterStyleSizeChange&&P&&!G.includes("\n")){var se=new S.LockupWordInfo("\n",0,0,x,ae,!0,!0,new L.TextRange(w.end,w.end));_.push(se)}}}return null!=n.measurementResizeCache_&&(n.measurementResizeCache_[e]=i.clone(_)),_},getLockupStringsForRoot:function(e){var t=[];return e.visitAll(c.FormaTraversal.PreOrder,(function(e){var o=i.as(e.controller,k.TypeLockupController);null!=o&&t.push(o.text)})),t},getFullCanvasLockups:function(e){var t=[];return e.visitAll(c.FormaTraversal.PreOrder,(function(e){if(e.style instanceof v.LockupStyle&&e.style.backing==v.LockupBacking.Knockout){var o=i.as(e.controller,k.TypeLockupController);null!=o&&t.push(o)}})),t},getNewCharSelectionRange:function(e,t,o){for(var n=t,r=e,a=new L.TextRange(0,0),l=i.iter(o);!l.done;l.next()){var s=l.value;e.start>=s.start&&e.end<=s.end&&(r=s),t.start>=s.start&&t.end<=s.end&&(a=s)}if(r.start==a.start&&r.end==a.end){if(t.end<=e.start&&0!=a.length)return new L.TextRange(a.start,t.end);if(t.end<=a.end&&e.end<=t.start)return new L.TextRange(t.start,a.end);if(t.start==e.start&&t.end==e.end)return new L.TextRange(a.start,a.end)}return r.start<t.start?n=new L.TextRange(r.start,t.end):r.end>t.end&&(n=new L.TextRange(t.start,r.end)),n},rangesAreEqual:function(e,t){if(e.length!=t.length)return!1;for(var o=i.iter(i.toSequence(e));!o.done;o.next()){var n=o.value,r=n.offset,a=n.element;if(a.start!=t[r].start||a.end!=t[r].end)return!1}return!0},adjustRanges:function(e,t,o){for(var r=0,a=!1,l=i.clone(e),s=i.iter(i.toSequence(e));!s.done;s.next()){var u=s.value,c=u.offset,h=u.element;t.start>=h.start&&t.start<h.end?(r=o-t.length,a=!0,h.end+r<h.start||t.end>h.end?l[c]=new L.TextRange(h.start,h.start):l[c]=new L.TextRange(h.start,h.end+r)):t.start<h.start&&t.end>h.start?(t.end<h.end?l[c]=new L.TextRange(t.start+o,h.end-t.end+t.start+o):l[c]=new L.TextRange(h.start,h.start),a||(r=o-t.length,a=!0)):0!=r&&(l[c]=new L.TextRange(h.start+r,h.end+r)),!a&&t.end<=h.start&&(r=o-t.length,a=!0,l[c]=new L.TextRange(h.start+r,h.end+r))}return a?n.cleanupAndMerge(l):l},cleanupAndMerge:function(e){for(var t=[],o=i.iter(i.toSequence(e));!o.done;o.next()){var n=o.value,r=n.offset,a=n.element;if(0!=a.length){y.LegacyCoreAssert.isTrue(a.start<a.end,"cleanupAndMerge - bad range",void 0,"TypeLockupUtils.cleanupAndMerge","TypeLockupUtils.swift",864);var l=t.length-1;if(t.length>0&&a.start<=t[l].end){var s=Math.max(a.end,t[l].end);t[l]=new L.TextRange(t[l].start,s)}else t.push(e[r])}}return t},invertRanges:function(e,t){for(var o=[],n=0,r=i.iter(e);!r.done;r.next()){var a=r.value;if(0!=a.start&&o.push(new L.TextRange(n,a.start)),(n=a.end)>t){y.LegacyCoreAssert.fail("invertRanges range beyond maxRangeEnd.",{start:a.start,end:a.end,max:t},"TypeLockupUtils.invertRanges","TypeLockupUtils.swift",887);break}}return n<t&&o.push(new L.TextRange(n,t)),o},getCharFontAdjust:function(e,t,o){void 0===o&&(o=!0);var n=1,r=k.TypeLockupController.HIGHLIGHT_STYLE,a=e.font.fontData,l=i.opt(i.opt(e.characterStyles[r],(function(e){return e.font})),(function(e){return e.fontData}));return null!=e.characterStyles[r]&&-1!=e.characterStyles[r].spacing&&0!=e.characterStyles[r].spacing?(n=e.characterStyles[r].spacing,o&&n>1&&(n=1/n)):null!=l&&(n=t||a.capRatio==a.meanRatio||l.capRatio==l.meanRatio?a.capRatio/l.capRatio:a.meanRatio/l.meanRatio),n},getCharFontYAdjust:function(e,t,o){var n=0,r=k.TypeLockupController.HIGHLIGHT_STYLE;if(null==e.characterStyles[r])return y.LegacyCoreAssert.isTrue(t==o,"getCharFontYAdjust - charFontSize should match fontSize if no character style!",void 0,"TypeLockupUtils.getCharFontYAdjust","TypeLockupUtils.swift",931),n;var a=e.font.fontData,l=i.opt(i.opt(e.characterStyles[r],(function(e){return e.font})),(function(e){return e.fontData}));return null!=l?(n=t*a.capRatio-t*a.baselineOffsetRatio-(o*l.capRatio-o*l.baselineOffsetRatio),e.characterStyles[r].alignment==v.LockupAlignment.Center?n-=(a.capRatio*t-l.capRatio*o)/2:e.characterStyles[r].alignment==v.LockupAlignment.Right&&(n-=a.capRatio*t-l.capRatio*o)):t!=o&&(n=t*a.capRatio-t*a.baselineOffsetRatio-(o*a.capRatio-o*a.baselineOffsetRatio),e.characterStyles[r].alignment==v.LockupAlignment.Center?n-=(a.capRatio*t-a.capRatio*o)/2:e.characterStyles[r].alignment==v.LockupAlignment.Right&&(n-=a.capRatio*t-a.capRatio*o)),n},sortTextFormae:function(e){var t,o=i.clone(e);return i.sortInPlace(o,(function(e,o){if(e.lockupForma==o.lockupForma)return e.rangeInLockup.start<o.rangeInLockup.start;var n,r,a,l,s,u,c,h;if((n=e.lockupForma)&&(r=o.lockupForma)&&(a=n.finalFrame)&&(l=r.finalFrame)&&(s=n.parent)&&null!=(u=s.indexOfChild(n))&&(c=r.parent)&&null!=(h=c.indexOfChild(r))){if(n!=r&&d.GeometryFacade.formaBoundsIntersect(n,r))return u<h;var g=.5*((t=i.opt(i.as(n.controller,k.TypeLockupController),(function(e){return e.averageLineHeight})))||null!=t?t:0);return a.minY-l.minY<-g||!(a.minY-l.minY>g)&&a.minX<l.minX}return!1})),o},formaForSameTextRun:function(e,t){return e.lockupForma==t.lockupForma&&e.rangeInLockup.start==t.rangeInLockup.start&&e.text==t.text},padTextFormaeForLetterAnimation:function(e,t){for(var o=[],r=!1,a=i.iter(i.toSequence(e));!a.done;a.next()){var l=a.value,s=l.offset,u=l.element;if(r)r=!1;else{var c,h=u.text.length+1==u.rangeInLockup.length,d=t&&h?1:0,g=u.text.length+d;if((c=i.as(i.opt(u.lockupForma,(function(e){return e.style})),v.LockupStyle))&&v.LockupStyle.isDuplicateFormaLook(c.textLook)&&s+1<e.length){var p=e[s+1];if(n.formaForSameTextRun(u,p)){for(var f=i.iter(i.range(0,g,!0));!f.done;f.next())o.push(u),o.push(p);r=!0;continue}}r=!1;for(var m=i.iter(i.range(0,g,!0));!m.done;m.next())o.push(u)}}return o},leftSingleQuote:"",rightSingleQuote:"",leftDoubleQuote:"",rightDoubleQuote:"",doubleStraightQuote:'"',singleStraightQuote:"'",isSingleCurlyQuote:function(e){return e==n.leftSingleQuote||e==n.rightSingleQuote},isDoubleCurlyQuote:function(e){return e==n.leftDoubleQuote||e==n.rightDoubleQuote},isCurlyQuote:function(e){return n.isSingleCurlyQuote(e)||n.isDoubleCurlyQuote(e)},isStraightQuote:function(e){return e==n.doubleStraightQuote||e==n.singleStraightQuote},isInteger:function(e){return e>="0"&&e<="9"},isLetter:function(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"},getLeftCurlyQuoteForStraightQuote:function(e){return e==n.singleStraightQuote?n.leftSingleQuote:n.leftDoubleQuote},getRightCurlyQuoteForStraightQuote:function(e){return e==n.singleStraightQuote?n.rightSingleQuote:n.rightDoubleQuote},fixUpQuotes:function(e,t){if(e.length==t.length){for(var o=i.iter(i.toCharSequence(e));!o.done;o.next()){var r=o.value.element;if(n.isCurlyQuote(r))return e}for(var a=i.iter(i.toCharSequence(t));!a.done;a.next()){var l=a.value.element;if(n.isCurlyQuote(l))return e}}for(var s=i.chars(e),u=!1,c=0,h=i.iter(i.toCharSequence(e));!h.done;h.next()){var d=h.value,g=d.offset,p=d.element,f=" ",m=" ",y=" ",v=" ";if(g-1>=0&&(f=s[g-1]),g+1<s.length&&(m=s[g+1]),g+2<s.length&&(y=s[g+2]),g+3<s.length&&(v=s[g+3]),n.isStraightQuote(p)){if(p==n.singleStraightQuote){if(("s"==m||"S"==m)&&" "==y){s[g]=n.rightSingleQuote;continue}if("s"!=f&&"S"!=f||" "!=m||(s[g]=n.rightSingleQuote),n.isLetter(f)&&n.isLetter(m)&&(" "==y||" "==v)){s[g]=n.rightSingleQuote;continue}if(" "==f&&n.isInteger(m)&&n.isInteger(y)&&" "==v){s[g]=n.leftSingleQuote;continue}}if(!u&&n.isInteger(f))continue;if(!u&&" "==f){u=!0,c=g;continue}if(u&&" "==m){p==s[c]&&(u=!1,s[c]=n.getLeftCurlyQuoteForStraightQuote(s[c]),s[g]=n.getRightCurlyQuoteForStraightQuote(p));continue}}}return s.join("")},fixUpColors:function(e,t){var o;void 0===t&&(t=null);var r=e.colors.colorID(u.ColorRole.FieldPrimary),i=(o=t)||null!=o?o:e.colors.colorID(u.ColorRole.FieldSecondary),a=e.colors.colorID(u.ColorRole.Border),l=e.colors.colorID(u.ColorRole.Shadow);if(null==a||null==l){null==a&&(a=n.getColorIDForBorder(e.textLook,r,i)),null==l&&(l=n.getColorIDForShadow(e.textLook,r,i));var s=e.textLook;v.LockupStyle.isKnockoutLook(s)&&s!=v.LockupTextLook.KnockoutOnly?(a==i&&(a=r),s==v.LockupTextLook.KnockoutAndShadow&&l==i&&(l=r)):v.LockupStyle.isOutlineLook(s)&&s!=v.LockupTextLook.OutlineOnly&&(a==r&&(a=i),l==r&&(l=i))}e.colors.setColorIDs([{key:u.ColorRole.FieldSecondary,value:i},{key:u.ColorRole.Border,value:a},{key:u.ColorRole.Shadow,value:l}],!1)},getColorIDForBorder:function(e,t,o){return e==v.LockupTextLook.KnockoutAndOutline||e==v.LockupTextLook.KnockoutAndShadow?t:o},getColorIDForShadow:function(e,t,o){return e==v.LockupTextLook.KnockoutAndShadow?t:o}}}),n)},"3nOH":function(e,t,o){var n,r=t,i=o("oAGj"),a=o("Nk+Q"),l=o("CMNw"),s=o("UUXZ"),u=o("PSFa"),c=o("JzRL"),h=o("elwG"),d=o("qUXk"),g=o("u+mS"),p=o("eLsM"),f=o("hsXA"),m=o("JU+l"),y=o("aKgf");r.MultiSelectionDesignController=(n=function(e,t){d.DesignController.call(this),this.handles=new f.StandardHandlesHandler(e,t,this),this.drag=new g.MultiObjectDragHandler(e,t,this),this.click=new h.StandardClickHandler(e),this.resize=new m.MultiObjectResizeHandler(e,t,e.selection.asFormaArray(),this),this.actions=new l.StandardActionHandler(e),this.attributes=new u.StandardAttributesHandler(e),this.featureSets=new p.StandardFeatureSetHandler(e),this.actionFeedback=new a.StandardActionFeedbackHandler(t),this.annotations=new s.StandardAnnotationsHandler(t),this.view=new y.StandardViewHandler(e,t),this.activePage=new c.StandardActivePageHandler(e,t)},i.defineClass({name:"MultiSelectionDesignController",ctor:n,superName:"DesignController"}),n)},"3v9D":function(e,t,o){var n,r,i,a,l=t,s=o("oAGj"),u=o("CaSj"),c=o("FNB+"),h=o("6ZWm"),d=o("tQF8"),g=o("TP4q"),p=o("v/sv"),f=o("bSZx"),m=o("4mVB"),y=o("iCxV"),v=o("fNpk"),S=o("Dq5S"),C=o("uxH+"),T=o("8t9B"),A=o("ThKb"),F=o("sIWg");l.LayoutSuggester=(n=function(){this.scoringWeights_=null,this.layoutTypeModel_=null,this.group_=null},s.defineClass({name:"LayoutSuggester",ctor:n,superName:"CoreObject",statics:{KIND:{get:function(){return"LayoutSuggester"}},createContentAwareSuggestions:function(e){var t;return(t=s.opt(s.as(e.controller,C.RootController),(function(e){return e.getGridController()})))?n.init_abc1(t.gridForma).createSuggestions(!0,!1,!1):[]}},props:{init_abc1:function(e,t){void 0===t&&(t=null);var o=s.clone(e.filterWithCallback((function(e){return e.isBackgroundImage()}),c.FormaTraversal.JustChildren)),n=s.clone(e.filterWithCallback((function(e){return null!=e.controller&&e.controller.floating}),c.FormaTraversal.JustChildren));this.layoutItems_=o.map((function(e){return[S.LayoutItem.init_b14a(e)]}),this),this.imageCount_=this.layoutItems_.length;var r=n.map((function(e){return S.LayoutItem.init_b14a(e)}),this);this.layoutItems_.push(r),this.floatingCount_=r.length,v.LegacyCoreAssert.isTrue(null!=e.parent,"group to suggest layout for does not have a parent",void 0,"LayoutSuggester.init","LayoutSuggester.swift",40),this.scoringWeights_=s.clone(t),this.gridFrame_=e.frame,this.group_=e},init_cb42:function(e,t){void 0===t&&(t=null),this.layoutItems_=[];for(var o=[],n=s.iter(e.layoutItems);!n.done;n.next()){var r=n.value;r.type==S.ItemContentType.Image&&this.layoutItems_.push([r]),r.type==S.ItemContentType.Floating&&o.push(r)}this.imageCount_=this.layoutItems_.length,this.floatingCount_=o.length,this.layoutItems_.push(o),this.scoringWeights_=s.clone(t),this.gridFrame_=e.gridFrame},layoutTypeModel:{get:function(){return this.layoutTypeModel_},set:function(e){this.layoutTypeModel_=e}},createSuggestions:function(e,t,o,n,r){if(void 0===e&&(e=!0),void 0===t&&(t=!1),void 0===o&&(o=!0),void 0===n&&(n=!1),void 0===r&&(r=1),this.imageCount_<1)return[];var i=[];return e&&s.append(i,this.createContentAwareSuggestions(o,r,n)),t&&s.append(i,this.createFixedGridSuggestions(o,r)),s.sortInPlace(i,(function(e,t){return e.score>t.score})),i},createEqualSizeSuggestions:function(e,t){return void 0===e&&(e=!0),void 0===t&&(t=1),this.imageCount_<1?[]:this.getEqualSizeGridSuggestions(e,t)},createFixedGridSuggestions:function(e,t){void 0===t&&(t=1);var o=this;if(this.imageCount_<1)return[];for(var n=s.clone(e&&this.floatingCount_>=1?this.layoutItems_:this.layoutItems_.slice(0,this.imageCount_)),r=n.length,i=s.clone(u.DesignSuggester.getPermutations(r,350)),a=null,l=-1e6,c=s.toArray(s.range(1,r,!0)).map((function(e){return o.getFixedGrids(r,e,!1)}),this),h=s.toArray(s.range(1,r,!0)).map((function(e){return o.getFixedGrids(r,e,!0)}),this),d=s.iter(i);!d.done;d.next()){var g=d.value.map((function(e){return n[e]}),this),p=this.fillFixedGrids(r,[c,h],g);p.score>l&&(a=p.suggestion,l=p.score)}return[a]},getEqualSizeGridSuggestions:function(e,t){void 0===t&&(t=1);for(var o=s.clone(e&&this.floatingCount_>=1?this.layoutItems_:this.layoutItems_.slice(0,this.imageCount_)),n=o.length,r=[],i=s.iter(s.range(1,n,!0));!i.done;i.next()){var a=i.value,l=a;if(n%a==0){var c=s.toInt(n/a),h=s.clone(this.getGrids(l,c)),d=s.clone(u.DesignSuggester.getPermutations(n,1))[0].map((function(e){return o[e]}),this),p=d.map((function(e){return e[0]}),this),m=this.createGridStyle(h,d,"equal_size_layout_"+l+"_"+c),y=new g.GridScore(m,this.gridFrame_,p,null,!1,this.scoringWeights_),v=new f.GridSuggestion(void 0,m,y);r.push(v)}}return s.sortInPlace(r,(function(e,t){return e.score>t.score})),r.slice(0,Math.min(r.length,t))},getGrids:function(e,t){for(var o=1/s.toDouble(e),n=1/s.toDouble(t),r=[],i=s.iter(s.range(0,e,!1));!i.done;i.next())for(var a=i.value,l=s.iter(s.range(0,t,!1));!l.done;l.next()){var u=l.value,c=s.toDouble(a)*o,h=s.toDouble(u)*n,g=s.toDouble(a+1)*o,p=s.toDouble(u+1)*n;r.push(new d.GridCell(new F.TheoRect(c,h,g,p)))}return r},createContentAwareSuggestions:function(e,t,o){if(void 0===t&&(t=1),void 0===o&&(o=!1),this.imageCount_<1)return[];for(var n=s.clone(e&&this.floatingCount_>=1?this.layoutItems_:this.layoutItems_.slice(0,this.imageCount_)),r=n.length,i=this.gridFrame_.aspectRatio,a=[],l=Math.max(200-25*r,25),c=s.clone(u.DesignSuggester.getPermutations(r,l)),h=[],d=[],g=[],p=[],f=[],m=[],y=s.iter(s.toSequence(c));!y.done;y.next()){var v=y.value,S=v.offset,C=v.element.map((function(e){return n[e]}),this),T=this.generateContentAwareGrids(r,C,i,o);s.append(h,T.heights),s.append(d,T.widths),s.append(g,T.scores),s.append(p,T.orders),s.append(f,T.flipDimensions);for(var A=s.iter(s.range(0,T.scores.length,!1));!A.done;A.next())m.push(S)}for(var F=s.sort(g),k=0;a.length<t&&k<F.length;){for(var L=F[F.length-1-k],b=s.indexOf(g,L),_=s.clone(c[m[b]]).map((function(e){return n[e]}),this),R=s.clone(h[b]),I=s.clone(p[b]),w=s.clone(d[b]),D=f[b],x=R.map((function(e){return 1/e}),this),P=this.buildBestContentAwareGrid(_,w,i,I,D,x,o),E=1,M=s.iter(a);!M.done;M.next()){var N=M.value;if((E=Math.min(E,N.gridStyle.similarity(P.gridStyle)))<.05)break}E>.05&&a.push(P),k+=1}return a},createGridStyle:function(e,t,o){var n=m.GridStyle.init_bf40(o,void 0,e),r=s.clone(this.getGridCellFormaMapping(e,t));return n.forma=this.group_,n.setFormaMapping(r),n},getGridCellFormaMapping:function(e,t){for(var o={},n=s.iter(s.toSequence(t));!n.done;n.next())for(var r=n.value,i=r.offset,a=r.element,l=s.iter(a);!l.done;l.next())o[l.value.id]=e[i];return o},fillFixedGrids:function(e,t,o){for(var n=null,r=-1e6,i=o.map((function(e){return e[0]}),this),a=s.iter(s.stride(0,e,1));!a.done;a.next())for(var l=a.value,u=s.iter(t);!u.done;u.next())for(var c=u.value,h=s.iter(c[l]);!h.done;h.next()){var d=h.value,p=this.createGridStyle(d,o,"Test Layout"),m=new g.GridScore(p,this.gridFrame_,i,null,!1,this.scoringWeights_),y=m.score;y>r&&(n=new f.GridSuggestion(void 0,p,m),r=y)}return{score:r,suggestion:n}},generateContentAwareGrids:function(e,t,o,n){for(var r=[],i=[],a=[],l=[],u=[],c=s.iter([!1,!0]);!c.done;c.next())for(var h=c.value,d=s.iter(s.stride(1,Math.min(6,e+1),1));!d.done;d.next()){for(var p=d.value,f=s.toArray(s.range(1,p,!0)).map((function(e){return s.toDouble(e)/s.toDouble(p)}),this),m=this.buildCellArray(f,t,h?1/o:o,void 0,h,void 0,n),y=s.clone(m.heights),v=s.clone(m.order),S=[],C=s.repeat(0,p),T=0;T<10;){var A=s.toArray(s.range(0,p,!1)).map((function(e){return 1/(s.toDouble(p)*s.toDouble(y[e]))+C[e]}),this),F=1/A.reduce((function(e,t){return e+t}),0);S=A.map((function(e){return e*F}),this);for(var k=!1,L=s.iter(s.range(0,S.length,!1));!L.done;L.next()){var b=L.value;S[b]<.1&&(C[b]+=.1,k=!0)}for(var _=0,R=s.iter(s.range(0,S.length,!1));!R.done;R.next()){var I=R.value;S[I]+=_,_=S[I]}if(S[S.length-1]=1,!k)break;T+=1}for(var w=this.buildCellArray(S,t,h?1/o:o,v,h,void 0,n),D=s.clone(w.heights),x=D.map((function(e){return 1/e}),this),P=this.buildCellArray(S,t,h?1/o:o,v,h,x,n),E=[],M=s.iter(t);!M.done;M.next()){var N=M.value;s.append(E,N)}var G=s.clone(this.getGridCellFormaMapping(P.cells,t)),B=new g.GridScore(void 0,this.gridFrame_,E,null,!0,this.scoringWeights_,G,P.cells);i.push(S),r.push(D),a.push(B.score),l.push(v),u.push(h)}var O=s.sort(a);return{widths:i,heights:r,orders:l,scores:a,flipDimensions:u,maxScore:O[O.length-1]}},buildBestContentAwareGrid:function(e,t,o,n,r,i,a){var l=this.buildCellArray(t,e,r?1/o:o,n,r,i,a),u=s.clone(l.cells),c=s.clone(this.snapBounds(u,this.gridFrame_.size,r)),d=this.createGridStyle(c,e,m.GridStyle.BALANCED_LAYOUT_NAME);d.cropType=a?h.CropType.FillFocus:h.CropType.FitBorder;for(var p=[],y=s.iter(e);!y.done;y.next()){var v=y.value;s.append(p,v)}var S=new g.GridScore(d,this.gridFrame_,p,null,!0,this.scoringWeights_);return new f.GridSuggestion(this.group_,d,S)},buildCellArray:function(e,t,o,n,r,i,a){var l,u,c;void 0===n&&(n=null),void 0===r&&(r=!1),void 0===i&&(i=null),void 0===a&&(a=!1);var h=null;null==n&&(h=[]);for(var g,p=s.repeat(0,e.length),f=[],m=0,y=s.iter(s.toSequence(t));!y.done;y.next()){var v=y.value,C=v.offset,T=v.element;if(null==n){var A=s.sort(p);g=s.indexOf(p,A[0]),h.push(g)}else g=n[C];var k,L,b=e[g];if(m=0==g?0:e[g-1],1==T.length&&T[0].type==S.ItemContentType.Image){var _=a&&null!=T[0].focusRegion?T[0].focusRegion.width:(l=T[0].width)||null!=l?l:1,R=a&&null!=T[0].focusRegion?T[0].focusRegion.height:(u=T[0].height)||null!=u?u:1;k=1/(r?s.toDouble(R)/s.toDouble(_):s.toDouble(_)/s.toDouble(R))*(b-m)*o}else{var I,w;if(null!=(I=s.opt(s.opt(s.opt(T[0].forma,(function(e){return e.parent})),(function(e){return e.bounds})),(function(e){return e.width})))&&null!=(w=s.opt(s.opt(s.opt(T[0].forma,(function(e){return e.parent})),(function(e){return e.bounds})),(function(e){return e.height})))){for(var D=0,x=s.iter(T);!x.done;x.next()){var P=x.value;D+=(c=s.opt(P.textInfo,(function(e){return e.textLength})))||null!=c?c:0}(k=this.getTextCellHeight(T.length,s.toDouble(D),m*I,b*I,I,w)/w)<.15&&(k=.15)}else k=(b-m)*o}null!=(L=s.opt(i,(function(e){return e[g]})))&&1-(k*=L)<.001&&(k=1);var E=null;E=r?new d.GridCell(new F.TheoRect(p[g],m,k+p[g],b)):new d.GridCell(new F.TheoRect(m,p[g],b,k+p[g])),f.push(E),p[g]=k+p[g]}return{cells:f,heights:p,order:null==h?n:h}},snapBounds:function(e,t,o,n){void 0===n&&(n=60);var r=e.map((function(e){return e.clone()}),this),i=[];e.forEach((function(e){return i.push(e)}));var a=[];if(o)for(var l=s.iter(s.range(0,i.length,!1));!l.done;l.next()){d=l.value,g=i[d],a.push(g);var u=g.bounds.maxX;if(u<1)for(var c=s.iter(s.range(d+1,i.length,!1));!c.done;c.next())if(y=c.value,v=(m=e[d]).bounds,Math.abs(m.bounds.maxX-u)*t.width<n&&1!=m.bounds.maxX&&m.bounds.maxX!=u&&(m=m.copyTo(new F.TheoRect(v.minX,v.minY,u,v.maxY)),i[y]=m),Math.abs(m.bounds.minX-u)*t.width<n&&0!=m.bounds.minX&&m.bounds.minX!=u&&(m=m.copyTo(new F.TheoRect(u,v.minY,v.maxX,v.maxY)),i[y]=m),m.bounds.width<.05)return r}else for(var h=s.iter(s.range(0,i.length,!1));!h.done;h.next()){var d=h.value,g=i[d];a.push(g);var p=g.bounds.maxY;if(p<1)for(var f=s.iter(s.range(d+1,i.length,!1));!f.done;f.next()){var m,y=f.value,v=(m=i[y]).bounds;if(Math.abs(m.bounds.maxY-p)*t.height<n&&1!=m.bounds.maxY&&m.bounds.maxY!=p&&(m=m.copyTo(new F.TheoRect(v.minX,v.minY,v.maxX,p)),i[y]=m),Math.abs(m.bounds.minY-p)*t.height<n&&0!=m.bounds.minY&&m.bounds.minY!=p&&(m=m.copyTo(new F.TheoRect(v.minX,p,v.maxX,v.maxY)),i[y]=m),m.bounds.height<.05)return r}}return a},getTextCellHeight:function(e,t,o,n,r,i){var a=.13358679,l=-.0261477,u=-.11470111,c=.03862264,h=-.02888805,d=.00561106,g=.03671017,p=.13522773,f=-.0499348,m=.02618676,y=1043.48108,v=3.14978552,S=1.15001079,C=167.10292,T=.639915899,A=.0844010175,F=.0901829377,k=.517425544,L=.44141582,b=78.7709665,_=248.39949567,R=2.99889961,I=1.20115851,w=260.27180508,D=.48002452,x=.27798828,P=.28644367,E=.49969626,M=.49655603,N=117.5756354,G=s.toDouble(this.floatingCount_),B=o,O=n,U=.6568033208493654;return U+=(i-y)/_*a,U+=(G-v)/R*l,U+=(s.toDouble(this.imageCount_)-S)/I*u,U+=(B-C)/w*c,U+=((1==e?1:0)-T)/D*h,U+=((3==e?1:0)-A)/x*d,U+=((e>3?1:0)-F)/P*g,U+=(s.toDouble(e)/G-k)/E*p,U+=((O-B)/r-L)/M*f,U+=(t-b)/N*m,U*=1e3},getFixedGrids:function(e,t,o){if(t>e)return[];for(var n=s.toArray(s.range(0,t,!0)).map((function(e){return s.toDouble(e+1)/s.toDouble(t)}),this),r=[s.repeat(1,t)],i=s.iter(s.range(t,e,!1));!i.done;i.next()){for(var a=[],l=s.iter(r);!l.done;l.next())for(var u=l.value,c=s.iter(s.range(0,t,!1));!c.done;c.next()){var h=c.value,g=u.concat();g[h]+=1,a.push(g)}r=s.clone(a)}s.shuffleInPlace(r),r=r.slice(0,Math.min(350,r.length));for(var p=[],f=s.iter(r);!f.done;f.next()){for(var m=f.value,y=[],v=s.iter(s.toSequence(m));!v.done;v.next())for(var S=v.value,C=S.offset,T=S.element,A=0==C?0:n[C-1],k=n[C],L=0,b=s.iter(s.stride(1,s.toDouble(T+1),1));!b.done;b.next()){var _=b.value;o?y.push(new d.GridCell(new F.TheoRect(L,A,_/s.toDouble(T),k))):y.push(new d.GridCell(new F.TheoRect(A,L,k,_/s.toDouble(T)))),L=_/s.toDouble(T)}p.push(y)}return p},createLayoutIdFeatures:function(e,t,o,n,r){var i=1==n?1:0,a=2==n?1:0,l=3==n?1:0,u=n>3?1:0,c=1==o?1:0,h=2==o?1:0,d=3==o?1:0,g=o>3?1:0,p=Math.atan2(t,e),f=e*t,m=0,y=0,v=0;if(r.length>0){m=r.reduce((function(e,t){return e+t}),0)/s.toDouble(r.length);var S=s.sort(r);v=S[S.length-1],y=S[0]}var C=[e,t,s.toDouble(o),s.toDouble(n),i,a,l,u,c,h,d,g,m,y,v,f,p];return new A.TheoMatrix([C])},predictLayoutIds:function(e,t){var o=s.opt(this.group_,(function(e){return e.root}));if(this.layoutTypeModel_=s.opt(o,(function(e){return e.page.layoutLibrary.layoutSuggestionModel})),null==o||null==this.layoutTypeModel_)return[];for(var n=o.filterWithCallback((function(e){return e.isBackgroundImage()})).length,r=s.clone(o.filterWithCallback((function(e){return e.isTypeLockup()}))),i=[],a=s.iter(r);!a.done;a.next()){var l,u=a.value;(l=s.as(u.controller,T.TypeLockupController))&&i.push(s.toDouble(l.text.length))}for(var c=o.page.pageSize.width,h=o.page.pageSize.height,d=Math.atan2(h,c),g=this.createLayoutIdFeatures(c,h,r.length,n,i),f=this.layoutTypeModel_.featureScalingMean,m=this.layoutTypeModel_.featureScalingStd,v=s.clone(this.layoutTypeModel_.layoutIDs),S=g.subtract(f).divide(m),C=s.repeat(0,this.layoutTypeModel_.models[0].intercepts.asFlatArray.length),A=s.iter(this.layoutTypeModel_.models);!A.done;A.next()){var F=A.value;if(F.minAngle<d&&d<=F.maxAngle){var k=S.matrixMultiply(F.coefficients.transpose()).sumDim(0);C=s.clone(F.intercepts.add(k).asFlatArray)}}if(C.length!=v.length)return s.opt(y.Host.logging,(function(e){return e.error("model scores don't match class labels")})),[];for(var L=s.sort(C,(function(e,t){return e>t})),b=[],_=s.clone(o.page.layoutLibrary.getAllGrids()),R=!1,I=!1,w=s.iter(s.range(0,v.length,!1));!w.done;w.next()){var D=w.value;if(b.length>=e)break;for(var x=v[s.indexOf(C,L[D])],P=s.iter(_);!P.done;P.next()){var E=P.value;if(E.name==x){var M=E.nonOverlappingCells().length;if(M>=n){if(M==n){if(R)continue;R=!0}if(2==M){if(I)continue;I=!0}var N=E;if(E.gridCells.length<=3){var G=E.flipRegion(),B=s.clone(new p.GridSuggester(this.group_,E).createSuggestions()),O=s.clone(new p.GridSuggester(this.group_,G).createSuggestions());B.length>0&&O.length>0&&(N=B[0].score>O[0].score?E:G)}for(var U=!1,H=s.iter(t);!H.done;H.next())if(H.value.similarity(N)<.02){U=!0;break}U||b.includes(N.name)||b.push(N.name)}}}}return b}}}),n),l.GridDocument=(r=function(){},s.defineClass({name:"GridDocument",ctor:r,props:{init_d4b4:function(e,t,o,n,r,i){this.docID=e,this.userID=t,this.database=o,this.gridFrame=n,this.gridStyle=r,this.layoutItems=s.clone(i)},init_implicit:function(e,t,o,n,r,i){this.gridFrame=e,this.gridStyle=t,this.layoutItems=s.clone(o),this.docID=n,this.userID=r,this.database=i},clone:function(){return r.init_implicit(this.gridFrame,this.gridStyle,this.layoutItems,this.docID,this.userID,this.database)}}}),r),l.RangedLayoutLinearModel=(i=function(e,t,o,n){this.minAngle=e,this.maxAngle=t,this.coefficients=o,this.intercepts=n},s.defineClass({name:"RangedLayoutLinearModel",ctor:i,props:{clone:function(){return new i(this.minAngle,this.maxAngle,this.coefficients,this.intercepts)}}}),i),l.LayoutSuggestionsLinearModel=(a=function(e,t,o,n){this.featureScalingMean=e,this.featureScalingStd=t,this.layoutIDs=s.clone(o),this.models=s.clone(n)},s.defineClass({name:"LayoutSuggestionsLinearModel",ctor:a,superName:"CoreObject"}),a)},"434x":function(e,t,o){var n,r=t,i=o("oAGj"),a=o("Tq01"),l=o("yGNn"),s=o("wNKJ"),u=o("fAXt"),c=o("Kkml");r.NudgeAction=(n=function e(t,o){this.delta=t,this.formaeToNudge=i.clone(o),a.Action.call(this,e.TYPE)},i.defineClass({name:"NudgeAction",ctor:n,superName:"Action",statics:{TYPE:"NudgeAction"},props:{getUserAction:function(e){var t=i.clone(e.selection.IDs);return c.UserActions.NudgeItem(t.join(","))},execute:function(e){var t=i.clone(this.formaeToNudge||e.selection.asFormaArray());u.TransformFacade.nudgeFormaeInPageSpace(t,this.delta);for(var o=i.iter(t);!o.done;o.next()){var n=o.value;s.DragFacade.rescueFormaToPageBounds(n,50,0)}return l.CorePromise.resolve(null)}}}),n)},"4ZS9":function(e,t,o){var n,r=t,i=o("oAGj"),a=o("gXiO"),l=o("mGL3"),s=o("3UhB");r.FontSuggestionContext=(n=function(){this.currentDocumentFonts_=new l.OrderedFontSet,this.recentlyUsedFonts_=new l.OrderedFontSet,a.CoreObject.call(this)},i.defineClass({name:"FontSuggestionContext",ctor:n,superName:"CoreObject",props:{snapshotCurrentFonts:function(e){this.currentDocumentFonts_=s.TypeLockupUtils.fontsInDocument(e)},currentDocumentFonts:{get:function(){return this.currentDocumentFonts_}},addRecentlyUsedFont:function(e){var t=this,o=null;if(this.recentlyUsedFonts_.contains(e)){var n=e.displayFamilyName;o=i.clone(this.recentlyUsedFonts_.facesInFamily(n))}i.opt(o,(function(e){return e.forEach((function(e){return t.recentlyUsedFonts_.remove(e)}))})),i.opt(o,(function(e){return e.forEach((function(e){return t.recentlyUsedFonts_.append(e)}))})),this.recentlyUsedFonts_.append(e)},clearRecentFonts:function(){this.recentlyUsedFonts_=new l.OrderedFontSet},recentlyUsedFonts:{get:function(){return this.recentlyUsedFonts_}}}}),n)},"4mEG":function(e,t,o){var n,r,i,a,l,s,u,c,h=t,d=o("oAGj"),g=o("Tq01"),p=o("Dz6V"),f=o("kYI4"),m=o("CWW7"),y=o("yGNn"),v=o("FNB+"),S=o("iCxV"),C=o("q5zr"),T=o("fNpk"),A=o("358a"),F=o("oTAR"),k=o("lJxM"),L=o("T6jX"),b=o("Kkml"),_=o("LGJg"),R=o("sW6f"),I=o("mxdD"),w=o("QTen");h.AddContentAction=(n=function e(t,o,n,r,i){void 0===o&&(o=null),void 0===n&&(n=!1),void 0===r&&(r=m.AddFormaParams.DEFAULTS),void 0===i&&(i=!0),this.content=t,this.pairedContent=o,this.preservePlacement=n,this.addParams=r,this.allowSelection=i,g.Action.call(this,e.TYPE)},d.defineClass({name:"AddContentAction",ctor:n,superName:"Action",statics:{TYPE:"AddContentAction"},props:{getUserAction:function(e){return this.content instanceof C.ImageContentNode?b.UserActions.AddImage():this.content instanceof R.VideoContentNode?b.UserActions.AddVideo():this.content instanceof _.VectorContentNode?b.UserActions.AddIcon():this.content instanceof k.TextContentNode?b.UserActions.AddText():(d.opt(S.Host.logging,(function(e){return e.warning("Could not determine user action for content")})),b.UserActions.AddImage())},execute:function(e){var t=this;return m.CreationFacade.addContent(A.PagesFacade.getActivePage(e.document),this.content,this.pairedContent,this.preservePlacement,this.addParams).then((function(o){var n=d.as(o,v.Forma);return null!=n?(t.allowSelection&&(t.newSelection=[n]),n.isImage()&&L.TheoDocumentUtils.updateConstrainedImageInfo(e.document),y.CorePromise.resolve(new g.FormaActionResult([n]))):(T.LegacyCoreAssert.fail("expected a forma result from CreationFacade.addContent",void 0,"AddContentAction.execute","AddContentAction.swift",75),y.CorePromise.resolve(null))}))},updateSelection:function(e){return S.Host.platform.isWeb||null==this.newSelection||e.selection.replaceSelectionWithFormae(this.newSelection),this.newSelection}}}),n),h.AddIconContentAction=(r=function e(t,o,n,r,i,a){void 0===r&&(r=!0),void 0===i&&(i=!0),this.url=t,this.metadata=o,this.replacing=n,this.undoable=r,this.allowSelection=i,this.atPagePoint=a,g.Action.call(this,e.TYPE)},d.defineClass({name:"AddIconContentAction",ctor:r,superName:"Action",statics:{TYPE:"AddIconContentAction"},props:{getUserAction:function(e){var t=null!=this.replacing?b.UserActions.ReplaceIcon():b.UserActions.AddIcon();return 0==this.undoable&&(t.undoable=!1),t},execute:function(e){var t,o,n=this;if(o=e.document){var r=A.PagesFacade.getActivePage(o);if(this.url.includes("<svg")){var i=F.SVGParserUtils.theoArtworkFromSVGData(this.url,!0);if(null==i)return T.LegacyCoreAssert.fail("null result from theoArtworkFromSVGData",void 0,"AddIconContentAction.execute","AddContentAction.swift",135),y.CorePromise.resolve(null);t=F.SVGParserUtils.createShapeFromTheoArtwork(r,"",i,this.metadata)}else t=F.SVGParserUtils.createShapeFromSVGURL(r,this.url,this.metadata);return null!=t?(e.selection.inReplaceMode=null!=this.replacing,F.SVGParserUtils.addShapeToPage(r,t,this.replacing,this.atPagePoint).then((function(e){return n.allowSelection&&(n.newSelection=d.clone(d.as([t],["Array",v.Forma]))),y.CorePromise.resolve(new g.FormaActionResult([t]))}))):(T.LegacyCoreAssert.fail("expected a forma result from SVGParserUtils.CreateShapeFromSVGURL",void 0,"AddIconContentAction.execute","AddContentAction.swift",155),y.CorePromise.resolve(null))}return y.CorePromise.reject("Not a valid doc")},updateSelection:function(e){return S.Host.platform.isWeb&&null==this.replacing||null==this.newSelection||e.selection.replaceSelectionWithFormae(this.newSelection),e.selection.inReplaceMode=!1,this.newSelection}}}),r),h.ActionUndoability=d.defineEnum("ActionUndoability",{useDefault:0,forceUndoable:1,forceNonUndoable:2}),h.AddImageContentAction=(i=function e(t,o,n,r,i,a,l,s,u,c,d,f,m){void 0===d&&(d=h.ActionUndoability.useDefault),void 0===f&&(f=null),void 0===m&&(m=!0),this.page=t,this.sourceURL=o,this.mimeType=n,this.width=r,this.height=i,this.hasAlpha=a,this.mediaMetadata=l,this.localIdentifier=s,this.tags=u,this.addParams=c,this.undoable=d,this.contentID=f,this.allowSelection=m,null!=c.atPagePoint?this.waitingFeedback=p.ActionFeedbackWaitingType.None:this.waitingFeedback=p.ActionFeedbackWaitingType.Loading,g.Action.call(this,e.TYPE,new g.ActionExecutionOptions(this.waitingFeedback,p.ActionFeedbackMessageType.Error))},d.defineClass({name:"AddImageContentAction",ctor:i,superName:"Action",statics:{TYPE:"AddImageContentAction"},props:{getUserAction:function(e){var t=null!=this.addParams.formaToReplace?b.UserActions.ReplaceImage():b.UserActions.AddImage();return this.undoable!=h.ActionUndoability.useDefault&&(t.undoable=this.undoable==h.ActionUndoability.forceUndoable),t},execute:function(e){var t,o=this;if(t=d.as(d.opt(e.document,(function(e){return e.content.createNode(C.ImageContentNode.KIND,o.contentID)})),C.ImageContentNode)){var n;if(t.url=this.sourceURL,t.mimeType=this.mimeType,t.pixelWidth=this.width,t.pixelHeight=this.height,t.mediaMetadata=this.mediaMetadata,t.localIdentifier=this.localIdentifier,this.hasAlpha&&(t.hasAlpha=!0),n=this.tags)for(var r=d.iter(n);!r.done;r.next()){var i,a,l=r.key,s=r.value;null!=(i=d.as(l,"String"))&&null!=(a=d.as(s,"String"))&&t.setTag(i,a)}return t.createImageFeatures(),d.opt(t.image,(function(e){return e.hasAlpha()})),e.selection.inReplaceMode=null!=this.addParams.formaToReplace,m.CreationFacade.addContent(A.PagesFacade.getActivePage(e.document),t,null,!1,this.addParams).then((function(t){var n=d.as(t,v.Forma);return null!=n?(L.TheoDocumentUtils.updateConstrainedImageInfo(e.document),o.allowSelection&&(o.newSelection=[n]),y.CorePromise.resolve(new g.FormaActionResult([n]))):(T.LegacyCoreAssert.fail("expected a forma result from CreationFacade.addContent",void 0,"AddImageContentAction.execute","AddContentAction.swift",292),y.CorePromise.resolve(null))}))}return y.CorePromise.resolve(null)},updateSelection:function(e){return S.Host.platform.isWeb&&null==this.addParams.formaToReplace||null==this.newSelection||e.selection.replaceSelectionWithFormae(this.newSelection),e.selection.inReplaceMode=!1,this.newSelection}}}),i),h.VideoPosterParams=(a=function(e,t,o,n){this.url=e,this.mimeType=t,this.width=o,this.height=n},d.defineClass({name:"VideoPosterParams",ctor:a,superName:"CoreObject"}),a),h.AddVideoContentAction=(l=function e(t,o,n,r,i,a,l,s,u,c,h,p,f,m,y){void 0===y&&(y=!0),this.page=t,this.sourceURL=o,this.mimeType=n,this.trackWidth=r,this.trackHeight=i,this.duration=a,this.times=d.clone(l),this.posterParams=s,this.isLivePhoto=u,this.mediaMetadata=c,this.localIdentifier=h,this.originalDuration=p,this.offsetInOriginal=f,this.addParams=m,this.allowSelection=y,g.Action.call(this,e.TYPE)},d.defineClass({name:"AddVideoContentAction",ctor:l,superName:"Action",statics:{TYPE:"AddVideoContentAction"},props:{getUserAction:function(e){return b.UserActions.AddVideo()},execute:function(e){var t,o,n,r,i=this;return(t=I.VideoFacade.addVideoContent(d.opt(e.document,(function(e){return e.content})),this.sourceURL,this.mimeType,this.trackWidth,this.trackHeight,this.duration,this.offsetInOriginal,this.originalDuration,this.mediaMetadata,this.localIdentifier,this.times,this.isLivePhoto))?((n=this.posterParams)&&(r=o=d.as(d.opt(e.document,(function(e){return e.content.createNode(C.ImageContentNode.KIND,null)})),C.ImageContentNode))&&(r.url=n.url,r.mimeType=n.mimeType,r.pixelWidth=n.width,r.pixelHeight=n.height),m.CreationFacade.addContent(this.page,t,o,!1,this.addParams).then((function(e){var t=d.as(e,v.Forma);return null!=t?(i.allowSelection&&(i.newSelection=[t]),y.CorePromise.resolve(new g.FormaActionResult([t]))):(T.LegacyCoreAssert.fail("expected a forma result from CreationFacade.addContent",void 0,"AddVideoContentAction.execute","AddContentAction.swift",435),y.CorePromise.resolve(null))}))):y.CorePromise.resolve(null)},updateSelection:function(e){return S.Host.platform.isWeb||null==this.newSelection||e.selection.replaceSelectionWithFormae(this.newSelection),this.newSelection},cloneWithPosterParams:function(e){return new l(this.page,this.sourceURL,this.mimeType,this.trackWidth,this.trackHeight,this.duration,this.times,e,this.isLivePhoto,this.mediaMetadata,this.localIdentifier,this.originalDuration,this.offsetInOriginal,this.addParams)}}}),l),h.ReplaceVideoFormaContentAction=(s=function e(t,o,n,r,i,a,l,s,u,c,h,p,f,m,y,v){void 0===v&&(v=!0),this.forma=t,this.sourceURL=o,this.mimeType=n,this.trackWidth=r,this.trackHeight=i,this.duration=a,this.startTime=l,this.trimDuration=s,this.offsetInOriginal=u,this.originalDuration=c,this.times=d.clone(h),this.posterParams=p,this.isLivePhoto=f,this.mediaMetadata=m,this.localIdentifier=y,this.allowSelection=v,g.Action.call(this,e.TYPE)},d.defineClass({name:"ReplaceVideoFormaContentAction",ctor:s,superName:"Action",statics:{TYPE:"ReplaceVideoFormaContentAction"},props:{getUserAction:function(e){return b.UserActions.ReplaceVideoContent()},execute:function(e){var t,o,n,r;return(t=I.VideoFacade.addVideoContent(d.opt(e.document,(function(e){return e.content})),this.sourceURL,this.mimeType,this.trackWidth,this.trackHeight,this.duration,this.offsetInOriginal,this.originalDuration,this.mediaMetadata,this.localIdentifier,this.times,this.isLivePhoto))?(m.CreationFacade.removeContentNodeFromDocument(this.forma.videoContentNode,e.document),this.forma.videoContentNode=t,m.CreationFacade.addContentNodeToDocument(t,e.document),(o=this.posterParams)&&(n=d.as(d.opt(e.document,(function(e){return e.content.createNode(C.ImageContentNode.KIND,null)})),C.ImageContentNode))&&(n.url=o.url,n.mimeType=o.mimeType,n.pixelWidth=o.width,n.pixelHeight=o.height,m.CreationFacade.removeContentNodeFromDocument(this.forma.contentNode,e.document),this.forma.contentNode=n,m.CreationFacade.addContentNodeToDocument(n,e.document)),(r=d.as(this.forma.style,w.VideoStyle))&&(r.startTime=this.startTime,r.duration=this.trimDuration),this.allowSelection&&(this.newSelection=[this.forma]),y.CorePromise.resolve(new g.FormaActionResult([this.forma]))):y.CorePromise.resolve(null)},updateSelection:function(e){return S.Host.platform.isWeb||null==this.newSelection||e.selection.replaceSelectionWithFormae(this.newSelection),this.newSelection}}}),s),h.AddLogoContentAction=(u=function e(t,o,n,r,i,a,l){void 0===i&&(i=null),void 0===a&&(a=!0),void 0===l&&(l=null),this.theoLogo=o,this.page=t,this.replacing=n,this.localIdentifier=r,this.componentID=i,this.allowSelection=a,this.atPagePoint=l,g.Action.call(this,e.TYPE)},d.defineClass({name:"AddLogoContentAction",ctor:u,superName:"Action",statics:{TYPE:"AddLogoContentAction"},props:{getUserAction:function(e){return b.UserActions.AddLogo()},execute:function(e){var t=this,o=f.BrandingFacade.makeLogoContentNode(this.theoLogo,this.page.document);o.createImageFeatures(),o.localIdentifier=this.localIdentifier,null!=this.componentID&&(o.componentID=this.componentID);var n=new m.AddFormaParams(g.ControllerSettingsBehaviorEnum.IgnoreControllerSettings,!0,this.replacing,m.FloatingImageStrategy.Always,void 0,this.atPagePoint);return e.selection.inReplaceMode=null!=this.replacing,m.CreationFacade.addContent(A.PagesFacade.getActivePage(e.document),o,null,!1,n).then((function(e){var o=d.as(e,v.Forma);return null!=o?(t.allowSelection&&(t.newSelection=[o]),y.CorePromise.resolve(new g.FormaActionResult([o]))):(T.LegacyCoreAssert.fail("expected a forma result from CreationFacade.addContent",void 0,"AddLogoContentAction.execute","AddContentAction.swift",674),y.CorePromise.resolve(null))}))},updateSelection:function(e){return S.Host.platform.isWeb&&null==this.replacing||null==this.newSelection||e.selection.replaceSelectionWithFormae(this.newSelection),e.selection.inReplaceMode=!1,this.newSelection}}}),u),h.AddTextContentAction=(c=function e(t,o,n){void 0===o&&(o=m.AddFormaParams.DEFAULTS),void 0===n&&(n=!0),this.text=t,this.addParams=o,this.allowSelection=n,g.Action.call(this,e.TYPE,new g.ActionExecutionOptions(p.ActionFeedbackWaitingType.None,p.ActionFeedbackMessageType.Error))},d.defineClass({name:"AddTextContentAction",ctor:c,superName:"Action",statics:{TYPE:"AddTextContentAction"},props:{getUserAction:function(e){return this.addParams.behavior==g.ControllerSettingsBehaviorEnum.SetControllerSettings?b.UserActions.AddTextUI():b.UserActions.AddText()},execute:function(e){var t,o=this;if(t=e.document){var n=A.PagesFacade.getActivePage(t);return n.colorLibraryController.regenerateThemeKeyCache(),m.CreationFacade.addText(n,this.text,!0,this.addParams).then((function(e){var t=d.as(e,v.Forma);return null!=t?(o.allowSelection&&(o.newSelection=[t]),y.CorePromise.resolve(new g.FormaActionResult([t]))):(T.LegacyCoreAssert.fail("expected a forma result from CreationFacade.addText",void 0,"AddTextContentAction.execute","AddContentAction.swift",749),y.CorePromise.resolve(null))}))}return y.CorePromise.reject("Not a valid doc")},updateSelection:function(e){return S.Host.platform.isWeb&&!this.allowSelection||null==this.newSelection||e.selection.replaceSelectionWithFormae(this.newSelection),this.newSelection}}}),c)},"5+WR":function(e,t,o){var n,r,i,a=t,l=o("oAGj"),s=o("KgU+"),u=o("PSFa"),c=o("KSe6"),h=o("AnBp"),d=o("358a");a.AnimationStyleAttribute=(n=function(e,t,o,n){this.selected=l.clone(o),this.page=t,this.options=l.clone(n),h.EditorAttributeBase.call(this,e)},l.defineClass({name:"AnimationStyleAttribute",ctor:n,superName:"EditorAttributeBase",statics:{PAGE_LEVEL_KEY:"animationStyle-page",sameArray:function(e,t){if(e.length==t.length){for(var o=l.iter(l.range(0,e.length,!1));!o.done;o.next()){var n=o.value;if(!e[n].equals(t[n]))return!1}return!0}return!1},_implements:function(e){return"IEditorAttribute"==e}},props:{isEqualTo:function(e){var t;return!!(t=l.as(e,n))&&this.key==t.key&&n.sameArray(this.selected,t.selected)&&n.sameArray(this.options,t.options)},createAction:function(e){if(1==this.selected.length&&e.name==this.selected[0].name){var t=this.page.animationLibrary.getNextAnimationStyleOfSameType(this.selected[0]);return new s.ApplyAnimationStyleAction(t,this.page)}return new s.ApplyAnimationStyleAction(e,this.page)}}}),n),a.AnimationAttributesHandler=(r=function(){u.AttributeHandlerBase.call(this)},i={},l.defineClass({name:"AnimationAttributesHandler",ctor:r,superName:"AttributeHandlerBase",statics:{instance:{get:function(){return void 0===i.instance&&(i.instance=new r),i.instance}},_implements:function(e){return"IAttributeHandler"==e}},props:{calculate:function(e){var t;if(t=l.opt(e,(function(e){return e.document}))){var o=d.PagesFacade.getActivePage(t),n=l.clone(c.AnimationLibrary.getDisplayableAnimationStyles(o.root)),r=o.animationController.animationStyle||o.animationLibrary.getNoneStyle();return[new a.AnimationStyleAttribute(a.AnimationStyleAttribute.PAGE_LEVEL_KEY,o,[r],n)]}return[]}}}),r)},"53P9":function(e,t,o){var n,r=t,i=o("oAGj"),a=o("gXiO");r.GraphemeUtils=(n=function(){a.CoreObject.call(this)},i.defineClass({name:"GraphemeUtils",ctor:n,superName:"CoreObject",statics:{CR:0,LF:1,Control:2,Extend:3,Regional_Indicator:4,SpacingMark:5,L_Type:6,V_Type:7,T_Type:8,LV:9,LVT:10,Other:11,Prepend:12,E_Base:13,E_Modifier:14,ZWJ:15,Glue_After_Zwj:16,E_Base_GAZ:17,BreakPropertyCache:{},NotBreak:0,BreakStart:1,Break:2,BreakLastRegional:3,BreakPenultimateRegional:4,_isSurrogate:function(e,t){return 55296<=e[t]&&e[t]<=56319&&56320<=e[t+1]&&e[t+1]<=57343},isSurrogate:function(e,t){var o=i.utf16s(e);return n._isSurrogate(o,t)},_codePointAt:function(e,t){var o=e[t];if(55296<=o&&o<=56319&&t<e.length-1){var n=i.toInt(o);return 56320<=(r=e[t+1])&&r<=57343?i.toInt(1024*(n-55296))+(i.toInt(r)-56320)+65536:n}if(56320<=o&&o<=57343&&t>=1){n=e[t-1];var r=i.toInt(o);return 55296<=n&&n<=56319?i.toInt(1024*(n-55296))+(i.toInt(r)-56320)+65536:r}return i.toInt(o)},codePointAt:function(e,t){var o=i.utf16s(e);return n._codePointAt(o,t)},shouldBreak:function(e,t){var o,r,a,l=e[0],s=e[e.length-1],u=e[e.length-2],c=s,h=(o=e.lastIndexOf(n.E_Modifier))||null!=o?o:0;if(h>1){var d=e.slice(1,h),g=!0;if(d.forEach((function(e){e!=n.Extend&&(g=!1)})),g&&-1==i.indexOf([n.Extend,n.E_Base,n.E_Base_GAZ],l))return n.Break}var p=(r=e.lastIndexOf(n.Regional_Indicator))||null!=r?r:0;if(p>0){d=e.slice(1,p);var f=!0;if(d.forEach((function(e){e!=n.Regional_Indicator&&(f=!1)})),f&&-1==i.indexOf([n.Prepend,n.Regional_Indicator],u))return e.filter((function(e){return e==n.Regional_Indicator}),this).length%2==1?n.BreakLastRegional:n.BreakPenultimateRegional}if(u==n.CR&&c==n.LF)return n.NotBreak;if(u==n.Control||u==n.CR||u==n.LF){var m=!0;return t.forEach((function(e){e!=n.Extend&&(m=!1)})),c==n.E_Modifier&&m?n.Break:n.BreakStart}if(c==n.Control||c==n.CR||c==n.LF)return n.BreakStart;if(u==n.L_Type&&(c==n.L_Type||c==n.V_Type||c==n.LV||c==n.LVT))return n.NotBreak;if(!(u!=n.LV&&u!=n.V_Type||c!=n.V_Type&&c!=n.T_Type))return n.NotBreak;if((u==n.LVT||u==n.T_Type)&&c==n.T_Type)return n.NotBreak;if(c==n.Extend||c==n.ZWJ)return n.NotBreak;if(c==n.SpacingMark)return n.NotBreak;if(u==n.Prepend)return n.NotBreak;var y=(a=e.lastIndexOf(n.Extend))||null!=a?a:0,v=null!=i.indexOf(e,n.Extend)?y-1:e.length-2;return-1!=i.indexOf([n.E_Base,n.E_Base_GAZ],e[v])&&c==n.E_Modifier&&(d=e.slice(v+1,e.length-1),g=!0,d.forEach((function(e){e!=n.Extend&&(g=!1)})),g)||u==n.ZWJ&&-1!=i.indexOf([n.Glue_After_Zwj,n.E_Base_GAZ],c)?n.NotBreak:-1!=i.indexOf(t,n.Regional_Indicator)?n.Break:u==n.Regional_Indicator&&c==n.Regional_Indicator?n.NotBreak:n.BreakStart},_nextBreak:function(e,t){if(t<0)return 0;var o=e.length;if(t>=o-1)return o;for(var r=[],a=[n.getGraphemeBreakProperty(n._codePointAt(e,t))],l=i.iter(i.range(t+1,o,!1));!l.done;l.next()){var s=l.value;if(!n._isSurrogate(e,s-1)){var u=n.getGraphemeBreakProperty(n._codePointAt(e,s));if(a.push(u),n.shouldBreak(a,r)!=n.NotBreak)return s;r.push(u)}}return o},nextBreak:function(e,t){var o=i.utf16s(e);return n._nextBreak(o,t)},splitGraphemes:function(e){for(var t=i.utf16s(e),o=[],r=0,a=n._nextBreak(t,r);a<t.length;){var l=t.slice(r,a);0==r&&8235==l[0]||o.push(i.toStringFromCharCodes(l,l.length)),a=n._nextBreak(t,r=a)}if(r<t.length){var s=t.slice(r,t.length);0==r&&8235==s[0]||o.push(i.toStringFromCharCodes(s,s.length))}return o},countGraphemes:function(e){var t=i.utf16s(e),o=0,r=0,a=n._nextBreak(t,r),l=t.length;if(l<1)return 0;for(8235==n._codePointAt(t,0)&&(o=-1);a<l;)o+=1,a=n._nextBreak(t,r=a);return r<l&&(o+=1),o},_getGraphemeBreakProperty:function(e){return 1536<=e&&e<=1541||1757==e||1807==e||2274==e||3406==e||69821==e||70082<=e&&e<=70083||72250==e||72326<=e&&e<=72329||73030==e?n.Prepend:13==e?n.CR:10==e?n.LF:0<=e&&e<=9||11<=e&&e<=12||14<=e&&e<=31||127<=e&&e<=159||173==e||1564==e||6158==e||8203==e||8206<=e&&e<=8207||8232==e||8233==e||8234<=e&&e<=8238||8288<=e&&e<=8292||8293==e||8294<=e&&e<=8303||55296<=e&&e<=57343||65279==e||65520<=e&&e<=65528||65529<=e&&e<=65531||113824<=e&&e<=113827||119155<=e&&e<=119162||917504==e||917505==e||917506<=e&&e<=917535||917632<=e&&e<=917759||918e3<=e&&e<=921599?n.Control:768<=e&&e<=879||1155<=e&&e<=1159||1160<=e&&e<=1161||1425<=e&&e<=1469||1471==e||1473<=e&&e<=1474||1476<=e&&e<=1477||1479==e||1552<=e&&e<=1562||1611<=e&&e<=1631||1648==e||1750<=e&&e<=1756||1759<=e&&e<=1764||1767<=e&&e<=1768||1770<=e&&e<=1773||1809==e||1840<=e&&e<=1866||1958<=e&&e<=1968||2027<=e&&e<=2035||2070<=e&&e<=2073||2075<=e&&e<=2083||2085<=e&&e<=2087||2089<=e&&e<=2093||2137<=e&&e<=2139||2260<=e&&e<=2273||2275<=e&&e<=2306||2362==e||2364==e||2369<=e&&e<=2376||2381==e||2385<=e&&e<=2391||2402<=e&&e<=2403||2433==e||2492==e||2494==e||2497<=e&&e<=2500||2509==e||2519==e||2530<=e&&e<=2531||2561<=e&&e<=2562||2620==e||2625<=e&&e<=2626||2631<=e&&e<=2632||2635<=e&&e<=2637||2641==e||2672<=e&&e<=2673||2677==e||2689<=e&&e<=2690||2748==e||2753<=e&&e<=2757||2759<=e&&e<=2760||2765==e||2786<=e&&e<=2787||2810<=e&&e<=2815||2817==e||2876==e||2878==e||2879==e||2881<=e&&e<=2884||2893==e||2902==e||2903==e||2914<=e&&e<=2915||2946==e||3006==e||3008==e||3021==e||3031==e||3072==e||3134<=e&&e<=3136||3142<=e&&e<=3144||3146<=e&&e<=3149||3157<=e&&e<=3158||3170<=e&&e<=3171||3201==e||3260==e||3263==e||3266==e||3270==e||3276<=e&&e<=3277||3285<=e&&e<=3286||3298<=e&&e<=3299||3328<=e&&e<=3329||3387<=e&&e<=3388||3390==e||3393<=e&&e<=3396||3405==e||3415==e||3426<=e&&e<=3427||3530==e||3535==e||3538<=e&&e<=3540||3542==e||3551==e||3633==e||3636<=e&&e<=3642||3655<=e&&e<=3662||3761==e||3764<=e&&e<=3769||3771<=e&&e<=3772||3784<=e&&e<=3789||3864<=e&&e<=3865||3893==e||3895==e||3897==e||3953<=e&&e<=3966||3968<=e&&e<=3972||3974<=e&&e<=3975||3981<=e&&e<=3991||3993<=e&&e<=4028||4038==e||4141<=e&&e<=4144||4146<=e&&e<=4151||4153<=e&&e<=4154||4157<=e&&e<=4158||4184<=e&&e<=4185||4190<=e&&e<=4192||4209<=e&&e<=4212||4226==e||4229<=e&&e<=4230||4237==e||4253==e||4957<=e&&e<=4959||5906<=e&&e<=5908||5938<=e&&e<=5940||5970<=e&&e<=5971||6002<=e&&e<=6003||6068<=e&&e<=6069||6071<=e&&e<=6077||6086==e||6089<=e&&e<=6099||6109==e||6155<=e&&e<=6157||6277<=e&&e<=6278||6313==e||6432<=e&&e<=6434||6439<=e&&e<=6440||6450==e||6457<=e&&e<=6459||6679<=e&&e<=6680||6683==e||6742==e||6744<=e&&e<=6750||6752==e||6754==e||6757<=e&&e<=6764||6771<=e&&e<=6780||6783==e||6832<=e&&e<=6845||6846==e||6912<=e&&e<=6915||6964==e||6966<=e&&e<=6970||6972==e||6978==e||7019<=e&&e<=7027||7040<=e&&e<=7041||7074<=e&&e<=7077||7080<=e&&e<=7081||7083<=e&&e<=7085||7142==e||7144<=e&&e<=7145||7149==e||7151<=e&&e<=7153||7212<=e&&e<=7219||7222<=e&&e<=7223||7376<=e&&e<=7378||7380<=e&&e<=7392||7394<=e&&e<=7400||7405==e||7412==e||7416<=e&&e<=7417||7616<=e&&e<=7673||7675<=e&&e<=7679||8204==e||8400<=e&&e<=8412||8413<=e&&e<=8416||8417==e||8418<=e&&e<=8420||8421<=e&&e<=8432||11503<=e&&e<=11505||11647==e||11744<=e&&e<=11775||12330<=e&&e<=12333||12334<=e&&e<=12335||12441<=e&&e<=12442||42607==e||42608<=e&&e<=42610||42612<=e&&e<=42621||42654<=e&&e<=42655||42736<=e&&e<=42737||43010==e||43014==e||43019==e||43045<=e&&e<=43046||43204<=e&&e<=43205||43232<=e&&e<=43249||43302<=e&&e<=43309||43335<=e&&e<=43345||43392<=e&&e<=43394||43443==e||43446<=e&&e<=43449||43452==e||43493==e||43561<=e&&e<=43566||43569<=e&&e<=43570||43573<=e&&e<=43574||43587==e||43596==e||43644==e||43696==e||43698<=e&&e<=43700||43703<=e&&e<=43704||43710<=e&&e<=43711||43713==e||43756<=e&&e<=43757||43766==e||44005==e||44008==e||44013==e||64286==e||65024<=e&&e<=65039||65056<=e&&e<=65071||65438<=e&&e<=65439||66045==e||66272==e||66422<=e&&e<=66426||68097<=e&&e<=68099||68101<=e&&e<=68102||68108<=e&&e<=68111||68152<=e&&e<=68154||68159==e||68325<=e&&e<=68326||69633==e||69688<=e&&e<=69702||69759<=e&&e<=69761||69811<=e&&e<=69814||69817<=e&&e<=69818||69888<=e&&e<=69890||69927<=e&&e<=69931||69933<=e&&e<=69940||70003==e||70016<=e&&e<=70017||70070<=e&&e<=70078||70090<=e&&e<=70092||70191<=e&&e<=70193||70196==e||70198<=e&&e<=70199||70206==e||70367==e||70371<=e&&e<=70378||70400<=e&&e<=70401||70460==e||70462==e||70464==e||70487==e||70502<=e&&e<=70508||70512<=e&&e<=70516||70712<=e&&e<=70719||70722<=e&&e<=70724||70726==e||70832==e||70835<=e&&e<=70840||70842==e||70845==e||70847<=e&&e<=70848||70850<=e&&e<=70851||71087==e||71090<=e&&e<=71093||71100<=e&&e<=71101||71103<=e&&e<=71104||71132<=e&&e<=71133||71219<=e&&e<=71226||71229==e||71231<=e&&e<=71232||71339==e||71341==e||71344<=e&&e<=71349||71351==e||71453<=e&&e<=71455||71458<=e&&e<=71461||71463<=e&&e<=71467||72193<=e&&e<=72198||72201<=e&&e<=72202||72243<=e&&e<=72248||72251<=e&&e<=72254||72263==e||72273<=e&&e<=72278||72281<=e&&e<=72283||72330<=e&&e<=72342||72344<=e&&e<=72345||72752<=e&&e<=72758||72760<=e&&e<=72765||72767==e||72850<=e&&e<=72871||72874<=e&&e<=72880||72882<=e&&e<=72883||72885<=e&&e<=72886||73009<=e&&e<=73014||73018==e||73020<=e&&e<=73021||73023<=e&&e<=73029||73031==e||92912<=e&&e<=92916||92976<=e&&e<=92982||94095<=e&&e<=94098||113821<=e&&e<=113822||119141==e||119143<=e&&e<=119145||119150<=e&&e<=119154||119163<=e&&e<=119170||119173<=e&&e<=119179||119210<=e&&e<=119213||119362<=e&&e<=119364||121344<=e&&e<=121398||121403<=e&&e<=121452||121461==e||121476==e||121499<=e&&e<=121503||121505<=e&&e<=121519||122880<=e&&e<=122886||122888<=e&&e<=122904||122907<=e&&e<=122913||122915<=e&&e<=122916||122918<=e&&e<=122922||125136<=e&&e<=125142||125252<=e&&e<=125258||917536<=e&&e<=917631||917760<=e&&e<=917999?n.Extend:127462<=e&&e<=127487?n.Regional_Indicator:2307==e||2363==e||2366<=e&&e<=2368||2377<=e&&e<=2380||2382<=e&&e<=2383||2434<=e&&e<=2435||2495<=e&&e<=2496||2503<=e&&e<=2504||2507<=e&&e<=2508||2563==e||2622<=e&&e<=2624||2691==e||2750<=e&&e<=2752||2761==e||2763<=e&&e<=2764||2818<=e&&e<=2819||2880==e||2887<=e&&e<=2888||2891<=e&&e<=2892||3007==e||3009<=e&&e<=3010||3014<=e&&e<=3016||3018<=e&&e<=3020||3073<=e&&e<=3075||3137<=e&&e<=3140||3202<=e&&e<=3203||3262==e||3264<=e&&e<=3265||3267<=e&&e<=3268||3271<=e&&e<=3272||3274<=e&&e<=3275||3330<=e&&e<=3331||3391<=e&&e<=3392||3398<=e&&e<=3400||3402<=e&&e<=3404||3458<=e&&e<=3459||3536<=e&&e<=3537||3544<=e&&e<=3550||3570<=e&&e<=3571||3635==e||3763==e||3902<=e&&e<=3903||3967==e||4145==e||4155<=e&&e<=4156||4182<=e&&e<=4183||4228==e||6070==e||6078<=e&&e<=6085||6087<=e&&e<=6088||6435<=e&&e<=6438||6441<=e&&e<=6443||6448<=e&&e<=6449||6451<=e&&e<=6456||6681<=e&&e<=6682||6741==e||6743==e||6765<=e&&e<=6770||6916==e||6965==e||6971==e||6973<=e&&e<=6977||6979<=e&&e<=6980||7042==e||7073==e||7078<=e&&e<=7079||7082==e||7143==e||7146<=e&&e<=7148||7150==e||7154<=e&&e<=7155||7204<=e&&e<=7211||7220<=e&&e<=7221||7393==e||7410<=e&&e<=7411||7415==e||43043<=e&&e<=43044||43047==e||43136<=e&&e<=43137||43188<=e&&e<=43203||43346<=e&&e<=43347||43395==e||43444<=e&&e<=43445||43450<=e&&e<=43451||43453<=e&&e<=43456||43567<=e&&e<=43568||43571<=e&&e<=43572||43597==e||43755==e||43758<=e&&e<=43759||43765==e||44003<=e&&e<=44004||44006<=e&&e<=44007||44009<=e&&e<=44010||44012==e||69632==e||69634==e||69762==e||69808<=e&&e<=69810||69815<=e&&e<=69816||69932==e||70018==e||70067<=e&&e<=70069||70079<=e&&e<=70080||70188<=e&&e<=70190||70194<=e&&e<=70195||70197==e||70368<=e&&e<=70370||70402<=e&&e<=70403||70463==e||70465<=e&&e<=70468||70471<=e&&e<=70472||70475<=e&&e<=70477||70498<=e&&e<=70499||70709<=e&&e<=70711||70720<=e&&e<=70721||70725==e||70833<=e&&e<=70834||70841==e||70843<=e&&e<=70844||70846==e||70849==e||71088<=e&&e<=71089||71096<=e&&e<=71099||71102==e||71216<=e&&e<=71218||71227<=e&&e<=71228||71230==e||71340==e||71342<=e&&e<=71343||71350==e||71456<=e&&e<=71457||71462==e||72199<=e&&e<=72200||72249==e||72279<=e&&e<=72280||72343==e||72751==e||72766==e||72873==e||72881==e||72884==e||94033<=e&&e<=94078||119142==e||119149==e?n.SpacingMark:4352<=e&&e<=4447||43360<=e&&e<=43388?n.L_Type:4448<=e&&e<=4519||55216<=e&&e<=55238?n.V_Type:4520<=e&&e<=4607||55243<=e&&e<=55291?n.T_Type:44032==e||44060==e||44088==e||44116==e||44144==e||44172==e||44200==e||44228==e||44256==e||44284==e||44312==e||44340==e||44368==e||44396==e||44424==e||44452==e||44480==e||44508==e||44536==e||44564==e||44592==e||44620==e||44648==e||44676==e||44704==e||44732==e||44760==e||44788==e||44816==e||44844==e||44872==e||44900==e||44928==e||44956==e||44984==e||45012==e||45040==e||45068==e||45096==e||45124==e||45152==e||45180==e||45208==e||45236==e||45264==e||45292==e||45320==e||45348==e||45376==e||45404==e||45432==e||45460==e||45488==e||45516==e||45544==e||45572==e||45600==e||45628==e||45656==e||45684==e||45712==e||45740==e||45768==e||45796==e||45824==e||45852==e||45880==e||45908==e||45936==e||45964==e||45992==e||46020==e||46048==e||46076==e||46104==e||46132==e||46160==e||46188==e||46216==e||46244==e||46272==e||46300==e||46328==e||46356==e||46384==e||46412==e||46440==e||46468==e||46496==e||46524==e||46552==e||46580==e||46608==e||46636==e||46664==e||46692==e||46720==e||46748==e||46776==e||46804==e||46832==e||46860==e||46888==e||46916==e||46944==e||46972==e||47e3==e||47028==e||47056==e||47084==e||47112==e||47140==e||47168==e||47196==e||47224==e||47252==e||47280==e||47308==e||47336==e||47364==e||47392==e||47420==e||47448==e||47476==e||47504==e||47532==e||47560==e||47588==e||47616==e||47644==e||47672==e||47700==e||47728==e||47756==e||47784==e||47812==e||47840==e||47868==e||47896==e||47924==e||47952==e||47980==e||48008==e||48036==e||48064==e||48092==e||48120==e||48148==e||48176==e||48204==e||48232==e||48260==e||48288==e||48316==e||48344==e||48372==e||48400==e||48428==e||48456==e||48484==e||48512==e||48540==e||48568==e||48596==e||48624==e||48652==e||48680==e||48708==e||48736==e||48764==e||48792==e||48820==e||48848==e||48876==e||48904==e||48932==e||48960==e||48988==e||49016==e||49044==e||49072==e||49100==e||49128==e||49156==e||49184==e||49212==e||49240==e||49268==e||49296==e||49324==e||49352==e||49380==e||49408==e||49436==e||49464==e||49492==e||49520==e||49548==e||49576==e||49604==e||49632==e||49660==e||49688==e||49716==e||49744==e||49772==e||49800==e||49828==e||49856==e||49884==e||49912==e||49940==e||49968==e||49996==e||50024==e||50052==e||50080==e||50108==e||50136==e||50164==e||50192==e||50220==e||50248==e||50276==e||50304==e||50332==e||50360==e||50388==e||50416==e||50444==e||50472==e||50500==e||50528==e||50556==e||50584==e||50612==e||50640==e||50668==e||50696==e||50724==e||50752==e||50780==e||50808==e||50836==e||50864==e||50892==e||50920==e||50948==e||50976==e||51004==e||51032==e||51060==e||51088==e||51116==e||51144==e||51172==e||51200==e||51228==e||51256==e||51284==e||51312==e||51340==e||51368==e||51396==e||51424==e||51452==e||51480==e||51508==e||51536==e||51564==e||51592==e||51620==e||51648==e||51676==e||51704==e||51732==e||51760==e||51788==e||51816==e||51844==e||51872==e||51900==e||51928==e||51956==e||51984==e||52012==e||52040==e||52068==e||52096==e||52124==e||52152==e||52180==e||52208==e||52236==e||52264==e||52292==e||52320==e||52348==e||52376==e||52404==e||52432==e||52460==e||52488==e||52516==e||52544==e||52572==e||52600==e||52628==e||52656==e||52684==e||52712==e||52740==e||52768==e||52796==e||52824==e||52852==e||52880==e||52908==e||52936==e||52964==e||52992==e||53020==e||53048==e||53076==e||53104==e||53132==e||53160==e||53188==e||53216==e||53244==e||53272==e||53300==e||53328==e||53356==e||53384==e||53412==e||53440==e||53468==e||53496==e||53524==e||53552==e||53580==e||53608==e||53636==e||53664==e||53692==e||53720==e||53748==e||53776==e||53804==e||53832==e||53860==e||53888==e||53916==e||53944==e||53972==e||54e3==e||54028==e||54056==e||54084==e||54112==e||54140==e||54168==e||54196==e||54224==e||54252==e||54280==e||54308==e||54336==e||54364==e||54392==e||54420==e||54448==e||54476==e||54504==e||54532==e||54560==e||54588==e||54616==e||54644==e||54672==e||54700==e||54728==e||54756==e||54784==e||54812==e||54840==e||54868==e||54896==e||54924==e||54952==e||54980==e||55008==e||55036==e||55064==e||55092==e||55120==e||55148==e||55176==e?n.LV:44033<=e&&e<=44059||44061<=e&&e<=44087||44089<=e&&e<=44115||44117<=e&&e<=44143||44145<=e&&e<=44171||44173<=e&&e<=44199||44201<=e&&e<=44227||44229<=e&&e<=44255||44257<=e&&e<=44283||44285<=e&&e<=44311||44313<=e&&e<=44339||44341<=e&&e<=44367||44369<=e&&e<=44395||44397<=e&&e<=44423||44425<=e&&e<=44451||44453<=e&&e<=44479||44481<=e&&e<=44507||44509<=e&&e<=44535||44537<=e&&e<=44563||44565<=e&&e<=44591||44593<=e&&e<=44619||44621<=e&&e<=44647||44649<=e&&e<=44675||44677<=e&&e<=44703||44705<=e&&e<=44731||44733<=e&&e<=44759||44761<=e&&e<=44787||44789<=e&&e<=44815||44817<=e&&e<=44843||44845<=e&&e<=44871||44873<=e&&e<=44899||44901<=e&&e<=44927||44929<=e&&e<=44955||44957<=e&&e<=44983||44985<=e&&e<=45011||45013<=e&&e<=45039||45041<=e&&e<=45067||45069<=e&&e<=45095||45097<=e&&e<=45123||45125<=e&&e<=45151||45153<=e&&e<=45179||45181<=e&&e<=45207||45209<=e&&e<=45235||45237<=e&&e<=45263||45265<=e&&e<=45291||45293<=e&&e<=45319||45321<=e&&e<=45347||45349<=e&&e<=45375||45377<=e&&e<=45403||45405<=e&&e<=45431||45433<=e&&e<=45459||45461<=e&&e<=45487||45489<=e&&e<=45515||45517<=e&&e<=45543||45545<=e&&e<=45571||45573<=e&&e<=45599||45601<=e&&e<=45627||45629<=e&&e<=45655||45657<=e&&e<=45683||45685<=e&&e<=45711||45713<=e&&e<=45739||45741<=e&&e<=45767||45769<=e&&e<=45795||45797<=e&&e<=45823||45825<=e&&e<=45851||45853<=e&&e<=45879||45881<=e&&e<=45907||45909<=e&&e<=45935||45937<=e&&e<=45963||45965<=e&&e<=45991||45993<=e&&e<=46019||46021<=e&&e<=46047||46049<=e&&e<=46075||46077<=e&&e<=46103||46105<=e&&e<=46131||46133<=e&&e<=46159||46161<=e&&e<=46187||46189<=e&&e<=46215||46217<=e&&e<=46243||46245<=e&&e<=46271||46273<=e&&e<=46299||46301<=e&&e<=46327||46329<=e&&e<=46355||46357<=e&&e<=46383||46385<=e&&e<=46411||46413<=e&&e<=46439||46441<=e&&e<=46467||46469<=e&&e<=46495||46497<=e&&e<=46523||46525<=e&&e<=46551||46553<=e&&e<=46579||46581<=e&&e<=46607||46609<=e&&e<=46635||46637<=e&&e<=46663||46665<=e&&e<=46691||46693<=e&&e<=46719||46721<=e&&e<=46747||46749<=e&&e<=46775||46777<=e&&e<=46803||46805<=e&&e<=46831||46833<=e&&e<=46859||46861<=e&&e<=46887||46889<=e&&e<=46915||46917<=e&&e<=46943||46945<=e&&e<=46971||46973<=e&&e<=46999||47001<=e&&e<=47027||47029<=e&&e<=47055||47057<=e&&e<=47083||47085<=e&&e<=47111||47113<=e&&e<=47139||47141<=e&&e<=47167||47169<=e&&e<=47195||47197<=e&&e<=47223||47225<=e&&e<=47251||47253<=e&&e<=47279||47281<=e&&e<=47307||47309<=e&&e<=47335||47337<=e&&e<=47363||47365<=e&&e<=47391||47393<=e&&e<=47419||47421<=e&&e<=47447||47449<=e&&e<=47475||47477<=e&&e<=47503||47505<=e&&e<=47531||47533<=e&&e<=47559||47561<=e&&e<=47587||47589<=e&&e<=47615||47617<=e&&e<=47643||47645<=e&&e<=47671||47673<=e&&e<=47699||47701<=e&&e<=47727||47729<=e&&e<=47755||47757<=e&&e<=47783||47785<=e&&e<=47811||47813<=e&&e<=47839||47841<=e&&e<=47867||47869<=e&&e<=47895||47897<=e&&e<=47923||47925<=e&&e<=47951||47953<=e&&e<=47979||47981<=e&&e<=48007||48009<=e&&e<=48035||48037<=e&&e<=48063||48065<=e&&e<=48091||48093<=e&&e<=48119||48121<=e&&e<=48147||48149<=e&&e<=48175||48177<=e&&e<=48203||48205<=e&&e<=48231||48233<=e&&e<=48259||48261<=e&&e<=48287||48289<=e&&e<=48315||48317<=e&&e<=48343||48345<=e&&e<=48371||48373<=e&&e<=48399||48401<=e&&e<=48427||48429<=e&&e<=48455||48457<=e&&e<=48483||48485<=e&&e<=48511||48513<=e&&e<=48539||48541<=e&&e<=48567||48569<=e&&e<=48595||48597<=e&&e<=48623||48625<=e&&e<=48651||48653<=e&&e<=48679||48681<=e&&e<=48707||48709<=e&&e<=48735||48737<=e&&e<=48763||48765<=e&&e<=48791||48793<=e&&e<=48819||48821<=e&&e<=48847||48849<=e&&e<=48875||48877<=e&&e<=48903||48905<=e&&e<=48931||48933<=e&&e<=48959||48961<=e&&e<=48987||48989<=e&&e<=49015||49017<=e&&e<=49043||49045<=e&&e<=49071||49073<=e&&e<=49099||49101<=e&&e<=49127||49129<=e&&e<=49155||49157<=e&&e<=49183||49185<=e&&e<=49211||49213<=e&&e<=49239||49241<=e&&e<=49267||49269<=e&&e<=49295||49297<=e&&e<=49323||49325<=e&&e<=49351||49353<=e&&e<=49379||49381<=e&&e<=49407||49409<=e&&e<=49435||49437<=e&&e<=49463||49465<=e&&e<=49491||49493<=e&&e<=49519||49521<=e&&e<=49547||49549<=e&&e<=49575||49577<=e&&e<=49603||49605<=e&&e<=49631||49633<=e&&e<=49659||49661<=e&&e<=49687||49689<=e&&e<=49715||49717<=e&&e<=49743||49745<=e&&e<=49771||49773<=e&&e<=49799||49801<=e&&e<=49827||49829<=e&&e<=49855||49857<=e&&e<=49883||49885<=e&&e<=49911||49913<=e&&e<=49939||49941<=e&&e<=49967||49969<=e&&e<=49995||49997<=e&&e<=50023||50025<=e&&e<=50051||50053<=e&&e<=50079||50081<=e&&e<=50107||50109<=e&&e<=50135||50137<=e&&e<=50163||50165<=e&&e<=50191||50193<=e&&e<=50219||50221<=e&&e<=50247||50249<=e&&e<=50275||50277<=e&&e<=50303||50305<=e&&e<=50331||50333<=e&&e<=50359||50361<=e&&e<=50387||50389<=e&&e<=50415||50417<=e&&e<=50443||50445<=e&&e<=50471||50473<=e&&e<=50499||50501<=e&&e<=50527||50529<=e&&e<=50555||50557<=e&&e<=50583||50585<=e&&e<=50611||50613<=e&&e<=50639||50641<=e&&e<=50667||50669<=e&&e<=50695||50697<=e&&e<=50723||50725<=e&&e<=50751||50753<=e&&e<=50779||50781<=e&&e<=50807||50809<=e&&e<=50835||50837<=e&&e<=50863||50865<=e&&e<=50891||50893<=e&&e<=50919||50921<=e&&e<=50947||50949<=e&&e<=50975||50977<=e&&e<=51003||51005<=e&&e<=51031||51033<=e&&e<=51059||51061<=e&&e<=51087||51089<=e&&e<=51115||51117<=e&&e<=51143||51145<=e&&e<=51171||51173<=e&&e<=51199||51201<=e&&e<=51227||51229<=e&&e<=51255||51257<=e&&e<=51283||51285<=e&&e<=51311||51313<=e&&e<=51339||51341<=e&&e<=51367||51369<=e&&e<=51395||51397<=e&&e<=51423||51425<=e&&e<=51451||51453<=e&&e<=51479||51481<=e&&e<=51507||51509<=e&&e<=51535||51537<=e&&e<=51563||51565<=e&&e<=51591||51593<=e&&e<=51619||51621<=e&&e<=51647||51649<=e&&e<=51675||51677<=e&&e<=51703||51705<=e&&e<=51731||51733<=e&&e<=51759||51761<=e&&e<=51787||51789<=e&&e<=51815||51817<=e&&e<=51843||51845<=e&&e<=51871||51873<=e&&e<=51899||51901<=e&&e<=51927||51929<=e&&e<=51955||51957<=e&&e<=51983||51985<=e&&e<=52011||52013<=e&&e<=52039||52041<=e&&e<=52067||52069<=e&&e<=52095||52097<=e&&e<=52123||52125<=e&&e<=52151||52153<=e&&e<=52179||52181<=e&&e<=52207||52209<=e&&e<=52235||52237<=e&&e<=52263||52265<=e&&e<=52291||52293<=e&&e<=52319||52321<=e&&e<=52347||52349<=e&&e<=52375||52377<=e&&e<=52403||52405<=e&&e<=52431||52433<=e&&e<=52459||52461<=e&&e<=52487||52489<=e&&e<=52515||52517<=e&&e<=52543||52545<=e&&e<=52571||52573<=e&&e<=52599||52601<=e&&e<=52627||52629<=e&&e<=52655||52657<=e&&e<=52683||52685<=e&&e<=52711||52713<=e&&e<=52739||52741<=e&&e<=52767||52769<=e&&e<=52795||52797<=e&&e<=52823||52825<=e&&e<=52851||52853<=e&&e<=52879||52881<=e&&e<=52907||52909<=e&&e<=52935||52937<=e&&e<=52963||52965<=e&&e<=52991||52993<=e&&e<=53019||53021<=e&&e<=53047||53049<=e&&e<=53075||53077<=e&&e<=53103||53105<=e&&e<=53131||53133<=e&&e<=53159||53161<=e&&e<=53187||53189<=e&&e<=53215||53217<=e&&e<=53243||53245<=e&&e<=53271||53273<=e&&e<=53299||53301<=e&&e<=53327||53329<=e&&e<=53355||53357<=e&&e<=53383||53385<=e&&e<=53411||53413<=e&&e<=53439||53441<=e&&e<=53467||53469<=e&&e<=53495||53497<=e&&e<=53523||53525<=e&&e<=53551||53553<=e&&e<=53579||53581<=e&&e<=53607||53609<=e&&e<=53635||53637<=e&&e<=53663||53665<=e&&e<=53691||53693<=e&&e<=53719||53721<=e&&e<=53747||53749<=e&&e<=53775||53777<=e&&e<=53803||53805<=e&&e<=53831||53833<=e&&e<=53859||53861<=e&&e<=53887||53889<=e&&e<=53915||53917<=e&&e<=53943||53945<=e&&e<=53971||53973<=e&&e<=53999||54001<=e&&e<=54027||54029<=e&&e<=54055||54057<=e&&e<=54083||54085<=e&&e<=54111||54113<=e&&e<=54139||54141<=e&&e<=54167||54169<=e&&e<=54195||54197<=e&&e<=54223||54225<=e&&e<=54251||54253<=e&&e<=54279||54281<=e&&e<=54307||54309<=e&&e<=54335||54337<=e&&e<=54363||54365<=e&&e<=54391||54393<=e&&e<=54419||54421<=e&&e<=54447||54449<=e&&e<=54475||54477<=e&&e<=54503||54505<=e&&e<=54531||54533<=e&&e<=54559||54561<=e&&e<=54587||54589<=e&&e<=54615||54617<=e&&e<=54643||54645<=e&&e<=54671||54673<=e&&e<=54699||54701<=e&&e<=54727||54729<=e&&e<=54755||54757<=e&&e<=54783||54785<=e&&e<=54811||54813<=e&&e<=54839||54841<=e&&e<=54867||54869<=e&&e<=54895||54897<=e&&e<=54923||54925<=e&&e<=54951||54953<=e&&e<=54979||54981<=e&&e<=55007||55009<=e&&e<=55035||55037<=e&&e<=55063||55065<=e&&e<=55091||55093<=e&&e<=55119||55121<=e&&e<=55147||55149<=e&&e<=55175||55177<=e&&e<=55203?n.LVT:9757==e||9977==e||9994<=e&&e<=9997||127877==e||127938<=e&&e<=127940||127943==e||127946<=e&&e<=127948||128066<=e&&e<=128067||128070<=e&&e<=128080||128110==e||128112<=e&&e<=128120||128124==e||128129<=e&&e<=128131||128133<=e&&e<=128135||128170==e||128372<=e&&e<=128373||128378==e||128400==e||128405<=e&&e<=128406||128581<=e&&e<=128583||128587<=e&&e<=128591||128675==e||128692<=e&&e<=128694||128704==e||128716==e||129304<=e&&e<=129308||129310<=e&&e<=129311||129318==e||129328<=e&&e<=129337||129341<=e&&e<=129342||129489<=e&&e<=129501?n.E_Base:127995<=e&&e<=127999?n.E_Modifier:8205==e?n.ZWJ:9792==e||9794==e||9877<=e&&e<=9878||9992==e||10084==e||127752==e||127806==e||127859==e||127891==e||127908==e||127912==e||127979==e||127981==e||128139==e||128187<=e&&e<=128188||128295==e||128300==e||128488==e||128640==e||128658==e?n.Glue_After_Zwj:128102<=e&&e<=128105?n.E_Base_GAZ:n.Other},getGraphemeBreakProperty:function(e){if(null!=n.BreakPropertyCache[e])return n.BreakPropertyCache[e];var t=n._getGraphemeBreakProperty(e);return n.BreakPropertyCache[e]=t,t}}}),n)},"6NRR":function(e,t,o){var n,r,i,a=t,l=o("oAGj"),s=o("VQVe"),u=o("SpAV"),c=o("gXiO"),h=o("ascj"),d=o("FNB+"),g=o("URxh"),p=o("6ZWm"),f=o("cmoc"),m=o("P83h"),y=o("pnSN"),v=o("SDdr"),S=o("lmwz"),C=o("fNpk"),T=o("c+uM"),A=o("tGKA"),F=o("K17h"),k=o("djAF"),L=o("enh0"),b=o("8t9B"),_=o("90dd"),R=o("RkYL"),I=o("xm77"),w=o("zjod");a.KeyFrameSet=(n=function(){},l.defineClass({name:"KeyFrameSet",ctor:n}),n),a.AnimationRequestStopMessage=(r=function e(t){_.TheoMessage.call(this,e.TYPE,t)},l.defineClass({name:"AnimationRequestStopMessage",ctor:r,superName:"TheoMessage",statics:{TYPE:{get:function(){return"AnimationRequestStopMessage"}}}}),r),a.AnimationController=(i=function(e){this.staticStateTransaction_=null,this.page_=e,this.staticState_={},this.playing_=!1,this.postAnimationCallbacks_=null,c.CoreObject.call(this)},l.defineClass({name:"AnimationController",ctor:i,superName:"CoreObject",props:{playing:{get:function(){return this.playing_},set:function(e){this.playing_=e}},hasVideos:{get:function(){var e;return!!(e=this.page_)&&e.root.filterWithCallback((function(e){return e instanceof w.VideoForma})).length>0}},hasTrueVideos:{get:function(){var e;return!!(e=this.page_)&&e.root.filterWithCallback((function(e){var t;return!!(t=l.as(e,w.VideoForma))&&!t.isSticker()})).length>0}},hasAnimation:{get:function(){return this.hasVideos||this.hasAnimatedFormae}},hasAnimatedFormae:{get:function(){return null!=this.animationStyle&&!this.animationStyle.isNoStyle()&&!!(e=this.page_)&&0==!l.clone(e.root.filterWithCallback((function(e){return null!=e.animation||e.isVideo()}))).length;var e}},gifStartTimeIndex:{get:function(){var e,t;if((e=this.animationStyle)&&(t=this.page_)){var o=l.clone(t.root.filterWithCallback((function(e){return e instanceof w.VideoForma&&e.videoContentNode.isGIF})));if(0==o.length)return 0;for(var n=e.startTime.seconds,r=l.iter(o);!r.done;r.next()){var i,a=r.value;(i=l.opt(a.animation,(function(e){return e.keyFrames})))&&i.length>1&&(n=Math.max(n,i[1].time.seconds))}for(var s=l.clone(this.times),u=l.iter(l.range(0,s.length-1,!1));!u.done;u.next()){var c=u.value;if(n>=s[c].seconds&&n<s[c+1].seconds)return c}}return 0}},animationStyle:{get:function(){var e;return(e=this.page_)?F.MotionUtils.getCurrentAnimationStyle(e):null},set:function(e){var t,o=e;if(null==o&&(o=s.AnimationStyle.init_b946(s.AnimationStyle.NAME_NO_STYLE)),t=this.page_){var n=new m.AnimationStyleChangedEvent(t.root);t.root.beginUpdate(n),t.animationLibrary.modifyModelForAnimation(o,t.root),t.root.endUpdate(n)}}},isCurrentAnimationValid:{get:function(){return F.MotionUtils.isCurrentAnimationValid(this.page_)}},duration:{get:function(){return l.last(this.times)||R.TheoTime.Zero}},times:{get:function(){var e;if(e=this.animationStyle){for(var t=[],o=e.endTime.value,n=l.toInt(e.endTime.timescale/s.AnimationStyle.DEFAULT_TIMESCALE),r=l.iter(l.stride(0,o,n));!r.done;r.next()){var i=r.value;t.push(new R.TheoTime(i,e.endTime.timescale))}return 0==t.length&&this.page_.root.visitAll(d.FormaTraversal.PreOrder,(function(e){var o,n;(o=l.as(e,w.VideoForma))&&(n=l.opt(o.videoContentNode,(function(e){return e.times})))&&(t=l.clone(n))})),t}return[]}},preAnimation:function(){C.LegacyCoreAssert.isTrue(null==this.staticStateTransaction_,"preAnimation called with outstanding animation transaction",void 0,"AnimationController.preAnimation","AnimationController.swift",200),this.staticStateTransaction_=this.page_.document.beginTransaction("Animation")},postAnimation:function(){l.opt(this.staticStateTransaction_,(function(e){return e.rollback()})),this.staticStateTransaction_=null},processStopAnimationCallbacks:function(){var e;if(e=this.postAnimationCallbacks_){for(var t=l.iter(e);!t.done;t.next())(0,t.value)();this.postAnimationCallbacks_=null}},saveStaticState:function(){var e=this;this.staticState_={},this.page_.root.visitAll(d.FormaTraversal.PreOrder,(function(t){if(null!=t.animation){var o=t.style.clone(),n=new g.KeyFrame(R.TheoTime.Zero,I.TimingFunctionType.Linear,t.placement,t.bounds,o);null!=o&&t.kind==w.VideoForma.KIND&&0==o.opacity&&l.info("opacity is 0?"),e.staticState_[t.formaID]=n}}))},revertToStaticState:function(){var e;if(null!=this.page_){if(e=this.staticState_)for(var t=l.iter(e);!t.done;t.next()){var o,n,r=t.key,i=t.value;if((o=l.opt(this.page_,(function(e){return e.formaByID(r)})))&&null!=i.style&&(n=l.as(o,L.TextForma))){var a=new m.FormaStyleChangedEvent(n);n.beginUpdate(a),n.renderRuns.clear(),n.endUpdate(a)}}}else u.CoreAssertDebugOnly.fail("no page. really?",void 0,"AnimationController.revertToStaticState","AnimationController.swift",245)},determineKeyFrameSetForTime:function(e,t){var o=new a.KeyFrameSet,n=e.keyFrames.length;if(n>0){for(var r=t.seconds,i=l.iter(l.toSequence(e.keyFrames));!i.done;i.next()){var s=i.value,u=s.offset,c=s.element;if(c.time.seconds>=r){o.kfB=c,u>0&&(o.kfA=e.keyFrames[u-1]);break}}null==o.kfB&&(o.kfA=e.keyFrames[n-1])}return o},determineAlpha:function(e,t){var o=1;if(null!=e.kfB&&null!=e.kfA){var n=new I.TheoTimingFunction(e.kfB.timingFunction),r=(t.seconds-e.kfA.time.seconds)/(e.kfB.time.seconds-e.kfA.time.seconds);o=n.evalX(r)}return o},determinePlacementShift:function(e,t){var o,n,r=A.Matrix2D.Identity;return(o=l.opt(e.kfA,(function(e){return e.placement})))?r=(n=l.opt(e.kfB,(function(e){return e.placement})))?o.interpolateWith(n,t):o:(n=l.opt(e.kfB,(function(e){return e.placement})))&&(r=n),r},moveToTime:function(e){var t=this;if(null==this.page_)return u.CoreAssertDebugOnly.fail("no page. really?",void 0,"AnimationController.moveToTime","AnimationController.swift",328),!1;if(null==this.staticState_)return C.LegacyCoreAssert.fail("no static state defined",void 0,"AnimationController.moveToTime","AnimationController.swift",333),!1;var o,n=!1;if(o=this.page_){var r=new m.FormaStyleChangedEvent(o.root);o.beginUpdate(r),o.root.visitAll(d.FormaTraversal.PreOrder,(function(o){var r,i;if((r=o.animation)&&(i=t.staticState_[o.formaID])){var a=t.determineKeyFrameSetForTime(r,e);if(null!=a.kfA||null!=a.kfB){n=!0;var u,c,h,g=t.determineAlpha(a,e),C=i.placement,A=t.determinePlacementShift(a,g);o.placement=C.concat(A),(u=l.opt(a.kfA,(function(e){return e.bounds})))&&(c=l.opt(a.kfB,(function(e){return e.bounds})))&&(u.equalWithAccuracy(c,.01)||(o.bounds=u.interpolateWith(c,g),(h=l.as(o.controller,p.FrameController))&&h.fitChildrenToFrame()));var F=l.opt(a.kfA,(function(e){return e.style})),_=l.opt(a.kfB,(function(e){return e.style}));if(null==F&&null==_)return;null==F?F=_:null==_&&(_=F);var R,I,w,D=new m.FormaStyleChangedEvent(o);if(o.beginUpdate(D),t.setBlendedRoles(o.style.colors,F.colors,_.colors,g),(R=l.as(F,T.LockupStyle))&&(I=l.as(_,T.LockupStyle))&&(w=l.as(o.style,T.LockupStyle)))for(var x=l.keys(w.characterStyles),P=l.iter(x);!P.done;P.next()){var E,M,N,G=P.value;(E=R.characterStyles[G])&&(M=I.characterStyles[G])&&(N=w.characterStyles[G])&&t.setBlendedRoles(N.colors,E.colors,M.colors,g)}var B,O=(1-g)*F.opacity+g*_.opacity,U=l.as(l.opt(l.opt(l.as(o,L.TextForma),(function(e){return e.lockupForma})),(function(e){return e.controller})),b.TypeLockupController);if(o.isTypeLockup()||null!=U){var H,z,Y,W=O,V=O;if((H=l.as(F,T.LockupStyle))&&(z=l.as(_,T.LockupStyle))&&(W=(1-g)*H.textOpacity+g*z.textOpacity,V=(1-g)*H.backingOpacity+g*z.backingOpacity),o.kind==k.ShapeForma.KIND)l.opt(o.parent,(function(e){return e.style.opacity=V}));else if(Y=l.as(o,L.TextForma))if(r.animationStyle.modifiesFormaTree){o.style.opacity=W;var K=(a.kfB||a.kfA).renderRuns;null!=a.kfB&&null!=a.kfA&&a.kfA.renderRuns.fillColors.runArrays.length>1&&0==K.fillColors.runArrays.length?Y.renderRuns.setAlphaFromAnimation(a.kfA.renderRuns,K,g):Y.renderRuns=K.clone()}else o.style.opacity=W;else o.kind==y.GroupForma.KIND&&o.visitAll(d.FormaTraversal.PreOrder,(function(e){e instanceof L.TextForma&&l.opt(e.parent,(function(e){return e.style.opacity=W})),e instanceof k.ShapeForma&&l.opt(e.parent,(function(e){return e.style.opacity=V}))}))}else if(o.kind==f.FrameForma.KIND){var X;(X=S.ImageFacade.getImageFormaForForma(o))&&(X.style.opacity=O)}else o.style.opacity=O;if(null!=F.filter&&null!=_.filter)if(r.animationStyle.name==s.AnimationStyle.NAME_BLUR){if(B=F.clone()){B.colorLibrary=F.colorLibrary;var j=F.filter.blurRadius,q=_.filter.blurRadius;B.filter.blurRadius=(1-g)*j+g*q,o.applyStyle(B)}}else if(!l.opt(F.filter,(function(e){return e.equals(_.filter)}))){var Z=v.AlphaBlendFilter.init_fa22(void 0,g,F.filter,_.filter);Z.style=o.style,o.style.filter=Z}o.endUpdate(D)}}}));var i=o.root,a=new m.AnimationTimeChangedEvent(i,e);i.beginUpdate(a),i.endUpdate(a),o.endUpdate(r)}return n},setBlendedRoles:function(e,t,o,n){var r,i;(r=t.fieldPrimary)&&(i=o.fieldPrimary)&&e.setBlendedColor(h.ColorRole.FieldPrimary,r,i,n),(r=t.fieldSecondary)&&(i=o.fieldSecondary)&&e.setBlendedColor(h.ColorRole.FieldSecondary,r,i,n)},stopWithCallback:function(e){var t;if(this.playing_){if(null==this.postAnimationCallbacks_?this.postAnimationCallbacks_=[e]:this.postAnimationCallbacks_.push(e),t=this.page_){var o=new a.AnimationRequestStopMessage(t);t.publish(o)}}else e()}}}),i)},"6ZWm":function(e,t,o){var n,r=t,i=o("oAGj"),a=o("KSe6"),l=o("SpAV"),s=o("CWW7"),u=o("yGNn"),c=o("AVHO"),h=o("Ohrj"),d=o("ascj"),g=o("O60Y"),p=o("wNKJ"),f=o("FNB+"),m=o("yHU1"),y=o("Pil/"),v=o("cmoc"),S=o("16hp"),C=o("OYRJ"),T=o("OdB2"),A=o("QbzR"),F=o("JEzR"),k=o("P83h"),L=o("9Lk3"),b=o("ZK0l"),_=o("x35w"),R=o("X0GW"),I=o("ZhwN"),w=o("iCxV"),D=o("Qlvz"),x=o("NkBu"),P=o("U010"),E=o("q5zr"),M=o("fdtz"),N=o("lmwz"),G=o("fNpk"),B=o("hywZ"),O=o("tGKA"),U=o("3DEm"),H=o("358a"),z=o("K0Rh"),Y=o("7Ta2"),W=o("JO5d"),V=o("Zifs"),K=o("djAF"),X=o("35Q0"),j=o("T6jX"),q=o("fAXt"),Z=o("MnRR"),J=o("oKlP"),Q=o("sIWg"),$=o("1NAc"),ee=o("sW6f"),te=o("zjod");r.FitType=i.defineEnum("FitType",{None:0,ProportionalFit:1,ProportionalFill:2,Stretch:3}),r.CropType=i.defineEnum("CropType",{ScaleCrop:0,FitBorder:1,FillFocus:2,ExtremeCloseup:3,AbstractCloseup:4,PreserveFocus:5,PreserveFocusAndScale:6}),r.FrameController=(n=function(e,t,o){this.fitting_=r.FitType.None,this.cropType_=null,this.preCropModeLayerIndex_=null,b.GroupController.call(this,e,t,o)},i.defineClass({name:"FrameController",ctor:n,superName:"GroupController",statics:{IMAGE_FITTING_PROPERTY:"image-fitting",CROP_MODE_LAYER:"crop-mode-layer",KIND:{get:function(){return"frame"}},resizeBoundsWithPin:function(e,t,o){var n=e;return 0==o.x?n=new Q.TheoRect(n.minX,n.minY,n.minX+t.width,n.maxY):1==o.x&&(n=new Q.TheoRect(n.maxX-t.width,n.minY,n.maxX,n.maxY)),0==o.y?n=new Q.TheoRect(n.minX,n.minY,n.maxX,n.minY+t.height):1==o.y&&(n=new Q.TheoRect(n.minX,n.maxY-t.height,n.maxX,n.maxY)),n}},props:{moveable:{get:function(){var e;return!((e=i.opt(i.opt(i.opt(this.forma,(function(e){return e.page.document})),(function(e){return e.controller})),(function(e){return e.selection})))&&e.isSelected(this.forma)&&e.inCropMode)&&this.floating}},floating:{get:function(){var e,t;return null!=(e=i.opt(this.forma,(function(e){return e.allowUserMove})))?e:!!(t=this.forma)&&(t.isLogo()||t.isSticker()||i.opt(i.as(t,v.FrameForma),(function(e){return 1==e.hasAlpha()})))}},selectable:{get:function(){return!0}},duplicatable:{get:function(){return this.floating}},rotateable:{get:function(){return!0}},flippable:{get:function(){return!i.opt(this.forma,(function(e){return 1==e.isLogo()}))}},nudgeable:{get:function(){return!0}},image:{get:function(){return N.ImageFacade.getImageFormaForForma(this.forma)}},mask:{get:function(){return N.ImageFacade.getMaskFormaForForma(this.forma)}},cutoutMode:{get:function(){return N.ImageFacade.getCutoutModeForForma(this.forma)}},cutout:{get:function(){if(this.cutoutMode==P.CutoutMode.Off)return null;var e=N.ImageFacade.getCutoutMaskFormaForForma(this.forma);return G.LegacyCoreAssert.isTrue(null!=e,"Could not find cutout mask forma.",void 0,"FrameController","FrameController.swift",125),e}},hasCutout:{get:function(){return N.ImageFacade.getCutoutModeForForma(this.forma)!=P.CutoutMode.Off}},hasBackgroundColor:{get:function(){return this.hasCutout&&i.opt(this.forma,(function(e){return null!=e.style.colors.fieldPrimary}))}},fitting:{get:function(){var e;if(null!=(e=i.as(this.controllerMetadata.get(n.IMAGE_FITTING_PROPERTY),"String")))switch(e){case"cover":return r.FitType.ProportionalFill;case"contain":return r.FitType.ProportionalFit;case"stretch":return r.FitType.Stretch}return r.FitType.None},set:function(e){var t;switch(e){case 2:t="cover";break;case 1:t="contain";break;case 3:t="stretch";break;default:t="none"}this.controllerMetadata.set(n.IMAGE_FITTING_PROPERTY,t)}},copyTo:function(e,t,o,n){var r,a,s;if(void 0===e&&(e=null),void 0===t&&(t=null),void 0===o&&(o=null),void 0===n&&(n=!0),(r=i.opt(this.forma,(function(e){return e.page})))&&(a=i.as(this.forma,v.FrameForma))&&(s=N.ImageFacade.getImageFormaForForma(a))){var c,h,d,g,p,f=e||r,m=s.contentNode,y=null;if((c=i.as(s,te.VideoForma))&&(m=c.videoContentNode,y=c.contentNode),f.document!=r.document&&((h=i.as(m,E.ImageContentNode))&&(g=f.document)?m=h.copyTo(g):(d=i.as(m,ee.VideoContentNode))&&(g=f.document)?m=d.copyTo(g):(l.CoreAssertDebugOnly.fail("FrameController does not currently support this content kind",void 0,"FrameController.copyTo","FrameController.swift",203),f=r)),p=m)return this.copyUsingContent(p,y,a,s,f,t)}return u.CorePromise.resolve(null)},copyUsingContent:function(e,t,o,n,r,l){var c;void 0===t&&(t=null),void 0===l&&(l=null);var h=this.moveable?s.FloatingImageStrategy.Always:s.FloatingImageStrategy.IfHasAlphaOrIsLogo,d=new s.AddFormaParams(void 0,(c=l)||null!=c?c:s.AddFormaParams.DEFAULTS.suggestPlacement,void 0,h,void 0,void 0,o.page!=r);return s.CreationFacade.addContent(r,e,t,void 0,d).then((function(e){var t;if(t=i.as(e,f.Forma)){var l,s,c=new k.FormaAnimationTransactionEvent(t);return c.duration=0,t.beginUpdate(c),t.match(o),(l=i.as(t,v.FrameForma))&&(s=N.ImageFacade.getImageFormaForForma(l))&&(s.match(n),s.placement=n.placement),r.document&&a.AnimationLibrary.updateCurrentStyle(r,t.isVideo()),t.endUpdate(c),t}return u.CorePromise.reject("Failed to get forma from addContent")}))},flip:function(e){var t;void 0===e&&(e=!1),this.floating?q.TransformFacade.flipForma(this.forma,e):(t=N.ImageFacade.getImageFormaForForma(this.forma))&&(q.TransformFacade.flipForma(t,e),this.updateParentGroup())},rotate:function(e){var t;void 0===e&&(e=Math.PI/180),this.floating&&!N.ImageFacade.inCropMode(this.forma)?q.TransformFacade.rotateForma(this.forma,e):(t=N.ImageFacade.getImageFormaForForma(this.forma))&&(q.TransformFacade.rotateForma(t,e),this.updateParentGroup())},rotation:function(){return this.floating?this.forma.rotation():(e=N.ImageFacade.getImageFormaForForma(this.forma))?e.rotation():0;var e},nudge:function(e){var t;this.floating?q.TransformFacade.translateForma(this.forma,e):(t=N.ImageFacade.getImageFormaForForma(this.forma))&&(q.TransformFacade.translateForma(t,e),this.updateParentGroup())},selectionHandlePositions:{get:function(){var e,t=!this.moveable;N.ImageFacade.inCropMode(this.forma)&&(t=!this.maintainAspectRatio,(e=i.opt(this.mask,(function(e){return e.controller})))&&e.maintainAspectRatio&&(t=!1));var o=[new J.TheoPoint(.5,0),new J.TheoPoint(.5,1),new J.TheoPoint(1,.5),new J.TheoPoint(0,.5)];return!this.floating&&this.forma.isGridCell()?o:t?o.concat(b.GroupController._getters.selectionHandlePositions.call(this)):b.GroupController._getters.selectionHandlePositions.call(this)}},processEvent:function(e){var t;return(t=i.as(e,y.BeginPointerTrackingEvent))?(t.trackingResponse=this.moveable?m.BeginPointerTrackingResponseEnum.TrackAsGroup:m.BeginPointerTrackingResponseEnum.TrackWithinGroup,!1):b.GroupController.prototype.processEvent.call(this,e)},processFormaDoubleClick:function(e){if(!N.ImageFacade.inCropMode(this.forma)&&(this.owner.selection.replaceSelection(e.forma),this.owner.selection.isSelected(e.forma)))for(var t=i.iter(e.forma.visitAsArray(f.FormaTraversal.JustChildren));!t.done;t.next()){var o,n=t.value;(o=i.as(n.controller,x.ImageController))&&(this.owner.controllerSettingsState.settings=new c.ImageControllerSettings(o))}},processEndFormaDrag:function(e){var t,o;if(t=i.opt(this.owner,(function(e){return e.document}))){var n=H.PagesFacade.getActivePage(t);n.publish(new T.EndFormaDragMessage(n))}this.fitChildrenToFrame(),(o=i.as(i.opt(this.forma.parent,(function(e){return e.controller})),L.GridController))&&o.processChildEndFormaDrag(e)},processBeginFormaDrag:function(e){var t;b.GroupController.prototype.processBeginFormaDrag.call(this,e),(t=i.as(i.opt(this.forma.parent,(function(e){return e.controller})),L.GridController))&&t.processChildBeginFormaDrag(this.forma,e)},afterProcessBeginFormaDrag:function(e){var t;(t=i.as(i.opt(this.forma.parent,(function(e){return e.controller})),L.GridController))&&t.processChildBeginFormaDrag(this.forma,e)},clipLineToRectWithTransform:function(e,t,o){var n=o,r=o.transformValues,a=Math.atan2(r.rotSine,r.rotCosine);Math.abs(a)<.01&&(n=O.Matrix2D.scalingXY(r.xscale,r.yscale).skewTo(r.skew).translateXY(r.tx,r.ty));for(var l=[t.horizontalLine(0).transform(n),t.horizontalLine(1).transform(n),t.verticalLine(0).transform(n),t.verticalLine(1).transform(n)],s=i.iter(l);!s.done;s.next()){var u,c=s.value;if(u=c.intersection(e)){var h=e.locate(u),d=c.locate(u);if(h>=.01&&h<=1&&d>=0&&d<=1)return new Z.TheoLine(e.p1,u)}}return e},constrainFrameSizeToImage:function(e,t,o){var r,a,l=this,s=t;if((r=i.opt(this.forma_,(function(e){return e.bounds})))&&(a=e.bounds)){var u=n.resizeBoundsWithPin(r,t,o),c=u.horizontalLine(0),h=u.horizontalLine(1),d=u.verticalLine(0),g=u.verticalLine(1),p=[],f=!1,m=!1;if(.5==o.x)f=!0,p=i.clone(0==o.y?[d,g]:[d.reverse(),g.reverse()]);else if(.5==o.y)m=!0,p=i.clone(0==o.x?[c,h]:[c.reverse(),h.reverse()]);else if(o.x==o.y){var y=new Z.TheoLine(new J.TheoPoint(u.minX,u.minY),new J.TheoPoint(u.maxX,u.maxY));p=0==o.x?[y,c,d]:[y.reverse(),h.reverse(),g.reverse()]}else y=new Z.TheoLine(new J.TheoPoint(u.minX,u.maxY),new J.TheoPoint(u.maxX,u.minY)),p=0==o.x?[y,h,d.reverse()]:[y.reverse(),c.reverse(),g];var v=p.map((function(t){return l.clipLineToRectWithTransform(t,a,e.placement)}),this),S=u.height,C=u.width;if(f)S=v.reduce((function(e,t){return Math.min(e,t.length)}),1e5);else if(m)C=v.reduce((function(e,t){return Math.min(e,t.length)}),1e5);else{for(var T=1e5,A=i.iter(i.toSequence(p));!A.done;A.next()){var F=A.value,k=F.offset,L=F.element,b=i.as(v[k],Z.TheoLine).length/L.length;b<T&&(T=b)}C*=T,S*=T}s=new $.TheoSize(C,S)}return s},processFormaResize:function(e){var t,o,r,a,l,s;if((t=i.as(this.forma,v.FrameForma))&&(o=N.ImageFacade.getImageFormaForForma(t))&&(r=t.bounds)&&(a=i.opt(i.opt(t.page.document,(function(e){return e.controller})),(function(e){return e.selection})))&&(l=e.pin)&&(s=e.newSize)){var u=new k.FormaAnimationTransactionEvent(t);u.duration=0,t.beginUpdate(u);var c=[],h=this.maintainAspectRatio||.5!=l.x&&.5!=l.y;if(a.inCropMode){if(s=h?r.size.myAspectRatioClosestCorner(s):s,o.hasAlpha()){var d=n.resizeBoundsWithPin(r,s,l).insetXY(15,15);if(!Q.TheoRect.PointInCommon(o.bounds,O._asterisk_Matrix2D_Matrix2D(o.totalPlacement,t.totalPlacement.inverse),d))return void t.endUpdate(u);e.newSize=s}else e.newSize=this.constrainFrameSizeToImage(o,s,l);for(var g=i.iter(t.visitAsArray(f.FormaTraversal.JustChildren));!g.done;g.next()){var p=g.value;c.push(p),t.root.appendChild(p,!0)}}b.GroupController.prototype.processFormaResize.call(this,e);for(var m=i.iter(c);!m.done;m.next())p=m.value,t.appendChild(p,!0);this.fitChildrenToFrame(),a.inCropMode&&this.updateCropModeImage(),t.endUpdate(u)}},processEndFormaResize:function(e){var t;if(b.GroupController.prototype.processEndFormaResize.call(this,e),this.updateParentGroup(),t=N.ImageFacade.getImageFormaForForma(this.forma)){var o=new k.FormaForceRerenderPseudoChangeEvent(t);t.beginUpdate(o),t.endUpdate(o)}},processFormaDrag:function(e){var t;b.GroupController.prototype.processFormaDrag.call(this,e),(t=i.as(i.opt(this.forma.parent,(function(e){return e.controller})),L.GridController))&&t.processChildFormaDrag(this.forma,e)},afterProcessFormaDrag:function(e){var t;(t=i.as(i.opt(this.forma.parent,(function(e){return e.controller})),L.GridController))&&t.processChildFormaDrag(this.forma,e)},childUpdate:function(e){void 0===e&&(e=null),b.GroupController.prototype.childUpdate.call(this,e),this.blockUpdate||(this.fitChildrenToFrame(),this.updateCropModeImage())},shuffleColorAssignment:function(){var e,t,o,r;if((t=i.as(this.forma,v.FrameForma))&&(o=i.opt(this.forma,(function(e){return e.style})))&&(r=i.as(t.controller,n))){if(t.isLogo())return;var a=this.getCurrentColors(o).length,l=o.colors.color(d.ColorRole.FieldPrimary),s=!(e=i.opt(l,(function(e){return e.isEqual(V.SolidColor.ZERO)})))&&null==e||e,u=a>0&&r.hasCutout&&!s,c=t.page.colorLibraryController;if(u){var g=[],p=null;if(j.TheoDocumentUtils.enableFastHeuristicsForComplexPage(this.forma.page)){var f=r.floating?Y.InferredRoleType.GraphicContent:Y.InferredRoleType.Background;p=i.clone(Y.InferredRole.init_84d1(f,1,Y.InferredRoleType.Background,0))}var m,y=new h.ProfilingPrimaryColorSelector(t,!1).selectColorForGlobalRecolor(void 0,void 0,void 0,p);if((m=c.getTheoColorForKey(y))&&g.push(m),a>1){var S,C=new h.ProfilingBackgroundColorSelector(t,!0).selectColorForGlobalRecolor(void 0,void 0,void 0,p);(S=c.getTheoColorForKey(C))&&g.push(S)}this.applyColors(g)}}},updateCropModeImage:function(){var e,t,o,n,r;N.ImageFacade.inCropMode(this.forma)&&(t=N.ImageFacade.getImageFormaForForma(this.forma))&&(o=N.ImageFacade.getTempCropImageForForma(this.forma))&&(w.Host.platform.isWeb&&!o.bounds.equal(t.bounds)?(this.cleanupCropVisualization(),this.enterCropMode()):((e=i.opt(o.controller,(function(e){return e.userGroupChild})))||null!=e)&&e?(n=o.parent)&&null!=(r=n.indexOfChild(o))&&(i.opt(o.root,(function(e){return e.appendChild(o,!0)})),o.placement=t.totalPlacement,n.insertChildAt(o,r,!0)):o.placement=t.totalPlacement)},updateAfterChildTransform:function(){this.updateParentGroup(),this.fitChildrenToFrame(),this.updateCropModeImage()},enterCropMode:function(){if(N.ImageFacade.inCropMode(this.forma)){if(null!=N.ImageFacade.getTempCropImageForForma(this.forma))return;this.preCropModeLayerIndex_=this.createCropVisualization()}},createCropVisualization:function(){var e,t=new k.FormaAnimationTransactionEvent(this.forma);t.duration=0,this.forma.beginUpdate(t);var o,n,r,a,l,s=null,u=I.GUIDUtils.makeGUID(),c=I.GUIDUtils.makeGUID();if((o=this.forma.parent)&&null!=(n=o.indexOfChild(this.forma))&&(e=n,o.removeChild(this.forma),o.appendChild(this.forma),s=g.DBLink.init_8408(u,this.forma.database,o.parent.id)),(r=N.ImageFacade.getImageFormaForForma(this.forma))&&(a=i.as(this.forma.forkToDatabase(u,!1,this.forma.database,s),v.FrameForma))&&(l=i.as(r.forkToDatabase(c,!1,this.forma.database,g.DBLink.init_8408(c,this.forma.database,a.id)),M.ImageForma))){l.setParent(a),a.setParent(null),a.appendChild(l,!0);var h,d,p,m,y=I.GUIDUtils.makeGUID();(h=this.forma)&&(d=N.ImageFacade.getCutoutMaskFormaForForma(h))&&(p=i.as(d.forkToDatabase(y,!1,this.forma.database,g.DBLink.init_8408(y,this.forma.database,a.id)),M.ImageForma))&&(N.ImageFacade.setCutoutForForma(a,p),N.ImageFacade.setCutoutModeForForma(a,N.ImageFacade.getCutoutModeForForma(h))),(m=i.as(l,te.VideoForma))&&(m.mode=te.VideoMode.stillImage),a.intent=f.Forma.INTENT_TEMP_IMAGE_CROP,a.bounds=l.bounds,a.placement=r.totalPlacement,a.isModel=!1,N.ImageFacade.setMaskForForma(a,null),l.placement=O.Matrix2D.Identity,l.style.opacity=.4*l.style.opacity,this.forma.parent.insertBefore(a,this.forma,!0);var S=[];S.push(l);var C,T=new k.FormaInsertedChildrenEvent(a,S,0);a.beginUpdate(T),a.endUpdate(T),(C=i.as(this.forma.page.createFormaWithController(K.ShapeForma.KIND,W.ShapeController.KIND),K.ShapeForma))&&(X.ShapeLibrary.applyToShapeForma(C,X.ShapeLibrary.Square),C.bounds=i.opt(this.forma.root,(function(e){return e.bounds})),C.style.opacity=.5,C.style.colors.fieldPrimary=V.SolidColor.BLACK,C.intent=f.Forma.INTENT_TEMP_IMAGE_CROP,C.allowUserMove=!1,this.forma.parent.insertBefore(C,a,!0))}return this.forma.endUpdate(t),e},cleanupCropVisualization:function(){var e,t=[];if(s=i.opt(this.forma,(function(e){return e.parent})))for(var o=i.iter(s.visitAsArray(f.FormaTraversal.JustChildren));!o.done;o.next())(l=o.value).hasIntent(f.Forma.INTENT_TEMP_IMAGE_CROP)&&t.push(l);if(null!=this.preCropModeLayerIndex_||0!=t.length){var n,r=new k.FormaAnimationTransactionEvent(this.forma);r.duration=0,this.forma.beginUpdate(r);for(var a=i.iter(t);!a.done;a.next()){var l;(l=a.value).removeFromParent(),l.destroy()}if((s=i.opt(this.forma,(function(e){return e.parent})))&&null!=(n=this.preCropModeLayerIndex_)&&(s.removeChild(this.forma),s.insertChildAt(this.forma,n)),this.preCropModeLayerIndex_=null,this.forma.endUpdate(r),this.userGroupChild)for(var s=i.opt(this.forma,(function(e){return e.parent}));((e=i.opt(i.opt(s,(function(e){return e.controller})),(function(e){return e.userGroup})))||null!=e)&&e;)R.GroupFacade.updateUserGroupBounds(s),s=i.opt(s,(function(e){return e.parent}))}},match:function(e){b.GroupController.prototype.match.call(this,e),this.cleanupCropVisualization()},setBoundsWithCropType:function(e,t){this.cropType_=t,i.opt(this.forma,(function(t){return t.bounds=Q.TheoRect.fromSize(e.size)})),this.cropType_=null},fit:function(e){this.fitWithCrop(e)},fitWithCrop:function(e,t){var o,n;void 0===t&&(t=null),this.cropType_=t,(o=this.forma)&&(n=o.bounds)&&(o.placement=O.Matrix2D.Identity,o.bounds=Q.TheoRect.fromSize(this.maintainAspectRatio?e.fitAspectRatioWithin(n.aspectRatio):e.size),o.moveCenterToPoint(e.center)),this.cropType_=null},getCurrentCropType:function(e,t){var o,n,i;if(null!=(o=this.cropType_))return o;if(this.forma.isSticker())return r.CropType.FitBorder;if((n=e)&&(i=t)){var a=Math.abs(n.aspectRatio-i.aspectRatio)<1e-4;return this.maintainAspectRatio&&a?r.CropType.ScaleCrop:this.forma.isGridCell()||this.userGroupChild?r.CropType.PreserveFocus:r.CropType.PreserveFocusAndScale}return r.CropType.PreserveFocus},setChildrenCropping:function(e,t){var o=this;this.forma.visitAll(f.FormaTraversal.JustChildren,(function(n){var r;(r=i.as(n.controller,x.ImageController))&&null!=n.bounds&&r.setCrop(o.forma.bounds,t,e)})),this.fitChildrenToFrame()},isBackgroundImageWithAlpha:function(){var e,t,o=!1;return(e=this.forma)&&(t=this.image)&&(o=e.isBackgroundImage()&&(t.hasAlpha()||this.hasCutout)),o},canHaveNoneFillColor:function(){return this.floating&&this.hasCutout},fitChildrenToFrame:function(e){void 0===e&&(e=!1);var t,o,n=this;if(this.forma.visitAll(f.FormaTraversal.JustChildrenAndAuxiliaries,(function(t){var o,r;if(null!=t.bounds&&null!=n.forma.bounds)if(o=i.as(t,M.ImageForma)){if(!o.hasIntent(f.Forma.INTENT_IMAGE_MASK)){i.opt(o.animation,(function(e){return e.invalidate()}));var a=o.hasAlpha();if(e||!a||o.hasIntent(f.Forma.INTENT_PATTERN))n.ensureFormaFillsFrame(o,e);else{var l,s=1;(l=i.opt(o.page.view,(function(e){return e.getViewportTransform()})))&&(s=Math.sqrt(Math.abs(l.determinant)));var u=n.userGroupMember?.01:30;n.beginBlockedUpdate(),p.DragFacade.rescueToArbitraryBounds(o,n.forma.bounds,n.forma.totalPlacement,36/s,u/s),n.endBlockedUpdate()}}}else if(r=i.as(t,K.ShapeForma)){var c=n.forma.bounds;r.size=c.size,r.placement=O.Matrix2D.Identity}})),(t=N.ImageFacade.getImageFormaForForma(this.forma))&&(o=t.bounds)){var r,a,l;if((r=i.as(N.ImageFacade.getMaskFormaForForma(this.forma),M.ImageForma))&&(a=r.bounds)){var s=o.transform(t.placement);r.placement=O.Matrix2D.Identity.scaleXY(s.width/a.width,s.height/a.height).translateXY(t.placement.tx,t.placement.ty)}(l=N.ImageFacade.getCutoutMaskFormaForForma(this.forma))&&N.ImageFacade.updateCutoutMaskPlacement(this.forma,l)}},ensureFormaFillsFrame:function(e,t){void 0===t&&(t=!1);var o=this.forma.bounds.transform(e.placement.inverse),n=o.height/e.bounds.height,r=o.width/e.bounds.width,i=U.MathUtils.maxDouble(r,n);(i>1||t)&&(e.move(O.Matrix2D.uniformScaling(i)),o=this.forma.bounds.transform(e.placement.inverse)),o.minX<e.bounds.minX&&(e.placement=e.placement.precat(O.Matrix2D.translationXY(o.minX-e.bounds.minX,0)),o=this.forma.bounds.transform(e.placement.inverse)),o.maxX>e.bounds.maxX&&(e.placement=e.placement.precat(O.Matrix2D.translationXY(o.maxX-e.bounds.maxX,0)),o=this.forma.bounds.transform(e.placement.inverse)),o.minY<e.bounds.minY&&(e.placement=e.placement.precat(O.Matrix2D.translationXY(0,o.minY-e.bounds.minY)),o=this.forma.bounds.transform(e.placement.inverse)),o.maxY>e.bounds.maxY&&(e.placement=e.placement.precat(O.Matrix2D.translationXY(0,o.maxY-e.bounds.maxY)),o=this.forma.bounds.transform(e.placement.inverse))},isImageCropped:function(){var e,t,o;return!!((e=i.opt(this.forma,(function(e){return e.bounds})))&&(t=N.ImageFacade.getImageFormaForForma(this.forma))&&(o=t.bounds))&&!o.transform(t.placement).equalWithAccuracy(e,.001)},getAverageEdgeGrid:function(e,t){void 0===t&&(t=!0);var o,n=[];if(o=this.forma.frame)for(var r=new $.TheoSize(o.width/e.width,o.height/e.height),a=i.iter(i.range(0,i.toInt(e.width),!1));!a.done;a.next())for(var l=a.value,s=i.iter(i.range(0,i.toInt(e.height),!1));!s.done;s.next()){var u=s.value,c=Q.TheoRect.fromXYWH(i.toDouble(l)*r.width+o.origin.x,i.toDouble(u)*r.height+o.origin.y,r.width,r.height),h=this.getAverageEdge(c);n.push(h)}if(t){for(var d=[],g=1e-5,p=i.iter(n);!p.done;p.next())g+=h=p.value;for(var f=i.iter(n);!f.done;f.next())h=f.value,d.push(h/g);return d}return n},getAverageEdge:function(e){var t,o=0;if(t=this.forma){var n=e.transform(t.totalPlacement.inverse);t.visitAll(f.FormaTraversal.JustChildren,(function(e){var t;(t=i.as(e,M.ImageForma))&&(o+=t.getAverageEdge(n))}))}return o},getFaceIntersections:function(e){var t,o=0;if(t=this.forma){var n=e.transform(t.totalPlacement.inverse);t.visitAll(f.FormaTraversal.JustChildren,(function(e){var t;(t=i.as(e,M.ImageForma))&&(o+=t.getFaceIntersections(n))}))}return o},getAverageColor:function(e){var t;if(t=this.forma){var o,n,r,i,a=e.transform(t.placement.inverse);if((o=N.ImageFacade.getImageFormaForForma(t))&&(n=o.getAverageColor(a)))return(r=N.ImageFacade.getCutoutMaskFormaForForma(this.forma))&&(i=r.getAverageColor(a))?new V.SolidColor(n.red,n.green,n.blue,i.red):n}return null},maintainAspectRatio:{get:function(){var e,t=N.ImageFacade.inCropMode(this.forma);return t&&(e=i.opt(this.mask,(function(e){return e.controller})))?e.maintainAspectRatio:this.floating&&!(t&&N.ImageFacade.usesFreeformCropPreset(this.forma))}},clip:{get:function(){return!0}},placeAsLogo:function(e){var t,o,n,a;if(void 0===e&&(e=null),(t=i.as(this.forma,v.FrameForma))&&(o=t.root)&&(n=N.ImageFacade.getImageFormaForForma(t))&&(a=n.bounds)&&n.isLogo()){var l=.12*Math.max(o.finalFrame.height,o.finalFrame.width);a.aspectRatio>1?this.fitWithCrop(new Q.TheoRect(0,0,l,l/a.aspectRatio),r.CropType.FitBorder):this.fitWithCrop(new Q.TheoRect(0,0,l*a.aspectRatio,l),r.CropType.FitBorder);var s=new k.FormaTransformChangedEvent(t);if(null!=e){var u=o.frame.minX+e.x,c=o.frame.minY+e.y,h=o.frame.width/4,d=o.frame.height/4,g=Math.min(h,d),p=new Q.TheoRect(u-g/2,c-g/2,u+g/2,c+g/2);s.duration=0,t.beginUpdate(s),i.opt(t.controller,(function(e){return e.fit(p)})),t.endUpdate(s)}else{var f;(f=new B.LogoPlacementSuggester(t,o).fastPlacement())&&(s.duration=0,t.beginUpdate(s),f.apply(),t.endUpdate(s))}this.bringToForeground()}},bringToForeground:function(){var e,t;(e=i.as(this.forma,v.FrameForma))&&(t=e.parent)&&(t.removeChild(e),t.appendChild(e))},addForma:function(e,t,o){var a,l,c,h;if((a=i.as(e.root,z.RootForma))&&(l=i.as(t,v.FrameForma))&&(c=N.ImageFacade.getImageFormaForForma(l))&&(h=_.GridFacade.getPageGrid(t.page,!0))){if(null==c.frame||o.parentingHint==s.AddFormaParentingHint.addToRoot)return a.appendChild(t),u.CorePromise.resolve(null);var d=!1;if(o.floatingImageStrategy==s.FloatingImageStrategy.Always?(d=!0,c.isLogo()||(c.intent=f.Forma.INTENT_FLOATING_IMAGE)):o.floatingImageStrategy==s.FloatingImageStrategy.IfHasAlphaOrIsLogo&&(c.isLogo()||c.hasAlpha())&&(d=!0),l.allowUserMove=d,o.crossPageCopy||d)h.forma.appendChild(l);else{for(var g=i.clone(a.filterWithCallback((function(e){return e.isBackgroundImage()}))),p=i.iter(g);!p.done;p.next()){var m,y=p.value;if(m=N.ImageFacade.getImageStyleForForma(y)){var T=m.clone();T.adjustments=D.ImageAdjustments.createDefault(),N.ImageFacade.applyImageStyle(T,[c])}}h.addFormaToGroup(l)}var A=1==a.filterWithCallback((function(e){return N.ImageFacade.isPotentialBackgroundImage(e)})).length;if(d){if(!c.isLogo())return new u.CorePromise((function(e,s){var u;(u=i.opt(c.contentNode,(function(e){return e.image})))?u.whenLoaded().then((function(s){var u;if(u=o.atPagePoint){var c=a.frame.minX+u.x,h=a.frame.minY+u.y,d=a.frame.width/4,g=a.frame.height/4,p=Math.min(d,g),f=new Q.TheoRect(c-p/2,h-p/2,c+p/2,h+p/2);i.opt(t.controller,(function(e){return e.fit(f)}))}else if(o.suggestPlacement){var m,y,v=new S.FormaPlacementSuggester(t,a);(m=i.as(v.fastPlacement(),C.FormaPlacementSuggestion))&&(y=i.as(l.controller,n))&&y.fitWithCrop(m.location,r.CropType.FitBorder)}else i.opt(t.controller,(function(e){return e.fit(a.frame.insetRel(.25,.25,.25,.25))}));return A&&a.page.colorLibraryController.extractImageColors(),e(null)})):e(null)}));i.as(l.controller,n).placeAsLogo(o.atPagePoint)}else if(A)return new u.CorePromise((function(e,t){var o;if(!(o=i.opt(c.contentNode,(function(e){return e.image}))))return e(null);o.whenLoaded().then((function(t){return a.page.colorLibraryController.extractImageColors(),e(null)}))}));return u.CorePromise.resolve(null)}return u.CorePromise.reject("couldn't get critical references")},getCurrentColors:function(e){var t;if(t=this.forma)for(var o=i.iter(t.visitAsArray(f.FormaTraversal.JustChildren));!o.done;o.next()){var n=o.value;if(n.kind==M.ImageForma.KIND)return n.controller.getCurrentColors(e)}return[]},replaceWithColoredShape:function(){var e,t,o;return(e=this.forma)&&(t=i.as(e.page.createFormaWithController(K.ShapeForma.KIND,W.ShapeController.KIND),K.ShapeForma))&&(X.ShapeLibrary.applyToShapeForma(t,X.ShapeLibrary.Square),t.contentID=null,t.preScale=null,t.allowUserMove=!1,(o=e.parent)&&(o.controller.replaceChildWithForma(e,t),null!=o.indexOfChild(t)&&null==e.parent))?t:null},replaceable:{get:function(){return!0}},cropSizeCheck:function(){var e,t;(e=this.forma)&&(t=e.finalFrame)&&(e.visitAll(f.FormaTraversal.JustChildren,(function(o){var n,a;(n=i.as(o.controller,x.ImageController))&&(a=o.finalFrame)&&t.area<.4*a.area&&n.setCrop(e.bounds,null,r.CropType.FitBorder)})),this.fitChildrenToFrame())},postDecode:function(){var e;(e=i.opt(this.forma,(function(e){return e.style})))&&e.kind==A.FormaStyle.KIND&&i.opt(this.forma,(function(t){return t.applyStyle(F.FrameStyle.init_6c45(e.opacity,e.colors.clone()))}))},containsPoint:function(e,t){return void 0===t&&(t=0),!!b.GroupController.prototype.containsPoint.call(this,e,t)&&(!(o=i.as(this.mask,K.ShapeForma))||o.containsPoint(e));var o},applyOpacity:function(e){for(var t=i.iter(this.forma.visitAsArray(f.FormaTraversal.JustChildren));!t.done;t.next()){var o=t.value;i.opt(o.controller,(function(t){return t.applyOpacity(e)}))}},annotations:{get:function(){return i.opt(i.opt(this.image,(function(e){return e.controller})),(function(e){return e.annotations}))}}}}),n)},"6vbT":function(e,t,o){o("oAGj")},"70fJ":function(e,t,o){var n,r,i=t,a=o("oAGj"),l=o("Tq01"),s=o("SpAV"),u=o("gpZI"),c=o("yGNn"),h=o("ascj"),d=o("R0Y+"),g=o("fNpk"),p=o("Zifs"),f=o("fiuZ"),m=o("Kkml");i.ApplyColorAction=(n=function e(t,o,n,r){void 0===n&&(n=!1),void 0===r&&(r=0),this.formaeToColor=a.clone(t),this.colors=a.clone(o),this.inCharStyleMode=n,this.shuffleIndex=r,this.suggestedSelection=[],this.shouldUpdateSelection=!1,l.Action.call(this,e.TYPE)},a.defineClass({name:"ApplyColorAction",ctor:n,superName:"Action",statics:{TYPE:"ApplyColorAction"},props:{getUserAction:function(e){var t,o;return t=(o=this.formaeToColor)?o.map((function(e){return e.formaID}),this):a.clone(e.selection.IDs),m.UserActions.ChangeColor(t.join(","))},execute:function(e){var t,o=a.clone(this.formaeToColor||e.selection.asFormaArray());if(g.LegacyCoreAssert.isTrue(o.length>0,"empty Forma array",void 0,"ApplyColorAction.execute","ColorActions.swift",55),t=this.colors)this.suggestedSelection=a.clone(u.ColorFacade.applyColorsToFormae(o,t,this.inCharStyleMode,this.shuffleIndex));else for(var n=a.iter(o);!n.done;n.next()){var r;(r=(s=n.value).controller)&&(r.primaryColorVisible()?(u.ColorFacade.applyNoneColorToFormae([s],h.ColorRole.FieldPrimary),this.suggestedSelection.push(s)):r.secondaryColorVisible()&&(u.ColorFacade.applyNoneColorToFormae([s],h.ColorRole.FieldSecondary),this.suggestedSelection.push(s)))}this.shouldUpdateSelection=!1;for(var i=a.iter(o);!i.done;i.next()){var s=i.value;this.shouldUpdateSelection=this.shouldUpdateSelection||e.selection.isSelected(s)}return c.CorePromise.resolve(new l.FormaActionResult(this.suggestedSelection))},updateSelection:function(e){return!this.inCharStyleMode&&this.shouldUpdateSelection&&(e.selection.IDs=this.suggestedSelection.map((function(e){return e.formaID}),this)),this.suggestedSelection}}}),n),i.ApplyColorWithRoleAction=(r=function e(t,o,n,r){void 0===n&&(n=!1),void 0===r&&(r=0),this.formaeToColor=a.clone(t),this.theoColorsWithRole=a.clone(o),this.inCharStyleMode=n,this.shuffleOffset=r,l.Action.call(this,e.TYPE)},a.defineClass({name:"ApplyColorWithRoleAction",ctor:r,superName:"Action",statics:{TYPE:"ApplyColorWithRoleAction"},props:{getUserAction:function(e){var t,o;return t=(o=this.formaeToColor)?o.map((function(e){return e.formaID}),this):a.clone(e.selection.IDs),m.UserActions.ChangeColor(t.join(","))},execute:function(e){var t=a.clone(this.formaeToColor||e.selection.asFormaArray());s.CoreAssert.isTrue(t.length>0,"empty Forma array",void 0,"ApplyColorWithRoleAction.execute","ColorActions.swift",139);var o=a.clone(this.shuffleColors(this.theoColorsWithRole,this.shuffleOffset)),n=a.clone(u.ColorFacade.applyColorsWithRoleToFormae(t,o,this.inCharStyleMode)),r=1==o.length&&o[0].role==h.ColorRole.FieldPrimary&&a.eq(p._equality_SolidColor_SolidColor,o[0].color.rgbColor,p.SolidColor.ZERO);return(this.shuffleOffset>0||r)&&f.ShapeFacade.applyStrokeMultiplierIfZeroStroke(t),f.ShapeFacade.applyZeroStrokeMultiplierIfNone(t),o[0].role!=h.ColorRole.FieldSecondary||o[0].color.rgbColor.isEqual(p.SolidColor.ZERO)||f.ShapeFacade.applyBorderIfBorderIsZero(t),this.inCharStyleMode||(e.selection.IDs=n.map((function(e){return e.formaID}),this)),c.CorePromise.resolve(new l.FormaActionResult(n))},shuffleColors:function(e,t){var o=[],n=e.length,r=t%n;if(n<=1||0==r)return e;for(var i=a.iter(a.range(0,n,!1));!i.done;i.next()){var l=i.value,s=(l-r)%n;s<0&&(s+=n),o.push(new d.TheoColorWithRole(e[l].role,e[s].color))}return o}}}),r)},"7S/6":function(e,t,o){var n,r=t,i=o("oAGj"),a=o("H3ZP"),l=o("nQ/X"),s=o("qUXk"),u=o("01gE"),c=o("fNpk"),h=o("3nOH"),d=o("QLFD"),g=o("25Jq");r.DesignControllerFactory=(n=function(){},i.defineClass({name:"DesignControllerFactory",ctor:n,props:{getNewDesignController:function(e){var t,o,n,r;return(r=this.owner)?n=0==r.selection.selectedCount?new d.NoSelectionDesignController(r,e):r.selection.inCharStyleMode?new l.CharStyleModeDesignController(r,e):1==r.selection.selectedCountInDocument?r.selection.inCropMode?new a.CropModeDesignController(r,e):!(t=i.opt(i.opt(r.selection.formaAt(0),(function(e){return e.controller})),(function(e){return e.userGroupMember})))&&null==t||!t||r.enableMoveableChildren&&(!(o=i.opt(i.opt(r.selection.formaAt(0),(function(e){return e.controller})),(function(e){return e.userGroup})))&&null==o||!o)?new g.SingleSelectionDesignController(r,e):new u.GroupSelectionDesignController(r,e):new h.MultiSelectionDesignController(r,e):(c.LegacyCoreAssert.fail("owner has gone out of scope, yet we are still asking to create design controllers",void 0,"DesignControllerFactory.getNewDesignController","DesignControllerFactory.swift",44),n=new s.DesignController),n}}}),n)},"7Ta2":function(e,t,o){var n,r,i,a=t,l=o("oAGj"),s=o("gXiO"),u=o("6ZWm"),c=o("iCxV"),h=o("2Srg"),d=o("ws+m"),g=o("fNpk"),p=o("xRbc"),f=o("zbwF"),m=o("nrTo"),y=o("JO5d"),v=o("ERpL"),S=o("lYNH"),C=o("8t9B");a.RoleSuggesterProtocol=l.defineProtocol("RoleSuggesterProtocol",{getRole:"(RoleData) -> InferredRole"}),a.RoleSuggester=(n=function(){s.CoreObject.call(this)},r={},l.defineClass({name:"RoleSuggester",ctor:n,superName:"CoreObject",statics:{cache:{get:function(){var e;return void 0===r.cache&&(r.cache=((e=l.opt(c.Host.platform,(function(e){return e.isService})))||null!=e)&&e?l.opt(c.Host.learning,(function(e){return e.getHostPredictionCache()})):new m.PredictionCacheInferredRole),r.cache},set:function(e){r.cache=e}},ROLE_SHORT_LABELS:{Undefined:"udf",Title:"ttl",Subtitle:"stl",BodyText:"bdy",ContactInfo:"ctc",SocialMediaReference:"soc",Quote:"qot",CalltoAction:"act",GraphicContent:"gct",Seperator:"sep",Backing:"bkg",Background:"bgd",Decoration:"dec",Logo:"log"},getShortLabel:function(e){var t;return null!=(t=n.ROLE_SHORT_LABELS[e])?t:(g.LegacyCoreAssert.fail("didn't find role in short label dictionary!",void 0,"RoleSuggester.getShortLabel","RoleSuggester.swift",120),"???")}},props:{getRole:function(e){var t,o,r,i,s,g,m=null,T=null;if(l.as(e.controller,C.TypeLockupController)&&(o=p.LockupRoleData.getLockupRoleData(e))&&(m=o,T=f.LockupRoleSuggesterFactory.Create("MLP"),l.clone(T.getRole(o)).role==a.InferredRoleType.Undefined&&(T=f.LockupRoleSuggesterFactory.Create())),e.controller instanceof y.ShapeController&&(r=v.ShapeRoleData.getShapeRoleData(e))&&(m=r,T=e.isGridCell()?S.ShapeRoleSuggesterFactory.Create("Simple"):S.ShapeRoleSuggesterFactory.Create("MLP")),l.as(e.controller,u.FrameController)&&(i=h.ImageRoleData.getImageRoleData(e))&&(m=i,T=d.ImageRoleSuggesterFactory.Create("Simple")),(s=m)&&(g=T)){var A=s.getUniqueKey();return((t=l.opt(c.Host.platform,(function(e){return e.isService})))||null!=t)&&t||n.cache.cleanup(e.page.document.uuid),null==n.cache.getCacheValue(A)&&n.cache.setCacheValue(A,this.getRoleForData(s,g)),n.cache.getCacheValue(A)}return a.InferredRole.init_84d1()},getRoleForData:function(e,t){var o=l.clone(t.getRole(e));return g.LegacyCoreAssert.isTrue(null!=n.ROLE_SHORT_LABELS[o.role],"no label for role",void 0,"RoleSuggester.getRoleForData","RoleSuggester.swift",92),g.LegacyCoreAssert.isTrue(null!=n.ROLE_SHORT_LABELS[o.secondaryRole],"no label for secondary role",void 0,"RoleSuggester.getRoleForData","RoleSuggester.swift",93),o}}}),n),a.InferredRoleType=l.defineEnum("InferredRoleType",{Undefined:"Undefined",Title:"Title",SubTitle:"Subtitle",Body:"BodyText",Contact:"ContactInfo",Social:"SocialMediaReference",Quote:"Quote",Action:"CalltoAction",GraphicContent:"GraphicContent",Seperator:"Seperator",Backing:"Backing",Background:"Background",Decoration:"Decoration",Logo:"Logo"}),a.InferredRole=(i=function(){},l.defineClass({name:"InferredRole",ctor:i,props:{init_84d1:function(e,t,o,n){void 0===e&&(e=a.InferredRoleType.Undefined),void 0===t&&(t=0),void 0===o&&(o=a.InferredRoleType.Undefined),void 0===n&&(n=0),this.role=e,this.confidence=t,this.secondaryRole=o,this.secondaryConfidence=n},init_implicit:function(e,t,o,n){this.role=e,this.confidence=t,this.secondaryRole=o,this.secondaryConfidence=n},clone:function(){return i.init_implicit(this.role,this.confidence,this.secondaryRole,this.secondaryConfidence)}}}),i)},"7l9C":function(e,t,o){var n,r,i,a,l,s,u=t,c=o("oAGj"),h=o("SpAV"),d=o("gXiO"),g=o("fNpk"),p=o("tGKA"),f=o("3DEm"),m=o("ol4x"),y=o("oKlP"),v=o("sIWg");u.AlignmentIdiom=c.defineEnum("AlignmentIdiom",{LRBB:0,LLtb:1,LLbt:2,RRtb:3,RRbt:4,CCtb:5,CCbt:6,LRtb:7,LRbt:8,RLtb:9,LRtt:10,RLtt:11,LRbb:12,RLbb:13,LRmm:14,cCCtb:15,cLCtb:16,cRCtb:17,LRctt:18,LRcbb:19,LLtbo:20,RRtbo:21,LLbto:22,LRott:23}),u.ChildVertOrientation=c.defineEnum("ChildVertOrientation",{LeftAbove:0,RightAbove:1,Topside:2,BottomSide:3}),u.GlyphType=c.defineEnum("GlyphType",{GENERIC:0,DROPCAP:1,PUNCTUATION:2,SYMBOL:3}),u.NodeMeasurements=(n=function(e,t,o){this.node=e,this.minY=t,this.maxY=o},c.defineClass({name:"NodeMeasurements",ctor:n}),n),u.ReflowType=c.defineEnum("ReflowType",{TOP:0,BOTTOM:1,FULL:2,FIT:3}),u.TypographyNode=(r=function(){this.parent=null,this.globalMat=p.Matrix2D.Identity,this.transMat=p.Matrix2D.Identity,this.scaleMat=p.Matrix2D.Identity,this.rotateMat=p.Matrix2D.Identity,this.rotateAlign=0,this.scaleAlign=1,d.CoreObject.call(this)},c.defineClass({name:"TypographyNode",ctor:r,superName:"CoreObject",statics:{Clockwise:90,CounterClockwise:270,getLeadingAdjustment:function(){return 1+2*m.TypographyLayout.lineSpacing}},props:{isSame:function(e){return this.getId()==e.getId()},getRoot:function(){for(var e=this;null!=e.parent;)e=e.parent;return e},getWeight:function(){return g.LegacyCoreAssert.fail("Calling an abstract method.",void 0,"TypographyNode.getWeight","TypographyNode.swift",115),0},resetScale:function(){this.scaleAlign=1},propagateDown:function(e){},transformToLocalBounds:function(e){var t=this.local(),o=t.transformPoint(new y.TheoPoint(e.minX,e.minY)),n=t.transformPoint(new y.TheoPoint(e.maxX,e.minY)),r=t.transformPoint(new y.TheoPoint(e.maxX,e.maxY)),i=t.transformPoint(new y.TheoPoint(e.minX,e.maxY)),a=f.MathUtils.minDouble(f.MathUtils.minDouble(f.MathUtils.minDouble(o.x,n.x),r.x),i.x),l=f.MathUtils.maxDouble(f.MathUtils.maxDouble(f.MathUtils.maxDouble(o.x,n.x),r.x),i.x),s=f.MathUtils.minDouble(f.MathUtils.minDouble(f.MathUtils.minDouble(o.y,n.y),r.y),i.y),u=f.MathUtils.maxDouble(f.MathUtils.maxDouble(f.MathUtils.maxDouble(o.y,n.y),r.y),i.y);return new v.TheoRect(a,s,l,u)},transformTo:function(e,t){if(e.getId()==this.getId())return new v.TheoRect(t.minX,t.minY,t.maxX,t.maxY);for(var o=t,n=this.parent;null!=n&&n.getId()!=e.getId();)o=n.transformToLocalBounds(o),n=n.parent;return g.LegacyCoreAssert.isTrue(null!=n,"did not find node with requested id",void 0,"TypographyNode.transformTo","TypographyNode.swift",155),e.getId()!=this.getId()&&(o=e.transformToLocalBounds(o)),o},translateXY:function(e,t){this.transMat=this.transMat.translate(new y.TheoPoint(e,t))},rotateTo:function(e){var t=e*Math.PI/180;this.rotateMat=p.Matrix2D.Identity.rotateTo(Math.cos(t),Math.sin(t))},scaleXY:function(e){this.scaleMat=p.Matrix2D.Identity.scaleXY(e,e)},local:function(){return this.scaleMat.concat(this.rotateMat).concat(this.transMat)},global:function(){return this.globalMat},isRotated:function(){return 0!=this.rotateAlign},childrenRotated:function(){return this.isRotated()},getId:function(){return g.LegacyCoreAssert.fail("Calling an abstract method.",void 0,"TypographyNode.getId","TypographyNode.swift",192),null},localbounds:function(){return g.LegacyCoreAssert.fail("Calling an abstract method.",void 0,"TypographyNode.localbounds","TypographyNode.swift",197),null},getHSpace:function(){return g.LegacyCoreAssert.fail("Calling an abstract method.",void 0,"TypographyNode.getHSpace","TypographyNode.swift",202),0},getMinHSpace:function(){return g.LegacyCoreAssert.fail("Calling an abstreact method.",void 0,"TypographyNode.getMinHSpace","TypographyNode.swift",207),0},getMargin:function(){return g.LegacyCoreAssert.fail("Calling an abstreact method.",void 0,"TypographyNode.getMargin","TypographyNode.swift",212),0},getAscent:function(){return g.LegacyCoreAssert.fail("Calling an abstract method.",void 0,"TypographyNode.getAscent","TypographyNode.swift",227),0},getDescent:function(){return g.LegacyCoreAssert.fail("Calling an abstract method.",void 0,"TypographyNode.getDescent","TypographyNode.swift",232),0},getLeading:function(){return g.LegacyCoreAssert.fail("Calling an abstract method.",void 0,"TypographyNode.getLeading","TypographyNode.swift",237),0},getBaseline:function(){return g.LegacyCoreAssert.fail("Calling an abstract method.",void 0,"TypographyNode.getBaseline","TypographyNode.swift",242),0},getMidline:function(){return this.localbounds().height/2},getSemanticWidth:function(){return g.LegacyCoreAssert.fail("Calling an abstract method.",void 0,"TypographyNode.getSemanticWidth","TypographyNode.swift",251),0},getRightmostTextNode:function(){return null},getLeftmostTextNode:function(){return null},depthFirstSearch:function(e){},calcTransform:function(){this.rotateTo(this.rotateAlign),this.scaleXY(this.scaleAlign)},getConcatScale:function(){return this.scaleAlign},getTextNodes:function(){return[]},getText:function(){return""},getLines:function(){return[this]},description:{get:function(){var e="  ",t="";if(null==this.parent)t="ROOT:";else{for(var o=this.parent;null!=o;)o=o.parent,e+="  ";t+=e,this.isSame(this.parent.getChild(!0))?t+="LEFT:":t+="RIGHT:"}this instanceof u.SpacerNode?t+="SpacerNode ":this instanceof u.TextNode?t+="TextNode ":t+="GroupNode ",t+="id ="+this.getId()+" < "+this.getText()+" >",t+=c.toString(" weight:%.0f ",c.toDouble(this.getWeight())),this instanceof u.GroupNode&&(t+=" align: "+c.toString(this.transAlign)+" ");var n=this.localbounds();return t+=c.toString(" bounds:[x:%.2f",n.minX)+c.toString(" y:%.2f",n.minY)+c.toString(" w:%.2f",n.width)+c.toString(" h:%.2f]",n.height)+c.toString(" | scale:%.2f",this.scaleAlign)+c.toString(" | rotate:%.2f",this.rotateAlign),t+=c.toString(" | leading:%.2f",this.getLeading())+c.toString(" | baseline:%.2f",this.getBaseline())+"\r\n"}}}}),r),u.TextToken=(i=function(e,t,o,n,r,i,a,l,s,u){this.text=e,this.bounds=o,this.midline=n,this.hspace=r,this.ascent=i,this.descent=a,this.leading=l,this.preVertOffset=s,this.postVertOffset=u,this.weight=t,this.styleWeight=0,this.isGlyph=!1,this.range=null},c.defineClass({name:"TextToken",ctor:i,statics:{symbols:["$","","","","","%"],punctuation:["!","?",'"',"'","","","",""],getGlyphType:function(e){return i.symbols.includes(e)?u.GlyphType.SYMBOL:i.punctuation.includes(e)?u.GlyphType.PUNCTUATION:u.GlyphType.GENERIC}}}),i),u.SpacerNode=(a=function(e,t){this.id_=e,this.size_=t,u.TypographyNode.call(this)},c.defineClass({name:"SpacerNode",ctor:a,superName:"TypographyNode",props:{getId:function(){return".S"+c.toString(this.id_)},getWeight:function(){return 0},localbounds:function(){return this.transformToLocalBounds(new v.TheoRect(0,0,this.size_.width,this.size_.height))},getHSpace:function(){return 0},getMinHSpace:function(){return 0},getMargin:function(){return 0},getAscent:function(){return 0},getDescent:function(){return 0},getLeading:function(){return 0},getBaseline:function(){return this.localbounds().height},getSemanticWidth:function(){return this.localbounds().width/2}}}),a),u.TextNode=(l=function(e,t){this.token_=e,this.id_=t,u.TypographyNode.call(this)},c.defineClass({name:"TextNode",ctor:l,superName:"TypographyNode",props:{getId:function(){return"."+c.toString(this.id_)},setToken:function(e){this.token_=e},getWeight:function(){return this.token_.weight},localbounds:function(){return this.transformToLocalBounds(this.token_.bounds)},globalbounds:function(){var e=this.global(),t=this.token_.bounds,o=e.transformPoint(new y.TheoPoint(t.minX,t.minY)),n=e.transformPoint(new y.TheoPoint(t.maxX,t.minY)),r=e.transformPoint(new y.TheoPoint(t.maxX,t.maxY)),i=e.transformPoint(new y.TheoPoint(t.minX,t.maxY)),a=f.MathUtils.minDouble(f.MathUtils.minDouble(f.MathUtils.minDouble(o.x,n.x),r.x),i.x),l=f.MathUtils.maxDouble(f.MathUtils.maxDouble(f.MathUtils.maxDouble(o.x,n.x),r.x),i.x),s=f.MathUtils.minDouble(f.MathUtils.minDouble(f.MathUtils.minDouble(o.y,n.y),r.y),i.y),u=f.MathUtils.maxDouble(f.MathUtils.maxDouble(f.MathUtils.maxDouble(o.y,n.y),r.y),i.y);return new v.TheoRect(a,s,l,u)},getHSpace:function(){return this.token_.hspace*this.scaleMat.a},getMinHSpace:function(){return this.getHSpace()},getMargin:function(){return.3*this.token_.leading*this.scaleMat.a},getAscent:function(){return this.token_.ascent*this.scaleMat.d},getDescent:function(){return this.token_.descent*this.scaleMat.d},getLeading:function(){return this.token_.leading*this.scaleMat.d},getBaseline:function(){return this.isRotated()?this.localbounds().height:this.token_.ascent*this.scaleMat.d},getMidline:function(){return this.isRotated()?u.TypographyNode.prototype.getMidline.call(this):this.token_.midline*this.scaleMat.d},getSemanticWidth:function(){return this.localbounds().width/2},getVerticalOffset:function(){return this.token_.preVertOffset},getRightmostTextNode:function(){return this},getLeftmostTextNode:function(){return this},depthFirstSearch:function(e){e.push(this)},getTextNodes:function(){return[this]},getText:function(){return this.token_.text}}}),l),u.GroupNode=(s=function(e,t){this.leftChild=e,this.rightChild=t,this.transAlign=u.AlignmentIdiom.LRBB,this.cachedWeight=0,this.dirtyWeight=!0,this.cachedID="",this.dirtyID=!0,u.TypographyNode.call(this),e.parent=this,t.parent=this},c.defineClass({name:"GroupNode",ctor:s,superName:"TypographyNode",props:{getChild:function(e){return e?this.leftChild:this.rightChild},setChild:function(e,t){t?this.leftChild=e:this.rightChild=e,e.parent=this;for(var o=this;null!=o;)o.dirtyID=!0,o.dirtyWeight=!0,o=o.parent},getId:function(){return this.dirtyID&&(this.cachedID=this.leftChild.getId()+this.rightChild.getId(),this.dirtyID=!1),this.cachedID},getWeight:function(){if(this.dirtyWeight){var e=this.leftChild.getWeight();e==this.rightChild.getWeight()?this.cachedWeight=e:this.cachedWeight=-1,this.dirtyWeight=!1}return this.cachedWeight},localbounds:function(){var e=this.leftChild.localbounds(),t=new v.TheoRect(e.minX,e.minY,e.maxX,e.maxY);e=this.rightChild.localbounds();var o=new v.TheoRect(e.minX,e.minY,e.maxX,e.maxY);return this.transformToLocalBounds(new v.TheoRect(f.MathUtils.minDouble(t.minX,o.minX),f.MathUtils.minDouble(t.minY,o.minY),f.MathUtils.maxDouble(t.maxX,o.maxX),f.MathUtils.maxDouble(t.maxY,o.maxY)))},childrenRotated:function(){return this.isRotated()||this.leftChild.childrenRotated()||this.rightChild.childrenRotated()},getHSpace:function(){return this.scaleMat.a*f.MathUtils.maxDouble(this.leftChild.getHSpace(),this.rightChild.getHSpace())},getMinHSpace:function(){return this.leftChild instanceof u.SpacerNode?this.scaleMat.a*this.rightChild.getMinHSpace():this.rightChild instanceof u.SpacerNode?this.scaleMat.a*this.leftChild.getMinHSpace():this.scaleMat.a*f.MathUtils.minDouble(this.leftChild.getMinHSpace(),this.rightChild.getMinHSpace())},getMargin:function(){return this.scaleMat.a*f.MathUtils.minDouble(this.leftChild.getMargin(),this.rightChild.getMargin())},getLeading:function(){var e;switch(this.transAlign){case 1:case 3:case 5:case 7:case 16:case 17:case 15:e=this.rightChild.getLeading();break;case 2:case 4:case 6:case 8:e=this.leftChild.getLeading();break;default:e=f.MathUtils.maxDouble(this.leftChild.getLeading(),this.rightChild.getLeading())}return this.scaleMat.d*e},getInternalHSpace:function(){return this.leftChild instanceof u.SpacerNode?this.rightChild.getMinHSpace():this.rightChild instanceof u.SpacerNode?this.leftChild.getMinHSpace():f.MathUtils.minDouble(this.leftChild.getMinHSpace(),this.rightChild.getMinHSpace())},getInternalVSpace:function(e){if(this.getTextNodes().length>1&&!this.childrenRotated()&&f.MathUtils.absDouble(this.leftChild.scaleAlign-this.rightChild.scaleAlign)<.1){var t,o,n=c.clone(this.leftChild.getTextNodes()),r=c.clone(this.rightChild.getTextNodes()),i=0,a=0,l=0,s=0;if(e){if(a=n[0].getDescent(),o=n[0].getLeading(),n.length>1){s=n[0].localbounds().maxY;for(var h=c.iter(c.range(1,n.length-1,!0));!h.done;h.next())n[m=h.value].localbounds().maxY>s&&(s=n[m].localbounds().maxY,a=n[m].getDescent(),o=n[m].getLeading())}if(i=r[0].getAscent(),t=r[0].getLeading(),r.length>1){l=r[0].localbounds().minY;for(var d=c.iter(c.range(1,r.length-1,!0));!d.done;d.next())r[m=d.value].localbounds().minY<l&&(l=r[m].localbounds().minY,i=r[m].getAscent(),t=r[m].getLeading())}}else{if(a=r[0].getDescent(),o=r[0].getLeading(),r.length>1){s=r[0].localbounds().maxY;for(var g=c.iter(c.range(1,r.length-1,!0));!g.done;g.next())r[m=g.value].localbounds().maxY>s&&(s=r[m].localbounds().maxY,a=r[m].getDescent(),o=r[m].getLeading())}if(i=n[0].getAscent(),t=n[0].getLeading(),n.length>1){l=n[0].localbounds().minY;for(var p=c.iter(c.range(1,n.length-1,!0));!p.done;p.next()){var m;n[m=p.value].localbounds().minY<l&&(l=n[m].localbounds().minY,i=n[m].getAscent(),t=n[m].getLeading())}}}var y=f.MathUtils.minDouble(t,o);return f.MathUtils.absDouble(t-o)/y>.2?f.MathUtils.minDouble(1.2*this.leftChild.getMargin(),this.rightChild.getMargin())*u.TypographyNode.getLeadingAdjustment():f.MathUtils.maxDouble(0,1.2*y*u.TypographyNode.getLeadingAdjustment()-(i+a))}return f.MathUtils.minDouble(1.2*this.leftChild.getMargin(),this.rightChild.getMargin())*u.TypographyNode.getLeadingAdjustment()},getConcatScale:function(){for(var e=this.scaleAlign,t=c.clone(this.getTextNodes()),o=c.iter(t);!o.done;o.next()){for(var n=o.value,r=n.parent,i=n.scaleAlign;r.getId()!=this.getId();)i*=r.scaleAlign,r=r.parent;i>e&&(e=i)}return e},getBaseline:function(){if(this.isRotated())return this.localbounds().height;var e=this.leftChild.localbounds(),t=this.transformToLocalBounds(new v.TheoRect(e.minX,e.minY,e.maxX,e.minY+this.leftChild.getBaseline()));e=this.rightChild.localbounds();var o=this.transformToLocalBounds(new v.TheoRect(e.minX,e.minY,e.maxX,e.minY+this.rightChild.getBaseline()));return e=this.localbounds(),f.MathUtils.maxDouble(t.maxY,o.maxY)-e.minY},getSemanticWidth:function(){if(this.getWeight()<0){for(var e=this.rightChild;e.getWeight()<0;)e=e.rightChild;for(var t=e.parent.leftChild,o=t.localbounds().minX<e.localbounds().minX?t:e,n=o.localbounds();!o.isSame(this);)n=(o=o.parent).transformToLocalBounds(n);return n.maxX-this.localbounds().minX}return this.localbounds().width/2},getMidline:function(){return this.isRotated()||this.transAlign!=u.AlignmentIdiom.LRBB||this.rightChild.isRotated()&&this.leftChild.isRotated()?u.TypographyNode.prototype.getMidline.call(this):f.MathUtils.maxDouble(this.leftChild.getMidline(),this.rightChild.getMidline())*this.scaleMat.d},getRightmostTextNode:function(){return this.rightChild.getRightmostTextNode()},getLeftmostTextNode:function(){return this.leftChild.getLeftmostTextNode()},swapChildren:function(){var e=this.leftChild;this.leftChild=this.rightChild,this.rightChild=e},depthFirstSearch:function(e){this.leftChild.depthFirstSearch(e),this.rightChild.depthFirstSearch(e)},getTextNodes:function(){var e=[];return this.depthFirstSearch(e),e},getTextRuns:function(){for(var e=[],t=c.clone(this.getTextNodes()),o=c.iter(t);!o.done;o.next()){for(var n=o.value;null!=n.parent&&n.parent.getWeight()==n.getWeight();)n=n.parent;for(var r=!1,i=c.iter(e);!i.done;i.next())if(i.value.isSame(n)){r=!0;break}r||e.push(n)}return e},getChildVertOrientation:function(){switch(this.transAlign){case 1:case 3:case 5:case 7:case 16:case 17:case 15:return u.ChildVertOrientation.LeftAbove;case 2:case 4:case 6:case 8:return u.ChildVertOrientation.RightAbove;case 10:case 11:case 18:return u.ChildVertOrientation.Topside}return u.ChildVertOrientation.BottomSide},getAscent:function(){switch(this.getChildVertOrientation()){case 0:return this.rightChild.getAscent();case 1:return this.leftChild.getAscent();case 2:return f.MathUtils.minDouble(this.leftChild.getAscent(),this.rightChild.getAscent())}return f.MathUtils.maxDouble(this.leftChild.getAscent(),this.rightChild.getAscent())},getDescent:function(){switch(this.getChildVertOrientation()){case 0:return this.rightChild.getDescent();case 1:return this.leftChild.getDescent();case 3:return f.MathUtils.minDouble(this.leftChild.getDescent(),this.rightChild.getDescent())}return f.MathUtils.maxDouble(this.leftChild.getDescent(),this.rightChild.getDescent())},calcTransform:function(){this.leftChild.calcTransform(),this.rightChild.calcTransform(),u.TypographyNode.prototype.calcTransform.call(this),this.internalCalcTransform()},internalCalcTransform:function(){var e=this.leftChild,t=this.rightChild,o=e.localbounds(),n=t.localbounds();switch(this.transAlign){case 0:t.translateXY(o.maxX-n.minX+this.getInternalHSpace(),o.minY-n.minY+(e.getBaseline()-t.getBaseline()));break;case 1:t.translateXY(o.minX-n.minX,o.maxY-n.minY+this.getInternalVSpace(!0));break;case 2:t.translateXY(o.minX-n.minX,o.minY-n.maxY-this.getInternalVSpace(!1));break;case 3:t.translateXY(o.maxX-n.maxX,o.maxY-n.minY+this.getInternalVSpace(!0));break;case 4:t.translateXY(o.maxX-n.maxX,o.minY-n.maxY-this.getInternalVSpace(!1));break;case 5:t.translateXY(o.minX+(o.width-n.width)/2-n.minX,o.maxY-n.minY+this.getInternalVSpace(!0));break;case 6:t.translateXY(o.minX+(o.width-n.width)/2-n.minX,o.minY-n.maxY-this.getInternalVSpace(!1));break;case 7:t.translateXY(o.maxX-n.minX+this.getInternalHSpace(),o.maxY-n.minY+this.getInternalVSpace(!0));break;case 8:t.translateXY(o.maxX-n.minX+this.getInternalHSpace(),o.minY-n.maxY-this.getInternalVSpace(!1));break;case 9:t.translateXY(o.minX-n.maxX-this.getInternalHSpace(),o.maxY-n.minY+this.getInternalVSpace(!0));break;case 10:t.translateXY(o.maxX-n.minX+this.getInternalHSpace(),o.minY-n.minY);break;case 11:t.translateXY(o.minX-n.maxX-this.getInternalHSpace(),o.minY-n.minY);break;case 12:t.translateXY(o.maxX-n.minX+this.getInternalHSpace(),o.minY+(o.height-n.height)-n.minY);break;case 13:t.translateXY(o.minX-n.maxX-this.getInternalHSpace(),o.minY+(o.height-n.height)-n.minY);break;case 14:t.translateXY(o.maxX-n.minX+this.getInternalHSpace(),o.minY+(e.getMidline()-t.getMidline())-n.minY);break;case 15:t.translateXY(o.minX+e.getSemanticWidth()-(n.minX+t.getSemanticWidth()),o.maxY-n.minY+this.getInternalVSpace(!0));break;case 16:t.translateXY(o.minX+e.getSemanticWidth()-n.minX,o.maxY-n.minY+this.getInternalVSpace(!0));break;case 17:t.translateXY(o.minX+e.getSemanticWidth()-n.maxX,o.maxY-n.minY+this.getInternalVSpace(!0));break;case 18:for(var r=(a=e.getRightmostTextNode()).localbounds(),i=a.parent;null!=i;)r=i.transformToLocalBounds(r),i=i.parent;t.translateXY(r.maxX-n.minX+this.getInternalHSpace(),r.minY-n.minY);break;case 19:var a;for(r=(a=e.getRightmostTextNode()).localbounds(),i=a.parent;null!=i;)r=i.transformToLocalBounds(r),i=i.parent;t.translateXY(r.maxX-n.minX+this.getInternalHSpace(),r.minY+(r.height-n.height)-n.minY);break;case 20:t.translateXY(o.minX-n.minX,o.maxY-n.minY-f.MathUtils.minDouble(o.height,n.height)/3);break;case 21:t.translateXY(o.maxX-n.maxX,o.maxY-n.minY-f.MathUtils.minDouble(o.height,n.height)/2);break;case 22:t.translateXY(o.minX-n.minX,o.minY-n.maxY+f.MathUtils.minDouble(o.height,n.height)/2);break;case 23:t.translateXY(o.maxX-n.minX-f.MathUtils.minDouble(o.width,n.width)/2,o.minY-n.minY)}},description:{get:function(){var e=u.TypographyNode._getters.description.call(this);return e+=this.leftChild.description,e+=this.rightChild.description}},getText:function(){for(var e=c.clone(this.getTextNodes()),t="",o=c.iter(e);!o.done;o.next())" "!=(t+=o.value.getText()).substr(t.length-1)&&(t+=" ");return t.trim()},getLines:function(){for(var e=[],t=[],o=c.clone(this.getTextNodes()),n=c.iter(o);!n.done;n.next())for(var r=n.value,i=r,a=r.parent;null!=a;){if(a.transAlign!=u.AlignmentIdiom.LRBB){e.includes(i.getId())||(e.push(i.getId()),t.push(i));break}if(a.getId()==this.getId())break;i=a,a=a.parent}return 0==t.length&&t.push(this),t},optimizeFlow:function(e,t,o,n,r){void 0===n&&(n=1),void 0===r&&(r=9999);var i=c.clone(this.getTextNodes());if(i.length<2)return 1;h.CoreAssert.isTrue(t.width>0&&t.height>0,"container size is 0",void 0,"GroupNode.optimizeFlow","TypographyNode.swift",1138),h.CoreAssert.isTrue(r>=n,"maximum lines requested is less than minimum lines requested",void 0,"GroupNode.optimizeFlow","TypographyNode.swift",1139),this.resetScale();for(var a=[],l=c.iter(c.range(0,i.length-1,!0));!l.done;l.next()){var s=l.value;a.push(s+1)}if(n<i.length){for(var d=t.aspectRatio,p=99999,y=0,v=0,S=f.MathUtils.minInt(r,i.length),C=[],T=i.length;T>0;){if(C.splice(0),o==u.ReflowType.BOTTOM)for(s=i.length-T;s>0;)C.splice(0,0,s),s-=T;else for(s=T;s<i.length;)C.push(s),s+=T;if(C.push(i.length),C.length>=n&&C.length<=S){if(this.buildBranchFromLines(i,C,e),o==u.ReflowType.FIT){this.resetScale(),this.calcTransform();for(var A=c.clone(this.getLines()),F=m.TypographyLayout.longestLine(A).localbounds().width,k=c.iter(A);!k.done;k.next())(x=k.value).scaleAlign=F/x.localbounds().width}this.calcTransform();var L=this.localbounds(),b=L.aspectRatio;if((I=f.MathUtils.absDouble(d-b))<p){p=I,y=b,v=L.height,a.splice(0);for(var _=c.iter(C);!_.done;_.next())s=_.value,a.push(s)}else if(b<d)break}T-=1}if(d>y&&(o==u.ReflowType.TOP||o==u.ReflowType.BOTTOM)){C.splice(0);for(var R=c.iter(a);!R.done;R.next())s=R.value,C.push(s);for(;d>y&&1!=C.length;){if(o==u.ReflowType.BOTTOM)for(s=0;s<C.length-1;)C[s]-1==0?C.splice(s,1):(C[s]-=1,s+=1);else for(s=0;s<C.length-1;)C[s]+1<C[s+1]?(C[s]+=1,s+=1):C.splice(s,1);if(C.length<n)break;var I;if(this.buildBranchFromLines(i,C,e),this.calcTransform(),y=this.localbounds().width/v,(I=f.MathUtils.absDouble(d-y))<p){p=I,a.splice(0);for(var w=c.iter(C);!w.done;w.next())s=w.value,a.push(s)}}}}if(g.LegacyCoreAssert.isTrue(a.length>0,"Could not reflow auto text",void 0,"GroupNode.optimizeFlow","TypographyNode.swift",1266),this.buildBranchFromLines(i,a,e),o==u.ReflowType.FIT){this.resetScale(),this.calcTransform(),A=c.clone(this.getLines()),F=m.TypographyLayout.longestLine(A).localbounds().width;for(var D=c.iter(A);!D.done;D.next()){var x;(x=D.value).scaleAlign=F/x.localbounds().width}}return a.length},buildBranchFromLines:function(e,t,o){for(var n,r=0,i=[],a=c.iter(t);!a.done;a.next()){var l=a.value,u=l;if(u-r==1)i.push(e[r]);else{for(n=new s(e[u-2],e[u-1]),u-=3;u>=r;)n=new s(e[u],n),u-=1;i.push(n)}r=l}if(g.LegacyCoreAssert.isTrue(t.length==i.length,"did not find sub-branch for each line",void 0,"GroupNode.buildBranchFromLines","TypographyNode.swift",1305),i.length>1){var h=i.length;for((n=new s(i[h-2],i[h-1])).transAlign=o,h-=3;h>=0;)(n=new s(i[h],n)).transAlign=o,h-=1}else g.LegacyCoreAssert.isTrue(i[0]instanceof s,"if there's only one sub-branch node, it should be a group node",void 0,"GroupNode.buildBranchFromLines","TypographyNode.swift",1317),n=i[0];this.leftChild=n.leftChild,this.rightChild=n.rightChild,this.leftChild.parent=this,this.rightChild.parent=this,this.transAlign=n.transAlign},resetScale:function(){u.TypographyNode.prototype.resetScale.call(this),this.leftChild.resetScale(),this.rightChild.resetScale()},propagateDown:function(e){this.leftChild.propagateDown(e),this.rightChild.propagateDown(e),this.transAlign=e}}}),s)},"7siz":function(e,t,o){var n,r,i=t,a=o("oAGj"),l=o("McK+"),s=o("90dd"),u=o("ZoS2");i.IEditorModel=a.defineProtocol("IEditorModel",{attributes:"IAttributesModel",handles:"IHandlesModel",activeSwap:"IActiveSwapModel",snapLines:"ISnapLinesModel",featureSets:"IFeatureSetsModel",actionFeedback:"IActionFeedbackModel",annotations:"IAnnotationsModel",view:"IViewModel",activePage:"IActivePageModel"}),i.IMutableEditorModel=a.defineProtocol("IMutableEditorModel",{attributes:"AttributesState",handles:"HandlesState",activeSwap:"ActiveSwapState",snapLines:"SnapLinesState",featureSets:"FeatureSetsState",actionFeedback:"ActionFeedbackState",annotations:"AnnotationState",view:"ViewState",activePage:"ActivePageState"}),i.EditorModel=(n=function(){this.updateDepth_=0,this.state_=new l.EditorModelState,this.startingState_=new l.EditorModelState,u.TheoPublishingObject.call(this)},a.defineClass({name:"EditorModel",ctor:n,superName:"TheoPublishingObject",statics:{_implements:function(e){return"IEditorModel"==e||"TheoMessagePublisher"==e}},props:{attributes:{get:function(){return this.state_.attributes}},handles:{get:function(){return this.state_.handles}},activeSwap:{get:function(){return this.state_.activeSwap}},snapLines:{get:function(){return this.state_.snapLines}},featureSets:{get:function(){return this.state_.featureSets}},actionFeedback:{get:function(){return this.state_.actionFeedback}},annotations:{get:function(){return this.state_.annotations}},view:{get:function(){return this.state_.view}},activePage:{get:function(){return this.state_.activePage}},mutable:{get:function(){return this.state_}},beginUpdates:function(){this.updateDepth_+=1,1==this.updateDepth_&&(this.startingState_=this.state_.clone()),this.state_.mutable=!0},updatesComplete:function(){if(this.updateDepth_-=1,0==this.updateDepth_){this.state_.mutable=!1;var e=a.clone(this.state_.calculateChanges(this.startingState_));e.length>0&&this.publish(new i.EditorModelChangedMessage(this,e))}}}}),n),i.EditorModelChangedMessage=(r=function e(t,o){this.changes=a.clone(o),s.TheoMessage.call(this,e.TYPE,t)},a.defineClass({name:"EditorModelChangedMessage",ctor:r,superName:"TheoMessage",statics:{CHG_ATTRIBUTE_PREFIX:"attribute:",CHG_HANDLES:"handles",CHG_SWAP_STATE:"swap-state",CHG_SNAPLINES:"snaplines",CHG_FEATURE_SET_PREFIX:"feature-set:",CHG_ACTION_FEEDBACK_STATE:"action-feedback",CHG_ANNOTATIONS:"annotations",CHG_VIEW_STATE:"view-state",CHG_ACTIVE_PAGE:"active-page",TYPE:"EditorModelChangedMessage"}}),r)},"8/a0":function(e,t,o){var n,r=t,i=o("oAGj"),a=o("ascj"),l=o("fNpk"),s=o("JgVS"),u=o("cEEQ"),c=o("c+uM"),h=o("tGKA"),d=o("hgLm"),g=o("oKlP"),p=o("sIWg"),f=o("1NAc");r.BannerDecorationStrategy=(n=function(){this.spacingScalar=.75,s.BaseDecorationStrategy.call(this)},i.defineClass({name:"BannerDecorationStrategy",ctor:n,superName:"BaseDecorationStrategy",statics:{_implements:function(e){return"LockupDecorationStrategy"==e}},props:{easeOutQuad:function(e,t,o,n){var r=e/n;return-o*r*(r-2)+t},easeOut:function(e,t,o){return this.easeOutQuad(o,e,t-e,1)},supportsConfiguration:function(e){return e.style.backing==c.LockupBacking.Banner},decorate:function(e,t){function o(e,t){return new g.TheoPoint(e,t)}var n=e.style,r=n.padding;t.numberOfLines>1&&(r+=n.spacing*this.spacingScalar);var m=t.avgTextPointSize*r,y=[],v=p.TheoRect.fromSize(t.size).transform(t.placement),S=!1;e.style.backing==c.LockupBacking.BannerHorizontal?S=!1:e.style.backing==c.LockupBacking.BannerVertical?S=!0:l.LegacyCoreAssert.fail("Invalid backing shape.",void 0,"BannerDecorationStrategy.decorate","BannerDecorationStrategy.swift",99);var C=s.BaseDecorationStrategy.getHorizontalOffsetForItalicAngle(t.avgLinePointSize*t.typographicBoundingRatios.heightFromBaselineRatio,e.style.font.fontData.italicAngle),T=t.typographicBoundingRatios.backingVerticalOffsetRatio*t.avgLinePointSize,A=this.easeOut(0,T,Math.min(1,r)),F=S?v.minX-m:-4093,k=S?-4093:v.minY-m+A,L=d.TheoPathBuilder.init_d41d(),b=C+(S?v.size.width+2*m:8186),_=S?8186:v.size.height+2*m,R=new f.TheoSize(b,_),I=h.Matrix2D.translationXY(F,k),w=function(e,t,n){var r=d.TheoPathBuilder.init_d41d(),a=t.transformPoint(e.eval(o(0,0)));r.moveTo(a.x,a.y);var l=new p.TheoRect(a.x,a.y,a.x,a.y);if(n)for(var s=i.iter([o(0,1),o(1,1),o(1,0)]);!s.done;s.next()){var u=s.value;a=t.transformPoint(e.eval(u)),r.lineTo(a.x,a.y),l=l.expandToFit(a)}else for(var c=i.iter([o(1,0),o(1,1),o(0,1)]);!c.done;c.next())u=c.value,a=t.transformPoint(e.eval(u)),r.lineTo(a.x,a.y),l=l.expandToFit(a);return r.closePath(),{path:r.path,bounds:l}}(p.TheoRect.fromSize(R),h.Matrix2D.Identity,!0).path;L.addPath(w,t.placement);var D=L.path,x=new f.TheoSize(i.opt(D.bounds,(function(e){return e.width})),i.opt(D.bounds,(function(e){return e.height})));return y.push(u.LockupItem.init_79d9(a.ColorRole.FieldSecondary,x,I,D)),new s.DecorationResults(y)}}}),n)},"8t9B":function(e,t,o){var n,r,i,a,l=t,s=o("oAGj"),u=o("0wFF"),c=o("cZuM"),h=o("XupS"),d=o("8/a0"),g=o("kYI4"),p=o("SpAV"),f=o("CWW7"),m=o("9WSY"),y=o("yGNn"),v=o("AVHO"),S=o("ascj"),C=o("R0Y+"),T=o("JEnV"),A=o("UB0O"),F=o("FNB+"),k=o("6ZWm"),L=o("waL6"),b=o("yHU1"),_=o("QgZx"),R=o("Pil/"),I=o("cmoc"),w=o("16hp"),D=o("QbzR"),x=o("P83h"),P=o("9Lk3"),E=o("ZK0l"),M=o("pnSN"),N=o("X0GW"),G=o("53P9"),B=o("iCxV"),O=o("fdtz"),U=o("VDg0"),H=o("fNpk"),z=o("PXlJ"),Y=o("d3iY"),W=o("cEEQ"),V=o("c+uM"),K=o("TkOd"),X=o("tGKA"),j=o("3DEm"),q=o("EDIN"),Z=o("X1F6"),J=o("Cj3Q"),Q=o("K0Rh"),$=o("Zifs"),ee=o("06HC"),te=o("djAF"),oe=o("35Q0"),ne=o("n/CE"),re=o("JKVa"),ie=o("byfQ"),ae=o("EoOi"),le=o("lJxM"),se=o("9YN4"),ue=o("enh0"),ce=o("Vm85"),he=o("VJ9E"),de=o("3UhB"),ge=o("x4Gy"),pe=o("mL0c"),fe=o("hgLm"),me=o("oKlP"),ye=o("uUew"),ve=o("sIWg"),Se=o("1NAc");l.CharStyleApplyMode=s.defineEnum("CharStyleApplyMode",{SwipeApply:0,Apply:1,Remove:2,Toggle:3}),l.HighlightMethod=s.defineEnum("HighlightMethod",{Manual:0,EvenRows:1,OddRows:2,EvenWords:3,OddWords:4,First:5,Last:6,Bracket:7,InsideBracket:8,Numbers:100,Nouns:101,Verbs:102,Names:103,Adjectives:104,SmallWords:105}),l.ControllerDBListener=(n=function(e,t){this.transactions_=[],this.controller_=t,e.addListener(this)},s.defineClass({name:"ControllerDBListener",ctor:n,statics:{_implements:function(e){return"IDatabaseListener"==e}},props:{onBeginTransaction:function(e,t){this.transactions_.push(t),1==this.transactions_.length&&s.opt(this.controller_,(function(e){return e.shrinkPools=!1}))},onEndTransaction:function(e,t){t===s.last(this.transactions_)&&this.transactions_.pop()},onObjectStateChanged:function(e,t){},onStateChanged:function(e,t){s.opt(this.controller_,(function(e){return e.updateFormaPools()}))}}}),n),l.LockupFormaPool=(r=function(e,t){this.stringsToFormae_={},this.shapeFormae_=[],this.shrinkPools_=!0,this.page_=e,this.createModelFormae_=t},s.defineClass({name:"LockupFormaPool",ctor:r,props:{createForma:function(e){var t=this.page_;return null==t?null:this.createModelFormae_?t.createModelForma(e):t.createForma(e)},clear:function(){this.stringsToFormae_={},this.shapeFormae_=[]},addForma:function(e){var t,o;if(t=s.as(e,te.ShapeForma))this.shapeFormae_.push(t);else if(o=s.as(e,ue.TextForma)){var n=o.text.toUpperCase();null==this.stringsToFormae_[n]&&(this.stringsToFormae_[n]=[]),this.stringsToFormae_[n].push(o)}},configureTextFormae:function(e){var t,o=this,n=[],r=[],i=[];s.each(this.stringsToFormae_,(function(a,l){var u=(t=e[a])||null!=t?t:0,c=l.length;if(0==u)s.append(n,l),i.push(a);else if(u<c){var h=c-u,d=l.slice(u,c);o.shrinkPools_&&l.splice(u,h),s.append(n,d)}else for(var g=u-c,p=s.iter(s.range(0,g,!1));!p.done;p.next())r.push(a)}));var a=[];if(this.shrinkPools_)for(var l=s.iter(i);!l.done;l.next()){var u=l.value;a=a.concat(this.stringsToFormae_[u]),s.removeKey(this.stringsToFormae_,u)}s.each(e,(function(e,t){if(null==o.stringsToFormae_[e]){o.stringsToFormae_[e]=[];for(var n=t,i=s.iter(s.range(0,n,!1));!i.done;i.next())r.push(e)}}));for(var c=s.iter(r);!c.done;c.next()){u=c.value;var h=a.pop()||this.createForma(ue.TextForma.KIND);this.stringsToFormae_[s.as(u,"String")].push(h)}return n},configureShapeFormae:function(e){var t=[],o=this.shapeFormae_.length;if(o>e){var n=o-e,r=this.shapeFormae_.slice(e,o);this.shrinkPools_&&this.shapeFormae_.splice(e,n),s.append(t,r)}else if(o<e){var i=e-o;if(i>0)for(var a=s.iter(s.range(1,i,!0));!a.done;a.next()){var l=s.as(this.createForma(te.ShapeForma.KIND),te.ShapeForma);null!=l&&this.shapeFormae_.push(l)}}return t},nthTextFormaForString:function(e,t){var o=s.opt(this.stringsToFormae_[t],(function(t){return t[e]}));return null==o?null:o},textFormaCount:function(){return s.keys(this.stringsToFormae_).length},nthShapeForma:function(e){var t=e<this.shapeFormae_.length?this.shapeFormae_[e]:null;return null==t?null:t},shapeFormaCount:function(){return this.shapeFormae_.length}}}),r),l.TypeLockupController=(i=function e(t,o,n){var r;this.changeSubscriptions_=[],this.settings_=null,this.tagsToFormae_={},this.isRightToLeft=!1,this.initialCharStyleRanges_=[],this.fitContainerToArea=!1,this.bannerRatio_=e.DEFAULT_BANNER_RATIO,this.forceLetterFormaMode=!1,this.currentColors={1:$.SolidColor.WHITE,2:$.SolidColor.BLACK,3:$.SolidColor.BLACK,4:$.SolidColor.BLACK},this.cachedPin_=null,this.shouldCachePin_=!1,this.startSize_=null,this.passedARThreshold_=!1,this.resizePin_=null,this.preferredFontSize_=null,this.expansionSize_=null,this.lockLineBreaks_=!1,this.allowFewerLineBreaks_=!1,this.numBreakRanges_=null,this.missingFontCount_=0,this.validDecode_=null,this.versionDecoded_=0,this.layoutStrategy_=null,this.decorationStrategy_=null,this.renderedConfiguration_=null,this.renderedColorLibrary_=null,this.renderedLayoutResults_=null,this.renderedDecorationResults_=null,this.updateQueued_=!1,this.thresholdGroupWidth=0,this.thresholdGroupHeight=0,this.hasFirstUpdateRun=!1,this.formaUpdateEvents_=[],this.sgID=o.formaID,this.layoutFormaePool_=new l.LockupFormaPool(o.page,o.isModel),this.decorationFormaePool_=new l.LockupFormaPool(o.page,o.isModel),this.styleController_=new K.LockupStyleController(o),this.missingFontCount_=0,E.GroupController.call(this,t,o,n),(r=this.lockupStyle)&&this.updateCurrentColors(r),o.persisted&&(this.dbListener=new l.ControllerDBListener(o.database,this))},a={},s.defineClass({name:"TypeLockupController",ctor:i,superName:"GroupController",statics:{KIND:{get:function(){return"type-lockup"}},PROPERTY_SIZE_DEPRECATED:"size",PROPERTY_LOCKUPSTYLE_DEPRECATED:"lockup-style",PROPERTY_CONTENT_ID:"content-id",PROPERTY_WRAPPER_ID:"wrapper-id",PROPERTY_HIGHLIGHTMETHOD_ID:"highlightMethod",PROPERTY_CHARSTYLERANGES:"charstyle-ranges",PROPERTY_AUTOTEXTRANGES:"weighted-ranges",MIN_LINE_HEIGHT:{get:function(){return 20}},DEFAULT_BANNER_RATIO:{get:function(){return 1.5}},HIGHLIGHT_STYLE:"Highlight",FIRST_AUTO_METHOD:{get:function(){return void 0===a.FIRST_AUTO_METHOD&&(a.FIRST_AUTO_METHOD=l.HighlightMethod.EvenRows),a.FIRST_AUTO_METHOD}},MAX_AUTO_METHOD:{get:function(){return void 0===a.MAX_AUTO_METHOD&&(a.MAX_AUTO_METHOD=l.HighlightMethod.InsideBracket),a.MAX_AUTO_METHOD}},FIRST_NLP_METHOD:{get:function(){return void 0===a.FIRST_NLP_METHOD&&(a.FIRST_NLP_METHOD=l.HighlightMethod.Numbers),a.FIRST_NLP_METHOD}},MAX_NLP_METHOD:{get:function(){return void 0===a.MAX_NLP_METHOD&&(a.MAX_NLP_METHOD=l.HighlightMethod.SmallWords),a.MAX_NLP_METHOD}},NUM_HIGHLIGHTMETHODS:14,DelayBetweenUpdates:{get:function(){return 16}},rangesEqual:function(e,t){if(e.length==t.length){for(var o=s.iter(s.range(0,e.length,!1));!o.done;o.next()){var n=o.value;if(e[n].start!=t[n].start||e[n].end!=t[n].end)return!1}return!0}return!1}},props:{contentID_:{get:function(){return s.as(this.controllerMetadata.get(i.PROPERTY_CONTENT_ID),"String")},set:function(e){this.controllerMetadata.set(i.PROPERTY_CONTENT_ID,e)}},wrappingGroupID_:{get:function(){return s.as(this.controllerMetadata.get(i.PROPERTY_WRAPPER_ID),"String")},set:function(e){this.controllerMetadata.set(i.PROPERTY_WRAPPER_ID,e)}},highlightMethod:{get:function(){var e,t;return(e=l.HighlightMethod.toCaseValue((t=s.as(this.controllerMetadata.get(i.PROPERTY_HIGHLIGHTMETHOD_ID),"Int"))||null!=t?t:0))||null!=e?e:l.HighlightMethod.Manual},set:function(e){this.controllerMetadata.set(i.PROPERTY_HIGHLIGHTMETHOD_ID,e)}},charStyleRanges:{get:function(){var e,t=[];if(e=s.as(this.controllerMetadata.get(i.PROPERTY_CHARSTYLERANGES),["Dictionary","String",["Array","Int"]]))for(var o=s.iter(e);!o.done;o.next()){var n=o.key,r=o.value;H.LegacyCoreAssert.isTrue(n==i.HIGHLIGHT_STYLE,"unexpected character style",void 0,"TypeLockupController","TypeLockupController.swift",304);for(var a=s.iter(s.range(0,r.length,!0));!a.done;a.next()){var l=a.value;if(l%2==0&&l<r.length-1){var u=new ye.TextRange(r[l],r[l+1]);t.push(u)}}}return t},set:function(e){for(var t=[],o=s.iter(e);!o.done;o.next()){var n=o.value;t.push(n.start),t.push(n.end)}var r={Highlight:t};this.controllerMetadata.set(i.PROPERTY_CHARSTYLERANGES,r)}},autoTextRanges:{get:function(){var e,t,o=[];if(e=s.as(this.controllerMetadata.get(i.PROPERTY_AUTOTEXTRANGES),["Array","Int"]))for(var n=s.iter(s.range(0,e.length,!0));!n.done;n.next()){var r=n.value;if(r%2==0&&r<e.length-1){var a=new ye.TextRange(e[r],e[r+1]);o.push(a)}}else s.opt(this.lockupStyle,(function(e){return e.layout==V.LockupLayout.Auto}))&&(t=ae.TypographyComposer.getWeightingForAlignment(this.lockupStyle.alignment,this.text,this.charStyleRanges))&&(o=s.clone(t));return o},set:function(e){for(var t=[],o=s.iter(e);!o.done;o.next()){var n=o.value;t.push(n.start),t.push(n.end)}this.controllerMetadata.set(i.PROPERTY_AUTOTEXTRANGES,t)}},updateCurrentColors:function(e){var t,o,n,r;(t=e.colors.fieldPrimary)&&(this.currentColors[S.ColorRole.FieldPrimary]=t),(o=e.colors.fieldSecondary)&&(this.currentColors[S.ColorRole.FieldSecondary]=o),(n=e.colors.border)&&(this.currentColors[S.ColorRole.Border]=n),(r=e.colors.shadow)&&(this.currentColors[S.ColorRole.Shadow]=r),null==this.currentColors[S.ColorRole.Border]&&(this.currentColors[S.ColorRole.Border]=this.currentColors[S.ColorRole.FieldSecondary]),null==this.currentColors[S.ColorRole.Shadow]&&(this.currentColors[S.ColorRole.Shadow]=this.currentColors[S.ColorRole.FieldSecondary])},processEvent:function(e){var t;return(t=s.as(e,R.BeginPointerTrackingEvent))?(t.trackingResponse=b.BeginPointerTrackingResponseEnum.TrackAsGroup,!1):E.GroupController.prototype.processEvent.call(this,e)},selectable:{get:function(){return!0}},moveable:{get:function(){return null==this.forma.allowUserMove||this.forma.allowUserMove}},duplicatable:{get:function(){return!0}},replaceable:{get:function(){return!0}},flippable:{get:function(){return!1}},copyTo:function(e,t,o,n){void 0===e&&(e=null),void 0===t&&(t=null),void 0===o&&(o=null),void 0===n&&(n=!0);var r,a,l,u=this;if((a=this.forma)&&(l=s.opt(this.owner,(function(e){return e.document})))){var c=(s.opt(e,(function(e){return e.document}))||l).content.createNode(le.TextContentNode.KIND,null);c.match(this.contentNode);var h=e||a.page;return f.CreationFacade.addContent(h,c,void 0,void 0,new f.AddFormaParams(void 0,!(!(r=t)&&null==r)&&r,void 0,void 0,void 0,void 0,a.page!=h)).then((function(e){var t,o;return(t=s.as(e,F.Forma))?((o=s.as(t.controller,i))&&o.match(u),t.match(a),t):y.CorePromise.reject("didn't get a forma back from addContent?")}))}return y.CorePromise.reject("No forma or owner document")},size:{get:function(){return s.opt(s.opt(this.forma,(function(e){return e.bounds})),(function(e){return e.size}))},set:function(e){var t=ve.TheoRect.fromSize(e),o=s.opt(this.forma,(function(e){return e.bounds}));null!=o&&t.equal(o)||s.opt(this.forma,(function(e){return e.bounds=t}))}},contentDocument:{get:function(){return s.opt(s.opt(this.forma,(function(e){return e.page.document})),(function(e){return e.content}))}},contentID:{get:function(){return this.contentID_},set:function(e){e!=this.contentID_&&(H.LegacyCoreAssert.isFalse(!(null==this.contentID_||""==this.contentID_||null!=e&&""!=e),"Why are we setting a nil/empty text content node id?",void 0,"TypeLockupController","TypeLockupController.swift",546),this.removeListenersFromNode(),this.contentID_=e,this.addListenersToNode(),this.updateGroup())}},lockupForma:{get:function(){return s.as(this.forma,M.GroupForma)}},contentNode:{get:function(){var e=this;return null==this.contentID_?null:s.as(s.opt(this.contentDocument,(function(t){return t.nodeByID(e.contentID_)})),le.TextContentNode)},set:function(e){H.LegacyCoreAssert.isFalse(null==e,"Why are we setting a nil text content node?",void 0,"TypeLockupController","TypeLockupController.swift",565),this.contentID=s.opt(e,(function(e){return e.id})),H.LegacyCoreAssert.isFalse(""==this.contentID,"Why are we setting a text content node with empty id?",void 0,"TypeLockupController","TypeLockupController.swift",567)}},text:{get:function(){var e,t=this;if(null==this.contentNode){var o=s.opt(this.forma,(function(e){return e.formaID!=s.opt(t.forma,(function(e){return e.originalID}))}))?"Forma is a clone":"NOT A CLONE",n=1==this.validDecode_?"VALID DECODE":"Decode not valid";H.LegacyCoreAssert.fail("Why do we have a type lockup with no content node? "+o+" "+n,void 0,"TypeLockupController","TypeLockupController.swift",576)}return(e=s.opt(this.contentNode,(function(e){return e.text})))||null!=e?e:""}},getCurrentMSLPrimaryColor:function(){for(var e=s.iter(this.forma.style.characterStyles);!e.done;e.next()){var t;if(t=e.value.colors.fieldPrimary)return t}return null},getCurrentMSLBackingColor:function(){for(var e=s.iter(this.forma.style.characterStyles);!e.done;e.next()){var t,o=e.value;if((t=o.colors.fieldSecondary)&&o.backing!=V.LockupBacking.None)return t}return null},settings:{get:function(){return null==this.settings_&&(this.settings_=new v.TypeLockupControllerSettings(this)),this.settings_}},loadFontsForStyle:function(){var e,t=this;(e=s.opt(s.as(s.opt(this.lockupForma,(function(e){return e.style})),V.LockupStyle),(function(e){return e.font})))&&B.Host.fontProvider.loadFont(e.fontData,(function(){null!=t.lockupForma&&t.updateGroup()}),(function(){return B.Host.logging.warning("Unable to load font "+e.fontData.postScriptName+" for style.")}))},styleChanged:function(){s.opt(s.opt(s.opt(this.forma,(function(e){return e.root})),(function(e){return e.animation})),(function(e){return e.invalidate()})),this.updateGroup()},maintainAspectRatio:{get:function(){var e=s.replaceAll(s.replaceAll(this.text,"\n","")," ","");return this.lockLineBreaks_||this.text==e}},getAlignments:function(e){var t;if(void 0===e&&(e=!1),null==this.localCoordinateAlignmentLines_&&(this.localCoordinateAlignmentLines_=s.clone(this.alignmentsInLocalCoords(e))),t=this.lockupForma){for(var o=[],n=t.totalPlacement,r=this.forma_.visit(F.FormaTraversal.FurthestAncestor,(function(e,t,o){return!0})),i=s.iter(this.localCoordinateAlignmentLines_);!i.done;i.next()){var a=i.value;H.LegacyCoreAssert.isTrue(a.coordinateSpace==t,"alignment line not in lockup coordinate space",void 0,"TypeLockupController.getAlignments","TypeLockupController.swift",662),o.push(new c.AlignmentLine(a.type,a.location,c.AlignmentDetector.ALIGNMENT_FORMA,a.line.transform(n),a.text,r))}return o}return[]},alignmentsInLocalCoords:function(e){void 0===e&&(e=!1);var t,o=[];if(t=this.lockupForma){var n,r,i,a=c.AlignmentEdges.None,l=!1,u=!1,h=!1,d=!1,g=!1,p=!1,f=!1;if(i=this.lockupStyle){if(i.backing!=V.LockupBacking.None){n=t.childrenBoundsInCoordSpace(X.Matrix2D.Identity);var m=oe.ShapeLibrary.shapeDictionary[i.backingShapeID];null!=m?(a=m.alignmentEdges,l=m.centered):(l=!0,i.backing==V.LockupBacking.BannerHorizontal?a=c.AlignmentEdges.TopAndBottom:i.backing==V.LockupBacking.BannerVertical?a=c.AlignmentEdges.LeftAndRight:i.backing==V.LockupBacking.Knockout?(a=c.AlignmentEdges.None,n=null,l=!1):a=c.AlignmentEdges.All)}null!=n&&(0!=(s.toInt(a)&s.toInt(c.AlignmentEdges.CenterX))&&(o.push(new c.AlignmentLine(c.AlignmentType.CenterX,c.AlignmentLocation.Forma,c.AlignmentDetector.ALIGNMENT_FORMA,n.verticalLine(.5),!0,t)),p=!0),0!=(s.toInt(a)&s.toInt(c.AlignmentEdges.Left))&&(o.push(new c.AlignmentLine(c.AlignmentType.Left,c.AlignmentLocation.Forma,c.AlignmentDetector.ALIGNMENT_FORMA,n.verticalLine(0),!1,t)),u=!0),0!=(s.toInt(a)&s.toInt(c.AlignmentEdges.Right))&&(o.push(new c.AlignmentLine(c.AlignmentType.Right,c.AlignmentLocation.Forma,c.AlignmentDetector.ALIGNMENT_FORMA,n.verticalLine(1),!1,t)),h=!0),0!=(s.toInt(a)&s.toInt(c.AlignmentEdges.CenterY))&&(o.push(new c.AlignmentLine(c.AlignmentType.CenterY,c.AlignmentLocation.Forma,c.AlignmentDetector.ALIGNMENT_FORMA,n.horizontalLine(.5),!0,t)),f=!0),0!=(s.toInt(a)&s.toInt(c.AlignmentEdges.Top))&&(o.push(new c.AlignmentLine(c.AlignmentType.Top,c.AlignmentLocation.Forma,c.AlignmentDetector.ALIGNMENT_FORMA,n.horizontalLine(0),!1,t)),g=!0),0!=(s.toInt(a)&s.toInt(c.AlignmentEdges.Bottom))&&(o.push(new c.AlignmentLine(c.AlignmentType.Bottom,c.AlignmentLocation.Forma,c.AlignmentDetector.ALIGNMENT_FORMA,n.horizontalLine(1),!1,t)),d=!0)),null==(r=this.textBoundsInCoordSpace(X.Matrix2D.Identity))||null!=n&&l&&a==c.AlignmentEdges.All||((null==n||!l||!(u||p||h))&&(this.numLines()<=1||s.opt(this.lockupStyle,(function(e){return e.alignment==V.LockupAlignment.UNSET}))?(o.push(new c.AlignmentLine(c.AlignmentType.CenterX,c.AlignmentLocation.Forma,c.AlignmentDetector.ALIGNMENT_FORMA,r.verticalLine(.5),!0,t)),o.push(new c.AlignmentLine(c.AlignmentType.Left,c.AlignmentLocation.Forma,c.AlignmentDetector.ALIGNMENT_FORMA,r.verticalLine(0),!0,t)),o.push(new c.AlignmentLine(c.AlignmentType.Right,c.AlignmentLocation.Forma,c.AlignmentDetector.ALIGNMENT_FORMA,r.verticalLine(1),!0,t))):s.opt(this.lockupStyle,(function(e){return e.alignment==V.LockupAlignment.Center}))?o.push(new c.AlignmentLine(c.AlignmentType.CenterX,c.AlignmentLocation.Forma,c.AlignmentDetector.ALIGNMENT_FORMA,r.verticalLine(.5),!0,t)):s.opt(this.lockupStyle,(function(e){return e.alignment==V.LockupAlignment.Left}))?o.push(new c.AlignmentLine(c.AlignmentType.Left,c.AlignmentLocation.Forma,c.AlignmentDetector.ALIGNMENT_FORMA,r.verticalLine(0),!0,t)):s.opt(this.lockupStyle,(function(e){return e.alignment==V.LockupAlignment.Right}))&&o.push(new c.AlignmentLine(c.AlignmentType.Right,c.AlignmentLocation.Forma,c.AlignmentDetector.ALIGNMENT_FORMA,r.verticalLine(1),!0,t))),(null==n||!l||!(g||f||d))&&(s.opt(this.lockupStyle,(function(e){return e.verticalAlignment==V.VerticalLockupAlignment.UNSET}))?(o.push(new c.AlignmentLine(c.AlignmentType.CenterY,c.AlignmentLocation.Forma,c.AlignmentDetector.ALIGNMENT_FORMA,r.horizontalLine(.5),!0,t)),o.push(new c.AlignmentLine(c.AlignmentType.Top,c.AlignmentLocation.Forma,c.AlignmentDetector.ALIGNMENT_FORMA,r.horizontalLine(0),!0,t)),o.push(new c.AlignmentLine(c.AlignmentType.Bottom,c.AlignmentLocation.Forma,c.AlignmentDetector.ALIGNMENT_FORMA,r.horizontalLine(1),!0,t))):s.opt(this.lockupStyle,(function(e){return e.verticalAlignment==V.VerticalLockupAlignment.VerticalCenter}))?o.push(new c.AlignmentLine(c.AlignmentType.CenterY,c.AlignmentLocation.Forma,c.AlignmentDetector.ALIGNMENT_FORMA,r.horizontalLine(.5),!0,t)):s.opt(this.lockupStyle,(function(e){return e.verticalAlignment==V.VerticalLockupAlignment.Top}))?o.push(new c.AlignmentLine(c.AlignmentType.Top,c.AlignmentLocation.Forma,c.AlignmentDetector.ALIGNMENT_FORMA,r.horizontalLine(0),!0,t)):s.opt(this.lockupStyle,(function(e){return e.verticalAlignment==V.VerticalLockupAlignment.Bottom}))&&o.push(new c.AlignmentLine(c.AlignmentType.Bottom,c.AlignmentLocation.Forma,c.AlignmentDetector.ALIGNMENT_FORMA,r.horizontalLine(1),!0,t))))}}return o},processFormaDoubleClick:function(e){this.owner.selection.replaceSelection(e.forma),this.owner.selection.isSelected(e.forma)&&(s.opt(B.Host.logging,(function(e){return e.logToAnalytics(u.AnalyticsConstants.kAnalyticsDataTextDoubleTapEnterTextEditor,{contextualData1:"method: doublePressed"})})),this.owner.controllerSettingsState.settings=this.settings)},isResizing:{get:function(){var e,t=this;return null!=this.startSize_&&!(((e=s.opt(this.owner,(function(e){return e.selection.inSpacingMode})))||null!=e)&&e&&s.opt(this.resizePin_,(function(e){return.5==e.x||s.opt(t.resizePin_,(function(e){return.5==e.y}))})))}},isResizingHorizontally:{get:function(){return this.isResizing&&s.opt(this.resizePin_,(function(e){return.5==e.y}))}},canResizeHorizontally:{get:function(){if(s.opt(this.lockupStyle,(function(e){return e.layout==V.LockupLayout.Standard}))){if(null==this.numBreakRanges_){var e=s.replaceAll(this.text,"\n","");this.numBreakRanges_=de.TypeLockupUtils.getBreakRanges(e).length}return this.numBreakRanges_>1}return!1}},processBeginFormaResize:function(e){E.GroupController.prototype.processBeginFormaResize.call(this,e),this.startSize_=this.size,this.resizePin_=e.spot,this.passedARThreshold_=!1,s.opt(s.opt(s.opt(this.forma,(function(e){return e.root})),(function(e){return e.animation})),(function(e){return e.invalidate()})),this.updateBannerRatio(),this.styleController.resetSessionContainerSize(),1==this.owner.selection.selectedCount&&de.TypeLockupUtils.enableMeasurementResizeCache()},processFormaResize:function(e){var t,o,n,r;if((t=this.forma)&&(o=this.size)&&(n=e.newSize)&&(r=t.bounds)){var i,a=null,l=null;if(f=e.pin){var s=this.isResizingHorizontally?0:f.y;a=new me.TheoPoint(f.x,s),l=t.placement.transformPoint(r.eval(a))}if(null==this.lockupStyle||this.lockupStyle.layout!=V.LockupLayout.Auto)if(this.isResizingHorizontally){var u=t.placement.transformValues,c=Math.abs(u.xscale);if(Math.abs(c-1)>.001){this.beginBlockedUpdate();var h=t.placement.extractedScale;t.placement=h.matrix,this.size=o.multiply(c),this.endBlockedUpdate(),this.renderedLayoutResults_=null,this.renderedConfiguration_=null}null==this.renderedLayoutResults_&&this.internalUpdateGroup(!0)}else if(i=this.startSize_){var d=i.similarity(n);d<.03?(d<.005&&(this.passedARThreshold_=!1),this.passedARThreshold_||(n=i.myAspectRatioClosestCorner(n))):this.passedARThreshold_=!0}this.updateBanner(n),this.styleController.resetSessionContainerSize(),this.styleController.resetSessionContainerCenter();var g,p,f,m,y=new x.FormaTransformChangedEvent(t);if(t.beginUpdate(y),h=t.placement.extractedScale,t.placement=h.matrix,this.size=n,this.isResizingHorizontally&&(g=this.renderedLayoutResults_)){var v=g.size,S=v.height,C=Math.max(n.width,v.width);this.recordSize(new Se.TheoSize(C,S))}if((p=l)&&(f=a)&&(m=t.bounds)){var T=t.placement.transformPoint(m.eval(f));t.move(X.Matrix2D.translation(p.subtract(T)))}t.endUpdate(y),this.updateParentGroup()}},place:function(e){E.GroupController.prototype.place.call(this,e),this.styleController.resetSessionContainerCenter()},processEndFormaResize:function(e){E.GroupController.prototype.processEndFormaResize.call(this,e),this.snapSizeToBounds();var t=this.isResizingHorizontally?"side":"corner";s.opt(B.Host.logging,(function(e){return e.logToAnalytics(u.AnalyticsConstants.kAnalyticsDataTextFrameEdited,{contextualData1:"handle:"+t})})),this.startSize_=null,this.resizePin_=null,this.invalidateStyleScores(),this.localCoordinateAlignmentLines_=s.clone(this.alignmentsInLocalCoords(!0)),de.TypeLockupUtils.disableMeasurementResizeCache()},processEndFormaDrag:function(e){E.GroupController.prototype.processEndFormaDrag.call(this,e)},invalidateStyleScores:function(){this.styleController_.hasScoresForAttributes=!1},addListenersToNode:function(){var e=this;0==this.changeSubscriptions_.length&&null!=this.contentNode&&this.changeSubscriptions_.push(this.contentNode.subscribeWithCallbackToTextModel((function(t){s.opt(e,(function(e){return e.numBreakRanges_=null})),s.opt(e,(function(e){return e.updateGroup()}))}),ge.TextModelDidInsertMessage.TYPE))},removeListenersFromNode:function(){for(;this.changeSubscriptions_.length>0;)this.changeSubscriptions_.pop().unsubscribe()},bannerRatio:{get:function(){return this.bannerRatio_},set:function(e){this.bannerRatio_=e}},styleController:{get:function(){return this.styleController_}},updateBannerRatio:function(){var e;(e=this.lockupStyle)&&(e.backing!=V.LockupBacking.Banner&&e.backing!=V.LockupBacking.BannerHorizontal&&e.backing!=V.LockupBacking.BannerVertical||(e.backing==V.LockupBacking.BannerHorizontal&&this.size.width<this.size.height?this.bannerRatio=this.size.height/this.size.width+.1:e.backing==V.LockupBacking.BannerVertical&&this.size.height<this.size.width?this.bannerRatio=this.size.width/this.size.height+.1:this.bannerRatio=i.DEFAULT_BANNER_RATIO))},updateBanner:function(e){var t;(t=this.lockupStyle)&&(t.backing!=V.LockupBacking.Banner&&t.backing!=V.LockupBacking.BannerHorizontal&&t.backing!=V.LockupBacking.BannerVertical||(t.backing==V.LockupBacking.BannerVertical&&e.width/e.height>this.bannerRatio?(t.backing=V.LockupBacking.BannerHorizontal,this.bannerRatio=i.DEFAULT_BANNER_RATIO):t.backing==V.LockupBacking.BannerHorizontal&&e.height/e.width>this.bannerRatio&&(t.backing=V.LockupBacking.BannerVertical,this.bannerRatio=i.DEFAULT_BANNER_RATIO)))},shift:function(e,t){return new ye.TextRange(e.start+t,e.end+t)},onStyleApplication:function(){this.loadFontsForStyle(),this.updateGroup()},layoutStrategyForConfiguration:function(e){return null!=this.layoutStrategy_&&this.layoutStrategy_.supportsConfiguration(e)?this.layoutStrategy_:this.layoutStrategyForLayout(e.style.layout,e.style.alignment)},layoutStrategyForLayout:function(e,t){return V.LockupStyle.isAutoLayout(e)?new h.AutoTextLayoutStrategy:e==V.LockupLayout.FitJustified?new A.EvenRowWidthsLayoutStrategy:e==V.LockupLayout.Standard?new T.EvenRowHeightsLayoutStrategy(t):V.LockupStyle.isLetterGrid(e)?new Y.LetterGridLayoutStrategy:V.LockupStyle.isPath(e)?new Z.PathLayoutStrategy:(H.LegacyCoreAssert.fail("Unknown Layout",{layout:e},"TypeLockupController.layoutStrategyForLayout","TypeLockupController.swift",1188),new T.EvenRowHeightsLayoutStrategy(V.LockupAlignment.Left))},decorationStrategyForConfiguration:function(e){if(null!=this.decorationStrategy_&&this.decorationStrategy_.supportsConfiguration(e))return this.decorationStrategy_;var t=null,o=e.style.backing;return V.LockupStyle.isLetterGrid(e.style.layout)?t=new z.LetterDecorationStrategy:o==V.LockupBacking.None?t=new q.NoDecorationStrategy:o==V.LockupBacking.Rows?t=new J.RowsDecorationStrategy:o==V.LockupBacking.Knockout?t=new J.KnockoutDecorationStrategy:o==V.LockupBacking.Banner||o==V.LockupBacking.BannerVertical||o==V.LockupBacking.BannerHorizontal?t=new d.BannerDecorationStrategy:o==V.LockupBacking.SVGBackground?null!=e.style.backingArtworkID?t=new re.SVGBackgroundDecorationStrategy(e.style.backingArtworkID):(B.Host.logging.warning("Error in svg background. nil backingArtworkID. defaulting to no backing"),t=new q.NoDecorationStrategy):(H.LegacyCoreAssert.fail("Unimplemented value for lockup layout.",void 0,"TypeLockupController.decorationStrategyForConfiguration","TypeLockupController.swift",1221),t=new q.NoDecorationStrategy),t},styleFontsLoaded:function(){var e;return!(e=s.opt(s.as(s.opt(this.lockupForma,(function(e){return e.style})),V.LockupStyle),(function(e){return e.font})))||e.fontData.availability==_.FontAvailability.LOADED},updatePoolForItems:function(e,t){for(var o,n=0,r={},i=s.iter(e);!i.done;i.next()){var a=i.value;if(a.type==W.LockupItemType.Text){var l=a.text.toUpperCase(),u=(o=r[l])||null!=o?o:0;r[l]=u+1}else n+=1}for(var c=s.iter(t.configureTextFormae(r));!c.done;c.next()){var h=c.value;s.opt(h.parent,(function(e){return e.removeChild(h)}))}for(var d=s.iter(t.configureShapeFormae(n));!d.done;d.next())h=d.value,s.opt(h.parent,(function(e){return e.removeChild(h)}))},conformFormaeForItems:function(e,t,o,n){var r,i;if(void 0===o&&(o=!1),void 0===n&&(n=!1),i=s.as(s.opt(this.lockupForma,(function(e){return e.root})),Q.RootForma)){var a=new x.FormaGeometryChangedEvent(i);i.beginUpdate(a);for(var l={},u=0,c=s.iter(e);!c.done;c.next()){var h,d,g,p=c.value;switch(p.type){case 0:var f,m,y=p.text.toUpperCase(),v=(r=l[y])||null!=r?r:0;h=S=t.nthTextFormaForString(v,y),l[y]=v+1,d=n?0:1,(f=h.parent)&&(m=s.as(s.opt(this.wrappingGroup_,(function(e){return e.childAt(d)})),M.GroupForma))&&f!==m&&f.removeChild(h);break;case 1:var S=t.nthShapeForma(u);this.conformShapeFormaToItem(S,p,!1),h=S,u+=1,d=0;break;case 2:S=t.nthShapeForma(u),this.conformShapeFormaToItem(S,p,!1),h=S,u+=1,d=0}if(h.isFullCanvas=p.isFullCanvas,0==d&&(g=h.parent)){var C=o?t.shapeFormaCount()-u:u-1;g.childCount<=C||C<0?(g.removeChild(h),g.appendChild(h,!1)):s.eq(F._equality_Forma_Forma,g.childAt(C),h)||(g.removeChild(h),g.insertChildAt(h,C,!1))}if(null==h.parent){var T=s.as(s.opt(this.wrappingGroup_,(function(e){return e.childAt(d)})),M.GroupForma);null!=T&&(o?T.insertChildAt(h,0,!1):T.appendChild(h,!1))}p.type==W.LockupItemType.Text&&this.conformTextFormaToItem(h,p)}i.endUpdate(a)}},lockupStyle:{get:function(){return s.as(s.opt(this.lockupForma,(function(e){return e.style})),V.LockupStyle)}},renderedLayoutResults:{get:function(){return this.renderedLayoutResults_}},annotations:{get:function(){var e,t,o;return(e=this.renderedLayoutResults_)?e.annotations:!this.blockUpdate&&(t=this.size)&&(o=this.lockupStyle)?this.layoutStrategyForLayout(o.layout,o.alignment).annotate(this.text,t,o,this.getTextFormaCount()):null}},layoutStrategyPrivate:{get:function(){return this.layoutStrategy_},set:function(e){this.layoutStrategy_=e}},calculateScalarToFit:function(e,t){var o=e.width,n=e.height,r=o/n,i=t.width,a=t.height,l=i/a,s=(r>=l?n:o/l)/a;return isNaN(s)?1:s},scalarToFitLayoutResultsIntolockupForma:function(){var e=this.renderedLayoutResults_;if(null==e)return 1;var t=e.size,o=this.calculateScalarToFit(this.size,t);return isNaN(o)?1:o},wrappingGroup:{get:function(){var e,t=this;return null!=this.wrappingGroup_?this.wrappingGroup_:null!=this.wrappingGroupID_&&(e=s.as(s.opt(this.lockupForma,(function(e){return e.page.formaByID(t.wrappingGroupID_)})),M.GroupForma))?e:s.opt(this.lockupForma,(function(e){return 1==e.childCount}))?s.as(s.opt(this.lockupForma,(function(e){return e.childAt(0)})),M.GroupForma):null}},onFirstUpdate:function(){var e,t=this,o=!1;null!=(e=this.wrappingGroupID_)&&0==s.isEmpty(e)&&(o=!0);var n=null!=this.wrappingGroup_;if(o&&!n&&(this.wrappingGroup_=s.as(s.opt(this.lockupForma,(function(e){return e.page.formaByID(t.wrappingGroupID_)})),M.GroupForma),null==this.wrappingGroup&&(p.CoreAssertDebugOnly.fail("onFirstUpdate has wrappingGroupID_ but can't get wrappingGroup_",void 0,"TypeLockupController.onFirstUpdate","TypeLockupController.swift",1544),o=!1)),0==o&&(H.LegacyCoreAssert.isTrue(null!=this.lockupForma,"onFirstUpdate no lockupForma",void 0,"TypeLockupController.onFirstUpdate","TypeLockupController.swift",1558),(i=s.as(this.lockupForma.isModel?s.opt(this.lockupForma,(function(e){return e.page.createModelForma(M.GroupForma.KIND)})):s.opt(this.lockupForma,(function(e){return e.page.createForma(M.GroupForma.KIND)})),M.GroupForma))&&(s.opt(this.lockupForma,(function(e){return e.removeAllChildren()})),this.wrappingGroup_=i,this.wrappingGroupID_=i.formaID,s.opt(this.lockupForma,(function(e){return e.appendChild(i)})))),H.LegacyCoreAssert.isTrue(null!=this.wrappingGroup_,"onFirstUpdate no wrappingGroup_",void 0,"TypeLockupController.onFirstUpdate","TypeLockupController.swift",1585),0==this.wrappingGroup_.childCount)for(var r=s.iter(s.range(0,2,!1));!r.done;r.next()){var i;(i=s.as(this.lockupForma.isModel?this.lockupForma.page.createModelForma(M.GroupForma.KIND):this.lockupForma.page.createForma(M.GroupForma.KIND),M.GroupForma))&&s.opt(this.wrappingGroup_,(function(e){return e.appendChild(i)}))}this.updateFormaPools()},updateFormaPools:function(){var e;if(this.decorationFormaePool_.clear(),this.layoutFormaePool_.clear(),this.renderedLayoutResults_=null,this.renderedDecorationResults_=null,this.renderedConfiguration_=null,null!=this.wrappingGroup_&&this.wrappingGroup_.childCount>=2){var t,o;if(t=s.as(this.wrappingGroup_.childAt(0),M.GroupForma))for(var n=s.iter(t.childrenAsArray);!n.done;n.next()){var r=n.value;this.decorationFormaePool_.addForma(r)}if(o=s.as(this.wrappingGroup_.childAt(1),M.GroupForma))for(var i=s.iter(o.childrenAsArray);!i.done;i.next())r=i.value,((e=s.opt(s.as(r,ue.TextForma),(function(e){return e.isDecorationTextForma()})))||null!=e)&&e?this.decorationFormaePool_.addForma(r):this.layoutFormaePool_.addForma(r)}},recalculateTracking:function(e){de.TypeLockupUtils.disableMeasurementResizeCache();var t=this.lockupForma,o=this.lockupStyle,n=this.text,r=new U.LockupConfiguration(n,o,e,t.placement,s.opt(t.parent,(function(e){return e.bounds})),void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,this.fitContainerToArea),i=new Se.TheoSize(this.size.width,this.size.height);null==this.layoutStrategy_&&(this.layoutStrategy_=this.layoutStrategyForConfiguration(r));var a=this.layoutStrategy_.calculateTracking(r,i),l=e;0!=a&&a<1e-4&&(l=new Se.TheoSize(-a,l.height),a=0),this.beginBlockedUpdate(),s.opt(s.as(s.opt(this.lockupForma,(function(e){return e.style})),V.LockupStyle),(function(e){return e.tracking=a})),this.styleController.onTrackingChanged(),this.size=l,this.endBlockedUpdate(),this.internalUpdateGroup(!1)},recalculateLeading:function(e){var t=this.lockupForma,o=this.lockupStyle,n=this.text,r=new U.LockupConfiguration(n,o,e,t.placement,s.opt(t.parent,(function(e){return e.bounds})),void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,this.fitContainerToArea),i=new Se.TheoSize(this.size.width,this.size.height);null==this.layoutStrategy_&&(this.layoutStrategy_=this.layoutStrategyForConfiguration(r));var a=this.layoutStrategy_.calculateLeading(r,i),l=e;a<0&&(l=new Se.TheoSize(l.width,-a),a=0),this.beginBlockedUpdate(),s.opt(this.lockupStyle,(function(e){return e.spacing=a})),this.styleController.onSpacingChanged(),this.size=l,this.endBlockedUpdate(),this.internalUpdateGroup(!1)},setLetterSpacingAndBounds:function(e,t){var o;if(void 0===t&&(t=me.TheoPoint.ZERO),null==this.renderedLayoutResults_&&this.updateGroup(),o=this.renderedLayoutResults_){var n=this.layoutStrategy_.adjustSizeForTracking(this.text,o,this.lockupStyle.tracking,e),r=s.opt(n,(function(e){return e.width})),i=s.opt(n,(function(e){return e.height}));if(0==r&&0==i)return;var a,l=!1,u=0;null!=(a=r)&&(l=!0,u=a);var c,h=0;null!=(c=i)&&(l=!0,h=c);var d=this.forma.placement.transformValues,g=this.forma.bounds,p=new Se.TheoSize(g.width*d.xscale,g.height*d.xscale),f=new Se.TheoSize(p.width+u,p.height+h);if(f.width<=0||f.height<=0)return;if(l){this.beginBlockedUpdate(),this.lockupStyle.tracking=e,this.endBlockedUpdate();var m=new R.FormaResizeEvent(this.forma,f,t);this.onEvent(m),this.snapSizeToBounds()}else this.lockupStyle.tracking=e}},setLineSpacingAndBounds:function(e,t){var o;if(void 0===t&&(t=me.TheoPoint.ZERO),null==this.renderedLayoutResults_&&this.updateGroup(),!(this.numLines()-1<1)&&(o=this.renderedLayoutResults_)){var n=this.layoutStrategy_.adjustSizeForLeading(this.forma.bounds,o,this.lockupStyle.spacing,e),r=n.width,i=n.height,a=this.forma.placement.transformValues,l=this.forma.bounds,u=new Se.TheoSize(l.width*a.xscale,l.height*a.xscale),c=new Se.TheoSize(u.width+r,u.height+i);s.opt(this.lockupStyle,(function(e){return e.layout==V.LockupLayout.Auto}))?this.lockupStyle.spacing=e:(this.beginBlockedUpdate(),this.lockupStyle.spacing=e,this.endBlockedUpdate());var h=new R.FormaResizeEvent(this.forma,c,t);this.onEvent(h),s.opt(this.lockupStyle,(function(e){return e.layout!=V.LockupLayout.Auto}))&&this.snapSizeToBounds()}},addLineBreakConstraints:function(e){void 0===e&&(e=!1),this.allowFewerLineBreaks_=!1;var t=s.replaceAll(s.replaceAll(this.text,"\n"," "),"  "," "),o=s.replaceAll(t," ","");this.lockLineBreaks_=e||t.split(" ").length==o.length,!this.lockLineBreaks_&&this.text.split("\n").length>1&&(this.allowFewerLineBreaks_=!0)},removeLineBreakConstraints:function(){this.lockLineBreaks_=!1,this.allowFewerLineBreaks_=!1},updateGroup:function(){this.internalUpdateGroup(!0)},updateGroupWithFontSize:function(e,t){void 0===t&&(t=null),(this.lockLineBreaks_||this.allowFewerLineBreaks_)&&null!=e?s.opt(B.Host.logging,(function(e){return e.warning("Can't preserve font size while line breaks are constrainted")})):(this.preferredFontSize_=e,this.expansionSize_=t),this.internalUpdateGroup(!0),this.preferredFontSize_=null,this.expansionSize_=null},internalUpdateGroup:function(e){var t;if(!(t=s.opt(s.opt(this.owner,(function(e){return e.document})),(function(e){return e.inUndoRedo})))&&null==t||!t)if(null!=this.lockupForma){if(!this.blockUpdate&&null!=s.as(s.opt(this.lockupForma,(function(e){return e.root})),Q.RootForma)&&null!=this.lockupStyle){0==this.hasFirstUpdateRun&&(this.onFirstUpdate(),this.hasFirstUpdateRun=!0);var o=this.lockupForma,n=this.lockupStyle;if(!(null!=this.size&&null!=n.font&&this.styleFontsLoaded()&&n.colors.count>0&&this.text.length>0))return this.renderedConfiguration_=null,this.renderedColorLibrary_=null,this.renderedDecorationResults_=null,this.renderedLayoutResults_=null,this.clearLockupFormaPool(this.layoutFormaePool_),void this.clearLockupFormaPool(this.decorationFormaePool_);var r=this.text,a=!this.owner.selection.inCharStyleMode,l=this.forceLetterFormaMode,u=new U.LockupConfiguration(r,n,this.fitContainerToArea&&this.styleController.getSessionContainerSize()||this.size,o.placement,s.opt(o.parent,(function(e){return e.bounds})),a,l,this.preferredFontSize_,this.expansionSize_,void 0,void 0,void 0,void 0,void 0,this.fitContainerToArea);if(u.characterStyleRanges=s.clone(this.charStyleRanges),u.highlightMethod=this.highlightMethod,u.autoTextRanges=s.clone(this.autoTextRanges),u.rowWordLengths=null,this.lockLineBreaks_||this.allowFewerLineBreaks_){for(var c=s.clone(this.lockupForma.filterByKind(ue.TextForma.KIND)),h=0,d=s.iter(c);!d.done;d.next()){var g=d.value;h=Math.max(h,g.rowIndex)}u.rowWordLengths=s.repeat(0,h+1);for(var f=s.iter(c);!f.done;f.next())g=f.value,u.rowWordLengths[g.rowIndex]+=1;u.allowFewerLineBreaks=this.allowFewerLineBreaks_}this.updateCurrentColors(n),this.decorationStrategy_=this.decorationStrategyForConfiguration(u),this.layoutStrategy_=this.layoutStrategyForConfiguration(u);var y=s.opt(this.renderedConfiguration_,(function(e){return e.useOptimization==a})),v=null==this.renderedConfiguration_||null==this.renderedLayoutResults_||Math.abs(this.size.height-this.thresholdGroupHeight)>1||Math.abs(this.size.width-this.thresholdGroupWidth)>1||this.renderedConfiguration_.text!=u.text||u.style.needsLayout(this.renderedConfiguration_.style)||!i.rangesEqual(this.renderedConfiguration_.characterStyleRanges,u.characterStyleRanges)||this.renderedConfiguration_.highlightMethod!=u.highlightMethod||0==this.layoutFormaePool_.textFormaCount()||this.renderedConfiguration_.forceLetterForma!=u.forceLetterForma||!y;if(!v)for(var C=s.iter(u.style.characterStyles);!C.done;C.next()){var T=C.key,A=C.value;if(!(_=this.renderedConfiguration_.style.characterStyles[T])){v=!0;break}if(_.colorLibrary=this.renderedColorLibrary_,H.LegacyCoreAssert.isTrue(A.colorLibrary==n.colorLibrary,"char style library doesnt match lockup style",void 0,"TypeLockupController.internalUpdateGroup","TypeLockupController.swift",1978),A.needsLayout(_)||A.textOpacity!=_.textOpacity||A.backingOpacity!=_.backingOpacity){v=!0;break}}var F=v||!u.style.sameColors(this.renderedConfiguration_.style),k=null==this.renderedConfiguration_||u.style.needsLayout(this.renderedConfiguration_.style),L=null==this.renderedConfiguration_||v||!this.renderedConfiguration_.containerSize.equal(u.containerSize)||!this.renderedConfiguration_.placement.equal(u.placement)||this.renderedConfiguration_.style.backingArtworkID!=u.style.backingArtworkID||this.renderedConfiguration_.style.backing!=u.style.backing||this.renderedConfiguration_.style.textLook!=u.style.textLook||this.renderedConfiguration_.style.shadowAngle!=u.style.shadowAngle||F&&V.LockupStyle.isShadowLook(u.style.textLook);if(!L)for(var b=s.iter(u.style.characterStyles);!b.done;b.next()){var _;if(T=b.key,A=b.value,L=F&&A.textLook==V.LockupTextLook.KnockoutAndShadow,(_=this.renderedConfiguration_.style.characterStyles[T])&&(A.backingArtworkID!=_.backingArtworkID||A.shadowAngle!=_.shadowAngle)){L=!0;break}}if(this.isRightToLeft=de.TypeLockupUtils.isTextRightToLeft(r),v){var R,I,w,D;this.isResizing&&y&&s.opt(this.lockupStyle,(function(e){return e.layout!=V.LockupLayout.Auto}))&&(I=this.renderedLayoutResults_)&&(w=this.renderedConfiguration_)&&(D=this.size)&&(R=this.layoutStrategy_.reflow(D,this.resizePin_,w,I));var x=R||this.layoutStrategy_.layout(u);if(0==x.items.length){var P=this.getAverageFontSize(),E=0==P?12:P;x=new W.LayoutResults([W.LockupItem.init_bc20(S.ColorRole.FieldPrimary,null,u.containerSize,X.Matrix2D.Identity," ",u.style.font.fontData,E,E,x.typographicBoundingRatios,0,new ye.TextRange(0,1),void 0,E)],u.containerSize,X.Matrix2D.Identity,x.typographicBoundingRatios,u.containerSize.width/u.containerSize.height)}this.isRightToLeft&&x.flipForRightToLeft(),this.updatePoolForItems(x.items,this.layoutFormaePool_),this.renderedLayoutResults_=x;for(var M=!1,N=s.iter(x.items);!N.done;N.next())if(N.value.type==W.LockupItemType.Text){M=!0;break}M||p.CoreAssertDebugOnly.fail("layoutResults has no text items",{layoutType:u.style.layoutType,containerSize:u.containerSize.print(),text:u.text.substr(0,3)},"TypeLockupController.internalUpdateGroup","TypeLockupController.swift",2089)}null==this.renderedLayoutResults_&&p.CoreAssertDebugOnly.fail("renderedLayoutResults_ is nil",{layoutType:u.style.layoutType,containerSize:u.containerSize.print(),text:u.text.substr(0,3)},"TypeLockupController.internalUpdateGroup","TypeLockupController.swift",2094);var G=u.style.backing==V.LockupBacking.None,O=!1;if(L){var z=!1,Y=this.decorationStrategy_.decorate(u,this.renderedLayoutResults_);if((A=u.style.characterStyles[i.HIGHLIGHT_STYLE])&&!V.LockupStyle.isPath(u.style.layout)&&!V.LockupStyle.isAutoLayout(u.style.layout)){if(V.LockupStyle.isShadowLook(A.textLook)){var K=(new ee.ShadowDecorationStrategy).decorate(u,this.renderedLayoutResults_);s.append(Y.items,K.items),G=!0,O=A.textLook==V.LockupTextLook.KnockoutAndShadow||A.textLook==V.LockupTextLook.KnockoutShadowOutline,z=!0}if(u.style.backing!=V.LockupBacking.None&&A.textLook==V.LockupTextLook.FillAndOutline2){var j=(new q.NoDecorationStrategy).decorate(u,this.renderedLayoutResults_);s.append(Y.items,j.items),G=!0}if((A.backing==V.LockupBacking.Rows||A.backing==V.LockupBacking.SVGBackground)&&u.style.backing!=V.LockupBacking.Rows&&!V.LockupStyle.isLetterGrid(u.style.layout)){var Z=(new J.RowsDecorationStrategy).decorate(u,this.renderedLayoutResults_);if(G&&Y.items.length>1)for(var $=s.iter(Z.items);!$.done;$.next()){var te=$.value;Y.items.splice(0,0,te)}else s.append(Y.items,Z.items)}}if(u.style.backing!=V.LockupBacking.None&&u.style.textLook==V.LockupTextLook.FillAndOutline2){var oe=(new q.NoDecorationStrategy).decorate(u,this.renderedLayoutResults_);s.append(Y.items,oe.items),G=!0}else if(V.LockupStyle.isShadowLook(u.style.textLook)){if(!z){var ne=(new ee.ShadowDecorationStrategy).decorate(u,this.renderedLayoutResults_);s.append(Y.items,ne.items),G=!0}O=O||u.style.textLook==V.LockupTextLook.KnockoutAndShadow||u.style.textLook==V.LockupTextLook.KnockoutShadowOutline}this.updatePoolForItems(Y.items,this.decorationFormaePool_),this.renderedDecorationResults_=Y}(F||v)&&this.conformFormaeForItems(this.renderedLayoutResults_.items,this.layoutFormaePool_),(F||L)&&this.conformFormaeForItems(this.renderedDecorationResults_.items,this.decorationFormaePool_,G,O);var re=this.renderedLayoutResults_.size.width,ie=this.renderedLayoutResults_.size.height;this.thresholdGroupHeight=this.size.height,this.thresholdGroupWidth=this.size.width,this.setLayerOpacities(n);var ae=this.findInternalOffset(n,this.size,new Se.TheoSize(re,ie));this.updateChildGroupBounds(),e&&s.opt(this.wrappingGroup,(function(e){return e.placement=X.Matrix2D.Identity.translate(ae)})),null==this.resizePin_&&(this.localCoordinateAlignmentLines_=s.clone(this.alignmentsInLocalCoords(!0))),(v||L)&&s.opt(s.opt(this.lockupForma,(function(e){return e.animation})),(function(e){return e.invalidate()})),u.style=n.clone(),this.renderedColorLibrary_=m.ColorLibrary.init_fcb1(n.colorLibrary),this.renderedConfiguration_=u,this.renderedConfiguration_.style.colorLibrary=this.renderedColorLibrary_,v&&this.highlightMethod>=i.FIRST_AUTO_METHOD&&this.highlightMethod<=i.MAX_AUTO_METHOD&&(this.autoApplyCharStyle(!0,!1,!0),k&&this.updateGroup())}}else s.opt(B.Host.logging,(function(e){return e.warning("TypeLockupController.updateGroup() after detachment")}))},setLayerOpacities:function(e){var t=e.currentTextOpacity,o=e.currentBackingOpacity,n=s.as(s.opt(this.wrappingGroup_,(function(e){return e.childAt(1)})),M.GroupForma);s.opt(n,(function(e){return e.style.opacity=t})),n=s.as(s.opt(this.wrappingGroup_,(function(e){return e.childAt(0)})),M.GroupForma),s.opt(n,(function(e){return e.style.opacity=o}))},updateChildGroupBounds:function(){var e,t;if(e=this.wrappingGroup_){var o=new x.FormaGeometryChangedEvent(e);e.beginUpdate(o),e.endUpdate(o)}(t=s.as(s.opt(this.wrappingGroup_,(function(e){return e.childAt(1)})),M.GroupForma))&&(o=new x.FormaGeometryChangedEvent(t),t.beginUpdate(o),t.endUpdate(o)),(t=s.as(s.opt(this.wrappingGroup_,(function(e){return e.childAt(0)})),M.GroupForma))&&(o=new x.FormaGeometryChangedEvent(t),t.beginUpdate(o),t.endUpdate(o))},findInternalOffset:function(e,t,o){var n=0,r=0,i=(t.width-o.width)/2,a=(t.height-o.height)/2,l=e.alignment,u=e.verticalAlignment;return this.isResizingHorizontally&&(l=s.opt(this.resizePin_,(function(e){return 0==e.x?V.LockupAlignment.Right:V.LockupAlignment.Left})),u=V.VerticalLockupAlignment.Top),e.layout==V.LockupLayout.Auto||l==V.LockupAlignment.UNSET||l==V.LockupAlignment.Center?n=i:l==V.LockupAlignment.Right&&(n=t.width-o.width),u==V.VerticalLockupAlignment.UNSET||u==V.VerticalLockupAlignment.VerticalCenter?r=a:u==V.VerticalLockupAlignment.Bottom&&(r=t.height-o.height),new me.TheoPoint(n,r)},conformTextFormaToItem:function(e,t){var o,n,r=this;if(t.type==W.LockupItemType.Text){var i,a,l,u=t.font,c=this.currentColors[t.colorRole],h=t.colorRole==S.ColorRole.Shadow?c:this.currentColors[S.ColorRole.Border],d=this.lockupStyle.textLook;e.style.opacity=1,null!=t.characterStyle&&(i=s.opt(this.lockupStyle,(function(e){return e.characterStyles[t.characterStyle]})))&&(i.textLook!=V.LockupTextLook.UNSET&&(d=i.textLook),H.LegacyCoreAssert.isTrue(i.colorLibrary==this.lockupStyle.colorLibrary,"char style library doesnt match lockup style",void 0,"TypeLockupController.conformTextFormaToItem","TypeLockupController.swift",2348),(a=i.colors.color(t.colorRole))&&(c=a),(l=i.colors.border)&&(h=t.colorRole==S.ColorRole.Shadow?c:l),i.textOpacity!=D.FormaStyle.OPACITY_UNSET&&(e.style.opacity=i.textOpacity),i.textLook==V.LockupTextLook.Fill&&V.LockupStyle.isKnockoutLook(this.lockupStyle.textLook)&&i.textOpacity<1&&i.textOpacity!=D.FormaStyle.OPACITY_UNSET&&(d=V.LockupTextLook.KnockoutAndFill));var g=(o=s.opt(this.renderedLayoutResults_,(function(e){return e.avgTextPointSize})))||null!=o?o:t.pointSize,p=0,f=this.lockupStyle.strokeWeight+.04;d==V.LockupTextLook.OutlineOnly||d==V.LockupTextLook.KnockoutAndOutline||d==V.LockupTextLook.FillAndOutline?p=.5*g*f:d==V.LockupTextLook.ShadowAndOutline?p=.08*g*(f+.25):d==V.LockupTextLook.KnockoutAndShadow?t.colorRole!=S.ColorRole.FieldPrimary&&(p=.08*t.pointSize*(1.7*this.lockupStyle.shadowOffset+.25),e.style.opacity=.75):d==V.LockupTextLook.FillAndOutline2?t.colorRole!=S.ColorRole.FieldPrimary&&(p=.5*g*f):d==V.LockupTextLook.KnockoutAndFill&&s.opt(this.lockupStyle,(function(e){return e.colors.colorID(S.ColorRole.FieldPrimary)==s.opt(r.lockupStyle,(function(e){return e.colors.colorID(S.ColorRole.FieldSecondary)}))}))?p=((n=s.opt(this.lockupStyle,(function(e){return e.backingOpacity})))||null!=n?n:1)>.8?6:1:d==V.LockupTextLook.ShadowOutlineTransparentText?t.colorRole==S.ColorRole.FieldPrimary?(d=V.LockupTextLook.OutlineOnly,0==(p=.5*g*f)&&(p=10)):(d=V.LockupTextLook.Shadow,p=0):d==V.LockupTextLook.KnockoutShadowOutline&&(t.colorRole!=S.ColorRole.FieldPrimary?(d=V.LockupTextLook.KnockoutAndShadow,p=.08*t.pointSize*(1.7*this.lockupStyle.shadowOffset+.25),e.style.opacity=.75):(d=V.LockupTextLook.KnockoutAndOutline,0==(p=.5*g*f)&&(p=10))),t.colorRole==S.ColorRole.FieldPrimary&&V.LockupStyle.isKnockoutLook(d)&&d!=V.LockupTextLook.KnockoutAndFill&&(c=$.SolidColor.BLACK);var m=p==ue.TextForma.STROKEWIDTH_ZERO?null:p,y=d==V.LockupTextLook.Fill?null:d,v=s.opt(this.lockupStyle,(function(e){return e.tracking==ue.TextForma.TRACKING_ZERO}))?null:s.opt(this.lockupStyle,(function(e){return e.tracking}));e.setTextProperties(t.text,u,t.pointSize,c,h,m,y,v,t.rangeInLockup,t.rowIndex,t.colorRole),e.placement=t.placement}else H.LegacyCoreAssert.fail("Expected text item",void 0,"TypeLockupController.conformTextFormaToItem","TypeLockupController.swift",2331)},conformShapeFormaToItem:function(e,t,o){var n=null;o&&((n=new x.FormaAnimationTransactionEvent(e)).duration=0,e.beginUpdate(n)),e.style.opacity=1;var r,i,a=this.currentColors[t.colorRole];switch(null!=t.characterStyle&&(r=s.opt(this.lockupStyle,(function(e){return e.characterStyles[t.characterStyle]})))&&(H.LegacyCoreAssert.isTrue(r.colorLibrary==this.lockupStyle.colorLibrary,"char style library doesnt match lockup style",void 0,"TypeLockupController.conformShapeFormaToItem","TypeLockupController.swift",2479),(i=r.colors.color(t.colorRole))&&(a=i),r.backingOpacity!=D.FormaStyle.OPACITY_UNSET&&(e.style.opacity=r.backingOpacity)),t.type){case 0:H.LegacyCoreAssert.fail("Text item cannot be associated with a shape forma",void 0,"TypeLockupController.conformShapeFormaToItem","TypeLockupController.swift",2492);break;case 1:e.contentID=null,e.preScale=null,e.size=t.size,e.sliceBox=null,e.shapeLibraryID=null,e.canonicalArtwork=ie.TheoArtworkShape.fromPath(t.path),e.style.colors.fieldPrimary=a,e.placement=t.placement;break;case 2:if(e.shapeLibraryID!=t.artworkID&&oe.ShapeLibrary.applyToShapeForma(e,t.artworkID),null==e.sliceBox){var l=e.canonicalArtwork.bounds,u=l.width,c=l.height,h=t.size,d=h.width<=h.height?h.width/u:h.height/c;u*=d,c*=d,e.size=new Se.TheoSize(u,c)}else e.size=t.size;e.preScale=t.preScale,e.placement=t.placement,e.style.colors.fieldPrimary=a}o&&e.endUpdate(n)},decodeMetadata:function(){var e,t;this.beginBlockedUpdate(),(e=s.as(this.controllerMetadata.get(i.PROPERTY_LOCKUPSTYLE_DEPRECATED),V.LockupStyle))&&(e.backing==V.LockupBacking.Banner&&(e.backing=this.size.width>this.size.height?V.LockupBacking.BannerHorizontal:V.LockupBacking.BannerVertical),s.opt(this.lockupForma,(function(t){return t.applyStyle(e)}))),(t=s.as(this.controllerMetadata.get(i.PROPERTY_SIZE_DEPRECATED),Se.TheoSize))&&(this.size=t),this.endBlockedUpdate()},postDecode:function(){var e,t,o;this.validDecode_=null!=this.contentNode,this.beginBlockedUpdate(),this.styleController_.legacyColorConversion(),this.endBlockedUpdate();var n=(e=s.opt(s.opt(this.lockupForma,(function(e){return e.page.document})),(function(e){return e.versionDecoded.vers})))||null!=e?e:0,r=!1;if(H.LegacyCoreAssert.isTrue(this.lockupForma.controller===this,"Controller-forma mismatch",void 0,"TypeLockupController.postDecode","TypeLockupController.swift",2590),S=s.as(s.opt(this.lockupForma,(function(e){return e.style})),V.LockupStyle)){var a,l;if(S.backing==V.LockupBacking.SVGBackground&&(null==S.backingArtworkID&&(H.LegacyCoreAssert.fail("postDecode - style.backingArtworkID is nil.",{version:(t=s.opt(s.opt(this.lockupForma,(function(e){return e.page.document})),(function(e){return e.versionDecoded.description})))||null!=t?t:"nil"},"TypeLockupController.postDecode","TypeLockupController.swift",2598),S.backingArtworkID="square_001"),null!=(a=S.backingArtworkID)&&(l=this.contentDocument.nodeWithTag(oe.TAG_SHAPE_ID,a))&&l.removeFromParent()),n<se.TheoDocumentVersion.Knockouts&&S.backing==V.LockupBacking.None&&1!=S.textOpacity){var u=S.textOpacity,c=S.backingOpacity;S.textOpacity=u,S.backingOpacity=c}var h,d=V.LockupStyle.isKnockoutLook(S.textLook);if((h=S.characterStyles[i.HIGHLIGHT_STYLE])&&(d=d||V.LockupStyle.isKnockoutLook(h.textLook)),d){var g=S.backing;S.backing=V.LockupBacking.None,S.backing=g}var f=(o=s.opt(s.opt(this.forma,(function(e){return e.page.document})),(function(e){return e.missingFontList.length})))||null!=o?o:0;if(f>this.missingFontCount_?(r=!0,this.missingFontCount_=f):n<se.TheoDocumentVersion.LetterSpacing&&s.opt(S.font,(function(e){return"Pacifico-Regular"==e.fontData.postScriptName||s.opt(S.font,(function(e){return"Montserrat-Regular"==e.fontData.postScriptName}))}))&&(r=!0),n<se.TheoDocumentVersion.NewTextAnimations&&(this.text.includes("")||this.text.includes(""))&&0==S.spacing&&(S.spacing=.5,r=!0),n<se.TheoDocumentVersion.TextEffects&&null!=this.contentNode){var m=ge.ContentTextModel.init_d41d();m.match(this.contentNode.textModel),this.contentNode.textModel=m}this.text.trim().length>0&&!this.hasTextFormae()&&(null==S.font?S.font=he.TheoFont.init_9e5c(B.Host.textModelUtils.defaultFont()):r=!0),!r&&n<=se.TheoDocumentVersion.LimitedUseStockLicenses&&s.opt(S.font,(function(e){return"FuturaPT-Medium"==e.fontData.postScriptName}))&&(r=!0),!r&&n<=se.TheoDocumentVersion.LimitedUseStockLicenses&&s.opt(S.font,(function(e){return"Quicksand-Bold"==e.fontData.postScriptName}))&&(r=!0)}var y,v=!1;null!=(y=this.wrappingGroupID_)&&0==s.isEmpty(y)&&(v=!0);var S,C,T=this.hasTextFormae();(p.CoreAssertDebugOnly.isTrue(T,"postDecode type lockup has no text forma!",void 0,"TypeLockupController.postDecode","TypeLockupController.swift",2697),this.removeListenersFromNode(),this.addListenersToNode(),r)?((S=s.as(s.opt(this.lockupForma,(function(e){return e.style})),V.LockupStyle))&&S.layout==V.LockupLayout.Auto&&((C=ae.TypographyComposer.getWeightingForAlignment(S.alignment,this.text,this.charStyleRanges))?this.autoTextRanges=s.clone(C):(S.alignment=ce.TextFacade.getNextValidAutoAlignment(this.forma,S.alignment),this.autoTextRanges=s.clone(ae.TypographyComposer.getWeightingForAlignment(S.alignment,this.text,this.charStyleRanges)))),this.styleChanged()):v&&T||this.updateGroup()},replaceFonts:function(e,t){this.beginBlockedUpdate();var o=this.replaceFontInStyle(this.lockupStyle,e,t),n=this.replaceFontInStyle(s.opt(this.lockupStyle,(function(e){return e.characterStyles[i.HIGHLIGHT_STYLE]})),e,t);this.endBlockedUpdate(),(o||n)&&(this.clearLockupFormaPool(this.layoutFormaePool_),this.styleChanged())},replaceFontInStyle:function(e,t,o){var n;return!(null==(n=s.opt(s.opt(e,(function(e){return e.font})),(function(e){return e.fontData.postScriptName})))||!t.includes(n)||(s.opt(e,(function(e){return e.font=o})),0))},clone:function(e){var t=new L.FormaControllerFactory(this.owner).createController(this.kind,e);return t.beginBlockedUpdate(),t.controllerMetadata=e.controllerMetadata,t.size=this.size,t.highlightMethod=this.highlightMethod,t.charStyleRanges=s.clone(this.charStyleRanges),t.contentID=this.contentID,t.validDecode_=this.validDecode_,t.removeListenersFromNode(),t.endBlockedUpdate(),t},match:function(e){var t;(t=s.as(e,i))?(this.size=t.size,this.highlightMethod=t.highlightMethod,0==s.count(s.opt(this.lockupStyle,(function(e){return e.characterStyles})))&&0==!this.charStyleRanges.length?this.charStyleRanges=[]:de.TypeLockupUtils.rangesAreEqual(this.charStyleRanges,t.charStyleRanges)||this.text==t.text&&(this.charStyleRanges=s.clone(t.charStyleRanges)),de.TypeLockupUtils.rangesAreEqual(this.autoTextRanges,t.autoTextRanges)||this.text==t.text&&(this.autoTextRanges=s.clone(t.autoTextRanges)),this.updateGroup()):E.GroupController.prototype.match.call(this,e)},formaWillChangeState:function(e,t){var o=this;if(null!=t[M.GroupForma.PROPERTY_BOUNDS]||null!=t[F.Forma.PROPERTY_STYLE]||null!=t[F.Forma.PROPERTY_PLACEMENT]){e.visitAll(F.FormaTraversal.PreOrder,(function(e){(e instanceof te.ShapeForma||e instanceof ue.TextForma)&&(o.formaUpdateEvents_.push(new x.FormaGeometryChangedEvent(e)),null!=t[F.Forma.PROPERTY_STYLE]&&o.formaUpdateEvents_.push(new x.FormaStyleChangedEvent(e)))}));for(var n=s.iter(this.formaUpdateEvents_);!n.done;n.next()){var r=n.value;r.forma.beginUpdate(r)}}},formaDidChangeState:function(e,t){if(null!=t[M.GroupForma.PROPERTY_BOUNDS]||null!=t[F.Forma.PROPERTY_STYLE]||null!=t[F.Forma.PROPERTY_PLACEMENT]){for(var o=s.iter(this.formaUpdateEvents_);!o.done;o.next()){var n=o.value;n.forma.endUpdate(n)}this.formaUpdateEvents_.splice(0)}},formaWillCommitState:function(e){E.GroupController.prototype.formaWillCommitState.call(this,e),this.shrinkPools=!0},shrinkPools:{get:function(){return this.layoutFormaePool_.shrinkPools_},set:function(e){this.layoutFormaePool_.shrinkPools_=e,this.decorationFormaePool_.shrinkPools_=e,e&&(null!=this.renderedLayoutResults_&&this.updatePoolForItems(this.renderedLayoutResults_.items,this.layoutFormaePool_),null!=this.renderedDecorationResults_&&this.updatePoolForItems(this.renderedDecorationResults_.items,this.decorationFormaePool_))}},textBacked:{get:function(){var e;return!!(e=this.lockupStyle)&&e.textBacked}},maxLineLengthDifference:{get:function(){var e=this.numLines(),t=s.repeat(1/0,e),o=s.repeat(-1/0,e);this.lockupForma.visit(F.FormaTraversal.PreOrder,(function(e,n,r){var i,a;return(i=s.as(e,ue.TextForma))&&0!=i.rangeInLockup.length&&(a=i.finalFrame)&&(t[i.rowIndex]=Math.min(t[i.rowIndex],a.minY),o[i.rowIndex]=Math.max(o[i.rowIndex],a.maxY)),!1}));for(var n=[],r=s.iter(s.range(0,e,!1));!r.done;r.next()){var i=r.value;isFinite(t[i])&&isFinite(o[i])&&n.push(o[i]-t[i])}return n.length>0?s.max(n)-s.min(n):0}},doesContrast:function(){return this.styleController.doesLockupContrastWithBackground()},contrastCheck:function(e){void 0===e&&(e=!0),this.styleController_.backgroundContrastCheck(e)},getBackgroundEdge:function(){var e,t;return(e=s.as(this.visualParent.controller,k.FrameController))&&(t=s.opt(this.forma,(function(e){return e.finalFrame})))?e.getAverageEdge(t):null},getBackgroundLightnessSpread:function(e){for(var t=100,o=0,n=s.iter(e);!n.done;n.next()){var r=n.value;t=Math.min(t,r.lightness),o=Math.max(o,r.lightness)}return j.MathUtils.absDouble(o-t)},recordSize:function(e){this.thresholdGroupHeight=e.height,this.thresholdGroupWidth=e.width,this.size=e},snapSizeToBounds:function(){var e=new x.FormaTransformChangedEvent(this.lockupForma);if(null!=this.lockupForma.frame&&null!=this.renderedLayoutResults_){this.lockupForma.beginUpdate(e),this.lockupForma.placement=this.wrappingGroup_.placement.concat(this.lockupForma.placement);var t,o=this.renderedLayoutResults_.size;this.recordSize(o),this.lockupForma.endUpdate(e),(t=this.lockupForma.parent)&&N.GroupFacade.updateUserGroupHierarchy(t)}},isTypeLockup:{get:function(){return!0}},avgLineHeight:{get:function(){var e;return null!=(e=this.averageLineHeight)?e:-1}},averageLineHeight:{get:function(){var e;if(e=this.renderedLayoutResults_){var t=this.lockupForma.placement.transformValues.yscale;if(isFinite(e.avgTextItemHeight))return e.avgTextItemHeight*t}return null}},currentHeightScale:{get:function(){return this.getAverageFontSize()}},getSizeHeightScales:function(){return null==this.sizeHeightScales_&&this.calculateSizeHeightScales(),this.sizeHeightScales_},calculateSizeHeightScales:function(){var e=[];this.forma.placement=X.Matrix2D.Identity;for(var t=[this.size.aspectRatio,.1,.2,.3,.4,.5,.6,.8,1,1.4,2,3,5,12],o=s.iter(t);!o.done;o.next()){for(var n=o.value,r=s.opt(this.renderedLayoutResults_,(function(e){return e.size}))||new Se.TheoSize(100*n,100),i=!1,a=s.iter(e);!a.done;a.next()){var l=a.value;Math.abs(l.size.aspectRatio-r.aspectRatio)<.01&&(i=!0)}i||e.push({size:r,scale:this.avgLineHeight})}this.sizeHeightScales_=s.clone(e)},numLines:function(){var e,t=0;if(null!=(e=s.opt(this.renderedLayoutResults_,(function(e){return e.numberOfLines}))))t=e;else{var o=-1;this.lockupForma.visit(F.FormaTraversal.PreOrder,(function(e,t,n){var r;return(r=s.as(e,ue.TextForma))&&0!=r.rangeInLockup.length&&(o=Math.max(o,r.rowIndex)),!1})),o>-1&&(t=o+1)}return t},textFrame:{get:function(){return this.textBoundsInCoordSpace(this.lockupForma.placement)}},textFinalFrame:{get:function(){var e,t=null;return(e=this.lockupForma)&&e.visitAll(F.FormaTraversal.PreOrder,(function(e){e.kind==ue.TextForma.KIND&&(t=ve.TheoRect.unionOf(t,e.finalFrame))})),t}},getKnockoutOutlines:function(e){var t,o=fe.TheoPathBuilder.init_d41d(),n=!0;if(null!=(t=e.shapeLibraryID)){var r=oe.ShapeLibrary.shapeDictionary[t];if(!r.filled)return null;n=r.clockwise}var i,a=e.boundsInCoordSpace(e.placement);return(i=this.lockupForma)&&i.visit(F.FormaTraversal.PreOrder,(function(e,t,r){var i;if(i=s.as(e,ue.TextForma)){var l=i.boundsInCoordSpace(i.placement).evalXY(.5,.5);if(!a.containsPoint(l))return!1;var u=i.fontDescriptor,c=i.fontSize,h=i.textLook,d=V.LockupStyle.isKnockoutLook(h);if(h==V.LockupTextLook.KnockoutAndShadow&&(d=0==i.fontStrokeWidth),d){var g=i.tracking,p=B.Host.textModelUtils.textOutlines(i.text,u,c,g);null!=p&&(n==B.Host.textModelUtils.fontHasClockwiseOutlines(u)&&(p=B.Host.textModelUtils.rewindPath(p)||p),o.addPath(p,i.placement))}}return!1})),null==o.path.bounds?null:o.path},textBoundsInCoordSpace:function(e){var t,o=null;if(t=this.lockupForma){var n=[];t.visit(F.FormaTraversal.PreOrder,(function(t,r,i){var a;return 0==r?n=[e]:(n=n.slice(0,r)).push(t.placement.concat(s.last(n))),(a=s.as(t,ue.TextForma))&&(o=ve.TheoRect.unionOf(o,a.boundsInCoordSpace(s.last(n)))),!1}))}return o},textBoundsInCoordSpace2:function(e){var t,o=null;return(t=this.lockupForma)&&t.visitPlaced(e,(function(e,t,n,r){var i;return(i=s.as(e,ue.TextForma))&&(o=ve.TheoRect.unionOf(o,i.boundsInCoordSpace(t))),!1})),o},shapeCount:function(){return s.as(this.lockupForma.root,Q.RootForma).filterByControllerKind(P.GridController.KIND).length},wordCount:function(){return this.text.length>0?this.text.split(" ").length:0},updateScoring:function(){this.styleController_.updateScoring()},shuffleColorAssignment:function(){var e;if(e=this.lockupForma){var t=new x.FormaStyleChangedEvent(e);e.beginUpdate(t),this.styleController_.shuffleColorAssignment(),e.endUpdate(t)}},applyTextStyleSuggestion:function(e,t,o){var n,r;if(void 0===t&&(t=null),void 0===o&&(o=!0),!((n=e)&&(a=t)&&(r=a.lockupStyleEvaluator.styleEvaluatedWithReadability(n)))){var a,l=null;(a=t)&&(l=a.getTextStyleSuggestion(t)),null==l&&(l=this.getNewStyleAttributes(!0,t,o)),l.layout==V.LockupLayout.Auto&&(this.autoTextRanges=s.clone(ae.TypographyComposer.getWeightingForAlignment(l.alignment,this.text)));var u=s.as(this.forma.style,V.LockupStyle);return this.forma.applyStyle(l),null!=l.font&&l.font.isSparkFont()?g.BrandingFacade.brandDocumentForElement(this.forma.page.document,l.font.sparkElementID,g.AUTHORING_CONTEXT_TYPE_FONT):s.opt(u,(function(e){return null!=e.font}))&&u.font.isSparkFont()&&g.BrandingFacade.unBrandDocumentIfNoBrandedElements(this.forma.page.document),l}if(r.layout==V.LockupLayout.Auto){var c=s.clone(ae.TypographyComposer.getWeightingForAlignment(r.alignment,this.text));null!=c?this.autoTextRanges=s.clone(c):(r.alignment=ce.TextFacade.getNextValidAutoAlignment(this.forma,r.alignment),this.autoTextRanges=s.clone(ae.TypographyComposer.getWeightingForAlignment(r.alignment,this.text)))}return this.forma.applyStyle(r),this.charStyleRanges.length>0&&0==s.count(r.characterStyles)?(this.getCharacterStyle(i.HIGHLIGHT_STYLE),this.updateGroup()):this.styleController.pickVisibleColorsForCharStyle()&&this.updateGroup(),null},applyNextTextEmphasisSuggestion:function(e){var t;return(t=e.postTextStylesServiceInterface.getNextTextEmphasisSuggestion())?(this.applyCharStyleFromRangeListWithoutUI(this.charStyleRanges,l.CharStyleApplyMode.Remove),s.clone(this.applyCharStyleFromRangeListWithoutUI(t,l.CharStyleApplyMode.Toggle))):[]},getNewStyleAttributes:function(e,t,o){for(var n=s.iter(s.range(0,5,!1));!n.done;n.next()){var r;if(r=this.styleController_.getNewStyleAttributes(e,t,o))return r}return s.opt(B.Host.logging,(function(e){return e.info("unable to find a suitable style using the evaluator, return a potential bad style")})),this.styleController_.getNewStyleAttributes(e,t,!1)},generateAndApplyInitialStyleAttributes:function(){this.styleController_.generateAndApplyInitialStyleAttributes(),s.isEmpty(this.text)||this.snapSizeToBounds()},clearLockupFormaPool:function(e){for(var t=s.iter(e.configureTextFormae({}));!t.done;t.next()){var o=t.value;s.opt(o.parent,(function(e){return e.removeChild(o)}))}for(var n=s.iter(e.configureShapeFormae(0));!n.done;n.next())o=n.value,s.opt(o.parent,(function(e){return e.removeChild(o)}))},preferredXAlignment:{get:function(){return this.lockupStyle.alignment==V.LockupAlignment.Left?c.AlignmentType.Left:this.lockupStyle.alignment==V.LockupAlignment.Right?c.AlignmentType.Right:c.AlignmentType.CenterX}},setAlignmentType:function(e){this.numLines()>1&&(e==c.AlignmentType.Left&&s.opt(this.lockupStyle,(function(e){return e.alignment!=V.LockupAlignment.UNSET}))&&s.opt(this.lockupStyle,(function(e){return e.alignment!=V.LockupAlignment.Left}))&&(this.lockupStyle.alignment=V.LockupAlignment.Left),e==c.AlignmentType.Right&&s.opt(this.lockupStyle,(function(e){return e.alignment!=V.LockupAlignment.UNSET}))&&s.opt(this.lockupStyle,(function(e){return e.alignment!=V.LockupAlignment.Right}))&&(this.lockupStyle.alignment=V.LockupAlignment.Right),e==c.AlignmentType.CenterX&&s.opt(this.lockupStyle,(function(e){return e.alignment!=V.LockupAlignment.UNSET}))&&s.opt(this.lockupStyle,(function(e){return e.alignment!=V.LockupAlignment.Center}))&&(this.lockupStyle.alignment=V.LockupAlignment.Center))},canClaimForma:function(e){return!1},getPinBounds:function(e){var t,o=s.opt(this.lockupForma,(function(e){return e.bounds}));return(t=this.lockupStyle)&&(o=e==pe.PinBoundsType.Bounds||t.backing==V.LockupBacking.Banner||t.backing==V.LockupBacking.BannerHorizontal||t.backing==V.LockupBacking.BannerVertical?this.textBoundsInCoordSpace(X.Matrix2D.Identity):this.lockupForma.childrenBoundsInCoordSpace(X.Matrix2D.Identity)),o},centerAlignmentIfSingleLine:function(){var e=this,t=s.opt(s.opt(this.wrappingGroup_,(function(e){return e.bounds})),(function(t){return t.equalWithAccuracy(e.forma.bounds,.01)}));1!=this.numLines()||null==t||!t||this.lockupStyle.alignment!=V.LockupAlignment.Left&&this.lockupStyle.alignment!=V.LockupAlignment.Right||(this.lockupStyle.alignment=V.LockupAlignment.Center)},preventOutofBoundsOrOverlap:function(e){var t,o;(t=this.textFinalFrame)&&(o=this.lockupForma)&&!e.contains(t)&&(t.minX<e.minX&&o.move(X.Matrix2D.translationXY(-1*(t.minX-e.minX)+10,0)),t.maxX>e.maxX&&o.move(X.Matrix2D.translationXY(e.maxX-t.maxX-10,0)),t.minY<e.minY&&o.move(X.Matrix2D.translationXY(0,-1*(t.minY-e.minY)+10)),t.maxY>e.maxY&&o.move(X.Matrix2D.translationXY(0,e.maxY-t.maxY-10)))},addForma:function(e,t,o){var n,r,a,l=this;if((n=s.as(e.root,Q.RootForma))&&(r=s.as(t,M.GroupForma))&&(a=s.as(t.controller,i))){this.beginBlockedUpdate(),o.suggestPlacement||t.controller.fit(n.frame.insetRel(.25,.25,.25,.25)),t.applyStyle(V.LockupStyle.createDefault());var u=!1,c=s.clone(n.filterWithCallback((function(e){return e instanceof O.ImageForma&&e.parent instanceof I.FrameForma}))),h=null;c.length>0&&(h=s.as(c[0],O.ImageForma));for(var d=s.iter(n.page.getAllSelectableTopLevel());!d.done;d.next()){var g,p,f=d.value;if((g=s.as(f.controller,i))&&s.opt(g.lockupStyle,(function(e){return e.backing!=V.LockupBacking.Knockout}))&&(p=s.as(s.opt(g.lockupStyle,(function(e){return e.clone()})),V.LockupStyle))){var m=V.LockupStyle.isLetterGrid(p.layout),v=V.LockupStyle.isPath(p.layout);if(m||v){if(p.layout=V.LockupLayout.Standard,v)p.alignment=V.LockupAlignment.Center;else for(var S=s.iter(p.characterStyles);!S.done;S.next()){var C=S.value;C.backing==V.LockupBacking.UNSET&&(C.backing=V.LockupBacking.None)}p.tracking=V.LockupStyle.DEFAULT_TRACKING}t.applyStyle(p),u=!0}}var T=s.clone(n.filterByControllerKind(P.GridController.KIND));if(1==T.length?T[0].appendChild(t):n.appendChild(t),this.endBlockedUpdate(),this.updateGroup(),o.suggestPlacement){var A,F=y.CorePromise.resolve(null);return(A=s.opt(s.opt(h,(function(e){return e.contentNode})),(function(e){return e.image})))&&(A.loaded()||(t.moveCenterToPoint(new me.TheoPoint(-n.frame.center.x,n.frame.center.y)),F=A.whenLoaded())),F.then((function(e){return l.placeStyleLockup(r,n,a,u),y.CorePromise.resolve(null)}))}return y.CorePromise.resolve(null)}return y.CorePromise.reject("TypeLockupController.addFormaToRoot: no lockup forma")},getBackingContrastRole:function(){var e;if(e=this.lockupStyle){var t=e.textLook==V.LockupTextLook.KnockoutOnly||e.textLook==V.LockupTextLook.OutlineOnly,o=e.strokeWeight>.15;return t||o||e.textBacked?S.ColorRole.FieldSecondary:S.ColorRole.FieldPrimary}return S.ColorRole.FieldPrimary},getSuggestableColors:function(){return this.styleController_.getSuggestableColors()},getCurrentColorsWithRole:function(e,t){void 0===t&&(t=!1);var o,n,r,i,a=[];return t&&!this.primaryColorVisible()||((o=e.colors.color(S.ColorRole.FieldPrimary))?a.push(new C.SolidColorWithRole(S.ColorRole.FieldPrimary,o)):(p.CoreAssertDebugOnly.fail("Unexpected: ColorTable doesn't have primary color",void 0,"TypeLockupController.getCurrentColorsWithRole","TypeLockupController.swift",3901),a.push(new C.SolidColorWithRole(S.ColorRole.FieldPrimary,$.SolidColor.WHITE)))),t&&!this.secondaryColorVisible()||((n=e.colors.color(S.ColorRole.FieldSecondary))?a.push(new C.SolidColorWithRole(S.ColorRole.FieldSecondary,n)):(p.CoreAssertDebugOnly.fail("Unexpected: ColorTable doesn't have secondary color",void 0,"TypeLockupController.getCurrentColorsWithRole","TypeLockupController.swift",3911),a.push(new C.SolidColorWithRole(S.ColorRole.FieldSecondary,$.SolidColor.BLACK)))),t&&!this.borderColorVisible()||((r=e.colors.color(S.ColorRole.Border))?a.push(new C.SolidColorWithRole(S.ColorRole.Border,r)):(p.CoreAssertDebugOnly.fail("Unexpected: ColorTable doesn't have border color",void 0,"TypeLockupController.getCurrentColorsWithRole","TypeLockupController.swift",3921),a.push(new C.SolidColorWithRole(S.ColorRole.Border,$.SolidColor.BLACK)))),t&&!this.shadowColorVisible()||((i=e.colors.color(S.ColorRole.Shadow))?a.push(new C.SolidColorWithRole(S.ColorRole.Shadow,i)):(p.CoreAssertDebugOnly.fail("Unexpected: ColorTable doesn't have shadow color",void 0,"TypeLockupController.getCurrentColorsWithRole","TypeLockupController.swift",3931),a.push(new C.SolidColorWithRole(S.ColorRole.Shadow,$.SolidColor.BLACK)))),a},applyColors:function(e,t){this.styleController_.applyColors(e,t)},primaryColorVisible:function(){return this.styleController.targetedTextLook!=V.LockupTextLook.KnockoutOnly&&this.styleController.targetedTextLook!=V.LockupTextLook.OutlineOnly&&this.styleController.targetedTextLook!=V.LockupTextLook.ShadowOutlineTransparentText&&this.styleController.targetedTextLook!=V.LockupTextLook.KnockoutAndShadow&&this.styleController.targetedTextLook!=V.LockupTextLook.KnockoutShadowOutline&&this.styleController.targetedTextLook!=V.LockupTextLook.KnockoutAndOutline},secondaryColorVisible:function(){var e,t,o=this.styleController.targetedLockupStyle.backing;return o==V.LockupBacking.UNSET&&(H.LegacyCoreAssert.isTrue(V.LockupStyle.isLetterGrid((e=s.opt(this.lockupStyle,(function(e){return e.layout})))||null!=e?e:V.LockupLayout.Standard),"LockupBacking.UNSET in secondary styles for non-letter-grid layouts?",void 0,"TypeLockupController.secondaryColorVisible","TypeLockupController.swift",3959),o=(t=s.opt(this.lockupStyle,(function(e){return e.backing})))||null!=t?t:V.LockupBacking.None),o!=V.LockupBacking.None},borderColorVisible:function(){var e=this,t=this.styleController.targetedTextLook;return!!(t==V.LockupTextLook.OutlineOnly||t==V.LockupTextLook.KnockoutAndOutline||t==V.LockupTextLook.FillAndOutline||t==V.LockupTextLook.ShadowAndOutline||t==V.LockupTextLook.FillAndOutline2||t==V.LockupTextLook.KnockoutShadowOutline||t==V.LockupTextLook.ShadowOutlineTransparentText||t==V.LockupTextLook.KnockoutAndFill&&s.opt(this.lockupStyle,(function(t){return t.colors.colorID(S.ColorRole.FieldPrimary)==s.opt(e.lockupStyle,(function(e){return e.colors.colorID(S.ColorRole.FieldSecondary)}))})))},shadowColorVisible:function(){var e=this.styleController.targetedTextLook;return e==V.LockupTextLook.Shadow||e==V.LockupTextLook.ShadowAndOutline||e==V.LockupTextLook.KnockoutAndShadow||e==V.LockupTextLook.KnockoutShadowOutline||e==V.LockupTextLook.ShadowOutlineTransparentText},applyOpacity:function(e){this.styleController_.setOpacity(e)},currentOpacity:{get:function(){return this.styleController.getOpacityValue()}},applyTextOpacity:function(e){this.styleController_.setTextOpacity(e)},currentTextOpacity:{get:function(){return this.styleController.getTextOpacityValue()}},applyShapeOpacity:function(e){this.styleController_.setShapeOpacity(e)},currentShapeOpacity:{get:function(){return this.styleController.getShapeOpacityValue()}},getHighlightMethodName:function(e){return e==l.HighlightMethod.Manual?"k_HighlightMethod_None":e==l.HighlightMethod.Numbers?"k_HighlightMethod_Numbers":e==l.HighlightMethod.Nouns?"k_HighlightMethod_Nouns":e==l.HighlightMethod.Verbs?"k_HighlightMethod_Verbs":e==l.HighlightMethod.Names?"k_HighlightMethod_Names":e==l.HighlightMethod.Adjectives?"k_HighlightMethod_Adjectives":e==l.HighlightMethod.SmallWords?"k_HighlightMethod_SmallWords":e==l.HighlightMethod.EvenRows||e==l.HighlightMethod.OddRows||e==l.HighlightMethod.Bracket||e==l.HighlightMethod.InsideBracket?"k_HighlightMethod_Lines":e==l.HighlightMethod.EvenWords||e==l.HighlightMethod.OddWords?this.text.includes(" ")?"k_HighlightMethod_Words":"k_HighlightMethod_Letters":e==l.HighlightMethod.First?"k_HighlightMethod_First":e==l.HighlightMethod.Last?"k_HighlightMethod_Last":s.toString(this.highlightMethod)},placeStyleLockup:function(e,t,o,n){var r;if(r=new w.FormaPlacementSuggester(e,t).fastPlacement()){var i=new x.FormaTransformChangedEvent(e);i.duration=0,e.beginUpdate(i),r.apply(),o.text.length>0&&this.snapSizeToBounds(),o.updateScoring(),n?o.styleController.doesLockupContrastWithBackground()||o.styleController.pickVisibleColorsForLockup():o.generateAndApplyInitialStyleAttributes(),e.endUpdate(i)}},incrementHighlightMethod:function(){this.highlightMethod==l.HighlightMethod.Manual?this.highlightMethod=l.HighlightMethod.Numbers:this.highlightMethod==l.HighlightMethod.Numbers?this.highlightMethod=l.HighlightMethod.Nouns:this.highlightMethod==l.HighlightMethod.Nouns?this.highlightMethod=l.HighlightMethod.Verbs:this.highlightMethod==l.HighlightMethod.Verbs?this.highlightMethod=l.HighlightMethod.Names:this.highlightMethod==l.HighlightMethod.Names?this.highlightMethod=l.HighlightMethod.Adjectives:this.highlightMethod==l.HighlightMethod.Adjectives?this.highlightMethod=l.HighlightMethod.SmallWords:this.highlightMethod==l.HighlightMethod.SmallWords?this.highlightMethod=l.HighlightMethod.EvenRows:this.highlightMethod==l.HighlightMethod.EvenRows||this.highlightMethod==l.HighlightMethod.OddRows?this.highlightMethod=l.HighlightMethod.EvenWords:this.highlightMethod==l.HighlightMethod.EvenWords||this.highlightMethod==l.HighlightMethod.OddWords?this.highlightMethod=l.HighlightMethod.InsideBracket:this.highlightMethod==l.HighlightMethod.First||this.highlightMethod==l.HighlightMethod.Last?this.highlightMethod=l.HighlightMethod.Numbers:this.highlightMethod!=l.HighlightMethod.Bracket&&this.highlightMethod!=l.HighlightMethod.InsideBracket||(this.highlightMethod=l.HighlightMethod.Numbers)},getNextRanges:function(e,t){var o=this,n=[],r=de.TypeLockupUtils.getWordRanges(e,this.highlightMethod);if(0==r.length||e.length<2)return n;var a=s.chars(e),u=G.GraphemeUtils.countGraphemes(e),c=1==r.length&&0==r[0].start&&r[0].end==u;if(t&&e.includes(" ")&&this.highlightMethod==l.HighlightMethod.Manual)return n.push(r[0]),n;if(this.highlightMethod>=i.FIRST_NLP_METHOD&&this.highlightMethod<=i.MAX_NLP_METHOD){var h=e;h==h.toUpperCase()&&(h=h.toLowerCase()),h=s.replaceAll(h,"\n"," ");var d=s.clone(B.Host.textModelUtils.getWordClassRanges(h,this.highlightMethod-i.FIRST_NLP_METHOD));if(c)for(var g=s.iter(d);!g.done;g.next()){var p=g.value;n.push(p)}else this.lockupForma.visit(F.FormaTraversal.PreOrder,(function(e,t,o){var r;if(r=s.as(e,ue.TextForma))for(var i=r.rangeInLockup,a=s.iter(d);!a.done;a.next()){var l=a.value;l.start>=i.start&&l.end<=i.end&&n.push(i)}return!1}));t&&this.highlightMethod==l.HighlightMethod.Numbers&&0==!n.length&&0!=n[0].start&&n.splice(0)}else if(this.highlightMethod==l.HighlightMethod.EvenWords||this.highlightMethod==l.HighlightMethod.OddWords){for(var f=s.iter(s.toSequence(r));!f.done;f.next()){var m=f.value,y=m.offset,v=m.element;(this.highlightMethod==l.HighlightMethod.EvenWords&&y%2==0||this.highlightMethod==l.HighlightMethod.OddWords&&y%2!=0)&&n.push(v)}if((this.highlightMethod==l.HighlightMethod.EvenWords||this.highlightMethod==l.HighlightMethod.OddWords)&&c){n.splice(0);for(var S=s.iter(s.range(0,u,!1));!S.done;S.next()){var C=S.value;(this.highlightMethod==l.HighlightMethod.EvenWords&&C%2==0||this.highlightMethod==l.HighlightMethod.OddWords&&C%2!=0)&&n.push(new ye.TextRange(C,C+1))}}}else if(this.highlightMethod!=l.HighlightMethod.Bracket&&this.highlightMethod!=l.HighlightMethod.InsideBracket||!(r.length<3)||!de.TypeLockupUtils.isCurlyQuote(a[0])&&"("!=a[0]||!de.TypeLockupUtils.isCurlyQuote(a[a.length-1])&&")"!=a[a.length-1]){var T=0;this.lockupForma.visit(F.FormaTraversal.PreOrder,(function(e,t,r){var i;if(i=s.as(e,ue.TextForma)){var a=i.rangeInLockup;(o.highlightMethod==l.HighlightMethod.EvenRows&&i.rowIndex%2==0||o.highlightMethod==l.HighlightMethod.OddRows&&i.rowIndex%2!=0)&&n.push(a),T=Math.max(T,i.rowIndex)}return!1})),this.highlightMethod!=l.HighlightMethod.EvenRows&&this.highlightMethod!=l.HighlightMethod.OddRows||0!=T||n.splice(0),(this.highlightMethod==l.HighlightMethod.First||this.highlightMethod==l.HighlightMethod.Last)&&0!=T||(this.highlightMethod==l.HighlightMethod.Bracket||this.highlightMethod==l.HighlightMethod.InsideBracket)&&T>1?(n.splice(0),this.lockupForma.visit(F.FormaTraversal.PreOrder,(function(e,t,r){var i;if(i=s.as(e,ue.TextForma)){var a=i.rangeInLockup;(o.highlightMethod!=l.HighlightMethod.First&&o.highlightMethod!=l.HighlightMethod.Bracket||0!=i.rowIndex)&&(o.highlightMethod!=l.HighlightMethod.Last&&o.highlightMethod!=l.HighlightMethod.Bracket||i.rowIndex!=T)?o.highlightMethod==l.HighlightMethod.InsideBracket&&0!=i.rowIndex&&i.rowIndex!=T&&n.push(a):n.push(a)}return!1}))):this.highlightMethod==l.HighlightMethod.First||this.highlightMethod==l.HighlightMethod.Last||this.highlightMethod==l.HighlightMethod.Bracket?(this.highlightMethod!=l.HighlightMethod.First&&this.highlightMethod!=l.HighlightMethod.Bracket||n.push(r[0]),this.highlightMethod!=l.HighlightMethod.Last&&this.highlightMethod!=l.HighlightMethod.Bracket||n.push(r[r.length-1])):this.highlightMethod==l.HighlightMethod.InsideBracket&&r.length>1&&n.push(new ye.TextRange(r[0].end,r[r.length-1].start))}else{n.splice(0);var A=c?u:s.chars(e).length;this.highlightMethod==l.HighlightMethod.Bracket?(n.push(new ye.TextRange(0,1)),n.push(new ye.TextRange(A-1,A))):this.highlightMethod==l.HighlightMethod.InsideBracket&&n.push(new ye.TextRange(1,A-1))}return s.sortInPlace(n,(function(e,t){return e.start<t.start})),n=s.clone(de.TypeLockupUtils.cleanupAndMerge(n))},hasTextFormae:function(){var e;return!!(e=this.lockupForma)&&null!=e.findDescendant((function(e){return e instanceof ue.TextForma}))},getTextFormaCount:function(){var e=0;return s.opt(this.lockupForma,(function(t){return t.visit(F.FormaTraversal.PreOrder,(function(t,o,n){return t instanceof ue.TextForma&&(e+=1),!1}))})),e},getAllTextFormae:function(){var e=[];return this.lockupForma.visit(F.FormaTraversal.PreOrder,(function(t,o,n){var r;return(r=s.as(t,ue.TextForma))&&e.push(r),!1})),e},groupLetterFormaeByWord:function(){var e=this,t=s.clone(this.getAllTextFormae());t=s.clone(de.TypeLockupUtils.sortTextFormae(t));var o=de.TypeLockupUtils.getBreakRanges(this.text);return ye.TextRange.makeRangesContiguous(o),o.map((function(o){return t.filter((function(e){return o.contains(e.rangeInLockup)}),e)}),this).filter((function(e){return 0==!e.length}),this)},updateMethodToMatchCharStyleRange:function(e){var t=s.clone(this.charStyleRanges);if(0==!t.length&&this.highlightMethod==l.HighlightMethod.Manual){H.LegacyCoreAssert.isTrue(!s.isEmpty(e),"Asked to update highlight method to match char style range when there is no text",void 0,"TypeLockupController.updateMethodToMatchCharStyleRange","TypeLockupController.swift",4366),this.incrementHighlightMethod();for(var o=s.clone(this.getNextRanges(e,!1)),n=0;!i.rangesEqual(o,t);)if(this.incrementHighlightMethod(),o=s.clone(this.getNextRanges(e,!1)),(n+=1)>i.NUM_HIGHLIGHTMETHODS){this.highlightMethod=l.HighlightMethod.Manual;break}}},autoApplyCharStyle:function(e,t,o){var n;if(void 0===o&&(o=!1),!o){if(0==this.charStyleRanges.length&&e&&!t)return;if(0==!this.charStyleRanges.length&&!e&&!t)return}var r=s.clone(this.charStyleRanges);t&&this.incrementHighlightMethod();var a=(n=s.opt(this.lockupStyle,(function(e){return e.layout})))||null!=n?n:V.LockupLayout.Standard;0==r.length&&this.highlightMethod==l.HighlightMethod.Manual&&V.LockupStyle.doesPerLetterLayout(a)&&(this.highlightMethod=l.HighlightMethod.OddWords);var u=s.clone(this.getNextRanges(this.text,0==r.length));if(0!=!u.length||t||!i.rangesEqual(u,r)){var c=new x.FormaAnimationTransactionEvent(this.forma);if(c.duration=0,this.forma.beginUpdate(c),this.lockupForma.style.notifyBefore(),this.charStyleRanges=[],!o)for(var h=0;0==u.length||t&&i.rangesEqual(u,r)||0==u[0].start&&u[0].end==this.text.length;)if(this.incrementHighlightMethod(),u=s.clone(this.getNextRanges(this.text,!1)),(h+=1)>i.NUM_HIGHLIGHTMETHODS){u.splice(0),this.highlightMethod=l.HighlightMethod.Manual;break}this.charStyleRanges=s.clone(u),this.lockupForma.style.notifyAfter(),this.forma.endUpdate(c)}},applyCharStyle:function(e,t,o,n,r){var i;void 0===r&&(r=!0);var a=new ye.TextRange(0,0);if(e.lockupForma!=this.lockupForma)return this.selectCharStyleForma(),a;a=e.rangeInLockup;var l=(i=s.opt(this.lockupStyle,(function(e){return e.layout})))||null!=i?i:V.LockupLayout.Standard;if(V.LockupStyle.doesPerLetterLayout(l)){var u,c=de.TypeLockupUtils.getWordRanges(this.text,this.highlightMethod);c.length>1&&(u=c.find((function(e){return e.contains(a)}),this))&&(a=u)}var h=new x.FormaAnimationTransactionEvent(this.forma);h.duration=0,this.forma.beginUpdate(h),this.lockupForma.style.notifyBefore();var d=this.applyCharStyleDirectly(a,n,o);return 1==r&&this.selectCharStyleForma(),this.lockupForma.style.notifyAfter(),this.forma.endUpdate(h),d},applyCharStyleFromRangeListWithoutUI:function(e,t){var o=new x.FormaAnimationTransactionEvent(this.forma);o.duration=0,this.forma.beginUpdate(o),this.lockupForma.style.notifyBefore();for(var n=[],r=s.iter(e);!r.done;r.next()){var i=r.value;n.push(this.applyCharStyleDirectly(i,i,t))}return this.lockupForma.style.notifyAfter(),this.forma.endUpdate(o),n},applyCharStyleDirectly:function(e,t,o,n){void 0===n&&(n=!0);var r=e;this.highlightMethod=l.HighlightMethod.Manual;var a=!1,u=r;o==l.CharStyleApplyMode.Apply&&0!=t.length&&(r=de.TypeLockupUtils.getNewCharSelectionRange(t,r,this.initialCharStyleRanges_));for(var c=-1,h=s.iter(s.toSequence(this.charStyleRanges));!h.done;h.next()){var d=h.value,g=d.offset,p=d.element;r.start>=p.start&&r.start<p.end&&(c=g)}var f=s.clone(this.charStyleRanges);if(c>-1){var m=f[c];o==l.CharStyleApplyMode.SwipeApply?f[c]=new ye.TextRange(Math.min(r.start,m.start),Math.max(r.end,m.end)):o!=l.CharStyleApplyMode.Apply?m.length!=r.length?(r.end>=m.end?f.splice(c,1):f[c]=new ye.TextRange(r.end,m.end),m.start<r.start&&f.splice(c,0,new ye.TextRange(m.start,r.start))):f.splice(c,1):o!=l.CharStyleApplyMode.Remove&&(a=!0,f[c]=r),this.charStyleRanges=s.clone(f)}else o!=l.CharStyleApplyMode.Remove&&(a=!0,f.push(r),s.sortInPlace(f,(function(e,t){return e.start<t.start})),this.charStyleRanges=s.clone(f),0==s.count(this.lockupStyle.characterStyles)&&this.getCharacterStyle(i.HIGHLIGHT_STYLE));n&&(this.charStyleRanges=s.clone(de.TypeLockupUtils.cleanupAndMerge(this.charStyleRanges)));var y=new ye.TextRange(0,0);if(a)for(var v=s.iter(this.charStyleRanges);!v.done;v.next())p=v.value,u.start>=p.start&&u.end<=p.end&&(y=p);return y},getCharacterStyle:function(e){var t=this.lockupStyle.characterStyles[e];return null==t&&(t=V.LockupStyle.createDefaultCharacterStyle(this.lockupStyle),this.lockupStyle.setCharacterStyle(e,t),this.styleController.pickVisibleColorsForCharStyle()),t},getCharacterStyleRanges:function(){return this.charStyleRanges},clearCharStyle:function(){this.highlightMethod=l.HighlightMethod.Manual,0!=this.charStyleRanges.length&&(this.lockupForma.style.notifyBefore(),this.charStyleRanges=[],this.lockupForma.style.notifyAfter())},selectCharStyleForma:function(){var e=this;this.owner.selection.clearSelectionNoUpdate(),this.owner.selection.selectForma(this.lockupForma,!1),this.lockupForma.visit(F.FormaTraversal.PreOrder,(function(t,o,n){var r;if(r=s.as(t,ue.TextForma))for(var i=r.rangeInLockup,a=s.iter(e.charStyleRanges);!a.done;a.next()){var l=a.value;if(i.start>=l.start&&i.start<l.end){var u=r.textLook;if(V.LockupStyle.isShadowLook(u)||u==V.LockupTextLook.KnockoutAndOutline){var c=r.fontColor;if(c.isEqual(e.styleController.targetedLockupStyle.colors.fieldSecondary)||c.isEqual(r.fontStrokeColor))continue}e.owner.selection.selectForma(r,!1)}}return!1})),this.owner.selection.publish(new ne.SelectionStateChangedMessage(this.owner.selection))},beginTouches:function(){this.initialCharStyleRanges_=s.clone(this.charStyleRanges)},clearInitialCharStyleRanges:function(){this.initialCharStyleRanges_=[]},updateTouches:function(e,t,o,n){void 0===n&&(n=null);var r=s.opt(this.lockupForma,(function(t){return t.page.formaAtPoint(e,void 0,[ue.TextForma.KIND])}));null!=r&&r instanceof ue.TextForma&&r.lockupForma!=this.lockupForma&&(r=null);var a,u=o?100:-100;if(null==r||!(r instanceof ue.TextForma)){var c=new me.TheoPoint(e.x+u,e.y);r=s.opt(this.lockupForma,(function(e){return e.page.formaAtPoint(c,void 0,[ue.TextForma.KIND])}))}if(a=s.as(r,ue.TextForma)){if(null!=n&&0!=s.count(this.lockupStyle.characterStyles)&&s.opt(this.lockupStyle.characterStyles[i.HIGHLIGHT_STYLE],(function(e){return null!=e.font}))){var h,d=s.opt(this.lockupForma,(function(e){return e.page.formaAtPoint(n,void 0,[ue.TextForma.KIND])}));if(null==d||!(d instanceof ue.TextForma)){var g=new me.TheoPoint(n.x+u,n.y);d=s.opt(this.lockupForma,(function(e){return e.page.formaAtPoint(g,void 0,[ue.TextForma.KIND])}))}if((h=s.as(d,ue.TextForma))&&h.rowIndex==a.rowIndex)for(var p=s.opt(s.opt(this.lockupForma,(function(e){return e.totalPlacement.inverse})),(function(t){return t.transformPoint(e)}))||e,f=s.opt(s.opt(this.lockupForma,(function(e){return e.totalPlacement.inverse})),(function(e){return e.transformPoint(n)}))||n,m=p.x>=f.x,y=p.x<=f.x,v=s.iter(this.charStyleRanges);!v.done;v.next()){var S=v.value;if(o){if(y&&a.rangeInLockup.start>=S.start&&a.rangeInLockup.start<S.end){if(a.rangeInLockup.end<S.end)return;break}if(m&&a.rangeInLockup.end==S.start)return}else{if(m&&a.rangeInLockup.start>=S.start&&a.rangeInLockup.start<S.end){if(a.rangeInLockup.end<S.end)return;break}if(y&&a.rangeInLockup.start==S.end)return}}}this.applyCharStyle(a,i.HIGHLIGHT_STYLE,l.CharStyleApplyMode.Apply,t.rangeInLockup)}},enterCharStyleModeWithTextForma:function(e,t){if(this.owner.allowSelectionChanges){var o=0==this.charStyleRanges.length;if(0==e.rangeInLockup.length){this.lockupForma.style.notifyBefore(),this.getCharacterStyle(i.HIGHLIGHT_STYLE),this.lockupForma.style.notifyAfter();var n=s.opt(this.lockupForma,(function(e){return e.page.formaAtPoint(t,void 0,[ue.TextForma.KIND])}));null!=n&&n instanceof ue.TextForma&&(s.opt(s.opt(e.page.document,(function(e){return e.controller})),(function(e){return e.selection.inCharStyleMode=!0})),this.styleController.pickVisibleColorsForCharStyle(),this.selectCharStyleForma(),this.applyCharStyle(n,i.HIGHLIGHT_STYLE,l.CharStyleApplyMode.SwipeApply,new ye.TextRange(0,0)))}else s.opt(s.opt(e.page.document,(function(e){return e.controller})),(function(e){return e.selection.inCharStyleMode=!0})),0==this.charStyleRanges.length&&this.styleController.pickVisibleColorsForCharStyle(),this.selectCharStyleForma(),this.applyCharStyle(e,i.HIGHLIGHT_STYLE,l.CharStyleApplyMode.SwipeApply,new ye.TextRange(0,0));o&&1==this.charStyleRanges.length&&0==this.charStyleRanges[0].start&&this.charStyleRanges[0].end==this.text.length&&(this.charStyleRanges=[],this.autoApplyCharStyle(!1,!1,!1),this.selectCharStyleForma())}},applyPredefinedCharStyle:function(e){var t=this.highlightMethod==e;if(this.highlightMethod=e,e==l.HighlightMethod.SmallWords){this.styleController.applyBacking(V.LockupBacking.None,null),t||this.lockupStyle.setCharacterStyles({});var o=this.getCharacterStyle(i.HIGHLIGHT_STYLE);o.spacing=.5,o.colors.setColorId(S.ColorRole.FieldPrimary,this.lockupStyle.colors.colorID(S.ColorRole.FieldPrimary)),o.colors.setColorId(S.ColorRole.FieldSecondary,this.lockupStyle.colors.colorID(S.ColorRole.FieldSecondary)),t?o.layout==V.LockupLayout.Standard&&o.alignment==V.LockupAlignment.Center&&0==o.lineBreakAtCharacterStyleSizeChange?(o.alignment=V.LockupAlignment.Right,o.lineBreakAtCharacterStyleSizeChange=!1):o.layout==V.LockupLayout.Standard&&o.alignment==V.LockupAlignment.Right?(o.alignment=V.LockupAlignment.Center,o.lineBreakAtCharacterStyleSizeChange=!0):o.layout==V.LockupLayout.UNSET&&0==o.lineBreakAtCharacterStyleSizeChange?(o.alignment=V.LockupAlignment.Center,o.layout=V.LockupLayout.Standard,o.lineBreakAtCharacterStyleSizeChange=!1):(o.alignment=V.LockupAlignment.UNSET,o.layout=V.LockupLayout.UNSET,o.lineBreakAtCharacterStyleSizeChange=!1):o.lineBreakAtCharacterStyleSizeChange=!1,this.autoApplyCharStyle(!0,!1,!0)}else this.highlightMethod==l.HighlightMethod.Manual?this.clearCharStyle():e==l.HighlightMethod.Nouns?(this.styleController.applyBacking(V.LockupBacking.Rows,null),this.lockupStyle.setCharacterStyles({}),this.getCharacterStyle(i.HIGHLIGHT_STYLE),this.autoApplyCharStyle(!0,!1,!0)):(t&&(this.highlightMethod==l.HighlightMethod.EvenRows?this.highlightMethod=l.HighlightMethod.OddRows:this.highlightMethod==l.HighlightMethod.OddRows?this.highlightMethod=l.HighlightMethod.Bracket:this.highlightMethod==l.HighlightMethod.Bracket?this.highlightMethod=l.HighlightMethod.InsideBracket:this.highlightMethod==l.HighlightMethod.InsideBracket&&(this.highlightMethod=l.HighlightMethod.EvenRows)),this.lockupStyle.setCharacterStyles({}),this.getCharacterStyle(i.HIGHLIGHT_STYLE));this.forma.controller.styleChanged()},snapToClosestExistingSize:function(e){var t=this;if(!s.opt(this.lockupStyle,(function(e){return e.layout==V.LockupLayout.FitJustified&&1!=t.numLines()}))){var o=s.clone(de.TypeLockupUtils.sizesInDocument(this.forma.page.document)),n=this.getCurrentFontSize();if(0!=n){for(var r=e,i=s.iter(o);!i.done;i.next()){var a=i.value;(n!=a||e==n)&&Math.abs(n-a)<Math.abs(n-r)&&(r=a)}var l=r/n;if(!(0==r||l>1.2||l<(e==r?.2:.8))){var u=new Se.TheoSize(this.forma.bounds.width*l,this.forma.bounds.height*l),c=new R.FormaResizeEvent(this.forma,u,me.TheoPoint.ZERO);this.onEvent(c)}}}},getCurrentFontSize:function(){var e,t,o=0,n=!1;if(t=this.lockupForma){if(s.opt(this.lockupStyle,(function(e){return e.layout==V.LockupLayout.Auto}))){var r=0,i=0;t.visit(F.FormaTraversal.PreOrder,(function(e,t,o){var a;return!!(a=s.as(e,ue.TextForma))&&(r+=a.fontSize,i+=1,n=!0,!1)})),i>0&&(o=r/s.toDouble(i))}else t.visit(F.FormaTraversal.PreOrder,(function(e,t,r){var i;return!!(i=s.as(e,ue.TextForma))&&(o=i.fontSize,n=!0,!0)}));o*=this.lockupForma.placement.extractedScale.scale.x}if(0==o&&this.text.length>0){var a=null==this.lockupForma?" - no lockup":"",l=n?a:" - no text forma",u=(e=s.opt(this.lockupStyle,(function(e){return e.layoutType})))||null!=e?e:"nilStyle";return s.opt(B.Host.logging,(function(e){return e.warning("tried to return a font size of 0.0 "+l+" layoutType: "+u)})),1}return o},getAverageFontSize:function(){var e,t=this;if(e=this.lockupForma){var o=[];if(e.visit(F.FormaTraversal.PreOrder,(function(e,n,r){var i;if(i=s.as(e,ue.TextForma)){var a=i.fontSize;if(o.push(a*t.lockupForma.placement.extractedScale.scale.x),s.opt(t.lockupStyle,(function(e){return e.layout!=V.LockupLayout.FitJustified})))return!0}return!1})),o.length>0)return o.reduce((function(e,t){return e+t}),0)/s.toDouble(o.length)}return 0},getFontSizeSnapValues:function(){var e=[];if(this.styleController.targetedLockupStyle!==this.lockupStyle)return e.push(100),e;var t=s.clone(de.TypeLockupUtils.sizesInDocument(this.forma.page.document,this.forma));s.sortInPlace(t);var o=this.getCurrentFontSize(),n=0;if(0!=o)for(var r=s.iter(t);!r.done;r.next()){var i=r.value;Math.round(i)==n&&i!=o||(n=Math.round(i),e.push(i))}return e},scale:function(e,t){void 0===t&&(t=new me.TheoPoint(.5,.5)),this.addLineBreakConstraints(!0);var o=this.forma.placement.transformValues,n=this.forma.bounds,r=new Se.TheoSize(n.width*o.xscale,n.height*o.xscale),i=new Se.TheoSize(r.width*e,r.height*e),a=this.forma.boundsInCoordSpace(this.forma.placement);Math.round(1e3*i.width)==Math.round(1e3*a.width)&&Math.round(1e3*i.height)==Math.round(1e3*a.height)||(this.onEvent(new R.BeginFormaResizeEvent(this.forma,me.TheoPoint.ZERO)),this.onEvent(new R.FormaResizeEvent(this.forma,i,t)),this.onEvent(new R.EndFormaResizeEvent(this.forma))),this.removeLineBreakConstraints()},setFontSize:function(e,t){void 0===t&&(t=new me.TheoPoint(.5,.5));var o=e/this.getCurrentFontSize();this.scale(o,t)},matchNextSize:function(e,t){for(var o=this.getCurrentFontSize(),n=o,r=!1,i=s.iter(e);!i.done;i.next()){var a=i.value,l=a/o;if(Math.round(n)<Math.round(a)&&(l<.99||l>1.01)){n=a,r=!0;break}}e.length>0&&(0==r||n>this.getSizeSliderMaxValue())&&(n=e[0]);var u=n/o;return(u<.99||u>1.01)&&this.scale(u,t),n},setSizeSliderValue:function(e,t,o){var n=e;if(this.styleController.targetedLockupStyle!==this.lockupStyle){n=e/100;for(var r=s.iter(t);!r.done;r.next())e>=(a=r.value)-5&&e<=a+5&&(n=a/100);this.styleController.targetedLockupStyle.spacing=1==n?-1:n,this.styleChanged(),this.selectCharStyleForma(),n*=100}else{for(var i=s.iter(t);!i.done;i.next()){var a;e>=(a=i.value)-5&&e<=a+5&&(n=a)}var l=n/this.getCurrentFontSize();this.scale(l,o)}return n},getSizeSliderValue:function(){return this.styleController.targetedLockupStyle!==this.lockupStyle?-1==this.styleController.targetedLockupStyle.spacing?100:100*this.styleController.targetedLockupStyle.spacing:this.getCurrentFontSize()},getSizeSliderMinValue:function(){if(this.styleController.targetedLockupStyle!==this.lockupStyle)return 20;var e=20,t=this.getCurrentFontSize();return t<20&&(e=t),e},getSizeSliderMaxValue:function(){if(this.styleController.targetedLockupStyle!==this.lockupStyle)return 400;var e=500,t=this.getCurrentFontSize();t>500&&(e=t+200);var o=e/t,n=1.2*this.forma.root.bounds.width/this.forma.bounds.width;return o>n?n*t:e}}}),i)},"8zEY":function(e,t,o){var n,r=t,i=o("oAGj");r.RefineCutoutState=(n=function(e,t,o){this.unmaskedGhost=null,this.darkScrim=null,this.frame=e,this.image=t,this.indexInParent=o,this.floating=i.opt(e.controller,(function(e){return 1==e.floating})),this.imageStyle=t.style.clone(),this.frameBackgroundColor=e.style.colors.fieldPrimary,this.frameBlendMode=e.style.blendMode},i.defineClass({name:"RefineCutoutState",ctor:n}),n)},"9BFu":function(e,t,o){var n,r,i=t,a=o("oAGj"),l=o("gXiO"),s=o("fNpk"),u=o("jC54");i.ScoreComponent=(n=function(e,t,o,n){this.std=1,this.mean=0,this.feature=e,this.weight=t,this.functionParam=o,this.featureName=n},a.defineClass({name:"ScoreComponent",ctor:n,props:{normalFeature:{get:function(){return(this.feature-this.mean)/this.std}}}}),n),i.applyFieldWidth=function(e,t){var o=e.length;return o>=t?e:a.toString(" ",t-o)+e},i.WeightedScore=(r=function(e){this.initScore=-1*a.toDouble(a.MAXFLOAT),this.components_=[],this.score_=0,this.recalculateScore_=!0,this.versionNumber=1;for(var t=a.iter(a.range(0,e,!1));!t.done;t.next())this.components_.push(new i.ScoreComponent(0,1,1e-5,"Feature"));l.CoreObject.call(this)},a.defineClass({name:"WeightedScore",ctor:r,superName:"CoreObject",props:{setFeature:function(e,t){this.recalculateScore_=!0,this.components_[e].feature=t},setStd:function(e,t){t>0&&(this.recalculateScore_=!0,this.components_[e].std=t)},setMean:function(e,t){this.recalculateScore_=!0,this.components_[e].mean=t},getFeatureValue:function(e){return this.components_[e].feature},setWeight:function(e,t){this.recalculateScore_=!0,this.components_[e].weight=t},getWeights:function(){for(var e=[],t=a.iter(this.components_);!t.done;t.next()){var o=t.value;e.push(o.weight)}return e},getNames:function(){for(var e=[],t=a.iter(this.components_);!t.done;t.next()){var o=t.value;e.push(o.featureName)}return e},getFeatures:function(){for(var e=[],t=a.iter(this.components_);!t.done;t.next()){var o=t.value;e.push(o.feature)}return e},setWeights:function(e){this.recalculateScore_=!0;for(var t=a.iter(a.range(0,e.length,!1));!t.done;t.next()){var o=t.value;this.components_[o].weight=e[o]}},setFunctionParam:function(e,t){this.recalculateScore_=!0,this.components_[e].functionParam=t},setFeatureName:function(e,t){this.components_[e].featureName=t},clearFeatures:function(){this.components_.forEach((function(e){e.feature=0}))},score:{get:function(){return this.recalculateScore_&&this.calculateScore(),isNaN(this.score_)&&s.LegacyCoreAssert.fail("nan score",void 0,"WeightedScore","WeightedScore.swift",132),this.score_}},calculateScore:function(){var e=0;this.components_.forEach((function(t){return e+=Math.atan(t.normalFeature*t.functionParam)/Math.atan(t.functionParam)*t.weight})),this.recalculateScore_=!1,this.score_=e},asString:{get:function(){return this.getOutputString(!1,!1)}},nonZeroValues:{get:function(){return this.getOutputString(!0,!0)}},asSortedString:{get:function(){return this.getOutputString(!0,!1)}},getOutputString:function(e,t){void 0===e&&(e=!1),void 0===t&&(t=!1);var o="",n=this.score,r=0;if(this.components_.length>0){o+="Features:\n";var l=[];this.components_.forEach((function(e){if(!t||0!=e.normalFeature){var o=Math.atan(e.normalFeature*e.functionParam)/Math.atan(e.functionParam);r+=e.weight*o;var n=Math.round(1e3*e.feature)/1e3,a=Math.round(1e3*e.normalFeature)/1e3,s=Math.round(1e3*e.mean)/1e3,u=Math.round(1e3*e.std)/1e3,c=Math.round(1e3*e.weight)/1e3,h=Math.round(100*c*a)/100,d=" "+i.applyFieldWidth(e.featureName,10)+":\t ("+n+" - "+s+") / "+u+" * "+c+": "+h+" \n";l.push({value:c*a,out:d})}})),e&&a.sortInPlace(l,(function(e,t){return e.value<t.value}));for(var s=a.iter(l);!s.done;s.next())o+=s.value.out}return Math.abs(r-n)>.001&&(o+="ERROR. scores don't match: "+r+", "+n+" \n"),o+="Total: "+Math.round(1e3*n)/1e3+" \n"},reject:function(){return!1},getVersion:function(){return"v"+this.versionNumber},writeFeatureDict:function(e,t){var o=this,n=0;a.each(t,(function(t,r){var i=u.ModelWeightLibrary.getData(e,t);o.setFeatureName(n,t),o.setMean(n,i.mean),o.setStd(n,i.std),o.setWeight(n,i.weight),o.setFeature(n,r),n+=1}))}}}),r)},"9Lk3":function(e,t,o){var n,r,i=t,a=o("oAGj"),l=o("yhkb"),s=o("C42b"),u=o("HWAX"),c=o("ascj"),h=o("quOg"),d=o("Z25M"),g=o("FNB+"),p=o("6ZWm"),f=o("waL6"),m=o("cmoc"),y=o("P83h"),v=o("ZK0l"),S=o("tQF8"),C=o("/afT"),T=o("pnSN"),A=o("v/sv"),F=o("4mVB"),k=o("iCxV"),L=o("8vXU"),b=o("fdtz"),_=o("lmwz"),R=o("fNpk"),I=o("c+uM"),w=o("tGKA"),D=o("3DEm"),x=o("jcfx"),P=o("JFv5"),E=o("JO5d"),M=o("djAF"),N=o("35Q0"),G=o("T6jX"),B=o("8t9B"),O=o("oKlP"),U=o("sIWg"),H=o("1NAc");i.ResizeCellInfo=(n=function(){},a.defineClass({name:"ResizeCellInfo",ctor:n,props:{init_d41d:function(){this.handle=null,this.newRect=U.TheoRect.Zero},init_implicit:function(e,t){this.handle=e,this.newRect=t},clone:function(){return n.init_implicit(this.handle,this.newRect)}}}),n),i.PROPERTY_FORMA_MAPPING="forma-mapping",i.GridController=(r=function(e,t,o){this.imageInitState_={},this.moveableInitState_={},this.checkFramesForCropping_=[],this.gridBounds_=new U.TheoRect(0,0,1,1),v.GroupController.call(this,e,t,o)},a.defineClass({name:"GridController",ctor:r,superName:"GroupController",statics:{KIND:{get:function(){return"grid"}},MAX_IMAGE_COUNT:{get:function(){return 32}},MAX_CELL_COUNT:{get:function(){return 32}},MIN_CELL_DIM:{get:function(){return 75}},ADOBE_STOCK_SUGGESTED_IMAGE_SIZE:{get:function(){return 2400}},isBackgroundColoredCell:function(e){return e.isGridCell()&&e instanceof M.ShapeForma&&null!=e.controller&&!e.controller.floating},hasLayoutPadding:function(e){var t,o=!1;return(t=a.as(a.opt(e.parent,(function(e){return e.controller})),r))&&(o=t.margin>0||t.spacing>0),o}},props:{gridForma:{get:function(){return this.forma}},gridStyle:{get:function(){return a.as(a.opt(this.forma,(function(e){return e.style})),F.GridStyle)},set:function(e){var t=this;a.opt(e,(function(e){return e.forma=t.forma})),a.opt(this.forma,(function(t){return t.protectedSetStyle(e)}))}},gridCells:{get:function(){return this.gridStyle.gridCells}},backgroundGridCells:{get:function(){return this.gridStyle.nonOverlappingCells()}},foregroundGridCells:{get:function(){return this.gridStyle.overlappingCells()}},formaMapping:{get:function(){return this.gridStyle.formaMapping}},formaMappingSwiftDict:{get:function(){return this.formaMapping}},formaMappingDeepCopy:{get:function(){for(var e={},t=a.iter(a.keys(this.formaMapping));!t.done;t.next()){var o=t.value,n=this.formaMapping[o];e[o]=n.clone()}return e}},selectable:{get:function(){return!0}},moveable:{get:function(){return!1}},rotateable:{get:function(){return!1}},flippable:{get:function(){return!1}},nudgeable:{get:function(){return!1}},canDeleteCellForForma:function(e){if(e.controller.moveable)return!0;if(e.controller.floating)return!0;var t;if(this.gridStyle.numBackgroundCells>1&&(t=this.formaMapping[e.formaID])){if(null!=this.getMergeCell(t))return!0;if(null!=this.getResizeCellToZeroInfo(t))return!0}return!1},getMergeCell:function(e){for(var t=null,o=a.iter(this.gridCells);!o.done;o.next()){var n=o.value;!a.eq(S._equality_GridCell_GridCell,n,e)&&n.mergeableWith(e)&&(null!=t&&0!=this.backgroundImagesForCell(t).length||(t=n))}return t},getResizeCellToZeroInfo:function(e){var t=null;if(this.gridStyle.numBackgroundCells>1){var o=this.getCellRegion(e),n=this.gridForma.frame,r=e.bounds;if(o.minX>n.minX+this.margin+1&&this.canRemoveFromHandleDirection(e,S.GridCellHandle.Left)?(t=S.GridCellHandle.Left,r=new U.TheoRect(r.maxX,r.minY,r.maxX,r.maxY)):o.maxX<n.maxX-this.margin-1&&this.canRemoveFromHandleDirection(e,S.GridCellHandle.Right)?(t=S.GridCellHandle.Right,r=new U.TheoRect(r.minX,r.minY,r.minX,r.maxY)):o.minY>n.minY+this.margin+1&&this.canRemoveFromHandleDirection(e,S.GridCellHandle.Top)?(t=S.GridCellHandle.Top,r=new U.TheoRect(r.minX,r.maxY,r.maxX,r.maxY)):o.maxY<n.maxY-this.margin-1&&this.canRemoveFromHandleDirection(e,S.GridCellHandle.Bottom)&&(t=S.GridCellHandle.Bottom,r=new U.TheoRect(r.minX,r.minY,r.maxX,r.minY)),null!=t){var l=a.clone(i.ResizeCellInfo.init_d41d());return l.handle=t,l.newRect=r,l}}return null},maxMargin:{get:function(){for(var e,t=this.forma.bounds,o=this.forma.finalFrame,n=null,r=a.iter(this.backgroundGridCells);!r.done;r.next()){var i=r.value,l=t.evalRect(i.bounds).transform(this.forma.totalPlacement);n=null==n?l:a.opt(n,(function(e){return e.unionWith(l)}))}return(e=n)?Math.max(D.MathUtils.absDouble(o.minX-e.minX),D.MathUtils.absDouble(o.maxX-e.maxX),D.MathUtils.absDouble(o.minY-e.minY),D.MathUtils.absDouble(o.maxY-e.maxY)):0}},margin:{get:function(){for(var e=this.forma.bounds,t=this.forma.finalFrame,o=Math.max(t.width,t.height),n=a.iter(this.backgroundGridCells);!n.done;n.next()){var r=n.value,i=e.evalRect(r.bounds).transform(this.forma.totalPlacement),l=Math.min(D.MathUtils.absDouble(t.minX-i.minX),D.MathUtils.absDouble(t.maxX-i.maxX),D.MathUtils.absDouble(t.minY-i.minY),D.MathUtils.absDouble(t.maxY-i.maxY));o=Math.min(o,l)}return o},set:function(e){this.setMargin(e)}},setMargin:function(e,t){void 0===t&&(t=!0);var o=this.margin;if(e!=o){var n=this.forma.bounds.transform(this.forma.totalPlacement),i=this.gridStyle.clone();0==o&&!this.isBackgroundVisible()&&t&&this.setContrastingGridBackgroundColor();for(var l=!0,s=(n.width-2*e)/n.width,u=(n.height-2*e)/n.height,c=e/n.width,h=e/n.height,d=(n.width-2*o)/n.width,g=(n.height-2*o)/n.height,p=o/n.width,f=o/n.height,m=a.iter(this.backgroundGridCells);!m.done;m.next()){var y=(S=m.value).bounds.offsetXY(-p,-f).multiplyXY(1/d,1/g);a.opt(this.gridStyle,(function(e){return e.updateCell(S,y.multiplyXY(s,u).offsetXY(c,h))}))}for(var v=a.iter(this.backgroundGridCells);!v.done;v.next()){var S=v.value,C=this.getCellRegion(S);Math.min(C.width,C.height)<r.MIN_CELL_DIM&&(l=!1)}l?(this.resetMoveableFormaToInitialSizes(),this.layoutGrid(this.gridStyle.moveableShift,null,this.preUpdateMapping_,this.preUpdateSpacing_)):this.gridStyle=a.as(i,F.GridStyle)}},getLogos:function(){return this.moveableFormae().filter((function(e){return e.isLogo()}),this)},getBackgroundShapes:function(){return this.forma.filterWithCallback((function(e){return r.isBackgroundColoredCell(e)}),g.FormaTraversal.JustChildren)},setMarginAndSpacing:function(e,t){t>=0&&(this.margin=t),e>=0&&(this.spacing=e)},linkedFormaForChild:function(e,t){var o=a.clone(this.forma.visitAsArray(g.FormaTraversal.JustChildren));if(a.remove(o,e),this.owner.interactionMode==h.InteractionMode.AutomaticGrid){if(e.isShape()||e.isBackgroundImage())return o}else if(e.isShape()||e.isImage())return e.controller.moveable?this.moveableFormae():this.forma.filterWithCallback((function(t){return(t.isBackgroundImage()||t.isShape())&&null!=t.controller&&!a.eq(g._equality_Forma_Forma,t,e)}));return[]},isBackgroundVisible:function(){if(this.gridStyle.spacing>0)return!0;for(var e=1,t=0,o=1,n=0,r=a.clone(this.backgroundGridCells),i=a.iter(r);!i.done;i.next()){var l=i.value;e=Math.min(e,l.bounds.minX),t=Math.max(t,l.bounds.maxX),o=Math.min(o,l.bounds.minY),n=Math.max(n,l.bounds.maxY)}return e>.001||o>.001||t<.999||n<.999},styleChanged:function(){var e=this;a.opt(this.gridStyle,(function(t){return t.forma=e.forma}))},getBoundaryCells:function(e){return this.filterBoundaryCells(this.backgroundGridCells,e)},filterBoundaryCells:function(e,t){for(var o=[],n=a.iter(e);!n.done;n.next()){for(var r=n.value,i=!0,l=a.iter(e);!l.done;l.next()){var s=l.value;a.eq(S._equality_GridCell_GridCell,r,s)||(t==S.GridCellHandle.Left&&s.bounds.maxX-.01<=r.bounds.minX&&(i=!1),t==S.GridCellHandle.Right&&s.bounds.minX+.01>=r.bounds.maxX&&(i=!1),t==S.GridCellHandle.Top&&s.bounds.maxY-.01<=r.bounds.minY&&(i=!1),t==S.GridCellHandle.Bottom&&s.bounds.minY+.01>=r.bounds.maxY&&(i=!1))}i&&o.push(r)}return o},filterCellsByDirection:function(e,t,o){R.LegacyCoreAssert.isTrue(["vertical","horizontal"].includes(o),"unknown direction",{direction:o},"GridController.filterCellsByDirection","GridController.swift",445);for(var n=[],r=a.iter(t);!r.done;r.next()){var i=r.value;"horizontal"==o?a.toDouble(Math.round(1e3*Math.max(e.bounds.minY,i.bounds.minY))/1e3)<a.toDouble(Math.round(1e3*Math.min(e.bounds.maxY,i.bounds.maxY))/1e3)&&n.push(i):"vertical"==o&&a.toDouble(Math.round(1e3*Math.max(e.bounds.minX,i.bounds.minX))/1e3)<a.toDouble(Math.round(1e3*Math.min(e.bounds.maxX,i.bounds.maxX))/1e3)&&n.push(i)}return n},spacing:{get:function(){return this.gridStyle.spacing},set:function(e){var t=this.gridStyle.spacing;if(t!=e){0!=t||this.isBackgroundVisible()||this.setContrastingGridBackgroundColor(),this.gridStyle.spacing=e;for(var o=a.iter(this.gridCells);!o.done;o.next()){var n=o.value,i=this.getCellRegion(n);if(Math.min(i.width,i.height)<r.MIN_CELL_DIM)return void(this.gridStyle.spacing=t)}this.resetMoveableFormaToInitialSizes(),this.layoutGrid(this.gridStyle.moveableShift,null,this.preUpdateMapping_,this.preUpdateSpacing_)}}},setContrastingGridBackgroundColor:function(){for(var e=this.forma.page.colorLibraryController,t=e.getThemeColorKeys().concat(l.ColorLibraryController.THEME_DERIVED_BW_KEYS),o=[],n=a.iter(this.gridCells);!n.done;n.next()){var r,i=n.value;null!=this.backgroundShapeFormaForCell(i)&&null!=i.colorID&&(t.includes(i.colorID)&&a.remove(t,i.colorID),(r=e.getSolidColorForKey(i.colorID))&&o.push(r),R.LegacyCoreAssert.isTrue(null!=e.getSolidColorForKey(i.colorID),"why is the grid color nil??",void 0,"GridController.setContrastingGridBackgroundColor","GridController.swift",526))}0==(t=t.filter((function(t){var n=e.getSolidColorForKey(t);if(null==n)return!1;for(var r=n,i=a.iter(o);!i.done;i.next()){var l=i.value;if(!r.contrasts(l,!1))return!1}return!0}),this)).length&&(t=this.forma.page.colorLibraryController.getThemeColorKeys().concat(l.ColorLibraryController.THEME_DERIVED_BW_KEYS));var u=this.forma.root.style.colors.colorID(c.ColorRole.FieldPrimary);if(null==u||!t.includes(u)){var h=t[s.CoreRandom.nextIntUniform(t.length)];this.forma.root.style.colors.setColorId(c.ColorRole.FieldPrimary,h)}},showHandle:function(e){for(var t=0,o=a.iter(this.gridCells);!o.done;o.next())t+=o.value.bounds.area;return t<.99||v.GroupController.prototype.showHandle.call(this,e)},selectionHandlePositions:{get:function(){for(var e=[],t=a.iter(this.gridCells);!t.done;t.next())for(var o=t.value,n=a.iter(S.GridCell.handles());!n.done;n.next()){var r=n.value,i=o.handlePosition(r);if(this.shouldShowHandle(i,o,r)){for(var l=!1,s=a.iter(e);!s.done;s.next())s.value.distanceTo(i)<.001&&(l=!0);l||e.push(i)}}for(var u=[],c=[],h=a.iter(e);!h.done;h.next()){var d=h.value;if(!c.includes(d)){var g=[];g.push(d);for(var p=a.iter(e);!p.done;p.next()){var f=p.value;d==f||c.includes(f)||this.mergeableHandlePoints(d,f)&&g.push(f)}u.push(this.mergeHandlePoints(g));for(var m=a.iter(g);!m.done;m.next()){var y=m.value;c.push(y)}}}return u}},mergeableHandlePoints:function(e,t){if(e.x==t.x||e.y==t.y){for(var o=new U.TheoRect(e.x,e.y,t.x,t.y).outsetXY(.001,.001),n=a.iter(this.gridCells);!n.done;n.next())if(n.value.bounds.insetRel(.01,.01,.01,.01).intersects(o))return!1;for(var r=a.iter(this.gridCells);!r.done;r.next())if(r.value.bounds.insetRel(.01,.01,.01,.01).intersects(o))return!1;return!0}return!1},mergeHandlePoints:function(e){if(e.length>0){for(var t=e[0].x,o=e[0].x,n=e[0].y,r=e[0].y,i=a.iter(e);!i.done;i.next()){var l=i.value;t=Math.min(t,l.x),o=Math.max(o,l.x),n=Math.min(n,l.y),r=Math.max(r,l.y)}var s=new O.TheoPoint(.5,.5);return a.sort(e,(function(e,t){return e.distanceTo(s)<t.distanceTo(s)}))[0]}return R.LegacyCoreAssert.fail("not enough points",void 0,"GridController.mergeHandlePoints","GridController.swift",697),O.TheoPoint.ZERO},shouldShowHandle:function(e,t,o){for(var n=D.MathUtils.absDouble(e.x)>.01&&D.MathUtils.absDouble(e.y)>.01&&D.MathUtils.absDouble(1-e.x)>.01&&D.MathUtils.absDouble(1-e.y)>.01,r=0,i=a.iter(this.gridCells);!i.done;i.next()){var l=i.value;!a.eq(S._equality_GridCell_GridCell,t,l)&&this.adjacentCellForHandle(t,l,o)&&(r+=1)}return r<=1&&n},adjacentCellForHandle:function(e,t,o){if(e.bounds.L1Distance(t.bounds)>.01)return!1;var n=t.bounds.center.y>=e.bounds.minY&&t.bounds.center.y<=e.bounds.maxY&&e.bounds.height>t.bounds.height+.05,r=t.bounds.center.x>=e.bounds.minX&&t.bounds.center.x<=e.bounds.maxX&&e.bounds.width>t.bounds.width+.05;return!!(o==S.GridCellHandle.Left&&n&&t.bounds.center.x<e.bounds.center.x||o==S.GridCellHandle.Right&&n&&t.bounds.center.x>e.bounds.center.x||o==S.GridCellHandle.Top&&r&&t.bounds.center.y<e.bounds.center.y||o==S.GridCellHandle.Bottom&&r&&t.bounds.center.y>e.bounds.center.y)},getCellBackgroundShape:function(e){var t=this.cellForForma(e);if(null!=t)for(var o=a.iter(this.formaeForCell(t));!o.done;o.next()){var n=o.value;if(n instanceof M.ShapeForma&&r.isBackgroundColoredCell(n))return a.as(n,M.ShapeForma)}return null},getCellBackgroundImage:function(e){if(null!=e.controller&&e.controller.floating)return null;var t=this.cellForForma(e);if(null!=t)for(var o=a.iter(this.formaeForCell(t));!o.done;o.next()){var n,r=o.value;if(r.isBackgroundImage()&&(n=a.as(r,m.FrameForma)))return _.ImageFacade.getImageFormaForForma(n)}return null},childToSelect:function(){var e=a.clone(this.foregroundGridCells);if(0==e.length){var t=new O.TheoPoint(.5,.5);e=a.sort(this.backgroundGridCells,(function(e,o){return e.bounds.center.distanceTo(t)<o.bounds.center.distanceTo(t)}))}for(var o=a.clone(this.moveableFormae()),n=a.iter(e);!n.done;n.next())for(var r=n.value,i=a.iter(this.formaeForCell(r));!i.done;i.next()){var l=i.value;if(!a.containsEq(o,l,g._equality_Forma_Forma))return l}return this.forma},findCellHandle:function(e){for(var t=a.iter(this.gridCells);!t.done;t.next())for(var o=t.value,n=a.clone(S.GridCell.handlePositions()),r=a.iter(n);!r.done;r.next()){var i=r.value;if(o.bounds.eval(i).distanceTo(e)<.01)return[o,S.GridCell.handleForPosition(i)]}return[null,null]},containsPoint:function(e,t){void 0===t&&(t=0);for(var o=a.iter(this.gridCells);!o.done;o.next()){var n=o.value,r=this.getCellRegion(n);if(0!=t&&(r=r.outsetXY(t,t)),r.containsPoint(e))return!0}return!1},processFormaClick:function(e){a.eq(g._equality_Forma_Forma,e.forma,this.forma)||v.GroupController.prototype.processFormaClick.call(this,e)},beforeProcessFormaDrag:function(e){var t;(t=this.cellForForma(a.first(e.dragDelegate.draggedFormae)))&&(this.dragShapeInitBounds_=t.bounds),this.geomEventAroundChildDrag=new y.FormaGeometryChangedEvent(this.forma),this.forma.beginUpdate(this.geomEventAroundChildDrag)},processFormaDrag:function(e){this.beforeProcessFormaDrag(e),v.GroupController.prototype.processFormaDrag.call(this,e),this.afterProcessFormaDrag(e)},afterProcessFormaDrag:function(e){this.processChildFormaDrag(a.first(e.dragDelegate.draggedFormae),e),this.forma.endUpdate(this.geomEventAroundChildDrag),this.geomEventAroundChildDrag=null},processChildFormaDrag:function(e,t){if(e.controller.kind!=r.KIND){var o=this.cellForForma(e);if(null!=o&&e.kind==M.ShapeForma.KIND&&r.isBackgroundColoredCell(e)&&a.containsEq(this.foregroundGridCells,o,S._equality_GridCell_GridCell)&&null!=this.dragShapeInitBounds_){var n=this.forma.finalFrame,i=e.finalFrame,l=-1*Math.min(0,i.minX-n.minX),s=-1*Math.min(0,i.minY-n.minY);i.maxX>n.maxX&&(l=n.maxX-i.maxX),i.maxY>n.maxY&&(s=n.maxY-i.maxY),e.move(w.Matrix2D.translationXY(l,s)),i=e.finalFrame;for(var u=this.gridStyle.updateCell(o,U.TheoRect.fromXXYY((i.minX-n.minX)/n.width,(i.maxX-n.minX)/n.width,(i.minY-n.minY)/n.height,(i.maxY-n.minY)/n.height)),c=u.bounds.origin.subtract(this.dragShapeInitBounds_.origin),h=a.clone(this.moveableFormae()),d=a.iter(this.formaeForCell(u));!d.done;d.next()){var p=d.value;a.containsEq(h,p,g._equality_Forma_Forma)&&p.move(w.Matrix2D.translationXY(c.x*n.width,c.y*n.height))}}}},processChildBeginFormaDrag:function(e,t){this.inferGridCellAssignment()},processEndFormaDrag:function(e){v.GroupController.prototype.processEndFormaDrag.call(this,e),this.processChildEndFormaDrag(e)},afterProcessEndFormaDrag:function(e){this.processChildEndFormaDrag(e)},processChildEndFormaDrag:function(e){this.dragShapeInitBounds_=null,this.inferGridCellAssignment(),a.first(e.dragDelegate.draggedFormae).isTypeLockup()&&this.owner.interactionMode==h.InteractionMode.AutomaticGrid&&this.setInitialFormaSizes()},updateInitStateForForma:function(e){var t={bounds:e.bounds,placement:e.placement};if(this.moveableInitState_[e.id]=t,null!=this.preUpdateMapping_){for(var o=[],n=a.iter(a.keys(this.preUpdateMapping_));!n.done;n.next()){var r=n.value;(u=this.preUpdateMapping_[r])&&o.push(u)}for(var i=null,l=a.iter(o);!l.done;l.next()){var s,u=l.value,c=this.getCellRegion(u,this.forma.bounds),h=e.finalFrame;(s=c.intersectionWith(h))&&s.area/h.area>.8&&(i=u,this.preUpdateMapping_[e.formaID]=u)}null==i?null!=this.preUpdateMapping_[e.formaID]&&a.removeKey(this.preUpdateMapping_,e.formaID):this.preUpdateMapping_[e.formaID]=i}},isChildSwappable:function(e){var t;return(t=a.as(e,b.ImageForma))?this.isChildSwappable(t.parent):null!=e.controller&&!e.controller.moveable},swapGridChildren:function(e,t){var o,n;this.isChildSwappable(e)&&this.isChildSwappable(t)&&(o=this.cellForForma(e))&&(n=this.cellForForma(t))&&this.swapCells(o,n)},swapCells:function(e,t){var o=e,n=t,r=t.colorID;n=this.gridStyle.updateCell(n,null,e.colorID,null),o=this.gridStyle.updateCell(o,null,r,null);for(var i=[],l=[],s=a.iter(this.formaMappingSwiftDict);!s.done;s.next()){var u=s.key,c=s.value;a.eq(S._equality_GridCell_GridCell,c,o)&&i.push(u),a.eq(S._equality_GridCell_GridCell,c,n)&&l.push(u)}for(var d=a.iter(i);!d.done;d.next())u=d.value,this.gridStyle.mapCellToFormaID(u,n);for(var g=a.iter(l);!g.done;g.next())u=g.value,this.gridStyle.mapCellToFormaID(u,o);var f=null;this.owner.interactionMode==h.InteractionMode.AutomaticGrid&&(this.resetMoveableFormaToInitialSizes(),f=a.clone(this.preUpdateMapping_)),this.layoutGrid(this.owner.interactionMode==h.InteractionMode.AutomaticGrid&&this.gridStyle.moveableShift,null,f);for(var m=a.iter(i);!m.done;m.next())u=m.value,n.bounds.area<o.bounds.area/2&&(v=a.as(a.opt(this.forma.page.formaByID(u),(function(e){return e.controller})),p.FrameController))&&v.cropSizeCheck();for(var y=a.iter(l);!y.done;y.next()){var v;u=y.value,o.bounds.area<n.bounds.area/2&&(v=a.as(a.opt(this.forma.page.formaByID(u),(function(e){return e.controller})),p.FrameController))&&v.cropSizeCheck()}},spacingChangesVisible:{get:function(){return this.gridStyle.numBackgroundCells>1}},enterLayoutMode:function(){this.setInitialFormaSizes(),this.inferGridCellAssignment(),this.updateGridColors()},setInitialFormaSizes:function(){R.LegacyCoreAssert.isTrue(null!=this.gridStyle.forma,"grid style does not have a forma when setting initial sizes",void 0,"GridController.setInitialFormaSizes","GridController.swift",1091),this.preUpdateMapping_=a.clone(this.formaMappingDeepCopy),this.preUpdateSpacing_=this.gridStyle.spacing,a.removeAll(this.moveableInitState_);for(var e=a.iter(this.moveableFormae());!e.done;e.next()){var t,o=e.value;(t=a.as(o.controller,B.TypeLockupController))&&t.centerAlignmentIfSingleLine();var n={bounds:o.bounds,placement:o.placement};this.moveableInitState_[o.id]=n}},onFormaeDeleted:function(e){for(var t=a.iter(e);!t.done;t.next()){var o=t.value;a.removeKey(this.moveableInitState_,o.id)}},beginChildResizeEvent:function(e){this.setImageInitialSizes()},setImageInitialSizes:function(){this.imageInitState_={};for(var e=a.iter(this.forma.visitAsArray(g.FormaTraversal.PreOrder));!e.done;e.next()){var t=e.value;null!=t.controller&&t.controller.moveable&&t.kind==b.ImageForma.KIND&&(this.imageInitState_[t.formaID]=t.placement)}},resetMoveableFormaToInitialSizes:function(){if(!this.blockUpdate)for(var e=a.iter(this.moveableInitState_);!e.done;e.next()){var t,o=e.key,n=e.value;(t=a.as(a.opt(this.forma,(function(e){return e.database.getObject(o)})),g.Forma))&&(t.bounds=n.bounds,t.placement=n.placement)}},resetImageFormaToInitialPlacement:function(){for(var e=a.iter(this.forma.visitAsArray(g.FormaTraversal.PreOrder));!e.done;e.next()){var t,o=e.value;(t=this.imageInitState_[o.formaID])&&(o.placement=t)}},currentResizeCellHandlePosition:function(){return null!=this.resizeCell_?this.resizeCell_.handlePosition(this.resizeCellHandle_):null},clone:function(e){return new f.FormaControllerFactory(this.owner).createController(this.kind,e)},postClone:function(e){var t,o;(t=a.as(e.controller,r))&&(o=t.gridStyle)&&(e.style.forma=e,a.opt(this.gridStyle,(function(e){return e.postCloneMatch(o)})))},contentID:{get:function(){return"grid"}},mappedFormaIDs:function(){R.LegacyCoreAssert.isFalse(a.keys(this.formaMapping).includes(this.forma.formaID),"should be returning the grid id",void 0,"GridController.mappedFormaIDs","GridController.swift",1211);for(var e=[],t=a.iter(this.formaMapping);!t.done;t.next()){var o=t.key;e.push(o)}return e},matchStyle:function(e){var t,o;if(this.matchImageStyles(e),(t=a.as(e,r))&&null!=(o=a.opt(a.opt(e.forma,(function(e){return e.root})),(function(e){return e.style.colors.colorID(c.ColorRole.FieldPrimary)})))){var n=a.clone(this.forma.filterWithCallback((function(e){return r.isBackgroundColoredCell(e)}))),i=a.clone(e.forma.filterWithCallback((function(e){return r.isBackgroundColoredCell(e)})));this.isBackgroundVisible()&&(t.isBackgroundVisible()?n=[e.forma.root].concat(n):n.push(e.forma.root));for(var l=[],s=a.iter(i);!s.done;s.next()){var u;null!=(u=s.value.style.colors.colorID(c.ColorRole.FieldPrimary))&&l.push(a.as(u,"String"))}if(t.isBackgroundVisible()){var h=o;this.isBackgroundVisible()?l=[h].concat(l):l.push(h)}for(var d=this.forma.page.colorLibraryController,g=a.iter(a.range(0,n.length,!1));!g.done;g.next()){var p,f,m,y=g.value;(p=this.cellForForma(n[y]))&&(y<l.length?(n[y].style.colors.setColorId(c.ColorRole.FieldPrimary,l[y]),this.gridStyle.updateCell(p,null,l[y],null)):(f=this.getContrastingColorForCell(n[y]))&&null!=(m=d.getKeyOfColorInTheme(f))&&(n[y].style.colors.setColorId(c.ColorRole.FieldPrimary,m),this.gridStyle.updateCell(p,null,m,null)))}}},matchImageStyles:function(e){var t=a.clone(this.forma.filterWithCallback((function(e){return e.kind==b.ImageForma.KIND&&d.DesignFeatureUtils.isRetargetableImage(e.parent)}))),o=a.clone(e.forma.filterWithCallback((function(e){return e.kind==b.ImageForma.KIND&&d.DesignFeatureUtils.isRetargetableImage(e.parent)})));if(t.length>0&&o.length>0)for(var n=a.iter(a.range(0,t.length,!1));!n.done;n.next()){var r=n.value;t[r].match(o[r%o.length])}},match:function(e){this.updateGridAssignments(),this.matchImageStyles(e),this.beginBlockedUpdate(),this.forma.bounds=e.forma.bounds,this.endBlockedUpdate();var t=e.forma.filterWithCallback((function(e){return e.isBackgroundImage()})).length;this.gridStyle.match(e.forma.style);var o,n=this.forma.filterWithCallback((function(e){return e.isBackgroundImage()})).length,i=this.forma.filterWithCallback((function(e){return r.isBackgroundColoredCell(e)})).length,l=e.forma.filterWithCallback((function(e){return r.isBackgroundColoredCell(e)})).length;if(o=a.as(e,r)){n>0&&t>0&&this.matchImageStyles(e);var s=this.gridStyle;if(t<=n){this.splitCellsWithMultipleBackgroundImages(null);var u=0==l&&1==t&&o.maxMargin<10,c=1==l&&0==t&&o.maxMargin<10;(i>0&&(u||c)&&0==s.overlappingCells().length||n+t==0&&l<=1)&&(0==t&&0==n&&1==o.gridStyle.numCells?this.gridStyle.updateCell(this.gridCells[0],null,o.gridCells[0].colorID,null):this.recreateGrid(!1,Math.max(n,1),!1)),Math.abs(o.margin-o.maxMargin)<1&&(this.margin=o.margin)}else if(n<t){for(var h=t-n,d=a.clone(a.shuffle(this.forma.page.colorLibraryController.getThemeColorKeys())),g=a.iter(this.gridCells);!g.done;g.next()){var p;null!=(p=(y=g.value).colorID)&&d.includes(p)&&d.length>h&&a.remove(d,y.colorID)}for(var f=0,m=a.iter(this.gridCells);!m.done;m.next()){var y;null==(y=m.value).colorID&&(this.gridStyle.updateCell(y,null,d[f%d.length],null),f+=1)}}this.layoutGrid(!1),this.cropCheck()}},postMatch:function(e){this.inferBackgroundCellAssignment()},showChildHandle:function(e,t){var o,n,r=this.forma.bounds,i=this.forma.finalFrame;if(((o=a.opt(e.controller,(function(e){return e.userGroupChild})))||null!=o)&&o)return!1;if(e.controller.floating)return!0;if((n=this.cellForForma(e))&&this.gridStyle.overlappingCells().filter((function(e){return a.eq(S._equality_GridCell_GridCell,e,n)}),this).length>0&&i.equalWithAccuracy(e.finalFrame,10))return!0;for(var l=0,s=a.iter(this.backgroundGridCells);!s.done;s.next()){var u=s.value,c=r.evalRect(u.bounds).transform(this.forma.totalPlacement),h=Math.min(D.MathUtils.absDouble(i.minX-c.minX),D.MathUtils.absDouble(i.maxX-c.maxX),D.MathUtils.absDouble(i.minY-c.minY),D.MathUtils.absDouble(i.maxY-c.maxY));l=Math.max(l,h)}var d=e.finalFrame.eval(t);return!(l<.001&&(d.x<5||d.y<5||d.x>e.root.finalFrame.maxX-5||d.y>e.root.finalFrame.maxY-5))},applyGridStyleWithMapping:function(e,t){var o=this.gridStyle,n=a.clone(this.gridCells),r=a.clone(this.formaMappingSwiftDict),i=this.margin;o.match(e),this.updateHierarchy(),this.colorGrid(n,r),this.layoutGrid(e.moveableShift),this.setInitialFormaSizes(),o.cropType=p.CropType.PreserveFocus,t&&this.setMargin(i,!1)},applyStyle:function(e,t){var o;if(o=a.as(e,F.GridStyle)){var n;if(this.gridStyle.forma=this.forma,0!=a.count(o.formaMapping)&&0==t)o.spacing=this.gridStyle.spacing,this.applyGridStyleWithMapping(o,!0),n=o;else{var r=null!=this.gridForma.parent&&null!=this.gridForma.root;if(R.LegacyCoreAssert.isTrue(r,"bad things are happening. we're apply a style to a forma which is no longer attached",void 0,"GridController.applyStyle","GridController.swift",1490),!r)return;var i=a.clone(o.numCells==this.gridStyle.numCells?this.formaMappingSwiftDict:null),l=a.clone(new A.GridSuggester(this.gridForma,o,i).createSuggestions());if(l.length>0){var s=l[t%l.length];s.gridStyle.spacing=this.gridStyle.spacing,this.applyGridStyleWithMapping(s.gridStyle,!0),n=s.gridStyle}}null!=n&&n.moveableShift&&this.owner.interactionMode!=h.InteractionMode.DefaultInteraction&&this.adjustLogos(this.getLogos()),o.name==this.owner.document.gridLibrary.basicFullDesignGridStyle().name||G.TheoDocumentUtils.enableFastHeuristicsForComplexPage(this.forma.page)||(this.contrastCheck(),this.cropCheck()),R.LegacyCoreAssert.isTrue(null!=this.gridStyle.forma,"grid style does not have a forma after applying",void 0,"GridController.applyStyle","GridController.swift",1517)}},adjustLogos:function(e){for(var t=a.iter(e);!t.done;t.next()){var o,n=t.value;(o=a.as(n.controller,p.FrameController))&&o.placeAsLogo()}},numCells:{get:function(){return this.gridCells.length}},contrastCheck:function(){for(var e=a.iter(this.moveableFormae());!e.done;e.next()){var t,o=e.value;null!=this.formaMapping[o.formaID]&&(t=this.cellForForma(o))&&this.backgroundShapeFormaForCell(t)&&a.opt(o.controller,(function(e){return e.contrastCheck(!1)}))}},cropCheck:function(){for(var e=a.iter(this.checkFramesForCropping_);!e.done;e.next()){var t,o=e.value;(t=a.as(o.controller,p.FrameController))&&t.cropSizeCheck()}},replaceChildWithForma:function(e,t,o){void 0===o&&(o=!1);var n,r,i=this.isReplacedWithSameImage(e,t);if(v.GroupController.prototype.replaceChildWithForma.call(this,e,t,o),e.controller.floating){var l,s,u=e.placement.transformValues,c=t.finalFrame.center;t.placement=t.placement.rotateTo(u.rotCosine,u.rotSine),t.moveCenterToPoint(c),(l=_.ImageFacade.getImageFormaForForma(e))&&(s=_.ImageFacade.getImageFormaForForma(t))&&(s.intent=l.intent)}if((n=this.cellForForma(e))&&(this.gridStyle.replaceMappedForma(e,t),t.isShape())){var h,d,g=this.forma.page.colorLibraryController;(h=this.getContrastingColorForCell(t))&&null!=(d=g.getKeyOfColorInTheme(h))&&this.gridStyle.updateCell(n,null,d,null)}(r=a.as(t.controller,p.FrameController))&&(i||e.controller.floating||r.fitWithCrop(t.frame,p.CropType.FitBorder)),i||e.controller.floating||this.layoutGrid(!1)},isReplacedWithSameImage:function(e,t){var o=a.clone(t.filterByKind(b.ImageForma.KIND)),n=a.clone(e.filterByKind(b.ImageForma.KIND));if(o.length>0&&n.length>0)for(var r=a.iter(o);!r.done;r.next()){var i,l,s=r.value,u=n[0];if((i=a.opt(s.contentNode,(function(e){return e.mediaMetadata})))&&(l=a.opt(u.contentNode,(function(e){return e.mediaMetadata}))))return null!=i.assetID&&null!=l.assetID&&i.assetID==l.assetID}return!1},removeFormaWithoutGridModification:function(e){if(e.isGridCell()){var t=this.cellForForma(e);if(a.opt(t,(function(e){return null==e.colorID}))){var o,n,r=this.forma.page.colorLibraryController;(o=this.getContrastingColorForCell(e))&&null!=(n=r.getKeyOfColorInTheme(o))&&a.opt(t,(function(e){return e.colorID=n}))}}v.GroupController.prototype.removeFormaFromGroup.call(this,e),a.opt(this.gridStyle,(function(t){return t.removeMappingToForma(e)}))},removeFormaFromGroup:function(e){var t;if(v.GroupController.prototype.removeFormaFromGroup.call(this,e),this.forma instanceof T.GroupForma&&(t=this.formaMapping[e.formaID])){if(this.gridStyle.removeMappingToForma(e),e.controller.floating)return;if(e.controller.moveable){for(var o=a.iter(this.formaeForCell(t));!o.done;o.next())l=o.value,this.gridStyle.removeMappingToForma(l);a.opt(this.gridStyle,(function(e){return e.removeCell(t)}))}else{var n,r=this.getMergeCell(t);if(n=r){this.gridStyle.mergeCell(n,t),this.gridStyle.name=F.GridStyle.CUSTOM_LAYOUT_NAME;for(var i=a.iter(this.formaeForCell(t));!i.done;i.next()){var l=i.value;this.gridStyle.removeMappingToForma(l)}this.gridStyle.removeCell(t)}if(null==r){var s,u=this.gridStyle.numBackgroundCells;if(s=this.getResizeCellToZeroInfo(t)){var h=s.newRect,d=s.handle;R.LegacyCoreAssert.isTrue(null!=d,"info needed to resize grid cell to 0 missing handle",void 0,"GridController.removeFormaFromGroup","GridController.swift",1692),R.LegacyCoreAssert.isTrue(h!=U.TheoRect.Zero,"info needed to resize grid cell to 0 has empty rect",void 0,"GridController.removeFormaFromGroup","GridController.swift",1693);var g=this.gridStyle.cellIndex(t);if(this.updateCellRegion(t,h,d,!1),R.LegacyCoreAssert.isTrue(null!=g,"did not find index for cell in grid style",void 0,"GridController.removeFormaFromGroup","GridController.swift",1699),null!=g){for(var p=this.gridStyle.gridCells[g],f=a.iter(this.formaeForCell(p));!f.done;f.next()){var l=f.value;a.opt(this.gridStyle,(function(e){return e.removeMappingToForma(l)}))}this.gridStyle.removeCell(p)}this.gridStyle.removeCell(t),this.gridStyle.name=F.GridStyle.CUSTOM_LAYOUT_NAME}else if(1==u){var m;null!=(m=a.opt(a.opt(this.forma,(function(e){return e.root})),(function(e){return e.style.colors.colorID(c.ColorRole.FieldPrimary)})))&&(this.gridStyle.updateCellByIndex(0,null,m,null),this.margin=0)}else R.LegacyCoreAssert.fail("Should have at least one background cell. Something is wrong.",void 0,"GridController.removeFormaFromGroup","GridController.swift",1718)}this.layoutGrid(!1)}this.preUpdateMapping_=a.clone(this.formaMappingDeepCopy)}1==this.gridStyle.gridCells.length&&this.gridStyle.gridCells[0].bounds.equalWithAccuracy(U.TheoRect.ONE_BY_ONE,.01)&&(this.gridStyle.name=F.GridStyle.SINGLE_LAYOUT_NAME)},canRemoveFromHandleDirection:function(e,t){for(var o=a.iter(this.gridCells);!o.done;o.next()){var n=o.value;if(!a.eq(S._equality_GridCell_GridCell,n,e)&&0==e.bounds.L1Distance(n.bounds)){var r=e.bounds.unionWith(n.bounds);if(t==S.GridCellHandle.Left&&e.bounds.minX==n.bounds.maxX&&r.height!=e.bounds.height)return!1;if(t==S.GridCellHandle.Right&&e.bounds.maxX==n.bounds.minX&&r.height!=e.bounds.height)return!1;if(t==S.GridCellHandle.Bottom&&e.bounds.minY==n.bounds.maxY&&r.width!=e.bounds.width)return!1;if(t==S.GridCellHandle.Top&&e.bounds.maxY==n.bounds.minY&&r.width!=e.bounds.width)return!1}}return!0},setupWithFormae:function(e){var t;if(t=a.as(this.forma,T.GroupForma)){t.removeAllChildren();for(var o=a.iter(e);!o.done;o.next()){var n=o.value;t.appendChild(n)}this.recreateGrid()}},inferGridCellAssignment:function(e){void 0===e&&(e=null);var t,o=null!=e?e:a.opt(this.forma,(function(e){return e.bounds}));if(t=o)for(var n=a.iter(this.moveableFormae());!n.done;n.next()){for(var r,i=n.value,l=null,s=a.iter(this.gridCells);!s.done;s.next()){var u,c,h=s.value,d=this.getCellRegion(h,t);(u=a.opt(i.frame,(function(e){return e.intersectionWith(o)})))&&(c=d.intersectionWith(u))&&c.area/u.area>.85&&(l=h)}(r=l)?a.eq(S._equality_GridCell_GridCell,this.formaMapping[i.formaID],r)||this.gridStyle.mapCellToForma(i,r):null!=this.formaMapping[i.formaID]&&this.gridStyle.removeMappingToForma(i)}},backgroundImagesForCell:function(e){for(var t=a.clone(this.forma.visitAsArray(g.FormaTraversal.JustChildren)),o=[],n=a.iter(t);!n.done;n.next()){var r=n.value;a.eq(S._equality_GridCell_GridCell,this.formaMapping[r.formaID],e)&&r.isBackgroundImage()&&o.push(r)}return o},addFormaToGroupWithCurrentImage:function(e){var t,o;if(R.LegacyCoreAssert.isTrue(null!=this.gridStyle.forma,"grid style does not have a forma when adding forma to group with current image",void 0,"GridController.addFormaToGroupWithCurrentImage","GridController.swift",1848),(t=a.as(this.forma,T.GroupForma))&&(o=e.finalFrame)){t.appendChild(e);var n=a.clone(this.backgroundGridCells);if(0==n.length)return void R.LegacyCoreAssert.fail("ERROR: no background cells!",void 0,"GridController.addFormaToGroupWithCurrentImage","GridController.swift",1858);for(var r=n[0],i=a.iter(n);!i.done;i.next()){var l,s=i.value;if(l=this.getCellRegion(s).intersectionWith(o)){var u=this.getCellRegion(r).intersectionWith(o);(null==u||u.area<l.area)&&(r=s)}}this.gridStyle.mapCellToForma(e,r),this.splitCellsWithMultipleBackgroundImages(e),this.layoutGrid(!1)}},addFormaToGroup:function(e){var t,o,n=this;if(R.LegacyCoreAssert.isTrue(null!=this.gridStyle.forma,"grid style does not have a forma when adding forma to group",void 0,"GridController.addFormaToGroup","GridController.swift",1890),(t=a.as(this.forma,T.GroupForma))&&(o=e.finalFrame)){t.appendChild(e);var i=e.isImage()&&!e.controller.floating,l=null,s=null;if(this.owner.selection.forEachSelected((function(e){r.isBackgroundColoredCell(e)&&e.parent==n.forma&&(l=n.cellForForma(e),s=e)})),null!=s&&this.owner.selection.deselectForma(s),null==l)for(var u=!1,c=a.iter(this.backgroundGridCells);!c.done;c.next()){for(var h,d=c.value,p=0!=this.backgroundImagesForCell(d).length,f=a.clone(this.forma.visitAsArray(g.FormaTraversal.JustChildren)),m=a.iter(f);!m.done;m.next()){var y=m.value;a.eq(S._equality_GridCell_GridCell,this.formaMapping[y.formaID],d)&&y.isBackgroundImage()&&(p=!0)}if(p)p==i&&(null==l||l.bounds.area<d.bounds.area&&!u)&&(l=d);else if(null!=l&&u){if(h=this.getCellRegion(d).intersectionWith(o)){var v=this.getCellRegion(l).intersectionWith(o);(null==v||v.area<h.area)&&(l=d)}}else u=!0,l=d}this.gridStyle.mapCellToForma(e,null!=l?l:this.gridCells[0]),this.splitCellsWithMultipleBackgroundImages(e),this.layoutGrid(!1)}},createBasicGrid:function(){var e=this.gridCells[0].colorID,t=[new S.GridCell(new U.TheoRect(0,0,1,1),e)];this.gridStyle.setGridCells(t);for(var o=a.iter(this.forma.visitAsArray(g.FormaTraversal.JustChildren));!o.done;o.next()){var n=o.value;n.isBackgroundImage()&&this.gridStyle.mapCellToForma(n,this.gridCells[0])}this.splitCellsWithMultipleBackgroundImages(null)},splitCellsWithMultipleBackgroundImages:function(e){var t;if((t=a.as(this.forma,T.GroupForma))&&t.bounds){for(var o=a.clone(t.visitAsArray(g.FormaTraversal.JustChildren)),n=[],r=a.iter(this.backgroundGridCells);!r.done;r.next()){for(var i=r.value,l=[],s=0,u=a.iter(o);!u.done;u.next()){var c,h=u.value;(c=this.formaMapping[h.formaID])&&c.bounds.equalWithAccuracy(i.bounds,.01)&&h.isBackgroundImage()&&(s+=1,l.push(h))}if(a.sortInPlace(l,(function(e,t){return e.finalFrame.center.distanceTo(O.TheoPoint.ZERO)<t.finalFrame.center.distanceTo(O.TheoPoint.ZERO)})),s>1){a.opt(this.gridStyle,(function(e){return e.name=F.GridStyle.CUSTOM_LAYOUT_NAME}));var d=a.indexOfEq(this.gridCells,i,S._equality_GridCell_GridCell),p=this.getCellRegion(i),f=p.width,y=p.height,v=i.bounds,C=f/y>=1;C?f/=a.toDouble(s):y/=a.toDouble(s);var A=s%2==0&&s>2;if(A){var k=Math.max(f/y,y/f),L=f,b=y;C?(L=p.width/a.toDouble(a.toInt(s/2)),b=p.height/2):(L=p.width/2,b=p.height/a.toDouble(a.toInt(s/2))),Math.max(L/b,b/L)<k?(f=L,y=b):A=!1}for(var R=a.toInt(p.width/f),I=a.toInt(p.height/y),w=0,D=a.repeat(a.repeat(1,I),R),x=a.iter(a.range(0,R,!1));!x.done;x.next())for(var P=x.value,E=a.iter(a.range(0,I,!1));!E.done;E.next()){var M,N,G,B=E.value,H=p.aspectRatio;a.eq(g._equality_Forma_Forma,l[w],e)&&(M=a.as(l[w],m.FrameForma))&&(N=_.ImageFacade.getImageFormaForForma(M))&&(G=N.bounds)&&(H=G.aspectRatio),D[P][B]=C?H:1/H,w+=1}if(w=0,A)for(var z=a.toDouble(i.bounds.width)/a.toDouble(R),Y=a.toDouble(i.bounds.height)/a.toDouble(I),W=a.iter(a.range(0,R,!1));!W.done;W.next()){P=W.value;for(var V=a.iter(a.range(0,I,!1));!V.done;V.next()){B=V.value;var K=new U.TheoRect(v.minX+a.toDouble(P)*z,v.minY+a.toDouble(B)*Y,v.minX+a.toDouble(P+1)*z,v.minY+a.toDouble(B+1)*Y),X=new S.GridCell(K,i.colorID);this.gridStyle.insertCell(X,d),this.gridStyle.mapCellToForma(l[w],X),w+=1}}else for(var j=[],q=[],Z=[],J=[],Q=a.iter(a.range(0,R,!1));!Q.done;Q.next()){P=Q.value,j=a.clone(D[P]),J=a.clone(p.split(D[P].length,C,j));for(var $=a.iter(a.range(0,I,!1));!$.done;$.next()){if(B=$.value,R>0&&0==B){q.splice(0);for(var ee=a.iter(a.range(0,R,!1));!ee.done;ee.next()){var te=ee.value;q.push(D[te][B])}Z=a.clone(p.split(q.length,C,q))}if(J.length>1){var oe=p.locatePoint(J[B].evalXY(0,0)),ne=p.locatePoint(J[B].evalXY(1,1));K=v.evalUUVV(oe.x,ne.x,oe.y,ne.y),X=new S.GridCell(K,i.colorID),this.gridStyle.insertCell(X,d),this.gridStyle.mapCellToForma(l[w],X),w+=1}}Z.length>1&&(oe=p.locatePoint(Z[P].evalXY(0,0)),ne=p.locatePoint(Z[P].evalXY(1,1)),K=v.evalUUVV(oe.x,ne.x,oe.y,ne.y),X=new S.GridCell(K,i.colorID),this.gridStyle.insertCell(X,d),this.gridStyle.mapCellToForma(l[w],X),w+=1)}n.push(i)}}for(var re=a.iter(n);!re.done;re.next())i=re.value,this.gridStyle.removeCell(i)}},shouldRecreateGrid:function(e){var t;if((t=a.opt(this.forma,(function(e){return e.root})))&&t.isModel)return!1;if(this.gridStyle.anyOverlap)return!1;var o,n,r=this.gridCells.length;if(1==r)return!1;if(r>4)return!1;if((o=a.as(this.forma,T.GroupForma))&&(n=o.bounds)){if(n.similarity(e)<.1)return!1;var i=!1,l=n.aspectRatio>1?n.width/a.toDouble(r)/n.height:n.height/a.toDouble(r)/n.width;if(l=Math.max(l,1/l),r%2==0){var s=0,u=0;n.aspectRatio>1?(s=n.width/a.toDouble(a.toInt(r/2)),u=n.height/2):(s=n.width/2,u=n.height/a.toDouble(a.toInt(r/2)));var c=Math.max(s/u,u/s);c<l&&(l=c)}for(var h=a.iter(this.gridCells);!h.done;h.next()){var d=h.value,g=e.evalRect(d.bounds).aspectRatio;g=Math.max(g,1/g);var p=n.evalRect(d.bounds).aspectRatio;(p=Math.max(p,1/p))-g>=2&&p-l>=1&&(i=!0)}return i}return!1},recreateGrid:function(e,t,o){void 0===e&&(e=!0),void 0===t&&(t=null),void 0===o&&(o=!0),this.assertCorrectLayout();var n=this.forma.filterWithCallback((function(e){return e.kind==b.ImageForma.KIND&&e.parent.isBackgroundImage()})).length,r=null!=t?t:Math.max(n,this.gridCells.length),i=a.clone(this.owner.document.gridLibrary.getGridsByCellNumber(r,!1));if(r==this.gridCells.length){var l=a.opt(this.gridStyle,(function(e){return e.clone()}));i.push(l.flipRegion())}for(var s=this.spacing,u=[],c=a.iter(i);!c.done;c.next()){var h=c.value;h.moveableShift=e;var d=a.clone(o?this.formaMappingSwiftDict:null);a.append(u,new A.GridSuggester(this.forma,h,d).createSuggestions())}if(u.length>0){a.sortInPlace(u,(function(e,t){return e.score>t.score}));var g=u[0];R.LegacyCoreAssert.isTrue(g.gridStyle.moveableShift==e,"moveable shift failing",void 0,"GridController.recreateGrid","GridController.swift",2322),g.gridStyle.spacing=s,this.applyGridStyleWithMapping(g.gridStyle,!0)}else this.createBasicGrid()},childUpdate:function(e){var t;if(void 0===e&&(e=null),this.updatedChild=e,null!=e&&null==this.dragShapeInitBounds_&&this.isGridCell(e)&&(t=e)){this.owner.interactionMode!=h.InteractionMode.AutomaticGrid&&this.updateGridAssignments(),this.updateGridColors();var o=this.cellForForma(t);if(null==o)return void a.opt(k.Host.logging,(function(e){return e.warning("Couldn't match cell")}));var n=this.updatedCellBounds(t,o,!1),r=null;if(D.MathUtils.absDouble(o.bounds.minX-n.minX)>.001?r=S.GridCellHandle.Left:D.MathUtils.absDouble(o.bounds.maxX-n.maxX)>.001?r=S.GridCellHandle.Right:D.MathUtils.absDouble(o.bounds.minY-n.minY)>.001?r=S.GridCellHandle.Top:D.MathUtils.absDouble(o.bounds.maxY-n.maxY)>.001&&(r=S.GridCellHandle.Bottom),null!=r){n=this.updatedCellBounds(t,o,!0),this.updateCellRegion(o,n,r,!0);var i=null;this.owner.interactionMode==h.InteractionMode.AutomaticGrid&&(0==a.count(this.moveableInitState_)&&this.setInitialFormaSizes(),this.resetMoveableFormaToInitialSizes(),i=a.clone(this.preUpdateMapping_)),this.resetImageFormaToInitialPlacement(),this.layoutGrid(this.owner.interactionMode==h.InteractionMode.AutomaticGrid,null,i)}}},getAdjustedSpacingsForCell:function(e,t){var o=a.clone(this.backgroundGridCells),n=a.clone(this.filterCellsByDirection(e,o,"horizontal")),r=a.clone(this.filterCellsByDirection(e,o,"vertical"));n=a.sort(n,(function(e,t){return e.bounds.minX<t.bounds.minX})),r=a.sort(r,(function(e,t){return e.bounds.minY<t.bounds.minY})),n=a.clone(this.removeOverlapCells(n,"horizontal")),r=a.clone(this.removeOverlapCells(r,"vertical"));for(var i=-1,l=-1,s=a.iter(a.range(0,n.length,!1));!s.done;s.next())if(n[c=s.value].bounds.equalWithAccuracy(e.bounds,S.GridCell.BOUNDS_ACCURACY)){i=c;break}for(var u=a.iter(a.range(0,r.length,!1));!u.done;u.next()){var c;if(r[c=u.value].bounds.equalWithAccuracy(e.bounds,S.GridCell.BOUNDS_ACCURACY)){l=c;break}}var h=t,d=t,g=t,p=t,f=n.length,m=a.toDouble(f-1)/a.toDouble(f);0==i&&(h=0,f>2?d*=m:d/=2),i==f-1&&(d=0,f>2?h*=m:h/=2),f>2&&0!=i&&i!=f-1&&(1==i&&i==f-2?(h*=1-m,d*=1-m):1==i?(h*=1-m,d/=2):i==f-2?(d*=1-m,h/=2):(h/=2,d/=2));var y=r.length,v=a.toDouble(y-1)/a.toDouble(y);return 0==l&&(g=0,y>2?p*=v:p/=2),l==y-1&&(p=0,y>2?g*=v:g/=2),y>2&&0!=l&&l!=y-1&&(1==l&&l==y-2?(g*=1-v,p*=1-v):1==l?(g*=1-v,p/=2):l==y-2?(p*=1-v,g/=2):(g/=2,p/=2)),[h,d,g,p]},updatedCellBounds:function(e,t,o){var n=this.forma.finalFrame,r=o?e.finalFrame.intersectionWith(n):e.finalFrame,i=a.clone(this.gridStyle.overlappingCells()),l=a.containsEq(i,t,S._equality_GridCell_GridCell)?0:this.gridStyle.spacing,s=a.clone(this.getAdjustedSpacingsForCell(t,l)),u=s[0],c=s[1],h=s[2],d=s[3],g=new U.TheoRect(r.minX-u,r.minY-h,r.maxX+c,r.maxY+d);return new U.TheoRect((g.minX-n.minX)/n.width,(g.minY-n.minY)/n.height,(g.maxX-n.minX)/n.width,(g.maxY-n.minY)/n.height)},updateCellRegion:function(e,t,o,n){if(void 0===n&&(n=!0),null!=a.as(this.forma,T.GroupForma)){var i=e.bounds,l=null,s=null,u=null;o==S.GridCellHandle.Left?(l=i.verticalLine(0),s=t.minX):o==S.GridCellHandle.Right?(l=i.verticalLine(1),s=t.maxX):o==S.GridCellHandle.Top?(l=i.horizontalLine(0),u=t.minY):o==S.GridCellHandle.Bottom&&(l=i.horizontalLine(1),u=t.maxY);var c=this.getCellRegion(e,null,t);if(n&&Math.min(c.width,c.height)<r.MIN_CELL_DIM)return a.opt(k.Host.logging,(function(e){return e.info("new cell too small")})),!1;if(null!=s&&(s<0||s>1)||null!=u&&(u<0||u>1))return a.opt(k.Host.logging,(function(e){return e.info("shifted out of bounds  "+i.asString+" -> "+t.asString)})),!1;var h=[],d=[];if(h.push({cell:e,bounds:t}),d.push({cell:e,bounds:e.bounds}),null!=l&&a.containsEq(this.backgroundGridCells,e,S._equality_GridCell_GridCell))for(var g=a.iter(this.gridCells);!g.done;g.next()){var p=g.value;if(!a.eq(S._equality_GridCell_GridCell,p,e)){var f=p.bounds,m=f,y=l.projectionOffset(p.handlePosition(S.GridCellHandle.Left)).length(),v=l.projectionOffset(p.handlePosition(S.GridCellHandle.Right)).length(),C=l.projectionOffset(p.handlePosition(S.GridCellHandle.Top)).length(),A=l.projectionOffset(p.handlePosition(S.GridCellHandle.Bottom)).length();if(null!=s&&(y<v&&y<.02?m=new U.TheoRect(s,f.minY,f.maxX,f.maxY):y>v&&v<.02&&(m=new U.TheoRect(f.minX,f.minY,s,f.maxY))),null!=u&&(A<C&&A<.02?m=new U.TheoRect(f.minX,f.minY,f.maxX,u):A>C&&C<.02&&(m=new U.TheoRect(f.minX,u,f.maxX,f.maxY))),f.minX!=m.minX&&f.maxX!=m.maxX||f.minY!=m.minY&&f.maxY!=m.maxY)return!1;if(c=this.getCellRegion(p,null,m),m.minX<0||m.minY<0||m.maxX>1||m.maxY,n&&Math.min(c.width,c.height)<r.MIN_CELL_DIM)return!1;h.push({cell:p,bounds:m}),d.push({cell:p,bounds:p.bounds})}}for(var F=a.clone(this.gridStyle.nonOverlappingCells()),L=a.iter(h);!L.done;L.next()){var b=L.value;this.gridStyle.updateCell(b.cell,b.bounds)}for(var _=a.iter(F);!_.done;_.next()){if(p=_.value,!this.gridBounds_.contains(p.bounds))return a.opt(k.Host.logging,(function(e){return e.info("out of bounds "+p.bounds)})),!1;p.bounds.area}if(this.gridStyle.nonOverlappingCells().length!=F.length){for(var R=a.iter(this.gridCells);!R.done;R.next())p=R.value,a.opt(k.Host.logging,(function(e){return e.info("gridCell "+p.bounds.asString)}));for(var I=a.iter(d);!I.done;I.next())b=I.value,this.gridStyle.updateCell(b.cell,b.bounds);return!1}return!0}return!1},inferBackgroundCellAssignment:function(){for(var e=a.iter(this.gridCells);!e.done;e.next())for(var t=e.value,o=this.getCellRegion(t),n=a.iter(this.forma.visitAsArray(g.FormaTraversal.JustChildren));!n.done;n.next()){var r,i=n.value;(r=i.finalFrame)&&r.equalWithAccuracy(o,.01)&&(i.controller.moveable&&i.kind!=M.ShapeForma.KIND||this.gridStyle.mapCellToForma(i,t))}},backgroundShapeFormaForCell:function(e,t){void 0===t&&(t=null);for(var o=a.clone(null!=t?t:this.formaMappingSwiftDict),n=a.iter(o);!n.done;n.next()){var r,i=n.key,l=n.value;if(a.eq(S._equality_GridCell_GridCell,l,e)&&(r=this.forma.page.formaByID(i))&&r.kind==M.ShapeForma.KIND&&this.isGridCell(r))return a.as(r,M.ShapeForma)}return null},isGridCell:function(e){if(e.hasIntent(g.Forma.INTENT_GRID_CELL))return!0;if(a.opt(e.controller,(function(e){return 1==e.floating})))return!1;if(e.hasIntent(g.Forma.INTENT_ICON)||e.hasIntent(g.Forma.INTENT_FLOATING_SHAPE)||e.hasIntent(g.Forma.INTENT_LOGO)||e.hasIntent(g.Forma.INTENT_FLOATING_IMAGE))return!1;if(e.parent==this.forma&&(e.isShape()||e.isImage())){var t,o;if((t=a.as(e,M.ShapeForma))&&null==t.contentNode)return!0;if(e.isBackgroundImage())return!0;if(o=e.finalFrame)for(var n=a.iter(this.gridCells);!n.done;n.next()){var r=n.value;if(this.getCellRegion(r).equalWithAccuracy(o,.1))return!0}if(e.kind==T.GroupForma.KIND)return!1;if(null==a.opt(a.as(e,M.ShapeForma),(function(e){return e.contentNode}))&&e.isShape())return!0}return!1},childMoveableInDirection:function(e,t){if(e.isShape()||e.isImage()){var o,n,r;if((o=this.cellForForma(e))&&a.containsEq(this.foregroundGridCells,o,S._equality_GridCell_GridCell)&&(n=e.finalFrame)&&(r=a.opt(this.forma,(function(e){return e.finalFrame})))){if(Math.abs(n.width-r.width)<2&&t.x>0)return!1;if(Math.abs(n.height-r.height)<2&&t.y>0)return!1}return null==e.allowUserMove||e.allowUserMove}return!0},formaeForCell:function(e){for(var t=[],o=a.iter(this.formaMappingSwiftDict);!o.done;o.next()){var n,r=o.key,i=o.value;a.eq(S._equality_GridCell_GridCell,i,e)&&(n=this.forma.page.formaByID(r))&&t.push(n)}return t},cellForForma:function(e){var t;return null!=(t=a.opt(this.gridStyle,(function(t){return t.cellForForma(e)})))?t[1]:null},updateGridAssignments:function(){for(var e=a.clone(this.forma.visitAsArray(g.FormaTraversal.JustChildren)),t=a.iter(this.gridCells);!t.done;t.next())for(var o=t.value,n=this.getCellRegion(o),r=a.containsEq(this.foregroundGridCells,o,S._equality_GridCell_GridCell),i=a.iter(e);!i.done;i.next()){var l,s,u=i.value;r&&u.isBackgroundImage()||(l=u.finalFrame)&&(s=l.intersectionWith(n))&&s.area/Math.max(n.area,l.area)>.9&&this.gridStyle.mapCellToForma(u,o)}},beginUpdateGroup:function(e){void 0===e&&(e=null),v.GroupController.prototype.beginUpdateGroup.call(this,e),this.inferGridCellAssignment()},updateGroup:function(){if(!this.blockUpdate){var e=!1,t=null,o=null;if(null!=this.oldBounds){t=a.clone(this.formaMappingSwiftDict),this.beginBlockedUpdate();var n=this.margin,r=this.maxMargin;o=this.spacing,this.updateGridColors(),this.inferGridCellAssignment(this.oldBounds);for(var i=a.iter(this.moveableFormae());!i.done;i.next()){var l=i.value;(null==this.formaMapping[l.formaID]||this.formaMapping[l.formaID].bounds.equalWithAccuracy(U.TheoRect.ONE_BY_ONE,S.GridCell.BOUNDS_ACCURACY))&&(e=!0)}if(e)for(var s=a.iter(this.moveableFormae());!s.done;s.next())l=s.value,this.gridStyle.removeMappingToFormaID(l.formaID);!e&&this.shouldRecreateGrid(this.oldBounds)&&this.recreateGrid(),Math.abs(n-r)<50&&(this.margin=.1,this.margin=n),this.endBlockedUpdate()}var u=this.gridStyle.cropType;if(1==this.gridStyle.numBackgroundCells&&"Original"==this.gridForma.page.sizeID){var c,h=a.clone(this.forma.filterWithCallback((function(e){return null!=e.parent&&e.parent.isBackgroundImage()&&e.kind==b.ImageForma.KIND})));1==h.length&&(c=a.as(h[0],b.ImageForma))&&c.bounds.size.similarity(this.gridForma.page.pageSize)<.001&&(this.gridStyle.cropType=p.CropType.FitBorder)}if(this.layoutGrid(this.gridStyle.moveableShift,this.oldBounds,t,o),this.gridStyle.cropType=u,null!=this.oldBounds&&(this.setInitialFormaSizes(),e&&null!=t))for(var d=a.iter(this.moveableFormae());!d.done;d.next()){var g;(g=t[(l=d.value).formaID])&&this.gridStyle.mapCellToFormaID(l.formaID,g)}}},colorGrid:function(e,t){for(var o=a.sort(e,(function(e,t){return e.bounds.minY<t.bounds.minY||!(e.bounds.minY>t.bounds.minY)&&e.bounds.minX<t.bounds.minX})),n=[],r=a.iter(o);!r.done;r.next())null!=(v=r.value).colorID&&null!=this.backgroundShapeFormaForCell(v,t)&&n.push(v.colorID);var i,l=this.isBackgroundVisible(),s=this.forma.root.style.colors.colorID(c.ColorRole.FieldPrimary);0!=n.length||l||null!=(i=s)&&n.push(i);for(var u=a.iter(this.forma.page.colorLibraryController.getThemeColorKeys());!u.done;u.next()){var h=u.value;n.includes(h)||l&&h==s||n.push(h)}for(var d=a.clone(this.gridCells),g=a.sort(d,(function(e,t){return e.bounds.center.distanceTo(O.TheoPoint.ZERO)<t.bounds.center.distanceTo(O.TheoPoint.ZERO)})),f=a.iter(this.formaMappingSwiftDict);!f.done;f.next()){var m,y=f.key,v=f.value,C=this.forma.page.formaByID(y);if(null!=C&&C.isBackgroundImage())(m=a.as(C.controller,p.FrameController))&&(m.isBackgroundImageWithAlpha()||null!=(F=a.indexOfEq(g,v,S._equality_GridCell_GridCell))&&g.splice(F,1));else if(a.opt(a.opt(C,(function(e){return e.controller})),(function(e){return e.kind==B.TypeLockupController.KIND}))){var T;if((T=a.as(a.opt(C,(function(e){return e.controller})),B.TypeLockupController))&&(a.opt(T.lockupStyle,(function(e){return e.backing==I.LockupBacking.Banner}))||a.opt(T.lockupStyle,(function(e){return e.backing==I.LockupBacking.BannerHorizontal}))||a.opt(T.lockupStyle,(function(e){return e.backing==I.LockupBacking.BannerVertical}))||a.opt(T.lockupStyle,(function(e){return e.backing==I.LockupBacking.Knockout})))){var A,F,k,L=a.opt(C,(function(e){return e.style.colors.colorID(c.ColorRole.FieldSecondary)}));(A=this.gridStyle.updateCell(v,null,L,null))&&(null!=(F=a.indexOfEq(g,v,S._equality_GridCell_GridCell))&&g.splice(F,1),null!=(k=a.indexOf(n,A.colorID))&&n.push(n.splice(k,1)))}}}for(var b=[],_=0,w=a.iter(g);!w.done;w.next()){v=w.value;for(var D=!1,x=a.iter(this.formaeForCell(v));!x.done;x.next()){var P,E;(P=t[x.value.formaID])&&null!=(E=P.colorID)&&n.includes(E)&&(D=!0,this.gridStyle.updateCell(v,null,E,null),n.length>g.length&&a.remove(n,E))}D||b.push(v)}if(0==n.length)R.LegacyCoreAssert.fail("ERROR: incorrectly removed all background colors.",void 0,"GridController.colorGrid","GridController.swift",3187);else for(var M=a.iter(b);!M.done;M.next())v=M.value,this.gridStyle.updateCell(v,null,n[_%n.length],null),_+=1},updateGridColors:function(){if(!this.blockUpdate)for(var e=a.iter(this.gridCells);!e.done;e.next()){var t,o=e.value;(t=this.backgroundShapeFormaForCell(o))&&(o.colorID==t.style.colors.colorID(c.ColorRole.FieldPrimary)&&o.opacity==t.style.opacity||this.gridStyle.updateCell(o,null,t.style.colors.colorID(c.ColorRole.FieldPrimary),t.style.opacity))}},getCellsSortedByRow:function(){return a.sort(this.gridCells,(function(e,t){return e.bounds.minY<t.bounds.minY||!(e.bounds.minY>t.bounds.minY)&&e.bounds.minX<t.bounds.minX}))},getCellsSortedByColumn:function(){return a.sort(this.gridCells,(function(e,t){return e.bounds.minX<t.bounds.minX||!(e.bounds.minX>t.bounds.minX)&&e.bounds.minY<t.bounds.minY}))},getContrastingColorForCell:function(e){var t=this.cellForForma(e);if(null!=t){var o=this.forma.page.colorLibraryController,n=[];this.isBackgroundVisible()&&null!=(i=a.opt(e.root,(function(e){return e.style.colors.colorID(c.ColorRole.FieldPrimary)})))&&(l=o.getSolidColorForKey(i))&&n.push(l);for(var r=a.iter(this.gridCells);!r.done;r.next()){var i,l,s=r.value;!a.eq(S._equality_GridCell_GridCell,t,s)&&t.mergeableWith(s)&&null!=(i=s.colorID)&&(l=o.getSolidColorForKey(i))&&n.push(l)}var u=a.clone(this.getContrastingThemeColorsInRandomOrder(n));if(u.length>0)return o.getTheoColorForKey(u[0]);R.LegacyCoreAssert.fail("failed in getContrastingColorForCell to get a color. we should never get here...",void 0,"GridController.getContrastingColorForCell","GridController.swift",3303)}return null},getContrastingThemeColorsInRandomOrder:function(e){for(var t=e.concat(),o=this.forma.page.colorLibraryController,n=o.getThemeColorKeys().concat(),r=[];n.length>0;){var i=s.CoreRandom.nextIntUniform(n.length),l=n[i];n.splice(i,1);for(var u=!1,c=a.iter(t);!c.done;c.next()){var h,d=c.value;(h=o.getSolidColorForKey(l))&&h.distanceTo(d)<23&&(u=!0)}u||(r.push(l),(h=o.getSolidColorForKey(l))&&t.push(h))}return r.length<2&&(r=a.clone(a.shuffle(o.getThemeColorKeys().concat()))),r},buildCellColorGroups:function(){for(var e=a.clone(this.getCellsSortedByRow()),t={},o=a.iter(e);!o.done;o.next()){var n,r=o.value;if(n=this.backgroundShapeFormaForCell(r)){for(var i=n.formaID,l=!1,s=a.iter(a.keys(t));!s.done;s.next()){var u=s.value;(new x.ProfilingColorMap).checkIfTwoFormaAreInSamePaletteMappingGroup(u,i)&&(t[u].push(r),l=!0)}l||(t[i]=[r])}}return t},shuffleColorAssignment:function(){var e=a.clone(this.buildCellColorGroups()),t=this.forma.page.colorLibraryController,o=[];if(this.isBackgroundVisible()){var n=this.forma.root.style.colors.colorID(c.ColorRole.FieldPrimary);o.push(t.getSolidColorForKey(n))}for(var r=a.clone(this.getContrastingThemeColorsInRandomOrder(o)),i=a.count(e)<=r.length,l=0,s=a.iter(e);!s.done;s.next()){for(var u,h=s.value,d=a.iter(h);!d.done;d.next()){var g,p,f=d.value;if((g=this.gridStyle.updateCell(f,null,r[l%r.length],null))&&(p=this.backgroundShapeFormaForCell(g))){var m=(new x.ProfilingColorMap).overridePaletteMappingDueToContrast(g.colorID,p.formaID);p.style.colors.setColorId(c.ColorRole.FieldPrimary,m),u=m}}i&&null!=u&&a.remove(r,u),l+=1}},getCellIdsGroupedByColor:function(){for(var e=a.clone(this.getCellsSortedByRow()),t={},o=a.iter(e);!o.done;o.next()){var n,r,i,l,s=o.value,c=null;if((n=this.backgroundShapeFormaForCell(s))&&(c=n.formaID),(r=this.forma)&&null!=(i=s.colorID)&&(l=r.page.colorLibraryController.getSolidColorForKey(i))){for(var h=l.rgbString,d=!1,g=a.iter(a.keys(t));!g.done;g.next()){var p=g.value;null!=c&&u.ColorSelectorUtils.compareTwoColorStringsWithMargin(p,h)&&(t[p].push(c),d=!0)}d||null==c||(t[h]=[c])}}return t},moveableFormae:function(){for(var e=[],t=a.iter(this.forma.visitAsArray(g.FormaTraversal.JustChildren));!t.done;t.next()){var o=t.value;!o.controller.floating||!o.controller.moveable||o instanceof b.ImageForma||this.isGridCell(o)||e.push(o)}return a.sortInPlace(e,(function(e,t){return e.finalFrame.center.distanceTo(O.TheoPoint.ZERO)<t.finalFrame.center.distanceTo(O.TheoPoint.ZERO)})),e},removeOverlapCells:function(e,t){R.LegacyCoreAssert.isTrue(["vertical","horizontal"].includes(t),"unknown direction",{direction:t},"GridController.removeOverlapCells","GridController.swift",3473);for(var o=[],n=a.iter(a.range(0,e.length,!1));!n.done;n.next()){var r=e[n.value];if(o.length>0){var i=o[o.length-1];"horizontal"==t?a.toDouble(Math.round(1e3*Math.max(r.bounds.minX,i.bounds.minX))/1e3)<a.toDouble(Math.round(1e3*Math.min(r.bounds.maxX,i.bounds.maxX))/1e3)||o.push(r):"vertical"==t&&(a.toDouble(Math.round(1e3*Math.max(r.bounds.minY,i.bounds.minY))/1e3)<a.toDouble(Math.round(1e3*Math.min(r.bounds.maxY,i.bounds.maxY))/1e3)||o.push(r))}else o.push(r)}return o},getCellRegion:function(e,t,o,n){void 0===t&&(t=null),void 0===o&&(o=null),void 0===n&&(n=null);var r=null!=t?t:this.forma.bounds,i=null!=o?o:e.bounds,l=r.evalRect(i).transform(this.forma.totalPlacement).rounded();if(a.containsEq(this.foregroundGridCells,e,S._equality_GridCell_GridCell))return l;var s=null!=n?n:this.gridStyle.spacing,u=a.clone(this.getAdjustedSpacingsForCell(e,s)),c=u[0],h=u[1],d=u[2],g=u[3],p=new U.TheoRect(l.minX+c,l.minY+d,l.maxX-h,l.maxY-g).rounded();return 0==p.area?new U.TheoRect(p.minX,p.minY,p.maxX+1,p.maxY+1):p},updateHierarchy:function(){for(var e=a.iter(a.keys(this.formaMapping));!e.done;e.next()){var t,o,n=e.value;(t=a.opt(this.forma,(function(e){return e.page.formaByID(n)})))&&(o=t.controller)&&(t.parent==this.forma||t.parent.hasIntent(g.Forma.INTENT_INFERRED_TEMP_GROUP)||o.userGroupChild||(t instanceof b.ImageForma?R.LegacyCoreAssert.fail("shouldn't have a mapping to an image ",void 0,"GridController.updateHierarchy","GridController.swift",3538):this.gridForma.appendChild(t,!0)))}},layoutGrid:function(e,t,o,n){void 0===t&&(t=null),void 0===o&&(o=null),void 0===n&&(n=null);var r,i=this;if(!this.blockUpdate&&null!=this.forma.bounds){var l=new y.FormaGeometryChangedEvent(this.forma);this.forma.beginUpdate(l);var s=a.clone(this.moveableFormae()),u=a.clone(C.GroupDetector.detectProximityGroups(s)),d=[];if(e&&this.owner.interactionMode!=h.InteractionMode.DefaultInteraction)for(var f=a.iter(a.range(0,this.gridCells.length,!1));!f.done;f.next()){for(var v=f.value,T=this.gridCells[v],A=this.getCellRegion(T),F=[],k=a.iter(this.formaeForCell(T));!k.done;k.next()){var L=k.value;a.containsEq(s,L,g._equality_Forma_Forma)&&F.push(L)}F.length>0&&(d=d.concat(F),this.evaluateCellAndSplit(F,u,A,t,o,n))}if(null!=t&&d.length<s.length){for(var b=[],_=a.iter(s);!_.done;_.next())L=_.value,a.containsEq(d,L,g._equality_Forma_Forma)||b.push(L);this.moveFormaeToCell(b,this.forma.frame,t,o,n)}var R=a.clone(this.forma.filterWithCallback((function(e){return i.isGridCell(e)&&e.isShape()}),g.FormaTraversal.JustChildren));this.checkFramesForCropping_=[];for(var w=0,D=a.iter(a.range(0,this.gridCells.length,!1));!D.done;D.next()){v=D.value,T=this.gridCells[v],A=this.getCellRegion(T);for(var x=!1,P=[],G=a.iter(this.formaeForCell(T));!G.done;G.next()){var O,H=G.value;H.isBackgroundImage()&&(P.push(H),((r=a.opt(a.as(H,m.FrameForma),(function(e){return e.hasAlpha()})))||null!=r)&&r||(x=!0),H.frame.area>2*A.area&&this.checkFramesForCropping_.push(H),(O=a.as(H.controller,p.FrameController))&&O.fitWithCrop(A,this.gridStyle.cropType),H.intent=g.Forma.INTENT_GRID_CELL)}if(!x){var z;if(null==(q=this.backgroundShapeFormaForCell(T))?(q=a.as(this.forma.page.createFormaWithController(M.ShapeForma.KIND,E.ShapeController.KIND),M.ShapeForma),N.ShapeLibrary.applyToShapeForma(q,N.ShapeLibrary.Square)):a.remove(R,q),this.gridStyle.mapCellToForma(q,T),null==T.colorID){var Y,W=this.forma.page.colorLibraryController.getThemeColorKeys()[0];T.bounds.equal(U.TheoRect.ONE_BY_ONE)&&null!=(Y=a.opt(a.opt(this.forma,(function(e){return e.root})),(function(e){return e.style.colors.colorID(c.ColorRole.FieldPrimary)})))&&(W=Y),T=this.gridStyle.updateCell(T,null,W,null)||T}null!=(z=T.colorID)&&(q.contentID=z+a.toString(w)),q.style.opacity=T.opacity,q.style.colors.setColorId(c.ColorRole.FieldPrimary,T.colorID),q.allowUserMove=a.containsEq(this.foregroundGridCells,T,S._equality_GridCell_GridCell),q.controller.fit(A),P.splice(0,0,q),q.intent=g.Forma.INTENT_GRID_CELL}for(var V=a.iter(P);!V.done;V.next()){var K=V.value,X=this.gridForma.indexOfChild(K);null!=X&&X==w||this.gridForma.insertChildAt(K,w),w+=1}}for(var j=a.iter(R);!j.done;j.next()){var q=j.value;this.gridStyle.removeMappingToForma(q),q.removeFromParent()}for(var Z=a.iter(d);!Z.done;Z.next()){var J,Q=Z.value;(J=a.as(Q.controller,B.TypeLockupController))&&(this.gridCells.length>1&&this.owner.interactionMode==h.InteractionMode.AutomaticGrid&&(a.opt(J.lockupStyle,(function(e){return e.backing==I.LockupBacking.Banner}))||a.opt(J.lockupStyle,(function(e){return e.backing==I.LockupBacking.BannerHorizontal}))||a.opt(J.lockupStyle,(function(e){return e.backing==I.LockupBacking.BannerVertical}))||a.opt(J.lockupStyle,(function(e){return e.backing==I.LockupBacking.Knockout})))&&(a.opt(J.lockupStyle,(function(e){return e.textLook=I.LockupTextLook.Fill})),a.opt(J.lockupStyle,(function(e){return e.backingArtworkID=null})),a.opt(J.lockupStyle,(function(e){return e.backing=I.LockupBacking.None}))),J.snapSizeToBounds())}this.forma.endUpdate(l)}},assertCorrectLayout:function(){this.gridStyle},evaluateCellAndSplit:function(e,t,o,n,r,i){if(void 0===n&&(n=null),void 0===r&&(r=null),void 0===i&&(i=null),0!=e.length)if(1!=e.length&&null==n){for(var l=e[0].finalFrame,s=a.iter(e);!s.done;s.next()){var u=s.value;l=l.unionWith(u.finalFrame)}for(var c=Math.max(o.aspectRatio,1/o.aspectRatio),h=Math.max(l.aspectRatio,1/l.aspectRatio),d=o.similarity(l)>.1?Math.min(a.toInt(c-1),Math.max(1,D.MathUtils.absInt(a.toInt(c-h)))):1,p=[],f=a.iter(t);!f.done;f.next()){for(var m=f.value,y=[],v=a.iter(e);!v.done;v.next())u=v.value,a.containsEq(m,u,g._equality_Forma_Forma)&&y.push(u);y.length>0&&p.push(y)}for(var S=Math.min(e.length,d),T=a.iter(e);!T.done;T.next()){var A,F;u=T.value,(A=a.as(u.controller,B.TypeLockupController))&&null!=(F=A.averageLineHeight)&&F<.5*B.TypeLockupController.MIN_LINE_HEIGHT&&(S+=1)}p=a.clone(C.GroupDetector.splitFormaGroups(p,Math.max(S,1)));var k=null;if(o.aspectRatio>2)k=a.clone(o.insetRel(.1,.1,0,0).split(p.length,!0));else{if(null!=r)return void this.moveFormaeToCell(e,o,n,r,i);for(var L=this.forma.root.finalFrame.height,b=[],_=a.iter(p);!_.done;_.next())if((m=_.value).length>0){l=m[0].finalFrame;for(var R=a.iter(m);!R.done;R.next())u=R.value,l=l.unionWith(u.finalFrame);b.push(l.height/L+.1)}k=a.clone(o.insetRel(0,0,.1,.1).split(p.length,!1,b))}var I=null;1==p.length&&(I=a.clone(r));for(var w=a.iter(a.range(0,p.length,!1));!w.done;w.next()){var x=w.value;this.moveFormaeToCell(p[x],k[x],null,I,i)}}else this.moveFormaeToCell(e,o,n,r,i)},moveFormaeToCell:function(e,t,o,n,r){var i;if(void 0===o&&(o=null),void 0===n&&(n=null),void 0===r&&(r=null),0!=e.length){var l,s=null;if(l=n)for(var u=null!=o?o:this.forma.bounds,c=a.iter(e);!c.done;c.next()){var h;if(h=l[c.value.formaID]){var d=this.getCellRegion(h,u,void 0,r);if(null!=s&&!s.equal(d)){s=null;break}s=d}}for(var g=a.sort(e,(function(e,t){return e.parent.indexOfChild(e)<t.parent.indexOfChild(t)})),p={},f=a.iter(g);!f.done;f.next()){var m=f.value;a.opt(a.as(m.controller,B.TypeLockupController),(function(e){return e.snapSizeToBounds()})),p[m.formaID]=m.parent.indexOfChild(m)}var y=this.forma.page.createFormaWithController(T.GroupForma.KIND,v.GroupController.KIND);y.allowUserMove=!1;var S=y.controller;y.isModel=!0,this.gridForma.isModel=!0,null==o?e.length>G.TheoDocumentUtils.DESIGN_COMPLEXITY_HEURISTIC_THRESHOLD?S.preferredResizeType=P.ResizeLayoutType.Fit:S.preferredResizeType=P.ResizeLayoutType.Pin:S.preferredResizeType=this.preferredResizeType,this.gridForma.appendChild(y);for(var C=g[0].finalFrame,A=a.iter(g);!A.done;A.next())m=A.value,C=C.unionWith(m.finalFrame);null==s?(y.placement=w.Matrix2D.translationXY(C.minX,C.minY),y.bounds=U.TheoRect.fromSize(C.size)):(y.placement=w.Matrix2D.translationXY(s.minX,s.minY),y.bounds=U.TheoRect.fromSize(s.size));var F=t.equal(this.forma.frame)&&null!=o;F&&(y.placement=w.Matrix2D.Identity,y.bounds=U.TheoRect.fromSize(o.size));for(var b=a.iter(g);!b.done;b.next())m=b.value,y.appendChild(m,!0);var _,R,I=H.TheoSize.Zero;if(null!=s||F)I=t.size;else{var D=Math.min(50,.05*t.width),x=Math.min(50,.05*t.height),E=t.insetXY(D,x),M=Math.min(E.height,C.height);1==e.length&&(M=Math.max(M,.75*E.height)),I=new H.TheoSize(E.width,M)}if(y.bounds=U.TheoRect.fromSize(I),y.move(w.Matrix2D.translation(y.finalFrame.evalXY(.5,.5).multiply(-1)).translate(t.center)),(_=a.opt(a.opt(y.page.document,(function(e){return e.controller})),(function(e){return e.undoRedoMgr})))&&(R=a.opt(_.getCurrentTimelineState(),(function(e){return e.action})))&&"k_change_page_size"==R.description){var N=(i=a.opt(a.as(y.controller,v.GroupController),(function(e){return e.lastLayoutType})))||null!=i?i:"unknown";a.opt(k.Host.logging,(function(e){return e.logToNewRelic(L.RemoteLoggingEvent.RESIZE_STRATEGY,{type:N})}))}for(var O=a.iter(g);!O.done;O.next())m=O.value,this.gridForma.insertChildAt(m,p[m.formaID],!0),t.contains(m.finalFrame)||a.opt(k.Host.logging,(function(e){return e.warning("warning. child forma "+m.finalFrame.asString+" must be within region "+t.asString+" ")}));y.removeFromParent(),this.gridForma.isModel=!1}},getAlignments:function(e){return void 0===e&&(e=!1),[]},postDecode:function(){var e=this;R.LegacyCoreAssert.isTrue(null!=this.forma,"forma present",void 0,"GridController.postDecode","GridController.swift",4156),R.LegacyCoreAssert.isTrue(null!=this.gridStyle,"grid style present",void 0,"GridController.postDecode","GridController.swift",4157),a.opt(this.gridStyle,(function(t){return t.forma=e.forma})),this.inferBackgroundCellAssignment(),this.inferGridCellAssignment(),this.updateGridColors()},resizeWithFit:function(e,t,o){if(null!=this.forma){this.inferBackgroundCellAssignment();var n=1==this.backgroundGridCells.length&&this.maxMargin<1,r=this.isBackgroundVisible();this.forma.bounds=a.opt(this.forma.bounds,(function(e){return e.scale(t,new O.TheoPoint(0,0))}));for(var i=a.iter(this.forma.visitAsArray(g.FormaTraversal.JustChildren));!i.done;i.next())i.value.move(w.Matrix2D.translation(o));if(this.beginBlockedUpdate(),this.forma.bounds=e,this.endBlockedUpdate(),n){this.gridStyle.nonOverlappingCells()[0].bounds=U.TheoRect.ONE_BY_ONE;var l=this.gridStyle.moveableShift;this.gridStyle.moveableShift=!1,this.updateGroup(),this.gridStyle.moveableShift=l}if(!r)for(var s=a.iter(this.backgroundGridCells);!s.done;s.next()){var u,h=s.value;null!=(u=h.colorID)&&this.backgroundShapeFormaForCell(h)&&this.forma.root.style.colors.setColorId(c.ColorRole.FieldPrimary,u)}this.updateAllGridCells()}},updateAllGridCells:function(){for(var e=a.iter(this.forma.visitAsArray(g.FormaTraversal.JustChildren));!e.done;e.next()){var t,o=e.value;o.isGridCell()&&(t=this.cellForForma(o))&&this.gridStyle.setCellBounds(t,this.updatedCellBounds(o,t,!0))}},getBasicShapeLayoutColor:function(){var e;return(e=this.gridStyle)&&1==e.gridCells.length&&e.gridCells[0].bounds.equalWithAccuracy(U.TheoRect.ONE_BY_ONE,.01)?e.gridCells[0].colorID:null},canMoveShape:function(e){if(e.parent!=this.forma)return!1;var t;if(l=this.cellForForma(e))return a.containsEq(this.foregroundGridCells,l,S._equality_GridCell_GridCell);if(t=e.finalFrame){for(var o={},n=[],r=a.iter(this.gridCells);!r.done;r.next()){var i,l=r.value,s=this.getCellRegion(l);(i=t.intersectionWith(s))&&i.area/s.area>.6&&(o[l]=i.area/s.area,n.push(l))}if(n.length>0)return a.sortInPlace(n,(function(e,t){return o[e]>o[t]})),a.containsEq(this.foregroundGridCells,n[0],S._equality_GridCell_GridCell)}return!1},cleanupUnusedBackgroundCellColors:function(){for(var e=a.iter(this.gridCells);!e.done;e.next())for(var t=e.value,o=this.getCellRegion(t),n=a.iter(this.forma.visitAsArray(g.FormaTraversal.JustChildren));!n.done;n.next()){var r,i,l=n.value;(r=l.finalFrame)&&(i=this.gridStyle.formaMapping[l.formaID])&&l.isBackgroundImage()&&null!=t.colorID&&r.equalWithAccuracy(o,.01)&&(t.colorID=null,i.colorID=null)}}}}),r)},"9X7Y":function(e,t,o){var n,r,i,a=t,l=o("oAGj"),s=o("Tq01"),u=o("H1Z2"),c=o("lmwz");a.IRotateHandler=l.defineProtocol("IRotateHandler",{beginRotate:"(BoxReference) -> Void",updateRotate:"(BoxReference, Double, Boolean) -> Void",endRotate:"(BoxReference) -> Void"}),a.NullRotateHandler=(n=function(){},r={},l.defineClass({name:"NullRotateHandler",ctor:n,statics:{instance:{get:function(){return void 0===r.instance&&(r.instance=new n),r.instance}},_implements:function(e){return"IRotateHandler"==e}},props:{beginRotate:function(e){},updateRotate:function(e,t,o){void 0===o&&(o=!0)},endRotate:function(e){}}}),n),a.StandardRotateHandler=(i=function(e,t,o){this.formaUnderRotation=null,this.initialImagePlacement=null,this.lastAppliedTotalDeltaRadians=0,this.dc=e,this.model=t,this.delegate=o,this.actionScope=null},l.defineClass({name:"StandardRotateHandler",ctor:i,statics:{_implements:function(e){return"IRotateHandler"==e}},props:{beginRotate:function(e){var t;this.lastAppliedTotalDeltaRadians=0,(t=l.opt(this.dc,(function(e){return e.selection.formaAt(0)})))&&l.opt(l.opt(t.controller,(function(e){return e.alignmentDetector})),(function(e){return e.update(!0)}))},updateRotate:function(e,t,o){var n;if(void 0===o&&(o=!0),null==this.actionScope){if(Math.abs(t)>0){var r,i;l.opt(this.dc,(function(e){return e.undoRedoMgr.beginGesture()})),this.actionScope=l.opt(this.dc,(function(e){return e.undoRedoMgr.gestureScope})),this.formaUnderRotation=l.opt(this.dc,(function(e){return e.selection.formaAt(0)})),((n=l.opt(this.dc,(function(e){return e.selection.inCropMode})))||null!=n)&&n&&(r=c.ImageFacade.getImageFormaForForma(this.formaUnderRotation))&&(this.formaUnderRotation=r,this.initialImagePlacement=l.opt(this.formaUnderRotation,(function(e){return e.placement}))),(i=l.opt(this.formaUnderRotation,(function(e){return e.controller})))&&i.userGroupChild&&!i.enableChildMove&&(this.formaUnderRotation=i.userGroupRoot,this.initialImagePlacement=l.opt(this.formaUnderRotation,(function(e){return e.placement}))),this.applyRotation(e,t,o)}}else this.applyRotation(e,t,o)},endRotate:function(e){var t;(t=this.model)&&(t.beginUpdates(),t.mutable.snapLines.clear(),t.updatesComplete()),null!=this.actionScope&&(l.opt(this.dc,(function(e){return e.undoRedoMgr.endGesture(!0)})),this.actionScope=null)},applyRotation:function(e,t,o){void 0===o&&(o=!0);var n=this,r=this.lastAppliedTotalDeltaRadians;if(t!=this.lastAppliedTotalDeltaRadians){var i,a=t-this.lastAppliedTotalDeltaRadians;if(this.lastAppliedTotalDeltaRadians=t,i=this.formaUnderRotation){var c=e.placement.transformPoint(e.bounds.center);l.opt(this.dc,(function(e){return e.doActionWithCompletion(new u.RotateHandleAction(i,a,c,n.initialImagePlacement,o),(function(e,t){var o,i,a=[];if((o=l.as(e,s.PlacementActionResult))&&(i=o.snapResult)){var u,c,h;if((u=i.snapLines)&&(a=l.clone(u)),c=i.movement){var d=c.transformValues;n.lastAppliedTotalDeltaRadians+=Math.atan2(d.rotSine,d.rotCosine)}(h=n.model)&&(h.beginUpdates(),h.mutable.snapLines.setAll(a),r!=n.lastAppliedTotalDeltaRadians&&l.opt(n.delegate,(function(e){return e.handles.updateHandles(h.mutable.handles)})),h.updatesComplete())}}))}))}}}}}),i)},"9kak":function(e,t,o){var n,r,i,a=t,l=o("oAGj");a.LockupRowInfo=(n=function(e,t){if(this.aspectRatio=0,this.words=[],this.text="",this.appendable=!0,this.rowHeightAdjustRatio=1,this.colOffsetLeft=0,this.colOffsetRight=0,void 0===e&&(e=null),void 0===t&&(t=!0),null!=e)for(var o=l.iter(e);!o.done;o.next()){var n=o.value;this.addWord(n)}this.appendable=t},l.defineClass({name:"LockupRowInfo",ctor:n,props:{addWord:function(e){if(this.words.length>0){var t=this.words[this.words.length-1];this.aspectRatio+=t.spaceAspectRatio,this.text+=" "}this.text+=e.text,this.words.push(e),this.aspectRatio+=e.aspectRatio,1!=this.words.length&&e.characterHeightRatio!=this.rowHeightAdjustRatio?this.rowHeightAdjustRatio=1:this.rowHeightAdjustRatio=e.characterHeightRatio},removeLastWord:function(){var e;if(e=l.last(this.words)){var t;if(this.words.splice(this.words.length-1,1),this.aspectRatio-=e.aspectRatio,t=l.last(this.words)){this.aspectRatio-=t.spaceAspectRatio;var o,n=this.text.split(" ");n.pop(),this.text=n.join(" "),1==this.rowHeightAdjustRatio&&null!=(o=l.opt(l.first(this.words),(function(e){return e.characterHeightRatio})))&&1!=o&&null==this.words.find((function(e){return e.characterHeightRatio!=o}),this)&&(this.rowHeightAdjustRatio=o)}else this.text="",this.rowHeightAdjustRatio=1;return e}return null}}}),n),a.LockupRowsInfo=(r=function(e,t,o,n,r,i){this.rows=l.clone(e),this.widestRow=t,this.primaryFontSize=o,this.averageRowHeight=n,this.width=r,this.height=i},i={},l.defineClass({name:"LockupRowsInfo",ctor:r,statics:{EMPTY:{get:function(){return void 0===i.EMPTY&&(i.EMPTY=new r([],new a.LockupRowInfo,0,0,0,0)),i.EMPTY}}}}),r)},"9tXS":function(e,t,o){var n,r=t,i=o("oAGj"),a=o("Tq01"),l=o("yGNn"),s=o("Kkml"),u=o("7EVG");r.SetWatermarkAction=(n=function e(t){this.watermark=t,a.Action.call(this,e.TYPE)},i.defineClass({name:"SetWatermarkAction",ctor:n,superName:"Action",statics:{TYPE:"SetWatermarkAction"},props:{getUserAction:function(e){return s.UserActions.SetWatermark()},execute:function(e){return u.WatermarkFacade.setWatermark(this.watermark,e.document),l.CorePromise.resolve(null)}}}),n)},AVHO:function(e,t,o){var n,r,i,a,l,s=t,u=o("oAGj"),c=o("gXiO");s.ControllerSettings=(n=function(e){this.type=e,c.CoreObject.call(this)},u.defineClass({name:"ControllerSettings",ctor:n,superName:"CoreObject"}),n),s.TypeLockupControllerSettings=(r=function e(t){this.controller=t,s.ControllerSettings.call(this,e.TYPE)},u.defineClass({name:"TypeLockupControllerSettings",ctor:r,superName:"ControllerSettings",statics:{TYPE:{get:function(){return"TypeLockupControllerSettings"}}}}),r),s.ImageControllerSettings=(i=function e(t){this.controller=t,s.ControllerSettings.call(this,e.TYPE)},u.defineClass({name:"ImageControllerSettings",ctor:i,superName:"ControllerSettings",statics:{TYPE:{get:function(){return"ImageControllerSettings"}}}}),i),s.RootControllerSettings=(a=function e(t){this.controller=t,s.ControllerSettings.call(this,e.TYPE)},u.defineClass({name:"RootControllerSettings",ctor:a,superName:"ControllerSettings",statics:{TYPE:{get:function(){return"RootControllerSettings"}}}}),a),s.ShapeControllerSettings=(l=function e(t){this.controller=t,s.ControllerSettings.call(this,e.TYPE)},u.defineClass({name:"ShapeControllerSettings",ctor:l,superName:"ControllerSettings",statics:{TYPE:{get:function(){return"ShapeControllerSettings"}}}}),l)},"Aj/e":function(e,t,o){var n,r=t,i=o("oAGj"),a=o("Tq01"),l=o("yGNn"),s=o("P83h"),u=o("c+uM"),c=o("35Q0"),h=o("8t9B"),d=o("Kkml");r.ChangeBackgroundShapeAction=(n=function e(t,o,n,r){this.formae=i.clone(t),this.backing=o,this.artworkID=n,this.charStyleMode=r,a.Action.call(this,e.TYPE)},i.defineClass({name:"ChangeBackgroundShapeAction",ctor:n,superName:"Action",statics:{TYPE:"ChangeBackgroundShapeAction"},props:{getUserAction:function(e){var t,o;return t=(o=this.formae)?o.map((function(e){return e.formaID}),this):i.clone(e.selection.IDs),this.charStyleMode&&(t=t.map((function(e){return e+":secondary"}),this)),d.UserActions.ChangeBackgroundShape(t.join(","))},execute:function(e){for(var t=i.clone(this.formae||e.selection.asFormaArray()),o=i.iter(t);!o.done;o.next()){var n,r=o.value;if(n=i.as(r.controller,h.TypeLockupController)){var d,g=new s.FormaStyleChangedEvent(r),p=this.backing,f=this.artworkID;(d=n.lockupStyle)&&((u.LockupStyle.isLetterGrid(d.layout)&&!c.ShapeLibrary.isBackingShapeLetterGridCompatible(this.backing,this.artworkID)||u.LockupStyle.isPath(d.layout)&&!c.ShapeLibrary.isBackingShapePathCompatible(d.pathID,this.backing,this.artworkID)||u.LockupStyle.isAutoLayout(d.layout)&&!c.ShapeLibrary.isBackingShapeAutoLayoutCompatible(this.backing,this.artworkID))&&(p=u.LockupBacking.SVGBackground),p==u.LockupBacking.SVGBackground&&null==f&&(f="square_001")),r.beginUpdate(g),this.charStyleMode&&(e.selection.inCharStyleMode=!0),n.styleController.applyBacking(p,f),r.endUpdate(g)}}return l.CorePromise.resolve(new a.ActionResult)}}}),n)},AnBp:function(e,t,o){var n,r,i,a,l,s,u=t,c=o("oAGj"),h=o("umUn");u.IEditorAttribute=c.defineProtocol("IEditorAttribute",{key:"String",isEqualTo:"(IEditorAttribute) -> Boolean"}),u.EditorAttributeBase=(n=function(e){this._key=e},c.defineClass({name:"EditorAttributeBase",ctor:n,superName:"CoreObject",props:{key:{get:function(){return this._key}}}}),n),u.ColorAttribute=(r=function e(t){this.colors=c.clone(t),u.EditorAttributeBase.call(this,e.KEY)},c.defineClass({name:"ColorAttribute",ctor:r,superName:"EditorAttributeBase",statics:{KEY:"color",_implements:function(e){return"IEditorAttribute"==e}},props:{isEqualTo:function(e){var t;if(t=c.as(e,r)){if(this.colors.length!=t.colors.length)return!1;for(var o=c.iter(c.range(0,this.colors.length,!1));!o.done;o.next()){var n=o.value;if(!c.eq(h._equality_TheoColor_TheoColor,this.colors[n],t.colors[n]))return!1}return!0}return!1}}}),r),u.OpacityAttribute=(i=function e(t){this.opacities=c.clone(t),u.EditorAttributeBase.call(this,e.KEY)},c.defineClass({name:"OpacityAttribute",ctor:i,superName:"EditorAttributeBase",statics:{KEY:"opacity",_implements:function(e){return"IEditorAttribute"==e}},props:{isEqualTo:function(e){var t;if(t=c.as(e,i)){if(this.opacities.length!=t.opacities.length)return!1;for(var o=c.iter(c.range(0,this.opacities.length,!1));!o.done;o.next()){var n=o.value;if(this.opacities[n]!=t.opacities[n])return!1}return!0}return!1}}}),i),u.MediaMetadataAttribute=(a=function e(t){this.mmds=c.clone(t),u.EditorAttributeBase.call(this,e.KEY)},c.defineClass({name:"MediaMetadataAttribute",ctor:a,superName:"EditorAttributeBase",statics:{KEY:"mediaMetadata",_implements:function(e){return"IEditorAttribute"==e}},props:{isEqualTo:function(e){var t;if(t=c.as(e,a)){if(this.mmds.length!=t.mmds.length)return!1;for(var o=c.iter(c.range(0,this.mmds.length,!1));!o.done;o.next()){var n=o.value;if(!this.mmds[n].isEqualTo(t.mmds[n]))return!1}return!0}return!1}}}),a),u.ControllerSettingAttribute=(l=function e(t){this.settings=c.clone(t),u.EditorAttributeBase.call(this,e.KEY)},c.defineClass({name:"ControllerSettingAttribute",ctor:l,superName:"EditorAttributeBase",statics:{KEY:"controllerSetting",_implements:function(e){return"IEditorAttribute"==e}},props:{isEqualTo:function(e){var t;if(t=c.as(e,l)){if(this.settings.length!=t.settings.length)return!1;for(var o=c.iter(c.range(0,this.settings.length,!1));!o.done;o.next()){var n=o.value;if(this.settings[n].type!=t.settings[n].type)return!1}return!0}return!1}}}),l),u.ImageAttribute=(s=function e(t){this.styles=c.clone(t),u.EditorAttributeBase.call(this,e.KEY)},c.defineClass({name:"ImageAttribute",ctor:s,superName:"EditorAttributeBase",statics:{KEY:"imageAttr",_implements:function(e){return"IEditorAttribute"==e}},props:{isEqualTo:function(e){var t;if(t=c.as(e,s)){if(this.styles.length!=t.styles.length)return!1;for(var o=c.iter(c.range(0,this.styles.length,!1));!o.done;o.next()){var n=o.value;if(!this.styles[n].equals(t.styles[n]))return!1}return!0}return!1}}}),s)},Bpjk:function(e,t,o){var n,r,i,a=t,l=o("oAGj"),s=o("gXiO");a.CropRatioPreset=(n=function(e,t,o,n,r){this.label=e,this.secondaryLabel=t,this.id=o,this.iconId=n,this.aspectRatio=r},l.defineClass({name:"CropRatioPreset",ctor:n,superName:"CoreObject"}),n),a.CropRatioPresetLibrary=(r=function(){s.CoreObject.call(this)},i={},l.defineClass({name:"CropRatioPresetLibrary",ctor:r,superName:"CoreObject",statics:{FREEFORM_ID:"Free",ORIGINAL_ID:"Original",NONE_ID:"None",FREECROP_PRESET:{get:function(){return void 0===i.FREECROP_PRESET&&(i.FREECROP_PRESET=new a.CropRatioPreset("k_Crop_Freeform","",r.FREEFORM_ID,"CropPaneFreeform",1)),i.FREECROP_PRESET}},ORIGINAL_SIZE_PRESET:{get:function(){return void 0===i.ORIGINAL_SIZE_PRESET&&(i.ORIGINAL_SIZE_PRESET=new a.CropRatioPreset("k_Crop_Original","",r.ORIGINAL_ID,"",0)),i.ORIGINAL_SIZE_PRESET}},ratios:{get:function(){return void 0===i.ratios&&(i.ratios=[new a.CropRatioPreset("k_Crop_Square","k_1_1_label","1:1","",1),new a.CropRatioPreset("","k_4_3_label","4:3","",1.33333333333),new a.CropRatioPreset("","k_3_4_label","3:4","",.75),new a.CropRatioPreset("","k_16_9_label","16:9","",1.77777777778),new a.CropRatioPreset("","k_9_16_label","9:16","",.5625)]),i.ratios}},getListOfRatios:function(){return r.ratios},getIdForRatio:function(e){var t=r.ratios.filter((function(t){return t.aspectRatio==e}),this);return 0==t.length?null:t[0].id}}}),r)},CMNw:function(e,t,o){var n,r,i,a,l=t,s=o("oAGj"),u=o("Tq01"),c=o("Dz6V"),h=o("SpAV"),d=o("yvDn"),g=o("yGNn"),p=o("fNpk"),f=o("358a");l.IActionHandler=s.defineProtocol("IActionHandler",{canDoAction:"(Action) -> Boolean",doActionWithCallback:"(Action, (ActionResult, Any) -> Void) -> Void",doAction:"(Action) -> CorePromise"}),l.ActionQueue=(n=function(){},s.defineClass({name:"ActionQueue",ctor:n,statics:{queue:[],executingAction:null,append:function(e,t,o){var r=[[e,t],o];n.queue.push(r)},startAction:function(e){p.LegacyCoreAssert.isTrue(null==n.executingAction,"Starting a new action when another is still executing",void 0,"ActionQueue.startAction","ActionHandler.swift",34),n.executingAction=e},finishAction:function(){var e;if(n.executingAction=null,null!=(e=s.first(n.queue))){var t=e[0],o=t[0],r=t[1],i=e[1];n.queue.shift(),i.doActionWithCallback(o,r)}}}}),n),l.NullActionHandler=(r=function(){},i={},s.defineClass({name:"NullActionHandler",ctor:r,statics:{instance:{get:function(){return void 0===i.instance&&(i.instance=new r),i.instance}},_implements:function(e){return"IActionHandler"==e}},props:{canDoAction:function(e){return!1},doActionWithCallback:function(e,t){t(null,null)},doAction:function(e){return g.CorePromise.resolve(null)}}}),r),l.StandardActionHandler=(a=function(e){this.dc=e},s.defineClass({name:"StandardActionHandler",ctor:a,statics:{_implements:function(e){return"IActionHandler"==e}},props:{canDoAction:function(e){var t;return(t=this.dc)?e.canDo(t):(p.LegacyCoreAssert.fail("Still calling actions when the controller has been destroyed",void 0,"StandardActionHandler.canDoAction","ActionHandler.swift",86),!1)},finishAction:function(){var e,t;(e=l.ActionQueue.executingAction)&&e.executionOptions.enableActionFeedback&&s.opt(this.dc,(function(e){return e.designController.actionFeedback.reportActionFeedback(c.ActionFeedback.NONE)})),l.ActionQueue.finishAction(),(t=this.dc)&&t.undoRedoMgr.establishSelectionStates()},doActionWithCallback:function(e,t){var o,n,r=this;null!=l.ActionQueue.executingAction?l.ActionQueue.append(e,t,this):(o=this.dc)&&(n=o.document)?(l.ActionQueue.startAction(e),f.PagesFacade.getActivePage(n).animationController.stopWithCallback((function(){var i=f.PagesFacade.getAnimatingPages(n).length;h.CoreAssertDebugOnly.isTrue(0==i,"Starting a user action while a page is animating",{numAnimatingPages:i},"StandardActionHandler.doActionWithCallback","ActionHandler.swift",118);var a=null,l=e.getUserAction(o);if(e.executionOptions.showWaitingFeedback!=c.ActionFeedbackWaitingType.None&&o.designController.actionFeedback.reportActionFeedback(new c.ActionFeedback(e.type,e.executionOptions.showWaitingFeedback)),l.undoable)o.undoRedoMgr.beginUserActionAsync(l).then((function(t){return e.execute(o)})).finished((function(n,i){a=n;var s=r.processResult(e,n);o.undoRedoMgr.endUserActionAsync().then((function(t){return e.updateSelection(o)})).then((function(e){return i?t(u.ActionResult.fromPromiseAny(a),null):t(null,a),null})).finished((function(e,t){r.finishAction(),s||t||p.LegacyCoreAssert.fail("Failed in complete callback for action that's not expected to fail",{action:l.description},"StandardActionHandler.doActionWithCallback","ActionHandler.swift",161)})),s||i||p.LegacyCoreAssert.fail("Failed to execute undoable action that's not expected to fail",{action:l.description},"StandardActionHandler.doActionWithCallback","ActionHandler.swift",165)}));else{var d=s.opt(o.document,(function(e){return e.beginTransaction(l.description)}));e.execute(o).then((function(t){return a=t,r.processResult(e,t),s.opt(d,(function(e){return e.end()})),d=null,t})).then((function(t){return e.updateSelection(o)})).then((function(e){return t(u.ActionResult.fromPromiseAny(a),null)})).fail((function(o){return r.processResult(e,o)||p.LegacyCoreAssert.fail("Failed to execute non-undoable action that's not expected to fail",{action:l.description},"StandardActionHandler.doActionWithCallback","ActionHandler.swift",199),s.opt(d,(function(e){return e.rollback()})),t(null,o),null})).finished((function(e,t){return r.finishAction()}))}}))):p.LegacyCoreAssert.fail("Still calling actions when the controller has been destroyed",void 0,"StandardActionHandler.doActionWithCallback","ActionHandler.swift",215)},doAction:function(e){var t=this;return new g.CorePromise((function(o,n){return t.doActionWithCallback(e,(function(e,t){var r;null!=(r=t)?n(r):o(e)}))}))},processResult:function(e,t){var o,n=e.executionOptions,r=!1,i=null;return(o=s.as(t,d.CoreErrorObject))&&(r=o.isAllowedError,n.showMessageFeedback!=c.ActionFeedbackMessageType.None&&(i=o)),e.executionOptions.enableActionFeedback&&s.opt(this.dc,(function(t){return t.designController.actionFeedback.reportActionFeedback(new c.ActionFeedback(e.type,c.ActionFeedbackWaitingType.None,n.showMessageFeedback,i))})),r}}}),a)},CaSj:function(e,t,o){var n,r=t,i=o("oAGj");r.DesignSuggester=(n=function(e,t){this.maxSuggestions_=100,this.forma_=e,this.group_=t},i.defineClass({name:"DesignSuggester",ctor:n,superName:"CoreObject",statics:{perms:function(e){return n.permute(e,[])},permute:function(e,t){if(0==e.length)return[t];for(var o=[],r=i.iter(i.range(0,e.length,!1));!r.done;r.next()){var a=r.value,l=i.clone(e),s=i.clone(t);s.push(l[a]),l.splice(a,1),i.append(o,n.permute(l,s))}return o},getPermutations:function(e,t){void 0===t&&(t=50);var o=[];if(e<5){var r=i.toArray(i.range(0,e,!1));(o=i.clone(n.perms(r))).length>t&&(i.shuffleInPlace(o),o=o.slice(0,t))}else for(var a=i.iter(i.range(0,t,!1));!a.done;a.next())r=i.toArray(i.range(0,e,!1)),i.shuffleInPlace(r),o.push(r);return o}},props:{maxSuggestions:{get:function(){return this.maxSuggestions_},set:function(e){this.maxSuggestions_=e}},forma:{get:function(){return this.forma_}},group:{get:function(){return this.group_}},createSuggestions:function(){return[]}}}),n)},Cj3Q:function(e,t,o){var n,r,i=t,a=o("oAGj"),l=o("ascj"),s=o("iCxV"),u=o("JgVS"),c=o("cEEQ"),h=o("c+uM"),d=o("tGKA"),g=o("JKVa"),p=o("8t9B"),f=o("hgLm"),m=o("oKlP"),y=o("sIWg"),v=o("1NAc");i.P=function(e,t){return new m.TheoPoint(e,t)},i.clockwiseRectanglePath=function(e,t,o){var n=f.TheoPathBuilder.init_d41d(),r=t.transformPoint(e.eval(i.P(0,0)));n.moveTo(r.x,r.y);var l=new y.TheoRect(r.x,r.y,r.x,r.y);if(o)for(var s=a.iter([i.P(0,1),i.P(1,1),i.P(1,0)]);!s.done;s.next()){var u=s.value;r=t.transformPoint(e.eval(u)),n.lineTo(r.x,r.y),l=l.expandToFit(r)}else for(var c=a.iter([i.P(1,0),i.P(1,1),i.P(0,1)]);!c.done;c.next()){u=c.value;r=t.transformPoint(e.eval(u)),n.lineTo(r.x,r.y),l=l.expandToFit(r)}return n.closePath(),{path:n.path,bounds:l}},i.RowsDecorationStrategy=(n=function(){this.paddingScalar=.6,u.BaseDecorationStrategy.call(this)},a.defineClass({name:"RowsDecorationStrategy",ctor:n,superName:"BaseDecorationStrategy",statics:{_implements:function(e){return"LockupDecorationStrategy"==e}},props:{easeOutQuad:function(e,t,o,n){var r=e/n;return-o*r*(r-2)+t},easeOut:function(e,t,o){return this.easeOutQuad(o,e,t-e,1)},supportsConfiguration:function(e){return e.style.backing==h.LockupBacking.Rows},decorateNoKnockout:function(e,t){var o=e.style,n=[],r={},m={},S=0,C=this.paddingScalar,T=o.padding;0==o.spacing&&t.numberOfLines>1&&(C*=.5,0==o.padding&&(T=.1));var A,F,k=!1;(A=e.style.characterStyles[p.TypeLockupController.HIGHLIGHT_STYLE])&&(k=A.backing==h.LockupBacking.Rows&&o.backing==h.LockupBacking.Rows),o.backing!=h.LockupBacking.Rows&&(C=this.paddingScalar/2,(F=e.style.characterStyles[p.TypeLockupController.HIGHLIGHT_STYLE])&&F.padding>-1&&(T=F.padding));var L=t.avgLinePointSize*t.typographicBoundingRatios.heightRatio,b=L*T*C;T>=0&&(b=Math.max(.05*L,b));for(var _=t.typographicBoundingRatios.backingVerticalOffsetRatio*L,R=this.easeOut(0,_,T),I=b+t.typographicBoundingRatios.sideInsetRatio*t.avgLinePointSize,w=e.style.font.fontData,D=t.numberOfLines,x={},P=-1,E=a.iter(a.toSequence(t.items));!E.done;E.next()){var M=E.value,N=M.offset,G=M.element;if(G.type==c.LockupItemType.Text){var B=G.rowIndex,O=o.backing==h.LockupBacking.Rows,U=null;null!=G.characterStyle&&(j=e.style.characterStyles[G.characterStyle])&&(j.backing==h.LockupBacking.None&&o.backing!=h.LockupBacking.Rows?O=!1:(O=!0,j.backing!=h.LockupBacking.UNSET&&j.backing!=h.LockupBacking.None&&(U=G.characterStyle,o.backing==h.LockupBacking.Rows&&j.backing==h.LockupBacking.Rows&&(S=I))));var H=0;if(N>0&&(H=G.placement.tx-(t.items[N-1].placement.tx+t.items[N-1].size.width)),O&&x[B]==U||(null!=r[B]&&(r[D]=r[B],m[D]=m[B],x[D]=x[B],0!=S&&S>H/2&&(r[D]=new y.TheoRect(r[D].minX,r[D].minY,r[D].maxX-S+H/2,r[D].maxY)),D+=1,a.removeKey(r,B),a.removeKey(x,B),P=B),O)){x[B]=U;var z=G.pointSize*t.typographicBoundingRatios.heightRatio,Y=k&&null==r[B]?I:0;0!=S&&P==B&&S>H/2&&(Y=H/2);var W=k?I:0,V=y.TheoRect.fromXYWH(G.placement.tx-Y,G.placement.ty,G.size.width+(Y+W),z);null==(Z=r[B])?(Z=V,m[B]=G.typographicBoundingRatios):Z=Z.unionWith(V),r[B]=Z}}}if(0==a.count(r))return new u.DecorationResults(n);for(var K=u.BaseDecorationStrategy.getHorizontalOffsetForItalicAngle(t.avgLinePointSize*t.typographicBoundingRatios.heightFromBaselineRatio,w.italicAngle),X=a.iter(r,!0);!X.done;X.next()){var j,q=X.key,Z=X.value,J=m[q],Q=Z.size.height/t.typographicBoundingRatios.heightRatio,$=(t.typographicBoundingRatios.textVerticalOffsetRatio-w.capRatio)*Q,ee=t.typographicBoundingRatios.textVerticalOffsetRatio,te=t.typographicBoundingRatios.heightRatio,oe=J.textVerticalOffsetRatio,ne=(ee-(te/2-J.heightRatio/2)-oe)*Q,re=k?0:I,ie=Z.size.width+2*re+K,ae=(z=Z.size.height+2*b,Z.minX-re),le=Z.minY+ne-$-b+R,se=new v.TheoSize(ie,z),ue=d.Matrix2D.translationXY(ae,le),ce=!1;if(null!=x[q]&&(j=e.style.characterStyles[x[q]])&&j.backing==h.LockupBacking.SVGBackground){if(null==j.backingArtworkID)return a.opt(s.Host.logging,(function(e){return e.warning("artworkID or artworkInfo is nil ")})),new u.DecorationResults([]);var he=new g.SVGBackgroundDecorationStrategy(j.backingArtworkID),de=new c.LayoutResults(t.items,Z.size,t.placement,t.typographicBoundingRatios,t.avgRowAspect),ge=he.calcSVGConfiguration(e.style,de,j.padding),pe=ge.frame,fe=ge.preScale;n.push(c.LockupItem.init_fbd7(l.ColorRole.FieldSecondary,pe.size,d.Matrix2D.translationXY(pe.minX+Z.minX,pe.minY+Z.minY+ne-$),j.backingArtworkID,fe,q+t.numberOfLines,x[q])),ce=!0}if(!ce||o.backing==h.LockupBacking.Rows){var me=f.TheoPathBuilder.init_d41d(),ye=i.clockwiseRectanglePath(y.TheoRect.fromSize(se),d.Matrix2D.Identity,!0).path;me.addPath(ye,d.Matrix2D.Identity),n.push(c.LockupItem.init_79d9(l.ColorRole.FieldSecondary,se,ue,me.path,q,void 0,ce&&o.backing==h.LockupBacking.Rows?null:x[q]))}}return n=a.sort(n,(function(e,t){return e.characterStyle!=t.characterStyle?null==e.characterStyle:e.rowIndex<t.rowIndex})),new u.DecorationResults(n)},decorate:function(e,t){var o,n=e.style,r=!1;if((o=e.style.characterStyles[p.TypeLockupController.HIGHLIGHT_STYLE])&&(r=o.backing!=h.LockupBacking.Rows&&h.LockupStyle.isKnockoutLook(o.textLook)),!s.Host.textModelUtils.useOutlinesForKnockouts()||n.backing!=h.LockupBacking.Rows||!h.LockupStyle.isKnockoutLook(n.textLook)&&!r)return this.decorateNoKnockout(e,t);var i=[],g={},m=[],S={},C=f.TheoPathBuilder.init_d41d(),T=f.TheoPathBuilder.init_d41d(),A=this.paddingScalar,F=n.padding;0==n.spacing&&t.numberOfLines>1&&(A*=.5,0==n.padding&&(F=.1));var k=t.avgLinePointSize*t.typographicBoundingRatios.heightRatio,L=k*F*A;F>=0&&(L=Math.max(.05*k,L));for(var b=e.style.font.fontData,_=u.BaseDecorationStrategy.getHorizontalOffsetForItalicAngle(t.avgLinePointSize*t.typographicBoundingRatios.heightFromBaselineRatio,b.italicAngle),R=t.typographicBoundingRatios.backingVerticalOffsetRatio*k,I=this.easeOut(0,R,F),w=L+t.typographicBoundingRatios.sideInsetRatio*t.avgLinePointSize,D=t.typographicBoundingRatios.textVerticalOffsetRatio,x=t.typographicBoundingRatios.heightRatio,P=d.Matrix2D.translationXY(-w,-L),E=!1,M=t.numberOfLines,N=a.iter(a.range(0,t.items.length,!1));!N.done;N.next()){var G=N.value,B=t.items[G];if(B.type==c.LockupItemType.Text){var O=B.rowIndex,U=n.backing==h.LockupBacking.Rows;if(null!=B.characterStyle&&null!=e.style.characterStyles[B.characterStyle]&&(U=!0),U){var H=B.pointSize*t.typographicBoundingRatios.heightRatio,z=y.TheoRect.fromXYWH(B.placement.tx,B.placement.ty,B.size.width,H),Y=g[O];null==Y?(Y=z,S[O]=B.typographicBoundingRatios):Y=Y.unionWith(z),g[O]=Y;var W=S[O],V=Y.size.height/t.typographicBoundingRatios.heightRatio,K=(t.typographicBoundingRatios.textVerticalOffsetRatio-B.font.capRatio)*V,X=W.textVerticalOffsetRatio,j=(D-(x/2-W.heightRatio/2)-X)*V;if(E||(P=d.Matrix2D.translationXY(-w,Y.minY+j-K-L+I),E=!0),G==t.items.length-1||O!=t.items[G+1].rowIndex){var q=!0,Z=Y.size.width+2*w+_,J=Y.size.height+2*L,Q=Y.minX,$=Y.minY+j-K+I,ee=a.last(m),te=y.TheoRect.fromXYWH(Q,$,Z,J);m.push(te),null!=ee&&ee.maxY<te.minY?(T.lineTo(ee.maxX,ee.maxY),T.lineTo(ee.minX,ee.maxY),T.closePath(),T.moveTo(te.minX,te.minY),q=!1):null==ee?T.moveTo(te.minX,te.minY):ee.maxX>te.maxX?T.lineTo(ee.maxX,ee.maxY):T.lineTo(ee.maxX,te.minY),q&&null!=ee&&ee.maxX>te.maxX?T.lineTo(te.maxX,ee.maxY):T.lineTo(te.maxX,te.minY)}}else null!=g[O]&&(g[M]=g[O],S[M]=S[O],M+=1,a.removeKey(g,O))}}if(0==m.length)return new u.DecorationResults(i);T.lineTo(m[m.length-1].maxX,m[m.length-1].maxY);for(var oe=a.iter(a.stride(m.length-1,0,-1));!oe.done;oe.next()){var ne=oe.value;m[ne-1].maxY>=m[ne].minY?(T.lineTo(m[ne].minX,m[ne].maxY),m[ne].minX<m[ne-1].minX?(T.lineTo(m[ne].minX,m[ne].minY),T.lineTo(m[ne-1].minX,m[ne].minY)):(T.lineTo(m[ne].minX,m[ne-1].maxY),T.lineTo(m[ne-1].minX,m[ne-1].maxY))):ne==m.length-1&&T.lineTo(m[ne].minX,m[ne].maxY)}1==m.length&&T.lineTo(m[0].minX,m[0].maxY),T.closePath();var re=d.Matrix2D.translationXY(0,-m[0].minY),ie=s.Host.textModelUtils.rewindPath(T.simplestForm)||T.simplestForm;C.addPath(ie,re);var ae=C.path,le=new v.TheoSize(a.opt(ae.bounds,(function(e){return e.width})),a.opt(ae.bounds,(function(e){return e.height})));return i.push(c.LockupItem.init_79d9(l.ColorRole.FieldSecondary,le,P,ae,null)),new u.DecorationResults(i)}}}),n),i.KnockoutDecorationStrategy=(r=function(){u.BaseDecorationStrategy.call(this)},a.defineClass({name:"KnockoutDecorationStrategy",ctor:r,superName:"BaseDecorationStrategy",statics:{_implements:function(e){return"LockupDecorationStrategy"==e}},props:{supportsConfiguration:function(e){return e.style.backing==h.LockupBacking.Knockout},decorate:function(e,t){var o,n,r=(o=a.opt(e.parentBounds,(function(e){return e.width})))||null!=o?o:5e3;null!=e.parentBounds&&a.opt(e.parentBounds,(function(e){return e.height}))>r&&(r=(n=a.opt(e.parentBounds,(function(e){return e.height})))||null!=n?n:5e3);var s=f.TheoPathBuilder.init_d41d(),h=t.placement,g=d.Matrix2D.translationXY(-r,-r),p=[],m=new v.TheoSize(t.size.width+2*r,t.size.height+2*r),S=y.TheoRect.fromSize(m),C=i.clockwiseRectanglePath(S,d.Matrix2D.Identity,!0).path;return s.addPath(C,h),p.push(c.LockupItem.init_79d9(l.ColorRole.FieldSecondary,S.size,g,s.path,null,!0)),new u.DecorationResults(p)}}}),r)},Cl7N:function(e,t,o){var n,r=t,i=o("oAGj"),a=o("7siz");r.ISnapLinesModel=i.defineProtocol("ISnapLinesModel",{getAll:"() -> Array<AlignmentLine>"}),r.SnapLinesState=(n=function(e){void 0===e&&(e=null),this.snaplines=i.clone(e||[])},i.defineClass({name:"SnapLinesState",ctor:n,superName:"EditorStateMember",statics:{_implements:function(e){return"ISnapLinesModel"==e}},props:{clone:function(){return new n(this.snaplines)},getAll:function(){return this.snaplines},clear:function(){this.setAll([])},setAll:function(e){this.beforeChange(),this.snaplines=i.clone(e),this.afterChange()},diff:function(e){if(e.snaplines.length!=this.snaplines.length)return[a.EditorModelChangedMessage.CHG_SNAPLINES];for(var t=i.iter(i.range(0,this.snaplines.length,!1));!t.done;t.next()){var o=t.value;if(!e.snaplines.includes(this.snaplines[o]))return[a.EditorModelChangedMessage.CHG_SNAPLINES]}return[]}}}),n)},D89E:function(e,t,o){var n,r=t,i=o("oAGj"),a=o("1HsO"),l=o("tGKA");r.SwapModeHandleGenerator=(n=function(){this.swapTarget=null},i.defineClass({name:"SwapModeHandleGenerator",ctor:n,statics:{_implements:function(e){return"IHandleGenerator"==e}},props:{setSwapTargetForma:function(e){this.swapTarget=e},clearSwapTargetForma:function(){this.swapTarget=null},addHandles:function(e){var t=null;return null!=this.swapTarget&&(t=this.swapTarget.finalFrame),null==t?[]:[new a.BoxTransformHandles(new a.BoxReference(l.Matrix2D.Identity,t),[a.TransformType.Translate],[],a.TransformType.None,"")]}}}),n)},DjTP:function(e,t,o){var n,r,i=t,a=o("oAGj"),l=o("cZuM"),s=o("gXiO"),u=o("FNB+"),c=o("Pil/"),h=o("iCxV"),d=o("fdtz"),g=o("fNpk"),p=o("c+uM"),f=o("tGKA"),m=o("djAF"),y=o("8t9B"),v=o("ThKb"),S=o("oKlP"),C=o("sIWg"),T=o("1NAc"),A=o("zjY7");i.SpringConstraint=(n=function(e,t,o,n,r,i,a){this.nodeA=e,this.nodeB=t,this.pinA=o,this.pinB=n,this.vertical=r,this.length=i,this.stiffness=a,this.oldLengthDebug=0,this.oldStiffnessDebug=0,this.proportional=!1},a.defineClass({name:"SpringConstraint",ctor:n}),n),i.SpringLayoutController=(r=function(e){this.parentNode_=null,this.springConstraints_={},this.debugPrint_=!1,this.STRONG_STIFF=9e4,this.STRUT_STIFF=9e7,this.ITERATION_STEP_SIZE=50,this.SPACER_UPDATE_THRESHOLD=50,this.LOGISTIC_L_SCALE=1e3,this.LOGISTIC_K_SCALE=.01,this.LOGISTIC_X_SCALE=100,this.LOGISTIC_B_SCALE=1,this.SPACER_LOGISTIC_L=.5,this.SPACER_LOGISTIC_K=1,this.SPACER_LOGISTIC_X=0,this.SPACER_LOGISTIC_B=10,this.NODE_LOGISTIC_L=1,this.NODE_LOGISTIC_K=.5,this.NODE_LOGISTIC_X=0,this.NODE_LOGISTIC_B=1,this.group_=e,s.CoreObject.call(this)},a.defineClass({name:"SpringLayoutController",ctor:r,superName:"CoreObject",statics:{_implements:function(e){return"ResizeLayoutController"==e}},props:{beginUpdateGroup:function(){if(this.oldBounds_=this.group_.bounds,null!=this.oldBounds_){var e=a.clone(this.group_.filterWithCallback((function(e){return null!=e.controller&&!e.isGridCell()&&e.kind!=d.ImageForma.KIND&&e.frame.area>1}),u.FormaTraversal.JustChildren));this.parentNode_=new A.VisualStructureDetector(e,this.group_).inferVisualStructure();for(var t=a.iter(this.group_.filterWithCallback((function(e){return e.isTypeLockup()})));!t.done;t.next()){var o,n=t.value;(o=a.as(n.controller,y.TypeLockupController))&&o.addLineBreakConstraints()}}},endUpdateGroup:function(){for(var e=a.iter(this.group_.filterWithCallback((function(e){return e.isTypeLockup()})));!e.done;e.next()){var t,o=e.value;(t=a.as(o.controller,y.TypeLockupController))&&t.removeLineBreakConstraints()}},updateGroup:function(){var e,t,o;(e=this.oldBounds_)&&(t=this.group_.bounds)&&(o=this.solveSpringSystem(e,t))&&this.updateFormaFromStructure(o)},solveSpringSystem:function(e,t){if(null==this.parentNode_)return null;var o={};o[this.parentNode_.id]=this.parentNode_;for(var n=a.iter(this.parentNode_.descendents);!n.done;n.next()){var r=n.value;o[r.id]=r}var i=this.parentNode_.clone();this.createSpringConstraints(i),this.updateAllConstraints(i,!1);var l=[i];a.append(l,i.descendents);for(var s=a.clone(this.getForegroundLeafs(i)),u=i.frame.scaleXY(t.width/e.width,t.height/e.height,S.TheoPoint.ZERO),c=a.toInt(Math.ceil(Math.max(Math.abs(u.height-i.frame.height),Math.abs(u.width-i.frame.width))/this.ITERATION_STEP_SIZE)+1),h=a.iter(a.range(0,c,!1));!h.done;h.next()){var d=h.value;this.debugPrint_&&(a.info("\n-----------------\niteration: "+d+"\n"),this.printNodes(i),a.info("\n")),i.frame=u;for(var p=d>=c-1,f=a.iter(l);!f.done;f.next()){var m,y,v,T=f.value;if((m=T.frame)&&(y=a.as(T,A.VisualNodeGroup))&&(v=this.springConstraints_[y.id])){g.LegacyCoreAssert.isTrue(null!=o[T.origNode.id],"did not find node in original node map",void 0,"SpringLayoutController.solveSpringSystem","SpringLayoutController.swift",188),this.debugPrint_&&a.info("node:"+T.description+" oldFrame: "+o[T.origNode.id].frame.asIntString);for(var F=a.iter(v);!F.done;F.next()){var k=F.value,L=k[0].vertical,b=L?m.height:m.width,_=L?y.frame.minY:y.frame.minX,R=this.adjustSpringSet(k,b,_,p,i);y.frame=L?new C.TheoRect(m.minX,m.minY,m.maxX,m.minY+R):new C.TheoRect(m.minX,m.minY,m.minX+R,m.maxY),this.setSpringStiffnesses(y,k,s,this.debugPrint_),this.adjustSpringsToMatchOldSize(k,o)&&this.setSpringStiffnesses(y,k,s)}}}}return this.debugPrint_&&(a.info("\n -----------------------------\n  after resize: "),this.printNodes(i)),i},adjustSpringSet:function(e,t,o,n,r){if(e.length<1)return 0;for(var i=e[0].vertical,l=0,s=0,u=a.iter(e);!u.done;u.next())l+=(v=u.value).length,s+=1/((v.proportional?1:v.stiffness)*(t/v.length));var c=t-l,d=1/s,g=c;Math.abs(c)>this.ITERATION_STEP_SIZE&&!n&&(g=c<0?-1*this.ITERATION_STEP_SIZE:this.ITERATION_STEP_SIZE);var p=d*g;this.debugPrint_&&a.info("  constraint set: "+(i?"vert":"horiz")+"  desiredL "+Math.round(t)+" currL "+Math.round(l)+" totalD "+Math.round(c)+"  currD "+Math.round(g));for(var m=0,y=a.iter(a.range(0,e.length,!1));!y.done;y.next()){var v,S=y.value;(v=e[S]).oldLengthDebug=v.length,v.oldStiffnessDebug=v.stiffness;var T=p/((v.proportional?1:v.stiffness)*(t/v.length));isNaN(T)&&(a.opt(h.Host.logging,(function(e){return e.error("nan update")})),T=0);var A=Math.max(.01,v.length+T);if(v.nodeA==v.nodeB){var F=v.nodeA,k=F.frame.aspectRatio,L=o+m;if(F.frame=i?new C.TheoRect(F.frame.minX,L,F.frame.maxX,L+A):new C.TheoRect(L,F.frame.minY,L+A,F.frame.maxY),F.maintainAspectRatio&&!v.proportional&&F.parent!=r){var b=C.TheoRect.fromSize(F.frame.fitAspectRatioWithin(k));if(b.height>15){var _=this.getParentChildPin(F.frame,F.parent.frame),R=f.Matrix2D.translation(F.frame.eval(_).subtract(b.eval(_)));b=b.transform(R);var I=i?F.frame.height-b.height:F.frame.width-b.width;F.frame=b;var w=v.vertical?_.y:_.x;.5==w?(e[S-1].length+=I/2,e[S+1].length+=I/2):0==w?e[S+1].length+=I:1==w&&(e[S-1].length+=I),A=i?b.height:b.width}}}v.length=A,m+=A}return m},adjustSpringsToMatchOldSize:function(e,t){for(var o=!1,n=a.iter(a.range(1,e.length-1,!1));!n.done;n.next()){var r=n.value,i=e[r];if(i.nodeA==i.nodeB&&!i.proportional){var l=i.nodeA,s=t[l.origNode.id].frame,u=l.frame;if(s.area-u.area>0){var c=e[r-1],h=e[r+1],d=.2*Math.max(c.length,h.length);if(d<10)continue;var g=i.vertical?u.height:u.width,p=s.area/(i.vertical?u.width:u.height)-g;Math.abs(p)>d&&(p=p<0?-1*d:d);var f=1/(1/c.stiffness+1/i.stiffness+1/h.stiffness)*p,m=f/c.stiffness,y=c.length;c.length-m>this.SPACER_UPDATE_THRESHOLD&&(c.length=Math.max(1e-4,c.length-m));var v=f/h.stiffness,S=h.length;h.length-v>this.SPACER_UPDATE_THRESHOLD&&(h.length=Math.max(1e-4,h.length-v));var C=i.length;i.length=i.length+(y-c.length)+(S-h.length),o=o||Math.abs(C-i.length)>0}}}return o},createSpringConstraints:function(e){this.springConstraints_={};for(var t=a.clone(this.getForegroundLeafs(e)),o=[e];o.length>0;){var n,r=o[0];o.splice(0,1),(n=a.as(r,A.VisualNodeGroup))&&(this.springConstraints_[n.id]=this.createSpringConstraintsForGroup(n,!1,t).concat(this.createSpringConstraintsForGroup(n,!0,t)),o=n.children.concat(o))}},updateAllConstraints:function(e,t){void 0===e&&(e=null),void 0===t&&(t=!1);for(var o=null!=e?e:this.parentNode_,n=[o],r=a.clone(this.getForegroundLeafs(o));n.length>0;){var i,l,s=n[0];if(n.splice(0,1),(i=a.as(s,A.VisualNodeGroup))&&(l=this.springConstraints_[i.id])){for(var u=a.iter(l);!u.done;u.next()){var c=u.value;this.setSpringStiffnesses(i,c,r,t)}n=i.children.concat(n)}}},printNodes:function(e){for(var t=[e],o=[];t.length>0;){var n,r=t[0];if(t.splice(0,1),(v=a.as(r,A.VisualNodeGroup))&&(n=this.springConstraints_[v.id])){for(var i=a.iter(n);!i.done;i.next())for(var l=i.value,s=a.iter(l);!s.done;s.next()){var u=s.value;if(u.nodeA==u.nodeB){var c=this.getNodeStiffness(u.nodeA,u.vertical);o.push({node:u.nodeA,vertical:u.vertical,stiffness:c})}}t=v.children.concat(t)}}for(var h=[],d={},g=a.iter(o);!g.done;g.next())if(c=g.value,!h.includes(c.node)){for(var p="",f=(r=c.node).parent;null!=f;)f=a.opt(f,(function(e){return e.parent})),p+="\t";p+="node: "+r.description;for(var m=a.iter(o);!m.done;m.next()){var y=m.value;y.node==r&&(p+=(y.vertical?" v: ":" h: ")+a.toString(Math.round(y.stiffness)))}d[r.shortID]=p,h.push(r)}for(t=[e];t.length>0;){var v,S;r=t[0],t.splice(0,1),(v=a.as(r,A.VisualNodeGroup))&&(t=v.children.concat(t)),this.debugPrint_&&null!=(S=d[r.shortID])&&a.info(S)}},setConstraintsOnNode:function(e,t,o,n,r){var i,l=r?e.frame.minY:e.frame.minX,s=(r?e.frame.maxY:e.frame.maxX)-l,u=r?t.frame.minY:t.frame.minX,c=(r?t.frame.maxY:t.frame.maxX)-u,h=!1,d=!1,g=!1;o<.1*s&&(h=!0),n<.1*s&&(d=!0),(i=a.as(t,A.VisualNodeLeaf))&&(i.forma.isTypeLockup()?c>.66*s&&(h=!0,d=!0):Math.abs(o-n)<=1&&o<.25*s&&(h=!0,d=!0)),h&&d||(g=!0),r?(t.constraintBottom=h,t.constraintTop=d,t.constraintHeight=g):(t.constraintLeft=h,t.constraintRight=d,t.constraintWidth=g)},getContextualSpacerLength:function(e,t,o){var n,r=e.vertical,i=e.nodeA==t?e.nodeB:e.nodeA,l=e.length,s=!1,u=[];null!=(d=a.as(i,A.VisualNodeLeaf))&&(s=d.hasForegroundRole,u=[d]),(n=a.as(i,A.VisualNodeGroup))&&(s=(u=a.clone(this.getForegroundLeafs(n))).length>0);for(var c=o.concat(),h=a.iter(u);!h.done;h.next()){var d=h.value;c.includes(d)&&a.remove(c,d)}if(s){var p=C.TheoRect.Zero;if(r){var f=e.nodeA.frame.horizontalLine(e.pinA).p1.y,m=e.nodeB.frame.horizontalLine(e.pinB).p1.y;p=new C.TheoRect(i.frame.minX,f,i.frame.maxX,m)}else{var y=e.nodeA.frame.verticalLine(e.pinA).p1.x,v=e.nodeB.frame.verticalLine(e.pinB).p1.x;p=new C.TheoRect(y,i.frame.minY,v,i.frame.maxY)}for(var S=a.iter(c);!S.done;S.next()){d=S.value,g.LegacyCoreAssert.isTrue(i!=d,"did not expect to find constraint node in leaves being checked",void 0,"SpringLayoutController.getContextualSpacerLength","SpringLayoutController.swift",691);for(var T,F=!1,k=a.iter(u);!k.done;k.next()){var L=k.value;(d.forma.finalFrame.xDistance(L.forma.finalFrame)<=0&&!r||d.forma.finalFrame.yDistance(L.forma.finalFrame)<=0&&r)&&(F=!0)}F||(T=a.opt(d.frame,(function(e){return e.intersectionWith(p)})))&&(l=Math.min(l,T.L1Distance(i.frame)))}}return l},setSpringStiffnesses:function(e,t,o,n){if(void 0===n&&(n=!1),0!=t.length){var r=t[0].vertical,i=r?e.frame.minY:e.frame.minX,l=(r?e.frame.maxY:e.frame.maxX)-i;if(3==t.length){g.LegacyCoreAssert.isTrue(t[1].nodeA==t[1].nodeB,"for basic parent constraint, nodeA and nodeB should match",void 0,"SpringLayoutController.setSpringStiffnesses","SpringLayoutController.swift",729);var s=t[1].nodeA,u=this.getContextualSpacerLength(t[0],e,o),c=this.getContextualSpacerLength(t[2],e,o);s.resetConstraints(r),s instanceof A.VisualNodeLeaf&&this.setConstraintsOnNode(e,s,u,c,r);var d=r?s.constraintBottom:s.constraintLeft,p=r?s.constraintHeight:s.constraintWidth,f=r?s.constraintTop:s.constraintRight;t[0].stiffness=d?this.STRONG_STIFF:this.getSpacerStiffness(u,l,r),t[1].stiffness=p?this.STRONG_STIFF:this.getNodeStiffness(s,r),t[2].stiffness=f?this.STRONG_STIFF:this.getSpacerStiffness(c,l,r),(0==t[0].stiffness||isNaN(t[0].stiffness)||0==t[1].stiffness||isNaN(t[1].stiffness)||0==t[2].stiffness||isNaN(t[2].stiffness))&&a.opt(h.Host.logging,(function(e){return e.error("error in spring stiffness")}))}else for(var m=a.iter(t);!m.done;m.next())(C=m.value).nodeA==C.nodeB?C.stiffness=this.getNodeStiffness(C.nodeA,C.vertical):C.stiffness=this.getSpacerStiffness(C.length,l,C.vertical),(0==C.stiffness||isNaN(C.stiffness))&&a.opt(h.Host.logging,(function(e){return e.error("error in spring stiffness")}));for(var y=a.iter(t);!y.done;y.next())(C=y.value).length<1&&(C.stiffness=this.STRUT_STIFF);for(var v=!1,S=a.iter(t);!S.done;S.next()){var C=S.value;Math.abs(C.oldLengthDebug-C.length)>1&&(v=n)}if(v)for(var T=a.iter(t);!T.done;T.next()){var F=T.value,k=F.vertical?"vert":"horiz";a.info("\t A:"+F.nodeA.shortID+" B:"+F.nodeB.shortID+" "+k+" oldK:"+Math.round(F.oldStiffnessDebug)+"  newK:"+Math.round(F.stiffness)+" oldL:"+Math.round(F.oldLengthDebug)+"  newL:"+Math.round(F.length)+"  ")}}},createFlowSpringConstraints:function(e,t){g.LegacyCoreAssert.isTrue(e.children.length>1,"visual node group must have at least one child",void 0,"SpringLayoutController.createFlowSpringConstraints","SpringLayoutController.swift",815);var o=t?e.frame.minY:e.frame.minX,n=t?e.frame.maxY:e.frame.maxX,r=n-o,l=a.sort(e.children,(function(e,o){return t?e.frame.minY<o.frame.minY:e.frame.minX<o.frame.minX})),s=[],u=t?l[0].frame.minY:l[0].frame.minX,c=(T=t?l[l.length-1].frame.maxY:l[l.length-1].frame.maxX)-u,h=Math.max(u-o,0),d=Math.max(n-T,0),p=Math.max(o-u,0)/c,f=Math.max(T-n,0)/c;s.push(new i.SpringConstraint(e,l[0],0,p,t,h,this.getSpacerStiffness(h,r,t)));for(var m=!1,y=a.iter(a.range(0,l.length,!1));!y.done;y.next()){var v=y.value;m=m||l[v].bgConstraint;var S=t?l[v].frame.minY:l[v].frame.minX,C=t?l[v].frame.maxY:l[v].frame.maxX;if(s.push(new i.SpringConstraint(l[v],l[v],0,1,t,C-S,this.getNodeStiffness(l[v],t))),v<l.length-1){var T=t?l[v].frame.maxY:l[v].frame.maxX,A=t?l[v+1].frame.minY:l[v+1].frame.minX,F=Math.abs(T-A);s.push(new i.SpringConstraint(l[v],l[v+1],1,0,t,F,this.getSpacerStiffness(F,r,t)))}}s.push(new i.SpringConstraint(l[l.length-1],e,f,1,t,d,this.getSpacerStiffness(d,r,t)));for(var k=a.iter(s);!k.done;k.next())k.value.proportional=m;for(var L=0,b=a.iter(s);!b.done;b.next())L+=b.value.length;return Math.abs(r-L)>1&&g.LegacyCoreAssert.fail("constraint length failure",void 0,"SpringLayoutController.createFlowSpringConstraints","SpringLayoutController.swift",883),s},createParentSpringConstraints:function(e,t,o,n){var r=o?e.frame.minY:e.frame.minX,l=o?e.frame.maxY:e.frame.maxX,s=o?t.frame.minY:t.frame.minX,u=o?t.frame.maxY:t.frame.maxX,c=[],h=Math.max(s-r,0),d=Math.max(l-u,0),g=Math.abs(h-d)/(l-r);if(g<.05&&g>0){var p=(h+d)/2;h=p,d=p}c.push(new i.SpringConstraint(e,t,0,0,o,h,1)),c.push(new i.SpringConstraint(t,t,0,1,o,u-s,1)),c.push(new i.SpringConstraint(t,e,1,1,o,d,1));for(var f=a.iter(c);!f.done;f.next())f.value.proportional=t.bgConstraint;return this.setSpringStiffnesses(e,c,n),c},createSpringConstraintsForGroup:function(e,t,o){if(e.layoutStrategy==A.GroupLayoutStrategy.VerticalFlow&&t||e.layoutStrategy==A.GroupLayoutStrategy.HorizontalFlow&&!t)return[this.createFlowSpringConstraints(e,t)];for(var n=[],r=a.iter(e.children);!r.done;r.next()){var i=r.value;n.push(this.createParentSpringConstraints(e,i,t,o))}return n},getNodeStiffness:function(e,t){if((t?e.frame.height:e.frame.width)<10)return 1e6;var o,n,r=1;if(o=a.as(e,A.VisualNodeLeaf)){var i,l,s=e.frame;if((i=a.as(o.forma.controller,y.TypeLockupController))&&(l=o.forma.finalFrame)){var u=i.getAverageFontSize(),c=a.toDouble(i.numLines())/(a.toDouble(i.text.split("\n").length)+1e-4),h=l.height/c,d=l.width*c,g=new T.TheoSize(d,h).aspectRatio,p=l.aspectRatio,f=s.fitAspectRatioWithin(g).area,m=s.fitAspectRatioWithin(p).area,v=Math.max(f,m)/l.area;r=this.getFormaStiffness(u*v)}else r=this.getFormaStiffness(s.height)}else if(n=a.as(e,A.VisualNodeGroup)){var S;if(S=this.springConstraints_[n.id]){for(var C=0,F=a.iter(S);!F.done;F.next()){var k=F.value;if(k[0].vertical==t){for(var L=1,b=1,_=a.iter(k);!_.done;_.next()){var R=_.value,I=R.nodeA==R.nodeB?this.getNodeStiffness(R.nodeA,t):R.stiffness;I<this.STRONG_STIFF&&(L+=R.length*I,b+=R.length)}C=Math.max(C,L/a.toDouble(b))}}r=0==C?1:C}}return r},getParentChildPin:function(e,t){var o=.5,n=.5;return Math.abs(e.minX-t.minX)/t.width<.1&&(o=0),Math.abs(e.maxX-t.maxX)/t.width<.1&&(o=1),Math.abs(e.center.x-t.center.x)/t.width<.1&&(o=.5),Math.abs(e.minY-t.minY)/t.height<.1&&(n=0),Math.abs(e.maxY-t.maxY)/t.height<.1&&(n=1),Math.abs(e.center.y-t.center.y)/t.height<.1&&(n=.5),new S.TheoPoint(o,n)},updateFormaFromStructure:function(e){for(var t=[],o=a.clone(e.leafDescendents),n=a.iter(o);!n.done;n.next()){var r=n.value;t.push(r.forma)}for(var i={},s=a.iter(o);!s.done;s.next()){(r=s.value).inferenceData=A.VisualNodeData.init_ff0a(r,t);for(var u=a.iter(o);!u.done;u.next()){var h,d=u.value;r!=d&&(ae=r.forma.finalFrame)&&(h=d.forma.finalFrame)&&(i[r.forma.formaID+d.forma.formaID]=ae.intersects(h),i[d.forma.formaID+r.forma.formaID]=ae.intersects(h))}}for(var g=a.iter(e.descendents);!g.done;g.next()){var v,C,T,F=g.value;if((r=a.as(F,A.VisualNodeLeaf))&&(V=r.frame)&&(v=r.forma.frame)&&(C=r.initFrame)&&(T=r.parent)){var k=r.forma,L=V,b=!1;(M=a.as(r.forma.controller,y.TypeLockupController))&&1==M.numLines()&&p.LockupStyle.layoutSupportsAlignments(M.lockupStyle.layout)&&(b=!0);var _,R,I=k.placement.transformValues,w=Math.abs(I.rotCosine)/(Math.abs(I.rotCosine)+Math.abs(I.rotSine)),D=Math.abs(I.rotSine)/(Math.abs(I.rotCosine)+Math.abs(I.rotSine)),x=new S.TheoPoint(L.width/C.width,L.height/C.height),P=new S.TheoPoint(x.x*w+x.y*D,x.x*D+x.y*w);if(null!=k.controller&&k.controller.maintainAspectRatio){var E=Math.min(P.x,P.y);_=a.opt(k.bounds,(function(e){return e.scaleXY(E,E,new S.TheoPoint(0,0))}))}else _=a.opt(k.bounds,(function(e){return e.scaleXY(P.x,P.y,new S.TheoPoint(0,0))}));(R=a.as(k,m.ShapeForma))?a.opt(R.controller,(function(e){return e.onEvent(new c.FormaResizeEvent(R,a.opt(_,(function(e){return e.size})),new S.TheoPoint(0,0)))})):k.bounds=_,(M=a.as(r.forma.controller,y.TypeLockupController))&&M.snapSizeToBounds();var M,N=.5,G=.5,B=L.center.x,O=L.center.y,U=T.layoutStrategy==A.GroupLayoutStrategy.VerticalFlow&&1==T.alignments.length&&T.alignments.includes(l.AlignmentType.Left),H=T.layoutStrategy==A.GroupLayoutStrategy.VerticalFlow&&1==T.alignments.length&&T.alignments.includes(l.AlignmentType.Right);if(!(Math.abs(C.center.x-v.center.x)/C.width<.01)){var z=C.minX-v.minX,Y=v.maxX-C.maxX;U=U||z>0&&Y<=0,H=H||Y>0&&z<=0}U?(N=(C.minX-v.minX)/v.width,B=L.minX):H&&(N=1-(v.maxX-C.maxX)/v.width,B=L.maxX),b&&(M=a.as(r.forma.controller,y.TypeLockupController))&&(M.beginBlockedUpdate(),a.opt(M.lockupStyle,(function(e){return e.layout=p.LockupLayout.Standard})),M.lockupStyle.alignment=U?p.LockupAlignment.Left:H?p.LockupAlignment.Right:p.LockupAlignment.Center,M.endBlockedUpdate(),M.styleChanged()),C.minY-v.minY>0&&(G=(C.minY-v.minY)/v.height,O=L.minY),v.maxY-C.maxY>0&&(G=1-(v.maxY-C.maxY)/v.height,O=L.maxY),k.movePinToPoint(new S.TheoPoint(N,G),new S.TheoPoint(B,O))}}for(var W=a.iter(e.descendents);!W.done;W.next()){var V;if(F=W.value,(r=a.as(F,A.VisualNodeLeaf))&&(V=r.forma.frame)){var K,X=null,j=1/0,q=null,Z=null,J=1/0,Q=null;if(K=a.opt(r.inferenceData,(function(e){return e.alignments})))for(var $=a.iter(o);!$.done;$.next()){var ee;if(ee=K[(de=$.value).forma.formaID])for(var te=de.forma.frame,oe=a.iter(ee);!oe.done;oe.next()){var ne=oe.value,re=null;ne.line.type==l.AlignmentType.Right&&(re=Math.abs(te.maxX-V.maxX)+.1*te.L1Distance(V)),ne.line.type==l.AlignmentType.Left&&(re=Math.abs(te.minX-V.minX)+.1*te.L1Distance(V)),ne.line.type==l.AlignmentType.CenterX&&(re=Math.abs(te.center.x-V.center.x)+.1*te.L1Distance(V)),null!=re&&re<j&&ne.line.line.length<600&&(j=re,q=ne.line.type,X=te);var ie=null;ne.line.type==l.AlignmentType.Top&&(ie=Math.abs(te.minY-V.minY)+.1*te.L1Distance(V)),ne.line.type==l.AlignmentType.Bottom&&(ie=Math.abs(te.maxY-V.maxY)+.1*te.L1Distance(V)),ne.line.type==l.AlignmentType.CenterY&&(ie=Math.abs(te.center.y-V.center.y)+.1*te.L1Distance(V)),null!=ie&&ie<J&&ne.line.line.length<600&&(J=ie,Q=ne.line.type,Z=te)}}var ae,le,se=0,ue=0;if(null!=q&&q==l.AlignmentType.CenterX&&(se=X.center.x-r.forma.frame.center.x),null!=q&&q==l.AlignmentType.Left&&(se=X.minX-r.forma.frame.minX),null!=q&&q==l.AlignmentType.Right&&(se=X.maxX-r.forma.frame.maxX),null!=Q&&Q==l.AlignmentType.CenterY&&(ue=Z.center.y-r.forma.frame.center.y),null!=Q&&Q==l.AlignmentType.Bottom&&(ue=Z.maxY-r.forma.frame.maxY),null!=Q&&Q==l.AlignmentType.Top&&(ue=Z.minY-r.forma.frame.minY),se=Math.min(se,0),ue=Math.min(ue,0),(se<0||ue<0)&&(null!=q&&r.forma.controller.setAlignmentType(q),r.forma.move(f.Matrix2D.translationXY(se,ue)),(ae=r.forma.finalFrame)&&(le=a.opt(r.forma.parent,(function(e){return e.finalFrame}))))){for(var ce=!1,he=a.iter(o);!he.done;he.next()){var de;(de=he.value)!=r&&de.forma.finalFrame.intersects(ae)&&!i[r.forma.formaID+de.forma.formaID]&&(ce=!0)}le.contains(ae)&&!ce||r.forma.move(f.Matrix2D.translationXY(-se,-ue))}}}this.debugPrint_&&a.info("after update: \n "+this.group_.print())},getSpacerStiffness:function(e,t,o){if(e<1)return this.STRUT_STIFF;var n=this.SPACER_LOGISTIC_L*this.LOGISTIC_L_SCALE,r=this.SPACER_LOGISTIC_K*this.LOGISTIC_K_SCALE,i=this.SPACER_LOGISTIC_X*this.LOGISTIC_X_SCALE,a=this.SPACER_LOGISTIC_B*this.LOGISTIC_B_SCALE;return n/(1+Math.pow(v.TheoMatrix.E_DOUBLE,r*(e-i)))+a},getFormaStiffness:function(e){var t=this.NODE_LOGISTIC_L*this.LOGISTIC_L_SCALE,o=this.NODE_LOGISTIC_K*this.LOGISTIC_K_SCALE,n=this.NODE_LOGISTIC_X*this.LOGISTIC_X_SCALE,r=this.NODE_LOGISTIC_B*this.LOGISTIC_B_SCALE;return t/(1+Math.pow(v.TheoMatrix.E_DOUBLE,o*(e-n)))+r},getForegroundLeafs:function(e){for(var t=[],o=a.iter(e.leafDescendents);!o.done;o.next()){var n=o.value;n.hasForegroundRole&&t.push(n)}return t}}}),r)},Dq5S:function(e,t,o){var n,r,i=t,a=o("oAGj"),l=o("lmwz"),s=o("fNpk"),u=o("8t9B");i.ItemContentType=a.defineEnum("ItemContentType",{Image:0,Floating:1}),i.TextInfo=(n=function(){},a.defineClass({name:"TextInfo",ctor:n,props:{init_91e2:function(e,t,o){this.textLength=e,this.font=t,this.backingShape=o},init_implicit:function(e,t,o){this.textLength=e,this.font=t,this.backingShape=o},clone:function(){return n.init_implicit(this.textLength,this.font,this.backingShape)}}}),n),i.LayoutItem=(r=function(){this.aspectRatios_=null,this.importance_=null,this.focus_=null},a.defineClass({name:"LayoutItem",ctor:r,props:{init_b14a:function(e){this.id_=e.formaID,this.forma_=e;var t,o,n=this.forma_.controller.floating,r=l.ImageFacade.getImageFormaForForma(e);if(n||null==r){if(s.LegacyCoreAssert.isTrue(this.forma_.controller.floating,"Layout item does not support non-floating formae other than background images",void 0,"LayoutItem.init","LayoutItem.swift",66),this.type_=i.ItemContentType.Floating,t=a.as(e.controller,u.TypeLockupController)){var c=t.text.length,h=a.opt(a.opt(t.lockupStyle,(function(e){return e.font})),(function(e){return e.fontData.postScriptName})),d=a.opt(t.lockupStyle,(function(e){return e.backingShapeID}));this.textInfo_=a.clone(i.TextInfo.init_91e2(c,h,d))}}else this.type_=i.ItemContentType.Image,(o=r.contentNode)&&(this.width_=a.toDouble(o.pixelWidth),this.height_=a.toDouble(o.pixelHeight),this.focus_=o.focusRegion)},init_e2cb:function(e,t,o,n,r,i,l){void 0===i&&(i=null),void 0===l&&(l=null),this.id_=e,this.type_=t,this.width_=o,this.height_=n,this.textInfo_=a.clone(r),this.aspectRatios_=a.clone(i),this.importance_=l,this.forma_=null},id:{get:function(){return this.id_}},forma:{get:function(){return this.forma_}},type:{get:function(){return this.type_}},width:{get:function(){return this.width_}},height:{get:function(){return this.height_}},textInfo:{get:function(){return this.textInfo_}},focusRegion:{get:function(){return this.focus_}},aspectRatios:{get:function(){return this.aspectRatios_},set:function(e){this.aspectRatios_=a.clone(e)}},importance:{get:function(){return this.importance_},set:function(e){this.importance_=e}}}}),r)},Dz6V:function(e,t,o){var n,r,i,a=t,l=o("oAGj"),s=o("7siz");a.IActionFeedbackModel=l.defineProtocol("IActionFeedbackModel",{getActionFeedback:"() -> ActionFeedback"}),a.ActionFeedbackWaitingType=l.defineEnum("ActionFeedbackWaitingType",{None:0,Loading:1}),a.ActionFeedbackMessageType=l.defineEnum("ActionFeedbackMessageType",{None:0,Error:1,Info:2}),a.ActionFeedback=(n=function(e,t,o,n){void 0===t&&(t=a.ActionFeedbackWaitingType.None),void 0===o&&(o=a.ActionFeedbackMessageType.None),void 0===n&&(n=null),this.actionType=e,this.showWaiting=t,this.messageType=o,this.message=n},r={},l.defineClass({name:"ActionFeedback",ctor:n,superName:"CoreObject",statics:{NONE:{get:function(){return void 0===r.NONE&&(r.NONE=new n(null,a.ActionFeedbackWaitingType.None,a.ActionFeedbackMessageType.None,null)),r.NONE}}},props:{equals:function(e){var t;return!!(t=e)&&this.actionType==t.actionType&&this.showWaiting==t.showWaiting&&this.messageType==t.messageType&&(null==this.message&&null==t.message||null!=this.message&&this.message.equals(t.message))}}}),n),a.ActionFeedbackState=(i=function(e){void 0===e&&(e=a.ActionFeedback.NONE),this.feedback=e},l.defineClass({name:"ActionFeedbackState",ctor:i,superName:"EditorStateMember",statics:{_implements:function(e){return"IActionFeedbackModel"==e}},props:{clone:function(){return new i(this.feedback)},getActionFeedback:function(){return this.feedback},setActionFeedback:function(e){this.beforeChange(),this.feedback=e,this.afterChange()},diff:function(e){return this.feedback.equals(e.feedback)?[]:[s.EditorModelChangedMessage.CHG_ACTION_FEEDBACK_STATE]}}}),i)},EDIN:function(e,t,o){var n,r=t,i=o("oAGj"),a=o("ascj"),l=o("JgVS"),s=o("cEEQ"),u=o("c+uM"),c=o("8t9B");r.NoDecorationStrategy=(n=function(){l.BaseDecorationStrategy.call(this)},i.defineClass({name:"NoDecorationStrategy",ctor:n,superName:"BaseDecorationStrategy",statics:{_implements:function(e){return"LockupDecorationStrategy"==e}},props:{supportsConfiguration:function(e){return e.style.backing==u.LockupBacking.None},decorate:function(e,t){var o,n=e.style,r=!1;if((o=e.style.characterStyles[c.TypeLockupController.HIGHLIGHT_STYLE])&&(r=o.textLook==u.LockupTextLook.FillAndOutline2),n.textLook!=u.LockupTextLook.FillAndOutline2&&!r)return new l.DecorationResults([]);for(var h=[],d=i.iter(i.range(0,t.items.length,!1));!d.done;d.next()){var g=d.value,p=t.items[g];if(p.type==s.LockupItemType.Text){var f,m,y=n.textLook==u.LockupTextLook.FillAndOutline2;null!=(f=p.characterStyle)&&(m=e.style.characterStyles[f])&&(y=m.textLook==u.LockupTextLook.FillAndOutline2||m.textLook==u.LockupTextLook.UNSET&&y),y&&((p=p.clone()).colorRole=a.ColorRole.FieldSecondary,h.push(p))}}return new l.DecorationResults(h)}}}),n)},EGPT:function(e,t,o){var n,r,i=t,a=o("oAGj"),l=o("7siz");i.Annotation=(n=function(e,t,o){void 0===t&&(t=i.AnnotationPriority.Normal),void 0===o&&(o=null),this.priority=t,this.id=e,this.customData=a.clone(o)},a.defineClass({name:"Annotation",ctor:n,superName:"CoreObject"}),n),i.AnnotationID=a.defineEnum("AnnotationID",{TextTruncated:0,TooMuchCurvedText:1,TooMuchGridText:2,MultipleReturns:3,ImageTooBig:10}),i.AnnotationPriority=a.defineEnum("AnnotationPriority",{High:0,Normal:1}),i.IAnnotationsModel=a.defineProtocol("IAnnotationsModel",{getAll:"() -> Array<Annotation>",getFirst:"() -> Annotation"}),i.IMutableAnnotationsModel=a.defineProtocol("IMutableAnnotationsModel",{clear:"() -> Void",setAll:"(Array<Annotation>) -> Void"}),i.AnnotationState=(r=function(e){void 0===e&&(e=null),this.annotations=a.clone(e||[])},a.defineClass({name:"AnnotationState",ctor:r,superName:"EditorStateMember",statics:{concat:function(e,t){if(null==e&&null==t)return null;var o,n,r=[];return(o=e)&&a.append(r,o),(n=t)&&a.append(r,n),r},equal:function(e,t){if(e.length!=t.length)return!1;for(var o=a.clone(r.sort(e)),n=a.clone(r.sort(t)),i=a.iter(a.toSequence(o));!i.done;i.next()){var l=i.value,s=l.offset,u=l.element,c=n[s];if(u.priority!=c.priority||u.id!=c.id)return!1}return!0},sort:function(e){return a.sort(e,(function(e,t){return e.priority>t.priority||e.priority==t.priority&&e.id>t.id}))},_implements:function(e){return"IMutableAnnotationsModel"==e||"IAnnotationsModel"==e}},props:{clone:function(){return new r(this.annotations)},getAll:function(){return this.annotations},getFirst:function(){return a.first(this.annotations)},clear:function(){this.setAll([])},setAll:function(e){this.beforeChange(),this.annotations=a.clone(r.sort(e)),this.afterChange()},diff:function(e){return r.equal(this.annotations,e.annotations)?[]:[l.EditorModelChangedMessage.CHG_ANNOTATIONS]}}}),r)},ERpL:function(e,t,o){var n,r=t,i=o("oAGj"),a=o("wc1n"),l=o("cYVN"),s=o("djAF"),u=o("LGJg");r.ShapeRoleFeatures=i.defineEnum("ShapeRoleFeatures",{Area:"Area",ShapeWidth:"ShapeWidth",ShapeHeight:"ShapeHeight",CenterX:"CenterX",CenterY:"CenterY",RotCosine:"RotCosine",RotSine:"RotSine",PercentageDesignArea:"PercentageDesignArea",PercentageOutofBounds:"PercentageOutofBounds",OverlappingGraphicCount:"OverlappingGraphicCount",OverlappingTextCount:"OverlappingTextCount",PercentageTextOverlap:"PercentageTextOverlap",PercentageGraphicOverlap:"PercentageGraphicOverlap",MaskAverage:"MaskAverage",MaskAverageEdge:"MaskAverageEdge",PageHeight:"PageHeight",PageWidth:"PageWidth",ShapeCount:"ShapeCount",TextCount:"TextCount",BackgroundImageCount:"BackgroundImageCount",ForegroundImageCount:"ForegroundImageCount"}),r.ShapeRoleData=(n=function(e,t,o){l.RoleData.call(this,e,t,o)},i.defineClass({name:"ShapeRoleData",ctor:n,superName:"RoleData",statics:{getShapeRoleData:function(e){var t,o,l;if(l=i.as(e,s.ShapeForma)){var c=[r.ShapeRoleFeatures.Area,r.ShapeRoleFeatures.ShapeWidth,r.ShapeRoleFeatures.ShapeHeight,r.ShapeRoleFeatures.CenterX,r.ShapeRoleFeatures.CenterY,r.ShapeRoleFeatures.RotCosine,r.ShapeRoleFeatures.RotSine,r.ShapeRoleFeatures.PercentageDesignArea,r.ShapeRoleFeatures.PercentageOutofBounds,r.ShapeRoleFeatures.OverlappingGraphicCount,r.ShapeRoleFeatures.OverlappingTextCount,r.ShapeRoleFeatures.PercentageTextOverlap,r.ShapeRoleFeatures.PercentageGraphicOverlap,r.ShapeRoleFeatures.MaskAverage,r.ShapeRoleFeatures.MaskAverageEdge,r.ShapeRoleFeatures.PageHeight,r.ShapeRoleFeatures.PageWidth,r.ShapeRoleFeatures.ShapeCount,r.ShapeRoleFeatures.TextCount,r.ShapeRoleFeatures.BackgroundImageCount,r.ShapeRoleFeatures.ForegroundImageCount],h=a.FeatureExtractorFactory.getFeatureExtractor(a.FeatureExtractorType.Shape,l,c),d={};c.forEach((function(e){d[e]=(t=h.numericFeatureForKey(e))||null!=t?t:-1}));for(var g=i.iter(["line","heart","circle","arrow","square","instagram","rectangle","flower","star","love","triangle","food","music","party","?","birthday","sun","facebook","phone","youtube","badge"]);!g.done;g.next()){var p,f,m=g.value,y="search-"+m;c.push(y),d[y]=0,(p=i.as(l.contentNode,u.VectorContentNode))&&null!=(f=i.opt(i.opt(p.mediaMetadata,(function(e){return e.searchTerm})),(function(e){return e.toLowerCase()})))&&f==m&&(d[y]=1)}o=new n(e,c,d)}return o}}}),n)},EoOi:function(e,t,o){var n,r,i,a,l,s=t,u=o("oAGj"),c=o("SpAV"),h=o("iCxV"),d=o("fNpk"),g=o("c+uM"),p=o("3DEm"),f=o("ol4x"),m=o("8t9B"),y=o("3UhB"),v=o("7l9C"),S=o("uUew"),C=o("d2x6");s.FontMetricsParams=(n=function(e,t,o){this.font=e,this.fontSize=t,this.kerning=o},u.defineClass({name:"FontMetricsParams",ctor:n}),n),s.TypographyParams=(r=function(e,t,o){this.size_=e,this.lineSpacing_=t,this.relativeFontScale_=o},u.defineClass({name:"TypographyParams",ctor:r}),r),s.TypographyResult=(i=function(e,t,o){this.tree=e,this.tokens=u.clone(t),this.matrices=u.clone(o)},u.defineClass({name:"TypographyResult",ctor:i,statics:{isEqual:function(e,t){if(e.matrices.length==t.matrices.length){for(var o=u.iter(u.toSequence(e.matrices));!o.done;o.next()){var n=o.value,r=n.offset;if(!n.element.equal(t.matrices[r]))return!1}return!0}return!1}}}),i),s.MutableTypographyRange=(a=function(){},u.defineClass({name:"MutableTypographyRange",ctor:a,props:{init_4142:function(e,t){this.start=e,this.end=t},init_37b1:function(e){this.start=e.start,this.end=e.end}}}),a),s.TypographyLayoutCategory=u.defineEnum("TypographyLayoutCategory",{UNSET:-1,ALL:0,DropCap:1,Rotate:2,RotateFit:3,Triplet:4}),s.TypographyComposer=(l=function e(t,o){e.initializeLayouts(),f.TypographyLayout.lineSpacing=t.lineSpacing_,this.params_=t,this.words_=u.clone(o)},u.defineClass({name:"TypographyComposer",ctor:l,statics:{DEFAULT_FONT_SIZE:48,GLYPH_HSPACE_ADJUSTMENT:.1,layouts:null,alignments:null,initializeLayouts:function(){null==l.alignments&&((l.alignments=[]).push(g.LockupAlignment.Triplet),l.alignments.push(g.LockupAlignment.TripletRotatedMiddle),l.alignments.push(g.LockupAlignment.TripletRotatedMiddleMulti),l.alignments.push(g.LockupAlignment.TripletRotatedEnds),l.alignments.push(g.LockupAlignment.RotateTopStart),l.alignments.push(g.LockupAlignment.RotateBottomStart),l.alignments.push(g.LockupAlignment.RotateFullStart),l.alignments.push(g.LockupAlignment.RotateFitStart),l.alignments.push(g.LockupAlignment.RotateTopEnd),l.alignments.push(g.LockupAlignment.RotateBottomEnd),l.alignments.push(g.LockupAlignment.RotateFullEnd),l.alignments.push(g.LockupAlignment.RotateFitEnd),l.alignments.push(g.LockupAlignment.DropCapTop),l.alignments.push(g.LockupAlignment.DropCapBottom),l.alignments.push(g.LockupAlignment.DropCap),l.alignments.push(g.LockupAlignment.DropCapFit),l.alignments.push(g.LockupAlignment.RotateAndFit),l.alignments.push(g.LockupAlignment.FitRotateFit)),null==l.layouts&&((l.layouts={})[g.LockupAlignment.Left]=new f.ReflowAlignmentTypographyLayout(v.AlignmentIdiom.LLtb),l.layouts[g.LockupAlignment.Triplet]=new f.MiddleTypographyLayout(f.MiddleTypographyLayout.TRIPLET),l.layouts[g.LockupAlignment.TripletRotatedMiddle]=new f.MiddleTypographyLayout(f.MiddleTypographyLayout.TRIPLET_ROTATED_MIDDLE),l.layouts[g.LockupAlignment.TripletRotatedMiddleMulti]=new f.MiddleTypographyLayout(f.MiddleTypographyLayout.TRIPLET_ROTATED_MIDDLE_MULTI),l.layouts[g.LockupAlignment.TripletRotatedEnds]=new f.MiddleTypographyLayout(f.MiddleTypographyLayout.TRIPLET_ROTATED_ENDS),l.layouts[g.LockupAlignment.RotateFullStart]=new f.RotateTypographyLayout(f.RotateTypographyLayout.FULL_START),l.layouts[g.LockupAlignment.RotateFitStart]=new f.RotateTypographyLayout(f.RotateTypographyLayout.FIT_START),l.layouts[g.LockupAlignment.RotateTopStart]=new f.RotateTypographyLayout(f.RotateTypographyLayout.TOP_START),l.layouts[g.LockupAlignment.RotateBottomStart]=new f.RotateTypographyLayout(f.RotateTypographyLayout.BOTTOM_START),l.layouts[g.LockupAlignment.RotateFullEnd]=new f.RotateTypographyLayout(f.RotateTypographyLayout.FULL_END),l.layouts[g.LockupAlignment.RotateFitEnd]=new f.RotateTypographyLayout(f.RotateTypographyLayout.FIT_END),l.layouts[g.LockupAlignment.RotateTopEnd]=new f.RotateTypographyLayout(f.RotateTypographyLayout.TOP_END),l.layouts[g.LockupAlignment.RotateBottomEnd]=new f.RotateTypographyLayout(f.RotateTypographyLayout.BOTTOM_END),l.layouts[g.LockupAlignment.DropCap]=new f.DropCapTypographyLayout(f.DropCapTypographyLayout.FULL),l.layouts[g.LockupAlignment.DropCapFit]=new f.DropCapTypographyLayout(f.DropCapTypographyLayout.FIT),l.layouts[g.LockupAlignment.DropCapTop]=new f.DropCapTypographyLayout(f.DropCapTypographyLayout.TOP),l.layouts[g.LockupAlignment.DropCapBottom]=new f.DropCapTypographyLayout(f.DropCapTypographyLayout.BOTTOM),l.layouts[g.LockupAlignment.RotateAndFit]=new f.FitRotateFitTypographyLayout(!0),l.layouts[g.LockupAlignment.FitRotateFit]=new f.FitRotateFitTypographyLayout(!1))},getWordRuns:function(e){for(var t=[],o=null,n=-1,r=u.iter(e);!r.done;r.next()){var i=r.value;i.weight!=n&&(null!=o&&t.push(o),o=[],n=i.weight),o.push(i)}return t.push(o),t},getLayout:function(e){return null==this.layouts&&l.initializeLayouts(),u.opt(this.layouts,(function(t){return t[e]}))},getApplicableLayouts:function(e,t,o,n){void 0===t&&(t=null),void 0===o&&(o=s.TypographyLayoutCategory.ALL),void 0===n&&(n=null),l.initializeLayouts();var r=[],i=u.clone(l.getWordRanges(e,null)),a=null;null!=t&&(a=u.clone(l.calculateStyleRuns(e,i,t)));for(var c=u.iter(l.alignments);!c.done;c.next()){var h,d=c.value;(h=l.layouts[d])&&(o!=s.TypographyLayoutCategory.ALL&&h.category()!=o||null==h.calculateWeighting(e,i,a,n)||r.push(d))}return r},getCategoryForAlignment:function(e){var t;return l.initializeLayouts(),(t=l.layouts[e])?t.category():s.TypographyLayoutCategory.UNSET},supportsRelativeFontScale:function(e){return l.initializeLayouts(),l.layouts[e].supportsRelativeFontScale()},canHandleText:function(e){var t=e.trim();return!(t.length<2)&&u.clone(l.getWordRanges(t,null)).length<=20},getWeightingForAlignment:function(e,t,o,n){void 0===o&&(o=null),void 0===n&&(n=null);var r=u.clone(l.getWordRanges(t,null)),i=null;return null!=o&&(i=u.clone(l.calculateStyleRuns(t,r,o))),u.opt(l.getLayout(e),(function(e){return e.calculateWeighting(t,r,i)}))},getNextValidLayoutAlignment:function(e,t,o,n,r,i,a){var c;if(void 0===n&&(n=null),void 0===r&&(r=s.TypographyLayoutCategory.ALL),void 0===i&&(i=null),!l.canHandleText(e))return g.LockupAlignment.UNSET;if(!a&&null!=l.getWeightingForAlignment(o,e,n,i))return o;var h=u.clone(l.getApplicableLayouts(e,n,r,i));if(h.length>0){if(o!=g.LockupAlignment.UNSET&&h.length>1){var d=o,p=u.indexOf(h,d);return d=((c=p)||null!=c?c:-1)>=0?h[(p+1)%h.length]:u.first(h)}return u.first(h)}return g.LockupAlignment.UNSET},layoutTree:function(e){e.calcGlobalMatrices();for(var t=[],o=[],n=u.clone(e.getRoot().getTextNodes()),r=u.iter(n);!r.done;r.next()){var i=r.value;t.push(i.token_),o.push(i.global())}return new s.TypographyResult(e,t,o)},adjustTree:function(e,t){return l.layouts[t].adjustTree(e),l.layoutTree(e)},getDefaultRanges:function(e){var t=[];if(e.length>1){var o=u.sort(e,(function(e,t){return e.length>t.length}));t.push(o[0])}return t},getDefaultRelativeFontScale:function(e){return.5},getWordRanges:function(e,t){for(var o=[],n=0,r=-1,i=u.iter(u.range(0,e.length-1,!0));!i.done;i.next()){var a=i.value;y.TypeLockupUtils.isWhiteSpace(e.substr(a,1))?(n<=r&&o.push(new S.TextRange(n,r+1)),n=a+1):r=a}if(n<=r&&o.push(new S.TextRange(n,r+1)),null==t||0==t.length)return o;for(var l=[],c=u.iter(o);!c.done;c.next()){var h=c.value;l.push(s.MutableTypographyRange.init_37b1(h))}for(var d=u.iter(t);!d.done;d.next()){var g=d.value;l.push(s.MutableTypographyRange.init_37b1(g))}var p=u.sort(l,(function(e,t){return e.start<t.start}));for(a=1;a<p.length;)p[a].start==p[a-1].start&&p[a].end==p[a-1].end?p.splice(a,1):(p[a].start<p[a-1].end&&(p[a-1].start<p[a].start?(r=p[a-1].end,p[a-1].end=p[a].start,p[a].end<r&&p.splice(a,0,s.MutableTypographyRange.init_4142(p[a].end,r))):(r=p[a-1].end,p[a].end<r?(p[a-1].end=p[a].end,p[a].start=p[a].end,p[a].end=r):p[a].start=p[a-1].end)),a+=1);for(var f=[],m=u.iter(p);!m.done;m.next())g=m.value,f.push(new S.TextRange(g.start,g.end));return f},calculateStyleRuns:function(e,t,o){for(var n=[],r=-1,i=u.iter(u.toSequence(t));!i.done;i.next())for(var a=i.value,l=a.offset,s=a.element,c=u.iter(o);!c.done;c.next()){var h=c.value,d=h.start;y.TypeLockupUtils.isWhiteSpace(e.substr(h.start,1))&&(d+=1);var g=h.end;if(y.TypeLockupUtils.isWhiteSpace(e.substr(h.start+h.length-1,1))&&(g-=1),d<=s.start&&g>=s.end){-1==r&&(r=l);break}r>-1&&(n.push(new S.TextRange(r,l-1)),r=-1)}for(r>-1&&n.push(new S.TextRange(r,t.length-1)),l=n.length-1;l>0;)n[l].start==n[l-1].end+1&&(n[l-1]=new S.TextRange(n[l-1].start,n[l].end),n.splice(l,1)),l-=1;return n},buildTokenList:function(e,t,o,n){var r=[],i=e,a=0;c.CoreAssert.isTrue(null!=o&&o.length>0,"Invalid auto text range",void 0,"TypographyComposer.buildTokenList","TypographyComposer.swift",451);for(var d=u.clone(o),g=u.clone(l.getWordRanges(e,d)),f=new s.FontMetricsParams(n.font.fontData,l.DEFAULT_FONT_SIZE,n.tracking),y=u.iter(g);!y.done;y.next()){for(var v=y.value,C=0,T=u.iter(d);!T.done;T.next()){var A=T.value;if(v.start<A.end&&v.end-1>=A.start){C=1;break}}for(var F=e.substr(v.start,v.length).trim();a<e.length&&!i.startsWith(F);)i=i.substr(1),a+=1;var k=0;if(f.font=n.font.fontData,t.length>0)for(var L=u.iter(t);!L.done;L.next())if(A=L.value,v.start<A.end&&v.end>A.start){f.font=u.opt(u.opt(n.characterStyles[m.TypeLockupController.HIGHLIGHT_STYLE],(function(e){return e.font})),(function(e){return e.fontData}))||n.font.fontData,k=1;break}var b=h.Host.textModelUtils.calcFontMetrics(F,C,f);b.styleWeight=k,b.range=new S.TextRange(a,a+b.text.length),b.range.end<e.length&&e.substr(b.range.end,1).trim().length>0&&(b.isGlyph=!0,b.hspace*=p.MathUtils.maxDouble(l.GLYPH_HSPACE_ADJUSTMENT,f.kerning)),r.push(b),a+=b.text.length,i=i.substr(b.text.length)}return r},buildTokenListFromTree:function(e,t,o,n){void 0===o&&(o=null);for(var r=[],i=new s.FontMetricsParams(t,l.DEFAULT_FONT_SIZE,n),a=u.clone(e.getRoot().getTextNodes()),c=u.iter(a);!c.done;c.next()){var d=c.value;1==d.token_.styleWeight&&null!=o?i.font=o:i.font=t;var g=h.Host.textModelUtils.calcFontMetrics(d.token_.text,d.token_.weight,i);g.styleWeight=d.token_.styleWeight,g.range=d.token_.range,d.token_.isGlyph&&(g.isGlyph=!0,g.hspace*=p.MathUtils.maxDouble(l.GLYPH_HSPACE_ADJUSTMENT,i.kerning)),d.token_=g,r.push(g)}return r}},props:{layout:function(e){var t=C.TypographyTree.buildArchetypeTree(this.words_),o=u.clone(t.getRoot().getTextRuns()),n=l.layouts[e];return null==n&&(d.LegacyCoreAssert.isTrue(null==n,"No typography rule.",void 0,"TypographyComposer.layout","TypographyComposer.swift",289),n=l.layouts[g.LockupAlignment.Left]),n.arrangeText(t,o,this.params_),l.layoutTree(t)}}}),l)},"G/OM":function(e,t,o){var n,r,i,a,l,s,u,c=t,h=o("oAGj");c.IFeatureSet=h.defineProtocol("IFeatureSet",{key:"String",isEqualTo:"(IFeatureSet) -> Boolean"}),c.FeatureSetBase=(n=function(e){this._key=e},h.defineClass({name:"FeatureSetBase",ctor:n,superName:"CoreObject",props:{key:{get:function(){return this._key}}}}),n),c.TextFrameAttributesFeature=(r=function e(){c.FeatureSetBase.call(this,e.KEY)},h.defineClass({name:"TextFrameAttributesFeature",ctor:r,superName:"FeatureSetBase",statics:{KEY:"TextFrameAttributesFeature",_implements:function(e){return"IFeatureSet"==e}},props:{isEqualTo:function(e){return e instanceof r}}}),r),c.AlignSpacingAttributesFeature=(i=function e(t,o,n,r){this.canAlign=t,this.canDistribute=o,this.canDoRow=n,this.canDoColumn=r,c.FeatureSetBase.call(this,e.KEY)},h.defineClass({name:"AlignSpacingAttributesFeature",ctor:i,superName:"FeatureSetBase",statics:{KEY:"AlignSpacingAttributesFeature",find:function(e){return h.as(e.find(i.KEY),i)},_implements:function(e){return"IFeatureSet"==e}},props:{isEqualTo:function(e){var t;return!!(t=h.as(e,i))&&t.canAlign==this.canAlign&&t.canDistribute==this.canDistribute&&t.canDoRow==this.canDoRow&&t.canDoColumn==this.canDoColumn}}}),i),c.FormaEditFeature=(a=function e(t,o,n,r,i,a,l,s){this.canMultiselect=t,this.canDuplicate=o,this.canGroup=n,this.canUngroup=r,this.canRecolor=i,this.canDelete=a,this.canEditSettings=l,this.supportsMultiStyle=s,c.FeatureSetBase.call(this,e.KEY)},h.defineClass({name:"FormaEditFeature",ctor:a,superName:"FeatureSetBase",statics:{KEY:"FormaEditFeature",_implements:function(e){return"IFeatureSet"==e}},props:{isEqualTo:function(e){var t;return!!(t=h.as(e,a))&&t.canMultiselect==this.canMultiselect&&t.canDuplicate==this.canDuplicate&&t.canGroup==this.canGroup&&t.canUngroup==this.canUngroup&&t.canRecolor==this.canRecolor&&t.canDelete==this.canDelete&&t.canEditSettings==this.canEditSettings&&t.supportsMultiStyle==this.supportsMultiStyle}}}),a),c.OpacityAttributesFeature=(l=function e(){c.FeatureSetBase.call(this,e.KEY)},h.defineClass({name:"OpacityAttributesFeature",ctor:l,superName:"FeatureSetBase",statics:{KEY:"OpacityAttributesFeature",_implements:function(e){return"IFeatureSet"==e}},props:{isEqualTo:function(e){return e instanceof l}}}),l),c.ImageFeature=(s=function e(t,o,n,r,i,a,l,s){this.canApplyFilter=t,this.canReplace=o,this.hasLicense=n,this.canCrop=r,this.canSetBackground=i,this.canSetFloating=a,this.canApplyBackgroundColor=l,this.canApplyCutout=s,c.FeatureSetBase.call(this,e.KEY)},h.defineClass({name:"ImageFeature",ctor:s,superName:"FeatureSetBase",statics:{KEY:"ImageFeature",_implements:function(e){return"IFeatureSet"==e}},props:{isEqualTo:function(e){var t;return!!(t=h.as(e,s))&&t.canApplyFilter==this.canApplyFilter&&t.canReplace==this.canReplace&&t.hasLicense==this.hasLicense&&t.canCrop==this.canCrop&&t.canSetBackground==this.canSetBackground&&t.canSetFloating==this.canSetFloating&&t.canApplyBackgroundColor==this.canApplyBackgroundColor&&t.canApplyCutout==this.canApplyCutout}}}),s),c.VideoAttributesFeature=(u=function e(){c.FeatureSetBase.call(this,e.KEY)},h.defineClass({name:"VideoAttributesFeature",ctor:u,superName:"FeatureSetBase",statics:{KEY:"VideoAttributesFeature",_implements:function(e){return"IFeatureSet"==e}},props:{isEqualTo:function(e){return e instanceof u}}}),u)},G9CY:function(e,t,o){var n,r,i,a=t,l=o("oAGj"),s=o("Tq01"),u=o("H1Z2"),c=o("oKlP");a.IMoveHandler=l.defineProtocol("IMoveHandler",{beginMove:"(BoxReference) -> Void",updateMove:"(BoxReference, TheoPoint, Double) -> Void",endMove:"(BoxReference) -> Void"}),a.NullMoveHandler=(n=function(){},r={},l.defineClass({name:"NullMoveHandler",ctor:n,statics:{instance:{get:function(){return void 0===r.instance&&(r.instance=new n),r.instance}},_implements:function(e){return"IMoveHandler"==e}},props:{beginMove:function(e){},updateMove:function(e,t,o){},endMove:function(e){}}}),n),a.StandardMoveHandler=(i=function(e,t,o){this.formaUnderMove=null,this.lastAppliedTotalDelta=c.TheoPoint.ZERO,this.dc=e,this.model=t,this.delegate=o,this.actionScope=null},l.defineClass({name:"StandardMoveHandler",ctor:i,statics:{_implements:function(e){return"IMoveHandler"==e}},props:{beginMove:function(e){this.lastAppliedTotalDelta=c.TheoPoint.ZERO},updateMove:function(e,t,o){var n;null==this.actionScope?t.isEqual(c.TheoPoint.ZERO)||(l.opt(this.dc,(function(e){return e.undoRedoMgr.beginGesture()})),this.actionScope=l.opt(this.dc,(function(e){return e.undoRedoMgr.gestureScope})),this.formaUnderMove=l.opt(this.dc,(function(e){return e.selection.formaAt(0)})),(n=l.opt(this.formaUnderMove,(function(e){return e.controller})))&&n.userGroupChild&&!this.dc.enableMoveableChildren&&(this.formaUnderMove=l.opt(this.formaUnderMove,(function(e){return e.parent}))),this.applyMove(e,t,o)):this.applyMove(e,t,o)},endMove:function(e){var t;(t=this.model)&&(t.beginUpdates(),t.mutable.snapLines.clear(),t.updatesComplete(),null!=this.actionScope&&(l.opt(this.dc,(function(e){return e.undoRedoMgr.endGesture(!0)})),this.actionScope=null))},applyMove:function(e,t,o){var n=this,r=this.lastAppliedTotalDelta;if(!t.isEqual(this.lastAppliedTotalDelta)){var i,a=c._minus_TheoPoint_TheoPoint(t,this.lastAppliedTotalDelta);if(this.lastAppliedTotalDelta=t,i=this.formaUnderMove){var h=e.placement.transformPoint(e.bounds.center);l.opt(this.dc,(function(e){return e.doActionWithCompletion(new u.MoveHandleAction(i,a,h,o),(function(e,t){var o,i,a=[];if((o=l.as(e,s.PlacementActionResult))&&(i=o.snapResult)){var u,h,d;if((u=i.snapLines)&&(a=l.clone(u)),h=i.movement){var g=h.transformValues;n.lastAppliedTotalDelta=n.lastAppliedTotalDelta.add(new c.TheoPoint(g.tx,g.ty))}(d=n.model)&&(d.beginUpdates(),d.mutable.snapLines.setAll(a),r!=n.lastAppliedTotalDelta&&l.opt(n.delegate,(function(e){return e.handles.updateHandles(d.mutable.handles)})),d.updatesComplete())}}))}))}}}}}),i)},GFAD:function(e,t,o){var n,r=t,i=o("oAGj");r.LockupUtils=(n=function(){},i.defineClass({name:"LockupUtils",ctor:n,statics:{percentageDiff:function(e,t){return 100*Math.abs((e-t)/((e+t)/2))}}}),n)},H1Z2:function(e,t,o){var n,r,i,a,l,s=t,u=o("oAGj"),c=o("Tq01"),h=o("yGNn"),d=o("wNKJ"),g=o("Pil/"),p=o("9Lk3"),f=o("tGKA"),m=o("fAXt"),y=o("8t9B"),v=o("oKlP"),S=o("Kkml");s.DragAction=(n=function e(t,o){this.event=t,this.swapTargetForma=o,c.Action.call(this,e.TYPE)},u.defineClass({name:"DragAction",ctor:n,superName:"Action",statics:{TYPE:"DragAction"},props:{getUserAction:function(e){return null!=this.swapTargetForma?S.UserActions.SwapCells():S.UserActions.MoveItem()},execute:function(e){var t,o;if(t=u.as(this.event,g.FormaDragEvent)){if(null==this.swapTargetForma){var n=u.clone(d.DragFacade.processFormaDrag(t));return h.CorePromise.resolve(new c.DragActionResult(n))}}else if(o=u.as(this.event,g.EndFormaDragEvent)){var r,i;if(d.DragFacade.processEndFormaDrag(o),(r=this.getDraggedFormaForEvent(o))&&(i=this.swapTargetForma)){var a,l=u.clone(r.page.root.filterByControllerKind(p.GridController.KIND));a=0==!l.length?u.as(l[0].controller,p.GridController):null,u.opt(a,(function(e){return e.swapGridChildren(i,r)}))}}return h.CorePromise.resolve(null)},getDraggedFormaForEvent:function(e){var t,o;return 0==!e.dragDelegate.draggedFormae.length&&(o=u.first(e.dragDelegate.draggedFormae),((t=u.opt(o,(function(e){return e.isImage()})))||null!=t)&&t&&(o=u.opt(o,(function(e){return e.parent})))),o}}}),n),s.MoveHandleAction=(r=function e(t,o,n,r){this.forma=t,this.delta=o,this.origin=n,this.scale=r,c.Action.call(this,e.TYPE)},u.defineClass({name:"MoveHandleAction",ctor:r,superName:"Action",statics:{TYPE:"MoveHandleAction"},props:{getUserAction:function(e){return S.UserActions.MoveItem()},execute:function(e){var t=this;m.TransformFacade.transformFormaeInPageSpaceAboutPoint([this.forma],f.Matrix2D.translation(new v.TheoPoint(this.delta.x,this.delta.y)),this.origin);var o=u.opt(this.forma.controller,(function(e){return e.setSnappedPlacement(null,8/t.scale)}));return h.CorePromise.resolve(new c.PlacementActionResult(o))}}}),r),s.ResizeHandleAction=(i=function e(t,o,n,r,i){void 0===i&&(i=!1),this.forma=t,this.spotPt=o,this.anchorSpot=n,this.newBounds=r,this.inSpacingMode=i,c.Action.call(this,e.TYPE)},u.defineClass({name:"ResizeHandleAction",ctor:i,superName:"Action",statics:{TYPE:"ResizeHandleAction"},props:{getUserAction:function(e){return S.UserActions.ResizeItem()},execute:function(e){var t=this;return this.inSpacingMode&&1==this.spotPt.x&&.5==this.spotPt.y&&this.forma.controller instanceof y.TypeLockupController?this.forma.controller.recalculateTracking(this.newBounds.size):this.inSpacingMode&&.5==this.spotPt.x&&1==this.spotPt.y&&this.forma.controller instanceof y.TypeLockupController?this.forma.controller.recalculateLeading(this.newBounds.size):u.opt(this.forma.controller,(function(e){return e.onEvent(new g.FormaResizeEvent(t.forma,t.newBounds.size,t.anchorSpot))})),h.CorePromise.resolve(null)}}}),i),s.RotateHandleAction=(a=function e(t,o,n,r,i){void 0===i&&(i=!0),this.forma=t,this.deltaRadians=o,this.origin=n,this.initialPlacement=r,this.doSnapping=i,c.Action.call(this,e.TYPE)},u.defineClass({name:"RotateHandleAction",ctor:a,superName:"Action",statics:{TYPE:"RotateHandleAction"},props:{getUserAction:function(e){return S.UserActions.RotateItem()},execute:function(e){if(m.TransformFacade.transformFormaeInPageSpaceAboutPoint([this.forma],f.Matrix2D.rotation(Math.cos(this.deltaRadians),Math.sin(this.deltaRadians)),this.origin,this.initialPlacement),this.doSnapping){var t=u.opt(this.forma.controller,(function(e){return e.setSnappedPlacement(new v.TheoPoint(.5,.5),20,!0)}));return h.CorePromise.resolve(new c.PlacementActionResult(t))}return h.CorePromise.resolve(new c.PlacementActionResult(null))}}}),a),s.CharRangeHandleAction=(l=function e(t,o,n,r,i){this.forma=t,this.newPoint=o,this.lastPoint=i,this.beginForma=n,this.leftHandle=r,c.Action.call(this,e.TYPE)},u.defineClass({name:"CharRangeHandleAction",ctor:l,superName:"Action",statics:{TYPE:"CharRangeHandleAction"},props:{getUserAction:function(e){return S.UserActions.ModifyStyleRanges()},execute:function(e){var t;return(t=u.as(this.forma.controller,y.TypeLockupController))&&t.updateTouches(this.newPoint,this.beginForma,this.leftHandle,this.lastPoint),h.CorePromise.resolve(new c.FormaActionResult([this.forma]))}}}),l)},H3ZP:function(e,t,o){var n,r=t,i=o("oAGj"),a=o("Nk+Q"),l=o("UUXZ"),s=o("JzRL"),u=o("elwG"),c=o("u+mS"),h=o("25Jq"),d=o("aKgf");r.CropModeDesignController=(n=function(e,t){h.SingleSelectionDesignController.call(this,e,t),this.drag=new c.CroppingDragFacadeBasedDragHandler(e,t,this),this.click=new u.CropModeClickHandler(e),this.actionFeedback=new a.StandardActionFeedbackHandler(t),this.annotations=new l.StandardAnnotationsHandler(t),this.view=new d.StandardViewHandler(e,t),this.activePage=new s.StandardActivePageHandler(e,t)},i.defineClass({name:"CropModeDesignController",ctor:n,superName:"SingleSelectionDesignController"}),n)},H9Ol:function(e,t,o){var n,r,i,a,l=t,s=o("oAGj"),u=o("cZuM"),c=o("SpAV"),h=o("yhkb"),d=o("yGNn"),g=o("ascj"),p=o("fVJ2"),f=o("dJuF"),m=o("quOg"),y=o("wNKJ"),v=o("FNB+"),S=o("6ZWm"),C=o("waL6"),T=o("yHU1"),A=o("Pil/"),F=o("cmoc"),k=o("OdB2"),L=o("QbzR"),b=o("P83h"),_=o("9Lk3"),R=o("ZK0l"),I=o("/afT"),w=o("pnSN"),D=o("iCxV"),x=o("lmwz"),P=o("fNpk"),E=o("c+uM"),M=o("tGKA"),N=o("3DEm"),G=o("jcfx"),B=o("KIfs"),O=o("K0Rh"),U=o("JO5d"),H=o("Zifs"),z=o("djAF"),Y=o("35Q0"),W=o("umUn"),V=o("T6jX"),K=o("fAXt"),X=o("8t9B"),j=o("mL0c"),q=o("oKlP"),Z=o("sIWg"),J=o("1NAc");l.ControllerMetadata=(n=function(){},r={},s.defineClass({name:"ControllerMetadata",ctor:n,superName:"DBObject",statics:{SCHEMA_CLASS_NAME:"ControllerMetadata",codec:{get:function(){return void 0===r.codec&&(r.codec=f.DBPropertyCodec.registerCodec(n.SCHEMA_CLASS_NAME,f.DBPropertyCodec.directObjectCodec(n.SCHEMA_CLASS_NAME))),r.codec}},factory:{get:function(){return function(e,t,o,r){return n.init_866e(o,e)}}},_implements:function(e){return"IDBObject"==e}},props:{init_866e:function(e,t){s.super_init(this,p.DBObject,p.DBObject.prototype.init_866e,e,t)},init_dd5d:function(e,t){s.super_init(this,p.DBObject,p.DBObject.prototype.init_dd5d,e,t)},init_d41d:function(){s.super_init(this,p.DBObject,p.DBObject.prototype.init_dd5d,{},{})},className:{get:function(){return n.SCHEMA_CLASS_NAME}}}}),n),l.FormaController=(i=function(e,t,o){this.blockedUpdate_=0,this.controllerMetadata_=null,this.kind=e,this.forma_=t,this.owner_=o},s.defineClass({name:"FormaController",ctor:i,superName:"CoreObject",props:{owner:{get:function(){return this.owner_}},forma:{get:function(){return this.forma_}},parentController:function(){for(var e=s.opt(this.forma,(function(e){return e.parent}));null!=e&&null!=e.controller;)e=e.parent;return null==e?null:e.controller},moveable:{get:function(){return null==this.forma.allowUserMove||this.forma.allowUserMove}},floating:{get:function(){return this.moveableInDirection(new q.TheoPoint(1,0))&&this.moveableInDirection(new q.TheoPoint(0,1))}},moveableInDirection:function(e){var t;return(t=s.as(s.opt(s.opt(this.forma,(function(e){return e.parent})),(function(e){return e.controller})),R.GroupController))?t.childMoveableInDirection(this.forma,e)&&this.moveable:this.moveable},selectable:{get:function(){return!1}},rotateable:{get:function(){return this.moveable}},flippable:{get:function(){return!this.userGroupMember&&this.moveable}},nudgeable:{get:function(){return!0}},scalable:{get:function(){var e=this;return!s.opt(this.forma,(function(t){return null==t.parent||null!=e.forma&&_.GridController.isBackgroundColoredCell(e.forma)}))}},replaceable:{get:function(){return!0}},deleteable:{get:function(){return!0}},duplicatable:{get:function(){return!1}},userGroup:{get:function(){return!1}},userGroupChild:{get:function(){var e;return!(!(e=s.opt(s.opt(s.opt(this.forma,(function(e){return e.parent})),(function(e){return e.controller})),(function(e){return e.userGroup})))&&null==e)&&e}},userGroupMember:{get:function(){return this.userGroup||this.userGroupChild}},canGroup:{get:function(){return this.selectable&&this.floating}},enableChildMove:{get:function(){return!this.userGroupMember||this.forma.page.document.controller.enableMoveableChildren}},userGroupRoot:{get:function(){var e;if(!this.userGroupChild)return null;for(var t=this.forma;((e=s.opt(s.opt(s.opt(t,(function(e){return e.parent})),(function(e){return e.controller})),(function(e){return e.userGroupChild})))||null!=e)&&e;)t=s.opt(t,(function(e){return e.parent}));return s.as(s.opt(t,(function(e){return e.parent})),w.GroupForma)}},copyTo:function(e,t,o,n){return void 0===e&&(e=null),void 0===t&&(t=null),void 0===o&&(o=null),void 0===n&&(n=!0),d.CorePromise.resolve(null)},duplicate:function(){return this.copyTo()},opacityChangeable:{get:function(){return this.moveable}},maintainAspectRatio:{get:function(){return!1}},selectionHandlePositions:{get:function(){return P.LegacyCoreAssert.isTrue(this.selectable,"this forma isn't selectable. why get the handle positions?",void 0,"FormaController","FormaController.swift",197),[new q.TheoPoint(0,0),new q.TheoPoint(0,1),new q.TheoPoint(1,0),new q.TheoPoint(1,1)]}},showHandle:function(e){var t,o;return(t=this.forma)&&null!=(o=s.opt(s.opt(t.parent,(function(e){return e.controller})),(function(o){return o.showChildHandle(t,e)})))?o:this.selectionHandlePositions.includes(e)},visibleSelectionHandlePositions:{get:function(){for(var e=[],t=s.iter(this.selectionHandlePositions);!t.done;t.next()){var o=t.value;this.showHandle(o)&&e.push(o)}return e}},showChildHandle:function(e,t){var o,n;if((o=e.finalFrame)&&(n=s.opt(e.root,(function(e){return e.finalFrame})))){var r=o.eval(t);return r.x>=5&&r.y>=5&&r.x<=n.maxX-5&&r.y<=n.maxY-5}return!1},alignmentDetector:{get:function(){return null==this.alignmentDetector_&&(this.alignmentDetector_=u.AlignmentDetector.init_a00d(this.forma_)),this.alignmentDetector_},set:function(e){this.alignmentDetector_=e}},getAlignments:function(e){var t,o,n;if(void 0===e&&(e=!1),(o=this.forma_)&&(n=o.bounds)){var r={kind:o.kind,controllerKind:(t=s.opt(o.controller,(function(e){return e.kind})))||null!=t?t:""};P.LegacyCoreAssert.isFalse(isNaN(n.origin.x)||isNaN(n.origin.y),"forma has Nan origin pt",r,"FormaController.getAlignments","FormaController.swift",249),P.LegacyCoreAssert.isFalse(isNaN(n.size.width),"forma has Nan width",r,"FormaController.getAlignments","FormaController.swift",250),P.LegacyCoreAssert.isFalse(isNaN(n.size.height),"forma has Nan height",r,"FormaController.getAlignments","FormaController.swift",251);var i=o.kind==O.RootForma.KIND||o.isGridCell()?u.AlignmentDetector.ALIGNMENT_ROOT:u.AlignmentDetector.ALIGNMENT_FORMA,a=o.kind==O.RootForma.KIND||o.isGridCell()?u.AlignmentLocation.Root:u.AlignmentLocation.Forma,l=o.visit(v.FormaTraversal.FurthestAncestor,(function(e,t,o){return!0})),c=o.totalPlacement;return[new u.AlignmentLine(u.AlignmentType.Left,a,i,n.verticalLine(0).transform(c),!1,l),new u.AlignmentLine(u.AlignmentType.CenterX,a,i,n.verticalLine(.5).transform(c),!1,l),new u.AlignmentLine(u.AlignmentType.Right,a,i,n.verticalLine(1).transform(c),!1,l),new u.AlignmentLine(u.AlignmentType.Top,a,i,n.horizontalLine(0).transform(c),!1,l),new u.AlignmentLine(u.AlignmentType.CenterY,a,i,n.horizontalLine(.5).transform(c),!1,l),new u.AlignmentLine(u.AlignmentType.Bottom,a,i,n.horizontalLine(1).transform(c),!1,l)]}return[]},addForma:function(e,t,o){var n;return(n=s.as(e.root,O.RootForma))?(t.controller.fit(n.frame.insetRel(.25,.25,.25,.25)),n.appendChild(t),d.CorePromise.resolve(null)):d.CorePromise.reject("page has no root?")},getUserPerceivedFrame:function(){for(var e,t,o,n,r=s.clone(this.getAlignments()),i=s.iter(r);!i.done;i.next()){var a=i.value;if(a.location==u.AlignmentLocation.Forma)switch(a.type){case 0:e=a.line;break;case 2:t=a.line;break;case 3:o=a.line;break;case 5:n=a.line}}var l=s.opt(this.forma,(function(e){return e.finalFrame}));if(null!=l&&(null==e&&(e=l.verticalLine(0)),null==t&&(t=l.verticalLine(1)),null==o&&(o=l.horizontalLine(0)),null==n&&(n=l.horizontalLine(1))),null!=e&&null!=t&&null!=o&&null!=n){var c=e.intersection(o),h=o.intersection(t),d=n.intersection(t),g=n.intersection(e);if(null!=c&&null!=h&&null!=d&&null!=g)return Z.TheoRect.boundsOfPoints([c,h,d,g])}return s.opt(this.forma,(function(e){return e.finalFrame}))},canMultiSelect:{get:function(){return this.selectable&&this.floating}},move:function(e){var t;(t=this.forma_)&&(t.placement=t.placement.concat(e),this.updateParentGroup())},place:function(e){var t;(t=this.forma_)&&(t.placement=e,this.updateParentGroup())},flip:function(e){var t;void 0===e&&(e=!1),(t=this.forma_)&&(K.TransformFacade.flipForma(t,e),this.updateParentGroup())},rotate:function(e){var t;void 0===e&&(e=Math.PI/180),(t=this.forma_)&&(K.TransformFacade.rotateForma(t,e),this.updateParentGroup())},rotation:function(){var e;return(e=this.forma_)?e.rotation():0},nudge:function(e){var t;(t=this.forma_)&&(K.TransformFacade.translateForma(t,e),this.updateParentGroup())},fit:function(e){var t,o;(t=this.forma)&&(t.placement=M.Matrix2D.Identity,t.bounds=Z.TheoRect.fromSize(e.size),(o=t.frame)&&(t.move(M.Matrix2D.uniformScaling(o.aspectRatio>=1?e.width/o.width:e.height/o.height)),t.moveCenterToPoint(e.center)),this.updateParentGroup())},fitInArea:function(e){var t,o,n;if(n=this.forma){var r=e.area,i=s.opt(n.bounds,(function(e){return e.aspectRatio})),a=Math.sqrt(i*r),l=Math.sqrt(r/i),u=s.opt(n.root,(function(e){return e.bounds})),c=s.opt(u,(function(t){return t.locatePoint(e.center)}));c=new q.TheoPoint(N.MathUtils.nearestMultiple((t=s.opt(c,(function(e){return e.x})))||null!=t?t:.5,.5),N.MathUtils.nearestMultiple((o=s.opt(c,(function(e){return e.y})))||null!=o?o:.5,.5));var h=new Z.TheoRect(0,0,a,l),d=e.evalXY(c.x,c.y);h=h.moveToPoint(d,c),n.controller.fit(h)}},clone:function(e){return new C.FormaControllerFactory(this.owner).createController(this.kind,e)},match:function(e){var t,o,n,r;if((t=this.forma)&&(o=t.bounds)&&(n=e.forma)&&(r=n.bounds)&&!o.equal(r))if(this.maintainAspectRatio&&!x.ImageFacade.isPotentialBackgroundImage(t)){var i=r.fitAspectRatioWithin(o.aspectRatio);t.bounds=Z.TheoRect.fromSize(i),t.moveCenterToPoint(n.frame.center)}else t.bounds=n.bounds},postMatch:function(e){},beginBlockedUpdate:function(){this.blockedUpdate_+=1},endBlockedUpdate:function(){this.blockedUpdate_-=1},blockUpdate:{get:function(){return this.blockedUpdate_>0}},styleChanged:function(){},formaWillChangeState:function(e,t){},formaDidChangeState:function(e,t){},formaWillCommitState:function(e){},formaDidCommitState:function(e){},contentID:{get:function(){return null}},settings:{get:function(){return null}},attach:function(){},detach:function(){},controllerMetadata:{get:function(){return this.controllerMetadata_},set:function(e){this.controllerMetadata_=e,s.count(e.state.allProperties)>0&&this.decodeMetadata()}},decodeMetadata:function(){},postDecode:function(){},onEvent:function(e){this.preProcessEvent(e)||this.processEvent(e)||this.postProcessEvent(e)},preProcessEvent:function(e){return!1},processEvent:function(e){return null==this.owner||((t=s.as(e,A.BeginPointerTrackingEvent))?t.trackingResponse=T.BeginPointerTrackingResponseEnum.TrackWithinGroup:e instanceof A.BeginFormaDragEvent?this.processBeginFormaDrag(e):e instanceof A.EndFormaDragEvent?this.processEndFormaDrag(e):e instanceof A.FormaDragEvent?this.processFormaDrag(e):e instanceof A.FormaClickEvent?this.processFormaClick(e):e instanceof A.FormaDoubleClickEvent?this.processFormaDoubleClick(e):e instanceof A.BeginFormaResizeEvent?this.processBeginFormaResize(e):e instanceof A.FormaResizeEvent?this.processFormaResize(e):e instanceof A.EndFormaResizeEvent&&this.processEndFormaResize(e)),!1;var t},processFormaDoubleClick:function(e){},processBeginFormaResize:function(e){var t,o;this.alignmentDetector_=u.AlignmentDetector.init_a00d(this.forma_),(t=s.as(s.opt(this.forma.parent,(function(e){return e.controller})),R.GroupController))&&t.beginChildResizeEvent(e),(o=s.opt(this.forma,(function(e){return e.page})))&&o.publish(new k.BeginFormaResizeMessage(o))},processFormaResize:function(e){var t,o;if(this.clearAlignmentLines(),(t=this.forma.bounds)&&(o=e.pin)){var n=this.forma.placement.transformPoint(this.forma.bounds.eval(o)),r=e.newSize.width>=0?e.newSize.width:this.forma.bounds.width,i=e.newSize.height>=0?e.newSize.height:this.forma.bounds.height,a=null!=e.pin&&(.5==e.pin.x||.5==e.pin.y),l=new J.TheoSize(r,i);a||!this.maintainAspectRatio&&e.forma.kind!=F.FrameForma.KIND||(l=this.owner.selection.inCropMode?t.size.myAspectRatioFitWithin(l):t.size.myAspectRatioClosestCorner(l));var s=this.forma.placement.extractedScale;this.forma.placement=s.matrix,this.forma.bounds=Z.TheoRect.fromSize(l);var u=this.forma.placement.transformPoint(this.forma.bounds.eval(e.pin));this.forma.move(M.Matrix2D.translation(q._minus_TheoPoint_TheoPoint(n,u))),this.updateParentGroup()}},processEndFormaResize:function(e){var t;(t=s.opt(this.forma,(function(e){return e.page})))&&t.publish(new k.EndFormaResizeMessage(t));var o,n=new b.FormaAlignmentChangedEvent(this.forma_,[],null);this.forma_.beginUpdate(n),this.forma_.endUpdate(n),(o=s.as(s.opt(this.forma.parent,(function(e){return e.controller})),R.GroupController))&&o.endChildResizeEvent(e)},processBeginFormaDrag:function(e){this.clearAlignmentLines();var t,o=s.clone(e.dragDelegate.draggedFormae);this.alignmentDetector_=u.AlignmentDetector.init_f94b(o),(t=s.opt(s.first(o),(function(e){return e.page})))&&t.publish(new k.BeginFormaDragMessage(t))},afterProcessBeginFormaDrag:function(e){},processEndFormaDrag:function(e){var t=s.first(e.dragDelegate.draggedFormae),o=e.drag.viewportScale,n=26/o;y.DragFacade.rescueFormaToPageBounds(t,n,24/o);var r,i,a=new b.FormaAlignmentChangedEvent(t,[],null);if(t.beginUpdate(a),t.endUpdate(a),t.page.publish(new k.EndFormaDragMessage(t.page)),r=s.opt(t.root,(function(e){return e.filterWithCallback((function(e){return e instanceof w.GroupForma&&null!=e.controller}))})))for(var l=s.iter(r);!l.done;l.next()){var u,c=l.value;(u=s.as(c.controller,R.GroupController))&&u.canClaimForma(t)&&u.claimForma(t)}else D.Host.logging.error("Error: forma has not root "+t.print());(i=s.as(t.controller,X.TypeLockupController))&&i.invalidateStyleScores()},afterProcessEndFormaDrag:function(e){},containsForma:function(e){var t,o=s.clone(e.totalPlacement.transformPoints(e.bounds.points)),n=s.clone(this.forma.totalPlacement.inverse.transformPoints(o)),r=n.map((function(e){return e.x}),this),i=n.map((function(e){return e.y}),this),a=Z.TheoRect.fromXYXY(s.min(r),s.min(i),s.max(r),s.max(i));return!!(t=s.opt(this.forma.bounds,(function(e){return e.intersectionWith(a)})))&&t.area>.8*a.area},clearAlignmentLines:function(){var e=new b.FormaAlignmentChangedEvent(this.forma,[],[]);this.forma.beginUpdate(e),this.forma.endUpdate(e)},beforeProcessFormaDrag:function(e){},afterProcessFormaDrag:function(e){},processFormaDrag:function(e){var t=this,o=e.drag,n=1==e.dragDelegate.draggedFormae.length;e.dragDelegate.forEachDraggedForma((function(e,r){return t.processOneFormaDrag(o,e,r,n)}))},processOneFormaDrag:function(e,t,o,n){if(null!=this.owner){var r=this.owner;if(P.LegacyCoreAssert.isTrue(null!=t.controller,"processFormaDrag dragged forma with nil controller",{kind:t.kind,controllerKind:this.kind},"FormaController.processOneFormaDrag","FormaController.swift",779),null!=t.controller){var i=t.controller;if(!(!i.moveable||r.interactionMode==m.InteractionMode.SelectionFocused&&r.selection.selectedCount>0&&!r.selection.isSelected(t)))if(L=e.newDragPlacement)i.place(L);else{var a=new b.FormaTransformChangedEvent(t);t.beginUpdate(a);var l,u=s.opt(t.parent,(function(e){return e.totalPlacement.inverse}))||M.Matrix2D.Identity,c=e.freeMovement(u),h=c.movement,d=c.rise,g=c.run,p=g>0&&Math.abs(d/g),f=new q.TheoPoint(.5,.5);switch(l=t.parent instanceof F.FrameForma?t.parent.bounds.center:M._asterisk_TheoPoint_Matrix2D(t.bounds.center,o),f=t.bounds.locatePoint(t.placement.inverse.transformPoint(l)),e.dragMode){case 1:h=e.noScale(u,l);break;case 2:h=e.noRotation(u,l)}p=e.dragMode==B.DragMode.NoScaleNoSkew,P.LegacyCoreAssert.isFalse(0==h.determinant,"movement determinant should be non-zero",void 0,"FormaController.processOneFormaDrag","FormaController.swift",832),e.uncommitedMovement=h;var y=e.activePace()==B.DragPace.MediumPace||e.currentlySnapped;n||(y=!1),e.dragMode==B.DragMode.UniformScaleNoRotationNoSkew&&(y=!1);var S,C=s.clone(t.filterByControllerKind(_.GridController.KIND,v.FormaTraversal.NearestAncestor));(S=s.as(s.opt(s.first(C),(function(e){return e.controller})),_.GridController))&&S.isChildSwappable(t)&&(y=!1);var T,A=e.currentlySnapped;if(T=t.controller){var L=M._asterisk_Matrix2D_Matrix2D(o,h);if(T.place(L),e.currentlySnapped=!1,y)null!=T.setSnappedPlacement(p?f:null,8/e.viewportScale,!0).movement&&(e.currentlySnapped=!0),!A&&e.currentlySnapped&&e.commitDrag();else{var R=new b.FormaAlignmentChangedEvent(t,[],null);this.forma_.beginUpdate(R),this.forma_.endUpdate(R)}}e.currentlySnapped,t.endUpdate(a),t.page.publish(new k.FormaDragMessage(t.page))}}}},processFormaClick:function(e){var t;this.alignmentDetector_=u.AlignmentDetector.init_a00d(this.forma_);var o=e.forma;1==e.modifierKeys.shift||1==e.modifierKeys.command||1==e.modifierKeys.control?this.owner.selection.isSelected(o)?this.owner.selection.deselectForma(o):this.owner.selection.selectForma(o):this.owner.selection.isSelected(o)?((t=s.opt(D.Host.platform,(function(e){return e.isWeb})))||null!=t)&&t||this.owner.selection.deselectForma(o):(o.controller.selectable&&this.owner.selection.replaceSelection(o),this.owner.controllerSettingsState.settings=null)},setSnappedPlacement:function(e,t,o,n){void 0===o&&(o=!1),void 0===n&&(n=!1);var r,i=this.alignmentDetector.snapped_Placement(e,t,n,o),a=i[0],u=i[1];(r=a)&&this.move(r);for(var c=[],h=s.iter(this.alignmentDetector.possibleAlignmentLines);!h.done;h.next())for(var d=h.value,g=s.iter(d.lines);!g.done;g.next()){var p=g.value;c.push(p)}var f=new b.FormaAlignmentChangedEvent(this.forma_,u,null);return this.forma_.beginUpdate(f),this.forma_.endUpdate(f),new l.SnappedPlacement(a,u.length>0?u:null)},updateParentGroup:function(){var e,t=s.opt(this.forma,(function(e){return e.parent}));(e=s.as(s.opt(t,(function(e){return e.controller})),R.GroupController))&&e.childUpdate(this.forma_)},postProcessEvent:function(e){return!1},containsPoint:function(e,t){var o;return void 0===t&&(t=0),!!(o=s.opt(this.forma,(function(e){return e.bounds})))&&(0!=t?o.outsetXY(t,t):o).containsPoint(e)},applyStyle:function(e,t){void 0===t&&(t=0),s.opt(this.forma,(function(t){return t.applyStyle(e)}))},shuffleColorAssignment:function(){if(s.opt(this.forma,(function(e){return null!=e.style}))&&!this.userGroup){var e,t=this.getCurrentColors(this.forma.style).length,o=[];if(e=this.getBackgroundColor()){var n=this.forma.page.colorLibraryController,r=s.clone(n.getThemeColorKeys());if(r.length>t){var i=n.getKeyOfColorInTheme(n.getTheoColorForSolidColor(e));null!=i&&s.remove(r,i)}for(var a=[],l=s.iter(r);!l.done;l.next()){var u=l.value,c=n.getSolidColorForKey(u);null!=c&&c.contrasts(e,!1)&&a.push(u)}a.length>=t&&(r=s.clone(a)),s.shuffleInPlace(r);for(var h=0;h<t;)o.push(n.getTheoColorForKey(r[h])),h+=1}for(var d=s.iter(s.range(0,o.length,!1));!d.done;d.next()){var g,p=d.value;if(null!=(g=this.forma.page.colorLibraryController.getKeyOfColorInTheme(o[p]))){var f,m=(new G.ProfilingColorMap).overridePaletteMappingDueToContrast(g,this.forma.formaID);(f=this.forma.page.colorLibraryController.getTheoColorForKey(m))&&(o[p]=f)}}this.applyColors(o)}},getSuggestableColors:function(){for(var e=this.forma.page.colorLibraryController,t=s.clone(e.getColorThemeAsArrayOfTheoColors()),o=[],n=s.iter(t);!n.done;n.next()){var r=n.value;r.isBrandkitColor()||o.push([r])}return o},getCurrentColors:function(e){var t,o,n=[];return this.primaryColorVisible()&&(t=e.colors.color(g.ColorRole.FieldPrimary))&&n.push(t),this.secondaryColorVisible()&&(o=e.colors.color(g.ColorRole.FieldSecondary))&&n.push(o),n},getCurrentColorsWithRole:function(e,t){return void 0===t&&(t=!1),c.CoreAssertDebugOnly.fail("Unexpected: getCurrentColorsWithRole can only be called on TypeLockupController or ShapeController.",void 0,"FormaController.getCurrentColorsWithRole","FormaController.swift",1115),[]},applyColors:function(e,t){var o;if(void 0===t&&(t=g.ColorRole.FieldPrimary),o=this.forma){var n=s.clone(o.page.colorLibraryController.addColorsToTheme(e,o));n.length>0&&t==g.ColorRole.FieldPrimary&&o.style.colors.setColorId(g.ColorRole.FieldPrimary,n[0]),n.length>1&&t==g.ColorRole.FieldSecondary?o.style.colors.setColorId(g.ColorRole.FieldSecondary,n[1]):n.length>0&&t==g.ColorRole.FieldSecondary&&o.style.colors.setColorId(g.ColorRole.FieldSecondary,n[0])}this.updateParentGroup()},canHaveNoneFillColor:function(){return!1},canHaveNoneStrokeColor:function(){return!1},primaryColorVisible:function(){return!0},secondaryColorVisible:function(){return!1},borderColorVisible:function(){return!1},shadowColorVisible:function(){return!1},applyOpacity:function(e){s.opt(s.opt(s.opt(this.forma,(function(e){return e.root})),(function(e){return e.animation})),(function(e){return e.invalidate()})),s.opt(this.forma,(function(t){return t.style.opacity=e})),this.updateParentGroup()},currentOpacity:{get:function(){var e;return(e=s.opt(this.forma,(function(e){return e.style.opacity})))||null!=e?e:L.FormaStyle.OPACITY_DEFAULT}},applyBlendMode:function(e){var t;(t=this.forma)&&(s.opt(s.opt(t.root,(function(e){return e.animation})),(function(e){return e.invalidate()})),t.style.blendMode=e,this.updateParentGroup())},currentBlendMode:{get:function(){var e;return(e=s.opt(this.forma,(function(e){return e.style.blendMode})))||null!=e?e:L.FormaBlendMode.Normal}},preferredXAlignment:{get:function(){return null}},setAlignmentType:function(e){},currentHeightScale:{get:function(){var e,t;if((e=s.opt(this.forma,(function(e){return e.bounds})))&&(t=s.opt(this.forma,(function(e){return e.totalPlacement})))){var o=s.clone(e.evalPts([q.TheoPoint.ZERO,new q.TheoPoint(0,1)])),n=s.clone(t.transformPoints(o));return n[0].distanceTo(n[1])}return null}},getSizeHeightScales:function(){var e;return(e=s.opt(this.forma,(function(e){return e.bounds})))?[{size:e.size,scale:e.height}]:[]},setHeightScale:function(e,t,o){void 0===t&&(t=null),void 0===o&&(o=!1);var n=t||this.getPin();null!=n&&(n.targetHeight=e,this.matchPreviousPin(n,o))},getParentForPin:function(){var e;return(e=this.forma)?s.opt(s.opt(e.parent,(function(e){return e.controller})),(function(e){return e.kind==R.GroupController.KIND}))?e.parent:I.GroupDetector.getVisualParent(e):null},determinePinPosition:function(e,t,o,n,r,i,a,l){var s=i-r,u=Math.max((e-r)/s,0),c=Math.min(1-(i-t)/s,1),h=Math.max(Math.max(r,0)-e,0)/s,d=Math.max(t-i,0)/s,g=Math.max(Math.max(r,0)-o,0)/s,p=Math.max(Math.min(n,t)-i,0)/s;return this.isFrameCentered(g,p)||this.isFrameCentered(h,d)?(u+c)/2:N.MathUtils.absDouble(a-e)<25?0:N.MathUtils.absDouble(l-t)<25?1:g>p?c:u},isFrameCentered:function(e,t){var o=.1+Math.min(e,t);return N.MathUtils.absDouble(e-t)<o&&(e>=0&&t>=0||e+t<.05)},visualParent:{get:function(){return I.GroupDetector.getVisualParent(this.forma)}},visualParentExpansionFrame:{get:function(){var e=I.GroupDetector.getVisualParent(this.forma),t=this.getExpansionBounds(e);return e.totalPlacement.transformRect(t)}},interpolateWithDelta:function(e,t,o,n){var r=Math.min(Math.max(o,0),1),i=Math.min(n,Math.abs(e-t)),a=(1-r)*e+r*t;return Math.abs(t-a)<i&&(a=t+(e>t?1:-1)*i),a},getExpansionBounds:function(e,t,o){var n,r,i,a,l;if(void 0===t&&(t=.5),void 0===o&&(o=0),(r=this.forma)&&r.bounds&&(i=r.parent)&&(a=e.bounds)&&(l=this.getFrameInOtherFormaCoord(e))){for(var u=a.minX,c=a.maxX,h=a.minY,d=a.maxY,g=s.clone(i.filterWithCallback((function(e){return!(!(n=s.opt(e.controller,(function(e){return e.floating})))&&null==n)&&n}))),p=s.iter(g);!p.done;p.next()){var f,m=p.value;if(!s.eq(v._equality_Forma_Forma,m,r)&&(f=s.opt(m.controller,(function(t){return t.getFrameInOtherFormaCoord(e)})))){if(!m.isTypeLockup()&&f.intersects(l))continue;var y=Math.max(l.minX,f.minX),S=Math.min(l.maxX,f.maxX),C=Math.max(l.minY,f.minY),T=Math.min(l.maxY,f.maxY),A=N.MathUtils.absDouble(1-(S-y)/Math.min(l.width,f.width))<.2,F=N.MathUtils.absDouble(1-(T-C)/Math.min(l.height,f.height))<.2;S>y&&!F&&(f.center.y>l.center.y?d=Math.min(d,this.interpolateWithDelta(l.maxY,f.minY,t,o)):h=Math.max(h,this.interpolateWithDelta(l.minY,f.maxY,t,o))),T>C&&!A&&(f.center.x>l.center.x?c=Math.min(c,this.interpolateWithDelta(l.maxX,f.minX,t,o)):u=Math.max(u,this.interpolateWithDelta(l.minX,f.maxX,t,o)))}}return new Z.TheoRect(u,h,c,d)}return null},boundaryAlignment:function(e,t){return N.MathUtils.absDouble(e.minX-t.minX)<25||N.MathUtils.absDouble(e.maxX-t.maxX)<25||N.MathUtils.absDouble(e.minY-t.minY)<25||N.MathUtils.absDouble(e.maxY-t.maxY)<25},getPinBounds:function(e){return s.opt(this.forma,(function(e){return e.bounds}))},getRelativePin:function(e,t,o){var n,r;if((n=this.forma)&&(r=this.alignmentDetector)){var i,a=1;(i=s.opt(n.page.view,(function(e){return e.getViewportTransform()})))&&(a=Math.sqrt(Math.abs(i.determinant)));var l=u.AlignmentDetector.DISTANCE_THRESHOLD/a,c=s.clone(r.detectFormaAlignments(2*l,!0,!1));s.sortInPlace(c,(function(e,t){return 10*Math.abs(e.offset.length())+e.line.line.length+.1*s.toDouble(e.line.type)<10*Math.abs(t.offset.length())+t.line.line.length+.1*s.toDouble(t.line.type)}));for(var h=n.totalPlacement,d=s.iter(c);!d.done;d.next()){var g,p,f,m,y,v=d.value;if((g=s.opt(this.getPinBounds(e),(function(e){return e.transform(h)})))&&(p=v.forma)&&(f=s.opt(v.forma,(function(e){return e.totalPlacement})))&&(m=p.controller)&&(y=s.opt(m.getPinBounds(j.PinBoundsType.Bounds),(function(e){return e.transform(f)})))){var S=Math.max(0,-1*Math.min(g.maxY-y.minY,y.maxY-g.minY));if(p.parent!=n.parent||y.area<=t.area||y.intersects(g)||!m.floating||S>200)continue;var C=null;v.line.type==u.AlignmentType.CenterX?C=.5:v.line.type==u.AlignmentType.Left?C=0:v.line.type==u.AlignmentType.Right&&(C=1);var T,A,F,k,L,b,_=j.PinBoundsType.Bounds;if(null!=(T=C)&&(A=this.getPinBounds(e))&&(F=v.forma)&&(k=F.controller)&&null!=(L=k.currentHeightScale)&&(b=k.getPinBounds(_))){var R=F.totalPlacement,I=R.transformPoint(b.eval(new q.TheoPoint(.5,.5))),w=h.inverse.transformPoint(I),D=.5;w.y>A.maxY?D=1:w.y<A.minY&&(D=0);var x,P,E=new q.TheoPoint(T,D),M=new q.TheoPoint(T,1-D),N=M;if((x=F.frame)&&(P=F.bounds)){var G=F.placement.inverse.transformPoint(x.eval(M));N=new q.TheoPoint(Math.max(0,Math.min(1,G.x/P.width)),Math.max(0,Math.min(1,G.y/P.height)))}var B=R.transformPoint(b.eval(N)),O=h.transformPoint(A.eval(E)),U=Math.abs(O.y-B.y),H=U/L;return new j.TheoPin(n,e,E,F,_,N,o,U,H,!0)}}}}return null},getPin:function(e,t){if(void 0===e&&(e=!0),void 0===t&&(t=!0),!this.floating)return null;var o,n,r,i,a,l=null;if((o=this.forma)&&(n=o.finalFrame)&&(r=s.opt(o.root,(function(e){return e.finalFrame})))&&(i=this.getParentForPin())&&(a=i.finalFrame)){var u=this.currentHeightScale;null==u||!o.isShape()&&0!=u||(u=null);var c,h=j.PinBoundsType.Bounds,d=n,g=!1;s.as(this,R.GroupController)&&(c=s.opt(s.as(o,w.GroupForma),(function(e){return e.childrenFinalFrame})))&&(d=c,(g=this.boundaryAlignment(c,r))&&(h=j.PinBoundsType.ChildrenBounds));var p,f,m,y=Math.abs(a.center.x-n.center.x)<5;if(!e||g||y||(l=this.getRelativePin(h,d,u)),null==l){if((p=o.bounds)&&(f=i.bounds)&&(m=this.getExpansionBounds(i))){var v=i.totalPlacement.transformRect(m),S=this.determinePinPosition(a.minX,a.maxX,v.minX,v.maxX,n.minX,n.maxX,d.minX,d.maxX),C=this.determinePinPosition(a.minY,a.maxY,v.minY,v.maxY,n.minY,n.maxY,d.minY,d.maxY),T=n.eval(new q.TheoPoint(S,C)),A=o.totalPlacement.inverse.transformPoint(T),F=new q.TheoPoint(A.x/p.width,A.y/p.height),k=i.totalPlacement.inverse.transformPoint(T),L=new q.TheoPoint(k.x/f.width,k.y/f.height),b=j.PinBoundsType.Bounds;l=new j.TheoPin(o,h,F,i,b,L,u,0,0)}}else s.opt(D.Host.logging,(function(e){return e.warning("pinned relatively")}))}return l},matchPreviousPin:function(e,t,o,n){var r,i,a,l,u,c,h,d,g,p,f,m;if(void 0===t&&(t=!1),void 0===o&&(o=.5),void 0===n&&(n=0),(g=this.forma)&&(p=this.getParentForPin())&&(f=p.bounds)&&(m=this.getExpansionBounds(p,o,n))){for(var y=g.isTypeLockup()&&!this.maintainAspectRatio?2:1,v=s.iter(s.range(0,y,!1));!v.done;v.next()){var S,C=v.value,T=((r=e.targetHeight)||null!=r?r:(i=this.currentHeightScale)||null!=i?i:1)/((a=this.currentHeightScale)||null!=a?a:(l=e.targetHeight)||null!=l?l:1),A=0==C?.01:.05;if(Math.abs(T-1)<A)break;if(S=this.getFrameInOtherFormaCoord(p)){S=S.scale(1.1,new q.TheoPoint(.5,.5));var F=Math.max(S.minX-m.minX,0),k=Math.max(Math.min(m.maxX,f.maxX)-S.maxX,0),L=Math.max(S.minY-m.minY,0),b=Math.max(Math.min(m.maxY,f.maxY)-S.maxY,0);F=0==e.pinPoint.x?0:F,k=1==e.pinPoint.x?0:k,L=0==e.pinPoint.y?0:L,b=1==e.pinPoint.y?0:b,Math.abs(e.pinPoint.x-.5)<1e-6&&(F=Math.min(F,k),k=Math.min(F,k)),Math.abs(e.pinPoint.y-.5)<1e-6&&(L=Math.min(L,b),b=Math.min(L,b));var _=1+(F+k)/S.width,R=1+(L+b)/S.height,I=Math.min(T,_),w=Math.min(T,R);this.maintainAspectRatio&&(I=Math.min(I,w),w=I),g.bounds=s.opt(g.bounds,(function(e){return e.scaleXY(I,w,q.TheoPoint.ZERO)}))}}var D,x,P,E,M;if(T=((u=e.targetHeight)||null!=u?u:(c=this.currentHeightScale)||null!=c?c:1)/((h=this.currentHeightScale)||null!=h?h:(d=e.targetHeight)||null!=d?d:1),Math.abs(T-1)>.001&&(D=g.finalFrame)&&(x=g.bounds)&&(P=s.opt(g.root,(function(e){return e.finalFrame})))&&(E=this.getExpansionBounds(p,o,n))&&(t||x.width*T<E.width&&x.height*T<E.height&&D.width*T<P.width&&D.height*T<P.height)){var N=g.placement.transformValues;g.placement=g.placement.scaleTo(N.xscale*T,N.yscale*T)}(M=s.as(g.controller,X.TypeLockupController))&&M.snapSizeToBounds(),g.move(e.offsetMatrix()),this.preventOutofBounds(p,m)}},getFrameInOtherFormaCoord:function(e){var t,o;return(t=this.forma.bounds)&&(o=e.totalPlacement.inverse)?e==s.opt(this.forma,(function(e){return e.parent}))?s.opt(this.forma,(function(e){return e.frame})):this.forma.totalPlacement.concat(o).transformRect(t):null},preventOutofBounds:function(e,t,o){void 0===o&&(o=0);var n,r,i,a=t||e.bounds;if((n=this.forma)&&(r=a)&&(i=this.getFrameInOtherFormaCoord(e))&&!r.contains(i)){var l=r.insetXY(o,o),s=i.minX-l.minX,u=i.maxX-l.maxX,c=i.minY-l.minY,h=i.maxY-l.maxY,d=0;s<0&&u>0?d=Math.abs(s)<u?-s:-u:s<0?d=-s:u>0&&(d=-u);var g=0;return c<0&&h>0?g=Math.abs(c)<h?-c:-h:c<0?g=-c:h>0&&(g=-h),n.move(M.Matrix2D.translationXY(d,g)),0!=d||0!=g}return!1},linkedForma:function(e){var t,o;return(t=this.forma.parent)&&(o=t.controller)?o.linkedFormaForChild(this.forma,e):[]},linkedFormaForChild:function(e,t){return[]},getZOrder:function(){var e,t=-1;return null==this.forma||null==this.forma.parent?(P.LegacyCoreAssert.fail("asked to get z-order when forma or its parent is nil",void 0,"FormaController.getZOrder","FormaController.swift",1883),t):t=(e=this.forma.parent.indexOfChild(this.forma))||null!=e?e:-1},setZOrder:function(e){null!=this.forma&&null!=this.forma.parent?this.forma.parent.insertChildAt(this.forma,e):P.LegacyCoreAssert.fail("asked to set z-order when forma or its parent is nil",void 0,"FormaController.setZOrder","FormaController.swift",1895)},getMinLayerIndex:function(){var e=0;if(null==this.forma||null==this.forma.parent)return P.LegacyCoreAssert.fail("asked to get minimum layer index when forma or its parent is nil",void 0,"FormaController.getMinLayerIndex","FormaController.swift",1905),e;var t=this.forma.parent;return null!=t&&(e=s.clone(t.filterWithCallback((function(e){return s.opt(e.controller,(function(t){return 0==t.floating&&(e.isBackgroundImage()||e.isShape()&&!e.hasIntent(v.Forma.INTENT_TEMP_IMAGE_CROP)&&!e.hasIntent(v.Forma.INTENT_TEMP_IMAGE_REFINE_CUTOUT))}))}),v.FormaTraversal.JustChildren)).length),e},getReorderableLayerCount:function(){var e;return null==this.forma?(P.LegacyCoreAssert.fail("asked to get number of reorderable layers when forma or its parent is nil",void 0,"FormaController.getReorderableLayerCount","FormaController.swift",1928),0):!this.enableChildMove&&this.userGroupChild||s.opt(this.forma,(function(e){return e.isGridCell()}))?0:(e=s.opt(this.getSiblingFormae(),(function(e){return e.length})))||null!=e?e:0},getSiblingFormae:function(){return null==this.forma?(P.LegacyCoreAssert.fail("siblings requested for nil forma",void 0,"FormaController.getSiblingFormae","FormaController.swift",1947),null):s.opt(this.forma,(function(e){return e.isGridCell()}))?null:(e=s.opt(this.forma,(function(e){return e.parent})))?e.filterWithCallback((function(e){return!(e.isBackgroundImage()||_.GridController.isBackgroundColoredCell(e)||e.hasIntent(v.Forma.INTENT_TEMP_IMAGE_CROP)||e.hasIntent(v.Forma.INTENT_TEMP_IMAGE_REFINE_CUTOUT))}),v.FormaTraversal.JustChildren):null;var e},doesContrast:function(){var e,t,o;return!!((e=this.forma)&&(t=e.style.colors.fieldPrimary)&&(o=this.getBackgroundColor()))&&t.contrasts(o,!1)},contrastCheck:function(e){var t,o,n;if(void 0===e&&(e=!0),(t=this.forma.style.colors.fieldPrimary)&&null!=(o=this.forma.style.colors.colorID(g.ColorRole.FieldPrimary))&&(n=this.getBackgroundColor())&&!t.contrasts(n,e)){var r=t.contrastWithColor(n),i=h.ColorLibraryController.getBackgroundContrastKey(o);this.forma.page.colorLibraryController.setTheoColorToLibrary(W.TheoColor.init_5344(r,null,null),i),this.forma.style.colors.setColorId(g.ColorRole.FieldPrimary,i)}},getBackingContrastRole:function(){return g.ColorRole.FieldPrimary},getBackgroundColor:function(e,t){void 0===e&&(e=null),void 0===t&&(t=null);var o=this;if(null==this.forma.finalFrame)return null;var n,r=null!=e?e:this.forma.finalFrame;if(n=s.as(this.forma.root,O.RootForma)){var i=n.style.colors.fieldPrimary,a=s.opt(n.finalFrame,(function(e){return e.intersectionWith(r)}));if(null==a)return null;r=a,(c=s.as(this,X.TypeLockupController))&&c.styleController.targetedLockupStyle!==c.lockupStyle&&c.textBacked&&!E.LockupStyle.isShadowLook(c.lockupStyle.textLook)&&(i=c.lockupStyle.colors.fieldPrimary),null==i&&(s.opt(D.Host.logging,(function(e){return e.warning("Possible error. background color is nil.")})),i=H.SolidColor.WHITE);for(var l=s.clone(t||n.visitAsArray(v.FormaTraversal.PreOrder)),u=s.iter(l);!u.done;u.next()){var c,h,d,g=u.value,p=g.finalFrame,f=g.controller;if(null!=f&&!s.eq(v._equality_Forma_Forma,g,this.forma)&&null!=p&&((c=s.as(g.controller,X.TypeLockupController))&&(h=c.lockupStyle)&&h.backing==E.LockupBacking.Knockout&&h.textLook==E.LockupTextLook.KnockoutOnly&&(i=g.style.colors.fieldSecondary),!(d=f)||d.kind==U.ShapeController.KIND||d.kind==S.FrameController.KIND)){for(var m=g.parent,y=!1;null!=m&&m.kind!=O.RootForma.KIND&&m!=g;){if(m==this.forma){y=!0;break}m=m.parent}if(!y){var C=r.intersectionWith(p);if(null!=C&&C.area/r.area>.5){var T,A;if(g.parent==s.opt(this.forma,(function(e){return e.parent}))&&null!=g.parent&&null!=(T=s.opt(g.parent,(function(e){return e.indexOfChild(o.forma)})))&&null!=(A=g.parent.indexOfChild(g))&&T<A)continue;if(g instanceof F.FrameForma){var k=g.controller.getAverageColor(r);null!=k?i=i.blend(k,k.alpha):(D.Host.logging.warning("Error: Couldn't find the background image color"),i=new H.SolidColor(.5,.5,.5,1))}else if(g instanceof z.ShapeForma){if(!(new G.ProfilingColorMap).checkIfTwoFormaAreInSamePaletteMappingGroup(g.formaID,this.forma.formaID)&&!(new G.ProfilingColorMap).checkIfTwoFormaAreInSamePaletteMappingGroup(g.formaID,this.forma.formaID+G.ProfilingColorMap.backingColorKey)){var L=s.opt(s.opt(s.as(g,z.ShapeForma),(function(e){return e.contentNode})),(function(e){return e.getTag(Y.TAG_SHAPE_ID)}));if(null==L||Y.ShapeLibrary.FilledBackingShapes.includes(L)){var b=g.style.colors.fieldPrimary,_=s.as(g,z.ShapeForma).getAverageAlpha(r);null!=b&&null!=i&&(i=i.blend(b,g.style.opacity*_))}}}else w.GroupForma}}}}return i}return null},getBackgroundColors:function(){var e,t=[];if(e=this.forma.finalFrame){var o=s.clone(V.TheoDocumentUtils.getIntersectingGraphics(this.forma));if(1==o.length&&o[0].isGridCell()&&o[0].isShape()){var n,r=o[0].style.colors.fieldPrimary;if((n=o[0].finalFrame)&&n.contains(e)&&null!=r)return[r]}for(var i=3;e.width/s.toDouble(i)<50&&1!=i;)i-=1;for(var a=3;e.height/s.toDouble(a)<50&&1!=a;)a-=1;for(var l=new J.TheoSize(e.width/s.toDouble(i),e.height/s.toDouble(a)),u=s.iter(s.range(0,i,!1));!u.done;u.next())for(var c=u.value,h=s.iter(s.range(0,a,!1));!h.done;h.next()){var d=h.value,g=Z.TheoRect.fromXYWH(s.toDouble(c)*l.width+e.origin.x,s.toDouble(d)*l.height+e.origin.y,l.width,l.height);null==(r=this.getBackgroundColor(g,o))||s.containsEq(t,r,H._equality_SolidColor_SolidColor)||t.push(r)}}return t},getBackgroundColorsFullList:function(){var e,t=[];if(e=this.forma.finalFrame){var o=s.clone(V.TheoDocumentUtils.getIntersectingGraphics(this.forma));if(1==o.length&&o[0].isGridCell()&&o[0].isShape()){var n,r=o[0].style.colors.fieldPrimary;if((n=o[0].finalFrame)&&n.contains(e)&&null!=r)return[r]}for(var i=new J.TheoSize(e.width/s.toDouble(16),e.height/s.toDouble(16)),a=s.iter(s.range(0,16,!1));!a.done;a.next())for(var l=a.value,u=s.iter(s.range(0,16,!1));!u.done;u.next()){var c=u.value,h=Z.TheoRect.fromXYWH(s.toDouble(l)*i.width+e.origin.x,s.toDouble(c)*i.height+e.origin.y,i.width,i.height);null!=(r=this.getBackgroundColor(h,o))&&t.push(r)}}return t},getAverageColor:function(e){return this.forma.style.colors.fieldPrimary},annotations:{get:function(){return null}},addAnnotation:function(e){},removeAnnotationsOfType:function(e){return!1}}}),i),l.SnappedPlacement=(a=function(e,t){this.movement=e,this.snapLines=s.clone(t)},s.defineClass({name:"SnappedPlacement",ctor:a,superName:"CoreObject"}),a)},HG3C:function(e,t,o){var n,r,i=t,a=o("oAGj"),l=o("YSlt"),s=o("FNB+"),u=o("iCxV"),c=o("c+uM"),h=o("TkOd"),d=o("3DEm"),g=o("35Q0"),p=o("8t9B"),f=o("3UhB");i.ReadabilityInformation=(n=function(e,t){this.readabilityScore=e,this.readabilityString=t},a.defineClass({name:"ReadabilityInformation",ctor:n,props:{clone:function(){return new n(this.readabilityScore,this.readabilityString)}}}),n),i.LockupReadabilityEvaluator=(r=function(e,t){this.currentVersion="1.1",this.backgroundVariance=e,this.currentPosition=t.placement},a.defineClass({name:"LockupReadabilityEvaluator",ctor:r,statics:{calculateBackgroundVariance:function(e){var t,o=new l.ColorRankSuggester,n=[];if(t=a.as(e.controller,p.TypeLockupController))for(var r=a.iter(t.getBackgroundColorsFullList());!r.done;r.next()){var i=r.value;n.push(l.ColorForComparison.init_c063(i,1))}return o.getVarianceOfColors(n)}},props:{getAllLockupVisualWeights:function(e){var t=this,o={};return e.root.page.root.visitAll(s.FormaTraversal.PreOrder,(function(e){var n=e.formaID;if(a.as(e.controller,p.TypeLockupController)){var r=a.clone(t.getLockupVisualWeight(e));o[n]=a.clone(r)}})),o},getLockupReadabilityInformation:function(e,t){var o;if(this.updateVarianceIfPositionHasChanged(e),null!=(o=this.getDensity(e,t))){var n=this.getBackgroundColorVariance(e,t);n<=.01&&(n=.01);var r=this.getLockupContrast(e,t),a=this.getPointSize(e),l=o/100*(r/n)/100*a/100,s="{score:"+d.MathUtils.roundDoubleToString(l,6)+",density:"+d.MathUtils.roundDoubleToString(o,6)+",variance:"+d.MathUtils.roundDoubleToString(n,6)+",backVar:"+d.MathUtils.roundDoubleToString(this.backgroundVariance,6)+",contrast:"+d.MathUtils.roundDoubleToString(r,6)+",size:"+d.MathUtils.roundDoubleToString(a,6)+",ver:"+this.currentVersion+"}";return new i.ReadabilityInformation(l,s)}return null},getLockupVisualWeight:function(e){var t,o=[1,1,1],n=this.getLockupSize(e),r=this.getLockupContrast(e,e.style);return null!=(t=this.getDensity(e,e.style))?{Contrast:r,Density:t,Size:n,VisualWeight:r*o[0]+t*o[1]+n*o[2]}:{Contrast:r,Density:-1,Size:n,VisualWeight:r*o[0]+n*o[2]}},getDensity:function(e,t){var o,n,r;return null!=(o=a.opt(t.font,(function(e){return e.fontData.postScriptName})))&&(n=f.TypeLockupUtils.getFontDescriptorFromPostScriptName(e,o))&&null!=(r=n.characterFeatures.area_perimeter_ratio)?r:null},getLockupSize:function(e){var t,o,n=0;return(t=a.as(e.controller,p.TypeLockupController))&&(o=t.size)&&(n=o.area),o=n/e.page.pageSize.area},getLockupContrast:function(e,t){var o,n,r=new h.InterestingPageData(e),i=new l.ColorRankSuggester,s=h.lockupStyleToLockupStyleAttributes(t,e.page.document),d=(g.ShapeLibrary.shapeDictionary[s.backing]||g.ShapeLibrary.shapeDictionary.none).filled,p=c.LockupStyle.isKnockoutLook(t.textLook),f=s.primaryColor,m=[];if(p?(n=e.page.colorLibraryController.getSolidColorForKey(s.secondaryColor))&&m.push(n):(n=e.page.colorLibraryController.getSolidColorForKey(f))&&m.push(n),0==m.length)return u.Host.logging.warning("no color choices were available"),0;var y,v=[];if(0==d||p)for(var S=a.iter(r.colorsBehindSelectedLockup);!S.done;S.next()){var C=S.value;v.push(l.ColorForComparison.init_c063(C,1))}else(y=e.page.colorLibraryController.getSolidColorForKey(s.secondaryColor))&&v.push(l.ColorForComparison.init_c063(y,1));return 0==v.length?(u.Host.logging.warning("no color comparisons were available"),0):0==(o=a.clone(i.weightedColorContrastRanker(v,m))).length?(u.Host.logging.warning("no base weights were available"),0):o[0]/a.toDouble(v.length)},getBackgroundColorVariance:function(e,t){var o=h.lockupStyleToLockupStyleAttributes(t,e.page.document),n=0;return 0==(g.ShapeLibrary.shapeDictionary[o.backing]||g.ShapeLibrary.shapeDictionary.none).filled&&(n=this.backgroundVariance),n},getPointSize:function(e){var t,o=0;return(t=a.as(e.controller,p.TypeLockupController))&&(o=t.getAverageFontSize()),o},updateVarianceIfPositionHasChanged:function(e){e.placement.equal(this.currentPosition)||(this.currentPosition=e.placement,this.backgroundVariance=r.calculateBackgroundVariance(e))}}}),r)},HWAX:function(e,t,o){var n,r=t,i=o("oAGj"),a=o("yhkb"),l=o("C42b"),s=o("YSlt"),u=o("fNpk"),c=o("jcfx"),h=o("7Ta2");r.ColorSelectorUtils=(n=function(){},i.defineClass({name:"ColorSelectorUtils",ctor:n,statics:{getLightDarkColorToPreventIllegibility:function(e,t){for(var o=null,r=e.page.colorLibraryController.getProfilingColorKeys().concat(e.page.colorLibraryController.getThemeColorKeys()).concat(a.ColorLibraryController.BW_KEYS),l=[],u=i.iter(i.range(0,r.length,!1));!u.done;u.next()){var c,h=u.value;(c=e.page.colorLibraryController.getSolidColorForKey(r[h]))&&l.push(c)}var d,g=new s.ColorRankSuggester,p=i.clone(g.weightedColorContrastRanker(t,l));return null!=(d=n.getIndexOfContrastingColorChoice(p))&&(o=r[d]),o},getIndexOfContrastingColorChoice:function(e){var t=null,o=i.clone(e);i.sortInPlace(o);for(var n=0,r=o.length>5?o.length-5:0,a=i.iter(i.range(r,o.length,!1).reversed());!a.done;a.next()){var s=a.value;o[s]>0&&(n=o[s])}for(var u=!1;!u&&n>0;){var c=l.CoreRandom.nextIntUniform(100)%e.length;e[c]>=n&&(t=c,u=!0)}return t},getComparisonColors:function(e,t,o){var n=[];if(null!=t)for(var r=i.iter(t);!r.done;r.next()){var a=r.value;n.push(s.ColorForComparison.init_c063(a,1))}return null!=o&&n.push(o),n},getSolidColorForChoices:function(e,t,o){for(var n=[],r=i.iter(i.range(0,o.length,!1));!r.done;r.next()){var a,l=r.value;(a=e.page.colorLibraryController.getSolidColorForKey(o[l]))&&n.push(a)}return n},mapInferredRoleToProfilingRole:function(e,t){void 0===t&&(t=null);var o=i.clone(t||(new h.RoleSuggester).getRole(e));return(new c.ProfilingColorMap).getProfilingCategoryForInferredRole(o)},makeFinalDecisionOnColorChoice:function(e,t,o,r,a,l,c){if(void 0===a&&(a=!1),void 0===c&&(c=!1),0==o.length)return null;var h,d,g,p,f=new s.ColorRankSuggester,m=i.clone(f.weightedColorContrastRanker(t,r,a)),y=null,v=i.max(m);null!=v&&v>0?y=this.getContrastingChoice(c,m,o):(null==(y=n.getLightDarkColorToPreventIllegibility(e,t))&&(d=e.root)&&(g=e.finalFrame)&&(p=d.finalFrame)&&(g.intersects(p)||(y=o[0])),u.LegacyCoreAssert.isTrue(null!=y,"Error: we couldn't find a legible color :(",void 0,"ColorSelectorUtils.makeFinalDecisionOnColorChoice","ColorSelectorUtils.swift",155));if(null!=(h=y)){var S,C=this.handlePaletteMappingOverride(h,e,l,m,o);(S=e.page.colorLibraryController.getSolidColorForKey(C))&&(0!=i.clone(f.weightedColorContrastRanker(t,[S],a))[0]||l)&&(y=C)}return null==y&&(y=o[0]),y},getContrastingChoice:function(e,t,o){var n=null,r=i.max(t);if(e)n=o[i.indexOf(t,r)];else for(var a=i.iter(i.range(0,t.length,!1));!a.done;a.next()){var l=a.value;if(0!=t[l]){n=o[l];break}}return n},handlePaletteMappingOverride:function(e,t,o,n,r){var i="None";return i=o?t.formaID+c.ProfilingColorMap.backingColorKey:t.formaID,(new c.ProfilingColorMap).overridePaletteMappingDueToContrastAndForceDifference(e,i,n,r)},compareTwoColorStringsWithMargin:function(e,t){for(var o=!0,r=i.clone(n.convertColorStringToInt(e)),a=i.clone(n.convertColorStringToInt(t)),l=i.iter(i.range(0,r.length,!1));!l.done;l.next()){var s=l.value;r[s]!=a[s]&&r[s]!=a[s]-1&&r[s]!=a[s]+1&&(o=!1)}return o},convertColorStringToInt:function(e){for(var t=[],o=i.iter(i.range(0,i.toInt(e.length/3),!1));!o.done;o.next()){var n,r=o.value,a=e.substr(3*r,3);null!=(n=i.toInt(a))&&t.push(n)}return t}}}),n)},J3ZR:function(e,t,o){o("oAGj")},JEnV:function(e,t,o){var n,r,i,a=t,l=o("oAGj"),s=o("ascj"),u=o("fNpk"),c=o("cEEQ"),h=o("9kak"),d=o("c+uM"),g=o("GFAD"),p=o("tGKA"),f=o("8t9B"),m=o("3UhB"),y=o("uUew"),v=o("1NAc");a.paddingScalar=.6,a.spacingScalar=.75,a.EvenRowHeightsLayoutStrategy=(n=function(e,t){void 0===t&&(t=!1),e==d.LockupAlignment.Left||e==d.LockupAlignment.Right||e==d.LockupAlignment.Center?this.alignment=e:(u.LegacyCoreAssert.fail("Unexpected alignment",{alignment:e},"EvenRowHeightsLayoutStrategy.init","EvenRowHeightsLayoutStrategy.swift",30),this.alignment=d.LockupAlignment.Left),this.capToTargetAspectRatio=t},l.defineClass({name:"EvenRowHeightsLayoutStrategy",ctor:n,superName:"BaseLockupLayoutStrategy",statics:{calcNonCombiningItemCount:function(e,t,o){return t>20||e>300&&o>5?0:6},canCombineItemPair:function(e,t,o,n,r,i,a){var s,u,c;if((s=e.font)&&null!=(u=e.pointSize)&&null!=(c=t.spaceWidth)){var h=s.spaceWidthRatio*u,d=Math.abs(h-c)<.001||0==c,g=l.toInt(a/2);return d&&o&&!n&&e.characterStyle==t.characterStyle&&e.placement.ty==t.placement.ty&&r>g&&r<i-g}return!1},isFirstWordHighlighted:function(e){var t=e.highlightMethod;return t==f.HighlightMethod.EvenRows||t==f.HighlightMethod.Bracket||t==f.HighlightMethod.Manual&&l.opt(l.first(e.characterStyleRanges),(function(e){return 0==e.start}))},isAutoHighlightMethod:function(e){return e==f.HighlightMethod.EvenRows||e==f.HighlightMethod.OddRows||e==f.HighlightMethod.Bracket||e==f.HighlightMethod.InsideBracket},useCharStyleForAutoMethod:function(e,t,o){var n=e%2==(o==f.HighlightMethod.EvenRows?0:1);return o!=f.HighlightMethod.Bracket&&o!=f.HighlightMethod.InsideBracket||(n=0==e||t?o==f.HighlightMethod.Bracket:o==f.HighlightMethod.InsideBracket),n},usesVariableCharacterSizes:function(e){var t,o=e.style;return!(0!=!e.characterStyleRanges.length||!(t=o.characterStyles[f.TypeLockupController.HIGHLIGHT_STYLE])||-1==t.spacing||0==t.spacing)},_implements:function(e){return"LockupLayoutStrategy"==e}},props:{supportsConfiguration:function(e){return e.style.layout==d.LockupLayout.Standard&&e.style.alignment==this.alignment},layout:function(e){var t=e.text,o=e.style,r=o.font.fontData,i=o.spacing*a.spacingScalar,u=c.getTypographicBoundingRatiosOfString(t,r,!1),d=f.TypeLockupController.HIGHLIGHT_STYLE,g=l.opt(l.opt(o.characterStyles[d],(function(e){return e.font})),(function(e){return e.fontData})),y=m.TypeLockupUtils.getCharFontAdjust(o,u.hasUppercase),S=!1,C=n.usesVariableCharacterSizes(e);C&&o.characterStyles[d].spacing>1&&((o=e.style.clone()).characterStyles[d].spacing=y,S=!0,null!=g&&(g=r,r=o.characterStyles[d].font.fontData,o.characterStyles[d].font=o.font));var T,A,F,k=e;if(null!=(T=e.preferredFontSize)&&n.isFirstWordHighlighted(e)&&1!=y&&((k=e.clone()).preferredFontSize=T/y),(A=(F=k.expansionSize)?this.getLayoutForFlexibleWidth(k,F,i,u):this.getLayoutForFixedWidth(k,i,u))===h.LockupRowsInfo.EMPTY)return new c.LayoutResults([],new v.TheoSize(0,0),p.Matrix2D.Identity,u,0,c.BaseLockupLayoutStrategy.createMultipleReturnAnnotations(t));for(var L=l.clone(A.rows),b=A.widestRow,_=A.averageRowHeight,R=A.primaryFontSize,I=A.height,w=A.width,D=w/(b.aspectRatio/i),x=R*y,P=R*r.capRatio,E=R*u.textVerticalOffsetRatio-P,M=m.TypeLockupUtils.getCharFontYAdjust(o,R,x),N=E,G=0,B=[],O=0,U=l.iter(l.range(0,L.length,!1));!U.done;U.next()){var H=U.value,z=L[H],Y=n.calcNonCombiningItemCount(t.length,z.words.length,L.length);if(O=R,C){for(var W=!0,V=l.iter(z.words);!V.done;V.next()){var K=V.value;if(l.isEmpty(K.characterStyle)||R==x){W=!1;break}}O=W?x:R}H>0&&(N+=D);var X=z.aspectRatio*_;switch(this.alignment){case 0:G=0;break;case 1:G=w-X+0;break;case 2:G=0+(w-X)/2}for(var j=0,q=0,Z=l.iter(z.words);!Z.done;Z.next()){K=Z.value;var J=l.isEmpty(K.characterStyle)||O==x?0:M,Q=l.isEmpty(K.characterStyle)?R:x,$=K.aspectRatio*_,ee=G,te=N+0+J,oe=l.isEmpty(K.characterStyle)?null:K.characterStyle;S&&(oe=l.isEmpty(K.characterStyle)?d:null),j=K.spaceAspectRatio*_;var ne,re=null;null!=(ne=K.complementaryStyleAspectRatio)&&(re=ne*_);var ie,ae=null;null!=(ie=K.complementaryStyleSpaceAspectRatio)&&(ae=ie*_);var le,se=this.getLockupSize($,P,r.postScriptName),ue=this.getLockupPlacement(ee,te,r.postScriptName),ce=c.LockupItem.init_bc20(s.ColorRole.FieldPrimary,oe,se,ue,K.text,l.isEmpty(K.characterStyle)?r:g||r,Q,R,u,H,K.rangeInLockup,void 0,j,re,ae);(le=l.last(B))&&(le.canAppendNext=n.canCombineItemPair(le,ce,k.useOptimization,k.forceLetterForma,q,z.words.length,Y)),B.push(ce),q+=1,G+=$+j}N+=O*u.heightRatio}return new c.LayoutResults(B,new v.TheoSize(w,I),p.Matrix2D.translationXY(0,0),u,b.aspectRatio,c.BaseLockupLayoutStrategy.createMultipleReturnAnnotations(t))},getLayoutForFixedWidth:function(e,t,o){var n=e.containerSize.height,r=e.containerSize.width,i=r/n,a=l.clone(this.getCompactedRows(e,i,e.highlightMethod,this.capToTargetAspectRatio||null!=e.preferredFontSize,o));if(0==a.length)return h.LockupRowsInfo.EMPTY;var s,u,c,d=this.getAspectRatioOfAllRows(a,t),g=this.getWidestRowAspectRatio(a);return 0==g.aspectRatio?h.LockupRowsInfo.EMPTY:(null!=(c=e.preferredFontSize)?n=(r=(u=(s=c)*o.heightRatio)*g.aspectRatio)/d:(d<i?r=n*d:n=r/d,s=(u=r/g.aspectRatio)/o.heightRatio),new h.LockupRowsInfo(a,g,s,u,r,n))},getLayoutForFlexibleWidth:function(e,t,o,n){var r=e.containerSize,i=r.width,a=r.height,l=Math.max(t.height,a),s=Math.max(t.width,i),u=i,c=u,d=e.clone();d.containerSize=new v.TheoSize(c,a);for(var g=h.LockupRowsInfo.EMPTY,p=0;p<12;){var f=this.getLayoutForFixedWidth(d,o,n);if(f===h.LockupRowsInfo.EMPTY)break;if(c==u){if(f.height<=l||s-u<5){g=f;break}c=s}else if(c==s){if(f.height>l){g=f;break}c=(s+u)/2}else{if(f.height>l?u=c:(g=f,s=c),s-u<5)break;c=(s+u)/2}d.containerSize=new v.TheoSize(c,a),p+=1}return g},calculateTracking:function(e,t){var o=e.text,n=e.style.font.fontData,r=e.containerSize.width,i=e.style.spacing*a.spacingScalar,s=c.getTypographicBoundingRatiosOfString(o,n,!1),u=0,h=t.width,d=t.height,g=h/d,p=l.clone(this.getCompactedRows(e,g,e.highlightMethod,!1,s,!0));if(0==p.length)return e.style.tracking;if(e.style.tracking>0)for(var f=l.iter(l.range(0,p.length,!1));!f.done;f.next()){var m=f.value;p[m].aspectRatio=0;for(var y=l.iter(l.range(0,p[m].words.length,!1));!y.done;y.next()){var v=y.value;p[m].aspectRatio+=p[m].words[v].aspectRatio,p[m].words[v].canBreak&&v!=p[m].words.length-1?(p[m].words[v].spaceAspectRatio=n.spaceWidthRatio/s.heightRatio,p[m].aspectRatio+=p[m].words[v].spaceAspectRatio):p[m].words[v].spaceAspectRatio=0}}var S=this.getAspectRatioOfAllRows(p,i),C=this.getWidestRowAspectRatio(p),T=C.aspectRatio;if(0==T)return e.style.tracking;var A=(h=d*S)/T,F=T*A;if(F<r){u=this.getSpacing(p,C,A,r,!1).letterSpacing;for(var k=l.iter(p);!k.done;k.next()){var L=k.value;if(L.words.length>1){var b=this.getSpacing(p,L,A,r,!1);b.letterSpacing<u&&(u=b.letterSpacing)}}(u/=A/s.heightRatio)<.01&&(u=0)}else u=-F;return u},calculateLeading:function(e,t){var o=e.containerSize,n=o.width,r=o.height,i=0,s=t.width,u=t.height,h=s/u,d=c.getTypographicBoundingRatiosOfString(e.text,e.style.font.fontData,!1),g=l.clone(this.getCompactedRows(e,h,e.highlightMethod,!1,d));if(g.length<=1)return e.style.spacing;var p=this.getAspectRatioOfAllRows(g,i),f=this.getWidestRowAspectRatio(g);u=s/p;var m=s/f.aspectRatio,y=f.aspectRatio*m;if(u<r){var v=n/((r-u)/(l.toDouble(g.length)-1));i=f.aspectRatio/v/a.spacingScalar}else l.info("fits in width. old tracking is :",e.style.tracking,y,"CW:",n,r,s,u),i=-u;return i},getSpacing:function(e,t,o,n,r){var i=0,a=0,s=0,u=0;if(t.words.length<=1)return{letterSpacing:s,wordSpacing:u};for(var c=l.iter(t.words);!c.done;c.next()){var h=c.value;i+=h.aspectRatio*o+h.spaceAspectRatio*o,0!=h.spaceAspectRatio&&h.canBreak&&(a+=1)}return i-=l.last(t.words).spaceAspectRatio*o,r?u=(n-i)/(l.toDouble(a)-1):(s=(n-i)/(l.toDouble(t.words.length)-1),a>1&&s>0&&(s=(n-i-(u=s)*(l.toDouble(a)-1))/(l.toDouble(t.words.length)-1))),{letterSpacing:s,wordSpacing:u}},getWidestRowAspectRatio:function(e){for(var t=e[0],o=l.iter(e);!o.done;o.next()){var n=o.value;n.aspectRatio>t.aspectRatio&&(t=n)}return t},getAspectRatioOfAllRows:function(e,t){var o=e.length-1,n=this.getWidestRowAspectRatio(e);if(0==n.aspectRatio)return 0;for(var r=n.aspectRatio/t,i=0,a=l.iter(e);!a.done;a.next()){var s=a.value;i+=1/n.aspectRatio*s.rowHeightAdjustRatio}return 1/(i+1/r*l.toDouble(o))},rowsForTargetRowAspectRatio:function(e,t,o,n){var r=[];r.push(new h.LockupRowInfo);for(var i=0,a=0,l=!0,s=e.length,u=0;u<s;){var c=r[i],d=e[u];if(d.isNewLine)c.appendable=!1,r[i]=c,u+=1;else{for(var p=c.aspectRatio,f=d.aspectRatio+d.spaceAspectRatio,m=u;m+1<s&&!e[m].canBreak;)f+=e[m+=1].aspectRatio+e[m].spaceAspectRatio;var y=u>0&&e[u-1].canBreak,v=c.appendable&&(l||!y);if(v&&a>0){var S=p+f;if(n&&S>t)v=!1;else{var C=g.LockupUtils.percentageDiff(t,p);v=g.LockupUtils.percentageDiff(t,S)<C}}if(v){if(!o)for(;!d.canBreak&&u<s;)c.addWord(d),(u+=1)<s&&(d=e[u]);c.addWord(d),a+=1,r[i]=c}else{i+=1,a=1;var T=new h.LockupRowInfo;if(o)l=!(u>0&&!e[u-1].canBreak);else for(;!d.canBreak&&u<s;)T.addWord(d),(u+=1)<s&&(d=e[u]);T.addWord(d),r.push(T)}u+=1}}return r},getCompactedRows:function(e,t,o,r,i,s){void 0===s&&(s=!1);var u=e.text,c=e.style,d=c.font.fontData,g=c.spacing*a.spacingScalar,p=c.tracking,v=s||e.forceLetterForma,S=l.clone(e.characterStyleRanges),C=f.TypeLockupController.HIGHLIGHT_STYLE,T=l.opt(l.opt(c.characterStyles[C],(function(e){return e.font})),(function(e){return e.fontData})),A=m.TypeLockupUtils.getCharFontAdjust(c,i.hasUppercase);e.characterStyleRanges.length>0&&null!=c.characterStyles[C]&&-1!=c.characterStyles[C].spacing&&0!=c.characterStyles[C].spacing&&c.characterStyles[C].spacing>1&&((c=e.style.clone()).characterStyles[C].spacing=A,S=l.clone(m.TypeLockupUtils.invertRanges(e.characterStyleRanges,u.length)),null!=T&&(T=d,d=c.characterStyles[C].font.fontData,c.characterStyles[C].font=c.font));var F=l.clone(m.TypeLockupUtils.computeLockupMeasurements(u,d,i.heightRatio,!1,v,p,S,c.characterStyles,A,e.forceLetterForma)),k=F.length;if(0==k)return[];var L,b=new h.LockupRowInfo(F).aspectRatio,_=.5,R=.6+1.6*b;if(null!=(L=e.preferredFontSize)){var I=L*i.heightRatio,w=e.containerSize.width/I;_=w,R=w}for(var D=l.clone(this.getOptimalCompactedRows(F,b,t,g,_,R,!1,r)),x=0,P=l.iter(F);!P.done;P.next())x+=P.value.isNewLine?0:1;if(null!=e.rowWordLengths&&e.rowWordLengths.reduce((function(e,t){return e+t}),0)==x&&(!e.allowFewerLineBreaks||D.length>=e.rowWordLengths.length)&&(D=l.clone(this.getPrecomputedRows(F,e.rowWordLengths))),null!=c.characterStyles[C]&&null!=c.characterStyles[C].font&&(k>1&&!v||v&&D.length>1)&&n.isAutoHighlightMethod(o)){var E=l.clone(m.TypeLockupUtils.computeLockupMeasurements(u,d,i.heightRatio,!1,v,p,[],{},void 0,e.forceLetterForma)),M=[new y.TextRange(0,l.chars(u).length)],N=l.clone(m.TypeLockupUtils.computeLockupMeasurements(u,T,i.heightRatio,!1,v,p,M,c.characterStyles,A,e.forceLetterForma));D=l.clone(this.getOptimalCompactedAutoRows(E,N,b,t,g,_,R,!1,this.capToTargetAspectRatio||null!=e.preferredFontSize,o))}return D},getOptimalCompactedRows:function(e,t,o,n,r,i,a,s){var u=i-r,c=.25*u,h=r+.5*u,d=r+c,p=i-c,f=l.clone(this.rowsForTargetRowAspectRatio(e,d,a,s));if(r==i)return f;var m=l.clone(this.rowsForTargetRowAspectRatio(e,p,a,s)),y=this.getAspectRatioOfAllRows(f,n),v=this.getAspectRatioOfAllRows(m,n),S=g.LockupUtils.percentageDiff(o,y),C=g.LockupUtils.percentageDiff(o,v);return u<.2?S<C?f:m:S<=C?this.getOptimalCompactedRows(e,t,o,n,r,h,a,s):this.getOptimalCompactedRows(e,t,o,n,h,i,a,s)},getWordForAutoMethod:function(e,t,o,r,i){var a=n.useCharStyleForAutoMethod(o,r,i),l=a?t:e,s=a?e:t;return l.complementaryStyleAspectRatio=s.aspectRatio,l.complementaryStyleSpaceAspectRatio=s.spaceAspectRatio,l},rowsForTargetRowAspectRatioAutoRows:function(e,t,o,n,r,i,a){var s=[];s.push(new h.LockupRowInfo);for(var u=0,c=0,d=!0,p=e.length,m=0,y=0;m<p;){var v=s[u],S=this.getWordForAutoMethod(e[m],t[m],u,m==p-1,a);if(S.isNewLine)v.appendable=!1,s[u]=v,m+=1;else{for(var C=v.aspectRatio,T=S.aspectRatio+S.spaceAspectRatio,A=m;A+1<p&&!e[A].canBreak;)T+=e[A+=1].aspectRatio+e[A].spaceAspectRatio;var F=m>0&&e[m-1].canBreak,k=v.appendable&&(d||!F);if(k&&c>0){var L=C+T;if(i&&L>n)k=!1;else{var b=g.LockupUtils.percentageDiff(n,C);k=g.LockupUtils.percentageDiff(n,L)<b}}if(k){if(!r)for(;!S.canBreak&&m<p;)v.addWord(S),(m+=1)<p&&(S=this.getWordForAutoMethod(e[m],t[m],u,m==p-1,a));v.addWord(S),c+=1,s[u]=v}else{u+=1,y=m,S=this.getWordForAutoMethod(e[m],t[m],u,m==p-1,a),c=1;var _=new h.LockupRowInfo;if(r)d=!(m>0&&!e[m-1].canBreak);else for(;!S.canBreak&&m<p;)_.addWord(S),(m+=1)<p&&(S=this.getWordForAutoMethod(e[m],t[m],u,m==p-1,a));_.addWord(S),s.push(_)}m+=1}}if(a==f.HighlightMethod.Bracket||a==f.HighlightMethod.InsideBracket){for(var R,I,w=new h.LockupRowInfo,D=l.iter(l.range(y,p,!1));!D.done;D.next()){m=D.value;var x=this.getWordForAutoMethod(e[m],t[m],u,!0,a);w.addWord(x)}i&&w.aspectRatio>n?(R=l.last(s))&&(I=R.removeLastWord())&&((w=new h.LockupRowInfo).addWord(I),s.push(w)):s[s.length-1]=w}return s},getOptimalCompactedAutoRows:function(e,t,o,n,r,i,a,s,c,h){u.LegacyCoreAssert.isTrue(e.length==t.length,"application of char style to entire range should not change word count",void 0,"EvenRowHeightsLayoutStrategy.getOptimalCompactedAutoRows","EvenRowHeightsLayoutStrategy.swift",1055);var d=a-i,p=.25*d,f=i+.5*d,m=i+p,y=a-p,v=l.clone(this.rowsForTargetRowAspectRatioAutoRows(e,t,r,m,s,c,h));if(i==a)return v;var S=l.clone(this.rowsForTargetRowAspectRatioAutoRows(e,t,r,y,s,c,h)),C=this.getAspectRatioOfAllRows(v,r),T=this.getAspectRatioOfAllRows(S,r),A=g.LockupUtils.percentageDiff(n,C),F=g.LockupUtils.percentageDiff(n,T);return d<.2?A<F?v:S:A<=F?this.getOptimalCompactedAutoRows(e,t,o,n,r,i,f,s,c,h):this.getOptimalCompactedAutoRows(e,t,o,n,r,f,a,s,c,h)},reflow:function(e,t,o,r){if(l.opt(t,(function(e){return.5!=e.y})))return null;if(n.usesVariableCharacterSizes(o))return null;var i,s,u,c=o.style,h=l.clone(r.itemsForReflow);if((i=l.opt(c.font,(function(e){return e.fontData})))&&(s=l.first(h))&&null!=(u=s.rowPointSize)){var d=o.text;return m.TypeLockupUtils.isTextRightToLeft(d)&&(h=l.reverse(h)),new a.ReflowHelper(this.alignment,d,o.highlightMethod,c,i,r.typographicBoundingRatios,e.width,h,u,o.useOptimization,o.forceLetterForma).perform()}return r}}}),n),a.ReflowHelper=(r=function(e,t,o,n,r,i,s,u,c,h,d){this.alignment=e,this.text=t,this.highlightMethod=o,this.style=n,this.font=r,this.typographicBoundingRatios=i,this.items=l.clone(u),this.canonicalFontSize=c,this.useOptimization=h,this.forceLetterForma=d,this.maxWidth=s;for(var g=l.iter(u);!g.done;g.next()){var p=g.value;null!=this.primaryStyleItem||p.hasCharacterStyle||(this.primaryStyleItem=p),null==this.charStyleItem&&p.hasCharacterStyle&&(this.charStyleItem=p),this.maxWidth=Math.max(this.maxWidth,p.size.width)}this.rowHeight=c*i.heightRatio,this.leadingHeight=n.spacing*a.spacingScalar*this.rowHeight,this.accumulatedHeight=0,this.slugs=[],this.yValues=[]},l.defineClass({name:"ReflowHelper",ctor:r,props:{perform:function(){for(var e=this.createSlug(),t=l.iter(l.toSequence(this.items));!t.done;t.next()){var o,n=t.value,r=n.offset,i=n.element;if(null!=(o=l.opt(i.rangeInLockup,(function(e){return e.start})))){var a=r==this.items.length-1,s=this.shouldForceCharStyle(a),c=o>0&&"\n"==this.text.substr(o-1,1);!c&&e.appendItem(i,s)||(c&&0==this.slugs.length||u.LegacyCoreAssert.isFalse(e.isEmpty,"Could not fit even one word?",void 0,"ReflowHelper.perform","EvenRowHeightsLayoutStrategy.swift",1322),this.appendSlug(e),e=this.createSlug(),s=this.shouldForceCharStyle(a),e.appendItem(i,s)||u.LegacyCoreAssert.fail("Could not fit a word in an empty slug?",void 0,"ReflowHelper.perform","EvenRowHeightsLayoutStrategy.swift",1331))}}return this.highlightMethod!=f.HighlightMethod.Bracket&&this.highlightMethod!=f.HighlightMethod.InsideBracket||(e=e.harmonizeStyleForBracketing()),this.appendSlug(e,!0),this.slugsToResults()},slugsToResults:function(){var e,t,o=this.slugs.map((function(e){return e.width}),this),n=(e=l.max(o))||null!=e?e:0,r=this.accumulatedHeight,i=this.canonicalFontSize*(this.typographicBoundingRatios.textVerticalOffsetRatio-this.font.capRatio),s=0;null!=(t=l.opt(this.charStyleItem,(function(e){return e.pointSize})))&&(s=m.TypeLockupUtils.getCharFontYAdjust(this.style,this.canonicalFontSize,t));for(var u=[],h=l.iter(l.toSequence(this.slugs));!h.done;h.next()){var d=h.value,g=d.offset,f=d.element,y=a.EvenRowHeightsLayoutStrategy.calcNonCombiningItemCount(this.text.length,f.numItems,this.slugs.length);f.output(u,g,i+this.yValues[g],s,n,this.alignment,y,this.useOptimization,this.forceLetterForma)}return new c.LayoutResults(u,new v.TheoSize(n,r),p.Matrix2D.Identity,this.typographicBoundingRatios,n/this.rowHeight,c.BaseLockupLayoutStrategy.createMultipleReturnAnnotations(this.text))},createSlug:function(){return new a.Slug(this.maxWidth,this.canonicalFontSize,this.typographicBoundingRatios,this.primaryStyleItem,this.charStyleItem)},appendSlug:function(e,t){void 0===t&&(t=!1),this.slugs.push(e),this.yValues.push(this.accumulatedHeight),this.accumulatedHeight+=e.height,t||(this.accumulatedHeight+=this.leadingHeight)},shouldForceCharStyle:function(e){return a.EvenRowHeightsLayoutStrategy.isAutoHighlightMethod(this.highlightMethod)?a.EvenRowHeightsLayoutStrategy.useCharStyleForAutoMethod(this.slugs.length,e,this.highlightMethod):null}}}),r),a.Slug=(i=function(e,t,o,n,r){this.items=[],this.lastItemSpaceWidth=0,this.xValues=[],this.width=0,void 0===n&&(n=null),void 0===r&&(r=null),this.maxWidth=e,this.canonicalFontSize=t,this.typographicBoundingRatios=o,this.primaryStyleItem=n,this.charStyleItem=r},l.defineClass({name:"Slug",ctor:i,props:{appendItem:function(e,t){var o;void 0===t&&(t=null);var n,r,i=e;if(null!=t&&e.hasCharacterStyle!=t&&(i=this.flipItemStyle(e)||e),null!=(n=i.pointSize)&&(r=i.font)){var a=i.size.width,l=(o=i.spaceWidth)||null!=o?o:n*r.spaceWidthRatio,s=this.width+this.lastItemSpaceWidth+a;return!!(this.isEmpty||s<=this.maxWidth)&&(this.items.push(i),this.width+=this.lastItemSpaceWidth,this.xValues.push(this.width),this.width+=a,this.lastItemSpaceWidth=l,!0)}return!0},output:function(e,t,o,n,r,i,s,u,h){for(var g=l.iter(l.toSequence(this.items));!g.done;g.next()){var f,m,y,v,S=g.value,C=S.offset,T=S.element;if(null!=(f=T.pointSize)&&null!=(m=T.text)&&(y=T.font)&&(v=T.rangeInLockup)){var A=this.xValues[C];i!=d.LockupAlignment.Center&&i!=d.LockupAlignment.Right||(A+=(r-this.width)/(i==d.LockupAlignment.Center?2:1));var F,k=o+(T.hasCharacterStyle&&this.canonicalFontSize!=f?n:0),L=c.LockupItem.init_bc20(T.colorRole,T.characterStyle,T.size,p.Matrix2D.translationXY(A,k),m,y,f,this.canonicalFontSize,this.typographicBoundingRatios,t,v,void 0,T.spaceWidth,T.complementaryStyleWordWidth,T.complementaryStyleSpaceWidth);(F=l.last(e))&&(F.canAppendNext=a.EvenRowHeightsLayoutStrategy.canCombineItemPair(F,L,u,h,C,this.numItems,s)),e.push(L)}}},harmonizeStyleForBracketing:function(){if(this.items.length<2)return this;var e,t=new i(1e5,this.canonicalFontSize,this.typographicBoundingRatios,this.primaryStyleItem,this.charStyleItem);if(null!=(e=l.opt(l.last(this.items),(function(e){return e.hasCharacterStyle}))))for(var o=l.iter(this.items);!o.done;o.next()){var n=o.value,r=t.appendItem(n,e);u.LegacyCoreAssert.isTrue(r,"Could not fit a word in a super wide slug?",void 0,"Slug.harmonizeStyleForBracketing","EvenRowHeightsLayoutStrategy.swift",1578)}return t},flipItemStyle:function(e){var t,o,n,r,i,a,l,s;if(null!=(n=e.text)&&(r=e.rangeInLockup)&&null!=(i=e.rowIndex)&&(a=e.hasCharacterStyle?this.primaryStyleItem:this.charStyleItem)&&(l=a.font)&&null!=(s=a.pointSize)){var u=e.hasCharacterStyle?"":f.TypeLockupController.HIGHLIGHT_STYLE,h=e.size.width,d=new v.TheoSize((t=e.complementaryStyleWordWidth)||null!=t?t:h,e.size.height),g=h,p=e.spaceWidth,m=(o=e.complementaryStyleSpaceWidth)||null!=o?o:p,y=p;return c.LockupItem.init_bc20(e.colorRole,u,d,e.placement,n,l,s,this.canonicalFontSize,this.typographicBoundingRatios,i,r,void 0,m,g,y)}return null},height:{get:function(){return this.canonicalFontSize*this.typographicBoundingRatios.heightRatio}},isEmpty:{get:function(){return 0==this.items.length}},numItems:{get:function(){return this.items.length}}}}),i)},JFv5:function(e,t,o){var n,r=t,i=o("oAGj"),a=o("gXiO"),l=o("FNB+"),s=o("Pil/"),u=o("9Lk3"),c=o("ZK0l"),h=o("/afT"),d=o("fdtz"),g=o("K0Rh"),p=o("djAF"),f=o("T6jX"),m=o("8t9B"),y=o("oKlP"),v=o("zjod");r.ResizeLayoutController=i.defineProtocol("ResizeLayoutController",{beginUpdateGroup:"() -> Void",updateGroup:"() -> Void",endUpdateGroup:"() -> Void"}),r.ResizeLayoutType=i.defineEnum("ResizeLayoutType",{Proportional:"Proportional",Fit:"Fit",Pin:"Pin",Spring:"Spring"}),r.PinLayoutController=(n=function(e){this.formaToUpdate_=[],this.inferredGroups_=null,this.group_=e,a.CoreObject.call(this)},i.defineClass({name:"PinLayoutController",ctor:n,superName:"CoreObject",statics:{_implements:function(e){return"ResizeLayoutController"==e}},props:{beginUpdateGroup:function(){if(this.oldBounds_=this.group_.bounds,i.as(this.group_.root,g.RootForma)&&!this.group_.hasIntent(l.Forma.INTENT_INFERRED_TEMP_GROUP)&&i.opt(this.group_.root,(function(e){return null!=e.page.root_}))&&!f.TheoDocumentUtils.enableFastHeuristicsForComplexPage(this.group_.root.page)){var e=i.clone(h.GroupDetector.createOverlapGroups(this.group_));if(e.length>0){this.inferredGroups_=[];for(var t=i.iter(e);!t.done;t.next()){var o=t.value;this.inferredGroups_.push(o)}i.opt(i.as(this.group_.controller,u.GridController),(function(e){return e.inferGridCellAssignment()}))}}this.formaToUpdate_=[];for(var n=i.iter(this.group_.visitAsArray(l.FormaTraversal.JustChildren));!n.done;n.next()){var r=n.value;if(r.kind!=d.ImageForma.KIND&&r.kind!=v.VideoForma.KIND){var a;(a=i.as(r.controller,c.GroupController))&&a.beginUpdateGroup();var s=i.opt(r.controller,(function(e){return e.getPin(!0)}));null==s||s.isRelativePin?this.formaToUpdate_.push({forma:r,pin:s}):this.formaToUpdate_.splice(0,0,{forma:r,pin:s})}}},updateGroup:function(){if(null!=this.oldBounds_){for(var e=this.oldBounds_.size,t=this.group_.bounds.size,o=new y.TheoPoint(t.width/e.width,t.height/e.height),n=i.iter(this.formaToUpdate_);!n.done;n.next()){var r;if((r=(T=n.value).forma.frame)&&r.area>0){var a,l,u=T.forma,c=u.placement.transformValues,h=Math.abs(c.rotCosine)/(Math.abs(c.rotCosine)+Math.abs(c.rotSine)),d=Math.abs(c.rotSine)/(Math.abs(c.rotCosine)+Math.abs(c.rotSine)),g=new y.TheoPoint(o.x*h+o.y*d,o.x*d+o.y*h);if((C=i.as(u.controller,m.TypeLockupController))&&C.addLineBreakConstraints(),null!=u.controller&&u.controller.maintainAspectRatio){var f=Math.min(g.x,g.y);a=i.opt(u.bounds,(function(e){return e.scaleXY(f,f,new y.TheoPoint(0,0))}))}else a=i.opt(u.bounds,(function(e){return e.scaleXY(g.x,g.y,new y.TheoPoint(0,0))}));(l=i.as(u,p.ShapeForma))?i.opt(l.controller,(function(e){return e.onEvent(new s.FormaResizeEvent(l,i.opt(a,(function(e){return e.size})),new y.TheoPoint(0,0)))})):u.bounds=a,u.moveCenterToPoint(new y.TheoPoint(r.center.x*o.x,r.center.y*o.y))}}for(var v=i.iter(this.formaToUpdate_);!v.done;v.next()){var S,C,T=v.value;(S=T.pin)&&(i.opt(T.forma.controller,(function(e){return e.matchPreviousPin(S)})),(C=i.as(T.forma.controller,m.TypeLockupController))&&C.removeLineBreakConstraints())}}},endUpdateGroup:function(){for(var e=i.iter(this.group_.visitAsArray(l.FormaTraversal.JustChildren));!e.done;e.next()){var t,o=e.value;if((t=i.as(o.controller,c.GroupController))&&t.endUpdateGroup(),o.hasIntent(l.Forma.INTENT_INFERRED_TEMP_GROUP)&&null!=this.inferredGroups_&&this.inferredGroups_.includes(o)){for(var n=i.iter(o.visitAsArray(l.FormaTraversal.JustChildren));!n.done;n.next()){var r=n.value;this.group_.appendChild(r,!0)}o.removeFromParent(),i.opt(i.as(this.group_.controller,u.GridController),(function(e){return e.inferGridCellAssignment()})),i.remove(this.inferredGroups_,o)}}}}}),n)},JGCS:function(e,t,o){var n,r=t,i=o("oAGj"),a=o("Tq01"),l=o("yGNn"),s=o("djAF"),u=o("fiuZ"),c=o("Kkml");r.SetShapeAttributesAction=(n=function e(t,o,n){void 0===n&&(n=null),this.strokeWeightMultiplier=t,this.cornerPreScale=o,this.formae=i.clone(n),a.Action.call(this,e.TYPE)},i.defineClass({name:"SetShapeAttributesAction",ctor:n,superName:"Action",statics:{TYPE:"SetShapeAttributesAction"},props:{getUserAction:function(e){return c.UserActions.SetShapeAttributes()},execute:function(e){var t=i.clone(this.formae||e.selection.asFormaArray());if(!isNaN(this.strokeWeightMultiplier)){var o=t.filter((function(e){return 1==u.ShapeFacade.canSetStrokeWeightMultiplier([e])}),this);u.ShapeFacade.applyStrokeWeightMultiplier(this.strokeWeightMultiplier,o)}if(!isNaN(this.cornerPreScale)&&this.cornerPreScale>0){var n=t.filter((function(e){return 1==u.ShapeFacade.canSetCornerPreScale([e])}),this);u.ShapeFacade.applyCornerPreScale(this.cornerPreScale,n)}for(var r=i.iter(t);!r.done;r.next()){var a,c=r.value;(a=i.as(c,s.ShapeForma))&&(a.maskImage=null)}return l.CorePromise.resolve(null)}}}),n)},JKVa:function(e,t,o){var n,r=t,i=o("oAGj"),a=o("ascj"),l=o("iCxV"),s=o("IUM5"),u=o("fNpk"),c=o("JgVS"),h=o("cEEQ"),d=o("c+uM"),g=o("tGKA"),p=o("ezSu"),f=o("35Q0"),m=o("oKlP"),y=o("sIWg");r.SVGBackgroundDecorationStrategy=(n=function(e){if(this.artworkID_=null,this.artworkInfo_=null,this.spacingScalar=.75,this.paddingScalar=.6,this.artworkID_=e,null!=e){var t=l.Host.resourceUtils.urlForResource(s.CATEGORY_ID_SHAPE,e);null!=t?(this.artworkInfo_=l.Host.pathUtils.artworkFromURL(t,!1),u.LegacyCoreAssert.isTrue(null!=this.artworkInfo_,"Unable to load artwork!",void 0,"SVGBackgroundDecorationStrategy.init","SVGBackgroundDecorationStrategy.swift",47)):i.opt(l.Host.logging,(function(e){return e.warning("Invalid artwork ID provided!")}))}},i.defineClass({name:"SVGBackgroundDecorationStrategy",ctor:n,superName:"BaseDecorationStrategy",statics:{_implements:function(e){return"LockupDecorationStrategy"==e}},props:{easeOutQuad:function(e,t,o,n){var r=e/n;return-o*r*(r-2)+t},easeOut:function(e,t,o){return this.easeOutQuad(o,e,t-e,1)},supportsConfiguration:function(e){return e.style.backing==d.LockupBacking.SVGBackground&&this.artworkID_==e.style.backingArtworkID&&!d.LockupStyle.isLetterGrid(e.style.layout)},decorate:function(e,t){if(null==this.artworkID_||null==this.artworkInfo_)return i.opt(l.Host.logging,(function(e){return e.warning("artworkID or artworkInfo is nil ")})),new c.DecorationResults([]);var o=[],n=this.calcSVGConfiguration(e.style,t),r=n.frame,s=n.preScale;return o.push(h.LockupItem.init_fbd7(a.ColorRole.FieldSecondary,r.size,g.Matrix2D.translationXY(r.minX,r.minY),this.artworkID_,s)),new c.DecorationResults(o)},calcSVGConfiguration:function(e,t,o){void 0===o&&(o=-1);var n=y.TheoRect.fromSize(t.size),r=t.typographicBoundingRatios.backingVerticalOffsetRatio*t.avgLinePointSize,i=e.font.fontData,a=c.BaseDecorationStrategy.getHorizontalOffsetForItalicAngle(t.avgLinePointSize*t.typographicBoundingRatios.heightFromBaselineRatio,i.italicAngle),l=((t.size.width+t.size.height)/4+t.avgLinePointSize)/2,s=e.padding*this.paddingScalar*l,u=e.padding;o>-1?(u=o/2,s=o*this.paddingScalar*l/2):t.numberOfLines>1&&(u+=e.spacing,s+=e.spacing*this.spacingScalar*t.avgLinePointSize),(e.padding>=0||o>-1)&&(s=Math.max(.05*l,s));var h,d=this.easeOut(0,r,Math.min(1,u)),g=n.minX-s,p=n.maxX+s+a,v=n.minY-s+d,S=n.maxY+s+d;if(n=new y.TheoRect(g,v,p,S),(h=f.ShapeLibrary.getShapeDataForArtworkId(this.artworkID_))&&h.category==f.ShapeCategory.Circle){var C=new m.TheoPoint(n.minX,n.minY),T=n.center,A=T.distanceTo(C),F=Math.sqrt(2*Math.pow(A,2))/2;g=T.x-F,p=T.x+F,v=T.y-F,S=T.y+F,n=new y.TheoRect(g,v,p,S)}return this.calcSVGFrame(n)},calcSVGFrame:function(e){var t,o,n=null!=this.artworkInfo_.sliceBox,r=null!=this.artworkInfo_.contentRegion,i=this.artworkInfo_.artwork.bounds,a=r?this.artworkInfo_.contentRegion:i,l=1,s=null;if(r)if(n){a=this.artworkInfo_.contentRegion;var u=e.width/a.width,c=e.height/a.height;s=Math.min(u,c);var h=p.NineSlicingFilter.calculateOuterBoundsForMapping(i,this.artworkInfo_.sliceBox,s,a,e);o=h.bounds,s=(t=h.prescribedPrescale)||null!=t?t:s}else u=e.width/a.width,c=e.height/a.height,l=Math.max(u,c),o=i.transform(g.Matrix2D.scalingXY(l,l));else n?o=e:(u=e.width/i.width,c=e.height/i.height,l=Math.max(u,c),o=i.transform(g.Matrix2D.scalingXY(l,l)));if(!n){var d=a.transform(g.Matrix2D.scalingXY(l,l));o=o.transform(g.Matrix2D.translation(e.center.subtract(d.center)))}return{frame:o,preScale:s}}}}),n)},JO5d:function(e,t,o){var n,r=t,i=o("oAGj"),a=o("6h7+"),l=o("aO0D"),s=o("gpZI"),u=o("CWW7"),c=o("yGNn"),h=o("AVHO"),d=o("Ohrj"),g=o("ascj"),p=o("R0Y+"),f=o("FNB+"),m=o("H9Ol"),y=o("yHU1"),v=o("Pil/"),S=o("16hp"),C=o("G1DZ"),T=o("P83h"),A=o("9Lk3"),F=o("pnSN"),k=o("6Rk9"),L=o("x35w"),b=o("tGKA"),_=o("uxH+"),R=o("K0Rh"),I=o("7Ta2"),w=o("Zifs"),D=o("djAF"),x=o("fiuZ"),P=o("35Q0"),E=o("u2iI"),M=o("T6jX"),N=o("oKlP"),G=o("sIWg"),B=o("LGJg");r.ShapeController=(n=function(e,t,o){m.FormaController.call(this,e,t,o)},i.defineClass({name:"ShapeController",ctor:n,superName:"FormaController",statics:{KIND:{get:function(){return"shape"}}},props:{prescaleBase:{get:function(){var e;return(e=i.opt(i.as(i.opt(this.forma,(function(e){return e.style})),E.ShapeStyle),(function(e){return e.prescaleBase})))||null!=e?e:E.ShapeStyle.PRESCALE_BASE_DEFAULT}},prescaleMin:{get:function(){var e;return(e=i.opt(i.as(i.opt(this.forma,(function(e){return e.style})),E.ShapeStyle),(function(e){return e.prescaleMin})))||null!=e?e:E.ShapeStyle.PRESCALE_MIN_DEFAULT}},prescaleMax:{get:function(){var e;return(e=i.opt(i.as(i.opt(this.forma,(function(e){return e.style})),E.ShapeStyle),(function(e){return e.prescaleMax})))||null!=e?e:E.ShapeStyle.PRESCALE_MAX_DEFAULT}},cornerPrescale:{get:function(){return i.opt(i.as(this.forma,D.ShapeForma),(function(e){return e.preScale}))}},applyCornerPreScale:function(e){var t=this.forma,o=this.getInitialPrescale()*e;t.preScale=o,i.opt(i.as(this.forma,D.ShapeForma),(function(e){return e.removeArtworkSized()})),this.updateParentGroup()},applyStrokeWeightMultiplier:function(e){var t,o,n,r,a,l,s,u,c,h;if((c=i.as(i.opt(this.forma,(function(e){return e.style})),E.ShapeStyle))&&(h=i.opt(this.forma,(function(e){return e.bounds})))){if(c.strokeWeightMultiplier!=e){var d=i.opt(i.as(this.forma,D.ShapeForma),(function(e){return e.strokeInsetAdjustmentFromBase()})),g=((t=i.opt(d,(function(e){return e.left})))||null!=t?t:0)+((o=i.opt(d,(function(e){return e.right})))||null!=o?o:0),p=((n=i.opt(d,(function(e){return e.top})))||null!=n?n:0)+((r=i.opt(d,(function(e){return e.bottom})))||null!=r?r:0);c.strokeWeightMultiplier=e;var f=i.opt(i.as(this.forma,D.ShapeForma),(function(e){return e.strokeInsetAdjustmentFromBase()})),m=((a=i.opt(f,(function(e){return e.left})))||null!=a?a:0)+((l=i.opt(f,(function(e){return e.right})))||null!=l?l:0),y=((s=i.opt(f,(function(e){return e.top})))||null!=s?s:0)+((u=i.opt(f,(function(e){return e.bottom})))||null!=u?u:0),v=x.ShapeFacade.getCornerOrInitialPrescaleForForma(this.forma),S=(g-m)*v,C=(p-y)*v,T=G.TheoRect.fromSize(h.size.expandXY(S,C));i.opt(this.forma,(function(e){return e.bounds=T}))}i.opt(i.as(this.forma,D.ShapeForma),(function(e){return e.removeArtworkSized()})),this.updateParentGroup()}},strokeBaseWeight:{get:function(){var e;return(e=i.opt(i.as(i.opt(this.forma,(function(e){return e.style})),E.ShapeStyle),(function(e){return e.strokeBaseWeight})))||null!=e?e:E.ShapeStyle.STROKE_BASE_WEIGHT_DEFAULT}},currentStrokeWeightMultiplier:{get:function(){var e;return(e=i.opt(i.as(i.opt(this.forma,(function(e){return e.style})),E.ShapeStyle),(function(e){return e.strokeWeightMultiplier})))||null!=e?e:E.ShapeStyle.STROKE_WEIGHT_MULTIPLIER_DEFAULT}},strokeWeightMultiplierMin:{get:function(){var e;return(e=i.opt(i.as(i.opt(this.forma,(function(e){return e.style})),E.ShapeStyle),(function(e){return e.strokeWeightMultiplierMin})))||null!=e?e:E.ShapeStyle.STROKE_WEIGHT_MULTIPLIER_MIN_DEFAULT}},strokeWeightMultiplierMax:{get:function(){var e;return(e=i.opt(i.as(i.opt(this.forma,(function(e){return e.style})),E.ShapeStyle),(function(e){return e.strokeWeightMultiplierMax})))||null!=e?e:E.ShapeStyle.STROKE_WEIGHT_MULTIPLIER_MAX_DEFAULT}},duplicatable:{get:function(){return this.forma.hasIntent(f.Forma.INTENT_ICON)}},selectable:{get:function(){return null==this.forma||null==M.TheoDocumentUtils.getCellBackgroundImage(this.forma)}},rotateable:{get:function(){return this.forma.hasIntent(f.Forma.INTENT_ICON)||this.forma.hasIntent(f.Forma.INTENT_FLOATING_SHAPE)}},moveable:{get:function(){return null!=this.forma.allowUserMove?this.forma.allowUserMove:!(!this.forma.hasIntent(f.Forma.INTENT_ICON)&&!this.forma.hasIntent(f.Forma.INTENT_FLOATING_SHAPE))||((e=i.as(i.opt(i.opt(this.forma,(function(e){return e.parent})),(function(e){return e.controller})),A.GridController))?e.canMoveShape(this.forma):m.FormaController._getters.moveable.call(this));var e}},floating:{get:function(){return!(!this.forma.hasIntent(f.Forma.INTENT_ICON)&&!this.forma.hasIntent(f.Forma.INTENT_FLOATING_SHAPE))||!this.forma.hasIntent(f.Forma.INTENT_GRID_CELL)&&m.FormaController._getters.floating.call(this)}},deleteable:{get:function(){var e,t,o,n,r=this;return i.opt(this.forma,(function(e){return null!=e.controller&&r.forma.isGridCell()}))&&(e=i.as(i.opt(this.forma,(function(e){return e.root})),R.RootForma))&&(t=i.opt(i.as(e.controller,_.RootController),(function(e){return e.getGridController()})))?1==t.gridStyle.numBackgroundCells&&(o=i.opt(this.forma,(function(e){return e.finalFrame})))&&(n=i.opt(i.opt(this.forma,(function(e){return e.root})),(function(e){return e.finalFrame})))?!o.equal(n):t.canDeleteCellForForma(this.forma):m.FormaController._getters.deleteable.call(this)}},replaceable:{get:function(){return!(!i.opt(this.forma,(function(e){return null!=e.controller}))||this.forma.isGridCell()&&this.forma.controller.moveable)}},flippable:{get:function(){return this.forma.hasIntent(f.Forma.INTENT_ICON)}},nudgeable:{get:function(){return this.forma.hasIntent(f.Forma.INTENT_ICON)}},maintainAspectRatio:{get:function(){var e,t,o=this.forma;return o.hasIntent(f.Forma.INTENT_IMAGE_MASK)&&null!=(t=i.opt(i.as(this.forma,D.ShapeForma),(function(e){return e.shapeLibraryID})))&&(e=l.CropAssetLibrary.getCropShapeFromID(t))?e.fixAspectRatio:null!=o.sliceBox&&(null==(t=i.opt(i.as(this.forma,D.ShapeForma),(function(e){return e.shapeLibraryID})))||0==t.length)||o.hasIntent(f.Forma.INTENT_ICON)}},selectionHandlePositions:{get:function(){var e=this.forma,t=e.sliceBox;if(e.hasIntent(f.Forma.INTENT_GRID_CELL)||null!=t){var o;if(o=t){if(0==o.width)return[new N.TheoPoint(.5,0),new N.TheoPoint(.5,1)];if(0==o.height)return[new N.TheoPoint(1,.5),new N.TheoPoint(0,.5)]}return[new N.TheoPoint(.5,0),new N.TheoPoint(.5,1),new N.TheoPoint(1,.5),new N.TheoPoint(0,.5)]}return m.FormaController._getters.selectionHandlePositions.call(this)}},processEndFormaResize:function(e){m.FormaController.prototype.processEndFormaResize.call(this,e),this.updateParentGroup(),this.updateShapeMask()},processEvent:function(e){var t;return(t=i.as(e,v.BeginPointerTrackingEvent))?(t.trackingResponse=y.BeginPointerTrackingResponseEnum.TrackAsGroup,!1):m.FormaController.prototype.processEvent.call(this,e)},processFormaDoubleClick:function(e){this.owner.selection.replaceSelection(e.forma),this.owner.controllerSettingsState.settings=new h.ShapeControllerSettings(this)},addForma:function(e,t,o){var n,r;if(r=i.as(e.root,R.RootForma)){for(var a,l=i.clone(r.filterWithCallback((function(e){return e.isTypeLockup()}))),s=null,u=i.iter(l);!u.done;u.next()){var h;(h=u.value.style.colors.fieldPrimary)&&(s=h)}if(a=i.as(t,D.ShapeForma)){var d,p;if(d=L.GridFacade.getPageGrid(t.page,!0))if(d.forma.appendChild(a),p=o.atPagePoint){var f,m=r.frame.minX+p.x,y=r.frame.minY+p.y,v=r.frame.width/4,C=r.frame.height/4,T=Math.min(v,C),A=1,F=T,k=T;(f=t.bounds)&&((A=f.width/f.height)>1?k=F/A:F=k*A);var b=new G.TheoRect(m-F/2,y-k/2,m+F/2,y+k/2);this.fit(b)}else if(o.suggestPlacement){var _=new S.FormaPlacementSuggester(a,r);((n=i.opt(a.controller,(function(e){return e.maintainAspectRatio})))||null!=n)&&n&&(A=a.bounds.aspectRatio);var I=i.clone(_.createPlacementSuggestions(!0,A));I.length>0&&I[0].apply()}null==a.preScale&&(a.preScale=this.getInitialPrescale())}return null==s?i.opt(this.forma,(function(e){return e.style.colors.setColorId(g.ColorRole.FieldPrimary,r.page.colorLibraryController.getThemeColorKeys()[0])})):i.opt(this.forma,(function(e){return e.style.colors.setColor(g.ColorRole.FieldPrimary,s)})),this.contrastCheck(!1),c.CorePromise.resolve(null)}return c.CorePromise.reject("failed to get critical references")},getSuggestableColors:function(){for(var e=this.forma.page.colorLibraryController,t=i.clone(e.getColorThemeAsArrayOfTheoColors()),o=[],n=this.getBackgroundColor(),r=i.iter(t);!r.done;r.next()){var a=r.value;if(!a.isBrandkitColor()){if(this.floating&&null!=n&&!n.contrasts(a.rgbColor,!1))continue;o.push([a])}}return o},getInitialPrescale:function(){var e,t=1;if(e=i.as(this.forma,D.ShapeForma)){var o=e.size,n=e.canonicalArtwork.bounds;t=Math.min(o.width/n.width,o.height/n.height)}return t},onEvent:function(e){var t,o;if((t=i.as(e,v.FormaResizeEvent))&&(o=i.as(this.forma,D.ShapeForma))){var n=o.size;null==o.preScale&&(o.preScale=this.getInitialPrescale()),this.processFormaResize(t);var r=o.size;.5!=t.pin.x&&.5!=t.pin.y&&(o.preScale=o.preScale*r.width/n.width)}m.FormaController.prototype.onEvent.call(this,e)},fit:function(e){var t;(t=i.as(this.forma,D.ShapeForma))&&(t.size=this.maintainAspectRatio?e.fitAspectRatioWithin(t.bounds.aspectRatio):e.size,t.placement=b.Matrix2D.Identity,t.moveCenterToPoint(e.center))},setNewShape:function(e){var t=new T.FormaGeometryChangedEvent(this.forma);this.forma.beginUpdate(t),P.ShapeLibrary.applyToShapeForma(this.forma,e),this.forma.endUpdate(t)},styleChanged:function(){!this.blockUpdate&&this.forma.isGridCell()&&i.opt(i.as(i.opt(i.opt(this.forma,(function(e){return e.parent})),(function(e){return e.controller})),A.GridController),(function(e){return e.updateGridColors()}))},copyTo:function(e,t,o,r){void 0===e&&(e=null),void 0===t&&(t=null),void 0===o&&(o=null),void 0===r&&(r=!0);var a,l,s=this;if(l=i.as(this.forma,D.ShapeForma)){var h=e||l.page,d=h.createFormaWithController(D.ShapeForma.KIND,n.KIND);return d.match(l),u.CreationFacade.addForma(h,d,new u.AddFormaParams(void 0,!(!(a=t)&&null==a)&&a,void 0,void 0,void 0,null,l.page!=h)).then((function(e){d.style.match(l.style),d.intent=l.intent;var t,o,n,r,a,c=l.contentID;return(t=l.page.document)&&(o=h.document)&&t!=o&&null!=(n=l.contentID)&&(r=t.content.nodeByID(n))&&(a=i.as(o.content.createNode(B.VectorContentNode.KIND,null),B.VectorContentNode))&&(u.CreationFacade.addContentNodeToDocument(a,o),a.match(r),c=a.contentID),d.contentID=c,d.removeArtworkSized(),s.updateParentGroup(),d}))}return c.CorePromise.reject("Why calling ShapeController.duplicate but not for a shape forma?")},shuffleColorAssignment:function(){var e,t;if((e=i.as(this.forma,D.ShapeForma))&&(t=e.parent))if(A.GridController.isBackgroundColoredCell(e)){var o,n;(o=i.as(t.controller,A.GridController))&&(n=o.getContrastingColorForCell(e))&&this.applyColors([n])}else{var r=null,a=M.TheoDocumentUtils.enableFastHeuristicsForComplexPage(e.page);(a||C.FormaSourceUtils.isDesignIngredient(e.source))&&(r=i.clone(I.InferredRole.init_84d1(I.InferredRoleType.GraphicContent,1,I.InferredRoleType.Background,0)));var l,s=new d.ProfilingPrimaryColorSelector(e,!1);if(!a&&(l=this.userGroupRoot)){var u=i.clone(this.getBackgroundColors());l.visit(f.FormaTraversal.PreOrder,(function(t,o,n){var r;return t==e||t instanceof F.GroupForma||!t.isShape()||k.GeometryFacade.formaBoundsIntersect(e,t)||(r=i.opt(t.controller,(function(e){return e.getBackgroundColors()})))&&i.append(u,r),!1})),s.updateBackgroundColors(u)}var c=s.selectColorForGlobalRecolor(void 0,void 0,void 0,r);e.style.colors.setColorId(g.ColorRole.FieldPrimary,c),this.secondaryColorVisible()?this.assignStrokeColor():e.style.colors.setColorId(g.ColorRole.FieldSecondary,c)}},assignStrokeColor:function(){var e;if(e=i.as(this.forma,D.ShapeForma)){for(var t=e.style.colors.colorID(g.ColorRole.FieldPrimary),o=null,n=this.forma.page.colorLibraryController,r=this.getBackgroundColor(),a=i.iter(n.getThemeColorKeys());!a.done;a.next()){var l,s=a.value;if(t!=s&&(l=n.getSolidColorForKey(s))&&null!=r&&l.contrasts(r,!1)){o=s;break}}null!=o?e.style.colors.setColorId(g.ColorRole.FieldSecondary,o):e.style.colors.setColor(g.ColorRole.FieldSecondary,w.SolidColor.BLACK)}},canHaveNoneFillColor:function(){return this.floating&&this.primaryColorVisible()&&this.secondaryColorVisible()&&!this.hasNoneStrokeColor()},hasNoneFillColor:function(){var e;return!(!(e=i.as(this.forma,D.ShapeForma))||!this.primaryColorVisible()||null!=e.style.colors.color(g.ColorRole.FieldPrimary))},canHaveNoneStrokeColor:function(){return this.floating&&this.primaryColorVisible()&&this.secondaryColorVisible()&&!this.hasNoneFillColor()&&0==this.strokeWeightMultiplierMin},hasNoneStrokeColor:function(){var e;return!(!(e=i.as(this.forma,D.ShapeForma))||!this.secondaryColorVisible()||null!=e.style.colors.color(g.ColorRole.FieldSecondary))},primaryColorVisible:function(){var e,t=(e=i.opt(i.as(i.opt(this.forma,(function(e){return e.style})),E.ShapeStyle),(function(e){return e.shapeType})))||null!=e?e:E.ShapeType.Fill;return t==E.ShapeType.Fill||t==E.ShapeType.FillAndStroke},secondaryColorVisible:function(){var e,t=(e=i.opt(i.as(i.opt(this.forma,(function(e){return e.style})),E.ShapeStyle),(function(e){return e.shapeType})))||null!=e?e:E.ShapeType.Fill;return t==E.ShapeType.Stroke||t==E.ShapeType.FillAndStroke},getCurrentColorsWithRole:function(e,t){void 0===t&&(t=!1);var o,n,r=[];return(o=e.colors.color(g.ColorRole.FieldPrimary))?r.push(new p.SolidColorWithRole(g.ColorRole.FieldPrimary,o)):this.hasNoneFillColor()&&r.push(new p.SolidColorWithRole(g.ColorRole.FieldPrimary,w.SolidColor.ZERO)),(n=e.colors.color(g.ColorRole.FieldSecondary))?r.push(new p.SolidColorWithRole(g.ColorRole.FieldSecondary,n)):this.hasNoneStrokeColor()&&r.push(new p.SolidColorWithRole(g.ColorRole.FieldSecondary,w.SolidColor.ZERO)),r},applyColors:function(e,t){void 0===t&&(t=g.ColorRole.FieldPrimary),m.FormaController.prototype.applyColors.call(this,e,t),a.BadgeFacade.logColorChange(i.opt(this.forma,(function(e){return e.source})))},applyColorsWithRole:function(e){var t;if(t=this.forma){for(var o=t.page.colorLibraryController,n=[],r=i.iter(e);!r.done;r.next()){var a=r.value;i.eq(w._equality_SolidColor_SolidColor,a.color,w.SolidColor.ZERO)?s.ColorFacade.applyNoneColorToFormae([t],a.role):n.push(a)}if(n.length>0){for(var l=i.clone(o.addColorsWithRoleToTheme(n,t)),u=[],c=i.iter(l);!c.done;c.next()){var h=c.value;u.push({key:h.role,value:h.color})}t.style.colors.setColorIDs(u)}}},containsPoint:function(e,t){var o;void 0===t&&(t=0);var n,r,a=t;if(((o=i.opt(this.forma,(function(e){return e.isLine()})))||null!=o)&&o){var l,s=1;(l=i.opt(this.forma.page.view,(function(e){return e.getViewportTransform()})))&&(s=Math.sqrt(Math.abs(l.determinant))),a=10/s}if(!m.FormaController.prototype.containsPoint.call(this,e,a))return!1;if((n=i.opt(i.as(this.forma,D.ShapeForma),(function(e){return e.maskImage})))&&(r=this.forma.bounds)){if(n.isEmpty())return!0;var u,c=new G.TheoRect(0,0,i.toDouble(n.width),i.toDouble(n.height)),h=new N.TheoPoint((e.x-r.minX)/r.width*c.width,(e.y-r.minY)/r.height*c.height),d=.05*Math.max(c.width,c.height),g=new G.TheoRect(h.x-d,h.y-d,h.x+d,h.y+d);return!!(u=c.intersectionWith(g))&&n.sumRegion(u)>1e-5}return!0},updateShapeMask:function(){}}}),n)},"JU+l":function(e,t,o){var n,r,i,a,l=t,s=o("oAGj"),u=o("wNKJ"),c=o("FNB+"),h=o("Pil/"),d=o("P83h"),g=o("ZK0l"),p=o("pnSN"),f=o("H1Z2"),m=o("NkBu"),y=o("fNpk"),v=o("MYNe"),S=o("tGKA"),C=o("JFv5"),T=o("voLh"),A=o("djAF"),F=o("fiuZ"),k=o("T6jX"),L=o("oKlP"),b=o("sIWg");l.IResizeHandler=s.defineProtocol("IResizeHandler",{handleBeginSelectionBoxResize:"(BoxReference, TheoPoint) -> Void",handleSelectionBoxResize:"(BoxReference, TheoPoint, TheoPoint, Double) -> Void",handleEndSelectionBoxResize:"(BoxReference, TheoPoint) -> Void"}),l.NullResizeHandler=(n=function(){},r={},s.defineClass({name:"NullResizeHandler",ctor:n,statics:{instance:{get:function(){return void 0===r.instance&&(r.instance=new n),r.instance}},_implements:function(e){return"IResizeHandler"==e}},props:{handleBeginSelectionBoxResize:function(e,t){},handleSelectionBoxResize:function(e,t,o,n){},handleEndSelectionBoxResize:function(e,t){}}}),n),l.locate=function(e,t,o){return new L.TheoPoint((e.x-t.x)/(o.x-t.x),(e.y-t.y)/(o.y-t.y))},l.eval=function(e,t,o){return new L.TheoPoint((1-e.x)*t.x+e.x*o.x,(1-e.y)*t.y+e.y*o.y)},l.SingleItemResizeHandler=(i=function(e,t,o,n){this.dc=e,this.model=t,this.forma=o,this.delegate=n},s.defineClass({name:"SingleItemResizeHandler",ctor:i,statics:{_implements:function(e){return"IResizeHandler"==e}},props:{handleBeginSelectionBoxResize:function(e,t){var o=this;s.opt(this.dc,(function(e){return e.undoRedoMgr.beginGesture()})),s.opt(this.forma.controller,(function(e){return e.onEvent(new h.BeginFormaResizeEvent(o.forma,t))}))},handleSelectionBoxResize:function(e,t,o,n){var r,i,a,u=this,c=Math.sqrt(Math.abs(e.placement.determinant))*Math.abs(n),h=new L.TheoPoint(1-t.x,1-t.y),d=e.bounds,g=e.placement.inverse.transformPoint(o),p=!(r=s.opt(this.forma.controller,(function(e){return e.maintainAspectRatio})))&&null==r||r,y=l.locate(g,e.bounds.eval(h),e.bounds.eval(t));if(isFinite(y.x)&&y.x<0||isFinite(y.y)&&y.y<0){if(0!=p)return;if(isFinite(y.x)&&y.x<0&&y.x>-1&&(y=new L.TheoPoint(1,y.y)),isFinite(y.y)&&y.y<0&&y.y>-1&&(y=new L.TheoPoint(y.x,1)),isFinite(y.x)&&y.x<0||isFinite(y.y)&&y.y<0)return;g=e.bounds.eval(y)}a=.5==t.x?b.TheoRect.fromPoints(d.evalXY(0,h.y),new L.TheoPoint(d.maxX,g.y)):.5==t.y?b.TheoRect.fromPoints(d.evalXY(h.x,0),new L.TheoPoint(g.x,d.maxY)):b.TheoRect.fromPoints(d.eval(h),g);var v=this.forma.placement.extractedScale;a=a.scaleXY(v.scale.x,v.scale.y);var S,C,T,k=50/c,_=10/c;if(this.forma.controller instanceof m.ImageController)k=100/c,_=100/c;else if((T=s.as(this.forma,A.ShapeForma))&&(.5==t.x||.5==t.y)){var R,I;if((R=T.sliceBox)&&(I=T.canonicalArtwork.bounds)){var w=F.ShapeFacade.getCornerOrInitialPrescaleForForma(T);R.width>0&&.5==t.y?S=(I.width-R.width)*w:R.height>0&&.5==t.x&&(C=(I.height-R.height)*w)}T.maskImage=null}if(null!=S&&a.width<S)if(0==t.x)a=new b.TheoRect(a.maxX-S,a.minY,a.maxX,a.maxY);else{if(1!=t.x)return;a=new b.TheoRect(a.minX,a.minY,a.minX+S,a.maxY)}if(null!=C&&a.height<C)if(0==t.y)a=new b.TheoRect(a.minX,a.minY,a.maxX,a.minY+C);else{if(1!=t.y)return;a=new b.TheoRect(a.minX,a.maxY-C,a.maxX,a.maxY)}var D=this.forma.isLine();if(a.width<_&&0==D){var x=_/a.width;a=a.scaleXY(x,1,h)}a.height<_&&0==D&&(x=_/a.height,a=a.scaleXY(1,x,h));var P=d.width+d.height,E=a.width+a.height;a.width<d.width&&a.width<_||a.height<d.height&&a.height<_||E<P&&E<k||s.opt(this.dc,(function(e){return e.doActionWithCompletion(new f.ResizeHandleAction(u.forma,t,h,a,!(!(i=s.opt(u.dc,(function(e){return e.selection.inSpacingMode})))&&null==i)&&i),(function(e,t){var o,n;(o=u.model)&&(n=u.delegate)&&(o.beginUpdates(),n.handles.updateHandles(o.mutable.handles),o.updatesComplete())}))}))},handleEndSelectionBoxResize:function(e,t){var o,n=this;s.opt(this.dc,(function(e){return e.undoRedoMgr.endGesture(!0)}));var r=s.opt(s.opt(this.dc,(function(e){return e.document})),(function(e){return e.beginTransaction("finish_resize")}));s.opt(this.forma.controller,(function(e){return e.onEvent(new h.EndFormaResizeEvent(n.forma))}));var i=new L.TheoPoint(1-t.x,1-t.y);0==(!(o=s.opt(this.forma.controller,(function(e){return e.maintainAspectRatio})))&&null==o||o)&&(0!=i.x&&1!=i.x||(i=new L.TheoPoint(i.x,.5))),u.DragFacade.rescueFormaToPageBounds(this.forma,void 0,void 0,i),s.opt(r,(function(e){return e.mergeWithPrevious()}))}}}),i),l.MultiObjectResizeHandler=(a=function(e,t,o,n){this.group_=null,this.passedARThreshold_=!1,this.dc=e,this.model=t,this.formae_=v.LayerFacade.sortInZOrder(o).filter((function(e){return null!=e.controller}),this),this.delegate=n},s.defineClass({name:"MultiObjectResizeHandler",ctor:a,statics:{_implements:function(e){return"IResizeHandler"==e}},props:{handleBeginSelectionBoxResize:function(e,t){var o,n;if(0!=this.formae_.length){var r=s.opt(s.opt(this.dc,(function(e){return e.document})),(function(e){return e.beginTransaction("create_resize_group")}));this.passedARThreshold_=!1;for(var i,a,l,u,d,f,m=!0,v=null,A=s.iter(this.formae_);!A.done;A.next()){var F=A.value;((o=s.opt(F.controller,(function(e){return e.userGroupMember})))||null!=o)&&o?null==v?v=F.controller.enableChildMove?F.controller.userGroup?s.as(F,p.GroupForma):F.parent:F.controller.userGroupRoot||s.as(F,p.GroupForma):v!=F.parent&&(m=!1):m=!1}if(m&&(i=v)&&(a=i.finalFrame))return this.group_=i,this.startSize_=a.size,(d=i.controller).preferredResizeType=C.ResizeLayoutType.Proportional,d.preserveResizeController=!0,s.opt(r,(function(e){return e.end()})),void s.opt(this.dc,(function(e){return e.undoRedoMgr.beginGesture()}));if(this.group_=s.as(s.opt(this.formae_[0].parent,(function(e){return e.page.createFormaWithController(p.GroupForma.KIND,g.GroupController.KIND)})),p.GroupForma),(l=this.formae_[0].parent)&&(u=this.group_)&&(d=s.as(u.controller,g.GroupController))&&(f=k.TheoDocumentUtils.unionFinalFrame(this.formae_))){var L=(n=l.indexOfChild(this.formae_[0]))||null!=n?n:l.childCount;l.insertChildAt(u,L),d.preferredResizeType=C.ResizeLayoutType.Proportional,d.preserveResizeController=!0,u.placement=S.Matrix2D.translationXY(f.minX,f.minY),u.bounds=b.TheoRect.fromSize(f.size),u.intent=c.Forma.INTENT_INFERRED_TEMP_GROUP;for(var _=s.iter(this.formae_);!_.done;_.next())F=_.value,u.appendChild(F,!0);s.opt(s.as(d.resizeLayoutController,T.ProportionalLayoutController),(function(e){return e.setInitBounds()})),this.startSize_=f.size,d.onEvent(new h.BeginFormaResizeEvent(u,t)),s.opt(this.dc,(function(e){return e.selection.selectForma(u,!1)}))}s.opt(r,(function(e){return e.end()})),s.opt(this.dc,(function(e){return e.undoRedoMgr.beginGesture()}))}else y.LegacyCoreAssert.fail("no children to multi-select resize",void 0,"MultiObjectResizeHandler.handleBeginSelectionBoxResize","ResizeHandler.swift",266)},handleSelectionBoxResize:function(e,t,o,n){var r=this;if(null!=this.group_){var i=Math.sqrt(Math.abs(e.placement.determinant))*Math.abs(n),a=new L.TheoPoint(1-t.x,1-t.y),u=e.bounds,c=e.placement.inverse.transformPoint(o),h=l.locate(c,e.bounds.eval(a),e.bounds.eval(t));if(!(isFinite(h.x)&&h.x<0||isFinite(h.y)&&h.y<0)){var g,p=50/i,m=10/i;if(!((g=.5==t.x?b.TheoRect.fromPoints(u.evalXY(0,a.y),new L.TheoPoint(u.maxX,c.y)):.5==t.y?b.TheoRect.fromPoints(u.evalXY(a.x,0),new L.TheoPoint(c.x,u.maxY)):b.TheoRect.fromPoints(u.eval(a),c)).width<m||g.height<m||g.width+g.height<p)){var y=g.size;if(null!=this.startSize_){var v=this.startSize_.similarity(y);v<.04?(v<.01&&(this.passedARThreshold_=!1),this.passedARThreshold_||(y=this.startSize_.myAspectRatioClosestCorner(y))):this.passedARThreshold_=!0}var S=new d.FormaAnimationTransactionEvent(this.group_);S.duration=0,this.group_.beginUpdate(S),s.opt(this.dc,(function(e){return e.doActionWithCompletion(new f.ResizeHandleAction(r.group_,t,a,b.TheoRect.fromSize(y)),(function(e,t){var o,n,i;(o=r.group_)&&o.endUpdate(S),(n=r.model)&&(i=r.delegate)&&(n.beginUpdates(),i.handles.updateHandles(n.mutable.handles),n.updatesComplete())}))}))}}}},handleEndSelectionBoxResize:function(e,t){var o,n,r=this;s.opt(this.dc,(function(e){return e.undoRedoMgr.endGesture(!0)}));var i=s.opt(s.opt(this.dc,(function(e){return e.document})),(function(e){return e.beginTransaction("create_resize_group")}));if(s.opt(s.opt(this.group_,(function(e){return e.controller})),(function(e){return e.onEvent(new h.EndFormaResizeEvent(r.group_))})),!(o=s.opt(s.opt(this.group_,(function(e){return e.controller})),(function(e){return e.userGroup})))&&null==o||!o){s.opt(this.dc,(function(e){return e.selection.deselectForma(r.group_,!1)}));for(var a=s.iter(this.formae_);!a.done;a.next()){var l=a.value,u=(n=this.group_.parent.indexOfChild(this.group_))||null!=n?n:this.group_.childCount;this.group_.parent.insertChildAt(l,u,!0)}s.opt(this.group_,(function(e){return e.removeFromParent()})),this.group_=null}s.opt(i,(function(e){return e.mergeWithPrevious()}))}}}),a)},JgVS:function(e,t,o){var n,r,i=t,a=o("oAGj"),l=o("fNpk");i.DecorationResults=(n=function(e){this.items=a.clone(e)},a.defineClass({name:"DecorationResults",ctor:n}),n),i.LockupDecorationStrategy=a.defineProtocol("LockupDecorationStrategy",{supportsConfiguration:"(LockupConfiguration) -> Boolean",decorate:"(LockupConfiguration, LayoutResults) -> DecorationResults"}),i.BaseDecorationStrategy=(r=function(){},a.defineClass({name:"BaseDecorationStrategy",ctor:r,statics:{getHorizontalOffsetForItalicAngle:function(e,t){var o=Math.abs(t),n=(180-o-90)*Math.PI/180,r=o*Math.PI/180,i=e/Math.sin(n)*Math.sin(r);return(i>e||i<0)&&(i=e/2),i},_implements:function(e){return"LockupDecorationStrategy"==e}},props:{supportsConfiguration:function(e){return l.LegacyCoreAssert.fail("Implement in subclass",void 0,"BaseDecorationStrategy.supportsConfiguration","LockupDecorationStrategy.swift",31),!1},decorate:function(e,t){return l.LegacyCoreAssert.fail("Implement in subclass",void 0,"BaseDecorationStrategy.decorate","LockupDecorationStrategy.swift",36),new i.DecorationResults([])}}}),r)},JzRL:function(e,t,o){var n,r,i,a=t,l=o("oAGj");a.IActivePageHandler=l.defineProtocol("IActivePageHandler",{reset:"() -> Void",set:"(FormaPage) -> Void"}),a.NullActivePageHandler=(n=function(){},r={},l.defineClass({name:"NullActivePageHandler",ctor:n,statics:{instance:{get:function(){return void 0===r.instance&&(r.instance=new n),r.instance}},_implements:function(e){return"IActivePageHandler"==e}},props:{reset:function(){},set:function(e){}}}),n),a.StandardActivePageHandler=(i=function(e,t){this.dc=e,this.model=t},l.defineClass({name:"StandardActivePageHandler",ctor:i,statics:{_implements:function(e){return"IActivePageHandler"==e}},props:{reset:function(){l.opt(this.model,(function(e){return e.beginUpdates()})),l.opt(this.model,(function(e){return e.mutable.activePage.reset()})),l.opt(this.model,(function(e){return e.updatesComplete()}))},set:function(e){l.opt(this.model,(function(e){return e.beginUpdates()})),l.opt(this.model,(function(t){return t.mutable.activePage.set(e)})),l.opt(this.model,(function(e){return e.updatesComplete()})),l.opt(l.opt(e.document,(function(e){return e.controller})),(function(t){return t.subscribeToPage(e)}))}}}),i)},KIfs:function(e,t,o){var n,r,i,a=t,l=o("oAGj"),s=o("gXiO"),u=o("fWxZ"),c=o("iCxV"),h=o("fNpk"),d=o("tGKA"),g=o("g8Fi"),p=o("oKlP");a.kAllowMultipleDragsInFlight=!1,a.debug_print=function(e,t,o){void 0===t&&(t=" "),void 0===o&&(o="\n")},a.debug_print=function(e,t,o,n){void 0===o&&(o=" "),void 0===n&&(n="\n")},a.debug_print=function(e,t,o,n,r){void 0===n&&(n=" "),void 0===r&&(r="\n")},a.debug_print=function(e,t,o,n,r,i){void 0===r&&(r=" "),void 0===i&&(i="\n")},a.debug_print=function(e,t,o,n,r,i,a){void 0===i&&(i=" "),void 0===a&&(a="\n")},a.debug_print=function(e,t,o,n,r,i,a,l){void 0===a&&(a=" "),void 0===l&&(l="\n")},a.debug_print=function(e,t,o,n,r,i,a,l,s){void 0===l&&(l=" "),void 0===s&&(s="\n")},a.debug_print=function(e,t,o,n,r,i,a,l,s,u){void 0===s&&(s=" "),void 0===u&&(u="\n")},a.debug_print=function(e,t,o,n,r,i,a,l,s,u,c){void 0===u&&(u=" "),void 0===c&&(c="\n")},a.debug_print=function(e,t,o,n,r,i,a,l,s,u,c,h){void 0===c&&(c=" "),void 0===h&&(h="\n")},a.dot=function(e,t){return e.dotProduct(t)},a.cross=function(e,t){return e.x*t.y-e.y*t.x},a.concat=function(e,t,o){return d.Matrix2D.concat2(d.Matrix2D.concat2(e,t),o)},a.scale=function(e,t){return new p.TheoPoint(e*t.x,e*t.y)},a.blend=function(e,t,o){return a.scale(1-t,e).add(a.scale(t,o))},a.midpoint=function(e,t){return a.blend(e,.5,t)},a.moveBy=function(e){return d.Matrix2D.translation(e)},a.move=function(e,t){return a.moveBy(t.subtract(e))},a.PointerDrag=(n=function(e,t){this.begin=e,this.end=t},l.defineClass({name:"PointerDrag",ctor:n}),n),a.freeMovement_=function(e){if(1==e.length)return{movement:a.move(e[0].begin,e[0].end),rise:0,run:1};if(e.length>=2){var t=e[1].begin.subtract(e[0].begin),o=e[1].end.subtract(e[0].end);if(t.equal(p.TheoPoint.ZERO)&&o.equal(p.TheoPoint.ZERO))return{movement:a.move(e[0].begin,e[0].end),rise:0,run:1};if(t.equal(p.TheoPoint.ZERO))return{movement:a.move(e[0].begin,e[0].end),rise:0,run:1};var n=a.dot(t,t),r=a.dot(t,o),i=a.cross(t,o),l=r/n,s=i/n,u=new d.Matrix2D(l,s,-s,l,0,0),c=a.concat(a.moveBy(e[0].begin.invert()),u,a.moveBy(e[0].end));return h.LegacyCoreAssert.isTrue(0!=c.determinant,"free movement matrix determinant should've been 0",void 0,"freeMovement_","PointerStateMachine.swift",269),{movement:c,rise:i,run:r}}return{movement:d.Matrix2D.Identity,rise:0,run:1}},a.MoorePenrose10011001=function(e,t,o,n,r,i,a,s){var u=e-o,c=t-n,h=u*u,d=c*c,g=2*(h+d),p=c*(e+o),f=u*(t+n),m=[[2*u,2*c,-2*u,-2*c],[d-2*o*u,-p,d+2*e*u,p],[-f,h-2*n*c,f,h+2*t*c]];m=m.map((function(e){return e.map((function(e){return e/g}),this)}),this);var y=m.map((function(e){return function(e,t){return l.zip(e,t).map((function(e){return e[0]*e[1]}),this).reduce((function(e,t){return e+t}),0)}(e,[r,i,a,s])}),this);return{u:y[0],v:y[1],w:y[2]}},a.noRotation_=function(e){if(1==e.length)return a.move(e[0].begin,e[0].end);if(2==e.length){var t=e[1].begin.subtract(e[0].begin),o=e[1].end.subtract(e[0].end);if(t.equal(p.TheoPoint.ZERO)&&o.equal(p.TheoPoint.ZERO))return a.move(e[0].begin,e[0].end);if(t.equal(p.TheoPoint.ZERO))return a.move(e[0].begin,e[0].end);var n=a.MoorePenrose10011001(e[0].begin.x,e[0].begin.y,e[1].begin.x,e[1].begin.y,e[0].end.x,e[0].end.y,e[1].end.x,e[1].end.y),r=n.u,i=n.v,l=n.w;return new d.Matrix2D(r,0,0,r,i,l)}if(e.length>2){var s=a.noRotation_([e[0],e[1]]),u=a.noRotation_([e[0],e[2]]),c=a.noRotation_([e[1],e[2]]);return s.averageTranslationScale([s,u,c])}return d.Matrix2D.Identity},a.noRotation2_=function(e,t){if(1==e.length)return a.move(e[0].begin,e[0].end);if(e.length>=2){var o=e[1].begin.subtract(e[0].begin),n=e[1].end.subtract(e[0].end);if(o.equal(p.TheoPoint.ZERO)&&n.equal(p.TheoPoint.ZERO))return a.move(e[0].begin,e[0].end);if(o.equal(p.TheoPoint.ZERO))return a.move(e[0].begin,e[0].end);var r=a.MoorePenrose10011001(e[0].begin.x,e[0].begin.y,e[1].begin.x,e[1].begin.y,e[0].end.x,e[0].end.y,e[1].end.x,e[1].end.y),i=r.u;r.v,r.w;return a.concat(a.moveBy(t.invert()),new d.Matrix2D(i,0,0,i,0,0),a.moveBy(t))}return d.Matrix2D.Identity},a.noScale_=function(e){if(1==e.length)return a.move(e[0].begin,e[0].end);if(e.length>=2){var t=e[1].begin.subtract(e[0].begin),o=e[1].end.subtract(e[0].end);if(t.equal(p.TheoPoint.ZERO)&&o.equal(p.TheoPoint.ZERO))return a.move(e[0].begin,e[0].end);if(t.equal(p.TheoPoint.ZERO))return a.move(e[0].begin,e[0].end);var n=a.MoorePenrose10011001(-e[0].begin.y,e[0].begin.x,-e[1].begin.y,e[1].begin.x,e[0].end.x-e[0].begin.x,e[0].end.y-e[0].begin.y,e[1].end.x-e[1].begin.x,e[1].end.y-e[1].begin.y),r=n.u,i=n.v,l=n.w;return new d.Matrix2D(Math.cos(r),Math.sin(r),-Math.sin(r),Math.cos(r),i,l)}return d.Matrix2D.Identity},a.noScale2_=function(e){if(1==e.length)return a.move(e[0].begin,e[0].end);if(e.length>=2){var t=e[1].begin.subtract(e[0].begin),o=e[1].end.subtract(e[0].end);if(t.equal(p.TheoPoint.ZERO)&&o.equal(p.TheoPoint.ZERO))return a.move(e[0].begin,e[0].end);if(t.equal(p.TheoPoint.ZERO))return a.move(e[0].begin,e[0].end);var n=a.dot(t,t),r=a.dot(o,o),i=a.dot(t,o),l=a.cross(t,o),s=Math.sqrt(n*r),u=i/s,c=l/s,g=new d.Matrix2D(u,c,-c,u,0,0),f=a.concat(a.moveBy(a.midpoint(e[0].begin,e[1].begin).invert()),g,a.moveBy(a.midpoint(e[0].end,e[1].end)));return h.LegacyCoreAssert.isTrue(0!=f.determinant,"noScale2 result matrix determinant should've been 0",void 0,"noScale2_","PointerStateMachine.swift",633),f}return d.Matrix2D.Identity},a.noScale3_=function(e,t){if(1==e.length)return a.move(e[0].begin,e[0].end);if(e.length>=2){var o=e[1].begin.subtract(e[0].begin),n=e[1].end.subtract(e[0].end);if(o.equal(p.TheoPoint.ZERO)&&n.equal(p.TheoPoint.ZERO))return a.move(e[0].begin,e[0].end);if(o.equal(p.TheoPoint.ZERO))return a.move(e[0].begin,e[0].end);var r=a.dot(o,o),i=a.dot(n,n),l=a.dot(o,n),s=a.cross(o,n),u=Math.sqrt(r*i),c=l/u,g=s/u,f=new d.Matrix2D(c,g,-g,c,0,0),m=a.concat(a.moveBy(t.invert()),f,a.moveBy(t));return h.LegacyCoreAssert.isTrue(0!=m.determinant,"noScale3 result matrix determinant should've been 0",void 0,"noScale3_","PointerStateMachine.swift",674),m}return d.Matrix2D.Identity},a.closestApproach_=function(e,t,o,n){var r=e.subtract(o),i=n.subtract(t),l=a.dot(i,i);return 0==l?{distance:Math.sqrt(a.dot(r,r)),time:0}:{distance:a.cross(i,r)/Math.sqrt(l),time:a.dot(i,r)/l}},a.DragPace=l.defineEnum("DragPace",{StoppedPace:0,SlowPace:1,MediumPace:2,FastPace:3}),a.DragMode=l.defineEnum("DragMode",{UniformScaleNoSkew:0,NoScaleNoSkew:1,UniformScaleNoRotationNoSkew:2}),a.ActiveDragDelegateProtocol=l.defineProtocol("ActiveDragDelegateProtocol",{modifierKeys:"Dictionary<String>",activeDragDidBegin:"(ActiveDrag) -> Void",activeDragDidActivate:"(ActiveDrag) -> Boolean",activeDragDidDeactivate:"(ActiveDrag, Boolean) -> Void",activeDragClaimNewPointers:"(ActiveDrag, Array<PointerState>, Boolean) -> Array<PointerState>",activeDragDidCommit:"(ActiveDrag) -> Void",activeDragDidMove:"(ActiveDrag, DragPace) -> Void",activeDragDidChangePace:"(ActiveDrag, DragPace, DragPace) -> Void",activeDragHeldPointerEndedAsTap:"(ActiveDrag, PointerState) -> Void",activeDragDidEnd:"(ActiveDrag, Boolean, Array<PointerState>) -> Void"}),a.ActiveDrag=(r=function(e,t,o,n,r){this.initiated=!1,this.dragMode_=a.DragMode.UniformScaleNoSkew,this.pointers=[],this.totalMovement=d.Matrix2D.Identity,this.currentlySnapped_=!1,this.activationClock_=0,this._assignment=0,this.activeDragDelegate=t,this.pointerStateMachine=e,this.currentPace=a.DragPace.MediumPace,this.stoppedUtmost=9,this.slowUtmost=48,this.mediumUtmost=300,this.stoppedSlack=.5,this.slowSlack=.333,this.transientSlack=.333,this.futurePace=this.currentPace,this.pointers=[],this.uncommitedMovement=d.Matrix2D.Identity,this.newDragPlacement_=n,this.viewportScale=r,s.CoreObject.call(this),this.commitWithNewPointers(o)},l.defineClass({name:"ActiveDrag",ctor:r,superName:"CoreObject",props:{dragMode:{get:function(){return this.dragMode_},set:function(e){this.dragMode_,this.dragMode_=e}},currentlySnapped:{get:function(){return this.currentlySnapped_},set:function(e){this.currentlySnapped_!=e&&(this.currentlySnapped_=e)}},startPaceTimer:function(){if(null==this.paceTimer){var e=this;this.paceTimer=c.Host.async.startTimer(.6,(function(){var t;(t=e)&&(t.activePace(),t.paceTimer=null,t.startPaceTimer())}))}},stopPaceTimer:function(){l.opt(this.paceTimer,(function(e){return e.cancel()})),this.paceTimer=null},activeDragDidCommit:function(){this.activeDragDelegate.activeDragDidCommit(this)},commitDrag:function(){this.slipPointers(!1),this.activeDragDidCommit(),this.totalMovement=d._asterisk_Matrix2D_Matrix2D(this.totalMovement,this.uncommitedMovement);var e=this.uncommitedMovement;return this.uncommitedMovement=d.Matrix2D.Identity,e},newDragPlacement:{get:function(){return this.newDragPlacement_},set:function(e){this.newDragPlacement_=e}},commitWithNewPointers:function(e,t){void 0===t&&(t=!0);for(var o=l.iter(e);!o.done;o.next()){var n=o.value;n.pointerStatus=g.PointerStatus.DragHeld,this.pointers.push(n)}this.commitDrag();var r=this.activationClock_,i=this;c.Host.async.postOnMainThread(.6,(function(){var e;(e=i)&&(r==e.activationClock_&&e.activateAll()?a.debug_print("time activated"):a.debug_print("not time activated"))})),e.splice(0)},claimPointers:function(e,t){return this.activeDragDelegate.activeDragClaimNewPointers(this,e,t)},activeDragDidDeactivate:function(){var e=this.currentlySnapped;this.currentlySnapped=!1,this.activeDragDelegate.activeDragDidDeactivate(this,e)},deactivateAll:function(){if(this.initiated){this.commitDrag();for(var e=l.iter(this.pointers);!e.done;e.next()){var t=e.value;t.pointerStatus==g.PointerStatus.DragActive&&(t.pointerStatus=g.PointerStatus.DragInactive)}this.stopPaceTimer(),this.activeDragDidDeactivate()}},activeDragDidBegin:function(){this.activeDragDelegate.activeDragDidBegin(this)},activeDragDidActivate:function(){return this.activeDragDelegate.activeDragDidActivate(this)},activeDragDidMove:function(){this.activeDragDelegate.activeDragDidMove(this,this.currentPace)},activeDragDidEnd:function(e){this.initiated&&this.stopPaceTimer(),this.activeDragDelegate.activeDragDidEnd(this,this.initiated,e),this.pointers.splice(0)},activateAll:function(){for(var e=!1,t=l.iter(this.pointers);!t.done;t.next()){var o=t.value;o.pointerStatus!=g.PointerStatus.DragActive&&(o.pointerStatus=g.PointerStatus.DragActive,e=!0)}return!!e&&(this.activationClock_+=1,this.initiated||(this.initiated=!0,this.activeDragDidBegin()),this.selectDragMode(),this.startPaceTimer(),this.activeDragDidActivate()&&this.slipPointers(!0),!0)},slipPointers:function(e){for(var t=l.iter(this.pointers);!t.done;t.next()){var o=t.value,n=p._minus_TheoPoint_TheoPoint(o.currentLocation,o.startLocation);o.slippage=e?p._plus_TheoPoint_TheoPoint(o.slippage,n):p.TheoPoint.ZERO,o.startLocation=o.currentLocation,o.startTime=o.currentTime}},selectDragMode:function(){var e=this;if(this.pointers.length<=1)return a.debug_print("just one pointer"),void(this.dragMode=a.DragMode.UniformScaleNoSkew);var t=function(t){return p._minus_TheoPoint_TheoPoint(e.pointers[t].currentLocation,e.pointers[t].startLocation)},o=t(0),n=t(1),r=a.dot(o,n)/o.length()/n.length(),i=r>.5;if(a.debug_print("cosine_subtended",r),i)return a.debug_print("same direction"),void(this.dragMode=a.DragMode.UniformScaleNoRotationNoSkew);var l,s=d.Matrix2D.Identity;s=(l=this.pointers[0].viewportTransform)?l:d.Matrix2D.uniformScaling(this.viewportScale);var u=this.freeMovement(s),c=u.movement,h=u.rise,g=u.run,f=c.determinant;a.debug_print("activateAll",Math.sqrt(f),h/g);var m=this.closestApproach(),y=m.distance;if(m.time,1==f&&0==h)a.debug_print("==== translate"),this.dragMode=a.DragMode.UniformScaleNoSkew;else if(1==f)a.debug_print("==== rotate"),this.dragMode=a.DragMode.NoScaleNoSkew;else if(0==h)a.debug_print("==== scale"),this.dragMode=a.DragMode.UniformScaleNoRotationNoSkew;else{var v=.7*Math.abs(1-Math.sqrt(f)),S=Math.abs(h/g);v>1.1*S&&v>.01?(a.debug_print("==== scale"),this.dragMode=a.DragMode.UniformScaleNoRotationNoSkew):S>1.1*v&&S>.01?(a.debug_print("==== rotate"),this.dragMode=a.DragMode.NoScaleNoSkew):(a.debug_print("==== free"),this.dragMode=a.DragMode.UniformScaleNoRotationNoSkew)}this.dragMode==a.DragMode.UniformScaleNoRotationNoSkew&&Math.abs(y)>100&&(a.debug_print("!!!!!!!!override"),this.dragMode=a.DragMode.NoScaleNoSkew)},notifyPaceChanged:function(e,t){},activeDragDidChangePace:function(e,t){this.notifyPaceChanged(e,t),this.activeDragDelegate.activeDragDidChangePace(this,e,t)},activePace:function(){var e,t=this.dragVelocity*this.viewportScale;if(e=t<=this.stoppedUtmost?a.DragPace.StoppedPace:t<this.slowUtmost?a.DragPace.SlowPace:t<this.mediumUtmost?a.DragPace.MediumPace:a.DragPace.FastPace,this.futurePace!=e){this._assignment+=1;var o=this._assignment;if(this.futurePace=e,this.currentPace!=this.futurePace){var n=this.transientSlack;this.futurePace==a.DragPace.SlowPace&&(n=this.slowSlack),this.futurePace==a.DragPace.StoppedPace&&(n=this.stoppedSlack);var r=this;c.Host.async.postOnMainThread(n,(function(){var e;if((e=r)&&e._assignment==o){var t=e.currentPace;e.currentPace=e.futurePace,e.activeDragDidChangePace(t,e.currentPace),e.currentPace==a.DragPace.StoppedPace&&e.deactivateAll()}}))}}return this.currentPace},dragVelocity:{get:function(){for(var e=0,t=l.iter(this.pointers);!t.done;t.next()){var o=t.value.pointerVelocity();o>e&&(e=o)}return e}},activePointers:function(e){for(var t=[],o=l.iter(this.pointers);!o.done;o.next()){var n=o.value;n.pointerStatus==g.PointerStatus.DragActive&&t.push(new a.PointerDrag(e.transformPoint(n.startLocation),e.transformPoint(n.currentLocation)))}return t},freeMovement:function(e){var t=l.clone(this.activePointers(e));return a.freeMovement_(t)},noScale:function(e,t){var o=l.clone(this.activePointers(e));return a.noScale3_(o,t)},noRotation:function(e,t){var o=l.clone(this.activePointers(e));return a.noRotation2_(o,t)},closestApproach:function(){for(var e=[],t=l.iter(this.pointers);!t.done;t.next()){var o=t.value;o.pointerStatus==g.PointerStatus.DragActive&&(e.push(o),a.debug_print("gorg=======",o.currentTime))}if(e.length<=1)return{distance:0,time:0};var n=d.Matrix2D.uniformScaling(this.viewportScale),r=function(t){for(var o=n.transformPoint(e[t].startLocation),r=n.transformPoint(e[t].currentLocation),i=e[t].startTime,s=e[t].currentTime,u=o.equal(r)?p.TheoPoint.ZERO:r.subtract(o).multiply(1/(s-i)),c=l.iter(e[t].history);!c.done;c.next()){var h=c.value;a.debug_print("\t......... "+h)}return{point:r,velocity:u}},i=r(0),s=r(1);return a.closestApproach_(i.point,i.velocity,s.point,s.velocity)}}}),r),a.PointerStateMachineDelegateProtocol=l.defineProtocol("PointerStateMachineDelegateProtocol",{createDragsForPointers:"(PointerStateMachine, Array<PointerState>, Boolean, Integer) -> Array<PointerState>",activeDragDidFinish:"(PointerStateMachine, ActiveDrag) -> Void"}),a.PointerStateMachine=(i=function(e){this.trackingStarted_=!1,this.drags_=[],this.delegate=e,s.CoreObject.call(this)},l.defineClass({name:"PointerStateMachine",ctor:i,superName:"CoreObject",statics:{DRAG_THRESHOLD:9,DRAG_LARGETHRESHOLD:18,_implements:function(e){return"TheoMessageSubscriber"==e}},props:{attach:function(e,t){this.owner=e,this.subscription_=t.subscribe(this,g.PointersStateChangeMessage.TYPE)},detach:function(){l.opt(this.subscription_,(function(e){return e.unsubscribe()})),this.subscription_=null,this.owner=null},onMessage:function(e){var t;(t=l.as(e,g.PointersStateChangeMessage))&&(this.trackingStarted_?t.changeType==g.PointersStateChangeTypeEnum.PointersDown?this.processDown(t):t.changeType==g.PointersStateChangeTypeEnum.PointersMoved?this.processMove(t):t.changeType==g.PointersStateChangeTypeEnum.PointersUp&&this.processUp(t):t.changeType==g.PointersStateChangeTypeEnum.PointersDown&&(this.trackingStarted_=!0,this.drags_=[],this.processDown(t)))},processDown:function(e){if(null!=e){for(var t=e,o=l.clone(t.pointers),n=l.iter(this.drags_);!n.done;n.next()){var r=n.value;o=l.clone(r.claimPointers(o,a.kAllowMultipleDragsInFlight))}0!=o.length&&(o=l.clone(this.delegate.createDragsForPointers(this,o,a.kAllowMultipleDragsInFlight,this.drags_.length)))}},appendDrag:function(e){this.drags_.push(e)},processMove:function(e){for(var t,o=l.iter(this.drags_);!o.done;o.next()){for(var n=o.value,r=n.viewportScale*n.viewportScale,s=[],h=l.iter(e.pointers);!h.done;h.next()){var d=h.value;n.pointers.includes(d)&&s.push(d)}if(0!=s.length){var f=i.DRAG_THRESHOLD;c.Host.platform.isMobile&&e.pointers.length>0&&0==((t=l.opt(l.opt(l.opt(l.as(e.pointers[0].currentPage,u.FormaPage),(function(e){return e.document})),(function(e){return e.controller})),(function(e){return e.selection.selectedCount})))||null!=t?t:0)&&(f=i.DRAG_LARGETHRESHOLD);for(var m=l.iter(s);!m.done;m.next()){(d=m.value).pointerStatus,g.PointerStatus.DragActive;var y=p._minus_TheoPoint_TheoPoint(d.currentLocation,d.startLocation),v=y.dotProduct(y)*r;if(v>f*f){n.activateAll()&&a.debug_print("move activated",Math.sqrt(v));break}}n.initiated&&n.activeDragDidMove()}}},activeDragTouchesEnded:function(e,t){for(var o=l.iter(t);!o.done;o.next()){var n,r=o.value;r.pointerStatus==g.PointerStatus.DragHeld&&e.activeDragDelegate.activeDragHeldPointerEndedAsTap(e,r),null!=(n=l.indexOf(e.pointers,r))&&e.pointers.splice(n,1)}e.commitDrag()},processUp:function(e){for(var t=0;t<this.drags_.length;){for(var o=this.drags_[t],n=[],r=l.iter(e.pointers);!r.done;r.next()){var i=r.value;o.pointers.includes(i)&&n.push(i)}n.length==o.pointers.length?(o.activeDragDidEnd(n),this.delegate.activeDragDidFinish(this,o),this.drags_.splice(t,1)):(this.activeDragTouchesEnded(o,n),t+=1)}}}}),i)},KSe6:function(e,t,o){var n,r,i=t,a=o("oAGj"),l=o("VQVe"),s=o("gXiO"),u=o("C42b"),c=o("ascj"),h=o("FNB+"),d=o("URxh"),g=o("6ZWm"),p=o("cmoc"),f=o("P83h"),m=o("9Lk3"),y=o("pnSN"),v=o("53P9"),S=o("ZhwN"),C=o("iCxV"),T=o("NkBu"),A=o("fdtz"),F=o("SDdr"),k=o("lmwz"),L=o("uWOl"),b=o("fNpk"),_=o("c+uM"),R=o("tGKA"),I=o("pmb0"),w=o("K17h"),D=o("K0Rh"),x=o("Zifs"),P=o("djAF"),E=o("T6jX"),M=o("enh0"),N=o("8t9B"),G=o("3UhB"),B=o("oKlP"),O=o("uUew"),U=o("RkYL"),H=o("xm77"),z=o("zjod"),Y=o("mxdD");i.AnimationLibrary=(n=function e(){this.isModifyingModelForAnimation_=!1,s.CoreObject.call(this);for(var t=a.clone(I.MotionFacade.createAllAnimationStyles()),o=a.iter(t);!o.done;o.next()){var n=o.value;e.animationStyles.push(n)}},r={},a.defineClass({name:"AnimationLibrary",ctor:n,superName:"CoreObject",statics:{animationStyles:{get:function(){return void 0===r.animationStyles&&(r.animationStyles=[l.AnimationStyle.init_b946(l.AnimationStyle.NAME_NO_STYLE),l.AnimationStyle.init_e14f(l.AnimationStyle.NAME_TYPE,0,2,l.AnimationStyleCategory.Text),l.AnimationStyle.init_e14f(l.AnimationStyle.NAME_DYNAMIC,0,4,l.AnimationStyleCategory.Text),l.AnimationStyle.init_e14f(l.AnimationStyle.NAME_FLICKER,0,2,l.AnimationStyleCategory.Text),l.AnimationStyle.init_e14f(l.AnimationStyle.NAME_COLORSWAP,0,3,l.AnimationStyleCategory.Text),l.AnimationStyle.init_e14f(l.AnimationStyle.NAME_FADE,0,3,l.AnimationStyleCategory.Text),l.AnimationStyle.init_e14f(l.AnimationStyle.NAME_SLIDE,0,3,l.AnimationStyleCategory.Text),l.AnimationStyle.init_e14f(l.AnimationStyle.NAME_GROW,0,2,l.AnimationStyleCategory.Text),l.AnimationStyle.init_e14f(l.AnimationStyle.NAME_ZOOM,0,2,l.AnimationStyleCategory.Image),l.AnimationStyle.init_e14f(l.AnimationStyle.NAME_PAN,0,2,l.AnimationStyleCategory.Image),l.AnimationStyle.init_b946(l.AnimationStyle.NAME_GRAYSCALE,l.AnimationStyleCategory.Image),l.AnimationStyle.init_e14f(l.AnimationStyle.NAME_BLUR,0,1,l.AnimationStyleCategory.Image),l.AnimationStyle.init_e14f(l.AnimationStyle.NAME_COLOR,0,5,l.AnimationStyleCategory.Image),l.AnimationStyle.init_e14f(l.AnimationStyle.NAME_FILL,0,5,l.AnimationStyleCategory.Image)]),r.animationStyles},set:function(e){r.animationStyles=e}},determineAnalyticName:function(e){var t="";if(e=e){switch(e.name){case"Type":t="Typewriter";break;case"ColorSwap":t="ColorShuffle";break;default:t=e.name}t=(t+e.variant).toLowerCase()}else t=(l.AnimationStyle.NAME_NO_STYLE+0).toLowerCase();return t},getDisplayableAnimationStyles:function(e){var t=!1,o=!1,r=!1,i=!1,s=!1,u=!1,c=!1,d=!1,p=!1,f=0;e.visitAll(h.FormaTraversal.PreOrder,(function(e){var n,l,h,y,v;if(null!=e.controller&&((n=a.as(e.controller,g.FrameController))&&(s=s||!e.isLogo()&&!e.isSticker(),e.isGridCell()&&!n.floating&&n.hasCutout&&(c=!0)),null!=Y.VideoFacade.getTrueVideoFormaForForma(e)&&(u=!0),m.GridController.isBackgroundColoredCell(e)&&(c=!0),d||(d=m.GridController.hasLayoutPadding(e)),(l=k.ImageFacade.getImageFormaForForma(e))&&(h=a.as(l.style,L.ImageStyle))&&h.isColorizedFilter&&(p=!0),(y=a.as(e.style,_.LockupStyle))&&(v=a.as(e.controller,N.TypeLockupController)))){t=!0,y.backing==_.LockupBacking.Knockout&&(o=!0),!C.Host.textModelUtils.usePGMRenderer()&&_.LockupStyle.isKnockoutLook(y.textLook)||(r=!0);var S=v.getCurrentFontSize();!i&&f>0&&Math.abs(S-f)/Math.min(S,f)>=.05&&(i=!0),f=Math.max(f,S)}}));for(var y=E.TheoDocumentUtils.enableFastHeuristicsForComplexPage(e.page,!0),v=[],S=a.iter(n.animationStyles);!S.done;S.next()){var T=S.value;if((!y||T.name!=l.AnimationStyle.NAME_COLORSWAP)&&(t||T.name!=l.AnimationStyle.NAME_FLICKER&&T.name!=l.AnimationStyle.NAME_DYNAMIC&&T.name!=l.AnimationStyle.NAME_TYPE)&&(!T.imageStyle||s&&!u)&&(t||!T.textStyle)){var A=T.clone();T.name==l.AnimationStyle.NAME_GROW&&o?A.variantCount=3:(T.name!=l.AnimationStyle.NAME_GROW||r&&i)&&(T.name!=l.AnimationStyle.NAME_SLIDE||r)?T.name!=l.AnimationStyle.NAME_DYNAMIC||r?T.name!=l.AnimationStyle.NAME_COLORSWAP||c||p||d||(A.variantCount=2):A.variantCount=3:A.variantCount=1,v.push(A)}}return v},isPremiumAnimationStyle:function(e){return e.name==l.AnimationStyle.NAME_TYPE&&2==e.variant||e.name==l.AnimationStyle.NAME_FLICKER&&2==e.variant||e.name==l.AnimationStyle.NAME_DYNAMIC&&0==e.variant},isAnimationStyleApplicable:function(e,t){var o,r=!1;if(o=a.as(t.root,D.RootForma))for(var i=a.clone(n.getDisplayableAnimationStyles(o)),l=a.iter(i);!l.done;l.next())if(l.value.name==e.name){r=!0;break}return r},extendToIntegralCount:function(e,t,o){b.LegacyCoreAssert.isTrue(0!=t,"sub-duration to loop should be non-zero",void 0,"AnimationLibrary.extendToIntegralCount","AnimationLibrary.swift",2845),b.LegacyCoreAssert.isTrue(0!=o,"time scale should be non-zero",void 0,"AnimationLibrary.extendToIntegralCount","AnimationLibrary.swift",2846);var n=e/t,r=Math.ceil(n),i=Math.floor(n);return n-i<1/a.toDouble(o)&&(r=i),U.TheoTime.fromSeconds(r*t,o)},updateCurrentStyle:function(e,t){var o,r,i;void 0===t&&(t=!1),(o=w.MotionUtils.getCurrentAnimationStyle(e))&&(o.isNoStyle()&&!t||((r=a.as(e.root,D.RootForma))?(i=n.isAnimationStyleApplicable(o,e)?o:e.animationLibrary.getAnimationStyle(l.AnimationStyle.NAME_NO_STYLE))&&e.animationLibrary.setRootAnimationStyle(i,r):a.opt(C.Host.logging,(function(e){return e.warning("Missing root")}))))}},props:{isModifyingModelForAnimation:{get:function(){return this.isModifyingModelForAnimation_}},getAnimationStyle:function(e){for(var t,o=a.iter(n.animationStyles);!o.done;o.next()){var r=o.value;if(e==r.name){t=r;break}}return t},getNextAnimationStyleOfSameType:function(e){var t=e.clone();return t.variantCount>0&&(t.variant=(t.variant+1)%t.variantCount),t},getNoneStyle:function(){return this.getAnimationStyle(l.AnimationStyle.NAME_NO_STYLE)},getAllAnimationStyles:function(){return n.animationStyles},setStillAnimation:function(e,t,o,n){void 0===o&&(o=null),void 0===n&&(n=null);var r=o||t.startTime,i=n||t.endTime,a=[];a.push(new d.KeyFrame(r,H.TimingFunctionType.Linear)),a.push(new d.KeyFrame(i,H.TimingFunctionType.Linear)),e.animation=d.FormaAnimation.init_9e82(t,r,i,a.concat())},setScaleForma:function(e,t,o,n,r,i,l){var s,u=new B.TheoPoint(1,1),c=e.style.clone(),h=e.style.clone();(s=a.as(e.style,_.LockupStyle))&&s.backing==_.LockupBacking.Knockout&&2==t.variant?(h=w.MotionUtils.createOpacityStyle(e,0),u=new B.TheoPoint(20,20)):c=w.MotionUtils.createOpacityStyle(e,0);var g=e.frame,p=e.placement.inverse.transformPoint(g.eval(n)),f=R.Matrix2D.scaling(o),m=e.placement.concat(f).transformPoint(p),y=g.center.subtract(m),v=R.Matrix2D.scaling(u),S=e.placement.concat(v).transformPoint(p),C=g.center.subtract(S),T=[],A=R.Matrix2D.scaling(o).translate(y),F=R.Matrix2D.scaling(u).translate(C),k=i,L=l;if(2==t.variant){T.push(new d.KeyFrame(i,r,A,null,c));var b=new U.TheoTime(t.endTime.timescale,t.endTime.timescale);k=i.add(b),L=l.add(b)}T.push(new d.KeyFrame(k,r,A,null,c)),T.push(new d.KeyFrame(L,r,F,null,h)),e.animation=d.FormaAnimation.init_9e82(t,i,L,T.concat())},setGrowAnimation:function(e,t,o){if(1==t.variant||1==t.variantCount){var n=t.endTime.multiply(2/3);this.setScaleForma(e,t,new B.TheoPoint(.8,.8),new B.TheoPoint(.5,.5),H.TimingFunctionType.EaseOut,t.startTime,n)}else if(0==t.variant){var r=t.endTime.subtract(l.AnimationStyle.FADE_DURATION);a.containsEq(o,e,h._equality_Forma_Forma)?this.setScaleForma(e,t,new B.TheoPoint(.75,.75),new B.TheoPoint(.5,.5),H.TimingFunctionType.EaseOut,t.startTime,r):this.setFormaFade(e,t,t.startTime,t.endTime,r)}else 2==t.variant&&this.setScaleForma(e,t,new B.TheoPoint(1,1),new B.TheoPoint(.5,.5),H.TimingFunctionType.EaseOut,t.startTime,t.endTime)},getCenteredTransform:function(e,t,o){var n=e.parent.frame.center.subtract(new B.TheoPoint(e.parent.frame.minX,e.parent.frame.minY)),r=e.placement.inverse.transformPoint(n),i=R.Matrix2D.scalingXY(t,t),a=e.placement.concat(i).transformPoint(r),l=n.subtract(a);return R.Matrix2D.scalingXY(t,t).translate(l.add(o))},setImageAnimation:function(e,t,o,n,r){var i=k.ImageFacade.getFrameFormaForForma(e);if(!e.isLogo()&&!e.isSticker()){for(var l=1,s=e.placement,u=a.iter(n);!u.done;u.next()){var c=u.value,h=c[1],p=c[2],f=this.getCenteredTransform(e,p,h);e.placement=s,e.move(f);var m,y=e.placement;(m=a.as(a.opt(i,(function(e){return e.controller})),g.FrameController))&&m.fitChildrenToFrame();var v=e.placement.transformValues.xscale-y.transformValues.xscale,S=new B.TheoPoint(e.placement.tx-y.tx,e.placement.ty-y.ty);if(e.placement=s,r&&(S.length()>1||v>0)){var C=e.frame;p*(l=Math.max(l,1+v+3*Math.max(Math.abs(S.x)/C.width,Math.abs(S.y)/C.height)))<1&&(l=1/p)}for(var T=[],A=a.iter(n);!A.done;A.next()){var F=A.value,L=F[0],b=(h=F[1],p=F[2],this.getCenteredTransform(e,p*l,h));T.push(new d.KeyFrame(L,o,b,null,null))}e.animation=d.FormaAnimation.init_9e82(t,t.startTime,t.endTime,T.concat())}T=[];for(var _=a.iter(n);!_.done;_.next()){var R=_.value;L=R[0],h=R[1],p=R[2],b=this.getCenteredTransform(e,p*l,h),T.push(new d.KeyFrame(L,o,b,null,null))}e.animation=d.FormaAnimation.init_9e82(t,t.startTime,t.endTime,T.concat())}},applyLineFadeIn:function(e,t,o,n,r){var i,l=n.subtract(o),s=r;s.seconds*a.toDouble(e.length)>l.seconds/2&&(s=l.multiply(1/a.toDouble(2*e.length)));for(var u=l.subtract(s.multiply(a.toDouble(e.length))),c=o,h=a.iter(e);!h.done;h.next()){var d=h.value,g=(c=c.add(s)).add(u);this.setFormaAnimations(d,t,0,(i=a.opt(a.first(d),(function(e){return e.style.opacity})))||null!=i?i:1,R.Matrix2D.Identity,H.TimingFunctionType.EaseInOut,o,c,g)}},setFadeAnimationTopDown:function(e,t){for(var o=[],n=a.iter(e);!n.done;n.next()){var r=n.value;r.isTypeLockup()&&o.push(r)}if(0==!o.length){for(var i=a.clone(w.MotionUtils.getTitleLockups(o)),s=a.clone(i[0]),u=a.clone(i[1]),c=[],h=[],d=a.iter(s);!d.done;d.next()){var g=d.value,p=a.clone(w.MotionUtils.findTextLines2(g));if(0==!p.length)for(var f=a.iter(p);!f.done;f.next()){var m=f.value;h.push(m)}}h=a.clone(w.MotionUtils.sortTextLines(h));for(var y=a.iter(h);!y.done;y.next())m=y.value,c.push(m.words);var v=new U.TheoTime(a.toInt(.25*a.toDouble(t.endTime.timescale)),t.endTime.timescale);this.applyLineFadeIn(c,t,t.startTime,t.endTime,v);for(var S=t.endTime.subtract(l.AnimationStyle.FADE_DURATION),C=a.iter(u);!C.done;C.next()){var T=C.value;this.setFormaFade(T,t,t.startTime,t.endTime,S)}}},setFadeAnimation:function(e,t,o){var n;if(2==t.variant||1==t.variantCount)if(a.as(e.controller,N.TypeLockupController))this.setFormaAnimations([e],t,.05,e.style.opacity,R.Matrix2D.Identity,H.TimingFunctionType.EaseOut,t.startTime,t.startTime,t.endTime);else{var r=[];e.visitAll(h.FormaTraversal.PreOrder,(function(e){(e instanceof M.TextForma||e instanceof P.ShapeForma)&&r.push(e)})),e.isImage()&&(r=[e]),this.setFormaAnimations(r,t,.05,e.style.opacity,R.Matrix2D.Identity,H.TimingFunctionType.EaseOut,t.startTime,t.startTime,t.endTime)}else{var i=t.endTime.subtract(l.AnimationStyle.FADE_DURATION);if(a.containsEq(o,e,h._equality_Forma_Forma)){var s,u=!1;if(C.Host.textModelUtils.usePGMRenderer()||(s=a.as(e.controller,N.TypeLockupController))&&a.opt(s.lockupStyle,(function(e){return e.textLook==_.LockupTextLook.KnockoutOnly}))&&(u=!0),0==t.variant)u&&(s=a.as(e.controller,N.TypeLockupController))&&this.modifyLockupForAnimation(s,u),this.setLineAnimation(e,t,R.Matrix2D.Identity,H.TimingFunctionType.EaseInOut,t.startTime,t.endTime,new U.TheoTime(a.toInt(.25*a.toDouble(t.endTime.timescale)),t.endTime.timescale)),this.setStillAnimation(e,t);if(1==t.variant&&(s=a.as(e.controller,N.TypeLockupController))){this.modifyLockupForAnimation(s,u);for(var c=[],g=a.iter(e.visitAsArray(h.FormaTraversal.PreOrder));!g.done;g.next()){var p,f=g.value;(p=a.as(f,M.TextForma))&&c.push(p)}for(var m=e.finalFrame,y=a.iter(c);!y.done;y.next()){var v=y.value,S=.8*(v.finalFrame.center.x-m.minX)/m.width+.1;b.LegacyCoreAssert.isTrue(S<=1,"Unexpected text forma position encountered when setting fade animation",void 0,"AnimationLibrary.setFadeAnimation","AnimationLibrary.swift",689);var T=w.MotionUtils.createOpacityStyle(v,0),A=v.style;if(u){var F=(n=a.opt(a.as(a.opt(v.lockupForma,(function(e){return e.style})),_.LockupStyle),(function(e){return e.backingOpacity})))||null!=n?n:v.style.opacity;A=w.MotionUtils.createOpacityStyle(v,F)}var k=[],L=i.subtract(t.startTime).seconds*S,I=t.startTime.addSeconds(L),D=I.addSeconds(1);u?(k.push(new d.KeyFrame(t.startTime,H.TimingFunctionType.Linear,R.Matrix2D.Identity,null,A)),k.push(new d.KeyFrame(I,H.TimingFunctionType.Linear,R.Matrix2D.Identity,null,A)),k.push(new d.KeyFrame(D,H.TimingFunctionType.Linear,R.Matrix2D.Identity,null,T))):(k.push(new d.KeyFrame(t.startTime,H.TimingFunctionType.Linear,R.Matrix2D.Identity,null,T)),k.push(new d.KeyFrame(I,H.TimingFunctionType.Linear,R.Matrix2D.Identity,null,T)),k.push(new d.KeyFrame(D,H.TimingFunctionType.Linear,R.Matrix2D.Identity,null,A))),v.animation=d.FormaAnimation.init_9e82(t,t.startTime,D,k.concat())}this.setStillAnimation(e,t,null,i)}}else this.setFormaFade(e,t,t.startTime,t.endTime,i)}},setLineAnimation:function(e,t,o,n,r,i,l){var s,u,c=(s=a.opt(a.as(e.style,_.LockupStyle),(function(e){return e.textLook})))||null!=s?s:_.LockupTextLook.Fill,h=!C.Host.textModelUtils.usePGMRenderer()&&c==_.LockupTextLook.KnockoutOnly,d=_.LockupStyle.isKnockoutLook(c)&&!h&&!C.Host.textModelUtils.usePGMRenderer(),g=a.clone(w.MotionUtils.findTextLines(e)),p=i.subtract(r),f=l;f.seconds*a.toDouble(g.length)>p.seconds/2&&(f=p.multiply(1/a.toDouble(2*g.length)));var m=p.subtract(f.multiply(a.toDouble(g.length))),y=0,v=h?0:e.style.opacity;h&&(y=(u=a.opt(a.as(e.style,_.LockupStyle),(function(e){return e.backingOpacity})))||null!=u?u:e.style.opacity);var S=r;if(!d)for(var T=a.iter(g);!T.done;T.next()){var A=T.value,F=(S=S.add(f)).add(m);this.setFormaAnimations(A,t,y,v,o,n,r,S,F)}var k=i.multiply(.5),L=a.clone(e.filterWithCallback((function(e){return e instanceof P.ShapeForma||e instanceof M.TextForma&&d})));h||this.setFormaAnimations(L,t,y,v,R.Matrix2D.Identity,n,r,r,k)},setColorSwapAnimation:function(e,t,o){var n,r,i,s;if(void 0===o&&(o=null),0!=e.length){var h=e[0].page,p=new f.FormaStyleChangedEvent(h.root);h.beginUpdate(p);for(var y=0==t.variant||1==t.variant,v=[],S=a.iter(e);!S.done;S.next()){var F,_,I,w=S.value;b.LegacyCoreAssert.isFalse(w instanceof M.TextForma,"color swap animation: formae to color should not include text formae",void 0,"AnimationLibrary.setColorSwapAnimation","AnimationLibrary.swift",808),null!=w.controller&&w.kind!=D.RootForma.KIND&&((F=a.as(w.controller,m.GridController))?F.isBackgroundVisible()&&!y&&v.push(w.root):y&&!w.controller.moveable||((_=k.ImageFacade.getImageFormaForForma(w))?((I=a.as(_.style,L.ImageStyle))&&I.isColorizedFilter&&v.push(_),((n=a.opt(a.as(w.controller,g.FrameController),(function(e){return e.hasBackgroundColor})))||null!=n)&&n&&v.push(w)):v.push(w)))}v=a.sort(v,(function(e,t){return!(!(r=a.opt(e.controller,(function(e){return e.moveable})))&&null==r||!r)&&null!=(o=a.opt(e.parent,(function(t){return t.indexOfChild(e)})))&&null!=(n=a.opt(t.parent,(function(e){return e.indexOfChild(t)})))&&o<n;var o,n})),t.endTime=o||l.AnimationStyle.COLOR_SWAP_DURATION;for(var E=0==t.variant||2==t.variant?H.TimingFunctionType.Step1:H.TimingFunctionType.Linear,G=1==t.variant?.75:.5,B=a.toInt(a.toDouble(t.endTime.timescale)*G),O=a.toInt(a.toInt(t.endTime.value/B)),z={},Y=t.startTime.value,W={},V={},K=[],X=a.iter(v);!X.done;X.next()){if(w=X.value,(Ke=[]).push(new d.KeyFrame(t.startTime,E,R.Matrix2D.Identity,null,w.style)),z[w.formaID]=Ke,w.isTypeLockup()&&C.Host.textModelUtils.usePGMRenderer()){for(var j=a.clone(w.filterByKind(M.TextForma.KIND)),q=a.clone(w.filterByKind(P.ShapeForma.KIND)),Z=a.iter(j);!Z.done;Z.next()){var J=Z.value;(je=[]).push(new d.KeyFrame(t.startTime,E,R.Matrix2D.Identity,null,J.style)),z[J.formaID]=je}for(var Q=a.iter(q);!Q.done;Q.next()){var $=Q.value;(Ze=[]).push(new d.KeyFrame(t.startTime,E,R.Matrix2D.Identity,null,$.style)),z[$.formaID]=Ze}}if(w.kind!=A.ImageForma.KIND){for(var ee=w.style.colors.colorID(c.ColorRole.FieldPrimary),te=a.iter(w.page.colorLibraryController.getThemeColorKeys());!te.done;te.next()){var oe,ne=te.value;(oe=w.style.colors.fieldPrimary)&&(le=w.page.colorLibraryController.getSolidColorForKey(ne))&&oe.distanceTo(le)<2&&(ee=ne)}null==W[ee=(i=ee)||null!=i?i:"missing"+a.toString(K.length)]&&(W[ee]=[],K.includes(ee)||K.push(ee)),W[ee].push(w);for(var re=w.style.colors.colorID(c.ColorRole.FieldSecondary),ie=a.iter(w.page.colorLibraryController.getThemeColorKeys());!ie.done;ie.next()){var ae,le;ne=ie.value,(ae=w.style.colors.fieldSecondary)&&(le=w.page.colorLibraryController.getSolidColorForKey(ne))&&ae.distanceTo(le)<2&&(re=ne)}null==V[re=(s=re)||null!=s?s:"missing"+a.toString(K.length)]&&(V[re]=[],K.includes(re)||K.push(re)),V[re].push(w)}}var se=a.clone(a.shuffle(h.colorLibraryController.getThemeColorKeys())),ue=[];if(v.length>0){for(var ce=e[0].database.beginTransaction("revert_transaction",null),he=a.iter(a.range(0,O,!1));!he.done;he.next()){for(var de={},ge=a.iter(v);!ge.done;ge.next()){var pe,fe;(pe=(Be=ge.value).style.colors.fieldPrimary)&&(de[Be.formaID+"primary"]=pe.asString),(fe=Be.style.colors.fieldSecondary)&&(de[Be.formaID+"secondary"]=fe.asString)}for(var me=u.CoreRandom.nextIntUniform(se.length);ue.length>0&&se.length>1&&me==ue[ue.length-1];)me=u.CoreRandom.nextIntUniform(se.length);ue.push(me);for(var ye=a.iter(a.range(0,2,!1));!ye.done;ye.next())for(var ve=1==ye.value,Se=a.clone(ve?W:V),Ce=a.iter(K);!Ce.done;Ce.next()){var Te,Ae,Fe=Ce.value;if((Te=Se[Fe])&&null!=(Ae=a.indexOf(K,Fe)))for(var ke=a.iter(Te);!ke.done;ke.next())if((Be=ke.value).kind!=A.ImageForma.KIND)for(var Le=!1,be=0;!Le&&be<se.length;){var _e=se[(Ae+me+be)%se.length];be+=1,Le=!0;var Re,Ie,we=ve?c.ColorRole.FieldPrimary:c.ColorRole.FieldSecondary;if(Be.style.colorTableSupportsRole(we))if(Be.style.colors.setColorId(we,_e),(Re=Be.style.colors.color(we))&&null!=(Ie=de[Be.formaID+(we==c.ColorRole.FieldPrimary?"primary":"secondary")])&&Ie==Re.asString&&(Le=!1),null!=Be.controller&&Be.controller.moveable){var De,xe=a.opt(Be.controller,(function(e){return e.getBackingContrastRole()}));if(De=Be.style.colors.color(we)){var Pe=we==c.ColorRole.FieldPrimary&&xe==c.ColorRole.FieldSecondary?Be.style.colors.fieldSecondary:a.opt(Be.controller,(function(e){return e.getBackgroundColor()})),Ee=Be.isTypeLockup()?10:5,Me=new x.SolidColor(De.red,De.green,De.blue,Be.style.opacity);null!=Pe&&Me.lightnessDifference(Pe)<Ee&&(Le=!1)}}}}for(var Ne=a.iter(v);!Ne.done;Ne.next()){var Ge,Be=Ne.value;(Ge=a.as(Be.controller,N.TypeLockupController))&&Ge.styleController.shuffleMultiStyleLockupColors()}Y+=B;for(var Oe=new U.TheoTime(Y,t.endTime.timescale),Ue=a.iter(v);!Ue.done;Ue.next())if((w=Ue.value).isImage()&&a.opt(a.as(w.controller,T.ImageController),(function(e){return e.shuffleColorAssignmentForAnimation()})),(w.isShape()||w.isTypeLockup())&&null==w.style.colors.color(c.ColorRole.FieldPrimary)&&b.LegacyCoreAssert.fail("error, can't be setting a nil colors",void 0,"AnimationLibrary.setColorSwapAnimation","AnimationLibrary.swift",1072),a.opt(z[w.formaID],(function(e){return e.push(new d.KeyFrame(Oe,E,R.Matrix2D.Identity,null,w.style))})),w.isTypeLockup()&&C.Host.textModelUtils.usePGMRenderer()){j=a.clone(w.filterByKind(M.TextForma.KIND)),q=a.clone(w.filterByKind(P.ShapeForma.KIND));for(var He=a.iter(j);!He.done;He.next()){var ze;J=He.value,(ze=J.style.clone())?(ze.colors.owner=null,ze.colors.setColor(c.ColorRole.FieldPrimary,J.fontColor),ze.colors.setColor(c.ColorRole.FieldSecondary,J.fontStrokeColor),a.opt(z[J.formaID],(function(e){return e.push(new d.KeyFrame(Oe,E,R.Matrix2D.Identity,null,ze))}))):b.LegacyCoreAssert.fail("fail to generate keyframe for color shuffle: missing style in text forma",void 0,"AnimationLibrary.setColorSwapAnimation","AnimationLibrary.swift",1091)}for(var Ye=a.iter(q);!Ye.done;Ye.next())$=Ye.value,a.opt(z[$.formaID],(function(e){return e.push(new d.KeyFrame(Oe,E,R.Matrix2D.Identity,null,$.style))}))}}ce.rollback()}for(var We=e.concat(v),Ve=a.iter(this.uniqueFormae(We));!Ve.done;Ve.next()){var Ke;if(Ke=z[(w=Ve.value).formaID]){if(w.animation=d.FormaAnimation.init_9e82(t,t.startTime,t.endTime,Ke.concat()),w.isTypeLockup()&&C.Host.textModelUtils.usePGMRenderer()){j=a.clone(w.filterByKind(M.TextForma.KIND)),q=a.clone(w.filterByKind(P.ShapeForma.KIND));for(var Xe=a.iter(j);!Xe.done;Xe.next()){var je;(je=z[(J=Xe.value).formaID])&&(J.animation=d.FormaAnimation.init_9e82(t,t.startTime,t.endTime,je.concat()))}for(var qe=a.iter(q);!qe.done;qe.next()){var Ze;(Ze=z[($=qe.value).formaID])&&($.animation=d.FormaAnimation.init_9e82(t,t.startTime,t.endTime,Ze.concat()))}}}else w.kind==D.RootForma.KIND?this.setStillAnimation(e[0].root,t):w.animation=null}h.endUpdate(p)}},setFlickerAnimation:function(e,t){var o,n,r,i,s,u,c;if(0!=e.length){for(var g=[],p=a.iter(e);!p.done;p.next()){var f;null!=(T=p.value).controller&&T.controller.moveable&&!T.isGridCell()&&null==a.as(T,A.ImageForma)&&this.shouldAnimateShape(T)&&((f=k.ImageFacade.getImageFormaForForma(T))?g.push(f):g.push(T))}var m=a.clone(this.getTitleLockups(e[0].root));if(0!=m.length){for(var y=1==t.variant,v=2!=t.variant&&!C.Host.textModelUtils.usePGMRenderer(),S=a.iter(m);!S.done;S.next()){var T=S.value;a.remove(g,T),(D=a.as(T.controller,N.TypeLockupController))&&a.opt(D.lockupStyle,(function(e){return e.textLook!=_.LockupTextLook.KnockoutOnly}))&&(v=!1)}for(var F=[],L=[],I=a.iter(m);!I.done;I.next()){var D,E=I.value;if(D=a.as(E.controller,N.TypeLockupController))if(this.modifyLockupForAnimation(D,v),!y&&this.lockupDoesPerLetterLayout(E)){var B=a.clone(a.as(D.groupLetterFormaeByWord(),["Array",["Array",h.Forma]]));a.append(F,B),a.append(L,B)}else{for(var z=a.clone(D.getAllTextFormae()),Y=a.iter(z);!Y.done;Y.next())T=Y.value,F.push([T]);y&&(z=a.clone(G.TypeLockupUtils.sortTextFormae(z)),z=a.clone(G.TypeLockupUtils.padTextFormaeForLetterAnimation(z,!1)));for(var W=a.iter(z);!W.done;W.next())T=W.value,L.push([T])}}2==t.variant&&(L=[m]);var V=a.toInt(2*a.toDouble(t.endTime.timescale)),K=new U.TheoTime(V+1,t.endTime.timescale),X=K.add(l.AnimationStyle.FADE_DURATION),j=H.TimingFunctionType.EaseOut,q=H.TimingFunctionType.Step,Z=a.toInt(.15*a.toDouble(t.endTime.timescale)),J=a.toInt(a.toInt(V/Z)),Q={},$=t.startTime.value;b.LegacyCoreAssert.isTrue(X.value>K.value,"end fade time must exceed start fade time",void 0,"AnimationLibrary.setFlickerAnimation","AnimationLibrary.swift",1250);for(var ee=a.iter(F);!ee.done;ee.next()){e=ee.value;for(var te=a.iter(e);!te.done;te.next())T=te.value,(ot=[]).push(new d.KeyFrame(t.startTime,q,R.Matrix2D.Identity,null,T.style)),Q[T.formaID]=ot}for(var oe={},ne=a.iter(a.range(0,J,!1));!ne.done;ne.next()){$+=Z;for(var re=new U.TheoTime($,t.endTime.timescale),ie=0,ae=null,le=a.iter(a.toSequence(L));!le.done;le.next()){for(var se=le.value,ue=se.offset,ce=(e=se.element,(o=a.opt(e[0].controller,(function(e){return e.currentOpacity})))||null!=o?o:e[0].style.opacity),he=2*(this.randomDbl()-.5)*ce,de=0,ge=!1;de<5&&!ge;){de+=1;for(var pe=a.iter(e);!pe.done;pe.next()){T=pe.value;var fe=(n=a.opt(T.controller,(function(e){return e.currentOpacity})))||null!=n?n:T.style.opacity,me=(r=oe[T.formaID])||null!=r?r:fe,ye=T.isTypeLockup()?fe:1;Math.abs(me-Math.min(Math.max(me+he,0),ye))<.1?he=2*(this.randomDbl()-.5):ge=!0}}for(var ve=a.iter(e);!ve.done;ve.next()){T=ve.value,fe=(i=a.opt(T.controller,(function(e){return e.currentOpacity})))||null!=i?i:T.style.opacity,ye=T.isTypeLockup()?fe:1;var Se=Math.min(Math.max(fe+he,0),ye);if(oe[T.formaID]=Se,y){if(He=a.as(T,M.TextForma)){var Ce,Te,Ae=He.graphemeCount,Fe=!1,ke=He.fontColor,Le=new x.SolidColor(ke.red,ke.green,ke.blue,Se),be=He.fontStrokeColor,_e=new x.SolidColor(be.red,be.green,be.blue,Se);if(ue-1>=0&&(Ce=a.as(a.opt(He.lockupForma,(function(e){return e.style})),_.LockupStyle))&&(Te=a.as(a.first(L[ue-1]),M.TextForma))&&_.LockupStyle.isDuplicateFormaLook(Ce.textLook)&&G.TypeLockupUtils.formaForSameTextRun(He,Te)&&Te.formaID==a.opt(ae,(function(e){return e.formaID}))&&T.formaID!=a.opt(ae,(function(e){return e.formaID}))&&(Fe=!0,Le=new x.SolidColor(ke.red,ke.green,ke.blue,(s=oe[Te.formaID])||null!=s?s:Se),_e=new x.SolidColor(be.red,be.green,be.blue,(u=oe[Te.formaID])||null!=u?u:Se)),Fe||(T===ae?ie+=1:ie=0,ae=T),ie<Ae)if(0==ie){b.LegacyCoreAssert.isTrue(fe==T.style.opacity,"current opacity does not match first character's opacity",void 0,"AnimationLibrary.setFlickerAnimation","AnimationLibrary.swift",1344);var Re=new d.KeyFrame(re,q,R.Matrix2D.Identity,null,T.style);Re.renderRuns.applyColors(Le,_e,new O.TextRange(ie,ie+1)),a.opt(Q[T.formaID],(function(e){return e.push(Re)}))}else{var Ie=(c=a.opt(Q[T.formaID],(function(e){return e.length})))||null!=c?c:0;Ie>0&&Q[T.formaID][Ie-1].renderRuns.applyColors(Le,_e,new O.TextRange(ie,ie+1))}}}else{var we=w.MotionUtils.createOpacityStyle(T,Se),De=new d.KeyFrame(re,q,R.Matrix2D.Identity,null,we);a.opt(Q[T.formaID],(function(e){return e.push(De)}))}}}}for(var xe=a.iter(F);!xe.done;xe.next()){e=xe.value;for(var Pe=a.iter(e);!Pe.done;Pe.next()){T=Pe.value;var Ee=v?w.MotionUtils.createOpacityStyle(T,0):T.style;Q[T.formaID].push(new d.KeyFrame(X,j,R.Matrix2D.Identity,null,Ee))}}for(var Me=a.iter(g);!Me.done;Me.next()){T=Me.value;var Ne=w.MotionUtils.createOpacityStyle(T,0),Ge=T.style;if(null==Q[T.formaID]&&(Q[T.formaID]=[],Q[T.formaID].push(new d.KeyFrame(t.startTime,j,R.Matrix2D.Identity,null,Ne)),Q[T.formaID].push(new d.KeyFrame(K,j,R.Matrix2D.Identity,null,Ne)),Q[T.formaID].push(new d.KeyFrame(X,j,R.Matrix2D.Identity,null,Ge)),X.value<t.endTime.value&&Q[T.formaID].push(new d.KeyFrame(t.endTime,j,R.Matrix2D.Identity,null,Ge)),T.isTypeLockup()&&C.Host.textModelUtils.usePGMRenderer())){for(var Be=a.clone(T.filterByKind(M.TextForma.KIND)),Oe=a.clone(T.filterByKind(P.ShapeForma.KIND)),Ue=a.iter(Be);!Ue.done;Ue.next()){var He=Ue.value,ze=w.MotionUtils.createOpacityStyle(He,0),Ye=He.style,We=[];We.push(new d.KeyFrame(t.startTime,j,R.Matrix2D.Identity,null,ze)),We.push(new d.KeyFrame(K,j,R.Matrix2D.Identity,null,ze)),We.push(new d.KeyFrame(X,j,R.Matrix2D.Identity,null,Ye)),X.value<t.endTime.value&&We.push(new d.KeyFrame(t.endTime,j,R.Matrix2D.Identity,null,Ye)),He.animation=d.FormaAnimation.init_9e82(t,t.startTime,t.endTime,We.concat())}for(var Ve=a.iter(Oe);!Ve.done;Ve.next()){var Ke=Ve.value,Xe=w.MotionUtils.createOpacityStyle(Ke,0),je=Ke.style,qe=[];qe.push(new d.KeyFrame(t.startTime,j,R.Matrix2D.Identity,null,Xe)),qe.push(new d.KeyFrame(K,j,R.Matrix2D.Identity,null,Xe)),qe.push(new d.KeyFrame(X,j,R.Matrix2D.Identity,null,je)),X.value<t.endTime.value&&qe.push(new d.KeyFrame(t.endTime,j,R.Matrix2D.Identity,null,je)),Ke.animation=d.FormaAnimation.init_9e82(t,t.startTime,t.endTime,qe.concat())}}}for(var Ze=[],Je=a.iter(L);!Je.done;Je.next()){e=Je.value;for(var Qe=a.iter(e);!Qe.done;Qe.next()){var $e=Qe.value;Ze.push($e)}}for(var et=e.concat(Ze),tt=a.iter(this.uniqueFormae(et));!tt.done;tt.next()){var ot,nt;if(ot=Q[(T=tt.value).formaID])T.animation=d.FormaAnimation.init_9e82(t,t.startTime,t.endTime,ot.concat()),T.kind==M.TextForma.KIND&&(nt=a.opt(a.opt(T.parent,(function(e){return e.parent})),(function(e){return e.parent})))&&nt.isTypeLockup()&&null==nt.animation&&this.setStillAnimation(nt,t),this.validateKeyFrames(ot.concat(),"flicker/setStillAnimation");else T.animation=null}}}},shouldAnimateShape:function(e){return!e.isShape()||(e.isGridCell()||null!=e.controller&&e.controller.moveable,!1)},modifyLockupForAnimation:function(e,t){var o,n;if(t){var r=(o=a.opt(e.lockupStyle,(function(e){return e.textLook})))||null!=o?o:_.LockupTextLook.Fill,i=a.opt(e.lockupStyle,(function(e){return e.colors.colorID(c.ColorRole.FieldPrimary)}));if(_.LockupStyle.isKnockoutLook(r)&&t){e.beginBlockedUpdate(),a.opt(e.lockupStyle,(function(e){return e.textLook=_.LockupTextLook.KnockoutAndFill}));var l=a.opt(e.lockupStyle,(function(e){return e.colors.colorID(c.ColorRole.FieldSecondary)}));a.opt(e.lockupStyle,(function(e){return e.colors.setColorId(c.ColorRole.FieldPrimary,l)})),e.endBlockedUpdate()}b.LegacyCoreAssert.isTrue(0==e.forceLetterFormaMode,"unexpectedly found forced letter forma mode when modifying lockup for animation",void 0,"AnimationLibrary.modifyLockupForAnimation","AnimationLibrary.swift",1541),e.updateGroup(),_.LockupStyle.isKnockoutLook(r)&&t&&(a.opt(e.forma,(function(t){return t.visitAll(h.FormaTraversal.PreOrder,(function(t){t.kind==M.TextForma.KIND&&(t.style.opacity=(n=a.opt(e.lockupStyle,(function(e){return e.backingOpacity})))||null!=n?n:t.style.opacity)}))})),e.beginBlockedUpdate(),a.opt(e.lockupStyle,(function(e){return e.textLook=r})),a.opt(e.lockupStyle,(function(e){return e.colors.setColorId(c.ColorRole.FieldPrimary,i)})),e.endBlockedUpdate())}},useKnockoutAnimation:function(e,t){var o;return!(C.Host.textModelUtils.usePGMRenderer()||!(o=e.lockupStyle)||!(o.textLook==_.LockupTextLook.KnockoutOnly||_.LockupStyle.isKnockoutLook(o.textLook)&&t==l.AnimationStyle.WORD_CENTERED_VARIANT))},getRandomLetterAppearKeyFrames:function(e,t,o,n,r,i,s,u){for(var c,h,g,p,f=s,m=a.iter(e);!m.done;m.next())for(var y=m.value,v=a.iter(y);!v.done;v.next()){var S=v.value,C=[],T=w.MotionUtils.createOpacityStyle(S,0),A=!1;if((E=a.as(a.opt(a.opt(a.as(S,M.TextForma),(function(e){return e.lockupForma})),(function(e){return e.controller})),N.TypeLockupController))&&(A=this.useKnockoutAnimation(E,t)),A){var F=(c=a.opt(a.as(a.opt(a.opt(a.as(S,M.TextForma),(function(e){return e.lockupForma})),(function(e){return e.style})),_.LockupStyle),(function(e){return e.backingOpacity})))||null!=c?c:S.style.opacity;T=w.MotionUtils.createOpacityStyle(S,F)}C.push(new d.KeyFrame(o.startTime,n,R.Matrix2D.Identity,null,T)),r[S.formaID]=C}for(var k=a.iter(i);!k.done;k.next()){var L=k.value,b=L.key,I=new U.TheoTime(a.toInt(Math.max(f-1,0)),o.endTime.timescale);I.value<=o.startTime.value&&(I=new U.TheoTime(a.toInt(o.startTime.value+1),o.endTime.timescale));var D=new U.TheoTime(a.toInt(f),o.endTime.timescale);D.value<=I.value&&(D=new U.TheoTime(I.value+1,o.endTime.timescale));for(var P=a.iter(L.value);!P.done;P.next()){var E,B=P.value,H=B.style,z=!1;(E=a.as(a.opt(B.lockupForma,(function(e){return e.controller})),N.TypeLockupController))&&(z=this.useKnockoutAnimation(E,t)),T=w.MotionUtils.createOpacityStyle(B,0),z&&t!=l.AnimationStyle.WORD_CENTERED_VARIANT&&(F=(h=a.opt(a.as(a.opt(B.lockupForma,(function(e){return e.style})),_.LockupStyle),(function(e){return e.backingOpacity})))||null!=h?h:B.style.opacity,T=w.MotionUtils.createOpacityStyle(B,F));var Y=B.graphemeCount,W=B.fontColor,V=B.fontStrokeColor,K=x.SolidColor.fromAlphaOverride(W,0),X=x.SolidColor.fromAlphaOverride(V,0);z&&(K=W,W=x.SolidColor.fromAlphaOverride(W,0),X=V,V=x.SolidColor.fromAlphaOverride(V,0));var j=new d.KeyFrame(I,n,R.Matrix2D.Identity,null,T),q=new d.KeyFrame(D,n,R.Matrix2D.Identity,null,H),Z=(g=a.opt(r[B.formaID],(function(e){return e.length})))||null!=g?g:0;if(Z>0){for(var J=r[B.formaID][Z-1].renderRuns.fillColors,Q=a.iter(J.runArrays);!Q.done;Q.next()){var $=Q.value;q.renderRuns.fillColors.apply($.attr,$.range)}for(var ee=r[B.formaID][Z-1].renderRuns.strokeColors,te=a.iter(ee.runArrays);!te.done;te.next())$=te.value,q.renderRuns.strokeColors.apply($.attr,$.range)}var oe=new O.TextRange(0,Y);1==Z&&(q.renderRuns.applyColors(K,X,oe),a.opt(r[B.formaID],(function(e){return e.push(j)}))),q.renderRuns.applyColors(W,V,b);for(var ne=[],re=a.iter(q.renderRuns.fillColors.runArrays);!re.done;re.next())$=re.value,a.eq(x._equality_SolidColor_SolidColor,$.attr,W)&&ne.push($.range);a.sortInPlace(ne,(function(e,t){return e.start<t.start}));var ie=a.clone(G.TypeLockupUtils.cleanupAndMerge(ne));q.renderRuns.clear();var ae=[oe];1==K.alpha&&(ae=a.clone(G.TypeLockupUtils.invertRanges(ie,oe.end)));for(var le=a.iter(ae);!le.done;le.next()){var se=le.value;q.renderRuns.applyColors(K,X,se)}for(var ue=a.iter(ie);!ue.done;ue.next()){var ce=ue.value;q.renderRuns.applyColors(W,V,ce)}if(z&&((p=a.opt(a.first(ie),(function(e){return e.length})))||null!=p?p:0)>=Y){var he=w.MotionUtils.createOpacityStyle(B,0),de=new d.KeyFrame(D,n,R.Matrix2D.Identity,null,he);a.opt(r[B.formaID],(function(e){return e.push(de)}))}else a.opt(r[B.formaID],(function(e){return e.push(q)}))}f+=u}},lockupDoesPerLetterLayout:function(e){var t;return!!(t=a.as(e.style,_.LockupStyle))&&_.LockupStyle.doesPerLetterLayout(t.layout)},setDynamicWordAnimation:function(e,t){var o,n,r=this;if(0!=e.length){var i=t.variant,s=t.name==l.AnimationStyle.NAME_TYPE;s&&(i+=10);var u=a.clone(this.getTitleLockups(e[0].root));if(0!=u.length){var c=!0;if(i==l.AnimationStyle.WORD_CENTERED_VARIANT){var g=u.filter((function(e){return!r.lockupDoesPerLetterLayout(e)}),this);0==g.length?c=!1:u=a.clone(g)}for(var p=[],f=a.iter(e);!f.done;f.next()){var m;null!=(T=f.value).controller&&T.controller.moveable&&!T.isGridCell()&&null==a.as(T,A.ImageForma)&&this.shouldAnimateShape(T)&&((m=k.ImageFacade.getImageFormaForForma(T))?p.push(m):p.push(T))}for(var y=!1,S=!1,C=a.iter(u);!C.done;C.next()){var T=C.value;a.remove(p,T),!y&&T.controller instanceof N.TypeLockupController&&(y=this.useKnockoutAnimation(T.controller,i))}var F=[],L=[],I=0,D=0;if(y)for(var E=a.iter(u);!E.done;E.next()){var B=E.value;(Tt=a.as(B.controller,N.TypeLockupController))&&(S=this.useKnockoutAnimation(Tt,i),this.modifyLockupForAnimation(Tt,S))}for(var z=a.iter(u);!z.done;z.next())B=z.value,S=!1,(Tt=a.as(B.controller,N.TypeLockupController))&&(I+=v.GraphemeUtils.countGraphemes(Tt.text),D+=Tt.text.split(" ").length,S=this.useKnockoutAnimation(Tt,i)),B.visitAll(h.FormaTraversal.PreOrder,(function(e){var t,o;(t=a.as(e,M.TextForma))&&F.push(t),(o=a.as(e,P.ShapeForma))&&(i==l.AnimationStyle.WORD_APPEAR_VARIANT&&!S||i==l.AnimationStyle.WORD_ZOOM_IN_VARIANT||i==l.AnimationStyle.WORD_CENTERED_VARIANT)&&L.push(o)}));a.sortInPlace(L,(function(e,t){return e.frame.width>t.frame.width})),F=a.clone(G.TypeLockupUtils.sortTextFormae(F)),s&&i!=l.AnimationStyle.LETTER_RANDOM_FADE_VARIANT&&(F=a.clone(G.TypeLockupUtils.padTextFormaeForLetterAnimation(F,i==l.AnimationStyle.LETTER_APPEAR_VARIANT)));var Y,W=[];i==l.AnimationStyle.WORD_CENTERED_VARIANT?c?((Y=a.first(L))&&W.push([Y]),p=p.concat(L)):W.push(L):i!=l.AnimationStyle.WORD_APPEAR_VARIANT&&i!=l.AnimationStyle.WORD_ZOOM_IN_VARIANT||W.push(L);var V=[],K=0;if(i==l.AnimationStyle.LETTER_RANDOM_FADE_VARIANT){for(var X=[],j=null,q=a.iter(F);!q.done;q.next()){var Z=q.value;null!=j&&G.TypeLockupUtils.formaForSameTextRun(Z,j)&&_.LockupStyle.isDuplicateFormaLook(Z.lockupForma.style.textLook)&&X.push(Z),j=Z}for(var J=a.iter(X);!J.done;J.next()){var Q=J.value;a.remove(F,Q)}for(var $=a.iter(F);!$.done;$.next()){T=$.value,W.push([T]);for(var ee=null,te=a.iter(X);!te.done;te.next())Q=te.value,G.TypeLockupUtils.formaForSameTextRun(T,Q)&&(W.push([Q]),ee=Q);for(var oe=a.iter(a.range(0,T.graphemeCount,!1));!oe.done;oe.next()){var ne,re=oe.value,ie=new O.TextRange(re,re+1),ae=[];ae.push(T),(ne=ee)&&ae.push(ne),V.push({key:ie,value:ae})}(ne=ee)&&a.remove(X,ne)}V=a.clone(a.shuffle(V))}else for(var le=[],se=a.iter(F);!se.done;se.next()){T=se.value;var ue,ce=!1;if(!s&&(ue=T.lockupForma)&&(Tt=a.as(ue.controller,N.TypeLockupController))&&this.lockupDoesPerLetterLayout(ue)){var he=ue.id;if(!le.includes(he)){var de=a.clone(a.as(Tt.groupLetterFormaeByWord(),["Array",["Array",h.Forma]]));a.append(W,de),le.push(ue.id)}ce=!0}ce||(!T.isDecorationTextForma()||!_.LockupStyle.isDuplicateFormaLook(T.textLook)||y&&i==l.AnimationStyle.WORD_CENTERED_VARIANT||(K+=1),W.push([T]))}var ge=H.TimingFunctionType.Step;i==l.AnimationStyle.WORD_ZOOM_IN_VARIANT?ge=H.TimingFunctionType.EaseOut:i==l.AnimationStyle.LETTER_APPEAR_FADE_VARIANT&&(ge=H.TimingFunctionType.Linear);var pe=H.TimingFunctionType.EaseOut,fe=s?1.5:1,me=Math.max(Math.min(a.toDouble(I)/7,2),fe);!s&&D>10&&(me+=.25*a.toDouble(D-10),me=Math.min(15,me));var ye=i==l.AnimationStyle.LETTER_APPEAR_VARIANT||i==l.AnimationStyle.LETTER_APPEAR_FADE_VARIANT?.15:0,ve=i==l.AnimationStyle.LETTER_RANDOM_FADE_VARIANT?V.length:W.length;ve-=K;var Se=me/a.toDouble(ve+2),Ce=a.toDouble(t.endTime.timescale)*Se,Te=a.toInt(a.toDouble(t.endTime.timescale)*(me+ye)),Ae=new U.TheoTime(Te,t.endTime.timescale),Fe=Ae.add(s?l.AnimationStyle.FADE_DURATION:new U.TheoTime(2,t.endTime.timescale));0==p.length&&(Fe=new U.TheoTime(Ae.value+1,Ae.timescale)),t.endTime=Fe;var ke=new U.TheoTime(t.endTime.timescale,t.endTime.timescale);i==l.AnimationStyle.LETTER_APPEAR_VARIANT&&(ke=new U.TheoTime(0,t.endTime.timescale));var Le={},be=a.toDouble(t.startTime.value)+ye*a.toDouble(t.endTime.timescale);if(i==l.AnimationStyle.LETTER_RANDOM_FADE_VARIANT)this.getRandomLetterAppearKeyFrames(W,i,t,ge,Le,V,be,Ce);else for(var _e=be,Re=_e,Ie=null,we=0,De=1,xe=a.iter(W);!xe.done;xe.next()){e=xe.value;for(var Pe=a.iter(e);!Pe.done;Pe.next()){var Ee;if(T=Pe.value,(Ze=a.as(T,M.TextForma))&&(j=a.as(Ie,M.TextForma))&&(Ee=a.as(a.opt(Ze.lockupForma,(function(e){return e.style})),_.LockupStyle))&&G.TypeLockupUtils.formaForSameTextRun(Ze,j)&&_.LockupStyle.isDuplicateFormaLook(Ee.textLook)&&T!==Ie){Le[T.formaID]=[];for(var Me=a.iter(Le[j.formaID]);!Me.done;Me.next()){var Ne=Me.value,Ge=a.opt(Ne.style,(function(e){return e.clone()}));a.opt(Ge,(function(e){return e.colors.fieldPrimary=Ze.style.colors.fieldPrimary})),a.opt(Ge,(function(e){return 0!=e.opacity}))&&a.opt(Ge,(function(e){return e.opacity=Ze.style.opacity}));var Be=new d.KeyFrame(Ne.time,Ne.timingFunction,Ne.placement,Ne.bounds,Ge,Ne.relativePlacement);Be.renderRuns.copyColorAlpha(Ze,Ne.renderRuns),Le[T.formaID].push(Be)}_e=Re}else{s&&(T===Ie?we+=1:we=0),Ie=T;var Oe=new U.TheoTime(a.toInt(Math.max(_e-De,0)),t.endTime.timescale);Ce<1&&(De=Ce),Oe.value<=t.startTime.value&&(Oe=new U.TheoTime(a.toInt(t.startTime.value+1),t.endTime.timescale));var Ue=new U.TheoTime(a.toInt(_e),t.endTime.timescale);Ue.value<=Oe.value&&Ce>=1&&(Ue=new U.TheoTime(Oe.value+1,t.endTime.timescale));var He=new U.TheoTime(a.toInt(_e+Ce-1),t.endTime.timescale);He.value<=Ue.value&&(He=new U.TheoTime(Ue.value+1,t.endTime.timescale));var ze,Ye,We=new U.TheoTime(He.value+1,t.endTime.timescale),Ve=T.style;if(S=!1,(Tt=a.as(T.controller,N.TypeLockupController))&&(S=this.useKnockoutAnimation(Tt,i)),(ze=a.as(a.opt(a.opt(a.as(T,M.TextForma),(function(e){return e.lockupForma})),(function(e){return e.controller})),N.TypeLockupController))&&(S=this.useKnockoutAnimation(ze,i)),i==l.AnimationStyle.LETTER_APPEAR_VARIANT){var Ke=S?0:1;Ye=w.MotionUtils.createOpacityStyle(T,Ke)}else{var Xe=S?0:Math.min(Ue.seconds/ke.seconds,.8);Ye=w.MotionUtils.createOpacityStyle(T,Xe)}var je=w.MotionUtils.createOpacityStyle(T,0);if(S&&i!=l.AnimationStyle.WORD_CENTERED_VARIANT){var qe=(o=a.opt(a.as(a.opt(a.opt(a.as(T,M.TextForma),(function(e){return e.lockupForma})),(function(e){return e.style})),_.LockupStyle),(function(e){return e.backingOpacity})))||null!=o?o:T.style.opacity;je=w.MotionUtils.createOpacityStyle(T,qe);var Ze,Je=!1;(Ze=a.as(T,M.TextForma))&&(Je=we>=Ze.graphemeCount),s&&!Je||(Ve=w.MotionUtils.createOpacityStyle(T,0))}if(s&&0!=we||(Le[T.formaID]=[],Le[T.formaID].push(new d.KeyFrame(t.startTime,ge,R.Matrix2D.Identity,null,je))),i==l.AnimationStyle.WORD_CENTERED_VARIANT){var Qe=this.calculateWordCenteredDynamicShift(T);T.isShape()&&y?(Le[T.formaID].push(new d.KeyFrame(Oe,ge,R.Matrix2D.Identity,null,je)),Le[T.formaID].push(new d.KeyFrame(Ue,ge,R.Matrix2D.Identity,null,je))):(Le[T.formaID].push(new d.KeyFrame(Oe,ge,Qe,null,je)),Le[T.formaID].push(new d.KeyFrame(Ue,ge,Qe,null,Ve))),T.isShape()?y?(Le[T.formaID].push(new d.KeyFrame(Ae.addVal(-10),pe,R.Matrix2D.Identity,null,je)),Le[T.formaID].push(new d.KeyFrame(Ae.addVal(-9),ge,R.Matrix2D.Identity,null,Ve))):(Le[T.formaID].push(new d.KeyFrame(Ae.addVal(-10),pe,Qe,null,Ve)),Le[T.formaID].push(new d.KeyFrame(Ae.addVal(-9),ge,Qe,null,je))):(Le[T.formaID].push(new d.KeyFrame(He,ge,Qe,null,Ve)),Le[T.formaID].push(new d.KeyFrame(We,ge,Qe,null,je))),T.isShape()&&y?Le[T.formaID].push(new d.KeyFrame(Ae,ge,R.Matrix2D.Identity,null,Ve)):Le[T.formaID].push(new d.KeyFrame(Ae,ge,R.Matrix2D.Identity,null,je))}else if(i==l.AnimationStyle.WORD_ZOOM_IN_VARIANT){var $e,et,tt=T.isFullCanvas?1:10;if(Qe=R.Matrix2D.Identity,($e=a.opt(a.opt(T.root,(function(e){return e.finalFrame})),(function(e){return e.center})))&&(et=T.totalPlacement.inverse)){var ot=et.transformPoint($e).subtract(T.bounds.center),nt=R.Matrix2D.scalingXYfromPoint(T.frame.center,tt,tt);Qe=nt.translate(ot)}a.opt(Le[T.formaID],(function(e){return e.push(new d.KeyFrame(Oe,ge,Qe,null,je))})),a.opt(Le[T.formaID],(function(e){return e.push(new d.KeyFrame(Ue,ge,Qe,null,Ve))})),a.opt(Le[T.formaID],(function(e){return e.push(new d.KeyFrame(He,ge,R.Matrix2D.Identity,null,Ve))}))}else if(i==l.AnimationStyle.LETTER_APPEAR_FADE_VARIANT){b.LegacyCoreAssert.fail("AnimationStyle.LETTER_APPEAR_FADE_VARIANT not updated for word forma",void 0,"AnimationLibrary.setDynamicWordAnimation","AnimationLibrary.swift",2137),a.opt(Le[T.formaID],(function(e){return e.push(new d.KeyFrame(Oe,ge,R.Matrix2D.Identity,null,je))})),a.opt(Le[T.formaID],(function(e){return e.push(new d.KeyFrame(Ue,ge,R.Matrix2D.Identity,null,Ye))}));var rt=Ue.addSeconds(ke.seconds),it=Fe.seconds>rt.seconds?rt:Fe.addVal(-1);a.opt(Le[T.formaID],(function(e){return e.push(new d.KeyFrame(it,ge,R.Matrix2D.Identity,null,Ve))}))}else{var at=new d.KeyFrame(Oe,ge,R.Matrix2D.Identity,null,je),lt=new d.KeyFrame(Ue,ge,R.Matrix2D.Identity,null,Ve);if(s){if(Z=a.as(T,M.TextForma)){var st=Z.graphemeCount,ut=we<st?we:st,ct=Z.fontColor,ht=Z.fontStrokeColor,dt=new x.SolidColor(ct.red,ct.green,ct.blue,0);S&&i!=l.AnimationStyle.WORD_CENTERED_VARIANT&&(dt=ct,ct=new x.SolidColor(ct.red,ct.green,ct.blue,0),ht=new x.SolidColor(ht.red,ht.green,ht.blue,0)),lt.renderRuns.applyColors(ct,ht,new O.TextRange(0,ut)),lt.renderRuns.applyColors(dt,dt,new O.TextRange(ut,st))}var gt=new d.KeyFrame(Oe,ge,R.Matrix2D.Identity,null,Ve);gt.renderRuns=lt.renderRuns,a.opt(Le[T.formaID],(function(e){return e.push(gt)}))}else a.opt(Le[T.formaID],(function(e){return e.push(at)}));a.opt(Le[T.formaID],(function(e){return e.push(lt)}))}this.validateKeyFrames(Le[T.formaID].concat(),"variants"),Re=_e}}_e+=Ce}for(var pt=a.iter(p);!pt.done;pt.next())T=pt.value,je=w.MotionUtils.createOpacityStyle(T,0),S=!1,(Tt=a.as(a.opt(a.opt(a.as(T,M.TextForma),(function(e){return e.lockupForma})),(function(e){return e.controller})),N.TypeLockupController))&&(S=this.useKnockoutAnimation(Tt,i)),S&&T instanceof M.TextForma&&(qe=(n=a.opt(a.as(a.opt(a.opt(a.as(T,M.TextForma),(function(e){return e.lockupForma})),(function(e){return e.style})),_.LockupStyle),(function(e){return e.backingOpacity})))||null!=n?n:T.style.opacity,je=w.MotionUtils.createOpacityStyle(T,qe)),null==Le[T.formaID]&&((kt=[]).push(new d.KeyFrame(t.startTime,pe,R.Matrix2D.Identity,null,je)),Le[T.formaID]=kt,a.opt(Le[T.formaID],(function(e){return e.push(new d.KeyFrame(Ae,pe,R.Matrix2D.Identity,null,je))})),this.validateKeyFrames(Le[T.formaID].concat(),"createOpacityStyle"));for(var ft=[],mt=a.iter(W);!mt.done;mt.next()){e=mt.value;for(var yt=a.iter(e);!yt.done;yt.next()){var vt=yt.value;ft.push(vt)}}for(var St=p.concat(ft),Ct=a.iter(this.uniqueFormae(St));!Ct.done;Ct.next()){var Tt;Ve=(T=Ct.value).style,S=!1,(Tt=a.as(a.opt(a.opt(a.as(T,M.TextForma),(function(e){return e.lockupForma})),(function(e){return e.controller})),N.TypeLockupController))&&(S=this.useKnockoutAnimation(Tt,i)),S&&T instanceof M.TextForma&&(Ve=w.MotionUtils.createOpacityStyle(T,0)),(kt=Le[T.formaID])&&kt.length>0&&kt[kt.length-1].time.value>=Fe.value&&a.info("error?"),Le[T.formaID].push(new d.KeyFrame(Fe,pe,R.Matrix2D.Identity,null,Ve)),Fe.value-15<t.endTime.value&&Le[T.formaID].push(new d.KeyFrame(t.endTime.addVal(15),pe,R.Matrix2D.Identity,null,Ve)),this.validateKeyFrames(Le[T.formaID].concat(),"fade time checks")}for(var At=e.concat(ft).concat(p),Ft=a.iter(this.uniqueFormae(At));!Ft.done;Ft.next()){var kt,Lt;if(kt=Le[(T=Ft.value).formaID])T.animation=d.FormaAnimation.init_9e82(t,t.startTime,t.endTime,kt.concat()),T.kind==M.TextForma.KIND&&(Lt=a.opt(a.opt(T.parent,(function(e){return e.parent})),(function(e){return e.parent})))&&Lt.isTypeLockup()&&null==Lt.animation&&this.setStillAnimation(Lt,t),this.validateKeyFrames(T.animation.keyFrames,"dynamicWord/setStillAnimation");else T.animation=null}}}},findLockupAncestor:function(e){return a.as(e.visit(h.FormaTraversal.NearestAncestor,(function(e,t,o){return e.isTypeLockup()})),y.GroupForma)},calculateWordCenteredDynamicShift:function(e){var t,o,n,r;if((t=this.findLockupAncestor(e))&&this.lockupDoesPerLetterLayout(t))return R.Matrix2D.Identity;if((o=a.opt(a.opt(e.root,(function(e){return e.finalFrame})),(function(e){return e.center})))&&(n=e.totalPlacement.inverse)&&(r=a.opt(e.bounds,(function(e){return e.center})))){var i,l,s,u;if((i=a.as(e,M.TextForma))&&(r=i.getBoundsCenter()),(l=e.placement.inverse)&&(s=e.bounds)&&(u=e.parent)){var c=o.subtract(u.totalPlacement.transformPoint(B.TheoPoint.ZERO));return l.translate(new B.TheoPoint(-s.width/2+c.x,-s.height/2+c.y))}var h=n.transformPoint(o);return R.Matrix2D.translation(h.subtract(r))}return R.Matrix2D.Identity},uniqueFormae:function(e){for(var t=[],o=a.iter(e);!o.done;o.next()){var n=o.value;a.containsEq(t,n,h._equality_Forma_Forma)||t.push(n)}return t},getTitleLockups:function(e){var t=a.clone(e.filterWithCallback((function(e){return e.isTypeLockup()})));if(0==t.length)return[];a.sortInPlace(t,(function(e,t){return e.controller.currentHeightScale>t.controller.currentHeightScale}));for(var o=t[0],n=[o],r=a.iter(t);!r.done;r.next()){var i,l,s=r.value;if(!a.eq(h._equality_Forma_Forma,s,o)&&(i=a.as(s.controller,N.TypeLockupController))&&(l=a.as(o.controller,N.TypeLockupController))){var u=i.getCurrentFontSize(),c=l.getCurrentFontSize();Math.abs(u-c)/Math.min(u,c)<.05&&n.push(s)}}return n},setSlideAnimation:function(e,t,o){var n,r=[],i=[],s=!1,u=!1;if(C.Host.textModelUtils.usePGMRenderer()||(n=a.opt(a.as(e.controller,N.TypeLockupController),(function(e){return e.lockupStyle})))&&(_.LockupStyle.isKnockoutLook(n.textLook)&&n.backing==_.LockupBacking.Knockout&&(s=!0),u=_.LockupStyle.isKnockoutLook(n.textLook)&&n.textLook!=_.LockupTextLook.KnockoutOnly),e.isTypeLockup()?e.visitAll(h.FormaTraversal.PreOrder,(function(e){u||e instanceof P.ShapeForma?i.push(e):e instanceof M.TextForma&&r.push(e)})):r.push(e),2==t.variant||1==t.variantCount||s){var c=75;s&&(c=2==t.variant||1==t.variantCount?-75:0==t.variant?-200:200);var g=R.Matrix2D.translation(new B.TheoPoint(-c,0)),p=R.Matrix2D.translation(new B.TheoPoint(c,0)),f=t.endTime.multiply(2/3);if(this.setFormaAnimations(r,t,0,e.style.opacity,g,H.TimingFunctionType.EaseInOut,t.startTime,t.startTime,f),this.setFormaAnimations(i,t,0,e.style.opacity,p,H.TimingFunctionType.EaseInOut,t.startTime,t.startTime,f),e.isTypeLockup()){var m=[];m.push(new d.KeyFrame(t.startTime,H.TimingFunctionType.Linear)),m.push(new d.KeyFrame(f,H.TimingFunctionType.Linear)),e.animation=d.FormaAnimation.init_9e82(t,t.startTime,t.endTime,m.concat()),e.animation=d.FormaAnimation.init_9e82(t,t.startTime,f,m.concat())}}else{var y=t.endTime.subtract(l.AnimationStyle.FADE_DURATION);a.containsEq(o,e,h._equality_Forma_Forma)?(g=R.Matrix2D.translation(new B.TheoPoint(0==t.variant?-200:200,0)),this.setLineAnimation(e,t,g,H.TimingFunctionType.EaseInOut,t.startTime,y,new U.TheoTime(a.toInt(.1*a.toDouble(t.endTime.timescale)),t.endTime.timescale)),this.setStillAnimation(e,t,t.startTime,y)):this.setFormaFade(e,t,t.startTime,t.endTime,y)}},setFormaFade:function(e,t,o,n,r){var i,a=e;(i=k.ImageFacade.getImageFormaForForma(e))&&(a=i);var l=a.style,s=w.MotionUtils.createOpacityStyle(a,0),u=[];u.push(new d.KeyFrame(o,H.TimingFunctionType.Linear,R.Matrix2D.Identity,null,s)),u.push(new d.KeyFrame(r,H.TimingFunctionType.Linear,R.Matrix2D.Identity,null,s)),u.push(new d.KeyFrame(n,H.TimingFunctionType.Linear,R.Matrix2D.Identity,null,l)),e.animation=d.FormaAnimation.init_9e82(t,o,n,u.concat())},getShiftingMatrix:function(e,t,o,n){var r,i=e.finalFrame,a=e.root.frame,l=e.root.placement.inverse.transformPoint(a.eval(o)),s=R.Matrix2D.scaling(t),u=e.root.placement.concat(s).transformPoint(l);return r=n?u.subtract(i.center):a.center.subtract(u),R.Matrix2D.scaling(t).translate(r)},setFormaAnimations:function(e,t,o,n,r,i,l,s,u){void 0===o&&(o=null),void 0===n&&(n=null),void 0===r&&(r=R.Matrix2D.Identity),void 0===i&&(i=H.TimingFunctionType.Linear);for(var c=a.iter(e);!c.done;c.next()){var h=c.value,g=h.style,p=null!=o?w.MotionUtils.createOpacityStyle(h,o):g,f=null!=n?w.MotionUtils.createOpacityStyle(h,n):g,m=[];l.value!=s.value&&m.push(new d.KeyFrame(l,i,r,null,p)),m.push(new d.KeyFrame(s,i,r,null,p)),m.push(new d.KeyFrame(u,i,R.Matrix2D.Identity,null,f)),h.animation=d.FormaAnimation.init_9e82(t,l,u,m.concat())}},setGreyscaleAnimation:function(e,t){var o=[],n=e.page.imageFilterLibrary.getImageStyle(L.ImageStyle.NAME_GREYSCALE).clone();n.colorLibrary=e.style.colorLibrary;var r=e.style.clone();null==r.filter&&(r.filter=F.CompositeFilter.init_514f(void 0,"None",0,"normal",void 0,void 0,"none")),b.LegacyCoreAssert.isTrue(n.colorLibrary==e.style.colorLibrary,"color library mismatch: forma style and greyscale image style",void 0,"AnimationLibrary.setGreyscaleAnimation","AnimationLibrary.swift",2561),b.LegacyCoreAssert.isTrue(r.colorLibrary==e.style.colorLibrary,"color library mismatch: forma style and clone",void 0,"AnimationLibrary.setGreyscaleAnimation","AnimationLibrary.swift",2562),n.adjustments=e.style.adjustments,r.adjustments=e.style.adjustments,o.push(new d.KeyFrame(t.startTime,H.TimingFunctionType.Linear,R.Matrix2D.Identity,null,n)),o.push(new d.KeyFrame(t.endTime,H.TimingFunctionType.Linear,R.Matrix2D.Identity,null,r)),e.animation=d.FormaAnimation.init_9e82(t,t.startTime,t.endTime,o.concat())},setBlurAnimation:function(e,t){t.endTime=l.AnimationStyle.DEFAULT_DURATION.subtract(new U.TheoTime(30,30));var o=[],n=e.style.clone(),r=e.style.clone();null!=n.filter&&n.filter instanceof F.CompositeFilter||((n=e.page.imageFilterLibrary.getImageStyle(L.ImageStyle.NAME_BLUR).clone()).colorLibrary=e.style.colorLibrary,(r=e.page.imageFilterLibrary.getImageStyle(L.ImageStyle.NAME_BLUR).clone()).colorLibrary=e.style.colorLibrary),b.LegacyCoreAssert.isTrue(n.colorLibrary==e.style.colorLibrary,"color library mismatch: forma style and first clone",void 0,"AnimationLibrary.setBlurAnimation","AnimationLibrary.swift",2594),b.LegacyCoreAssert.isTrue(r.colorLibrary==e.style.colorLibrary,"color library mismatch: forma style and second clone",void 0,"AnimationLibrary.setBlurAnimation","AnimationLibrary.swift",2595),n.adjustments=e.style.adjustments,r.adjustments=e.style.adjustments,n.filter.blurRadius=20,r.filter.blurRadius=0,o.push(new d.KeyFrame(t.startTime,H.TimingFunctionType.EaseOut,R.Matrix2D.Identity,null,n)),o.push(new d.KeyFrame(t.endTime,H.TimingFunctionType.EaseOut,R.Matrix2D.Identity,null,r)),e.animation=d.FormaAnimation.init_9e82(t,t.startTime,t.endTime,o.concat())},setFillAnimation:function(e,t){var o,n,r=[];if((o=e.style.clone())&&(n=e.style.clone())){o.filter=F.CompositeFilter.init_514f(void 0,"Fill",1,"normal",void 0,void 0,"none"),null==n.filter&&(n.filter=F.CompositeFilter.init_514f(void 0,"None",0,"normal",void 0,void 0,"none")),o.colorLibrary=e.style.colorLibrary,n.colorLibrary=e.style.colorLibrary,o.adjustments=e.style.adjustments,n.adjustments=e.style.adjustments;var i=a.clone(e.page.colorLibraryController.getThemeColorKeys());i.length>t.variant&&(o.colors.fieldPrimary=e.page.colorLibraryController.getSolidColorForKey(a.as(i[t.variant],"String")),o.colors.fieldSecondary=null,a.opt(o.filter,(function(e){return e.style=o})),a.opt(n.filter,(function(e){return e.style=n})),r.push(new d.KeyFrame(t.startTime,H.TimingFunctionType.EaseInOut,R.Matrix2D.Identity,null,o)),r.push(new d.KeyFrame(t.endTime,H.TimingFunctionType.EaseInOut,R.Matrix2D.Identity,null,n)),e.animation=d.FormaAnimation.init_9e82(t,t.startTime,t.endTime,r.concat()))}},setColorSwitchAnimation:function(e,t){var o,n,r=[];if((o=e.style.clone())&&(n=e.page.imageFilterLibrary.getImageStyle(L.ImageStyle.NAME_OVERLAY).clone())){var i;if(null==o.filter&&(o.filter=F.CompositeFilter.init_514f(void 0,"None",0,"normal",void 0,void 0,"none")),i=a.as(n.filter,F.CompositeFilter)){var l=a.clone(e.page.colorLibraryController.getThemeColorKeys());l.length>t.variant&&(n.colors.fieldPrimary=e.page.colorLibraryController.getSolidColorForKey(a.as(l[t.variant],"String"))),i.mix=Math.max(i.mix,1)}b.LegacyCoreAssert.isTrue(o.colorLibrary==e.style.colorLibrary,"color library mismatch: forma style and clone",void 0,"AnimationLibrary.setColorSwitchAnimation","AnimationLibrary.swift",2675),n.colorLibrary=e.style.colorLibrary,o.adjustments=e.style.adjustments,n.adjustments=e.style.adjustments,r.push(new d.KeyFrame(t.startTime,H.TimingFunctionType.EaseInOut,R.Matrix2D.Identity,null,o)),r.push(new d.KeyFrame(t.endTime,H.TimingFunctionType.EaseInOut,R.Matrix2D.Identity,null,n)),e.animation=d.FormaAnimation.init_9e82(t,t.startTime,t.endTime,r.concat())}},setZoomAnimation:function(e,t){var o=0==t.variant?.8:1.2;e instanceof p.FrameForma?this.setScaleForma(e,t,new B.TheoPoint(o,o),new B.TheoPoint(.5,.5),H.TimingFunctionType.EaseOut,t.startTime,t.endTime):this.setImageAnimation(e,t,H.TimingFunctionType.EaseOut,[[t.startTime,B.TheoPoint.ZERO,o],[t.endTime,B.TheoPoint.ZERO,1]],!0)},setPanningAnimation:function(e,t){var o,n,r,i=!(!(o=a.opt(a.as(e,A.ImageForma),(function(e){return e.hasAlpha()})))&&null==o)&&o;(n=k.ImageFacade.getFrameFormaForForma(e))&&(r=a.as(n.controller,g.FrameController))&&(i=i||r.hasCutout);var l=1==t.variant?-150:150;this.setImageAnimation(e,t,H.TimingFunctionType.EaseOut,[[t.startTime,new B.TheoPoint(l,0),1],[t.endTime,B.TheoPoint.ZERO,1]],!i)},randomDbl:function(){return a.toDouble(u.CoreRandom.nextInt)/a.toDouble(u.CoreRandom.randMax)},setAnimationStyleForFormae:function(e,t,o){if(void 0===o&&(o=null),t.name==l.AnimationStyle.NAME_COLORSWAP)this.setColorSwapAnimation(e,t,o);else if(t.name==l.AnimationStyle.NAME_FLICKER)this.setFlickerAnimation(e,t);else if(t.name==l.AnimationStyle.NAME_DYNAMIC||t.name==l.AnimationStyle.NAME_TYPE)this.setDynamicWordAnimation(e,t);else if(t.name==l.AnimationStyle.NAME_FADE&&0==t.variant)this.setFadeAnimationTopDown(e,t);else{for(var n=!1,r=a.as(a.opt(a.first(e),(function(e){return e.root})),D.RootForma),i=a.clone(null!=r?this.getTitleLockups(r):[]),s=a.iter(e);!s.done;s.next()){var u=s.value;n=n||!a.containsEq(i,u,h._equality_Forma_Forma)}t.name==l.AnimationStyle.NAME_SLIDE&&t.variantCount<2&&(t.endTime=t.endTime.addSeconds(-1));for(var c=U.TheoTime.Zero,d=a.iter(e);!d.done;d.next()){var g;if(null!=(u=d.value).controller){var f,m,y=u.hasIntent(h.Forma.INTENT_ICON)&&this.shouldAnimateShape(u),v=u.kind==p.FrameForma.KIND&&u.controller.moveable;if(y||u.isTypeLockup()||v)(m=a.as(u.controller,N.TypeLockupController))&&m.updateGroup(),t.name==l.AnimationStyle.NAME_NO_STYLE?u.animation=null:t.name==l.AnimationStyle.NAME_GROW?this.setGrowAnimation(u,t,i):t.name==l.AnimationStyle.NAME_FADE?this.setFadeAnimation(u,t,i):t.name==l.AnimationStyle.NAME_SLIDE&&this.setSlideAnimation(u,t,i);else if(f=k.ImageFacade.getImageFormaForForma(u)){var S;if((S=a.as(u,z.VideoForma))&&S.videoContentNode.isGIF){this.setStillAnimation(f,t);continue}if(t.name==l.AnimationStyle.NAME_NO_STYLE)f.animation=null;else if(t.name==l.AnimationStyle.NAME_BLUR)this.setBlurAnimation(f,t);else if(t.name==l.AnimationStyle.NAME_GRAYSCALE)this.setGreyscaleAnimation(f,t);else if(t.name==l.AnimationStyle.NAME_FILL)this.setFillAnimation(f,t);else if(t.name==l.AnimationStyle.NAME_COLOR)this.setColorSwitchAnimation(f,t);else if(t.name==l.AnimationStyle.NAME_PAN){var C=f.controller.floating?f.parent:f;this.setPanningAnimation(C,t)}else t.name==l.AnimationStyle.NAME_ZOOM&&(C=f.controller.floating?f.parent:f,this.setZoomAnimation(C,t))}}(g=u.animation)&&g.endTime.seconds>c.seconds&&(c=g.endTime)}c.seconds>0&&(t.endTime=c)}},setRootAnimationStyle:function(e,t){this.setStillAnimation(t,e),w.MotionUtils.invalidateAnimation(t.page)},modifyModelForAnimation:function(e,t){this.isModifyingModelForAnimation_=!0,this.modifyModelForAnimationHelper(e,t),this.isModifyingModelForAnimation_=!1},modifyModelForAnimationHelper:function(e,t){var o,r,i=this,s=a.as((e||t.page.animationLibrary.getNoneStyle()).forkToDatabase(S.GUIDUtils.makeGUID(),!1,t.database,null),l.AnimationStyle);if(r=s){var u=new f.FormaAnimationChangedEvent(t);if(t.beginUpdate(u),I.MotionFacade.canApplyStyle(r))return I.MotionFacade.applyStyle(t,r),void t.endUpdate(u);var c=r.name,m=c==l.AnimationStyle.NAME_NO_STYLE,y=c==l.AnimationStyle.NAME_COLORSWAP;r.endTime=m?l.AnimationStyle.NOOP_DURATION:l.AnimationStyle.DEFAULT_DURATION;var v=[],C=U.TheoTime.Zero,T=[],A=!1;t.visitAll(h.FormaTraversal.PreOrder,(function(e){var t,n,r;if((t=a.as(e,z.VideoForma))&&(n=a.opt(t.parent,(function(e){return e.controller})))){var i=Y.VideoFacade.getDurationForVideo(t);i.isZero||(n.moveable?T.push(t):C.seconds<i.seconds&&(C=i))}if(e.animation=null,r=e.controller){if(r.userGroup)return;r.moveable&&!e.isVideo()&&(A=!0);var l=r.moveable&&e.isImage()&&!e.isSticker(),s=y&&l&&!(!(o=a.opt(a.as(r,g.FrameController),(function(e){return e.hasBackgroundColor})))&&null==o)&&o;l&&!s||e.isLogo()||v.push(e)}}));for(var F=a.iter(T);!F.done;F.next()){var L,_=F.value;a.remove(v,_),(L=_.parent)&&a.remove(v,L)}A||(r.endTime=l.AnimationStyle.NOOP_DURATION);var R=r.endTime.timescale,D=null;if(y&&!C.isZero){var x=C.seconds,P=l.AnimationStyle.COLOR_SWAP_DURATION.seconds;D=n.extendToIntegralCount(P,x,R)}this.setAnimationStyleForFormae(v,r,D);var E=r.endTime,M=E,N=U.TheoTime.fromTimeInTimescale(l.AnimationStyle.STILL_DURATION,R);if(T.length>0||!C.isZero){for(var G=l.AnimationStyle.GIF_DURATION,B=U.TheoTime.Zero,O=a.iter(T);!O.done;O.next()){var H=O.value,W=Y.VideoFacade.getDurationForVideo(H);W.laterThan(B)&&(B=W)}if(C.isZero){if(!y){var V=B.seconds,K=Math.max(V,G.seconds),X=n.extendToIntegralCount(K,V,R);M=E.add(X)}}else{var j=E.seconds;if(!y){var q=C.safeSubtract(E);!m&&q.earlierThan(N)&&(q=N),q.earlierThan(B)&&(q=B),m&&T.length>0&&q.earlierThan(G)&&(q=G),j+=q.seconds}x=C.seconds,M=n.extendToIntegralCount(j,x,R)}for(var Z=y?r.startTime:r.endTime,J=a.iter(T);!J.done;J.next()){H=J.value;var Q=w.MotionUtils.createOpacityStyle(H,0),$=H.style,ee=[];m||y?ee.push(d.KeyFrame.makeFromTimeAndStyle(Z,$)):(ee.push(d.KeyFrame.makeFromTimeAndStyle(r.startTime,Q)),ee.push(d.KeyFrame.makeFromTimeAndStyle(Z,Q)),ee.push(d.KeyFrame.makeFromTimeAndStyle(Z.addSeconds(.5),$))),ee.push(d.KeyFrame.makeFromTimeAndStyle(M,$)),H.animation=d.FormaAnimation.init_9e82(r,Z,M,ee.concat())}}else y||(M=M.add(N));r.endTime=M;for(var te=a.iter(v);!te.done;te.next()){var oe,ne,re=te.value;(oe=a.as(re,z.VideoForma))&&(ne=a.opt(oe.parent,(function(e){return e.controller})))&&!ne.moveable&&m&&this.setStillAnimation(re,r)}!y&&r.endTime.value>0&&this.setStillAnimation(t,r),t.visitAll(h.FormaTraversal.PreOrder,(function(e){var t,o;(t=e.animation)&&(e.kind==p.FrameForma.KIND&&(o=k.ImageFacade.getImageFormaForForma(e))&&null==o.animation&&i.setStillAnimation(o,r),i.validateKeyFrames(t.keyFrames,"applyStyle/setStillAnimation"))})),t.endUpdate(u)}else b.LegacyCoreAssert.fail("Unable to fall back on 'None' style while applying animation?!?",void 0,"AnimationLibrary.modifyModelForAnimationHelper","AnimationLibrary.swift",3142),t.animation=null},validateKeyFrames:function(e,t){var o=e.length;if(!(o<=1))for(var n=a.iter(a.range(0,o-1,!1));!n.done;n.next()){var r=n.value,i=e[r],l=e[r+1];i.time.value>l.time.value&&l.time.value>0&&a.opt(C.Host.logging,(function(e){return e.error("keyframe time error on frames "+r+"/"+(r+1)+" with context "+t)}))}}}}),n)},KdeS:function(e,t,o){var n,r=t,i=o("oAGj"),a=o("1NAc");r.LockupWordInfo=(n=function(e,t,o,n,r,i,l,s,u){this.complementaryStyleAspectRatio=null,this.complementaryStyleSpaceAspectRatio=null,void 0===u&&(u=a.TheoSize.Zero),this.text=e,this.aspectRatio=t,this.spaceAspectRatio=o,this.characterStyle=n,this.characterHeightRatio=r,this.isNewLine=i,this.canBreak=l,this.rangeInLockup=s,this.relativeMargins=u},i.defineClass({name:"LockupWordInfo",ctor:n}),n)},"KgU+":function(e,t,o){var n,r,i,a,l,s=t,u=o("oAGj"),c=o("Tq01"),h=o("cYKp"),d=o("yGNn"),g=o("Kkml");s.ApplyAnimationStyleAction=(n=function e(t,o){this.style=t,this.page=o,c.Action.call(this,e.TYPE)},u.defineClass({name:"ApplyAnimationStyleAction",ctor:n,superName:"Action",statics:{TYPE:"ApplyAnimationStyleAction"},props:{getUserAction:function(e){return g.UserActions.ApplyAnimationStyle()},execute:function(e){return this.page.animationLibrary.setRootAnimationStyle(this.style,this.page.root),d.CorePromise.resolve(null)}}}),n),s.ApplyAnimationStyleForPlaybackAction=(r=function(e,t){s.ApplyAnimationStyleAction.call(this,e,t)},u.defineClass({name:"ApplyAnimationStyleForPlaybackAction",ctor:r,superName:"ApplyAnimationStyleAction",props:{getUserAction:function(e){return g.UserActions.ApplyAnimationStyleForPlayback()},execute:function(e){return h.AnimationFacade.applyAnimationStyle(this.style,this.page),d.CorePromise.resolve(null)}}}),r),s.ResetAnimation=(i=function e(t,o){this.resetFormaTree=t,this.page=o,c.Action.call(this,e.TYPE)},u.defineClass({name:"ResetAnimation",ctor:i,superName:"Action",statics:{TYPE:"ResetAnimation"},props:{getUserAction:function(e){return g.UserActions.ResetAnimation()},execute:function(e){return u.opt(this.page.root.animation,(function(e){return e.invalidate()})),d.CorePromise.resolve(null)}}}),i),s.ShuffleAnimationStyleAction=(a=function e(t,o){this.style=t,this.page=o,c.Action.call(this,e.TYPE)},u.defineClass({name:"ShuffleAnimationStyleAction",ctor:a,superName:"Action",statics:{TYPE:"ShuffleAnimationStyleAction"},props:{getUserAction:function(e){return g.UserActions.ShuffleAnimationStyle()},execute:function(e){var t=h.AnimationFacade.shuffleAnimationStyle(this.style,this.page);return this.page.animationLibrary.setRootAnimationStyle(t,this.page.root),d.CorePromise.resolve(new c.AnimationStyleActionResult(t))}}}),a),s.ApplyAndPrepareAnimationAction=(l=function(e,t){this.style=e,this.page=t,c.Action.call(this,s.ApplyAnimationStyleAction.TYPE)},u.defineClass({name:"ApplyAndPrepareAnimationAction",ctor:l,superName:"Action",statics:{TYPE:"ApplyAndPrepareAnimationAction"},props:{getUserAction:function(e){return g.UserActions.ApplyAndPrepareAnimationAction()},execute:function(e){return this.page.animationLibrary.setRootAnimationStyle(this.style,this.page.root),this.page.animationLibrary.modifyModelForAnimation(u.opt(this.page.root.animation,(function(e){return e.animationStyle})),this.page.root),this.page.animationController.saveStaticState(),d.CorePromise.resolve(null)}}}),l)},LhEC:function(e,t,o){var n,r=t,i=o("oAGj"),a=o("ZK0l");r.PROPERTY_SIZE_DEPRECATED="size",r.ResponsiveController=(n=function(e,t,o){a.GroupController.call(this,e,t,o)},i.defineClass({name:"ResponsiveController",ctor:n,superName:"GroupController",statics:{KIND:{get:function(){return"responsive"}}}}),n)},LqGn:function(e,t,o){var n,r=t,i=o("oAGj"),a=o("CWW7"),l=o("yGNn"),s=o("ascj"),u=o("FNB+"),c=o("6ZWm"),h=o("cmoc"),d=o("G1DZ"),g=o("P83h"),p=o("9Lk3"),f=o("ZK0l"),m=o("/afT"),y=o("pnSN"),v=o("iCxV"),S=o("lmwz"),C=o("fNpk"),T=o("MYNe"),A=o("c+uM"),F=o("tGKA"),k=o("JFv5"),L=o("uxH+"),b=o("ODYV"),_=o("K0Rh"),R=o("MZST"),I=o("iSwi"),w=o("djAF"),D=o("35Q0"),x=o("T6jX"),P=o("fAXt"),E=o("8t9B"),M=o("oKlP"),N=o("oKI3"),G=o("sIWg");r.RetargetSuggestion=(n=function(e,t,o,n,r,a){this.correspondence_=i.clone(r),this.modelDoc_=n,this.forma_=e,this.modelForma_=o,this.score_=new R.RetargetScore(t,o,r),this.layoutUpdate_=a,this.disableFallback_=!1},i.defineClass({name:"RetargetSuggestion",ctor:n,superName:"CoreObject",statics:{_implements:function(e){return"IDesignSuggestion"==e}},props:{score:{get:function(){return i.opt(this.score_,(function(e){return e.score}))}},weightedScore:{get:function(){return this.score_}},forma:{get:function(){return this.forma_}},layoutUpdate:{get:function(){return this.layoutUpdate_}},modelDoc:{get:function(){return this.modelDoc_}},disableFallback:{get:function(){return this.disableFallback_},set:function(e){this.disableFallback_=e}},distanceTo:function(e){return C.LegacyCoreAssert.fail("no distance",void 0,"RetargetSuggestion.distanceTo","RetargetSuggestion.swift",49),0},getGroupCorrespondences:function(){for(var e=this.forma_,t=[],o=i.iter(this.correspondence_);!o.done;o.next()){for(var n=o.value,r=[],a=i.iter(n.a);!a.done;a.next()){var l=a.value;e.visitAll(u.FormaTraversal.PreOrder,(function(e){e.originalID==l.originalID&&r.push(e)}))}t.push({a:r,b:n.b})}return t},matchGroupStyle:function(e,t){var o,n,r,a,l=this;if(0!=e.length&&0!=t.length){var s,c,h=e.filter((function(e){return e.kind==_.RootForma.KIND}),this),d=t.filter((function(e){return e.kind==_.RootForma.KIND}),this);h.length>0&&d.length>0&&(s=i.opt(i.as(h[0].controller,L.RootController),(function(e){return e.getGridController()})))&&(c=i.opt(i.as(d[0].controller,L.RootController),(function(e){return e.getGridController()})))&&(h[0].matchColors(d[0]),s.matchStyle(c));for(var g=[],p=[],f=i.iter(e);!f.done;f.next()){var m=f.value,y=i.clone(m.controller.userGroup?m.visitAsArray(u.FormaTraversal.PreOrder):[m]);i.append(g,y.filter((function(e){return l.considerFormaForRestyle(e)}),this))}for(var v=i.iter(t);!v.done;v.next())m=v.value,y=i.clone(m.controller.userGroup?m.visitAsArray(u.FormaTraversal.PreOrder):[m]),i.append(p,y.filter((function(e){return l.considerFormaForRestyle(e)}),this));if(0!=g.length){g=i.sort(g,(function(e,t){return((o=e.controller.currentHeightScale)||null!=o?o:0)>((n=t.controller.currentHeightScale)||null!=n?n:0)})),p=i.sort(p,(function(e,t){return((r=e.controller.currentHeightScale)||null!=r?r:0)>((a=t.controller.currentHeightScale)||null!=a?a:0)}));for(var S=i.clone(this.getUniqueStyles(p)),C=i.clone(this.getUniqueStyles(g)),T=i.iter(i.range(0,Math.min(S.length,C.length),!1));!T.done;T.next())for(var F=T.value,k=S[F],b=C[F].clone(),R=i.clone(this.styleMatchedForma(g,b)),I=i.clone(this.styleMatchedForma(p,k)),w=i.iter(R);!w.done;w.next()){var D,x=w.value;(O=i.as(x.controller,E.TypeLockupController))&&(U=O.lockupStyle)&&(D=i.as(k.clone(),A.LockupStyle))&&(D.layout=U.layout,D.alignment=U.alignment,D.pathID=U.pathID,D.spacing=Math.min(D.spacing,1),U.layout==A.LockupLayout.Standard&&U.pathID==N.TextPathID.UNSET||(D.backing=U.backing,D.backing==A.LockupBacking.SVGBackground&&null==D.backingArtworkID&&(D.backing=A.LockupBacking.None)),O.addLineBreakConstraints(!0),x.applyStyle(D),O.removeLineBreakConstraints(),A.LockupStyle.isKnockoutLook(k.textLook)&&(k.backing=A.LockupBacking.None,A.LockupStyle.isKnockoutLook(k.textLook)&&(k.textLook=A.LockupTextLook.Fill)),R.length>1&&I.length<=1&&k.backing==A.LockupBacking.SVGBackground&&!A.LockupStyle.isKnockoutLook(k.textLook)&&(k.backing=A.LockupBacking.None))}if(C.length>S.length)for(var P=i.iter(i.range(S.length,C.length,!1));!P.done;P.next())for(var M=P.value,G=A.LockupStyle.createDefault(),B=(b=C[M],i.iter(g));!B.done;B.next()){var O,U;x=B.value,(O=i.as(x.controller,E.TypeLockupController))&&(U=O.lockupStyle)&&this.styleMatch(b,U)&&(O.addLineBreakConstraints(!0),U.colors.match(G.colors),U.font=G.font,O.removeLineBreakConstraints())}}}},considerFormaForRestyle:function(e){var t;return!!(t=i.as(e.controller,E.TypeLockupController))&&t.text.length>1},getUniqueStyles:function(e){for(var t=this,o=[],n=i.iter(e);!n.done;n.next()){var r,a,l=n.value;(r=i.as(l.controller,E.TypeLockupController))&&(a=r.lockupStyle)&&(o.filter((function(e){return t.styleMatch(a,e)}),this).length>0||o.push(a.clone()))}return o},styleMatchedForma:function(e,t){for(var o=[],n=i.iter(e);!n.done;n.next()){var r,a,l=n.value;(r=i.as(l.controller,E.TypeLockupController))&&(a=r.lockupStyle)&&this.styleMatch(a,t)&&o.push(l)}return o},styleMatch:function(e,t){return i.opt(e.font,(function(e){return e.fontData.postScriptName==i.opt(t.font,(function(e){return e.fontData.postScriptName}))}))},getParentExpansionFrame:function(e){for(var t=null,o=i.iter(i.range(0,e.length,!1));!o.done;o.next()){var n=e[o.value].controller.visualParentExpansionFrame;t=null==t?n:t.unionWith(n)}return t},getUnionFrame:function(e){for(var t=null,o=i.iter(i.range(0,e.length,!1));!o.done;o.next()){var n=e[o.value].finalFrame;t=null==t?n:t.unionWith(n)}return t},matchGroupLayout:function(e,t){if(0==e.length||0==t.length)return!1;var o=i.clone(t),n=i.clone(T.LayerFacade.sortInZOrder(e)),r=i.clone(m.GroupDetector.detectProximityGroups(n,null,!1)),a=t[0].root.finalFrame,l=i.opt(this.getParentExpansionFrame(o),(function(e){return e.intersectionWith(a)})),s=i.opt(this.getUnionFrame(o),(function(e){return e.intersectionWith(a)}));if(C.LegacyCoreAssert.isTrue(a.equalWithAccuracy(e[0].root.finalFrame,1),"after resizing the model, the frames should match",void 0,"RetargetSuggestion.matchGroupLayout","RetargetSuggestion.swift",308),1==r.length){var u=i.opt(this.getUnionFrame(n),(function(e){return e.intersectionWith(a)}));y=(y=G.TheoRect.fromSize(s.fitAspectRatioWithin(u.aspectRatio))).moveToPoint(s.center,new M.TheoPoint(.5,.5));var c,h=Math.sqrt(u.area/y.area);if((v=y.scale(h).intersectionWith(l.insetRel(.1,.1,.1,.1)))&&(y=v),c=y.intersectionWith(u)){var d=c.area/Math.max(y.area,u.area),g=y.area/a.area;if(d>.6&&g>.5)return!1}this.moveFormaToRegion(n,u,y)}else{var p=r.map((function(e){return x.TheoDocumentUtils.unionFinalFrame(e)}),this),f=p.reduce((function(e,t){return e+t.area}),0),y=s;if((h=Math.sqrt(f/y.area))>1){var v,S=l.insetRel(.1,.1,.1,.1);(v=y.scaleXY(1,h).intersectionWith(S))&&(y=v),h=Math.sqrt(f/y.area),(v=y.scaleXY(h,1).intersectionWith(S))&&(y=v)}for(var F=i.clone(y.insetRel(.1,.1,0,0).split(r.length,!0)),k=p.map((function(e){return e.height/a.height+.1}),this),L=i.clone(y.insetRel(0,0,.1,.1).split(r.length,!1,k)),b=0,_=0,R=i.iter(i.range(0,p.length,!1));!R.done;R.next())b+=p[P=R.value].similarity(F[P]),_+=p[P].similarity(L[P]);for(var I=i.clone(b<_?F:L),w=i.iter(i.range(0,r.length,!1));!w.done;w.next()){var D,P=w.value;if(D=this.getUnionFrame(r[P])){var N=I[P].insetRel(0,0,0==P?0:.1,P==r.length-1?0:.1);this.moveFormaToRegion(r[P],D,N)}}for(var B=i.iter(e);!B.done;B.next()){var O,U,H=B.value;(O=i.as(H.controller,E.TypeLockupController))&&(U=O.lockupStyle)&&(U.alignment!=A.LockupAlignment.Left&&U.alignment!=A.LockupAlignment.Right||(U.alignment=A.LockupAlignment.Center),O.snapSizeToBounds())}}return!0},moveFormaToRegion:function(e,t,o){if(0!=e.length){var n=e[0].parent,r=n.page.createFormaWithController(y.GroupForma.KIND,f.GroupController.KIND);r.allowUserMove=!1,r.isModel=!0,r.controller.preferredResizeType=k.ResizeLayoutType.Proportional,n.appendChild(r),r.placement=F.Matrix2D.translationXY(t.minX,t.minY),r.bounds=G.TheoRect.fromSize(t.size);for(var a=i.iter(e);!a.done;a.next()){var l=a.value;r.appendChild(l,!0)}r.bounds=G.TheoRect.fromSize(o.size),r.move(F.Matrix2D.translation(r.finalFrame.evalXY(.5,.5).multiply(-1)).translate(o.center));for(var s=i.iter(e);!s.done;s.next())l=s.value,n.appendChild(l,!0);r.removeFromParent()}},apply:function(){this.applyWithPromise()},applyWithPromise:function(e){void 0===e&&(e=!1);var t=this,o=l.CorePromise.resolve(null),n=this.forma_;(h=new g.FormaAnimationTransactionEvent(n)).duration=0,n.beginUpdate(h),I.RetargetSuggester.cleanupRoot(n),this.layoutUpdate_&&I.RetargetSuggester.removeDesignVariationFormae(n);for(var r=this.modelDoc_.beginTransaction("adjust_template"),s=i.clone(n.filterWithCallback((function(e){return e.isTypeLockup()&&e.frame.area>1}))),u=i.iter(s);!u.done;u.next()){var c=u.value;i.opt(i.as(c.controller,E.TypeLockupController),(function(e){return e.updateGroup()}))}n.page.colorLibraryController.restoreUndoState(i.as(this.modelForma_.page.colorLibrary.state.allProperties,"AnyObject"));for(var h,d=!this.disableFallback_&&this.layoutUpdate_?new b.RelayoutEvaluationScore(n):null,p=!this.disableFallback_&&this.layoutUpdate_?n.page.database.beginTransaction("try_resize",null):null,f=!0,m=!1,y=i.iter(i.range(0,2,!1));!y.done;y.next()){for(var S,C,T=y.value,A=i.clone(this.getGroupCorrespondences()),F=i.iter(A);!F.done;F.next()){var k=F.value;if(0!=k.a.length)if(0!=k.b.length){var L=k.a.filter((function(e){return null!=e.controller&&e.isTypeLockup()}),this).length>0;!this.layoutUpdate_||m&&L?this.matchGroupStyle(k.a,k.b):1==k.a.length?this.matchFormaToGroup(k.a[0],k.b):(this.matchGroupStyle(k.a,k.b),f=f&&this.matchGroupLayout(k.a,k.b))}else this.layoutUpdate_&&a.CreationFacade.deleteFormae(k.a,(function(){}));else if(this.layoutUpdate_){function _(e){return o.then((function(o){return t.transferForma(n,e,t.modelDoc_.uuid)}))}o=_(k.b)}}if(!((S=d)&&(C=p)&&(S.evaluateDocument(),S.reject()&&0==T))){i.opt(p,(function(e){return e.end()}));break}C.rollback(),m=!0,o=l.CorePromise.resolve(null),p=null}r.rollback(),n.page.themeID=this.modelDoc_.uuid,this.cleanupForma(n),n.page.colorLibraryController.enteredPalettePicker(),e&&n.page.colorLibraryController.shuffleColorAssignments(),n.endUpdate(h),v.Host.platform.isAndroid&&m&&((h=new g.FormaHierarchyChangedEvent(n)).duration=.1,n.beginUpdate(h),n.endUpdate(h));for(var R=i.iter(s);!R.done;R.next())c=R.value,i.opt(i.as(c.controller,E.TypeLockupController),(function(e){return e.updateGroup()}));return o},matchZOrder:function(e,t){var o,n,r,a;if(0!=e.length&&0!=t.length)for(var l=this.modelDoc_.uuid,s=i.clone(e[0].root.filterWithCallback((function(e){return!(!(o=i.opt(e.controller,(function(e){return e.floating})))&&null==o)&&o}))),c=i.clone(t[0].root.filterWithCallback((function(e){return!(!(n=i.opt(e.controller,(function(e){return e.floating})))&&null==n)&&n}))),h=i.clone(this.getGroupCorrespondences()),d=i.iter(i.toSequence(e));!d.done;d.next()){for(var g=d.value,p=g.offset,f=g.element,m=t[p],y=null,v=null,S=!1,C=i.iter(c);!C.done;C.next()){var A=C.value,F=this.makeSourceDescriptor(l,A.formaID);if(i.eq(u._equality_Forma_Forma,A,m))S=!0;else if(A.parent==m.parent&&A.finalFrame.intersects(m.finalFrame))if(S){for(var k=i.iter(h);!k.done;k.next())if(R=k.value,i.containsEq(R.b,A,u._equality_Forma_Forma)&&(D=(w=i.clone(T.LayerFacade.sortInZOrder(R.a))).length>0?w[0]:i.first(s.filter((function(e){return e.source==F}),this)),I=D))if(null==v)v=I;else{var L=(r=i.opt(I.parent,(function(e){return e.indexOfChild(I)})))||null!=r?r:0,b=(a=i.opt(v.parent,(function(e){return e.indexOfChild(v)})))||null!=a?a:0;I.parent==v.parent&&b>L&&(v=I)}}else for(var _=i.iter(h);!_.done;_.next()){var R=_.value;if(i.containsEq(R.b,A,u._equality_Forma_Forma)){var I,w=i.clone(T.LayerFacade.sortInZOrder(R.a)),D=(w=i.reverse(w)).length>0?w[0]:i.first(s.filter((function(e){return e.source==F}),this));(I=D)&&(y=I)}}}var x,P,E,M,N,G=i.opt(f.parent,(function(e){return e.indexOfChild(f)}));(x=y)&&(M=x.parent)&&null!=(P=M.indexOfChild(x))&&null!=(p=G)&&p<P&&(f.removeFromParent(),M.insertChildAt(f,P,!0)),(E=v)&&(M=E.parent)&&null!=(N=M.indexOfChild(E))&&null!=(p=G)&&p>=N&&(f.removeFromParent(),M.insertBefore(f,E))}},transferForma:function(e,t,o){var n=this;if(t.length>0){for(var r=i.iter(t);!r.done;r.next())if(!(s=r.value).hasIntent(u.Forma.INTENT_ICON)&&!S.ImageFacade.isFloatingImage(s))return l.CorePromise.resolve(null);var s,c;return 1==t.length&&null!=(c=(s=t[0]).getTag(I.RetargetSuggester.FORMA_TYPE_TAG))&&c==I.RetargetSuggester.FORMA_TYPE_CONTENT_IMAGE?S.ImageFacade.addPlaceholderImage(e.page).then((function(e){var r,a;return(r=i.as(e,h.FrameForma))&&(a=S.ImageFacade.getImageFormaForForma(r))?(r.match(s),a.moveCenterToPoint(r.bounds.center),n.recordSources(o,t,[r]),n.matchZOrder([r],t),l.CorePromise.resolve(r)):l.CorePromise.resolve(null)})):a.CreationFacade.copyItems(t,e.page).then((function(e){for(var r=i.clone(e),s=i.iter(i.range(0,r.length,!1));!s.done;s.next()){var u=s.value;r[u].style.match(t[u].style);for(var c=i.iter(i.range(u,r.length,!1));!c.done;c.next()){var h,d,g,p=c.value;t[u].contentID==t[p].contentID&&r[u].contentID!=r[p].contentID&&(h=i.as(r[u],w.ShapeForma))&&(d=i.as(r[p],w.ShapeForma))&&(g=d.contentNode)&&(d.contentID=h.contentID,a.CreationFacade.removeContentNodeFromDocument(g,d.page.document))}}for(var f=i.iter(i.toSequence(r));!f.done;f.next()){var m=f.value,y=m.offset;m.element.style.match(t[y].style)}return n.recordSources(o,t,r),n.matchZOrder(r,t),l.CorePromise.resolve(null)}))}return l.CorePromise.resolve(null)},recordSources:function(e,t,o){for(var n=i.iter(i.toSequence(o));!n.done;n.next()){var r=n.value,a=r.offset;r.element.source=this.makeSourceDescriptor(e,t[a].formaID)}},makeSourceDescriptor:function(e,t){var o;return null!=(o=t)?d.FormaSourceNamespace.DesignVariation+e+":"+o:d.FormaSourceNamespace.DesignVariation+e},matchFormaToGroup:function(e,t){var o,n,r;if(1!=t.length||e.controller.userGroup){if(e.isTypeLockup()){var a=i.sort(t,(function(e,t){return((n=e.controller.currentHeightScale)||null!=n?n:0)>((r=t.controller.currentHeightScale)||null!=r?r:0)})).filter((function(t){return t.controller.kind==e.controller.kind}),this);if(a.length>0)return void e.match(a[0])}this.matchGroupStyle([e],t),this.matchGroupLayout([e],t)}else{var l,s,u,h,d,g,f,m,y=P.TransformFacade.isFormaFlipped(e,!0),v=P.TransformFacade.isFormaFlipped(e,!1),C=null;if((l=S.ImageFacade.getFrameFormaForForma(t[0]))&&(s=S.ImageFacade.getImageFormaForForma(e))&&(u=S.ImageFacade.getFrameFormaForForma(e))&&(f=i.as(u.controller,c.FrameController))){var T=l.rotationInRadians();if(Math.abs(T)>=Math.PI/2){var A=i.toInt(T/(Math.PI/2));C=-i.toDouble(A)*(Math.PI/2)}var F=u.rotationInRadians(),k=s.rotationInRadians();Math.abs(F)>=Math.PI/2&&Math.abs(k)>=Math.PI/2&&(C=((o=C)||null!=o?o:0)+0);var L=s.placement.extractedScale.scale;f.setBoundsWithCropType(l.bounds,c.CropType.PreserveFocus),s.placement.extractedScale.scale.x>2*L.x&&f.setBoundsWithCropType(l.bounds,c.CropType.FitBorder)}(h=i.as(e.controller,p.GridController))&&h.beginBlockedUpdate(),e.match(t[0]),(h=i.as(e.controller,p.GridController))&&h.endBlockedUpdate(),e.controller.moveable&&this.matchZOrder([e],t),(d=S.ImageFacade.getImageFormaForForma(e))&&(g=S.ImageFacade.getFrameFormaForForma(e))&&(f=i.as(g.controller,c.FrameController))&&(null!=(m=C)&&i.opt(d.controller,(function(e){return e.rotate(-d.rotationInRadians()+m)})),P.TransformFacade.isFormaFlipped(e,!1)!=v&&P.TransformFacade.flipForma(e,!1),P.TransformFacade.isFormaFlipped(e,!0)!=y&&P.TransformFacade.flipForma(e,!0))}},cleanupForma:function(e){for(var t,o=i.iter(e.filterByControllerKind(p.GridController.KIND));!o.done;o.next()){var n,r=o.value;if(n=i.as(r.controller,p.GridController)){n.updateGridAssignments();for(var a=i.iter(n.gridStyle.gridCells);!a.done;a.next()){var l,c=a.value;if(null!=(l=c.colorID)&&null==e.page.colorLibrary.color(l)){var h=i.clone(e.page.colorLibraryController.unusedColorKeys(null,!0));h.length>0&&n.gridStyle.updateCell(c,null,h[0],null)}}n.updateGroup();for(var g=i.clone(r.filterWithCallback((function(e){return null!=e.controller&&e.controller.floating&&!d.FormaSourceUtils.isDesignVariation(e.source)}),u.FormaTraversal.JustChildren)),f=!1,m=i.iter(this.correspondence_);!m.done;m.next()){var y=m.value;f=f||y.b.filter((function(e){return e.isTypeLockup()}),this).length>0,g=g.filter((function(e){return!i.containsEq(y.a,e,u._equality_Forma_Forma)}),this)}var v=i.clone(r.filterWithCallback((function(e){return d.FormaSourceUtils.isDesignVariation(e.source)}),u.FormaTraversal.JustChildren));if(!f&&v.length>0&&g.length>0){v=i.clone(T.LayerFacade.sortInZOrder(v)),g=i.clone(T.LayerFacade.sortInZOrder(g)),g=i.reverse(g);for(var S=v[v.length-1],C=i.iter(g);!C.done;C.next()){var F=C.value;null!=(ye=n.gridForma.indexOfChild(S))&&n.gridForma.insertChildAt(F,ye)}}}}for(var k=i.clone(e.page.colorLibraryController.getThemeColorKeys()),L=i.iter(e.visitAsArray(u.FormaTraversal.PreOrder));!L.done;L.next())for(var b=L.value,_=[s.ColorRole.FieldPrimary,s.ColorRole.FieldSecondary,s.ColorRole.Border],R=i.iter(_);!R.done;R.next()){var I=R.value;if(null==b.style.colors.color(I))for(var w=i.iter(i.range(0,_.length,!1));!w.done;w.next()){var P,M=w.value;if(null!=(P=b.style.colors.colorID(I))){var N,G=i.replaceAll(P,"themeColor","");if(null!=(N=i.toInt(G))){for(var B=k[(N+M)%k.length],O=!1,U=i.iter(_);!U.done;U.next()){var H,z=U.value;I!=z&&null!=(H=b.style.colors.colorID(z))&&H==B&&(O=!0)}if(!O){b.style.colors.setColorId(I,B);break}}}}}var Y=i.clone(e.filterWithCallback((function(e){return(!(t=i.opt(e.source,(function(e){return e.includes(d.FormaSourceNamespace.DesignVariation)})))&&null==t||!t)&&e.hasIntent(u.Forma.INTENT_ICON)})));if(Y.length<2*x.TheoDocumentUtils.DESIGN_COMPLEXITY_HEURISTIC_THRESHOLD)for(var W=i.iter(Y);!W.done;W.next()){var V,K,X=W.value;if((V=X.style.colors.fieldPrimary)&&(K=i.opt(X.controller,(function(e){return e.getBackgroundColor()})))){for(var j=[],q=i.iter(Y);!q.done;q.next()){var Z,J=q.value;i.eq(u._equality_Forma_Forma,X,J)||(Z=J.style.colors.fieldPrimary)&&V.distanceTo(Z)<1&&j.push(J)}var Q=j.length>0;if((Q&&V.distanceTo(K)<10||!Q&&!V.contrasts(K,!1))&&(i.opt(X.controller,(function(e){return e.shuffleColorAssignment()})),Q))for(var $=i.iter(j);!$.done;$.next())$.value.style.colors.setColor(s.ColorRole.FieldPrimary,X.style.colors.fieldPrimary)}}var ee=i.clone(e.filterWithCallback((function(e){return e.isTypeLockup()&&e.frame.area>1})));i.sortInPlace(ee,(function(e,t){var o,n,r,a;if((o=i.as(e.controller,E.TypeLockupController))&&(n=i.as(e.controller,E.TypeLockupController))&&(r=i.opt(o.lockupForma,(function(e){return e.childrenFinalFrame})))&&(a=i.opt(n.lockupForma,(function(e){return e.childrenFinalFrame})))){var l=o.lockupStyle.backing==A.LockupBacking.Knockout&&A.LockupStyle.isKnockoutLook(o.lockupStyle.textLook),s=n.lockupStyle.backing==A.LockupBacking.Knockout&&A.LockupStyle.isKnockoutLook(n.lockupStyle.textLook);return r.area+(l?1e5:0)>a.area+(s?1e5:0)}return!1}));for(var te=i.iter(ee);!te.done;te.next()){var oe,ne=te.value;if(oe=i.as(ne.controller,E.TypeLockupController)){var re,ie;oe.snapSizeToBounds(),null!=(re=i.opt(oe.lockupStyle,(function(e){return e.backingShapeID})))&&(ie=D.ShapeLibraryDataStructures.init_d41d().DisplayOrderForShapesByCategory[D.ShapeLibrary.CategorySocial])&&ie.includes(re)&&oe.styleController.applyBacking(A.LockupBacking.None,null),A.LockupStyle.isShadowLook(oe.lockupStyle.textLook)||oe.lockupStyle.textBacked||oe.contrastCheck(!1);var ae=ne.parent,le=oe.lockupStyle.backing==A.LockupBacking.Knockout&&A.LockupStyle.isKnockoutLook(oe.lockupStyle.textLook);if(null!=ae&&le){for(var se=ne.parent.indexOfChild(ne),ue=se,ce=i.iter(ee);!ce.done;ce.next()){var he=ce.value;i.eq(u._equality_Forma_Forma,ne,he)||ne.parent!=he.parent||(ue=Math.min(ue,he.parent.indexOfChild(he)))}ue<se&&ae.insertChildAt(ne,ue)}}for(var de=i.iter(ee);!de.done;de.next()){var ge,pe,fe,me,ye;he=de.value,i.eq(u._equality_Forma_Forma,ne,he)||(ge=i.as(he.controller,E.TypeLockupController))&&(pe=i.opt(ge.lockupForma,(function(e){return e.childrenFinalFrame})))&&(fe=ne.finalFrame)&&(me=ge.lockupStyle)&&null!=(ye=i.opt(he.parent,(function(e){return e.indexOfChild(he)})))&&"banner"==me.backingShapeID&&pe.contains(fe)&&ne.parent==he.parent&&ne.parent.insertChildAt(ne,ye,!0)}}},dummy:function(e){}}}),n)},LwcA:function(e,t,o){var n,r=t,i=o("oAGj"),a=o("gXiO"),l=o("wc1n"),s=o("WlyK"),u=o("jV/A"),c=o("sIWg"),h=o("1NAc");r.RetargetCompatibilitySuggester=(n=function(){a.CoreObject.call(this)},i.defineClass({name:"RetargetCompatibilitySuggester",ctor:n,superName:"CoreObject",statics:{sortDocuments:function(e,t){for(var o=n.createRetargetDocumentData(e),r=i.clone(n.scoreDocuments(o,e.frame,t)),a=[],l=i.iter(r);!l.done;l.next()){var s=l.value;a.push(s.data)}return a},scoreDocuments:function(e,t,o){for(var n=i.clone(e.lockupStrings),r=[],a=i.iter(o);!a.done;a.next()){var l=a.value,u=i.clone(l.lockupStrings),c=u.length,h=!1;if(n.length==c)for(var d=i.iter(i.range(0,c,!1));!d.done;d.next()){var g=d.value;if(u[g]!=n[g])break;g+1==c&&(h=!0)}if(!h){var p=new s.RetargetCompatibilityScore(t,e,l);r.push({data:l,score:p})}}return i.sort(r,(function(e,t){return e.score.score>t.score.score}))},createRetargetDocumentData:function(e,t){void 0===t&&(t=!1);var o,n=l.FeatureExtractorFactory.getFeatureExtractor(t?l.FeatureExtractorType.RetargetTemplate:l.FeatureExtractorType.Retarget,e),r=i.clone(n.allFeatures_),a=i.as(r.Focus,"AnyObject"),s=a.length,d={};return(o=i.as(r.VisualGroupInfo,["Dictionary","String","AnyObject"]))&&(d=i.clone(o)),new u.RetargetDocumentExemplar("","","","","",h.TheoSize.decodeJson(i.as(r.Size,"AnyObject"))||h.TheoSize.Zero,2,2,"","",r.LockupStrings,null!=a&&s>0?c.TheoRect.decodeJson(a):null,r.NumImages,i.as(r.Edges,["Array","Double"]),r.LayoutId,r.NumGridsCells,r.NumMoveable,r.NumShapes,i.as(r.NumRetargetableBackgroundImages,"Double"),i.as(r.NumRetargetableFloatingImages,"Double"),d,r.TextRoles,r.ShapeRoles,r.SalientCoverage,r.GifsCount,null)}}}),n)},MZST:function(e,t,o){var n,r,i=t,a=o("oAGj"),l=o("FNB+"),s=o("c+uM"),u=o("8t9B"),c=o("9BFu");i.RetargetScore=(n=function e(t,o,n){this.rejectThreshold=-1e3,this.root_=t,this.model_=o,this.correspondence_=a.clone(n),c.WeightedScore.call(this,e.Features.NUM_FEAT),this.setWeight(e.Features.MIN_TEXT_SIZE,0),this.setWeight(e.Features.LENGTH_TEXT_DIFF,-30),this.setWeight(e.Features.WEIGHT_DIFF,0),this.setWeight(e.Features.RELATIVE_WEIGHT,-20),this.setWeight(e.Features.RELATIVE_LOCATION,-10),this.setWeight(e.Features.GROUP_SIZE_DIFF,-100),this.setWeight(e.Features.GROUP_COUNT_DIFF,-40),this.setWeight(e.Features.MISSING_TEXT,-5e3),this.setWeight(e.Features.TYPE_MISMATCH,-80),this.setWeight(e.Features.STYLE_MISMATCH,-80),this.setFeatureName(e.Features.MIN_TEXT_SIZE,"Min Text Size"),this.setFeatureName(e.Features.LENGTH_TEXT_DIFF,"Text Length Difference"),this.setFeatureName(e.Features.WEIGHT_DIFF,"Weight Difference"),this.setFeatureName(e.Features.RELATIVE_WEIGHT,"Relative Weight"),this.setFeatureName(e.Features.RELATIVE_LOCATION,"Relative Location"),this.setFeatureName(e.Features.GROUP_SIZE_DIFF,"Group Size Diff"),this.setFeatureName(e.Features.GROUP_COUNT_DIFF,"Group Count Diff"),this.setFeatureName(e.Features.MISSING_TEXT,"Missing Text"),this.setFeatureName(e.Features.TYPE_MISMATCH,"Type Mismatch"),this.setFeatureName(e.Features.STYLE_MISMATCH,"Style Mismatch"),this.setFeature(e.Features.MIN_TEXT_SIZE,0),this.setFeature(e.Features.LENGTH_TEXT_DIFF,0),this.setFeature(e.Features.WEIGHT_DIFF,0),this.setFeature(e.Features.RELATIVE_WEIGHT,0),this.setFeature(e.Features.RELATIVE_LOCATION,0),this.setFeature(e.Features.GROUP_SIZE_DIFF,0),this.setFeature(e.Features.GROUP_COUNT_DIFF,0),this.setFeature(e.Features.MISSING_TEXT,0),this.setFeature(e.Features.TYPE_MISMATCH,0),this.setFeature(e.Features.STYLE_MISMATCH,0),this.evaluateLayout()},r={},a.defineClass({name:"RetargetScore",ctor:n,superName:"WeightedScore",statics:{Features:{get:function(){return void 0===r.Features&&(r.Features=a.defineEnum("Features",{MIN_TEXT_SIZE:0,WEIGHT_DIFF:1,LENGTH_TEXT_DIFF:2,RELATIVE_WEIGHT:3,RELATIVE_LOCATION:4,MISSING_TEXT:5,GROUP_SIZE_DIFF:6,GROUP_COUNT_DIFF:7,TYPE_MISMATCH:8,STYLE_MISMATCH:9,ROLES_MISMATCH:10,NUM_FEAT:11})),r.Features}}},props:{evaluateLayout:function(){var e,t,o=this;this.setFeature(n.Features.MIN_TEXT_SIZE,0);for(var r=[],i={},c={},h=0,d=0,g=a.iter(this.correspondence_);!g.done;g.next()){var p=g.value;d+=a.toDouble(Math.abs(p.a.length-p.b.length));for(var f=0,m=0,y=a.iter(p.a);!y.done;y.next())f+=(S=y.value).frame.area/S.root.frame.area;for(var v=a.iter(p.b);!v.done;v.next()){var S;m+=(S=v.value).frame.area/S.root.frame.area}var C=f-m;h+=a.toDouble(C*C);for(var T=a.iter(a.range(0,Math.min(p.a.length,p.b.length),!1));!T.done;T.next()){var A=T.value,F=p.a[A],k=p.b[A];r.push({forma:F,placed:k}),i[F.formaID]={forma:F,length:0,size:(e=F.controller.currentHeightScale)||null!=e?e:F.finalFrame.height,center:F.frame.center},c[k.formaID]={forma:k,length:0,size:(t=k.controller.currentHeightScale)||null!=t?t:k.finalFrame.height,center:k.frame.center}}}this.setFeature(n.Features.GROUP_SIZE_DIFF,h),this.setFeature(n.Features.GROUP_COUNT_DIFF,d/a.toDouble(this.correspondence_.length));for(var L=0,b=0,_=0,R=0,I=0,w=this.root_.frame.area,D=a.iter(r);!D.done;D.next()){var x,P,E,M,N=D.value;if((N.forma.isTypeLockup()&&N.placed.isGraphic()||N.forma.isGraphic()&&N.placed.isTypeLockup())&&(R+=1,(x=a.as(N.placed.controller,u.TypeLockupController))&&(x.lockupStyle.backing==s.LockupBacking.None&&x.lockupStyle.textLook==s.LockupTextLook.Fill||null!=(P=x.averageLineHeight)&&(I+=P/100))),null!=(E=i[N.forma.formaID])&&null!=(M=c[N.placed.formaID])){L+=Math.abs(E.size-M.size)/w;for(var G=a.iter(r);!G.done;G.next()){var B,O,U=G.value;a.eq(l._equality_Forma_Forma,N.forma,U.forma)||a.eq(l._equality_Forma_Forma,N.placed,U.placed)||null!=(B=i[U.forma.formaID])&&null!=(O=c[U.placed.formaID])&&((E.size-B.size>5&&M.size-O.size<-5||E.size-B.size<-5&&M.size-O.size>5)&&a.opt(E.forma.controller,(function(e){return e.kind==a.opt(B.forma.controller,(function(e){return e.kind}))}))&&a.opt(M.forma.controller,(function(e){return e.kind==a.opt(O.forma.controller,(function(e){return e.kind}))}))&&(b+=1),(E.center.x-B.center.x>20&&M.center.x-O.center.x<-20||E.center.x-B.center.x<-20&&M.center.x-O.center.x>20)&&(_+=.5),(E.center.y-B.center.y>20&&M.center.y-O.center.y<-20||E.center.y-B.center.y<-20&&M.center.y-O.center.y>20)&&(_+=1))}}}for(var H=a.iter(this.correspondence_);!H.done;H.next()){p=H.value;for(var z=a.clone(p.a),Y=a.iter(a.range(0,z.length,!1));!Y.done;Y.next()){A=Y.value;for(var W=a.iter(a.range(0,z.length,!1));!W.done;W.next()){var V=W.value;A>V&&z[A].frame.center.y>z[V].frame.center.y&&(_+=1)}}}this.setFeature(n.Features.WEIGHT_DIFF,L/a.toDouble(r.length)),this.setFeature(n.Features.RELATIVE_WEIGHT,b/a.toDouble(r.length)),this.setFeature(n.Features.RELATIVE_LOCATION,.5*_/a.toDouble(r.length)),this.setFeature(n.Features.TYPE_MISMATCH,R/a.toDouble(r.length)),this.setFeature(n.Features.STYLE_MISMATCH,I/a.toDouble(r.length)),this.setFeature(n.Features.ROLES_MISMATCH,0/a.toDouble(r.length));var K=0;this.model_.visit(l.FormaTraversal.PreOrder,(function(e,t,n){var r;if(r=a.as(e.controller,u.TypeLockupController)){for(var i=!1,s=a.iter(o.correspondence_);!s.done;s.next())for(var c=s.value,h=a.iter(c.b);!h.done;h.next()){var d=h.value;a.eq(l._equality_Forma_Forma,e,d)&&(i=!0)}if(!i){var g=a.toDouble(r.text.length);K+=e.frame.area/g}}return!1})),this.setFeature(n.Features.MISSING_TEXT,K/this.root_.frame.area)},reject:function(){return this.score<this.rejectThreshold}}}),n)},"McK+":function(e,t,o){var n,r,i=t,a=o("oAGj"),l=o("Dz6V"),s=o("qKrA"),u=o("EGPT"),c=o("bccX"),h=o("mD2h"),d=o("gXiO"),g=o("QLmq"),p=o("d820"),f=o("fNpk"),m=o("Cl7N"),y=o("36r7");i.EditorModelState=(n=function(e,t,o,n,r,i,a,d,f){this.mutable_=!1,void 0===e&&(e=new c.AttributesState),void 0===t&&(t=new g.FeatureSetsState),void 0===o&&(o=new p.HandlesState),void 0===n&&(n=new h.ActiveSwapState),void 0===r&&(r=new m.SnapLinesState),void 0===i&&(i=new l.ActionFeedbackState),void 0===a&&(a=new u.AnnotationState),void 0===d&&(d=new y.ViewState),void 0===f&&(f=new s.ActivePageState),this.attributes=e,this.featureSets=t,this.handles=o,this.activeSwap=n,this.snapLines=r,this.actionFeedback=i,this.annotations=a,this.view=d,this.activePage=f},a.defineClass({name:"EditorModelState",ctor:n,statics:{_implements:function(e){return"IMutableEditorModel"==e}},props:{clone:function(){return new n(this.attributes.clone(),this.featureSets.clone(),this.handles.clone(),this.activeSwap.clone(),this.snapLines.clone(),this.actionFeedback.clone(),this.annotations.clone(),this.view.clone(),this.activePage.clone())},calculateChanges:function(e){var t=[];return a.append(t,this.attributes.diff(e.attributes)),a.append(t,this.featureSets.diff(e.featureSets)),a.append(t,this.handles.diff(e.handles)),a.append(t,this.activeSwap.diff(e.activeSwap)),a.append(t,this.snapLines.diff(e.snapLines)),a.append(t,this.actionFeedback.diff(e.actionFeedback)),a.append(t,this.annotations.diff(e.annotations)),a.append(t,this.view.diff(e.view)),a.append(t,this.activePage.diff(e.activePage)),t},mutable:{get:function(){return this.mutable_},set:function(e){e!=this.mutable_&&(this.mutable_=e,this.attributes.mutable=e,this.featureSets.mutable=e,this.handles.mutable=e,this.activeSwap.mutable=e,this.snapLines.mutable=e,this.actionFeedback.mutable=e,this.annotations.mutable=e,this.view.mutable=e,this.activePage.mutable=e)}}}}),n),i.EditorStateMember=(r=function(){this.mutable=!1,d.CoreObject.call(this)},a.defineClass({name:"EditorStateMember",ctor:r,superName:"CoreObject",props:{beforeChange:function(){f.LegacyCoreAssert.isTrue(this.mutable,"editor state is read-only",void 0,"EditorStateMember.beforeChange","EditorModelState.swift",117)},afterChange:function(){}}}),r)},Mr7n:function(e,t,o){var n,r=t,i=o("oAGj"),a=o("Pil/"),l=o("1HsO"),s=o("oKlP");r.StandardHandleProcessor=(n=function(e){this.model=e},i.defineClass({name:"StandardHandleProcessor",ctor:n,statics:{_implements:function(e){return"IHandleProcessor"==e}},props:{updateHandles:function(e){this.model.beginUpdates(),e.updateHandles(this.model.mutable.handles),this.model.updatesComplete()},handleTransformEvent:function(e,t){var o,n,r,a,s;if(o=i.as(t.handle,l.BoxTransformHandles))if(n=i.as(t,l.MoveTransformEvent))switch(n.stage){case 0:e.activeTransform=l.TransformType.Translate,i.opt(e.delegate,(function(e){return e.move.beginMove(o.reference)})),this.updateHandles(e);break;case 1:i.opt(e.delegate,(function(e){return e.move.updateMove(o.reference,n.totalDelta,n.viewportScale)}));break;case 2:e.activeTransform=l.TransformType.None,i.opt(e.delegate,(function(e){return e.move.endMove(o.reference)})),this.updateHandles(e)}else if(r=i.as(t,l.RotateAboutCenterTransformEvent))switch(r.stage){case 0:e.activeTransform=l.TransformType.RotateAboutCenter,i.opt(e.delegate,(function(e){return e.rotate.beginRotate(o.reference)})),this.updateHandles(e);break;case 1:i.opt(e.delegate,(function(e){return e.rotate.updateRotate(o.reference,r.totalDeltaRadians,r.doSnapping)}));break;case 2:e.activeTransform=l.TransformType.None,i.opt(e.delegate,(function(e){return e.rotate.endRotate(o.reference)})),this.updateHandles(e)}else if(a=i.as(t,l.CornerTranslateTransformEvent)){var u=this.canonicalPointForTransformType(a.transformType);switch(a.stage){case 0:e.activeTransform=a.transformType,i.opt(e.delegate,(function(e){return e.resize.handleBeginSelectionBoxResize(o.reference,u)})),this.updateHandles(e);break;case 1:i.opt(e.delegate,(function(e){return e.resize.handleSelectionBoxResize(o.reference,u,a.position,a.viewportScale)}));break;case 2:e.activeTransform=l.TransformType.None,i.opt(e.delegate,(function(e){return e.resize.handleEndSelectionBoxResize(o.reference,u)})),this.updateHandles(e)}}else if(s=i.as(t,l.SideTranslateTransformEvent))switch(u=this.canonicalPointForTransformType(s.transformType),s.stage){case 0:e.activeTransform=s.transformType,i.opt(e.delegate,(function(e){return e.resize.handleBeginSelectionBoxResize(o.reference,u)})),this.updateHandles(e);break;case 1:i.opt(e.delegate,(function(e){return e.resize.handleSelectionBoxResize(o.reference,u,s.position,s.viewportScale)}));break;case 2:e.activeTransform=l.TransformType.None,i.opt(e.delegate,(function(e){return e.resize.handleEndSelectionBoxResize(o.reference,u)})),this.updateHandles(e)}return!0},handleFormaDragEvents:function(e,t){return t instanceof a.BeginFormaDragEvent&&(e.activeTransform=l.TransformType.Translate,this.updateHandles(e)),i.opt(e.delegate,(function(e){return e.drag.handleFormaDragEvents(t)})),t instanceof a.EndFormaDragEvent&&(e.activeTransform=l.TransformType.None,this.updateHandles(e)),!0},canonicalPointForTransformType:function(e){switch(e){case 4:return new s.TheoPoint(0,0);case 5:return new s.TheoPoint(1,0);case 6:return new s.TheoPoint(0,1);case 7:return new s.TheoPoint(1,1);case 10:return new s.TheoPoint(.5,0);case 11:return new s.TheoPoint(.5,1);case 8:return new s.TheoPoint(0,.5);case 9:case 12:return new s.TheoPoint(1,.5);case 13:return new s.TheoPoint(.5,1);default:return s.TheoPoint.ZERO}}}}),n)},NbJN:function(e,t,o){var n,r=t,i=o("oAGj"),a=o("yvDn"),l=o("yGNn"),s=o("ascj"),u=o("O60Y"),c=o("FNB+"),h=o("cmoc"),d=o("QbzR"),g=o("JEzR"),p=o("P83h"),f=o("X0GW"),m=o("ZhwN"),y=o("iCxV"),v=o("U010"),S=o("fdtz"),C=o("SDdr"),T=o("lmwz"),A=o("uWOl"),F=o("T8w7"),k=o("8zEY"),L=o("JO5d"),b=o("Zifs"),_=o("djAF"),R=o("35Q0");r.RefineCutoutController=(n=function(){this.state_=null},i.defineClass({name:"RefineCutoutController",ctor:n,props:{enterRefineCutoutMode:function(e){if(null!=this.state_)return new a.CoreStringError("enter/exit mismatch");var t,o,n,r;if((t=i.opt(e.controller,(function(e){return e.owner})))&&(o=e.image)&&(n=e.parent)&&null!=(r=n.indexOfChild(e))){var l=this.cloneMaskContentNode(e);if(null!=l)return l;this.resetTightCrop(e,o);var s=new k.RefineCutoutState(e,o,r);return this.highlightImage(e,o,n,s),null!=(l=this.createUnmaskedGhost(e,s))?l:(this.state_=s,t.selection.inRefineCutoutMode=!0,null)}return new a.CoreStringError("No document controller, or corrupt frame")},exitRefineCutoutMode:function(e,t,o){void 0===o&&(o=!0);var n,r,a=this;if(i.opt(this.state_,(function(t){return t.frame!=e})))return l.CorePromise.reject("enter/exit/frame mismatch");if((n=i.opt(e.controller,(function(e){return e.owner})))&&(r=this.state_)){this.revertTemporaryChanges(e,r);var s,u,c=null;return t&&(s=T.ImageFacade.getCutoutMaskFormaForForma(e))&&(u=s.contentNode)&&(c=(o?u.recreateImageAndFeatures():l.CorePromise.resolve(null)).then((function(t){return s.invalidateCachedBounds(),T.ImageFacade.updateCutoutMaskPlacement(e,s),a.redoTightCrop(e,s),null}))),(c||l.CorePromise.resolve(null)).then((function(e){return a.state_=null,n.selection.inRefineCutoutMode=!1,null}))}return l.CorePromise.reject("No document controller when exit refine cutout")},toggleUnmaskedImage:function(e){if(i.opt(this.state_,(function(t){return t.frame!=e})))return new a.CoreStringError("enter/exit/frame mismatch");var t;if(t=this.state_){var o,n;if(o=t.unmaskedGhost){var r=0==F.OpacityFacade.getOpacityForForma(o)?1:0;F.OpacityFacade.applyOpacity(r,[o])}if(n=t.frameBackgroundColor){var l=null==e.style.colors.fieldPrimary?n:null;e.style.colors.fieldPrimary=l}}return null},isUnmaskedImageVisible:function(){var e;return!!(e=i.opt(this.state_,(function(e){return e.unmaskedGhost})))&&1==F.OpacityFacade.getOpacityForForma(e)},cloneMaskContentNode:function(e){var t,o,n;if((t=e.page.document)&&(o=T.ImageFacade.getCutoutMaskFormaForForma(e))&&(n=o.contentNode)){if(i.opt(y.Host.imageAnalysis,(function(e){return 1==e.isTempMaskURL(n.url)})))return o.ensureContentNodeListeners(),null;var r;if(r=n.copyTo(t))return o.contentID=r.id,null}return new a.CoreStringError("could not clone mask content node",!0)},supportsAutoTrimming:function(e){return T.ImageFacade.canSetTightCropToCutoutMask(e,!1)},resetTightCrop:function(e,t){this.supportsAutoTrimming(e)&&T.ImageFacade.resetCrop(t,!1)},redoTightCrop:function(e,t){this.supportsAutoTrimming(e)&&T.ImageFacade.setTightCropToCutoutMask(e,t)},highlightImage:function(e,t,o,n){var r,a=new p.FormaAnimationTransactionEvent(e);a.duration=0,e.beginUpdate(a),t.internalSetStyle(A.ImageStyle.createDefault()),e.style.blendMode=d.FormaBlendMode.Normal,n.floating||(e.allowUserMove=!0),o.removeChild(e),o.appendChild(e),(r=i.as(e.page.createFormaWithController(_.ShapeForma.KIND,L.ShapeController.KIND),_.ShapeForma))&&(R.ShapeLibrary.applyToShapeForma(r,R.ShapeLibrary.Square),r.bounds=i.opt(e.root,(function(e){return e.bounds})),r.style.opacity=.5,r.style.colors.fieldPrimary=b.SolidColor.BLACK,r.intent=c.Forma.INTENT_TEMP_IMAGE_REFINE_CUTOUT,r.allowUserMove=!1,o.insertBefore(r,e,!0),n.darkScrim=r),e.endUpdate(a)},createUnmaskedGhost:function(e,t){var o,n,r,l,u;if((o=e.parent)&&(n=o.parent)&&(r=T.ImageFacade.getImageFormaForForma(e))&&(l=i.as(this.forkForCutoutVisualization(e,n),h.FrameForma))&&(u=i.as(this.forkForCutoutVisualization(r,l),S.ImageForma))){var d;i.opt(i.as(l.style,g.FrameStyle),(function(e){return e.cutoutMode=v.CutoutMode.Off})),(d=T.ImageFacade.getMaskForForma(e))&&T.ImageFacade.applyMaskToForma(l,d,null,!0),l.intent=c.Forma.INTENT_TEMP_IMAGE_REFINE_CUTOUT,l.isModel=!1;var f=new b.SolidColor(1,0,0,1),m=A.ImageStyle.init_1265("RedOverlay",s.ColorTable.init_2768(f,f),C.CompositeFilter.init_514f(void 0,"Duotone",.3,"normal",void 0,void 0,"duotone"));u.internalSetStyle(m),u.setParent(l),l.setParent(null),l.appendChild(u,!0),o.insertBefore(l,e),l.placement=e.placement,F.OpacityFacade.applyOpacity(0,[l]);var y=[];y.push(u);var k=new p.FormaInsertedChildrenEvent(l,y,0);return l.beginUpdate(k),l.endUpdate(k),t.unmaskedGhost=l,null}return new a.CoreStringError("could not create unmasked ghost")},revertTemporaryChanges:function(e,t){var o,n,r,a=new p.FormaAnimationTransactionEvent(e);a.duration=0,e.beginUpdate(a),i.opt(t.darkScrim,(function(e){return e.removeFromParent()})),i.opt(t.darkScrim,(function(e){return e.destroy()})),i.opt(t.unmaskedGhost,(function(e){return e.removeFromParent()})),i.opt(t.unmaskedGhost,(function(e){return e.destroy()})),(o=t.imageStyle)&&t.image.internalSetStyle(o),(n=t.frameBackgroundColor)&&(e.style.colors.fieldPrimary=n),e.style.blendMode=t.frameBlendMode,(r=e.parent)&&(r.removeChild(e),r.insertChildAt(e,t.indexInParent)),t.floating||(e.allowUserMove=!1),i.opt(e.controller,(function(e){return 1==e.userGroupChild}))&&f.GroupFacade.updateUserGroupHierarchy(e.parent),e.endUpdate(a)},forkForCutoutVisualization:function(e,t){void 0===t&&(t=null);var o,n=m.GUIDUtils.makeGUID(),r=e.database,i=null;return(o=t)&&(i=u.DBLink.init_8408(n,r,o.id)),e.forkToDatabase(n,!1,r,i)}}}),n)},"Nk+Q":function(e,t,o){var n,r,i,a=t,l=o("oAGj");a.IActionFeedbackHandler=l.defineProtocol("IActionFeedbackHandler",{reportActionFeedback:"(ActionFeedback) -> Void"}),a.NullActionFeedbackHandler=(n=function(){},r={},l.defineClass({name:"NullActionFeedbackHandler",ctor:n,statics:{instance:{get:function(){return void 0===r.instance&&(r.instance=new n),r.instance}},_implements:function(e){return"IActionFeedbackHandler"==e}},props:{reportActionFeedback:function(e){}}}),n),a.StandardActionFeedbackHandler=(i=function(e){this.model=e},l.defineClass({name:"StandardActionFeedbackHandler",ctor:i,statics:{_implements:function(e){return"IActionFeedbackHandler"==e}},props:{reportActionFeedback:function(e){l.opt(this.model,(function(e){return e.beginUpdates()})),l.opt(this.model,(function(t){return t.mutable.actionFeedback.setActionFeedback(e)})),l.opt(this.model,(function(e){return e.updatesComplete()}))}}}),i)},NkBu:function(e,t,o){var n,r=t,i=o("oAGj"),a=o("AVHO"),l=o("ascj"),s=o("H9Ol"),u=o("6ZWm"),c=o("yHU1"),h=o("Pil/"),d=o("cmoc"),g=o("fdtz"),p=o("lmwz"),f=o("uWOl"),m=o("37nf"),y=o("fNpk"),v=o("tGKA"),S=o("jcfx"),C=o("fAXt"),T=o("oKlP"),A=o("sIWg");r.ImageController=(n=function(e,t,o){this._annotations=[],s.FormaController.call(this,e,t,o)},i.defineClass({name:"ImageController",ctor:n,superName:"FormaController",statics:{KIND:{get:function(){return"image"}}},props:{rotateable:{get:function(){return!0}},flippable:{get:function(){return!this.forma.isLogo()}},nudgeable:{get:function(){return!0}},floating:{get:function(){var e;return(e=i.as(i.opt(i.opt(this.forma,(function(e){return e.parent})),(function(e){return e.controller})),u.FrameController))?e.floating:s.FormaController._getters.floating.call(this)}},moveable:{get:function(){var e,t;if((e=i.as(this.forma,g.ImageForma))&&(t=e.parent)){var o;if((o=i.opt(i.opt(e.page.document,(function(e){return e.controller})),(function(e){return e.selection})))&&o.isSelected(t)&&o.inCropMode)return!0;if(t.isGridCell())return!0}return!1}},annotations:{get:function(){return this._annotations}},addAnnotation:function(e){this._annotations.splice(0,0,e)},removeAnnotationsOfType:function(e){var t=!1;return this._annotations.splice((function(o){var n=o.id==e;return n&&(t=!0),n}),0),t},match:function(e){},setCrop:function(e,t,o){var n,r;if((n=this.forma)&&(r=n.bounds))if(o!=u.CropType.PreserveFocus&&o!=u.CropType.PreserveFocusAndScale||null==t)if(o==u.CropType.ScaleCrop&&null!=t){S=n.placement.transformValuesRKST;var a=Math.max(e.width/t.width,e.height/t.height);n.placement=n.placement.scaleTo(a*S.xscale,a*S.yscale)}else{var l,s,c,h=e.transform(n.placement.inverse),d=i.opt(t,(function(e){return e.transform(n.placement.inverse)})),p=null;if((l=i.opt(i.opt(i.as(this.forma,g.ImageForma),(function(e){return e.contentNode})),(function(e){return e.focusRegion})))&&(p=m.ImageUtils.suggestCrop(this.forma.bounds.size,l,h,d,o)),null==p&&(s=i.opt(i.as(n,g.ImageForma),(function(e){return e.contentNode})))&&(p=new A.TheoRect(0,0,i.toDouble(s.pixelWidth),i.toDouble(s.pixelHeight))),c=p){n.move(v.Matrix2D.uniformScaling(h.width/c.width));var f=n.placement.transformPoint(c.center);n.move(v.Matrix2D.translation(e.center.subtract(f)))}}else{var S=n.placement.transformValuesRKST,C=v._asterisk_Matrix2D_Matrix2D(v.Matrix2D.rotation(S.rotCosine,S.rotSine),v.Matrix2D.skewing(S.skew).scaleXY(S.xscale>0?1:-1,S.yscale>0?1:-1)),F=v.Matrix2D.scalingXY(Math.abs(S.xscale),Math.abs(S.yscale)),k=F.translateXY(S.tx,S.ty),L=v._asterisk_TheoRect_Matrix2D(r,n.placement).intersectionWith(t);null==L&&(L=t);var b,_,R,I=v._asterisk_TheoRect_Matrix2D(L,k.inverse),w=L.center,D=t.locate(w.x,w.y);if((b=i.opt(i.as(n,g.ImageForma),(function(e){return e.getFocusRegion()})))&&(_=b.intersectionWith(L))&&(D=t.locate(_.center.x,_.center.y)),o==u.CropType.PreserveFocusAndScale){var x=I.eval(D),P=v.Matrix2D.translation(T._negate_TheoPoint(x));P=v._asterisk_Matrix2D_Matrix2D(P,F);var E=e.eval(D);P=P.translate(E),R=v._asterisk_Matrix2D_Matrix2D(C,P)}else{P=v.Matrix2D.calculateResizeTransform(I,e,D,u.FitType.ProportionalFit),R=v._asterisk_Matrix2D_Matrix2D(C,P);var M=e.transform(R.inverse);r.contains(M)||(P=v.Matrix2D.calculateResizeTransform(I,e,D,u.FitType.ProportionalFill),R=v._asterisk_Matrix2D_Matrix2D(C,P))}n.placement=R}else y.LegacyCoreAssert.fail("ERROR. image has no bounds. possibly a corrupted document",void 0,"ImageController.setCrop","ImageController.swift",203)},processFormaClick:function(e){var t;if((t=i.opt(this.forma,(function(e){return e.parent})))&&t.kind==d.FrameForma.KIND)return e.forma=t,void i.opt(t.controller,(function(t){return t.processFormaClick(e)}));s.FormaController.prototype.processFormaClick.call(this,e)},processEvent:function(e){var t;return(t=i.as(e,h.BeginPointerTrackingEvent))?(i.opt(t.selectionState,(function(e){return 1==e.inCropMode}))?t.trackingResponse=c.BeginPointerTrackingResponseEnum.TrackWithinGroup:t.trackingResponse=c.BeginPointerTrackingResponseEnum.TrackAsGroup,!1):s.FormaController.prototype.processEvent.call(this,e)},processEndFormaDrag:function(e){var t;s.FormaController.prototype.processEndFormaDrag.call(this,e),(t=i.as(i.opt(i.opt(this.forma,(function(e){return e.parent})),(function(e){return e.controller})),u.FrameController))&&t.fitChildrenToFrame()},afterProcessEndFormaDrag:function(e){var t;p.ImageFacade.inCropMode(this.forma)||(t=i.as(i.opt(i.opt(this.forma,(function(e){return e.parent})),(function(e){return e.controller})),u.FrameController))&&t.fitChildrenToFrame()},processFormaDoubleClick:function(e){var t;p.ImageFacade.inCropMode(this.forma)||((t=i.opt(this.forma,(function(e){return e.parent})))&&t.kind==d.FrameForma.KIND&&(e.forma=t),this.owner.selection.replaceSelection(e.forma),this.owner.selection.isSelected(e.forma)&&(this.owner.controllerSettingsState.settings=new a.ImageControllerSettings(this)))},fit:function(e){var t,o;(t=this.forma)&&(t.placement=v.Matrix2D.Identity,(o=t.frame)&&(C.TransformFacade.scaleForma(t,o.aspectRatio>=1?e.width/o.width:e.height/o.height),t.moveCenterToPoint(e.center)),this.updateParentGroup())},internalShuffleColorAssignment:function(e){var t;if(t=this.forma){if(t.isLogo())return;var o,n;if((o=i.as(t.style,f.ImageStyle))&&o.isColorizedFilter&&!o.isColorEditable&&(n=t.page.imageFilterLibrary.getNextImageStyleOfSameType(o,!1))){var r,a;if(null!=(r=n.colors.colorID(l.ColorRole.FieldPrimary))){var s=e?(new S.ProfilingColorMap).overridePaletteMappingDueToContrast(r,t.formaID):r;n.colors.setColorIDs([{key:l.ColorRole.FieldPrimary,value:s}])}null!=(a=n.colors.colorID(l.ColorRole.FieldSecondary))&&(s=e?(new S.ProfilingColorMap).overridePaletteMappingDueToContrast(a,t.formaID+S.ProfilingColorMap.backingColorKey):a,n.colors.setColorIDs([{key:l.ColorRole.FieldSecondary,value:s}])),t.applyStyle(n)}}},shuffleColorAssignment:function(){this.internalShuffleColorAssignment(!0)},shuffleColorAssignmentForAnimation:function(){this.internalShuffleColorAssignment(!1)}}}),n)},OYRJ:function(e,t,o){var n,r=t,i=o("oAGj"),a=o("UGKO"),l=o("fNpk"),s=o("K0Rh");r.FormaPlacementSuggestion=(n=function(e,t,o){l.LegacyCoreAssert.isTrue(e.kind!=s.RootForma.KIND,"forma placement suggester does not support the root forma",void 0,"FormaPlacementSuggestion.init","FormaPlacementSuggestion.swift",17),this.forma_=e,this.score_=o,this.location_=t},i.defineClass({name:"FormaPlacementSuggestion",ctor:n,statics:{_implements:function(e){return"IDesignSuggestion"==e}},props:{location:{get:function(){return this.location_}},distanceTo:function(e){var t=e,o=0,n=this.forma_.page.pageSize.hypotenuse;return o+=a.distancePositionWeight*this.location_.center.distanceTo(t.location.center)/n,o+=a.distanceSizeWeight*Math.abs(this.location_.width-t.location.width)/n,o+=a.distanceSizeWeight*Math.abs(this.location_.height-t.location.height)/n},apply:function(){this.forma_.controller.fit(this.location_)},score:{get:function(){return this.score_.score}},weightedScore:{get:function(){return this.score_}},forma:{get:function(){return this.forma_}}}}),n)},Ohrj:function(e,t,o){var n,r,i,a=t,l=o("oAGj"),s=o("yhkb"),u=o("HWAX"),c=o("fNpk"),h=o("jcfx");a.ProfilingColorSelector=(n=function(e,t){var o;this.inertiaRatio=1,this.weights=[],this.weightSum=0,this.currentIndividualIndex=0,this.numIndividualChoices=5,this.isBacking=!1,this.forma=e,this.isBacking=t,(o=l.opt(this.forma,(function(e){return e.controller})))?this.colorsBehindForma=l.clone(o.getBackgroundColors()):this.colorsBehindForma=[],this.values=e.page.colorLibraryController.getThemeColorKeys().concat(e.page.colorLibraryController.getProfilingColorKeys())},l.defineClass({name:"ProfilingColorSelector",ctor:n,props:{updateBackgroundColors:function(e){this.colorsBehindForma=l.clone(e||l.opt(l.opt(this.forma,(function(e){return e.controller})),(function(e){return e.getBackgroundColors()})))},selectColorForGlobalRecolor:function(e,t,o,n){void 0===e&&(e=!0),void 0===t&&(t=null),void 0===o&&(o=!1),void 0===n&&(n=null);var r=s.ColorLibraryController.BW_KEYS[0];if(null!=this.forma){var i=u.ColorSelectorUtils.mapInferredRoleToProfilingRole(this.forma,n),a=l.clone(u.ColorSelectorUtils.getComparisonColors(this.forma,e?this.colorsBehindForma:null,t)),c=l.clone(this.getListOfColorChoicesForRoleGlobal(i));if(c.length>0){var h,d=l.clone(u.ColorSelectorUtils.getSolidColorForChoices(this.forma,i,c));null!=(h=u.ColorSelectorUtils.makeFinalDecisionOnColorChoice(this.forma,a,c,d,o,this.isBacking,!1))&&(r=h)}}return r},selectColorForIndividualRecolor:function(e,t,o,n){void 0===e&&(e=!0),void 0===t&&(t=null),void 0===n&&(n=null);var r=s.ColorLibraryController.THEME_DERIVED_BW_KEYS[0];if(null!=this.forma){var i=u.ColorSelectorUtils.mapInferredRoleToProfilingRole(this.forma,n),a=l.clone(u.ColorSelectorUtils.getComparisonColors(this.forma,e?this.colorsBehindForma:null,t)),c=l.clone(this.getListOfColorChoicesForRoleIndividual(i));if(c.length>0){var h=l.clone(u.ColorSelectorUtils.getSolidColorForChoices(this.forma,i,c)),d=this.currentIndividualIndex%c.length,g=c.concat();g.splice(0,0,c[d]);var p,f=h.concat();f.splice(0,0,h[d]),null!=(p=u.ColorSelectorUtils.makeFinalDecisionOnColorChoice(this.forma,a,g,f,o,this.isBacking))&&(r=p)}}return this.currentIndividualIndex=(this.currentIndividualIndex+1)%this.numIndividualChoices,r},getListOfColorChoicesForRoleGlobal:function(e){return c.LegacyCoreAssert.fail("base color selector not implemented. use primary or background",void 0,"ProfilingColorSelector.getListOfColorChoicesForRoleGlobal","ColorSelector.swift",116),[]},getListOfColorChoicesForRoleIndividual:function(e){return c.LegacyCoreAssert.fail("base color selector not implemented. use primary or background",void 0,"ProfilingColorSelector.getListOfColorChoicesForRoleIndividual","ColorSelector.swift",121),[]}}}),n),a.ProfilingPrimaryColorSelector=(r=function(e,t){a.ProfilingColorSelector.call(this,e,t)},l.defineClass({name:"ProfilingPrimaryColorSelector",ctor:r,superName:"ProfilingColorSelector",props:{getListOfColorChoicesForRoleGlobal:function(e){return(new h.ProfilingColorMap).getPrimaryColorsForRoleGlobal(e,this.forma.formaID,this.forma.page)},getListOfColorChoicesForRoleIndividual:function(e){return(new h.ProfilingColorMap).getPrimaryColorsForRoleIndividual(this.forma.page,e,this.numIndividualChoices)}}}),r),a.ProfilingBackgroundColorSelector=(i=function(e,t){a.ProfilingColorSelector.call(this,e,t)},l.defineClass({name:"ProfilingBackgroundColorSelector",ctor:i,superName:"ProfilingColorSelector",props:{getListOfColorChoicesForRoleGlobal:function(e){return(new h.ProfilingColorMap).getBackgroundColorsForRoleGlobal(e,this.forma.formaID,this.forma.page)},getListOfColorChoicesForRoleIndividual:function(e){return(new h.ProfilingColorMap).getBackgroundColorsForRoleIndividual(this.forma.page,e,this.numIndividualChoices)}}}),i)},PSFa:function(e,t,o){var n,r,i,a=t,l=o("oAGj"),s=o("5+WR"),u=o("ascj"),c=o("AnBp"),h=o("FNB+"),d=o("lmwz"),g=o("37nf"),p=o("T8w7"),f=o("umUn");a.IAttributesHandler=l.defineProtocol("IAttributesHandler",{updateAttributes:"(AttributesState) -> Void"}),a.NullAttributesHandler=(n=function(){},r={},l.defineClass({name:"NullAttributesHandler",ctor:n,statics:{instance:{get:function(){return void 0===r.instance&&(r.instance=new n),r.instance}},_implements:function(e){return"IAttributesHandler"==e}},props:{updateAttributes:function(e){}}}),n),a.IAttributeHandler=l.defineProtocol("IAttributeHandler",{calculate:"(DocumentController) -> Array<IEditorAttribute>"}),a.AttributeHandlerBase=(i=function(){},l.defineClass({name:"AttributeHandlerBase",ctor:i}),i),a.ImageAttributeHandler=function(){var e=function(){a.AttributeHandlerBase.call(this)},t={};return l.defineClass({name:"ImageAttributeHandler",ctor:e,superName:"AttributeHandlerBase",statics:{instance:{get:function(){return void 0===t.instance&&(t.instance=new e),t.instance}},_implements:function(e){return"IAttributeHandler"==e}},props:{calculate:function(e){var t=[];return l.opt(e,(function(e){return e.selection.forEachSelected((function(e){var o=d.ImageFacade.getImageStyleForForma(e);if(null!=o){for(var n=!1,r=l.iter(t);!r.done;r.next()){var i=r.value;if(o.equals(i)){n=!0;break}}n||t.push(o)}}))})),[new c.ImageAttribute(t)]}}}),e}(),a.OpacityAttributeHandler=function(){var e=function(){a.AttributeHandlerBase.call(this)},t={};return l.defineClass({name:"OpacityAttributeHandler",ctor:e,superName:"AttributeHandlerBase",statics:{instance:{get:function(){return void 0===t.instance&&(t.instance=new e),t.instance}},_implements:function(e){return"IAttributeHandler"==e}},props:{calculate:function(e){var t=[];return l.opt(e,(function(e){return e.selection.forEachSelected((function(e){var o=p.OpacityFacade.getOpacityForForma(e);t.includes(o)||t.push(o)}))})),[new c.OpacityAttribute(t)]}}}),e}(),a.ControllerSettingAttributeHandler=function(){var e=function(){a.AttributeHandlerBase.call(this)},t={};return l.defineClass({name:"ControllerSettingAttributeHandler",ctor:e,superName:"AttributeHandlerBase",statics:{instance:{get:function(){return void 0===t.instance&&(t.instance=new e),t.instance}},_implements:function(e){return"IAttributeHandler"==e}},props:{calculate:function(e){var t=[];return l.opt(e,(function(e){return e.selection.forEachSelected((function(e){var o=l.opt(e.controller,(function(e){return e.settings}));null!=o&&t.push(o)}))})),[new c.ControllerSettingAttribute(t)]}}}),e}(),a.MediaMetadataAttributeHandler=function(){var e=function(){a.AttributeHandlerBase.call(this)},t={};return l.defineClass({name:"MediaMetadataAttributeHandler",ctor:e,superName:"AttributeHandlerBase",statics:{instance:{get:function(){return void 0===t.instance&&(t.instance=new e),t.instance}},_implements:function(e){return"IAttributeHandler"==e}},props:{calculate:function(e){var t=[];return l.opt(e,(function(e){return e.selection.forEachSelected((function(e){var o=g.ImageUtils.getMediaMetadataForForma(e);null!=o&&t.push(o)}))})),[new c.MediaMetadataAttribute(t)]}}}),e}(),a.ColorAttributeHandler=function(){var e=function(){a.AttributeHandlerBase.call(this)},t={};return l.defineClass({name:"ColorAttributeHandler",ctor:e,superName:"AttributeHandlerBase",statics:{instance:{get:function(){return void 0===t.instance&&(t.instance=new e),t.instance}},_implements:function(e){return"IAttributeHandler"==e}},props:{calculate:function(e){var t,o=(t=l.opt(e,(function(e){return e.selection.selectedCount})))||null!=t?t:0,n=[];if(0==o);else if(1==o){var r,i,a;if(r=l.opt(e,(function(e){return e.selection.formaAt(0)})))if(null!=(i=r.style.colors.colorID(u.ColorRole.FieldPrimary)))(a=r.page.colorLibraryController.getTheoColorForKey(i))?n.push(a):n.push(null);else n.push(null)}else{var s=!0;if(l.opt(e,(function(e){return e.selection.forEachSelected((function(e){e.hasIntent(h.Forma.INTENT_GRID_CELL)||"Root"==e.kind||(s=!1)}))})),s){n=[];var d=[];l.opt(e,(function(e){return e.selection.forEachSelected((function(e){var t,o;null!=(t=e.style.colors.colorID(u.ColorRole.FieldPrimary))?(o=e.page.colorLibraryController.getTheoColorForKey(t))?n.push(o):n.push(null):n.push(null)}))})),n.length>0&&d.push(n[0]);for(var g=l.iter(l.range(0,n.length-1,!0));!g.done;g.next()){var p=g.value;if(!l.eq(f._equality_TheoColor_TheoColor,d[0],n[p])){d[0]=null;break}}n=l.clone(d)}}return[new c.ColorAttribute(n)]}}}),e}(),a.StandardAttributesHandler=function(){var e=function(e){this.dc=e},t={};return l.defineClass({name:"StandardAttributesHandler",ctor:e,statics:{handlers:{get:function(){return void 0===t.handlers&&(t.handlers=e.allHandlers()),t.handlers}},allHandlers:function(){var e=[];return e.push(a.OpacityAttributeHandler.instance),e.push(a.MediaMetadataAttributeHandler.instance),e.push(a.ImageAttributeHandler.instance),e.push(a.ColorAttributeHandler.instance),e.push(a.ControllerSettingAttributeHandler.instance),e.push(s.AnimationAttributesHandler.instance),e},_implements:function(e){return"IAttributesHandler"==e}},props:{updateAttributes:function(t){this.updateFrom(t,e.handlers)},updateFrom:function(e,t){e.clear();for(var o=l.iter(t);!o.done;o.next())for(var n=o.value,r=l.clone(n.calculate(this.dc)),i=l.iter(r);!i.done;i.next()){var a=i.value;e.add(a)}}}}),e}()},PXFs:function(e,t,o){var n,r,i,a=t,l=o("oAGj"),s=o("SpAV"),u=o("yGNn"),c=o("C42b"),h=o("QbzR"),d=o("iCxV"),g=o("xYeW"),p=o("kJ8p"),f=o("c+uM"),m=o("3DEm"),y=o("7Ta2"),v=o("35Q0"),S=o("EoOi"),C=o("8t9B"),T=o("3UhB"),A=o("oKI3"),F=o("uUew");a.PostTextStylesData=(n=function(e,t,o,n,r,i,a,l,s,u,c,h,d,g,p,f,m){this.role=e,this.msl=t,this.tracking=o,this.spacing=n,this.width=r,this.height=i,this.pageWidth=a,this.pageHeight=l,this.fontDensity=s,this.variance=u,this.backgroundVariance=c,this.contrast=h,this.numWords=d,this.numLines=g,this.fontSize=p,this.guid=f,this.limit=m},l.defineClass({name:"PostTextStylesData",ctor:n,props:{parameters:{get:function(){var e,t,o,n,r="role="+((e=this.role)||null!=e?e:y.InferredRoleType.Undefined)+"&msl="+this.msl+"&tracking="+(null!=this.tracking?m.MathUtils.roundDoubleToString(this.tracking,4):"-1.0")+"&spacing="+(null!=this.spacing?m.MathUtils.roundDoubleToString(this.spacing,4):"-1.0")+"&width="+(null!=this.width?m.MathUtils.roundDoubleToString(this.width,4):"-1.0")+"&height="+(null!=this.height?m.MathUtils.roundDoubleToString(this.height,4):"-1.0")+"&page_width="+this.pageWidth+"&page_height="+this.pageHeight+"&font_density="+(null!=this.fontDensity?m.MathUtils.roundDoubleToString(this.fontDensity,4):"-1.0")+"&variance="+(null!=this.variance?m.MathUtils.roundDoubleToString(this.variance,4):"-1.0")+"&background_variance="+(null!=this.backgroundVariance?m.MathUtils.roundDoubleToString(this.backgroundVariance,4):"-1.0")+"&contrast="+(null!=this.contrast?m.MathUtils.roundDoubleToString(this.contrast,4):"-1.0")+"&num_words="+((t=this.numWords)||null!=t?t:-1)+"&num_lines="+((o=this.numLines)||null!=o?o:-1)+"&avg_font_size="+(null!=this.fontSize?m.MathUtils.roundDoubleToString(this.fontSize,4):"-1.0")+"&guid="+((n=this.guid)||null!=n?n:"Null")+"&limit="+this.limit;return l.replaceAll(r," ","%20")}},clone:function(){return new n(this.role,this.msl,this.tracking,this.spacing,this.width,this.height,this.pageWidth,this.pageHeight,this.fontDensity,this.variance,this.backgroundVariance,this.contrast,this.numWords,this.numLines,this.fontSize,this.guid,this.limit)}}}),n),a.layoutAlignmentData=(r=function(e,t){this.layout=e,this.alignment=t},l.defineClass({name:"layoutAlignmentData",ctor:r,props:{clone:function(){return new r(this.layout,this.alignment)}}}),r),a.PostTextStylesServiceInterface=(i=function(e,t){var o;this.suggestedStyle=null,this.serviceAPIKey="Theo2",this.stylesAPIUrl="https://posttextstylesservice.adobe.io/styles?",this.emphasisAPIUrl="https://posttextstylesservice.adobe.io/text/emphasis",this.apiCallLimit=225,this.limitToEvaluate=4,this.thresholdToCallEmphasisService=3,this.maxThresholdToCallEmphasisService=30,this._advancedFeatures=!1,this.forma=e,this.readabilityInfo=t,this.stylesAPICache=[],this.tokenCache=[],this.emphasisAPICache=[],this.autoTextCache=[],this.styleRanges=[],this.emphasisIndex=0,this.originalText="",(o=l.as(this.forma.controller,C.TypeLockupController))&&(o.styleController.setSessionContainerSize(o.size),o.styleController.setSessionContainerCenter(l.opt(this.forma.frame,(function(e){return e.center}))))},l.defineClass({name:"PostTextStylesServiceInterface",ctor:i,superName:"CoreObject",statics:{PROBABILITY_STYLE_CHANGE:.5,PROBABILITY_STANDARD_LAYOUT:.3,PROBABILITY_MAGIC_LAYOUT:.5,PROBABILITY_PATH_LAYOUT:.7,PROBABILITY_GRID_LAYOUT:.8,PATH_LAYOUT_MIN_TRACKING:0,PATH_LAYOUT_MAX_TRACKING:.45,PATH_LAYOUT_MIN_CHARACTERS:12,PATH_LAYOUT_MAX_CHARACTERS:30},props:{advancedFeatures:{get:function(){return this._advancedFeatures},set:function(e){this._advancedFeatures=e}},overrideAPIKey:function(e){this.serviceAPIKey=e},resetAutoTextCache:function(){var e;this.autoTextCache.splice(0),(e=l.as(this.forma.controller,C.TypeLockupController))&&(this.originalText=e.text,this.autoTextCache=l.clone(S.TypographyComposer.getApplicableLayouts(e.text)),this.styleRanges=l.clone(e.charStyleRanges))},getAdvancedTextStyleSuggestion:function(e){var t,o=null;if(t=l.as(this.forma.controller,C.TypeLockupController)){if(this.originalText!=t.text&&(this.resetAutoTextCache(),t.styleController.resetSessionContainerSize(),t.styleController.resetSessionContainerCenter()),t.styleController.setSessionContainerSize(t.size),t.styleController.setSessionContainerCenter(l.opt(this.forma.frame,(function(e){return e.center}))),t.beginBlockedUpdate(),l.toDouble(c.CoreRandom.nextInt)/l.toDouble(c.CoreRandom.randMax)<i.PROBABILITY_STYLE_CHANGE&&(o=this.getTextStyleSuggestion(e)),null==o){o=t.lockupStyle,(o=t.lockupStyle).pathID=A.TextPathID.UNSET;var n=l.toDouble(c.CoreRandom.nextInt)/l.toDouble(c.CoreRandom.randMax);if(n<i.PROBABILITY_STANDARD_LAYOUT){if(o.layout==f.LockupLayout.Standard){for(var r=f.LockupAlignment.toCaseValue(l.toInt(Math.round(2*l.toDouble(c.CoreRandom.nextInt)/l.toDouble(c.CoreRandom.randMax))));r==o.alignment;)r=f.LockupAlignment.toCaseValue(l.toInt(Math.round(2*l.toDouble(c.CoreRandom.nextInt)/l.toDouble(c.CoreRandom.randMax))));o.alignment=r}else o.layout=f.LockupLayout.Standard,o.alignment=f.LockupAlignment.toCaseValue(l.toInt(Math.round(2*l.toDouble(c.CoreRandom.nextInt)/l.toDouble(c.CoreRandom.randMax))));t.charStyleRanges=l.clone(this.styleRanges)}else if(n<i.PROBABILITY_MAGIC_LAYOUT&&o.layout!=f.LockupLayout.FitJustified)o.layout=f.LockupLayout.FitJustified,o.alignment=f.LockupAlignment.UNSET,t.charStyleRanges=l.clone(this.styleRanges);else if(n<i.PROBABILITY_PATH_LAYOUT&&t.text.length>i.PATH_LAYOUT_MIN_CHARACTERS){o.layout=f.LockupLayout.Path,o.alignment=f.LockupAlignment.UNSET;var a=1+l.toInt(Math.round(2*l.toDouble(c.CoreRandom.nextInt)/l.toDouble(c.CoreRandom.randMax)));if(o.layout==f.LockupLayout.Path)for(;A.TextPathID.toCaseValue(a)==o.pathID;)a=1+l.toInt(Math.round(2*l.toDouble(c.CoreRandom.nextInt)/l.toDouble(c.CoreRandom.randMax)));else o.layout=f.LockupLayout.Path;o.pathID=A.TextPathID.toCaseValue(a);var s=this.calcPathTracking(t.text.length);a>1&&(s/=2),o.tracking=s,t.charStyleRanges=l.clone(this.styleRanges)}else if(n<i.PROBABILITY_GRID_LAYOUT||0==this.autoTextCache.length){if(o.layout==f.LockupLayout.LetterGrid){for(r=f.LockupAlignment.toCaseValue(l.toInt(Math.round(2*l.toDouble(c.CoreRandom.nextInt)/l.toDouble(c.CoreRandom.randMax))));r==o.alignment;)r=f.LockupAlignment.toCaseValue(l.toInt(Math.round(2*l.toDouble(c.CoreRandom.nextInt)/l.toDouble(c.CoreRandom.randMax))));o.alignment=r}else o.layout=f.LockupLayout.LetterGrid,o.alignment=f.LockupAlignment.toCaseValue(l.toInt(Math.round(2*l.toDouble(c.CoreRandom.nextInt)/l.toDouble(c.CoreRandom.randMax))));t.charStyleRanges=l.clone(this.styleRanges)}else{var u,h=!1;if(this.autoTextCache.length>0&&o.layout!=f.LockupLayout.Auto)o.layout=f.LockupLayout.Auto,r=this.autoTextCache[l.toInt(l.toDouble(this.autoTextCache.length)*l.toDouble(c.CoreRandom.nextInt)/l.toDouble(c.CoreRandom.randMax))],(u=S.TypographyComposer.getWeightingForAlignment(r,t.text))&&(t.autoTextRanges=l.clone(u),h=!0,o.alignment=r);if(!h){for(o.layout=f.LockupLayout.Standard,r=f.LockupAlignment.toCaseValue(l.toInt(Math.round(2*l.toDouble(c.CoreRandom.nextInt)/l.toDouble(c.CoreRandom.randMax))));r==o.alignment;)r=f.LockupAlignment.toCaseValue(l.toInt(Math.round(2*l.toDouble(c.CoreRandom.nextInt)/l.toDouble(c.CoreRandom.randMax))));o.alignment=r}t.charStyleRanges=l.clone(this.styleRanges)}o.backing!=f.LockupBacking.None&&(v.ShapeLibrary.isBackingShapeStyleCompatible(o,o.backing,o.backingArtworkID)||(o.backing=f.LockupBacking.SVGBackground,o.backingArtworkID="square_001",v.ShapeLibrary.isBackingShapeStyleCompatible(o,o.backing,o.backingArtworkID)||(o.backing=f.LockupBacking.None,o.backingArtworkID=null)))}return t.endBlockedUpdate(),t.styleChanged(),t.snapSizeToBounds(),o}return this.getTextStyleSuggestion(e)},calcPathTracking:function(e){if(e>i.PATH_LAYOUT_MAX_CHARACTERS)return i.PATH_LAYOUT_MIN_TRACKING;if(e<i.PATH_LAYOUT_MIN_CHARACTERS)return i.PATH_LAYOUT_MAX_TRACKING;var t=i.PATH_LAYOUT_MAX_CHARACTERS-i.PATH_LAYOUT_MIN_CHARACTERS,o=i.PATH_LAYOUT_MAX_TRACKING-i.PATH_LAYOUT_MIN_TRACKING,n=e-i.PATH_LAYOUT_MIN_CHARACTERS,r=(1-l.toDouble(n)/l.toDouble(t))*o;return i.PATH_LAYOUT_MIN_TRACKING+r},getTextStyleSuggestion:function(e){var t,o=null;if(this.stylesAPICache.length>0&&(t=l.as(this.forma.controller,C.TypeLockupController))){for(var n=t.styleController,r=0;null==o&&r<this.limitToEvaluate&&0!=this.stylesAPICache.length;)o=n.updateLockupStyleWithNewColors(this.decodeStyleAPIObject(this.stylesAPICache.shift())),null!=e&&(r+=1,o=e.lockupStyleEvaluator.styleEvaluatedWithReadability(o));null==o&&this.stylesAPICache.length>0&&(o=n.updateLockupStyleWithNewColors(this.decodeStyleAPIObject(this.stylesAPICache.shift())),l.opt(o,(function(e){return e.wheelUsed=!0})))}return o},getNextTextEmphasisSuggestion:function(){return this.emphasisAPICache.length>0?(this.emphasisIndex+=1,this.emphasisAPICache[this.emphasisIndex%this.emphasisAPICache.length]):null},getCurrentTextEmphasisSuggestion:function(){return this.emphasisAPICache.length>0?this.emphasisAPICache[this.emphasisIndex%this.emphasisAPICache.length]:null},getNumStylesInCache:function(){return this.stylesAPICache.length},getEmphasisCache:function(){return this.emphasisAPICache},getEmphasisTokens:function(){return this.tokenCache},resetStyleSuggestions:function(e){return void 0===e&&(e=!1),this.advancedFeatures&&(this.resetAutoTextCache(),this.resetEmphasisSuggestions(!0)),this.stylesAPICache=[],this.stylesPromise=null,this.populateStylesCacheWithAPISuggestions(e)},resetEmphasisSuggestions:function(e){return this.emphasisAPICache=[],this.tokenCache=[],this.emphasisIndex=0,this.emphasisPromise=null,this.populateEmphasisCacheWithAPISuggestions(e)},getNLPInformtionForCurrentEmphasized:function(){var e,t=[];if(e=l.as(this.forma.controller,C.TypeLockupController))for(var o=l.clone(e.charStyleRanges),n=l.iter(o);!n.done;n.next()){for(var r=n.value,i="",a=l.iter(this.tokenCache);!a.done;a.next()){var s,u,c,h,d,g=a.value;if(null!=(s=l.as(g.offset,"Int"))&&s>=r.start&&s<r.end&&null!=(u=l.as(g.index,"Int"))&&null!=(c=l.as(g.pos,"String"))&&null!=(h=l.as(g.relation,"String"))&&null!=(d=l.as(g.tag,"String"))){var p=null,f=null,m=null;u>=0&&u<=this.tokenCache.length&&(p=l.as(this.tokenCache[u].pos,"String"),f=l.as(this.tokenCache[u].relation,"String"),m=l.as(this.tokenCache[u].tag,"String"));var y="";y+="{",y+="index:"+l.toString(u),y+="\\,pos:"+c,y+="\\,rela:"+h,y+="\\,tag:"+d,y+="\\,depPos:"+(null!=p?p:"none"),y+="\\,depRela:"+(null!=f?f:"none"),y+="\\,depTag:"+(null!=m?m:"none"),i+=y+="}"}}i.length>0&&t.push(i)}return t},getStylesPromise:function(e){var t,o,n=this,r=l.as(this.forma.controller,C.TypeLockupController),i=l.clone(new a.PostTextStylesData((new y.RoleSuggester).getRole(this.forma).role,((t=l.opt(r,(function(e){return e.charStyleRanges.length})))||null!=t?t:0)>0||e,l.opt(l.opt(r,(function(e){return e.lockupStyle})),(function(e){return e.tracking})),l.opt(l.opt(r,(function(e){return e.lockupStyle})),(function(e){return e.spacing})),l.opt(l.opt(r,(function(e){return e.size})),(function(e){return e.width})),l.opt(l.opt(r,(function(e){return e.size})),(function(e){return e.height})),this.forma.page.pageSize.width,this.forma.page.pageSize.height,l.opt(r,(function(e){return null!=e.lockupStyle?l.opt(n.readabilityInfo,(function(e){return e.getDensity(n.forma,r.lockupStyle)})):null})),l.opt(r,(function(e){return null!=e.lockupStyle?l.opt(n.readabilityInfo,(function(e){return e.getBackgroundColorVariance(n.forma,r.lockupStyle)})):null})),l.opt(r,(function(e){return null!=e.lockupStyle?l.opt(n.readabilityInfo,(function(e){return e.backgroundVariance})):null})),l.opt(r,(function(e){return null!=e.lockupStyle?l.opt(n.readabilityInfo,(function(e){return e.getLockupContrast(n.forma,r.lockupStyle)})):null})),l.opt(r,(function(e){return e.wordCount()})),l.opt(r,(function(e){return e.numLines()})),l.opt(r,(function(e){return e.getAverageFontSize()})),null,this.apiCallLimit));if(o=d.Host.network){var s=new p.HostNetworkRequest(this.stylesAPIUrl+i.parameters);return s.method=p.HostNetworkRequestMethod.get,s.headers["x-api-key"]=this.serviceAPIKey,s.headers["x-live-data"]="false",o.request(s)}return u.CorePromise.reject("Unable to create Host network request")},getEmphasisPromise:function(){var e,t,o,n=l.as(this.forma.controller,C.TypeLockupController);if((e=d.Host.network)&&(t=d.Host.dataFactory)&&null!=(o=l.opt(n,(function(e){return e.text})))){var r,i=new p.HostNetworkRequest(this.emphasisAPIUrl);return i.headers["x-api-key"]=this.serviceAPIKey,(r=this.getEmphasisHostDataProtocol(o,t))?(i.method=p.HostNetworkRequestMethod.post,i.data=t.createFromFormData(r),e.request(i)):u.CorePromise.resolve("No valid data object to sent")}return u.CorePromise.reject("Unable to create Host network request")},getEmphasisHostDataProtocol:function(e,t){var o,n=l.replaceAll(e,"\n"," ");return n=l.replaceAll(n,"\r"," "),n=l.replaceAll(n,"\t"," "),this.containsLetters(n)&&(o=t.createFromString(n,"text/plain"))?{text:new g.HostNetworkFormDatum(o)}:null},containsLetters:function(e){for(var t=l.iter(l.range(0,e.length,!1));!t.done;t.next()){var o=t.value,n=e.substr(o,1);if(n>="a"&&n<="z"||n>="A"&&n<="Z")return!0}return!1},populateStylesCacheWithAPISuggestions:function(e){var t,o=this;return this.stylesPromise=this.getStylesPromise(e),(t=this.stylesPromise)?t.then((function(e){var t;return(t=l.opt(l.opt(l.as(e,p.HostNetworkResponse),(function(e){return e.data})),(function(e){return e.asJSON()})))?t.then((function(e){var t,n;if((t=l.as(e,["Dictionary","String","Any"]))&&(n=l.as(t.styles,["Array",["Dictionary","String","Any"]]))){for(var r=l.iter(n);!r.done;r.next()){var i=r.value;o.stylesAPICache.push(i)}return u.CorePromise.resolve(null)}return u.CorePromise.reject("Unable to decode object")})):u.CorePromise.reject("Unable to process response")})):u.CorePromise.reject("unable to get styles promise")},decodeStyleAPIObject:function(e){var t=this.getPrimaryStyleFromDict(e);if(null!=e.hasMSL){var o=this.getSecondaryStyleFromDict(e,t);t.setCharacterStyle(C.TypeLockupController.HIGHLIGHT_STYLE,o)}return t},populateEmphasisCacheWithAPISuggestions:function(e){var t,o=this;if(null!=(t=this.getBaselineEmphasisSuggestions())&&(t<this.thresholdToCallEmphasisService||t>this.maxThresholdToCallEmphasisService))return u.CorePromise.resolve("No need to use emphasis service, just cycle through options");var n=this.getEmphasisPromise();return this.emphasisPromise=n,n.then((function(t){var n,r;return(n=l.as(t,p.HostNetworkResponse))&&(r=l.opt(n.data,(function(e){return e.asJSON()})))?r.then((function(t){var r;return(r=o.decodeEmphasisResponse(t))&&e&&(o.emphasisAPICache=l.clone(r)),u.CorePromise.resolve(n)})):u.CorePromise.resolve("Unable to process emphasis response")}))},getBaselineEmphasisSuggestions:function(){var e;if(this.advancedFeatures){if(e=l.as(this.forma.controller,C.TypeLockupController)){var t=[],o=l.clone(S.TypographyComposer.getWordRanges(e.text,null));if(o.length>1&&o.length<this.maxThresholdToCallEmphasisService){for(var n=l.iter(o);!n.done;n.next()){var r=n.value;t.push([r])}this.emphasisAPICache=l.clone(t)}return t.length}}else if(e=l.as(this.forma.controller,C.TypeLockupController)){var i=l.clone(e.getAllTextFormae());if(t=[],i.length<10)for(var a=l.iter(i);!a.done;a.next()){var s=a.value;t.push([s.rangeInLockup])}else for(var u=l.iter(l.range(0,l.toInt(i.length/2),!1));!u.done;u.next()){var c=2*u.value,h=c+1;t.push([i[c].rangeInLockup,i[h].rangeInLockup])}return t.length>1&&(this.emphasisAPICache=l.clone(t)),t.length}return null},decodeNLP:function(e,t,o){for(var n=l.iter(t);!n.done;n.next()){var r,i=n.value;if(r=l.as(i.categories,["Array","Int"]))for(var a=l.clone(e.getAllTextFormae()),s=l.iter(a);!s.done;s.next()){var u=s.value;if(u.text.toLowerCase().includes(i.text.toLowerCase())&&i.offset==u.rangeInLockup.start){for(var c=l.iter(r);!c.done;c.next())o[c.value].push(u.rangeInLockup);break}}}},decodeNLPAdvanced:function(e,t,o){for(var n=e.text,r=l.iter(t);!r.done;r.next()){var i,a,s,u=r.value;if((i=l.as(u.categories,["Array","Int"]))&&null!=(a=l.as(u.text,"String"))&&null!=(s=l.as(u.offset,"Int"))&&n.substr(s,a.length)==a)for(var c=l.iter(i);!c.done;c.next())o[c.value].push(new F.TextRange(s,s+a.length))}},decodeEmphasisResponse:function(e){var t,o,n,r;if((d=l.as(e,["Dictionary","String","Any"]))&&(t=l.as(d.emphasis,["Array",["Dictionary","String","Any"]]))&&(o=l.as(t[0].words,["Array",["Dictionary","String","Any"]]))&&(n=l.as(t[0].categories,["Array","Int"]))&&(r=l.as(t[0].tokens,["Array",["Dictionary","String","Any"]]))){this.tokenCache=l.clone(r);for(var i,a={},s=l.iter(n);!s.done;s.next())a[s.value]=[];(i=l.as(this.forma.controller,C.TypeLockupController))&&(this.advancedFeatures?this.decodeNLPAdvanced(i,o,a):this.decodeNLP(i,o,a));for(var u=[],c=l.sort(l.keys(a,"numeric")),h=l.iter(c);!h.done;h.next()){var d,g=h.value;(d=l.clone(a[g])).length>0&&u.push(d)}return u}return null},decodeNLPResponse:function(e){var t,o,n,r;if((d=l.as(e,["Dictionary","String","Any"]))&&(t=l.as(d.emphasis,["Array",["Dictionary","String","Any"]]))&&(o=l.as(t[0].words,["Array",["Dictionary","String","Any"]]))&&(n=l.as(t[0].categories,["Array","Int"]))&&(r=l.as(t[0].tokens,["Array",["Dictionary","String","Any"]]))){this.tokenCache=l.clone(r);for(var i,a={},s=l.iter(n);!s.done;s.next())a[s.value]=[];(i=l.as(this.forma.controller,C.TypeLockupController))&&(this.advancedFeatures?this.decodeNLPAdvanced(i,o,a):this.decodeNLP(i,o,a));for(var u=[],c=l.sort(l.keys(a,"numeric")),h=l.iter(c);!h.done;h.next()){var d,g=h.value;(d=l.clone(a[g])).length>0&&u.push(d)}return u}return null},getPrimaryStyleFromDict:function(e){var t,o,n,r,i,a,s,u,c,h,d,g,p=(t=l.as(e.textOpacity,"Double"))||null!=t?t:f.LockupStyle.DEFAULT_TEXTOPACITY,m=(o=l.as(e.backingOpacity,"Double"))||null!=o?o:f.LockupStyle.DEFAULT_BACKINGOPACITY,y=(n=l.as(e.spacing,"Double"))||null!=n?n:f.LockupStyle.DEFAULT_SPACING,v=(r=l.as(e.tracking,"Double"))||null!=r?r:f.LockupStyle.DEFAULT_TRACKING,S=(i=l.as(e.padding,"Double"))||null!=i?i:f.LockupStyle.DEFAULT_PADDING,C=null==l.as(e.backing,"Int")||!(a=f.LockupBacking.toCaseValue(e.backing))&&null==a?f.LockupBacking.None:a,T=(s=l.as(e.backingArtworkID,"String"))||null!=s?s:null,F=(u=l.as(e.shadowAngle,"Double"))||null!=u?u:f.LockupStyle.DEFAULT_SHADOWANGLE,k=null==l.as(e.textLook,"Int")||!(c=f.LockupTextLook.toCaseValue(e.textLook))&&null==c?f.LockupTextLook.Fill:c,L=(h=l.as(e.shadowOffset,"Double"))||null!=h?h:f.LockupStyle.DEFAULT_SHADOWOFFSET,b=(d=l.as(e.strokeWeight,"Double"))||null!=d?d:f.LockupStyle.DEFAULT_STROKEWEIGHT,_=this.getTheoFont(e,"primaryFont"),R=l.clone(this.getLayoutAlignment(e)),I=A.TextPathID.UNSET;if(R.layout==f.LockupLayout.Path){var w=l.as(e.pathId,"Int");I=null==w||!(g=A.TextPathID.toCaseValue(w))&&null==g?A.TextPathID.Circle:g}return C=this.checkBackingValid(C,T),k=this.checkTextLookValid(k),f.LockupStyle.init_f3fd(p,m,null,_,y,v,S,C,T,F,R.layout,R.alignment,k,L,b,I)},getSecondaryStyleFromDict:function(e,t){var o,n,r,i,a,s=f.LockupStyle.createDefaultCharacterStyle(t);s.font=this.getTheoFont(e,"mslFont"),s.textOpacity=(o=l.as(e.mslOpacity,"Double"))||null!=o?o:h.FormaStyle.OPACITY_UNSET,s.padding=(n=l.as(e.mslPadding,"Double"))||null!=n?n:f.LockupStyle.DEFAULT_PADDING;var u=null==l.as(e.mslBacking,"Int")||!(r=f.LockupBacking.toCaseValue(e.mslBacking))&&null==r?f.LockupBacking.None:r;return s.backingArtworkID=(i=l.as(e.mslBackingArtworkID,"String"))||null!=i?i:null,s.textLook=null==l.as(e.mslTextLook,"Int")||!(a=f.LockupTextLook.toCaseValue(e.mslTextLook))&&null==a?f.LockupTextLook.Fill:a,s.textLook=this.checkTextLookValid(s.textLook),s.backing=this.checkBackingValid(u,s.backingArtworkID),s},checkBackingValid:function(e,t){return e==f.LockupBacking.SVGBackground&&null==t?(s.CoreAssert.fail("Backing set to SVG, but no backing artwork ID found",void 0,"PostTextStylesServiceInterface.checkBackingValid","PostTextStylesServiceInterface.swift",825),f.LockupBacking.None):e},checkTextLookValid:function(e){return e<0?f.LockupTextLook.Fill:e},getTheoFont:function(e,t){var o,n,r=null;return null!=(o=l.as(e[t],"String"))&&(n=T.TypeLockupUtils.getFontDescriptorFromPostScriptName(this.forma,o))&&(r=T.TypeLockupUtils.createTheoFont(n,null)),r},getLayoutAlignment:function(e){var t,o,n,r,i=l.clone(new a.layoutAlignmentData(f.LockupLayout.FitJustified,f.LockupAlignment.UNSET)),u=(t=l.as(e.layout,"Int"))||null!=t?t:f.LockupLayout.UNSET;return(r=this.fixLegacyLayout(u))?(i.layout=r.layout,i.alignment=r.alignment):(i.layout=(o=f.LockupLayout.toCaseValue(u))||null!=o?o:f.LockupLayout.FitJustified,i.alignment=null==l.as(e.alignment,"Int")||!(n=f.LockupAlignment.toCaseValue(e.alignment))&&null==n?f.LockupAlignment.UNSET:n,i.layout==f.LockupLayout.FitJustified&&s.CoreAssertDebugOnly.isTrue(i.alignment==f.LockupAlignment.UNSET,"If layout is FitJustified, alignment should be UNSET",void 0,"PostTextStylesServiceInterface.getLayoutAlignment","PostTextStylesServiceInterface.swift",862)),i},fixLegacyLayout:function(e){var t;if(null!=(t=f.LockupLayout.toCaseValue(e)))switch(t){case 3:return new a.layoutAlignmentData(f.LockupLayout.Standard,f.LockupAlignment.Center);case 1:return new a.layoutAlignmentData(f.LockupLayout.Standard,f.LockupAlignment.Left);case 2:return new a.layoutAlignmentData(f.LockupLayout.Standard,f.LockupAlignment.Right);default:return null}return null}}}),i)},PXlJ:function(e,t,o){var n,r=t,i=o("oAGj"),a=o("ascj"),l=o("JgVS"),s=o("cEEQ"),u=o("c+uM"),c=o("tGKA"),h=o("JKVa"),d=o("8t9B"),g=o("sIWg");r.LetterDecorationStrategy=(n=function(){l.BaseDecorationStrategy.call(this)},i.defineClass({name:"LetterDecorationStrategy",ctor:n,superName:"BaseDecorationStrategy",statics:{_implements:function(e){return"LockupDecorationStrategy"==e}},props:{supportsConfiguration:function(e){return u.LockupStyle.isLetterGrid(e.style.layout)},decorate:function(e,t){var o,n,r=[];if(0==t.items.length)return new l.DecorationResults(r);var h,p,f,m,y=e.style,v=i.opt(y.font,(function(e){return e.fontData}));y.backing==u.LockupBacking.SVGBackground&&(h=y.backingArtworkID);var S,C,T,A=null;if(0==!e.characterStyleRanges.length&&(S=y.characterStyles[d.TypeLockupController.HIGHLIGHT_STYLE])&&(p=i.opt(S.font,(function(e){return e.fontData})),(f=S.backing)!=u.LockupBacking.UNSET&&(A=S.padding),f==u.LockupBacking.SVGBackground&&(m=S.backingArtworkID)),null==h&&null==m)return new l.DecorationResults(r);for(var F=i.iter(i.toSequence(t.items));!F.done;F.next()){var k=F.value,L=k.offset,b=k.element,_=v,R=null,I=!1;if(b.characterStyle==d.TypeLockupController.HIGHLIGHT_STYLE?(I=!0,_=p||_,R=f==u.LockupBacking.UNSET?h:m):R=h,null!=R){var w,D,x,P,E=g.TheoRect.fromXYWH(b.placement.tx,b.placement.ty,b.size.width,b.size.height).outsetXY((o=i.opt(b.margins,(function(e){return e.width})))||null!=o?o:0,(n=i.opt(b.margins,(function(e){return e.height})))||null!=n?n:0),M=I?T:C;if(null==M&&(M=this.getSVGConfig(e.style,I?A:null,t,R,b,E),I?T=M:C=M),null!=(w=i.opt(_,(function(e){return e.capRatio})))&&null!=(D=b.pointSize)&&null!=(x=M)&&null!=(P=R)){var N=(t.typographicBoundingRatios.textVerticalOffsetRatio-w)*D,G=c.Matrix2D.translation(x.frame.origin).translate(E.origin).translateXY(0,-N);r.push(s.LockupItem.init_fbd7(a.ColorRole.FieldSecondary,x.frame.size,G,P,x.preScale,L+t.numberOfLines,b.characterStyle))}}}return new l.DecorationResults(r)},getSVGConfig:function(e,t,o,n,r,a){var l,c,d=new s.LayoutResults([r],a.size,o.placement,o.typographicBoundingRatios,o.avgRowAspect),g=e;return null!=(l=t)&&(c=i.as(g.clone(),u.LockupStyle))&&(c.padding=l,g=c),new h.SVGBackgroundDecorationStrategy(n).calcSVGConfiguration(g,d)}}}),n)},"Pil/":function(e,t,o){var n,r,i,a,l,s,u,c,h,d,g,p,f,m=t,y=o("oAGj"),v=o("+nk0"),S=o("FNB+"),C=o("yHU1");m.FormaControllerEvent=(n=function(){},y.defineClass({name:"FormaControllerEvent",ctor:n,superName:"ControllerEvent",props:{forma:{get:function(){return y.first(this.formae)},set:function(e){y.eq(S._equality_Forma_Forma,y.first(this.formae),e)||(this.formae[0]=e)}},init_939b:function(e,t){this.formae=y.clone(t),v.ControllerEvent.call(this,e)},init_83ea:function(e,t){this.init_939b(e,[t])}}}),n),m.PSMFormaControllerEvent=(r=function(){},y.defineClass({name:"PSMFormaControllerEvent",ctor:r,superName:"FormaControllerEvent",props:{init_939b:function(e,t){y.super_init(this,m.FormaControllerEvent,m.FormaControllerEvent.prototype.init_939b,e,t)},init_83ea:function(e,t){y.super_init(this,m.FormaControllerEvent,m.FormaControllerEvent.prototype.init_83ea,e,t)}}}),r),m.BeginPointerTrackingEvent=(i=function(){this.trackingResponse=C.BeginPointerTrackingResponseEnum.TrackAsGroup},y.defineClass({name:"BeginPointerTrackingEvent",ctor:i,superName:"PSMFormaControllerEvent",statics:{TYPE:{get:function(){return"BeginPointerTrackingEvent"}}},props:{dragTargetForma:{get:function(){return y.first(this.dragTargetFormae)},set:function(e){y.eq(S._equality_Forma_Forma,y.first(this.dragTargetFormae),e)||(this.dragTargetFormae[0]=e)}},init_bef7:function(e,t,o){this.dragTargetFormae=y.clone(t),this.selectionState=o,y.super_init(this,m.PSMFormaControllerEvent,m.PSMFormaControllerEvent.prototype.init_939b,i.TYPE,[e])},init_e511:function(e,t,o){this.init_bef7(e,[t],o)}}}),i),m.PSMFormaDragControllerEvent=(a=function(e,t){this.drag=t,this.dragDelegate=t.activeDragDelegate,y.super_init(this,m.PSMFormaControllerEvent,m.PSMFormaControllerEvent.prototype.init_939b,e,this.dragDelegate.draggedFormae)},y.defineClass({name:"PSMFormaDragControllerEvent",ctor:a,superName:"PSMFormaControllerEvent"}),a),m.BeginFormaDragEvent=(l=function e(t){m.PSMFormaDragControllerEvent.call(this,e.TYPE,t)},y.defineClass({name:"BeginFormaDragEvent",ctor:l,superName:"PSMFormaDragControllerEvent",statics:{TYPE:{get:function(){return"BeginFormaDragEvent"}}}}),l),m.FormaDragEvent=(s=function e(t){m.PSMFormaDragControllerEvent.call(this,e.TYPE,t)},y.defineClass({name:"FormaDragEvent",ctor:s,superName:"PSMFormaDragControllerEvent",statics:{TYPE:{get:function(){return"FormaDragEvent"}}}}),s),m.EndFormaDragEvent=(u=function e(t){m.PSMFormaDragControllerEvent.call(this,e.TYPE,t)},y.defineClass({name:"EndFormaDragEvent",ctor:u,superName:"PSMFormaDragControllerEvent",statics:{TYPE:{get:function(){return"EndFormaDragEvent"}}}}),u),m.BeginFormaResizeEvent=(c=function e(t,o){this.spot=o,y.super_init(this,m.FormaControllerEvent,m.FormaControllerEvent.prototype.init_939b,e.TYPE,[t])},y.defineClass({name:"BeginFormaResizeEvent",ctor:c,superName:"FormaControllerEvent",statics:{TYPE:{get:function(){return"BeginFormaResizeEvent"}}}}),c),m.FormaResizeEvent=(h=function e(t,o,n){this.newSize=o,this.pin=n,y.super_init(this,m.FormaControllerEvent,m.FormaControllerEvent.prototype.init_939b,e.TYPE,[t])},y.defineClass({name:"FormaResizeEvent",ctor:h,superName:"FormaControllerEvent",statics:{TYPE:{get:function(){return"FormaResizeEvent"}}}}),h),m.EndFormaResizeEvent=(d=function e(t){y.super_init(this,m.FormaControllerEvent,m.FormaControllerEvent.prototype.init_939b,e.TYPE,[t])},y.defineClass({name:"EndFormaResizeEvent",ctor:d,superName:"FormaControllerEvent",statics:{TYPE:{get:function(){return"EndFormaResizeEvent"}}}}),d),m.FormaClickEvent=(g=function e(t){this.modifierKeys={},y.super_init(this,m.PSMFormaControllerEvent,m.PSMFormaControllerEvent.prototype.init_939b,e.TYPE,[t])},y.defineClass({name:"FormaClickEvent",ctor:g,superName:"PSMFormaControllerEvent",statics:{TYPE:{get:function(){return"FormaClickEvent"}}}}),g),m.FormaDoubleClickEvent=(p=function e(t){this.modifierKeys={},y.super_init(this,m.PSMFormaControllerEvent,m.PSMFormaControllerEvent.prototype.init_939b,e.TYPE,[t])},y.defineClass({name:"FormaDoubleClickEvent",ctor:p,superName:"PSMFormaControllerEvent",statics:{TYPE:{get:function(){return"FormaDoubleClickEvent"}}}}),p),m.AddFormaEvent=(f=function e(t){y.super_init(this,m.FormaControllerEvent,m.FormaControllerEvent.prototype.init_939b,e.TYPE,[t])},y.defineClass({name:"AddFormaEvent",ctor:f,superName:"FormaControllerEvent",statics:{TYPE:{get:function(){return"AddFormaEvent"}}}}),f)},QLFD:function(e,t,o){var n,r=t,i=o("oAGj"),a=o("Nk+Q"),l=o("CMNw"),s=o("UUXZ"),u=o("PSFa"),c=o("JzRL"),h=o("elwG"),d=o("qUXk"),g=o("u+mS"),p=o("eLsM"),f=o("hsXA"),m=o("JU+l"),y=o("aKgf");r.NoSelectionDesignController=(n=function(e,t){d.DesignController.call(this),this.handles=new f.StandardHandlesHandler(e,t,this),this.drag=new g.DragFacadeBasedDragHandler(e,t,this),this.click=new h.StandardClickHandler(e),this.resize=m.NullResizeHandler.instance,this.actions=new l.StandardActionHandler(e),this.attributes=new u.StandardAttributesHandler(e),this.featureSets=new p.StandardFeatureSetHandler(e),this.actionFeedback=new a.StandardActionFeedbackHandler(t),this.annotations=new s.StandardAnnotationsHandler(t),this.view=new y.StandardViewHandler(e,t),this.activePage=new c.StandardActivePageHandler(e,t)},i.defineClass({name:"NoSelectionDesignController",ctor:n,superName:"DesignController"}),n)},QLmq:function(e,t,o){var n,r=t,i=o("oAGj"),a=o("7siz");r.IFeatureSetsModel=i.defineProtocol("IFeatureSetsModel",{find:"(String) -> IFeatureSet"}),r.FeatureSetsState=(n=function(e){void 0===e&&(e=null),this.featureSets=i.clone(e||{})},i.defineClass({name:"FeatureSetsState",ctor:n,superName:"EditorStateMember",statics:{_implements:function(e){return"IFeatureSetsModel"==e}},props:{clone:function(){return new n(this.featureSets)},find:function(e){return this.featureSets[e]},clear:function(){this.beforeChange(),i.removeAll(this.featureSets),this.afterChange()},add:function(e){this.beforeChange(),this.featureSets[e.key]=e,this.afterChange()},remove:function(e){this.beforeChange(),i.removeKey(this.featureSets,e),this.afterChange()},diff:function(e){for(var t=[],o=i.iter(this.featureSets);!o.done;o.next()){var n,r=o.key,l=o.value;(n=e.featureSets[r])&&l.isEqualTo(n)||t.push(a.EditorModelChangedMessage.CHG_FEATURE_SET_PREFIX+r)}for(var s=i.iter(e.featureSets);!s.done;s.next())r=s.key,null==this.featureSets[r]&&t.push(a.EditorModelChangedMessage.CHG_FEATURE_SET_PREFIX+r);return t}}}),n)},SVjO:function(e,t,o){var n,r=t,i=o("oAGj"),a=o("Tq01"),l=o("0wFF"),s=o("Dz6V"),u=o("yGNn"),c=o("LP+A"),h=o("iCxV"),d=o("uxH+"),g=o("LqGn"),p=o("9YN4"),f=o("Kkml");r.ApplyTemplateAction=(n=function(){this.disableFallback=!1,this.layoutOption=c.RetargetLayoutOption.UNSET,this.filterFormae=[]},i.defineClass({name:"ApplyTemplateAction",ctor:n,superName:"Action",statics:{TYPE:"ApplyTemplateAction",createDesignTemplateAction:function(e,t,o,r,i,a){return void 0===a&&(a=!1),n.init_fc36(e,t,o,r,i,a)},createDesignTemplateActionFromPromise:function(e,t,o,r,i,a,l){return void 0===a&&(a=!1),n.init_a128(e,t,o,r,i,a,l)}},props:{init_b652:function(e,t,o){this.designSuggestion=e,this.rootForma=t,this.originalRootForma=null,this.templateDocumentPromise=null,this.tapIndex=o,a.Action.call(this,n.TYPE)},init_a128:function(e,t,o,r,l,u,h){void 0===u&&(u=!1),void 0===h&&(h=c.RetargetLayoutOption.UNSET),this.templateDocumentPromise=e,this.tapIndex=o,this.rootForma=t,this.originalRootForma=r,this.designSuggestion=null,this.disableFallback=u,this.layoutOption=h,this.filterFormae=i.clone(l);var d=new a.ActionExecutionOptions(s.ActionFeedbackWaitingType.Loading,s.ActionFeedbackMessageType.None);a.Action.call(this,n.TYPE,d)},init_fc36:function(e,t,o,n,r,i,a){void 0===i&&(i=!1),void 0===a&&(a=c.RetargetLayoutOption.UNSET),this.init_a128(u.CorePromise.resolve(e),t,o,n,r,i,a)},getUserAction:function(e){var t=this.rootForma.uuid;return f.UserActions.ApplyTemplate(t)},execute:function(e){var t,o,n,r,s=this,f=u.CorePromise.resolve([]);null==this.designSuggestion&&(i.opt(i.as(this.rootForma.controller,d.RootController),(function(e){return e.createGridControllerIfNone()})),(n=this.originalRootForma)&&(i.opt(i.as(n.controller,d.RootController),(function(e){return e.createGridControllerIfNone()})),(r=this.templateDocumentPromise)&&(f=r.then((function(e){var t;return(t=i.as(e,p.TheoDocument))?c.DesignSuggestionFacade.createSuggestionsFromTemplate(t,s.rootForma,n,s.filterFormae,10,s.layoutOption):[]})))));var m=new a.SuggestionsActionResult([]);return f.then((function(e){var n,r;if((n=i.as(e,["Array",g.RetargetSuggestion]))&&(n.length,n.length>0&&null==s.designSuggestion)){var u=s.tapIndex%n.length;u>=0&&(s.designSuggestion=n[u])}if(r=s.designSuggestion){r.disableFallback=s.disableFallback;var d=(t=s.tapIndex)||null!=t?t:0,p=!1;return p=s.layoutOption!=c.RetargetLayoutOption.UNSET&&d>0||(r.layoutUpdate?d>1:d>0),r.applyWithPromise(p).then((function(t){var n;return i.opt(h.Host.logging,(function(e){return e.logToAnalytics(l.AnalyticsConstants.kAnalyticsEventDesignFilterSelected,{contextualData1:"status:"+(r.layoutUpdate?"on":"off"),contextualData2:"shuffle:"+((o=s.tapIndex)||null!=o?o:0),contextualData3:"designFilterID:"+r.modelDoc.uuid})})),(n=i.as(e,["Array",g.RetargetSuggestion]))?new a.SuggestionsActionResult(n):m}))}return m}))}}}),n)},TP4q:function(e,t,o){var n,r=t,i=o("oAGj"),a=o("pnSN"),l=o("cbNz"),s=o("9BFu");r.GridScore=(n=function(e,t,o,n,r,u,c,h){this.dataset="DefaultGridScore",this.rejectThreshold=-1e3,void 0===e&&(e=null),void 0===n&&(n=null),void 0===r&&(r=!1),void 0===u&&(u=null),void 0===c&&(c=null),void 0===h&&(h=null),this.currentGrid_=n,this.gridStyle_=e,this.gridFrame_=t,this.contentAware_=r,this.layoutItems_=i.clone(o);var d=i.clone(new l.GridStyleFeatureExtractor(i.as(n,a.GroupForma),c,h,e,t,o).features);s.WeightedScore.call(this,i.count(d)),this.writeFeatureDict(this.dataset,d),null!=u&&u.length==i.count(d)&&this.setWeights(u)},i.defineClass({name:"GridScore",ctor:n,superName:"WeightedScore",props:{gridStyle:{get:function(){return this.gridStyle_}},reject:function(){return this.score<this.rejectThreshold}}}),n)},TkOd:function(e,t,o){var n,r,i,a,l,s,u,c,h,d,g,p,f,m=t,y=o("oAGj"),v=o("cZuM"),S=o("6h7+"),C=o("SpAV"),T=o("yhkb"),A=o("gXiO"),F=o("C42b"),k=o("YSlt"),L=o("Ohrj"),b=o("ascj"),_=o("FNB+"),R=o("QgZx"),I=o("lq1z"),w=o("QbzR"),D=o("iCxV"),x=o("3lr5"),P=o("fNpk"),E=o("c+uM"),M=o("hb8m"),N=o("tGKA"),G=o("3DEm"),B=o("jcfx"),O=o("Zifs"),U=o("35Q0"),H=o("p+tC"),z=o("UqVc"),Y=o("EoOi"),W=o("umUn"),V=o("T6jX"),K=o("Vm85"),X=o("8t9B"),j=o("3UhB"),q=o("oKlP"),Z=o("oKI3");m.kColorPairDistanceThreshold=10,y.gvar(m,"BACKING_SHAPES_BASIC",(function(){return U.ShapeLibrary.NonSvgBackingShapeIDs})),y.gvar(m,"BACKING_SHAPES_SVG",(function(){return U.ShapeLibrary.BrowsableBackingShapes})),y.gvar(m,"ALLOWED_BACKING_VALUES",(function(){return m.BACKING_SHAPES_BASIC.concat(m.BACKING_SHAPES_SVG)})),y.gvar(m,"BACKING_COUNT_SCALE",(function(){return y.toDouble(m.ALLOWED_BACKING_VALUES.length)})),y.gvar(m,"ALLOWED_LAYOUT_VALUES",(function(){return["left","right","center","fill"]})),y.gvar(m,"LAYOUT_COUNT_SCALE",(function(){return y.toDouble(m.ALLOWED_LAYOUT_VALUES.length)})),y.gvar(m,"ALLOWED_OPACITY_VALUES",(function(){return["full","mediumBacking","faintBacking","medium","faint"]})),y.gvar(m,"OPACITY_COUNT_SCALE",(function(){return y.toDouble(m.ALLOWED_OPACITY_VALUES.length)})),y.gvar(m,"ALLOWED_SHADOWANGLE_VALUES",(function(){return[45,135,225,315]})),y.gvar(m,"SHADOWANGLE_COUNT_SCALE",(function(){return y.toDouble(m.ALLOWED_SHADOWANGLE_VALUES.length)})),y.gvar(m,"ALLOWED_PADDING_VALUES",(function(){return[0,.33,.66,1]})),y.gvar(m,"PADDING_COUNT_SCALE",(function(){return y.toDouble(m.ALLOWED_PADDING_VALUES.length)})),y.gvar(m,"ALLOWED_SPACING_VALUES",(function(){return[0,.5,1]})),y.gvar(m,"SPACING_COUNT_SCALE",(function(){return y.toDouble(m.ALLOWED_SPACING_VALUES.length)})),y.gvar(m,"ALLOWED_TRACKING_VALUES",(function(){return[-.1,0,.5]})),m.LockupStyleAttributes=(n=function(){this.font=0,this.layout="fill",this.backing="none",this.textOpacity=w.FormaStyle.OPACITY_DEFAULT,this.backingOpacity=w.FormaStyle.OPACITY_DEFAULT,this.primaryColor="themeColor0",this.secondaryColor="themeColor1",this.borderColor="themeColor1",this.shadowColor="themeColor1",this.shadowAngle=135,this.spacing=.35,this.tracking=0,this.relativeFontScale=E.LockupStyle.DEFAULT_RELATIVE_FONT_SCALE,this.padding=.35,this.textLook="fill",this.shadowOffset=E.LockupStyle.DEFAULT_SHADOWOFFSET,this.strokeWeight=E.LockupStyle.DEFAULT_STROKEWEIGHT,this.wheelUsed=!1},y.defineClass({name:"LockupStyleAttributes",ctor:n,props:{clone:function(){var e=new n;return e.font=this.font,e.layout=this.layout,e.backing=this.backing,e.textOpacity=this.textOpacity,e.backingOpacity=this.backingOpacity,e.primaryColor=this.primaryColor,e.secondaryColor=this.secondaryColor,e.borderColor=this.borderColor,e.shadowColor=this.shadowColor,e.shadowAngle=this.shadowAngle,e.spacing=this.spacing,e.tracking=this.tracking,e.relativeFontScale=this.relativeFontScale,e.padding=this.padding,e.textLook=this.textLook,e.shadowOffset=this.shadowOffset,e.strokeWeight=this.strokeWeight,e.wheelUsed=this.wheelUsed,e}}}),n),m.getFontPairingMatrix=function(e){for(var t={},o=e.count,n=y.iter(y.range(0,o,!1));!n.done;n.next()){for(var r=n.value,i=e.fontAt(r),a=i.postScriptName,l={},s=y.iter(y.range(0,o,!1));!s.done;s.next()){var u=s.value,c=e.fontAt(u),h=c.postScriptName,d=r==u,g=1;g+=1+y.toDouble(10-G.MathUtils.absInt(i.formality-c.formality)),g+=1+y.toDouble(10-G.MathUtils.absInt(i.width-c.width)),g+=1+y.toDouble(G.MathUtils.absInt(i.blackness-c.blackness));var p=y.toDouble(i.drama-c.drama);g+=p,p<-1&&(g*=.1),i.square==c.square&&(g*=2),i.geometric==c.geometric&&(g*=2),i.italic==c.italic&&(g*=2),i.handdrawn&&c.handdrawn&&(g*=2);var f=i.slab&&c.slab,m=0==(i.slab||c.slab);f&&(g*=2);var v=i.serif&&c.serif;v&&m&&(g*=2),0==(i.serif||c.serif)&&(g*=2),v&&i.slab!=c.slab&&(g*=0);var S=i.decorative&&c.decorative;0==d&&S&&(g*=0),i.calligraphic&&c.calligraphic&&0==d&&(g*=0),l[h]=g}t[a]=y.clone(l)}return t},m.getFontPairScore=function(e,t,o){var n,r;if((n=e[t])&&null!=(r=n[o]))return r;return 0},m.hasSufficientLegibilityContrast=function(e,t){return e.contrasts(t,!1)},m.needsContrastingColor=function(e,t,o){return t!=E.LockupTextLook.Fill&&t!=E.LockupTextLook.KnockoutOnly||o},m.getTextOpacity=function(e){return e.textOpacity},m.getBackingOpacity=function(e){return e.backingOpacity},m.getTextLook=function(e){var t;switch(e.textLook){case"fill":t=E.LockupTextLook.Fill;break;case"knockoutOnly":t=E.LockupTextLook.KnockoutOnly;break;case"knockoutAndOutline":t=E.LockupTextLook.KnockoutAndOutline;break;case"outlineOnly":t=E.LockupTextLook.OutlineOnly;break;case"fillAndOutline":t=E.LockupTextLook.FillAndOutline;break;case"fillAndOutline2":t=E.LockupTextLook.FillAndOutline2;break;case"shadow":t=E.LockupTextLook.Shadow;break;case"shadowAndOutline":t=E.LockupTextLook.ShadowAndOutline;break;case"knockoutAndShadow":t=E.LockupTextLook.KnockoutAndShadow;break;case"shadowOutlineTransparentText":t=E.LockupTextLook.ShadowOutlineTransparentText;break;case"knockoutShadowOutline":t=E.LockupTextLook.KnockoutShadowOutline;break;default:t=E.LockupTextLook.Fill}return t},m.changeBorderAndShadowToSecondary=function(e){e.borderColor=e.secondaryColor,e.shadowColor=e.secondaryColor},m.InterestingLockupData=(r=function(e){var t,o,n,r,i,a,l,s,u,c,h,d,g,p,f,v,S,C,T,A,F,k,L;(F=y.as(e.style,E.LockupStyle))&&(d=m.lockupStyleToLockupStyleAttributes(F,e.page.document),c=y.opt(F.font,(function(e){return e.fontData.postScriptName})),(k=y.as(e.controller,X.TypeLockupController))&&(h=k.getCurrentFontSize()),A=m.lockupStyleToLockupStyleAttributes(F,e.page.document).backing),(k=y.as(e.controller,X.TypeLockupController))&&((L=k.size)&&(C=L.width,T=L.height,g=y.toDouble(L.width/L.height)),p=y.clone(e.totalPlacement.transformPoints(e.bounds.points)),f=k.text.length,v=k.text,S=k.wordCount()),this.id=e.formaID,this.width=(t=C)||null!=t?t:100,this.height=(o=T)||null!=o?o:100,this.font=(n=c)||null!=n?n:"BebasNeue",this.lineHeight=(r=h)||null!=r?r:1,this.styleAttributes=d||new m.LockupStyleAttributes,this.aspectRatio=(i=g)||null!=i?i:1,this.pts=y.clone(p||[]),this.wordCount=(a=S)||null!=a?a:1,this.charCount=(l=f)||null!=l?l:1,this.originalBacking=(s=A)||null!=s?s:"",this.lockupString=(u=v)||null!=u?u:""},y.defineClass({name:"InterestingLockupData",ctor:r}),r),m.InterestingPageData=(i=function(e){this.colorsBehindSelectedLockup=[],this.numImages=0,this.shapeCount=0,this.selectedLockup=new m.InterestingLockupData(e);var t=this.selectedLockup,o=[this.selectedLockup],n=10,r=1e3,i=1e3;if(e.page.hasRoot()){var a,l;r=e.page.pageSize.width,i=e.page.pageSize.height,(a=y.as(e.controller,X.TypeLockupController))&&(this.colorsBehindSelectedLockup=y.clone(a.getBackgroundColors()),n=a.getBackgroundLightnessSpread(this.colorsBehindSelectedLockup),this.shapeCount=a.shapeCount()),0==this.colorsBehindSelectedLockup.length&&(l=e.page.root.style.colors.fieldPrimary)&&this.colorsBehindSelectedLockup.push(l);for(var s=y.clone(e.page.root.filterWithCallback((function(e){return e.isTypeLockup()}))),u=y.iter(s);!u.done;u.next())if((e=u.value).formaID!=this.selectedLockup.id){var c=new m.InterestingLockupData(e);c.lineHeight>t.lineHeight&&(t=c),o.push(c)}}this.height=i,this.width=r,this.numImages=e.root.filterWithCallback((function(e){return e.isBackgroundImage()})).length,this.lockups=y.clone(o),this.largestLineHeightLockup=t,0==this.colorsBehindSelectedLockup.length&&this.colorsBehindSelectedLockup.push(O.SolidColor.BLACK),this.lightnessSpreadBehindSelectedLockup=n},y.defineClass({name:"InterestingPageData",ctor:i,props:{isColorVisibleAgainstBackground:function(e){for(var t=y.iter(this.colorsBehindSelectedLockup);!t.done;t.next()){var o=t.value;if(!m.hasSufficientLegibilityContrast(e,o))return!1}return!0},ensureCorrectBackgroundColors:function(e){var t,o,n=[];(t=y.as(e.controller,X.TypeLockupController))&&(n=y.clone(t.getBackgroundColors())),0==n.length&&(o=e.page.root.style.colors.fieldPrimary)&&n.push(o),n.length>0&&(this.colorsBehindSelectedLockup=y.clone(n))}}}),i),m.getBackingStringForBackingEnumAndArtworkId=function(e,t){var o="none";switch(e){case 0:o="none";break;case 2:o="row";break;case 9:o="bannerHorizontal";break;case 8:o="bannerVertical";break;case 11:o="knockout";break;case 4:o="none";break;default:null!=t&&(o=t)}return o},m.getBackingEnumAndArtworkIdForBackingString=function(e){var t,o=null;switch(e){case"none":t=E.LockupBacking.None;break;case"row":t=E.LockupBacking.Rows;break;case"bannerHorizontal":t=E.LockupBacking.BannerHorizontal;break;case"bannerVertical":t=E.LockupBacking.BannerVertical;break;case"knockout":t=E.LockupBacking.Knockout;break;default:t=E.LockupBacking.SVGBackground,o=e}return{backing:t,artworkID:o}},m.lockupStyleToLockupStyleAttributes=function(e,t){var o,n=new m.LockupStyleAttributes,r=D.Host.fontProvider.getIncludedFonts(t);n.shadowAngle=e.shadowAngle;var i,a,l,s,u,c,h=-1;(i=e.font)&&(h=(o=r.indexOf(i.fontData))||null!=o?o:-1),n.font=h,n.spacing=e.spacing,n.tracking=e.tracking,n.padding=e.padding,n.textLook=e.textLookAsString,n.shadowOffset=e.shadowOffset,n.strokeWeight=e.strokeWeight,null!=(a=e.colors.colorID(b.ColorRole.FieldPrimary))&&(n.primaryColor=a),null!=(l=e.colors.colorID(b.ColorRole.FieldSecondary))&&(n.secondaryColor=l),null!=(s=e.colors.colorID(b.ColorRole.Border))&&(n.borderColor=s),null!=(u=e.colors.colorID(b.ColorRole.Shadow))&&(n.shadowColor=u),n.textOpacity=e.textOpacity,n.backingOpacity=e.backingOpacity;var d=e.layout;if(E.LockupStyle.isLetterGrid(d)||d==E.LockupLayout.Standard){var g=E.LockupStyle.isLetterGrid(d)?"letter-grid-":"";switch(e.alignment){case 0:c=g+"left";break;case 1:c=g+"right";break;case 2:c=g+"center";break;default:P.LegacyCoreAssert.fail("Unexpected alignment",{alignment:e.alignment},"lockupStyleToLockupStyleAttributes","LockupStyleController.swift",638),c=g+"left"}}else if(E.LockupStyle.isAutoLayout(d)){c="auto"+e.alignment}else if(E.LockupStyle.isPath(d)){c="path"+e.pathID}else c="fill";return n.layout=c,n.backing=m.getBackingStringForBackingEnumAndArtworkId(e.backing,e.backingArtworkID),n.wheelUsed=e.wheelUsed,n},m.lockupStyleAttributesToLockupStyle=function(e,t,o){var n,r,i,a=null,l=e.font;(P.LegacyCoreAssert.isTrue(l>-1,"lockupStyleAttributesToLockupStyle called with no font. It is valid for a character style to have no font but this function doesn't work for character styles ",void 0,"lockupStyleAttributesToLockupStyle","LockupStyleController.swift",680),l>-1)&&((i=D.Host.fontProvider.getIncludedFonts(o).fontAt(l))&&(a=j.TypeLockupUtils.createTheoFont(i,D.Host.brandkitManager.brandkitForDocument(o))));var s,u,c,h=b.ColorTable.init_25f6([{key:b.ColorRole.FieldPrimary,value:e.primaryColor},{key:b.ColorRole.FieldSecondary,value:e.secondaryColor},{key:b.ColorRole.Border,value:e.borderColor},{key:b.ColorRole.Shadow,value:e.shadowColor}]),d=E.LockupAlignment.UNSET,g=Z.TextPathID.UNSET,p=null;if(e.layout.startsWith("path"))s=E.LockupLayout.Path,null!=(u=y.toInt(e.layout.substr("path".length)))&&(g=(n=Z.TextPathID.toCaseValue(u))||null!=n?n:Z.TextPathID.UNSET)==Z.TextPathID.Custom&&(c=t.customPath)&&(p=c);else if(e.layout.startsWith("auto")){var f;s=E.LockupLayout.Auto,null!=(f=y.toInt(e.layout.substr("auto".length)))&&(d=(r=E.LockupAlignment.toCaseValue(f))||null!=r?r:E.LockupAlignment.UNSET)}else switch(e.layout){case"left":s=E.LockupLayout.Standard,d=E.LockupAlignment.Left;break;case"right":s=E.LockupLayout.Standard,d=E.LockupAlignment.Right;break;case"center":s=E.LockupLayout.Standard,d=E.LockupAlignment.Center;break;case"letter-grid-left":s=E.LockupLayout.LetterGrid,d=E.LockupAlignment.Left;break;case"letter-grid-right":s=E.LockupLayout.LetterGrid,d=E.LockupAlignment.Right;break;case"letter-grid-center":s=E.LockupLayout.LetterGrid,d=E.LockupAlignment.Center;break;case"fill":default:s=E.LockupLayout.FitJustified}var v=m.getBackingEnumAndArtworkIdForBackingString(e.backing),S=m.getTextLook(e),C=e.wheelUsed,T=e.relativeFontScale,A=E.LockupStyle.init_f3fd(e.textOpacity,e.backingOpacity,h,a,e.spacing,e.tracking,e.padding,v.backing,v.artworkID,e.shadowAngle,s,d,S,e.shadowOffset,e.strokeWeight,g,p,C,T);return A.setCharacterStyles(t.characterStyles),A},m.randomDbl=function(){return y.toDouble(F.CoreRandom.nextInt)/y.toDouble(F.CoreRandom.randMax)},m.getWeightedIndex=function(e,t){for(var o=e.length,n=t*m.randomDbl(),r=0,i=0,a=y.iter(y.range(0,o,!1));!a.done;a.next()){var l=a.value;if((r+=e[l])>=n){i=l;break}}return i},m.selectWeightedValue=function(e,t,o,n,r){var i,a=n,l=y.clone(o);return null!=(i=y.indexOf(t,e))&&o[i]>0&&(l[i]+=a*r,a+=a*r),t[m.getWeightedIndex(l,a)]},m.WeightedAttributeSelector=y.defineProtocol("WeightedAttributeSelector",{inertiaRatio:"Double",forma:"Forma",pageData:"InterestingPageData",values:"Array<TypeAlias>",weights:"Array<Double>",weightSum:"Double",scoreValue:"(TypeAlias) -> Double",updateWeights:"(InterestingPageData) -> Void",select:"(LockupStyleAttributes, Boolean, Boolean, Boolean, Boolean) -> TypeAlias"}),m.WeightedFontSelector=(a=function e(t,o){this.inertiaRatio=1,this.weights=[],this.weightSum=0,this.machineRecommend=!0;var n=this;this.forma=t,this.pageData=o,this.listOfFonts=D.Host.fontProvider.getIncludedFonts(t.page.document),this.values=y.toArray(y.range(0,this.listOfFonts.count,!1));var r=this.listOfFonts.revisionNumber,i=this.listOfFonts.fontSetID;r==e.cacheRevisionNumber&&i==e.cacheFontSetID?this.fontPairingMatrix=y.clone(e.fontPairingMatrixCache):(this.fontPairingMatrix={},e.fontPairingMatrixCache={},y.each(m.getFontPairingMatrix(this.listOfFonts),(function(t,o){n.fontPairingMatrix[t]=y.clone(o),e.fontPairingMatrixCache[t]=y.clone(o)})),e.cacheRevisionNumber=r,e.cacheFontSetID=i)},y.defineClass({name:"WeightedFontSelector",ctor:a,statics:{cacheRevisionNumber:0,cacheFontSetID:"charlie",_implements:function(e){return"WeightedAttributeSelector"==e}},props:{updateWeights:function(e){this.pageData=e;var t=!1;if(this.values.length!=D.Host.fontProvider.getIncludedFonts(this.forma.page.document).count&&(this.listOfFonts=D.Host.fontProvider.getIncludedFonts(this.forma.page.document),this.values=y.toArray(y.range(0,this.listOfFonts.count,!1)),t=!0),this.machineRecommend){var o,n=new I.FontSuggester;(o=n.getFontFeatures(e,this.forma))?(t&&n.clearCache(),this.weights=y.clone(n.getScores(this.listOfFonts,o))):this.weights=this.values.map(this.scoreValue,this)}0!=this.machineRecommend&&1!=(new z.SuggestionUtils).weightsEqualNaNOrEmpty(this.weights)||(this.weights=this.values.map(this.scoreValue,this)),this.weightSum=this.weights.reduce((function(e,t){return e+t}),0)},getTopFonts:function(e){P.LegacyCoreAssert.isTrue(e<this.listOfFonts.count,"cannot get top fonts more than total number",void 0,"WeightedFontSelector.getTopFonts","LockupStyleController.swift",963);for(var t=[],o=y.iter(y.toSequence(this.weights));!o.done;o.next()){var n=o.value,r=n.offset,i=n.element;t.push([i,r])}t=y.sort(t,(function(e,t){return e[0]>t[0]}));for(var a=[],l=0,s=y.iter(t);!s.done;s.next()){var u=s.value;if(!(l<e))break;a.push(this.listOfFonts.fontAt(u[1])),l+=1}return a},scoreValue:function(e){return this.manuallyScoreValue(e)},manuallyScoreValue:function(e){var t=this.listOfFonts.fontAt(e),o=t.postScriptName,n=D.Host.fontProvider.descriptorForPostScriptName(o,x.ANY_DOCUMENT),r=this.pageData.selectedLockup.lineHeight;if(!D.Host.fontProvider.getSuggestableFonts(y.opt(this.forma,(function(e){return e.page.document}))).contains(t))return 0;for(var i=.1,a=y.iter(this.pageData.lockups);!a.done;a.next()){var l=a.value;if(l.id!=this.pageData.selectedLockup.id){var s=G.MathUtils.absDouble(r-l.lineHeight)/r,u=l.lineHeight>r,c=u?l.font:o,h=u?o:l.font;i+=m.getFontPairScore(this.fontPairingMatrix,c,h),o==l.font&&(i*=2,s<.5&&(i*=2))}}return i*=n.popularity,j.TypeLockupUtils.createTheoFont(t,D.Host.brandkitManager.brandkitForDocument(this.forma.page.document)).isSparkFont()&&(i*=2),r<40&&0==n.bodyAllowed&&(i=0),r>150&&0==n.displayAllowed&&(i=0),i},select:function(e,t,o,n,r){void 0===n&&(n=!1),void 0===r&&(r=!0);var i=e.font,a=o?this.inertiaRatio:0;return m.selectWeightedValue(i,this.values,this.weights,this.weightSum,a)}}}),a),m.WeightedLayoutSelector=(l=function(e,t){this.inertiaRatio=0,this.values=m.ALLOWED_LAYOUT_VALUES,this.weights=[],this.weightSum=0,this.forma=e,this.pageData=t},y.defineClass({name:"WeightedLayoutSelector",ctor:l,statics:{_implements:function(e){return"WeightedAttributeSelector"==e}},props:{updateWeights:function(e){this.pageData=e,this.weights=this.values.map(this.scoreValue,this),this.weightSum=this.weights.reduce((function(e,t){return e+t}),0)},scoreValue:function(e){var t=1,o=this.pageData.selectedLockup.aspectRatio,n=this.pageData.selectedLockup.wordCount,r=this.pageData.selectedLockup.id;"left"!=e&&"right"!=e||(n<=1||o>4?t=0:t*=.05),0==this.pageData.lockups.length&&("fill"==e&&(t*=5),"center"==e&&(t*=4)),"fill"==e&&this.pageData.selectedLockup.wordCount>10&&(t*=4/y.toDouble(this.pageData.selectedLockup.wordCount));var i=[];V.TheoDocumentUtils.enableFastHeuristicsForComplexPage(this.forma.page)||(i=y.clone(v.AlignmentDetector.init_a00d(this.forma).detectFormaAlignments(20)));for(var a=!1,l=!1,s=y.iter(i);!s.done;s.next()){var u=s.value;u.line.type==v.AlignmentType.Left&&(a=!0),u.line.type==v.AlignmentType.Right&&(l=!0)}a&&!l&&"left"==e&&(t=2.5),l&&!a&&"right"==e&&(t=2.5);for(var c=y.iter(this.pageData.lockups);!c.done;c.next()){var h=c.value;h.id!=r&&e==h.styleAttributes.layout&&(t*=m.LAYOUT_COUNT_SCALE/2)}return t},select:function(e,t,o,n,r){void 0===n&&(n=!1),void 0===r&&(r=!0);var i=e.layout,a=o?this.inertiaRatio:0;return m.selectWeightedValue(i,this.values,this.weights,this.weightSum,a)}}}),l),m.WeightedBackingSelector=(s=function(e,t){this.inertiaRatio=1,this.values=m.ALLOWED_BACKING_VALUES,this.weights=[],this.weightSum=0,this.machineRecommend=!0,this.forma=e,this.pageData=t},y.defineClass({name:"WeightedBackingSelector",ctor:s,statics:{_implements:function(e){return"WeightedAttributeSelector"==e}},props:{updateWeights:function(e){if(this.pageData=e,C.CoreAssertDebugOnly.isTrue(null!=this.forma,"nil forma in WeightedBackingSelector.updateWeights",void 0,"WeightedBackingSelector.updateWeights","LockupStyleController.swift",1301),1==this.machineRecommend&&null!=this.forma){var t=new H.ShapeSuggester,o=y.clone(t.getShapeSuggesterFeatures(e,this.forma));this.weights=y.clone(t.getScores(this.values,o))}0!=this.machineRecommend&&1!=(new z.SuggestionUtils).weightsEqualNaNOrEmpty(this.weights)||(this.weights=this.values.map(this.scoreValue,this)),this.weightSum=this.weights.reduce((function(e,t){return e+t}),0)},scoreValue:function(e){var t=this.pageData.selectedLockup,o=this.pageData.largestLineHeightLockup,n=t.lineHeight,r=o.id==t.id,i=U.ShapeLibrary.shapeDictionary[e]||U.ShapeLibrary.shapeDictionary.none,a=1;if(i.premium)return 0;if(U.ShapeLibrary.NonSuggestableBackingShapes.includes(e))return 0;this.pageData.lockups.length>0&&m.BACKING_SHAPES_SVG.includes(e)&&(a*=.1);for(var l=y.iter(this.pageData.lockups);!l.done;l.next()){var s,u=l.value;u.id!=t.id&&(G.MathUtils.absDouble(n-u.lineHeight)/n<.4&&(a*=3),(s=U.ShapeLibrary.shapeDictionary[u.styleAttributes.backing])&&(a*=(11-y.toDouble(G.MathUtils.absInt(i.formality-s.formality)))/2,a*=(11-y.toDouble(G.MathUtils.absInt(i.drama-s.drama)))/2))}var c,h=G.MathUtils.maxDouble(t.width/this.pageData.width,t.height/this.pageData.height);if(i.maxScale<1&&h>i.maxScale&&(a=0),(i.maxAspect<t.aspectRatio||i.minAspect>t.aspectRatio)&&(a=0),0==r&&(c=U.ShapeLibrary.shapeDictionary[o.styleAttributes.backing])){var d=c.drama;i.drama<d&&(a*=2)}return"none"==e&&(a*=10),"row"==e&&(a*=10),this.pageData.lightnessSpreadBehindSelectedLockup>=20&&0==i.filled&&(a*=.01),a},select:function(e,t,o,n,r){void 0===n&&(n=!1),void 0===r&&(r=!0);var i=this.values.length,a=y.clone(this.weights),l=e.layout,s="center"==l||"fill"==l,u=!1,c=D.Host.fontProvider.getIncludedFonts(this.forma.page.document).fontAt(e.font),h=this.pageData.selectedLockup.width/this.pageData.selectedLockup.height,d=!0,g=this.pageData.selectedLockup.originalBacking;"none"!=g&&"shadow"!=g&&"row"!=g||(d=!1),"knockout"==e.backing&&(d=!1);for(var p=y.iter(this.pageData.lockups);!p.done;p.next()){var f,v=p.value,S=v.styleAttributes.backing;v.id!=this.pageData.selectedLockup.id&&("none"!=S&&(u=!0),e.font==v.styleAttributes.font&&null!=(f=y.indexOf(m.ALLOWED_BACKING_VALUES,S))&&(a[f]*=5))}for(var C=y.iter(y.range(0,i,!1));!C.done;C.next()){var T,A=C.value,F=this.values[A];if(T=U.ShapeLibrary.shapeDictionary[F]){s&&1==T.centered&&(a[A]*=5),h>4&&T.category==U.ShapeCategory.Circle&&(a[A]*=0),h<4&&T.category==U.ShapeCategory.Banner&&(a[A]*=0),T.category!=U.ShapeCategory.Cutout&&T.category!=U.ShapeCategory.Avoid||(a[A]*=0),"knockoutOnly"!=e.textLook||"none"!=F&&"shadow"!=F||(a[A]*=0);var k=y.toDouble(10-G.MathUtils.absInt(c.formality-T.formality));a[A]*=k/5;var L=y.toDouble(10-G.MathUtils.absInt(c.drama-T.drama));a[A]*=L/5,u&&"row"!=F&&"none"!=F&&(a[A]/=5)}}var b=e.backing,_=o?this.inertiaRatio:0,R=a.reduce((function(e,t){return e+t}),0);return b=1==d?m.selectWeightedValue(b,this.values,a,R,_):g}}}),s),m.WeightedShadowAngleSelector=(u=function(e,t){this.inertiaRatio=1,this.values=m.ALLOWED_SHADOWANGLE_VALUES,this.weights=[],this.weightSum=0,this.foo=4,this.forma=e,this.pageData=t},y.defineClass({name:"WeightedShadowAngleSelector",ctor:u,statics:{_implements:function(e){return"WeightedAttributeSelector"==e}},props:{updateWeights:function(e){this.pageData=e,this.weights=this.values.map(this.scoreValue,this),this.weightSum=this.weights.reduce((function(e,t){return e+t}),0)},scoreValue:function(e){return 1},select:function(e,t,o,n,r){void 0===n&&(n=!1),void 0===r&&(r=!0);var i=e.shadowAngle,a=o?this.inertiaRatio:0;return m.selectWeightedValue(i,this.values,this.weights,this.weightSum,a)}}}),u),m.WeightedPaddingSelector=(c=function(e,t){this.inertiaRatio=1,this.values=m.ALLOWED_PADDING_VALUES,this.weights=[],this.weightSum=0,this.forma=e,this.pageData=t},y.defineClass({name:"WeightedPaddingSelector",ctor:c,statics:{_implements:function(e){return"WeightedAttributeSelector"==e}},props:{updateWeights:function(e){this.pageData=e,this.weights=this.values.map(this.scoreValue,this),this.weightSum=this.weights.reduce((function(e,t){return e+t}),0)},scoreValue:function(e){var t=this.pageData.selectedLockup,o=1,n=1;if(0==this.pageData.lockups.length)n=G.MathUtils.absDouble(e-E.LockupStyle.DEFAULT_PADDING);else for(var r=y.iter(this.pageData.lockups);!r.done;r.next()){var i=r.value;n=G.MathUtils.minDouble(n,G.MathUtils.absDouble(e-i.styleAttributes.padding))}o*=G.MathUtils.maxDouble(1/(n+.1),.05);var a=G.MathUtils.maxDouble(t.width/this.pageData.width,t.height/this.pageData.height)+e;return o/=4*G.MathUtils.absDouble(a-1)},select:function(e,t,o,n,r){void 0===n&&(n=!1),void 0===r&&(r=!0);var i=e.padding,a=o?this.inertiaRatio:0;return m.selectWeightedValue(i,this.values,this.weights,this.weightSum,a)}}}),c),m.WeightedSpacingSelector=(h=function(e,t){this.inertiaRatio=1,this.values=m.ALLOWED_SPACING_VALUES,this.weights=[],this.weightSum=0,this.forma=e,this.pageData=t},y.defineClass({name:"WeightedSpacingSelector",ctor:h,statics:{_implements:function(e){return"WeightedAttributeSelector"==e}},props:{updateWeights:function(e){this.pageData=e,this.weights=this.values.map(this.scoreValue,this),this.weightSum=this.weights.reduce((function(e,t){return e+t}),0)},scoreValue:function(e){var t=1,o=1;if(0==this.pageData.lockups.length)o=G.MathUtils.absDouble(e-E.LockupStyle.DEFAULT_SPACING);else for(var n=y.iter(this.pageData.lockups);!n.done;n.next()){var r=n.value;o=G.MathUtils.minDouble(o,G.MathUtils.absDouble(e-r.styleAttributes.spacing))}return t*=G.MathUtils.maxDouble(1/(o+.1),.05)},select:function(e,t,o,n,r){void 0===n&&(n=!1),void 0===r&&(r=!0);var i=e.spacing,a=o?this.inertiaRatio:0;return m.selectWeightedValue(i,this.values,this.weights,this.weightSum,a)}}}),h),m.PrimaryColorSelector=(d=function e(t,o){this.inertiaRatio=1,this.weights=[],this.weightSum=0,this.forma=t,this.pageData=o,this.values=y.clone(e.updateColorValues(t))},y.defineClass({name:"PrimaryColorSelector",ctor:d,statics:{updateColorValues:function(e){var t;return(t=e)?t.page.colorLibraryController.getThemeColorKeys().concat(T.ColorLibraryController.THEME_DERIVED_BW_KEYS).concat(t.page.colorLibraryController.getProfilingColorKeys()):[]},_implements:function(e){return"WeightedAttributeSelector"==e}},props:{updateWeights:function(e){this.pageData=e,this.values=y.clone(d.updateColorValues(this.forma)),this.weights=this.values.map(this.scoreValue,this),this.weightSum=this.weights.reduce((function(e,t){return e+t}),0)},scoreValue:function(e){return"themeDerivedDark"==e?.1:1},select:function(e,t,o,n,r){void 0===n&&(n=!1),void 0===r&&(r=!0);var i=(U.ShapeLibrary.shapeDictionary[e.backing]||U.ShapeLibrary.shapeDictionary.none).filled||"fill"!=e.textLook;this.updateWeights(this.pageData);for(var a=this.values.length,l=e.primaryColor,s=y.clone(this.weights),u=new k.ColorRankSuggester,c=[],h=y.iter(y.range(0,a,!1));!h.done;h.next()){var d,g=h.value;(d=this.forma.page.colorLibraryController.getSolidColorForKey(this.values[g]))&&c.push(d)}if(P.LegacyCoreAssert.isTrue(a==c.length,"not all value colors were added.",void 0,"PrimaryColorSelector.select","LockupStyleController.swift",1932),a!=c.length)return l;var p=[];if(0==i){this.pageData.ensureCorrectBackgroundColors(this.forma);for(var f=y.iter(this.pageData.colorsBehindSelectedLockup);!f.done;f.next()){var v=f.value;p.push(k.ColorForComparison.init_c063(v,1))}}else{var S;(S=this.forma.page.colorLibraryController.getSolidColorForKey(e.secondaryColor))&&p.push(k.ColorForComparison.init_c063(S,1))}n&&(S=this.forma.page.colorLibraryController.getSolidColorForKey(e.primaryColor))&&p.push(k.ColorForComparison.init_c063(S,.33)),s=y.clone(u.weightedColorContrastRanker(p,c,r));var C=(s=y.clone((new z.SuggestionUtils).normalizedWeights(s))).reduce((function(e,t){return e+t}),0),T=o?this.inertiaRatio:0;return m.selectWeightedValue(l,this.values,s,C,T)}}}),d),m.SecondaryColorSelector=(g=function e(t,o){this.inertiaRatio=0,this.weights=[],this.weightSum=0,this.forma=t,this.pageData=o,this.values=y.clone(e.updateColorValues(t))},y.defineClass({name:"SecondaryColorSelector",ctor:g,statics:{updateColorValues:function(e){var t,o=[];if(t=e)for(var n=t.page.colorLibraryController.getThemeColorKeys().concat(T.ColorLibraryController.THEME_DERIVED_BW_KEYS),r=y.iter(n);!r.done;r.next()){var i=r.value;null!=t.page.colorLibraryController.getSolidColorForKey(i)?o.push(i):C.CoreAssertDebugOnly.fail("library has missing color",{key:i},"SecondaryColorSelector.updateColorValues","LockupStyleController.swift",2018)}return o},_implements:function(e){return"WeightedAttributeSelector"==e}},props:{updateWeights:function(e){this.pageData=e,this.values=y.clone(g.updateColorValues(this.forma)),this.weights=this.values.map(this.scoreValue,this),this.weightSum=this.weights.reduce((function(e,t){return e+t}),0)},scoreValue:function(e){return 1},select:function(e,t,o,n,r){void 0===n&&(n=!1),void 0===r&&(r=!0);var i=e.secondaryColor,a=(U.ShapeLibrary.shapeDictionary[e.backing]||U.ShapeLibrary.shapeDictionary.none).filled;this.updateWeights(this.pageData);for(var l=this.values.length,s=y.clone(this.weights),u=new k.ColorRankSuggester,c=[],h=y.iter(y.range(0,l,!1));!h.done;h.next()){var d,g=h.value;(d=this.forma.page.colorLibraryController.getSolidColorForKey(this.values[g]))?c.push(d):C.CoreAssertDebugOnly.fail("failed to get SolidColor",{key:this.values[g],colorCount:l,numColorKeys:this.forma.page.colorLibraryController.getNumThemeColorKeys()},"SecondaryColorSelector.select","LockupStyleController.swift",2066)}if(P.LegacyCoreAssert.isTrue(l==c.length,"not all value colors were added.",void 0,"SecondaryColorSelector.select","LockupStyleController.swift",2073),l!=c.length)return i;var p=[];if(n&&a){var f;(f=this.forma.page.colorLibraryController.getSolidColorForKey(e.secondaryColor))&&p.push(k.ColorForComparison.init_c063(f,1))}else{this.pageData.ensureCorrectBackgroundColors(this.forma);for(var v=y.iter(this.pageData.colorsBehindSelectedLockup);!v.done;v.next()){var S=v.value;p.push(k.ColorForComparison.init_c063(S,1))}}s=y.clone(u.weightedColorContrastRanker(p,c,r));var T=(s=y.clone((new z.SuggestionUtils).normalizedWeights(s))).reduce((function(e,t){return e+t}),0),A=o?this.inertiaRatio:0;return m.selectWeightedValue(i,this.values,s,T,A)}}}),g),m.LockupStyleController=(p=function(e){this._sessionAttrs=new m.SessionAttrs,this.hasScoresForAttributes=!1,this.forma=e,this.targetedLockupStyleName_="",this.pageData=new m.InterestingPageData(e),this.fontSelector=new m.WeightedFontSelector(e,this.pageData),this.layoutSelector=new m.WeightedLayoutSelector(e,this.pageData),this.backingSelector=new m.WeightedBackingSelector(e,this.pageData),this.primaryColorSelector=new m.PrimaryColorSelector(e,this.pageData),this.profilingBackgroundColorSelector=new L.ProfilingBackgroundColorSelector(e,!0),this.profilingPrimaryColorSelector=new L.ProfilingPrimaryColorSelector(e,!1),this.secondaryColorSelector=new m.SecondaryColorSelector(e,this.pageData),this.shadowAngleSelector=new m.WeightedShadowAngleSelector(e,this.pageData),this.spacingSelector=new m.WeightedSpacingSelector(e,this.pageData),this.paddingSelector=new m.WeightedPaddingSelector(e,this.pageData),A.CoreObject.call(this)},y.defineClass({name:"LockupStyleController",ctor:p,superName:"CoreObject",props:{targetedLockupStyleName:{get:function(){var e;return((e=y.opt(y.opt(y.opt(this.forma,(function(e){return e.page.document})),(function(e){return e.controller})),(function(e){return e.selection.inCharStyleMode})))||null!=e)&&e?X.TypeLockupController.HIGHLIGHT_STYLE:""}},targetedLockupStyle:{get:function(){return""!=this.targetedLockupStyleName?this.forma.controller.getCharacterStyle(this.targetedLockupStyleName):this.forma.style}},targetedFont:{get:function(){var e;return(e=this.targetedLockupStyle.font)?e:this.forma.style.font}},targetedShadowAngle:{get:function(){return this.forma.style.shadowAngle},set:function(e){this.forma.style.shadowAngle=e}},targetedShadowOffset:{get:function(){return this.forma.style.shadowOffset},set:function(e){this.forma.style.shadowOffset=e}},targetedStrokeWeight:{get:function(){return this.forma.style.strokeWeight},set:function(e){this.forma.style.strokeWeight=e}},targetedTextLook:{get:function(){return this.targetedLockupStyle.textLook!=E.LockupTextLook.UNSET?this.targetedLockupStyle.textLook:this.forma.style.textLook}},updateScoring:function(){this.pageData=new m.InterestingPageData(this.forma),this.fontSelector.updateWeights(this.pageData),this.layoutSelector.updateWeights(this.pageData),this.backingSelector.updateWeights(this.pageData),this.primaryColorSelector.updateWeights(this.pageData),this.secondaryColorSelector.updateWeights(this.pageData),this.shadowAngleSelector.updateWeights(this.pageData),this.spacingSelector.updateWeights(this.pageData),this.paddingSelector.updateWeights(this.pageData),this.profilingPrimaryColorSelector.updateBackgroundColors(this.pageData.colorsBehindSelectedLockup),this.profilingBackgroundColorSelector.updateBackgroundColors(this.pageData.colorsBehindSelectedLockup),this.hasScoresForAttributes=!0},getRecommendedFonts:function(){return this.fontSelector.getTopFonts(10)},onlineLearning:function(e){var t,o=new I.FontSuggester;(t=o.getFontFeatures(this.pageData,this.forma))&&o.onlineLearning(e,t)},fixUpColors:function(){var e;if((e=y.as(this.forma.controller,X.TypeLockupController))&&e.secondaryColorVisible()&&this.targetedLockupStyle.textBacked&&this.targetedLockupStyle.backing!=E.LockupBacking.UNSET){var t=this.targetedLockupStyle.colors.colorID(b.ColorRole.FieldPrimary),o=this.targetedLockupStyle.colors.colorID(b.ColorRole.FieldSecondary),n=this.calculateContrastingSecondaryColorID();null!=n&&n!=o&&n!=t&&null!=this.forma.page.colorLibraryController.getSolidColorForKey(n)&&(o=n),j.TypeLockupUtils.fixUpColors(this.targetedLockupStyle,o)}},calculateContrastingSecondaryColorID:function(){var e,t=this.targetedLockupStyle.colors.colorID(b.ColorRole.FieldPrimary),o=this.targetedLockupStyle.colors.colorID(b.ColorRole.FieldSecondary);if(null!=t&&t==o&&(e=this.forma.page.colorLibraryController.getSolidColorForKey(t)))for(var n=y.iter(this.forma.page.colorLibraryController.getThemeColorKeys().concat(T.ColorLibraryController.THEME_DERIVED_BW_KEYS));!n.done;n.next()){var r,i=n.value;if(i!=t&&(r=this.forma.page.colorLibraryController.getSolidColorForKey(i))&&r.contrasts(e,!1)){o=i;break}}return o},fixUpBackingShape:function(){var e,t,o=this.forma.style;if((e=U.ShapeLibrary.shapeDictionary[m.getBackingStringForBackingEnumAndArtworkId(o.backing,o.backingArtworkID)])&&(t=U.ShapeLibrary.shapeDictionary[m.getBackingStringForBackingEnumAndArtworkId(this.targetedLockupStyle.backing,this.targetedLockupStyle.backingArtworkID)])){if(E.LockupStyle.isKnockoutLook(this.targetedLockupStyle.textLook)){(this.targetedLockupStyle===this.forma.style?e.filled:E.LockupStyle.isLetterGrid(o.layout)?(this.targetedLockupStyle.backing!=E.LockupBacking.None?t:e).filled:e.filled||t.filled)||(y.opt(y.as(this.forma.controller,X.TypeLockupController),(function(e){return e.beginBlockedUpdate()})),this.targetedLockupStyle.backing=E.LockupBacking.SVGBackground,this.targetedLockupStyle.backingArtworkID="square_001",y.opt(y.as(this.forma.controller,X.TypeLockupController),(function(e){return e.endBlockedUpdate()})),y.opt(y.as(this.forma.controller,X.TypeLockupController),(function(e){return e.styleChanged()})))}!t.filled||this.targetedLockupStyle.textLook!=E.LockupTextLook.Shadow&&this.targetedLockupStyle.textLook!=E.LockupTextLook.ShadowAndOutline&&this.targetedLockupStyle.textLook!=E.LockupTextLook.FillAndOutline&&this.targetedLockupStyle.textLook!=E.LockupTextLook.FillAndOutline2&&this.targetedLockupStyle.textLook!=E.LockupTextLook.OutlineOnly||1!=this.targetedLockupStyle.backingOpacity||(this.targetedLockupStyle.backingOpacity=.5)}},getKnockoutColor:function(){var e,t,o=this.forma.style;return this.targetedLockupStyle!==this.forma.style&&(e=U.ShapeLibrary.shapeDictionary[m.getBackingStringForBackingEnumAndArtworkId(o.backing,o.backingArtworkID)])&&(t=U.ShapeLibrary.shapeDictionary[m.getBackingStringForBackingEnumAndArtworkId(this.targetedLockupStyle.backing,this.targetedLockupStyle.backingArtworkID)])&&(t.filled||!e.filled)?this.targetedLockupStyle.colors.fieldSecondary:o.colors.fieldSecondary},getTextLookForUI:function(){return this.targetedTextLook==E.LockupTextLook.FillAndOutline2||this.targetedTextLook==E.LockupTextLook.OutlineOnly?E.LockupTextLook.FillAndOutline:this.targetedTextLook},getStrokeWeightPercentForUI:function(){return 99*this.targetedStrokeWeight+1},getShadowOffsetPercentForUI:function(){return 99*this.targetedShadowOffset+1},setTextLook:function(e,t){void 0===t&&(t=!0),this.targetedLockupStyle!==this.forma.style&&e==this.forma.style.textLook?this.targetedLockupStyle.textLook=E.LockupTextLook.UNSET:(this.targetedLockupStyle.textLook=e,t&&(this.targetedLockupStyle.textLook==E.LockupTextLook.KnockoutAndShadow&&(135==this.targetedShadowAngle&&225==this.targetedShadowAngle||(this.targetedShadowAngle=135)),this.targetedLockupStyle.textLook==E.LockupTextLook.ShadowAndOutline?this.targetedShadowOffset=E.LockupStyle.DEFAULT_SHADOWOFFSET/2:this.targetedShadowOffset=E.LockupStyle.DEFAULT_SHADOWOFFSET,this.targetedLockupStyle.textLook==E.LockupTextLook.KnockoutAndOutline?this.targetedStrokeWeight=0:this.targetedStrokeWeight=E.LockupStyle.DEFAULT_STROKEWEIGHT)),this.fixUpColors(),this.fixUpBackingShape(),this.forma.controller.styleChanged()},applyBacking:function(e,t){var o,n,r,i,a,l;if((o=this.forma)&&(n=o.parent)&&(r=o.root)&&(i=o.page.document)&&(a=y.as(o.style,E.LockupStyle))&&(l=y.as(o.controller,X.TypeLockupController))){l.beginBlockedUpdate();var s=m.getBackingStringForBackingEnumAndArtworkId(e,t);S.BadgeFacade.logBackingShapeChange(o.source,s);var u,c=m.lockupStyleToLockupStyleAttributes(this.targetedLockupStyle,i),h=!1,d=!1,g=this.targetedLockupStyle.textLook;if(e==E.LockupBacking.Knockout){E.LockupStyle.isKnockoutLook(g)||(g=E.LockupTextLook.KnockoutOnly,c.textLook="knockoutOnly"),r.visitAll(_.FormaTraversal.PreOrder,(function(e){var t;(t=y.as(e.style,E.LockupStyle))&&t.backing==E.LockupBacking.Knockout&&(t.backing=E.LockupBacking.None,t.textLook=E.LockupTextLook.Fill)}));var p=y.clone(n.filterWithCallback((function(e){return(e.isBackgroundImage()||e.isShape())&&y.opt(e.controller,(function(e){return 0==e.floating}))}),_.FormaTraversal.JustChildren));n.insertChildAt(o,p.length)}this.targetedLockupStyle!==a&&((D=this.targetedLockupStyle).backing==E.LockupBacking.UNSET&&(P.LegacyCoreAssert.isTrue(E.LockupStyle.isLetterGrid(a.layout),"LockupBacking.UNSET in secondary styles for non-letter-grid layouts?",void 0,"LockupStyleController.applyBacking","LockupStyleController.swift",2552),D.padding=a.padding),e==E.LockupBacking.None||e==E.LockupBacking.Rows||e==E.LockupBacking.SVGBackground?(D.backing=e,D.backingArtworkID=t):e==E.LockupBacking.Knockout&&(D.backing=E.LockupBacking.UNSET,g=E.LockupTextLook.KnockoutOnly),c=m.lockupStyleToLockupStyleAttributes(D,i),s=m.getBackingStringForBackingEnumAndArtworkId(D.backing,D.backingArtworkID),g=D.textLook),c.backing!=s&&(u=U.ShapeLibrary.shapeDictionary[s])&&c.secondaryColor==c.borderColor&&c.secondaryColor==c.shadowColor&&(h=m.needsContrastingColor(s,g,u.filled),u.filled||g==E.LockupTextLook.FillAndOutline||g==E.LockupTextLook.FillAndOutline2||(d=!0)),c.backing=s;var f=this.cloneOpacityAttributes(c);if(h&&(L=o.page.colorLibraryController.getSolidColorForKey(c.secondaryColor))&&(k=o.page.colorLibraryController.getSolidColorForKey(c.primaryColor))){var v=m.getBackingOpacity(c);v==w.FormaStyle.OPACITY_UNSET&&(v=m.getBackingOpacity(m.lockupStyleToLockupStyleAttributes(a,i)));for(var C=!0,T=y.iter(this.pageData.colorsBehindSelectedLockup);!T.done;T.next()){var A=T.value.blend(L,v);if(!m.hasSufficientLegibilityContrast(k,A)){C=!1;break}}if(!C){var F=this.getContrastingColorKey(c.secondaryColor,c.primaryColor);f.secondaryColor=F,c.secondaryColor==c.borderColor&&c.secondaryColor==c.shadowColor&&m.changeBorderAndShadowToSecondary(f)}}if(d){var k,L,b,R=c.primaryColor,I=c.secondaryColor;(k=o.page.colorLibraryController.getSolidColorForKey(R))&&(this.pageData.isColorVisibleAgainstBackground(k)||(L=o.page.colorLibraryController.getSolidColorForKey(I))&&(this.pageData.isColorVisibleAgainstBackground(L)&&!y.opt(U.ShapeLibrary.shapeDictionary[s],(function(e){return e.category==U.ShapeCategory.Cutout}))?(f.primaryColor=I,f.secondaryColor=R,m.changeBorderAndShadowToSecondary(f)):null!=(b=this.getThemeColorContrastingWithBackground())&&(f.primaryColor=b)))}if(this.targetedLockupStyle!==a){var D;(D=this.targetedLockupStyle).textOpacity!=w.FormaStyle.OPACITY_UNSET&&(D.textOpacity=f.textOpacity),D.shapeSupportsKnockout||a.shapeSupportsKnockout||E.LockupStyle.isKnockoutLook(D.textLook)&&(D.textLook=K.TextFacade.getNewTextLookForKnockoutChange(D.textLook,this,!0)),e==E.LockupBacking.None&&(D.backingOpacity=w.FormaStyle.OPACITY_DEFAULT),this.pickVisibleColorsForCharStyle()}else{var x=m.lockupStyleAttributesToLockupStyle(f,a,i);if(!x.shapeSupportsKnockout){E.LockupStyle.isKnockoutLook(x.textLook)&&(x.textLook=K.TextFacade.getNewTextLookForKnockoutChange(x.textLook,this,!0));for(var M=y.iter(x.characterStyles);!M.done;M.next()){var N=M.value;!N.shapeSupportsKnockout&&E.LockupStyle.isKnockoutLook(N.textLook)&&(N.textLook=K.TextFacade.getNewTextLookForKnockoutChange(N.textLook,this,!0))}}e==E.LockupBacking.None&&(x.backingOpacity=w.FormaStyle.OPACITY_DEFAULT),o.applyStyle(x)}l.endBlockedUpdate(),l.styleChanged(),this.onBackingShapeChanged()}},switchPrimaryColorAndSecondaryColor:function(){var e,t=!1;if(e=y.as(y.opt(this.forma,(function(e){return e.style})),E.LockupStyle)){var o=m.lockupStyleToLockupStyleAttributes(e,this.forma.page.document),n=this.forma.page.colorLibraryController.getSolidColorForKey(o.primaryColor),r=this.forma.page.colorLibraryController.getSolidColorForKey(o.secondaryColor);if(null!=n&&null!=r){var i=o.primaryColor;o.primaryColor=o.secondaryColor,o.secondaryColor=i,m.changeBorderAndShadowToSecondary(o);var a=m.lockupStyleAttributesToLockupStyle(o,this.forma.style,this.forma.page.document);this.forma.applyStyle(a),t=!0}}return t},getContrastingThemeColorBasedOnSolidColor:function(e,t){if(void 0===t&&(t=null),null==e)return null;for(var o=this.forma.page.colorLibraryController,n=y.iter(o.getThemeColorKeys().concat(T.ColorLibraryController.THEME_DERIVED_BW_KEYS));!n.done;n.next()){var r,i=n.value;if((r=o.getSolidColorForKey(i))&&r.contrasts(e,!1)&&!r.isEqual(t))return i}return null},getThemeColorContrastingWithBackground:function(e){void 0===e&&(e=null);for(var t=this.forma.page.colorLibraryController,o=y.iter(t.getThemeColorKeys().concat(T.ColorLibraryController.THEME_DERIVED_BW_KEYS));!o.done;o.next()){var n,r=o.value;if((n=t.getSolidColorForKey(r))&&(null==e||!n.isEqual(e))){for(var i=!0,a=y.iter(this.pageData.colorsBehindSelectedLockup);!a.done;a.next()){var l=a.value;if(!n.contrasts(l,!1)){i=!1;break}}if(i)return r}}return null},doesLockupContrastWithBackground:function(){var e,t=!0;if(e=y.as(y.opt(this.forma,(function(e){return e.style})),E.LockupStyle)){var o=m.lockupStyleToLockupStyleAttributes(e,this.forma.page.document),n=this.forma.page.colorLibraryController.getSolidColorForKey(o.primaryColor),r=this.forma.page.colorLibraryController.getSolidColorForKey(o.secondaryColor);e.secondaryColorVisible?e.textBacked?null!=n&&null!=r&&(t=this.pageData.isColorVisibleAgainstBackground(r)&&n.contrasts(r,!1)):null!=n&&null!=r&&(t=this.pageData.isColorVisibleAgainstBackground(n)&&this.pageData.isColorVisibleAgainstBackground(r)):null!=n&&(t=this.pageData.isColorVisibleAgainstBackground(n))}return t},pickVisibleColorsForLockup:function(){var e=this.pickVisibleColorsForTextAndShape(),t=this.pickVisibleColorsForCharStyle(),o=e||t;return o&&this.forma.controller.styleChanged(),o},pickVisibleColorsForTextAndShape:function(){if(this.doesLockupContrastWithBackground())return!1;if(this.switchPrimaryColorAndSecondaryColor()){if(this.doesLockupContrastWithBackground())return!0;this.switchPrimaryColorAndSecondaryColor()}var e,t=!1;if(e=y.as(y.opt(this.forma,(function(e){return e.style})),E.LockupStyle)){var o=m.lockupStyleToLockupStyleAttributes(e,this.forma.page.document),n=this.forma.page.colorLibraryController.getSolidColorForKey(o.primaryColor),r=this.forma.page.colorLibraryController.getSolidColorForKey(o.secondaryColor);if(e.secondaryColorVisible){if(e.textBacked){if(null!=n&&null!=r)if(this.pageData.isColorVisibleAgainstBackground(r))n.contrasts(r,!1)||null!=(i=this.getContrastingThemeColorBasedOnSolidColor(r))&&(o.primaryColor=i,t=!0);else if(null!=(l=this.getThemeColorContrastingWithBackground())){o.secondaryColor=l;var i,a=this.forma.page.colorLibraryController.getSolidColorForKey(o.secondaryColor);t=!0,m.hasSufficientLegibilityContrast(n,a)||null!=(i=this.getContrastingThemeColorBasedOnSolidColor(a))&&(o.primaryColor=i)}}else if(null!=n&&null!=r){var l;this.pageData.isColorVisibleAgainstBackground(n)||null!=(l=this.getThemeColorContrastingWithBackground())&&(o.primaryColor=l,t=!0),this.pageData.isColorVisibleAgainstBackground(r)||(n.isEqual(r)?(o.secondaryColor=o.primaryColor,t=!0):null!=(l=this.getThemeColorContrastingWithBackground(n))?(o.secondaryColor=l,t=!0):(o.secondaryColor=o.primaryColor,t=!0))}}else null!=n&&(this.pageData.isColorVisibleAgainstBackground(n)||null!=(l=this.getThemeColorContrastingWithBackground())&&(o.primaryColor=l,t=!0));if(t){m.changeBorderAndShadowToSecondary(o);var s=m.lockupStyleAttributesToLockupStyle(o,this.forma.style,this.forma.page.document);this.forma.applyStyle(s)}}return t},pickVisibleColorsForCharStyle:function(){var e,t=!1;if(e=y.as(y.opt(this.forma,(function(e){return e.style})),E.LockupStyle)){if(0==y.count(e.characterStyles))return t;for(var o=E.LockupStyle.isKnockoutLook(e.textLook)?"":e.colors.colorID(b.ColorRole.FieldPrimary),n=e.textBacked?e.colors.colorID(b.ColorRole.FieldSecondary):"",r=this.forma.page.colorLibraryController,i=[],a=y.iter(r.getThemeColorKeys().concat(T.ColorLibraryController.THEME_DERIVED_BW_KEYS));!a.done;a.next()){var l,s=a.value;(l=r.getSolidColorForKey(s))&&this.pageData.isColorVisibleAgainstBackground(l)&&i.push(s)}for(var u=y.iter(e.characterStyles);!u.done;u.next()){var c=u.value,h=c.colors.colorID(b.ColorRole.FieldPrimary),d=c.secondaryColorVisible?c.colors.colorID(b.ColorRole.FieldSecondary):"";if(c.secondaryColorVisible&&c.backing!=E.LockupBacking.UNSET){var g,p=!1;if(""==n&&(g=r.getSolidColorForKey(d))&&(this.pageData.isColorVisibleAgainstBackground(g)||(p=!0)),p)for(var f=y.iter(i);!f.done;f.next())(_=f.value)!=n&&(c.colors.setColorId(b.ColorRole.FieldSecondary,_),t=!0);else if(d==n)for(var m=y.iter(r.getThemeColorKeys().concat(T.ColorLibraryController.THEME_DERIVED_BW_KEYS));!m.done;m.next())(s=m.value)!=n&&(c.colors.setColorId(b.ColorRole.FieldSecondary,s),t=!0)}var v=!1,S=h!=o,C=r.getSolidColorForKey(e.colors.colorID(b.ColorRole.FieldPrimary));if(null==C)return t;if(!c.textBacked){var A=r.getSolidColorForKey(h);S&&""!=o&&(S=A.contrasts(C,!1)),""!=n||this.pageData.isColorVisibleAgainstBackground(A)||(v=!0)}if((c.backing!=E.LockupBacking.None&&c.backing!=E.LockupBacking.UNSET||S&&h!=n)&&!v){if(c.textBacked&&h==c.colors.colorID(b.ColorRole.FieldSecondary))for(var F=y.iter(r.getThemeColorKeys());!F.done;F.next())if((s=F.value)!=c.colors.colorID(b.ColorRole.FieldSecondary)){c.colors.setColorId(b.ColorRole.FieldPrimary,s),t=!0;break}}else for(var k=y.iter(i);!k.done;k.next()){var L=k.value,_=r.getSolidColorForKey(L),R=""==o||_.contrasts(C,!1);if(L!=o&&L!=n&&(!R&&t||c.colors.setColorId(b.ColorRole.FieldPrimary,L),t=!0,R))break}}}return t},getBrandkitColorsInUse:function(){for(var e=[],t=this.forma.page.colorLibraryController,o=y.iter(t.getColorThemeAsArrayOfTheoColors());!o.done;o.next()){var n=o.value;n.isBrandkitColor()&&e.push(n)}return e},getAllColorsFromDocumentBrandkit:function(){var e=[],t=D.Host.brandkitManager.brandkitForDocument(this.forma.page.document);if(null!=t)for(var o=y.iter(t.colors);!o.done;o.next()){var n=o.value,r=W.TheoColor.init_bb45(n);e.push(r)}return e},getBaseSuggestableColors:function(){for(var e=this.forma.page.colorLibraryController,t=y.clone(e.getColorThemeAsArrayOfTheoColors()),o=y.clone(e.getThemeDerivedColorsAsArrayOfTheoColors()),n=y.clone(e.getSuggestedColorsAsArraysOfTheoColors()),r=t.concat(n).concat(o),i=[],a=y.clone(this.getAllColorsFromDocumentBrandkit()),l=y.iter(r);!l.done;l.next()){var s=l.value;if(!s.isBrandkitColor()){for(var u=!0,c=y.iter(i);!c.done;c.next()){var h=c.value;if(s.rgbColor.distanceTo(h)<20){u=!1;break}}for(var d=y.iter(a);!d.done;d.next()){var g=d.value;if(s.rgbColor.distanceTo(g.rgbColor)<20){u=!1;break}}if(u&&i.push(s.rgbColor),i.length>=10)break}}return i},getSuggestableSingleColors:function(){for(var e=y.clone(this.getBaseSuggestableColors()),t=m.getTextOpacity(this.pageData.selectedLockup.styleAttributes),o=[],n=y.iter(e);!n.done;n.next()){for(var r=n.value,i=r.withAlphaOf(t),a=!0,l=y.iter(this.pageData.colorsBehindSelectedLockup);!l.done;l.next()){var s=l.value;if(!m.hasSufficientLegibilityContrast(i,s)){a=!1;break}}a&&o.push(r)}return o},getSuggestableColors:function(){var e=y.clone(this.getSuggestableColorPairs());if(0==e.length)for(var t=y.clone(this.getSuggestableSingleColors()),o=y.iter(t);!o.done;o.next()){var n=o.value;e.push([n])}for(var r=[],i=y.iter(e);!i.done;i.next()){for(var a=i.value,l=[],s=y.iter(a);!s.done;s.next()){var u=s.value;l.push(this.forma.page.colorLibraryController.getTheoColorForSolidColor(u))}r.push(l)}return r},isCurrentlyShowingMultipleColors:function(){var e;return!((e=y.as(this.forma.controller,X.TypeLockupController))&&(!e.secondaryColorVisible()||this.targetedLockupStyle.textLook==E.LockupTextLook.KnockoutOnly||this.targetedLockupStyle.textLook==E.LockupTextLook.OutlineOnly))},getSuggestableColorPairs:function(){var e=[];if(!this.isCurrentlyShowingMultipleColors())return e;var t=this.targetedLockupStyle,o=m.lockupStyleToLockupStyleAttributes(t,this.forma.page.document),n=(U.ShapeLibrary.shapeDictionary[o.backing]||U.ShapeLibrary.shapeDictionary.none).filled,r=m.getBackingOpacity(o);r==w.FormaStyle.OPACITY_UNSET&&(r=m.getBackingOpacity(m.lockupStyleToLockupStyleAttributes(this.forma.style,this.forma.page.document)));var i=y.clone(this.getBaseSuggestableColors()),a=i.length;if(0==a)return e;for(var l={},s=y.toArray(y.range(0,a,!1)),u=y.clone(y.shuffle(s)),c=y.iter(this.pageData.lockups);!c.done;c.next()){var h=c.value;if(h.id!=this.forma.formaID&&"none"!=h.styleAttributes.backing){var d=this.forma.page.colorLibraryController.getSolidColorForKey(h.styleAttributes.primaryColor),g=this.forma.page.colorLibraryController.getSolidColorForKey(h.styleAttributes.secondaryColor);if(null!=d&&null!=g&&m.hasSufficientLegibilityContrast(d,g)){for(var p=-1,f=-1,v=y.iter(y.range(0,i.length,!1));!v.done;v.next()){var S=v.value;i[S].distanceTo(d)<.1&&(p=S),i[S].distanceTo(g)<.1&&(f=S)}null==l[k=y.toString(G.MathUtils.maxInt(p,f))+" "+y.toString(G.MathUtils.minInt(p,f))]&&(e.push([d,g]),l[k]=!0)}}}for(var C=y.iter(y.range(0,2,!0));!C.done;C.next()){for(var T=y.iter(u);!T.done;T.next()){p=T.value;for(var A=y.clone(y.shuffle(s)),F=y.iter(A);!F.done;F.next()){var k;if(f=F.value,e.length>=10)break;if(null==l[k=y.toString(G.MathUtils.maxInt(p,f))+" "+y.toString(G.MathUtils.minInt(p,f))]){var L=i[p],b=i[f],_=L,R=b;L.lightness<b.lightness&&(_=b,R=L);var I=[];I=this.pageData.colorsBehindSelectedLockup[0].lightness>_.lightness?[R,_]:[_,R],n&&(I=y.reverse(I));for(var D=I[0],x=!0,P=y.iter(this.pageData.colorsBehindSelectedLockup);!P.done;P.next()){var E=P.value.blend(I[1],r),M=D.distanceTo(I[1]);if(!m.hasSufficientLegibilityContrast(D,E)||M<m.kColorPairDistanceThreshold){x=!1;break}}x&&(l[k]=!0,e.push(I))}}if(e.length>=10)break}if(e.length>=10)break}return e},applyColors:function(e,t){var o=this.targetedLockupStyle,n=this.forma.page.colorLibraryController;if(0!=e.length){S.BadgeFacade.logColorChange(y.opt(this.forma,(function(e){return e.source})));var r=y.clone(n.addColorsToTheme(e,this.targetedLockupStyle!==this.forma.style?null:this.forma));if(1==e.length)this.applyColor(t,r[0]);else{var i=t==b.ColorRole.FieldPrimary?b.ColorRole.FieldSecondary:b.ColorRole.FieldPrimary;o.colors.setColorIDs([{key:t,value:r[0]},{key:i,value:r[1]}])}this.targetedLockupStyle!==this.forma.style&&(this.forma.style.colorTableBeforeChanged(),this.forma.style.colorTableAfterChanged(),this.forma.controller.styleChanged())}},applyColorsWithRole:function(e){var t=this.targetedLockupStyle,o=this.forma.page.colorLibraryController;S.BadgeFacade.logColorChange(y.opt(this.forma,(function(e){return e.source})));for(var n=y.clone(o.addColorsWithRoleToTheme(e,this.targetedLockupStyle!==this.forma.style?null:this.forma)),r=[],i=y.iter(n);!i.done;i.next()){var a=i.value;r.push({key:a.role,value:a.color})}t.colors.setColorIDs(r),this.targetedLockupStyle!==this.forma.style&&(this.forma.style.colorTableBeforeChanged(),this.forma.style.colorTableAfterChanged(),this.forma.controller.styleChanged())},applyColor:function(e,t){var o=this.targetedLockupStyle,n=m.lockupStyleToLockupStyleAttributes(o,this.forma.page.document),r=(U.ShapeLibrary.shapeDictionary[n.backing]||U.ShapeLibrary.shapeDictionary.none).filled,i=m.needsContrastingColor(n.backing,o.textLook,r),a=this.getContrastingColorKey(t,null);switch(e){case 1:n.primaryColor=t,n.secondaryColor=i?a:t;break;case 2:n.secondaryColor=t,n.primaryColor=i?a:t;break;default:return}o.colors.setColorIDs([{key:b.ColorRole.FieldPrimary,value:n.primaryColor},{key:b.ColorRole.FieldSecondary,value:n.secondaryColor},{key:b.ColorRole.Border,value:n.secondaryColor},{key:b.ColorRole.Shadow,value:n.secondaryColor}])},getContrastingColorKey:function(e,t){var o,n=this.forma.page.colorLibraryController.getTheoColorForKey(e);if(null==n)return"";null!=t&&(o=this.forma.page.colorLibraryController.getTheoColorForKey(t));var r=this.forma.page.colorLibraryController,i="";if(n.isBrandkitColor())for(var a=y.clone(this.getBrandkitColorsInUse()),l=n.getBrandkitShadeRole(),s=y.iter(a);!s.done;s.next()){var u=s.value,c=u.getBrandkitShadeRole();if((null==l&&(c==W.TheoColor.SPARK_COLOR_ROLE_SHADE0||c==W.TheoColor.SPARK_COLOR_ROLE_SHADE6)||null!=l&&(c==W.TheoColor.SPARK_COLOR_ROLE_SHADE1||c==W.TheoColor.SPARK_COLOR_ROLE_SHADE5))&&u.rgbColor.distanceTo(n.rgbColor)>30&&(null==o||u.rgbColor.distanceTo(o.rgbColor)>30)){i=r.getKeyOfColorInTheme(u);break}}return""==i&&null!=n&&(i=r.setLightnessContrastColorAndReturnKey(e,n)),i},setContrastingColor:function(e,t,o,n,r){var i=e.contrastWithColor(t),a=T.ColorLibraryController.getBackgroundContrastKey(n);return this.forma.page.colorLibraryController.setTheoColorToLibrary(W.TheoColor.init_5344(i,null,null),a),r.colors.setColorIDs([{key:o,value:a}]),a},backgroundContrastCheck:function(e,t){void 0===e&&(e=!0),void 0===t&&(t=!1),0==this.hasScoresForAttributes&&this.updateScoring();var o=this.targetedLockupStyle,n=m.lockupStyleToLockupStyleAttributes(o,this.forma.page.document),r=U.ShapeLibrary.shapeDictionary[n.backing],i=y.count(o.characterStyles)>0;if(null!=r){var a=r.filled;if(!a||o.textLook==E.LockupTextLook.KnockoutOnly||i){for(var l,s,u=o.textLook==E.LockupTextLook.KnockoutOnly,c=E.LockupStyle.isShadowLook(o.textLook),h=u||c?b.ColorRole.FieldSecondary:b.ColorRole.FieldPrimary,d=!1,g=y.iter(this.forma.style.characterStyles);!g.done;g.next())(T=g.value).colors.colorID(h)==o.colors.colorID(h)&&(d=!0);if((l=y.as(this.forma.controller,X.TypeLockupController))&&(s=l.getBackgroundColor())){var p;if((p=o.colors.color(h))&&!(t?p.contrastsUsingPerception(s,e):p.contrasts(s,e))){var f=this.getContrastingColorKey(o.colors.colorID(h),null);o.colors.setColorId(h,f),this.forma.controller.styleChanged()}if(i&&!d)for(var v=y.iter(this.forma.style.characterStyles);!v.done;v.next()){var S,C,T=v.value;if((S=a?o.colors.color(b.ColorRole.FieldSecondary):s)&&(C=T.colors.color(h))&&!(t?C.contrastsUsingPerception(S,e):C.contrasts(S,e))){var A=T.colors.colorID(h);f=this.getContrastingColorKey(A,null),T.colors.setColorId(h,f)}}}}}else P.LegacyCoreAssert.fail("shape is not set up in ShapeLibrary.shapeDictionary",void 0,"LockupStyleController.backgroundContrastCheck","LockupStyleController.swift",3594)},shuffleColorAssignment:function(){this.updateScoring();var e=y.as(this.forma.controller,X.TypeLockupController);null!=e&&e.beginBlockedUpdate();var t=this.targetedLockupStyle,o=m.lockupStyleToLockupStyleAttributes(t,this.forma.page.document),n=E.LockupStyle.isOutlineLook(t.textLook)||E.LockupStyle.isShadowLook(t.textLook),r=!1;n||(r=U.ShapeLibrary.shapeDictionary[o.backing].filled),("none"!=o.backing||n)&&(o.secondaryColor=this.profilingBackgroundColorSelector.selectColorForGlobalRecolor(!0),m.changeBorderAndShadowToSecondary(o));var i,a=null;(r||n)&&(i=this.forma.page.colorLibraryController.getSolidColorForKey(o.secondaryColor))&&(a=y.clone(k.ColorForComparison.init_c063(i,n?.7:1)));var l=!r;l&&this.pageData.lockups.length<=2?o.primaryColor=this.profilingPrimaryColorSelector.selectColorForIndividualRecolor(l,a,!1):o.primaryColor=this.profilingPrimaryColorSelector.selectColorForGlobalRecolor(l,a,!0),this.setSecondaryMultiStyleLockupColors(t,o),t.colors.setColorIDs([{key:b.ColorRole.FieldPrimary,value:o.primaryColor},{key:b.ColorRole.FieldSecondary,value:o.secondaryColor},{key:b.ColorRole.Border,value:o.secondaryColor},{key:b.ColorRole.Shadow,value:o.secondaryColor}]),null!=e&&e.endBlockedUpdate(),this.forma.controller.styleChanged()},shuffleMultiStyleLockupColors:function(){this.pageData=new m.InterestingPageData(this.forma),this.profilingPrimaryColorSelector.updateBackgroundColors(this.pageData.colorsBehindSelectedLockup),this.profilingBackgroundColorSelector.updateBackgroundColors(this.pageData.colorsBehindSelectedLockup);var e=this.targetedLockupStyle,t=m.lockupStyleToLockupStyleAttributes(e,this.forma.page.document);this.setSecondaryMultiStyleLockupColors(e,t)},setSecondaryMultiStyleLockupColors:function(e,t,o){void 0===o&&(o=!0);for(var n=y.iter(e.characterStyles);!n.done;n.next()){var r=n.value,i=y.eq(O._equality_SolidColor_SolidColor,e.colors.fieldPrimary,e.colors.fieldSecondary);if(r.backing!=E.LockupBacking.None&&r.backing!=E.LockupBacking.UNSET&&!i&&y.eq(O._equality_SolidColor_SolidColor,r.colors.fieldPrimary,e.colors.fieldSecondary)&&y.eq(O._equality_SolidColor_SolidColor,r.colors.fieldSecondary,e.colors.fieldPrimary)&&o)r.colors.setColorIDs([{key:b.ColorRole.FieldPrimary,value:t.secondaryColor},{key:b.ColorRole.FieldSecondary,value:t.primaryColor}]);else{for(var a=y.clone(this.getStylePrimarySecondaryColorForMSL(t,r,!0)),l=y.iter(y.range(0,5,!0));!l.done&&a[0]==a[1];l.next())a=y.clone(this.getStylePrimarySecondaryColorForMSL(t,r,!0));r.colors.setColorIDs([{key:b.ColorRole.FieldPrimary,value:a[0]},{key:b.ColorRole.FieldSecondary,value:a[1]},{key:b.ColorRole.Border,value:a[1]},{key:b.ColorRole.Shadow,value:a[1]}])}}},getStylePrimarySecondaryColor:function(e){var t=e.clone();t.secondaryColor=this.secondaryColorSelector.select(t,!1,!0,!1,!1),t.primaryColor=this.primaryColorSelector.select(t,!1,!0,!1,!1);for(var o=y.iter(y.range(0,5,!0));!o.done&&t.primaryColor==t.secondaryColor;o.next())t.secondaryColor=this.secondaryColorSelector.select(t,!1,!0,!1,!1),t.primaryColor=this.primaryColorSelector.select(t,!1,!0,!1,!1);return[t.primaryColor,t.secondaryColor]},getStylePrimarySecondaryColorForMSL:function(e,t,o){var n,r=this.secondaryColorSelector.select(e,!0,!1,!0,o),i=!0;if(t.backing!=E.LockupBacking.None||E.LockupStyle.isOutlineLook(t.textLook)||E.LockupStyle.isShadowLook(t.textLook)){var a=m.lockupStyleToLockupStyleAttributes(t,this.forma.page.document);a.secondaryColor=r,n=this.primaryColorSelector.select(a,!0,!1,!1,o)}else i=!1,n=this.primaryColorSelector.select(e,!1,!1,!0,o);var l,s,u=(new B.ProfilingColorMap).overridePaletteMappingDueToContrast(r,this.forma.formaID+B.ProfilingColorMap.lockupMSLBackingColorKey),c=(new B.ProfilingColorMap).overridePaletteMappingDueToContrast(n,this.forma.formaID+B.ProfilingColorMap.lockupMSLPrimaryColorKey);return(l=this.forma.page.colorLibraryController.getSolidColorForKey(c))&&(s=this.forma.page.colorLibraryController.getSolidColorForKey(u))&&(i&&!s.contrasts(l)||(r=u,n=c)),[n,r]},generateAndApplyInitialStyleAttributes:function(){var e,t,o,n,r;if(0==this.hasScoresForAttributes&&this.updateScoring(),(e=this.forma)&&(t=e.page.document)&&(o=y.as(e.style,E.LockupStyle))&&(n=D.Host.fontProvider)&&(r=D.Host.textModelUtils)){var i,a=m.lockupStyleToLockupStyleAttributes(o,t),l=["Lato-Light","Lora-Regular","Montserrat-Regular","PlayfairDisplay-Regular","FuturaPT-Medium"].filter((function(e){return n.descriptorForPostScriptName(e,t).availability==R.FontAvailability.LOADED}),this);if(0==l.length)i=r.defaultFont().postScriptName;else{var s=F.CoreRandom.nextIntUniform(l.length);i=l[s]}for(var u=n.getIncludedFonts(t),c=y.iter(y.range(0,u.count,!1));!c.done;c.next()){var h=c.value;y.opt(u.fontAt(h),(function(e){return e.postScriptName==i}))&&(a.font=h)}a.layout=this.layoutSelector.select(a,!1,!1,!1,!1),"fill"!=a.layout&&"right"!=a.layout||(a.layout="center"),a.padding=0,a.textOpacity=1,a.backingOpacity=1,a=this.setNewStyleColors(a,o);var d=m.lockupStyleAttributesToLockupStyle(a,o,t);e.applyStyle(d)}},setNewStyleColors:function(e,t){var o,n=e.clone(),r=U.ShapeLibrary.shapeDictionary[n.backing].filled,i=E.LockupStyle.isOutlineLook(t.textLook)||E.LockupStyle.isShadowLook(t.textLook),a=null,l=!r;return("none"!=n.backing||i)&&(n.secondaryColor=this.profilingBackgroundColorSelector.selectColorForGlobalRecolor(!0,void 0,!0),m.changeBorderAndShadowToSecondary(n),(o=this.forma.page.colorLibraryController.getSolidColorForKey(n.secondaryColor))&&(a=y.clone(k.ColorForComparison.init_c063(o,i?.7:1)))),n.primaryColor=this.profilingPrimaryColorSelector.selectColorForIndividualRecolor(l,a,!0),n},getNewStyleAttributes:function(e,t,o){void 0===e&&(e=!0),0==this.hasScoresForAttributes&&this.updateScoring();var n,r,i=this.forma.style,a=m.lockupStyleToLockupStyleAttributes(i,this.forma.page.document);return a.font=this.fontSelector.select(a,!1,e,!1,!1),a.layout=this.layoutSelector.select(a,!1,e,!1,!1),a.backing=this.backingSelector.select(a,!1,e,!1,!1),o||(a.secondaryColor=this.secondaryColorSelector.select(a,!1,e,!1,!1),a.primaryColor=this.primaryColorSelector.select(a,!1,e,!1,!1),m.changeBorderAndShadowToSecondary(a),this.setSecondaryMultiStyleLockupColors(i,a,!1)),a.shadowAngle=this.shadowAngleSelector.select(a,!1,e,!1,!1),a.spacing=this.spacingSelector.select(a,!1,e,!1,!1),a.wheelUsed=!0,o?(n=m.lockupStyleAttributesToLockupStyle(a,i,this.forma.page.document),n=this.updateLockupStyleWithNewColors(n),(r=t)&&(n=r.lockupStyleEvaluator.styleEvaluatedWithReadability(n))):(n=m.lockupStyleAttributesToLockupStyle(a,i,this.forma.page.document),(r=t)&&r.lockupStyleEvaluator.initializeReadabilityInformation(n)),n},evaluateLockupStyleWithReadability:function(e){return new M.LockupStyleEvaluator(this.forma).styleEvaluatedWithReadability(e)},updateLockupStyleWithNewColors:function(e){(new B.ProfilingColorMap).eraseCurrentPaletteMappingDictionary();var t=m.lockupStyleToLockupStyleAttributes(e,this.forma.page.document),o=y.clone(this.getStylePrimarySecondaryColor(t));return t.primaryColor=o[0],t.secondaryColor=o[1],m.changeBorderAndShadowToSecondary(t),e.colors.setColorIDs([{key:b.ColorRole.FieldPrimary,value:o[0]},{key:b.ColorRole.FieldSecondary,value:o[1]},{key:b.ColorRole.Border,value:o[1]},{key:b.ColorRole.Shadow,value:o[1]}]),this.setSecondaryMultiStyleLockupColors(e,t,!1),e},cloneOpacityAttributes:function(e){var t=e.clone();return t.textOpacity=e.textOpacity,t.backingOpacity=e.backingOpacity,t},updateOpacityAttributesForNewBacking:function(e,t){var o=(U.ShapeLibrary.shapeDictionary[t.backing]||U.ShapeLibrary.shapeDictionary.none).filled,n=t.clone();return o?(m.getTextLook(n)==E.LockupTextLook.KnockoutAndOutline?n.textOpacity=e:n.textOpacity=1,n.backingOpacity=e):(n.textOpacity=e,n.backingOpacity=e),n},updateOpacityAttributes:function(e,t){var o=t.clone();return o.textOpacity=e,o.backingOpacity=e,o},updateTextOpacityAttributes:function(e,t){var o=t.clone();return o.textOpacity=e,o},updateShapeOpacityAttributes:function(e,t){var o=t.clone();return o.backingOpacity=e,o},setOpacity:function(e){var t=this.targetedLockupStyle,o=m.lockupStyleToLockupStyleAttributes(t,this.forma.page.document),n=this.updateOpacityAttributes(e,o);this.targetedLockupStyle===this.forma.style?this.forma.applyStyle(m.lockupStyleAttributesToLockupStyle(n,this.forma.style,this.forma.page.document)):(this.targetedLockupStyle.textOpacity=n.textOpacity,this.targetedLockupStyle.backingOpacity=n.backingOpacity,this.forma.controller.styleChanged())},getOpacityValue:function(){return this.targetedLockupStyle.currentTextOpacity},setTextOpacity:function(e){var t=this.targetedLockupStyle,o=m.lockupStyleToLockupStyleAttributes(t,this.forma.page.document),n=this.updateTextOpacityAttributes(e,o);this.targetedLockupStyle===this.forma.style?this.forma.applyStyle(m.lockupStyleAttributesToLockupStyle(n,this.forma.style,this.forma.page.document)):(this.targetedLockupStyle.textOpacity=n.textOpacity,this.forma.controller.styleChanged())},getTextOpacityValue:function(){return this.targetedLockupStyle.currentTextOpacity},setShapeOpacity:function(e){var t=this.targetedLockupStyle,o=m.lockupStyleToLockupStyleAttributes(t,this.forma.page.document),n=this.updateShapeOpacityAttributes(e,o);this.targetedLockupStyle===this.forma.style?this.forma.applyStyle(m.lockupStyleAttributesToLockupStyle(n,this.forma.style,this.forma.page.document)):(this.targetedLockupStyle.backingOpacity=n.backingOpacity,this.forma.controller.styleChanged())},getShapeOpacityValue:function(){return this.targetedLockupStyle.currentBackingOpacity},hasSpacingOptions:function(){var e,t;return!(!(e=y.opt(y.opt(this.forma,(function(e){return e.controller})),(function(e){return e.enableChildMove})))&&null==e||!e||this.targetedLockupStyle!==this.forma.style||!(t=y.as(this.forma.controller,X.TypeLockupController))||!(t.numLines()>1||0==t.numLines()))},hasPaddingOptions:function(){var e;if(!(e=y.opt(y.opt(this.forma,(function(e){return e.controller})),(function(e){return e.enableChildMove})))&&null==e||!e)return!1;var t=this.targetedLockupStyle;return t.backing!=E.LockupBacking.None&&t.backing!=E.LockupBacking.Knockout&&t.backing!=E.LockupBacking.UNSET},areSpacingAndPaddingOptionsAvailable:function(){return this.hasSpacingOptions()||this.hasPaddingOptions()},setNextSpacingAndPaddingOption:function(){var e,t;if(this.targetedLockupStyle===this.forma.style){var o=this.hasPaddingOptions(),n=this.hasSpacingOptions();if(o||n){var r=this.forma.style,i=m.lockupStyleToLockupStyleAttributes(r,this.forma.page.document),a=m.ALLOWED_PADDING_VALUES.length,l=m.ALLOWED_SPACING_VALUES.length,s=a*l,u=(e=y.indexOf(m.ALLOWED_PADDING_VALUES,i.padding))||null!=e?e:0,c=(t=y.indexOf(m.ALLOWED_SPACING_VALUES,i.spacing))||null!=t?t:0,h=(o?c*a+u:u*l+c)+1;h%=s;var d=o?y.toInt(h/a):h%l,g=o?h%a:y.toInt(h/l);i.padding=m.ALLOWED_PADDING_VALUES[g],i.spacing=m.ALLOWED_SPACING_VALUES[d],this.forma.applyStyle(m.lockupStyleAttributesToLockupStyle(i,this.forma.style,this.forma.page.document))}}else this.setNextPaddingOption()},setNextSpacingOption:function(){var e,t=this.forma.style,o=m.lockupStyleToLockupStyleAttributes(t,this.forma.page.document),n=((e=y.indexOf(m.ALLOWED_SPACING_VALUES,o.spacing))||null!=e?e:0)+1;n>=m.ALLOWED_SPACING_VALUES.length&&(n=0),o.spacing=m.ALLOWED_SPACING_VALUES[n],this.forma.applyStyle(m.lockupStyleAttributesToLockupStyle(o,this.forma.style,this.forma.page.document))},setSpacingFromSlider:function(e){this.setSpacing(V.TheoDocumentUtils.sliderToSpacingPaddingMapping(e))},setSpacing:function(e){var t,o=this.forma.style,n=m.lockupStyleToLockupStyleAttributes(o,this.forma.page.document),r=((t=y.indexOf(m.ALLOWED_SPACING_VALUES,n.spacing))||null!=t?t:0)+1;r>=m.ALLOWED_SPACING_VALUES.length&&(r=0),n.spacing=e,this.forma.applyStyle(m.lockupStyleAttributesToLockupStyle(n,this.forma.style,this.forma.page.document))},supportsRelativeFontScale:function(){var e;if(!(e=y.opt(y.opt(this.forma,(function(e){return e.controller})),(function(e){return e.enableChildMove})))&&null==e||!e)return!1;var t=this.targetedLockupStyle;return t.layout==E.LockupLayout.Auto&&Y.TypographyComposer.supportsRelativeFontScale(t.alignment)},setRelativeFontScale:function(e){var t,o=this.forma.style,n=m.lockupStyleToLockupStyleAttributes(o,this.forma.page.document);if(n.relativeFontScale=e,t=y.as(this.forma.controller,X.TypeLockupController)){var r;if(r=this.getSessionContainerSize()){var i=t.findInternalOffset(t.lockupStyle,t.size,r);t.move(N.Matrix2D.Identity.translate(i)),t.size=r}this.forma.applyStyle(m.lockupStyleAttributesToLockupStyle(n,this.forma.style,this.forma.page.document)),t.snapSizeToBounds()}},setNextPaddingOption:function(){var e;if(this.hasPaddingOptions()){var t=this.targetedLockupStyle;this.targetedLockupStyle!=this.forma.style&&this.targetedLockupStyle.backing==E.LockupBacking.Rows&&this.forma.style.backing==E.LockupBacking.Rows&&(t=this.forma.style);var o=m.lockupStyleToLockupStyleAttributes(t,this.forma.page.document),n=((e=y.indexOf(m.ALLOWED_PADDING_VALUES,o.padding))||null!=e?e:0)+1;n>=m.ALLOWED_PADDING_VALUES.length&&(n=0),o.padding=m.ALLOWED_PADDING_VALUES[n],t===this.forma.style?this.forma.applyStyle(m.lockupStyleAttributesToLockupStyle(o,this.forma.style,this.forma.page.document)):(this.targetedLockupStyle.padding=o.padding,this.forma.controller.styleChanged())}},setPaddingFromSlider:function(e){this.setPadding(V.TheoDocumentUtils.sliderToSpacingPaddingMapping(e))},setPadding:function(e){if(this.hasPaddingOptions()){var t=this.targetedLockupStyle;this.targetedLockupStyle!=this.forma.style&&this.targetedLockupStyle.backing==E.LockupBacking.Rows&&this.forma.style.backing==E.LockupBacking.Rows&&(t=this.forma.style);var o=m.lockupStyleToLockupStyleAttributes(t,this.forma.page.document);o.padding=e,t===this.forma.style?this.forma.applyStyle(m.lockupStyleAttributesToLockupStyle(o,this.forma.style,this.forma.page.document)):(this.targetedLockupStyle.padding=o.padding,this.forma.controller.styleChanged())}},setNextTrackingOption:function(){var e=this.forma.style,t=m.lockupStyleToLockupStyleAttributes(e,this.forma.page.document);t.tracking+=.2,t.tracking>.9&&(t.tracking=0),this.forma.applyStyle(m.lockupStyleAttributesToLockupStyle(t,this.forma.style,this.forma.page.document))},setTrackingFromSlider:function(e){var t;if(t=y.as(y.opt(this.forma,(function(e){return e.controller})),X.TypeLockupController)){var o=t.getCurrentFontSize();this.targetedLockupStyle.tracking=e;var n=y.opt(t.getPin(!0,!0),(function(e){return e.pinPoint}))||q.TheoPoint.ZERO;t.setSizeSliderValue(o,[],n)}},setNextShadowAngle:function(){var e;if(E.LockupStyle.isShadowLook(this.targetedLockupStyle.textLook)){var t=this.forma.style,o=m.lockupStyleToLockupStyleAttributes(t,this.forma.page.document),n=((e=y.indexOf(m.ALLOWED_SHADOWANGLE_VALUES,o.shadowAngle))||null!=e?e:0)+1;n>=m.ALLOWED_SHADOWANGLE_VALUES.length&&(n=0),o.shadowAngle=m.ALLOWED_SHADOWANGLE_VALUES[n],this.forma.applyStyle(m.lockupStyleAttributesToLockupStyle(o,this.forma.style,this.forma.page.document))}},legacyColorConversion:function(){if(null!=this.forma){for(var e,t=this.forma.style,o=[b.ColorRole.FieldPrimary,b.ColorRole.FieldSecondary],n=y.iter(o);!n.done;n.next()){var r=n.value,i=t.colors.color(r),a=t.colors.colorID(r),l=null!=a&&T.ColorLibraryController.keyFromImage(a);if(null!=i&&null==a||l){var s=this.forma.page.colorLibraryController.addUnlinkedColor(i);t.colors.setColorId(r,s)}}j.TypeLockupUtils.fixUpColors(t),(e=t.characterStyles[X.TypeLockupController.HIGHLIGHT_STYLE])&&j.TypeLockupUtils.fixUpColors(e)}else P.LegacyCoreAssert.fail("forma has been de-alloc'd",void 0,"LockupStyleController.legacyColorConversion","LockupStyleController.swift",4442)},onTrackingChanged:function(){var e;(e=y.as(y.opt(this.forma,(function(e){return e.style})),E.LockupStyle))&&(this._sessionAttrs.setTracking(e.tracking,e.layout),this.resetSessionContainerSize(),this.resetSessionContainerCenter())},onSpacingChanged:function(){var e;(e=y.as(y.opt(this.forma,(function(e){return e.style})),E.LockupStyle))&&(this._sessionAttrs.setSpacing(e.spacing,e.layout),this.resetSessionContainerSize(),this.resetSessionContainerCenter())},onBackingShapeChanged:function(){var e;if(e=y.as(y.opt(this.forma,(function(e){return e.style})),E.LockupStyle)){var t=m.getBackingStringForBackingEnumAndArtworkId(e.backing,e.backingArtworkID);this._sessionAttrs.setBackingShape(t,e.layout,e.pathID)}},onLayoutChanged:function(e){var t=e.layout,o=e.pathID,n=this.forma.style,r=n.layout,i=n.pathID;if(this._sessionAttrs.needsUpdate(t,e.alignment,o,r,n.alignment,i)){var a,l;this._sessionAttrs.setTracking(n.tracking,t),this._sessionAttrs.setSpacing(n.spacing,t),null!=(a=this._sessionAttrs.getTracking(r))&&(n.tracking=a),null!=(l=this._sessionAttrs.getSpacing(r))&&(n.spacing=l);var s=m.getBackingStringForBackingEnumAndArtworkId(n.backing,n.backingArtworkID);this._sessionAttrs.recordInitialBackingShape(s,t,o);for(var u=!1,c=y.iter(this._sessionAttrs.getPotentialBackingShapes(r,i,s));!c.done;c.next()){var h=c.value,d=m.getBackingEnumAndArtworkIdForBackingString(h),g=d.backing,p=d.artworkID;if(U.ShapeLibrary.isBackingShapeStyleCompatible(n,g,p)){n.backing=g,n.backingArtworkID=p,u=!0;break}}u||(y.opt(U.ShapeLibrary.shapeDictionary[s],(function(e){return 1==e.filled}))?(n.backing=E.LockupBacking.SVGBackground,n.backingArtworkID="square_001"):(n.backing=E.LockupBacking.None,n.backingArtworkID=null))}},endSession:function(){this._sessionAttrs.reset()},getSessionContainerSize:function(){return this._sessionAttrs._containerSize},getSessionContainerCenter:function(){return this._sessionAttrs._containerCenter},setSessionContainerSize:function(e){null==this._sessionAttrs._containerSize&&(this._sessionAttrs._containerSize=e)},setSessionContainerCenter:function(e){null==this._sessionAttrs._containerCenter&&(this._sessionAttrs._containerCenter=e)},resetSessionContainerSize:function(){this._sessionAttrs._containerSize=null},resetSessionContainerCenter:function(){this._sessionAttrs._containerCenter=null}}}),p),m.SessionAttrs=(f=function(){this._attrsDict={},this._hasBackingShapeEntry=!1,this._containerSize=null,this._containerCenter=null,this.reset()},y.defineClass({name:"SessionAttrs",ctor:f,statics:{TRACKING_KEY:"tracking",SPACING_KEY:"spacing",BACKING_KEY:"backing"},props:{reset:function(){this._attrsDict={},this._hasBackingShapeEntry=!1,this._containerSize=null,this._containerCenter=null,this.setTracking(0,E.LockupLayout.Standard),this.setSpacing(.35,E.LockupLayout.Standard),this.setTracking(.35,E.LockupLayout.LetterGrid),this.setSpacing(.35,E.LockupLayout.LetterGrid),this.setTracking(.15,E.LockupLayout.Path),this.setSpacing(.35,E.LockupLayout.Path),this.setTracking(0,E.LockupLayout.Auto),this.setSpacing(.35,E.LockupLayout.Auto)},needsUpdate:function(e,t,o,n,r,i){return e==E.LockupLayout.Auto&&e==n&&t!=r||this.getLayoutClass("",e,o)!=this.getLayoutClass("",n,i)},getTracking:function(e){return y.as(this._attrsDict[this.getSessionAttrsKey(f.TRACKING_KEY,e)],"Double")},setTracking:function(e,t){this._attrsDict[this.getSessionAttrsKey(f.TRACKING_KEY,t)]=e},getSpacing:function(e){return y.as(this._attrsDict[this.getSessionAttrsKey(f.SPACING_KEY,e)],"Double")},setSpacing:function(e,t){this._attrsDict[this.getSessionAttrsKey(f.SPACING_KEY,t)]=e},getBackingShape:function(e,t,o){return void 0===o&&(o=null),y.as(this._attrsDict[this.getSessionAttrsKey(f.BACKING_KEY,t,o)],"String")},setBackingShape:function(e,t,o){void 0===o&&(o=null),this._attrsDict[this.getSessionAttrsKey(f.BACKING_KEY,t,o)]=e,this._hasBackingShapeEntry=!0},recordInitialBackingShape:function(e,t,o){void 0===o&&(o=null),this._hasBackingShapeEntry||this.setBackingShape(e,t,o)},getPotentialBackingShapes:function(e,t,o){void 0===t&&(t=null);for(var n=this,r=[],i=[],a=y.iter(this._attrsDict);!a.done;a.next()){var l=a.key,s=a.value;l.includes(f.BACKING_KEY)&&(y.as(s,"String")==o?r.push(o):i.push(l))}return y.sortInPlace(i,(function(o,r){return n.getBackingShapeKeyDistance(o,e,t)<n.getBackingShapeKeyDistance(r,e,t)})),r.concat(i.map((function(e){return n._attrsDict[e]}),this))},getBackingShapeKeyDistance:function(e,t,o){var n;if(void 0===o&&(o=null),null!=(n=this.extractLayoutClass(f.BACKING_KEY,e))){var r=this.getLayoutClass(f.BACKING_KEY,t,o);return n==r?0:n==m.LayoutClass.PathDefault&&r==m.LayoutClass.PathAsymmetric||n==m.LayoutClass.PathAsymmetric&&r==m.LayoutClass.PathDefault?1:n==m.LayoutClass.Default?2:3+r}return 1e4},getLayoutClass:function(e,t,o){var n;return void 0===o&&(o=null),E.LockupStyle.isLetterGrid(t)?m.LayoutClass.LetterGrid:E.LockupStyle.isAutoLayout(t)?m.LayoutClass.Auto:E.LockupStyle.isPath(t)?e==f.SPACING_KEY||e==f.TRACKING_KEY||Z.TextPathLibrary.isPathSymmetric((n=o)||null!=n?n:Z.TextPathID.Circle)?m.LayoutClass.PathDefault:m.LayoutClass.PathAsymmetric:m.LayoutClass.Default},extractLayoutClass:function(e,t){if(t.startsWith(e)){var o,n=t.substr(e.length);if(null!=(o=y.toInt(n)))return m.LayoutClass.toCaseValue(o)}return null},getSessionAttrsKey:function(e,t,o){return void 0===o&&(o=null),e+this.getLayoutClass(e,t,o)}}}),f),m.LayoutClass=y.defineEnum("LayoutClass",{Default:0,LetterGrid:1,PathDefault:2,PathAsymmetric:3,Auto:4})},Tq01:function(e,t,o){var n,r,i,a,l,s,u,c,h,d,g,p,f,m,y=t,v=o("oAGj"),S=o("Dz6V"),C=o("gXiO"),T=o("yGNn"),A=o("fNpk"),F=o("Kkml");y.ActionExecutionOptions=(n=function(e,t){this.showWaitingFeedback=e,this.showMessageFeedback=t},r={},v.defineClass({name:"ActionExecutionOptions",ctor:n,superName:"CoreObject",statics:{DEFAULT:{get:function(){return void 0===r.DEFAULT&&(r.DEFAULT=new n(S.ActionFeedbackWaitingType.None,S.ActionFeedbackMessageType.None)),r.DEFAULT}}},props:{enableActionFeedback:{get:function(){return this.showWaitingFeedback!=S.ActionFeedbackWaitingType.None||this.showMessageFeedback!=S.ActionFeedbackMessageType.None}}}}),n),y.Action=(i=function(e,t){void 0===t&&(t=y.ActionExecutionOptions.DEFAULT),this.type=e,this.executionOptions=t,C.CoreObject.call(this)},v.defineClass({name:"Action",ctor:i,superName:"CoreObject",props:{canDo:function(e){return!0},getUserAction:function(e){return A.LegacyCoreAssert.fail("Action does not implement getUserAction",{type:this.type},"Action.getUserAction","Actions.swift",63),F.UserActions.AddText()},execute:function(e){return T.CorePromise.reject("no default impl")},updateSelection:function(e){return null}}}),i),y.ActionResult=function(){var e=function(){C.CoreObject.call(this)},t={};return v.defineClass({name:"ActionResult",ctor:e,superName:"CoreObject",statics:{NONE:{get:function(){return void 0===t.NONE&&(t.NONE=new e),t.NONE}},fromPromiseAny:function(t){var o;return null==t?e.NONE:(o=v.as(t,e))?o:(A.LegacyCoreAssert.fail("default action impl returned a promise for something other than an ActionResult",void 0,"ActionResult.fromPromiseAny","Actions.swift",101),e.NONE)}}}),e}(),y.FormaActionResult=(a=function(e){this.formae=v.clone(e),y.ActionResult.call(this)},v.defineClass({name:"FormaActionResult",ctor:a,superName:"ActionResult"}),a),y.PageActionResult=(l=function(e){this.pages=v.clone(e),y.ActionResult.call(this)},v.defineClass({name:"PageActionResult",ctor:l,superName:"ActionResult"}),l),y.DoubleActionResult=(s=function(e){this.value=e,y.ActionResult.call(this)},v.defineClass({name:"DoubleActionResult",ctor:s,superName:"ActionResult"}),s),y.TextRangeActionResult=(u=function(e){this.range=e,y.ActionResult.call(this)},v.defineClass({name:"TextRangeActionResult",ctor:u,superName:"ActionResult"}),u),y.LockupStyleActionResult=(c=function(e){this.style=e,y.ActionResult.call(this)},v.defineClass({name:"LockupStyleActionResult",ctor:c,superName:"ActionResult"}),c),y.TextEmphasisActionResult=(h=function(e){this.textFormae=v.clone(e),y.ActionResult.call(this)},v.defineClass({name:"TextEmphasisActionResult",ctor:h,superName:"ActionResult"}),h),y.AnimationStyleActionResult=(d=function(e){this.style=e,y.ActionResult.call(this)},v.defineClass({name:"AnimationStyleActionResult",ctor:d,superName:"ActionResult"}),d),y.ImageStyleActionResult=(g=function(e){this.style=e,y.ActionResult.call(this)},v.defineClass({name:"ImageStyleActionResult",ctor:g,superName:"ActionResult"}),g),y.SuggestionsActionResult=(p=function(e){this.suggestions=v.clone(e),y.ActionResult.call(this)},v.defineClass({name:"SuggestionsActionResult",ctor:p,superName:"ActionResult"}),p),y.DragActionResult=(f=function(e){this.snapLines=v.clone(e),y.ActionResult.call(this)},v.defineClass({name:"DragActionResult",ctor:f,superName:"ActionResult"}),f),y.PlacementActionResult=(m=function(e){this.snapResult=e,y.ActionResult.call(this)},v.defineClass({name:"PlacementActionResult",ctor:m,superName:"ActionResult"}),m),y.ControllerSettingsBehaviorEnum=v.defineEnum("ControllerSettingsBehaviorEnum",{IgnoreControllerSettings:0,SetControllerSettings:1})},U010:function(e,t,o){var n,r,i,a,l,s=t,u=o("oAGj"),c=o("SpAV"),h=o("gXiO"),d=o("yGNn"),g=o("iCxV"),p=o("kJ8p"),f=o("fNpk");s.MASK_ENDPOINT="/deepcut/mask",s.VERSION_ENDPOINT="/deepcut/version",s.CutoutMode=u.defineEnum("CutoutMode",{Off:0,BackgroundRemoval:1,ForegroundRemoval:2}),s.CutoutModel=u.defineEnum("CutoutModel",{DISCONTINUED_SAGEMAKER:0,DISCONTINUED_SENSEI:1,MALABI:2,REMOVE_BG:3,CLOUDINARY:4,SENSEI2_BINARY:5,SENSEI2_SOFT:6}),s.CutoutMaskSize=u.defineEnum("CutoutMaskSize",{ORIGINAL:0,SMALL:500,MEDIUM:1500,LARGE:2e3}),s.CutoutStyle=(n=function(e){this.mode=e,h.CoreObject.call(this)},u.defineClass({name:"CutoutStyle",ctor:n,superName:"CoreObject",props:{equals:function(e){return this.mode==e.mode}}}),n),s.CutoutMaskMetadata=(r=function(e,t,o){this.model=e,this.maskSize=t,this.modelVersion=o,h.CoreObject.call(this)},u.defineClass({name:"CutoutMaskMetadata",ctor:r,superName:"CoreObject",statics:{decode:function(e){if(null!=(e=e)){var t=e.split(":");if(3==t.length){var o,n,i,a;if(null!=(o=u.toInt(t[0]))&&null!=(n=u.toInt(t[1]))&&null!=(i=s.CutoutModel.toCaseValue(o))&&null!=(a=s.CutoutMaskSize.toCaseValue(n))){var l=u.toString(t[2]);return new r(i,a,u.isEmpty(l)?null:l)}u.opt(g.Host.logging,(function(e){return e.warning("[ImageCutoutModelLibrary] Unexpected model or maskSize value found in document")}))}}return null}},props:{equals:function(e){return this.model==e.model&&this.maskSize==e.maskSize&&this.modelVersion==e.modelVersion},encode:function(){var e;return this.model+":"+this.maskSize+":"+((e=this.modelVersion)||null!=e?e:"")}}}),r),s.ImageCutoutLibrary=(i=function(){h.CoreObject.call(this)},a={},u.defineClass({name:"ImageCutoutLibrary",ctor:i,superName:"CoreObject",statics:{imageCutouts_:{get:function(){return void 0===a.imageCutouts_&&(a.imageCutouts_=[new s.CutoutStyle(s.CutoutMode.Off),new s.CutoutStyle(s.CutoutMode.BackgroundRemoval),new s.CutoutStyle(s.CutoutMode.ForegroundRemoval)]),a.imageCutouts_}},getImageCutouts:function(){return i.imageCutouts_},getImageCutout:function(e){return i.imageCutouts_.find((function(t){return t.mode==e}),this)},getCutoutModeString:function(e){switch(e){case 1:return"background";case 2:return"foreground";case 0:return"off";default:return f.LegacyCoreAssert.fail("Unknown cutout mode.",{mode:e},"ImageCutoutLibrary.getCutoutModeString","ImageCutoutLibrary.swift",169),"off"}}},props:{getNextImageCutoutOfSameType:function(e){var t;switch(e.mode){case 0:t=i.getImageCutout(s.CutoutMode.Off);break;case 1:t=i.getImageCutout(s.CutoutMode.BackgroundRemoval);break;case 2:t=i.getImageCutout(s.CutoutMode.ForegroundRemoval);break;default:t=i.getImageCutout(s.CutoutMode.Off)}return t},hasNextCutoutOfSameType:function(e){var t;return!!(t=this.getNextImageCutoutOfSameType(e))&&!e.equals(t)}}}),i),s.ImageCutoutModelLibrary=function(){var e=function(){this.modelVersion=null,h.CoreObject.call(this)},t={};return u.defineClass({name:"ImageCutoutModelLibrary",ctor:e,superName:"CoreObject",statics:{CURRENT_MODEL:{get:function(){return void 0===t.CURRENT_MODEL&&(t.CURRENT_MODEL=s.CutoutModel.SENSEI2_SOFT),t.CURRENT_MODEL}},DEFAULT_MASK_SIZE:{get:function(){return void 0===t.DEFAULT_MASK_SIZE&&(t.DEFAULT_MASK_SIZE=s.CutoutMaskSize.MEDIUM),t.DEFAULT_MASK_SIZE}},DEFAULT_TIMEOUT:15,instance:{get:function(){return void 0===t.instance&&(t.instance=new e),t.instance}},isMaskUptodateWithCurrentModel:function(t){return(t=t)&&t.model==e.CURRENT_MODEL?e.instance.getModelVersion(e.CURRENT_MODEL).then((function(e){var o;return null!=(o=u.as(e,"String"))&&t.modelVersion==o})).fail((function(e){return g.Host.logging.error("Failed to get mask version from API"),!1})):d.CorePromise.resolve(!1)},getModelString:function(e){switch(e){case 2:return"malabi";case 3:return"remove.bg";case 4:return"cloudinary";case 5:return"sensei2-binary";case 6:return"sensei2-soft";case 0:case 1:return c.CoreAssert.fail("Invalid use of discontinued model value.",{model:e},"ImageCutoutModelLibrary.getModelString","ImageCutoutLibrary.swift",275),"sensei2-soft";default:return f.LegacyCoreAssert.fail("Unknown model value.",{model:e},"ImageCutoutModelLibrary.getModelString","ImageCutoutLibrary.swift",280),"sensei2-soft"}},buildMaskNetworkRequestForConfig:function(t,o,n,r){var i,a;return(i=g.Host.network)&&(a=g.Host.imageAnalysis)?d.CorePromise.all([i.getAuthToken(),a.getSaliencyAPIEndpoint(),a.getSaliencyAPIKey()]).then((function(i){var a,l,s,c,h=u.clone(u.as(i,["Array","Any"]));if(f.LegacyCoreAssert.isTrue(u.opt(h,(function(e){return 3==e.length})),"Expected three CorePromise results.",void 0,"ImageCutoutModelLibrary.buildMaskNetworkRequestForConfig","ImageCutoutLibrary.swift",296),(a=h)&&null!=(l=u.as(a[0],"String"))&&null!=(s=u.as(a[1],"String"))&&null!=(c=u.as(a[2],"String"))){var g=new p.HostNetworkRequest(s+o);return g.timeout=r,g.method=n,g.headers["X-API-Key"]=c,g.headers.Authorization="Bearer "+l,g.headers["X-Model"]=e.getModelString(t.model),g}return d.CorePromise.reject("Invalid auth data")})):d.CorePromise.reject("Invalid Host instances")}},props:{setup:function(){this.getModelVersion(e.CURRENT_MODEL,!0)},getModelVersion:function(t,o,n){void 0===o&&(o=!1),void 0===n&&(n=10);var r,i=this;if(!o&&t==e.CURRENT_MODEL&&null!=this.modelVersion)return d.CorePromise.resolve(this.modelVersion);if(r=g.Host.network){var a=new s.CutoutMaskMetadata(t,s.CutoutMaskSize.ORIGINAL,null);return e.buildMaskNetworkRequestForConfig(a,s.VERSION_ENDPOINT,p.HostNetworkRequestMethod.get,n).then((function(e){var t;return(t=u.as(e,p.HostNetworkRequest))?r.request(t):d.CorePromise.reject("Invalid network request object")})).then((function(o){var n,r;return(n=u.as(o,p.HostNetworkResponse))&&(r=n.data)?r.asJSON().then((function(o){var n,r;return(n=u.as(o,["Dictionary","String","String"]))&&null!=(r=n.version)?(t==e.CURRENT_MODEL&&i.setModelVersion(r),d.CorePromise.resolve(r)):d.CorePromise.reject("[ImageCutoutModelLibrary] Failed to parse JSON response from `/version` call")})):d.CorePromise.reject("[ImageCutoutModelLibrary] Failed to get model version from API")}))}return d.CorePromise.reject("[ImageCutoutModelLibrary] Failed to get network impl")},setModelVersion:function(e){this.modelVersion=e}}}),e}(),s.ImageCutoutErrorLibrary=(l=function(){h.CoreObject.call(this)},u.defineClass({name:"ImageCutoutErrorLibrary",ctor:l,superName:"CoreObject",statics:{mapServerErrorToMaskError:function(e){if(e.type==p.HostNetworkErrorType.BadRequest)switch(u.as(e.message,"String")){case"unsupported-image":return new p.HostCutoutMaskError(p.HostCutoutMaskErrorType.UnsupportedImageFormat);case"image-too-small":return new p.HostCutoutMaskError(p.HostCutoutMaskErrorType.ImageTooSmall);case"image-too-large":return new p.HostCutoutMaskError(p.HostCutoutMaskErrorType.ImageTooLarge);case"invalid-file-upload":return new p.HostCutoutMaskError(p.HostCutoutMaskErrorType.InvalidImageUploaded);case"no-salient-object":return new p.HostCutoutMaskError(p.HostCutoutMaskErrorType.NoForegroundObjectImage);default:return new p.HostCutoutMaskError(p.HostCutoutMaskErrorType.Unknown)}return e}}}),l)},UB0O:function(e,t,o){var n,r=t,i=o("oAGj"),a=o("ascj"),l=o("iCxV"),s=o("fNpk"),u=o("cEEQ"),c=o("9kak"),h=o("c+uM"),d=o("GFAD"),g=o("tGKA"),p=o("8t9B"),f=o("3UhB"),m=o("uUew"),y=o("1NAc");r.EvenRowWidthsLayoutStrategy=(n=function(){this.paddingScalar=.6,this.spacingScalar=.75,u.BaseLockupLayoutStrategy.call(this)},i.defineClass({name:"EvenRowWidthsLayoutStrategy",ctor:n,superName:"BaseLockupLayoutStrategy",statics:{getCombinedAspectOfAllRows:function(e,t){for(var o=0,n=i.iter(e);!n.done;n.next())o+=1/n.value.aspectRatio;return t>0?1/(i.toDouble(e.length-1)*(1/t)+o):1/o},getCombinedAspectOfAllRowsFinal:function(e,t){for(var o=0,n=i.iter(e);!n.done;n.next()){var r=n.value,a=r.rowHeightAdjustRatio<1?r.rowHeightAdjustRatio:1;o+=1/r.aspectRatio*(a*a)}return 0!=t?1/(i.toDouble(e.length-1)*(1/t)+o):1/o},getAverageRowAspect:function(e){for(var t=0,o=i.iter(i.range(0,e.length,!1).reversed());!o.done;o.next())t+=e[o.value].aspectRatio;return t/i.toDouble(e.length)},getTallestRowPairIndex:function(e){for(var t=5e3,o=e.length,n=null,r=i.iter(i.range(0,o-1,!1));!r.done;r.next()){var a=r.value,l=e[a];if(l.appendable){var s=e[a+1],u=l.aspectRatio+s.aspectRatio;u<t&&(t=u,n=a)}}return n},aspectDifference:function(e,t){return 1/(1/e-1/t)},aspectStacked:function(e,t){return 1/(1/e+1/t)},mergeRows:function(e,t,o){var n=i.clone(e);s.LegacyCoreAssert.isTrue(t<o,"merging out of order rows",void 0,"EvenRowWidthsLayoutStrategy.mergeRows","EvenRowWidthsLayoutStrategy.swift",607);var r=n[t].words.concat(n[o].words),a=new c.LockupRowInfo(r,n[o].appendable);return n.splice(o,1),n.splice(t,1),n.splice(t,0,a),n},mergeAutoRows:function(e,t,o,r,a,l){for(var s=i.clone(n.mergeRows(e,t,o)),u=l==p.HighlightMethod.EvenRows?0:1,c=0,h=i.iter(i.range(0,s.length,!1));!h.done;h.next()){for(var d=h.value,g=0,f=i.iter(i.range(0,s[d].words.length,!1));!f.done;f.next()){for(var m=f.value;r[c].isNewLine;)c+=1;var y=d%2==u?a[c]:r[c];s[d].words[m]=y,g+=y.aspectRatio,m-1>=0&&(g+=s[d].words[m-1].spaceAspectRatio),c+=1}s[d].aspectRatio=g}return s},compactRowsIntoAspect:function(e,t,o){var r=e.length;if(r<=1)return e;var a=n.getCombinedAspectOfAllRows(e,0),l=n.getTallestRowPairIndex(e);if(null==l)return e;for(var s=l+1,u=e[l],c=e[s],h=u.aspectRatio,g=c.aspectRatio,p=h+g,f=0,m=0,y=i.iter(i.toSequence(e));!y.done;y.next()){var v=y.value,S=v.offset,C=v.element;f+=C.aspectRatio,S==l?m+=p:S!=s&&(m+=C.aspectRatio)}var T=f/i.toDouble(r),A=m/i.toDouble(r)/o,F=T/o/i.toDouble(r-1),k=A/i.toDouble(r-2),L=n.aspectStacked(n.aspectDifference(a,n.aspectStacked(g,h)),p),b=n.aspectStacked(k,L),_=n.aspectStacked(F,a);if(d.LockupUtils.percentageDiff(t,_)<=d.LockupUtils.percentageDiff(t,b))return e;var R=i.clone(n.mergeRows(e,l,s));return n.compactRowsIntoAspect(R,t,o)},compactAutoRowsIntoAspect:function(e,t,o,r,a,l){var s=e.length;if(s<=1)return e;var u=n.getCombinedAspectOfAllRows(e,0),c=n.getTallestRowPairIndex(e);if(null==c)return e;for(var h=c+1,g=e[c],p=e[h],f=g.aspectRatio,m=p.aspectRatio,y=f+m,v=0,S=0,C=i.iter(i.toSequence(e));!C.done;C.next()){var T=C.value,A=T.offset,F=T.element;v+=F.aspectRatio,A==c?S+=y:A!=h&&(S+=F.aspectRatio)}var k=v/i.toDouble(s),L=S/i.toDouble(s)/o,b=k/o/i.toDouble(s-1),_=L/i.toDouble(s-2),R=n.aspectStacked(n.aspectDifference(u,n.aspectStacked(m,f)),y),I=n.aspectStacked(_,R),w=n.aspectStacked(b,u);if(d.LockupUtils.percentageDiff(t,w)<=d.LockupUtils.percentageDiff(t,I))return e;var D=i.clone(n.mergeAutoRows(e,c,h,r,a,l));return n.compactAutoRowsIntoAspect(D,t,o,r,a,l)},getOptimalCompactedAutoRows:function(e,t,o,r,a,l){var s=e.length;if(s<=1)return e;var u=n.getCombinedAspectOfAllRows(e,0),c=n.getTallestRowPairIndex(e);if(null==c)return e;for(var h=c+1,g=e[c],p=e[h],f=g.aspectRatio,m=p.aspectRatio,y=f+m,v=0,S=0,C=i.iter(i.toSequence(e));!C.done;C.next()){var T=C.value,A=T.offset,F=T.element;v+=F.aspectRatio,A==c?S+=y:A!=h&&(S+=F.aspectRatio)}var k=v/i.toDouble(s),L=S/i.toDouble(s)/a,b=k/a/i.toDouble(s-1),_=L/i.toDouble(s-2),R=n.aspectStacked(n.aspectDifference(u,n.aspectStacked(m,f)),y),I=n.aspectStacked(_,R),w=n.aspectStacked(b,u);if(d.LockupUtils.percentageDiff(r,w)<=d.LockupUtils.percentageDiff(r,I))return e;var D=i.clone(n.mergeAutoRows(e,c,h,t,o,l));return n.compactAutoRowsIntoAspect(D,r,a,t,o,l)},_implements:function(e){return"LockupLayoutStrategy"==e}},props:{supportsConfiguration:function(e){return e.style.layout==h.LockupLayout.FitJustified},layout:function(e){var t=e.text,o=e.style.font.fontData,r=e.containerSize,s=r.width,c=r.height,d=e.style,v=d.spacing*this.spacingScalar,S=s,C=c,T=S/C,A=i.clone(e.characterStyleRanges);d.alignment!=h.LockupAlignment.UNSET&&i.opt(l.Host.logging,(function(e){return e.warning("Unexpected alignment "+d.alignment+" for fit-justified text")}));var F=o.allCapsAllowed?t.toUpperCase():t,k=u.getTypographicBoundingRatiosOfString(F,o),L=p.TypeLockupController.HIGHLIGHT_STYLE,b=i.opt(i.opt(d.characterStyles[L],(function(e){return e.font})),(function(e){return e.fontData})),_=f.TypeLockupUtils.getCharFontAdjust(d,k.hasUppercase),R=!1;e.characterStyleRanges.length>0&&null!=d.characterStyles[L]&&-1!=d.characterStyles[L].spacing&&0!=d.characterStyles[L].spacing&&d.characterStyles[L].spacing>1&&((d=e.style.clone()).characterStyles[L].spacing=_,A=i.clone(f.TypeLockupUtils.invertRanges(e.characterStyleRanges,t.length)),R=!0,null!=b&&(b=o,o=d.characterStyles[L].font.fontData,d.characterStyles[L].font=d.font));for(var I=i.clone(f.TypeLockupUtils.computeLockupMeasurements(F,o,k.heightRatio,o.allCapsAllowed,e.forceLetterForma,d.tracking,A,d.characterStyles,_,e.forceLetterForma)),w=i.clone(this.getUncompactedRows(I,!1)),D=i.clone(n.compactRowsIntoAspect(w,T,v)),x=0,P=i.iter(I);!P.done;P.next())x+=(ce=P.value).isNewLine?0:1;if(null!=e.rowWordLengths&&e.rowWordLengths.reduce((function(e,t){return e+t}),0)==x&&(!e.allowFewerLineBreaks||D.length>=e.rowWordLengths.length)&&(D=i.clone(this.getPrecomputedRows(I,e.rowWordLengths))),I.length>1&&(e.highlightMethod==p.HighlightMethod.EvenRows||e.highlightMethod==p.HighlightMethod.OddRows)&&""!=L&&null!=d.characterStyles[L]&&null!=b){var E=i.clone(f.TypeLockupUtils.computeLockupMeasurements(F,o,k.heightRatio,o.allCapsAllowed,!1,d.tracking,[],{})),M=[new m.TextRange(0,i.chars(t).length)],N=i.clone(f.TypeLockupUtils.computeLockupMeasurements(F,b,k.heightRatio,o.allCapsAllowed,!1,d.tracking,M,d.characterStyles,_)),G=i.clone(this.getUncompactedAutoRows(E,N,!1,e.highlightMethod));D=i.clone(n.getOptimalCompactedAutoRows(G,E,N,T,v,e.highlightMethod))}if(0==D.length)return new u.LayoutResults([],new y.TheoSize(0,0),g.Matrix2D.Identity,k,0,u.BaseLockupLayoutStrategy.createMultipleReturnAnnotations(t));var B=n.getAverageRowAspect(D);if(0==B)return new u.LayoutResults([],new y.TheoSize(0,0),g.Matrix2D.Identity,k,0,u.BaseLockupLayoutStrategy.createMultipleReturnAnnotations(t));var O=B/v,U=n.getCombinedAspectOfAllRowsFinal(D,O);U<T?S=C*U:C=S/U;for(var H=S/O,z=C,Y=S,W=0,V=0,K=[],X=i.iter(i.range(0,D.length,!1));!X.done;X.next()){var j=X.value,q=D[j],Z=q.rowHeightAdjustRatio<1?q.rowHeightAdjustRatio:1,J=S/(isFinite(q.aspectRatio)?q.aspectRatio:1)*Z,Q=u.getTypographicBoundingRatiosOfString(q.text,o);V=0,Z<1&&(V+=(S-q.aspectRatio*J)/2);for(var $=J/k.heightRatio,ee=$*_,te=$*o.capRatio,oe=k.textVerticalOffsetRatio,ne=k.heightRatio,re=Q.textVerticalOffsetRatio,ie=oe-(ne/2-Q.heightRatio/2)-re,ae=f.TypeLockupUtils.getCharFontYAdjust(d,$,ee),le=(k.textVerticalOffsetRatio-o.capRatio-ie)*$,se=W+0,ue=i.iter(i.range(0,q.words.length,!1));!ue.done;ue.next()){var ce,he=ue.value,de=(ce=q.words[he]).aspectRatio*J,ge=ce.spaceAspectRatio*J,pe=V,fe=o.allCapsAllowed?ce.text.toUpperCase():ce.text,me=i.isEmpty(ce.characterStyle)?$:ee,ye=i.isEmpty(ce.characterStyle)||1!=Z?0:ae,ve=i.isEmpty(ce.characterStyle)?null:ce.characterStyle;R&&(ve=i.isEmpty(ce.characterStyle)?L:null);var Se=this.getLockupSize(de,te,o.postScriptName),Ce=this.getLockupPlacement(pe,se+le+ye,o.postScriptName),Te=u.LockupItem.init_bc20(a.ColorRole.FieldPrimary,ve,Se,Ce,fe,i.isEmpty(ce.characterStyle)?o:b||o,me,$,Q,j,ce.rangeInLockup);K.push(Te),V+=de+ge}W+=Z<1?ee*k.heightRatio+H:J+H}return new u.LayoutResults(K,new y.TheoSize(Y,z),g.Matrix2D.translationXY(0,0),k,B,u.BaseLockupLayoutStrategy.createMultipleReturnAnnotations(t))},calculateTracking:function(e,t){var o=e.text,r=e.style.font.fontData,a=e.containerSize,l=a.width,s=a.height,c=e.style,h=c.spacing*this.spacingScalar,d=s,g=r.allCapsAllowed?o.toUpperCase():o,y=u.getTypographicBoundingRatiosOfString(g,r),v=0,S=p.TypeLockupController.HIGHLIGHT_STYLE,C=i.opt(i.opt(c.characterStyles[S],(function(e){return e.font})),(function(e){return e.fontData})),T=1;null!=C&&(T=y.hasUppercase?r.capRatio/C.capRatio:r.meanRatio/C.meanRatio);var A=i.clone(f.TypeLockupUtils.computeLockupMeasurements(g,r,y.heightRatio,!1,!0,c.tracking,e.characterStyleRanges,c.characterStyles,T,e.forceLetterForma));if(0==A.length)return e.style.tracking;var F=i.clone(this.getUncompactedRows(A,!1)),k=t.width/t.height,L=i.clone(n.compactRowsIntoAspect(F,k,h));if(A.length>1&&(e.highlightMethod==p.HighlightMethod.EvenRows||e.highlightMethod==p.HighlightMethod.OddRows)&&""!=S&&null!=c.characterStyles[S]&&null!=C){var b=i.clone(f.TypeLockupUtils.computeLockupMeasurements(g,r,y.heightRatio,r.allCapsAllowed,!0,c.tracking,[],{},void 0,e.forceLetterForma)),_=[new m.TextRange(0,i.chars(o).length)],R=i.clone(f.TypeLockupUtils.computeLockupMeasurements(g,C,y.heightRatio,r.allCapsAllowed,!0,c.tracking,_,c.characterStyles,T,e.forceLetterForma)),I=i.clone(this.getUncompactedAutoRows(b,R,!1,e.highlightMethod));L=i.clone(n.getOptimalCompactedAutoRows(I,b,R,k,h,e.highlightMethod))}if(0==L.length)return e.style.tracking;if(c.tracking>0)for(var w=i.iter(i.range(0,L.length,!1));!w.done;w.next()){var D=w.value;L[D].aspectRatio=0;for(var x=i.iter(i.range(0,L[D].words.length,!1));!x.done;x.next()){var P=x.value;L[D].aspectRatio+=L[D].words[P].aspectRatio,L[D].words[P].canBreak&&P!=L[D].words.length-1?(L[D].words[P].spaceAspectRatio=r.spaceWidthRatio/y.heightRatio,L[D].aspectRatio+=L[D].words[P].spaceAspectRatio):L[D].words[P].spaceAspectRatio=0}}var E=n.getAverageRowAspect(L),M=d*n.getCombinedAspectOfAllRows(L,E/h)/(isFinite(L[0].aspectRatio)?L[0].aspectRatio:1),N=L[0].aspectRatio*M;if(N<l)if(L[0].words.length<=1)v=0;else{var G=(l-N)/i.toDouble(L[0].words.length-1);v=G<1?0:G/(M/y.heightRatio)}else v=-N;return v},calculateLeading:function(e,t){var o=e.text,r=e.style.font.fontData,a=e.containerSize,l=a.width,s=a.height,c=e.style,h=0,d=r.allCapsAllowed?o.toUpperCase():o,g=u.getTypographicBoundingRatiosOfString(d,r),y=c.tracking,v=p.TypeLockupController.HIGHLIGHT_STYLE,S=i.opt(i.opt(c.characterStyles[v],(function(e){return e.font})),(function(e){return e.fontData})),C=1;null!=S&&(C=g.hasUppercase?r.capRatio/S.capRatio:r.meanRatio/S.meanRatio);var T=i.clone(f.TypeLockupUtils.computeLockupMeasurements(d,r,g.heightRatio,!1,!0,y,e.characterStyleRanges,c.characterStyles,C,e.forceLetterForma));if(0==T.length)return e.style.spacing;var A=i.clone(this.getUncompactedRows(T,!1)),F=t.width,k=t.height,L=F/k,b=i.clone(n.compactRowsIntoAspect(A,L,e.style.spacing));if(T.length>1&&(e.highlightMethod==p.HighlightMethod.EvenRows||e.highlightMethod==p.HighlightMethod.OddRows)&&""!=v&&null!=c.characterStyles[v]&&null!=S){var _=i.clone(f.TypeLockupUtils.computeLockupMeasurements(d,r,g.heightRatio,r.allCapsAllowed,!0,c.tracking,[],{},void 0,e.forceLetterForma)),R=[new m.TextRange(0,i.chars(o).length)],I=i.clone(f.TypeLockupUtils.computeLockupMeasurements(d,S,g.heightRatio,r.allCapsAllowed,!0,c.tracking,R,c.characterStyles,C,e.forceLetterForma)),w=i.clone(this.getUncompactedAutoRows(_,I,!1,e.highlightMethod));b=i.clone(n.getOptimalCompactedAutoRows(w,_,I,L,h,e.highlightMethod))}if(b.length<=1)return c.spacing;var D=n.getAverageRowAspect(b);if((k=F/n.getCombinedAspectOfAllRows(b,D/h))<s){var x=l/((s-k)/(i.toDouble(b.length)-1));h=b[0].aspectRatio/x/this.spacingScalar}else h=-k;return h},getUncompactedRows:function(e,t){for(var o=[],n=0;n<e.length;){var r=e[n],i=new c.LockupRowInfo;if(r.isNewLine)o.length>0&&(o[o.length-1].appendable=!1);else{if(!t)for(;!r.canBreak&&n<e.length;)i.addWord(r),(n+=1)<e.length&&(r=e[n]);i.addWord(r),o.push(i)}n+=1}return o},getUncompactedAutoRows:function(e,t,o,n){s.LegacyCoreAssert.isTrue(e.length==t.length,"application of char style to entire range should not change word count",void 0,"EvenRowWidthsLayoutStrategy.getUncompactedAutoRows","EvenRowWidthsLayoutStrategy.swift",827);for(var r=[],i=0,a=n==p.HighlightMethod.EvenRows?0:1,l=0;l<e.length;){var u=i%2==a?t[l]:e[l],h=new c.LockupRowInfo;if(u.isNewLine)r.length>0&&(r[r.length-1].appendable=!1);else{if(!o)for(;!u.canBreak&&l<e.length;)h.addWord(u),(l+=1)<e.length&&(u=e[l]);h.addWord(u),r.push(h),i+=1}l+=1}return r}}}),n)},UGKO:function(e,t,o){var n,r,i=t,a=o("oAGj"),l=o("fNpk"),s=o("8t9B");i.distanceColorWeight=1,i.distanceSizeWeight=.25,i.distancePositionWeight=.5,i.IDesignSuggestion=a.defineProtocol("IDesignSuggestion",{apply:"() -> Void",distanceTo:"(IDesignSuggestion) -> Double",score:"Double",weightedScore:"WeightedScore",forma:"Forma"}),i.DesignTextSuggestion=(n=function(e,t){this.text_=t;var o=a.as(e.controller,s.TypeLockupController);l.LegacyCoreAssert.isTrue(null!=o,"must be type lockup controller",void 0,"DesignTextSuggestion.init","DesignSuggestion.swift",31),this.forma_=e},a.defineClass({name:"DesignTextSuggestion",ctor:n,statics:{_implements:function(e){return"IDesignSuggestion"==e}},props:{apply:function(){var e=this,t=a.as(this.forma_.controller,s.TypeLockupController);a.opt(a.opt(t,(function(e){return e.contentNode})),(function(t){return t.text=e.text_})),a.opt(t,(function(e){return e.updateGroup()})),a.opt(a.opt(this.forma_.page.document,(function(e){return e.controller})),(function(e){return e.controllerSettingsState.settings=null}))},distanceTo:function(e){return l.LegacyCoreAssert.fail("no distance",void 0,"DesignTextSuggestion.distanceTo","DesignSuggestion.swift",45),0},score:{get:function(){return null}},weightedScore:{get:function(){return null}},forma:{get:function(){return this.forma_}}}}),n),i.AddFormaSuggestion=(r=function(e,t){this.parent_=t,this.forma_=e},a.defineClass({name:"AddFormaSuggestion",ctor:r,statics:{_implements:function(e){return"IDesignSuggestion"==e}},props:{apply:function(){this.parent_.appendChild(this.forma_)},distanceTo:function(e){return l.LegacyCoreAssert.fail("no distance",void 0,"AddFormaSuggestion.distanceTo","DesignSuggestion.swift",68),0},score:{get:function(){return null}},weightedScore:{get:function(){return null}},forma:{get:function(){return this.forma_}}}}),r)},UUXZ:function(e,t,o){var n,r,i,a=t,l=o("oAGj");a.IAnnotationsHandler=l.defineProtocol("IAnnotationsHandler",{updateAnnotations:"(IMutableAnnotationsModel) -> Void"}),a.NullAnnotationsHandler=(n=function(){},r={},l.defineClass({name:"NullAnnotationsHandler",ctor:n,statics:{instance:{get:function(){return void 0===r.instance&&(r.instance=new n),r.instance}},_implements:function(e){return"IAnnotationsHandler"==e}},props:{updateAnnotations:function(e){}}}),n),a.StandardAnnotationsHandler=(i=function(e){this.model=e},l.defineClass({name:"StandardAnnotationsHandler",ctor:i,statics:{_implements:function(e){return"IAnnotationsHandler"==e}},props:{updateAnnotations:function(e){var t,o=[];if(t=l.opt(l.opt(this.model,(function(e){return e.owner})),(function(e){return e.selection}))){var n,r,i=l.clone(t.asFormaArray());1==i.length&&(n=i[0].controller)&&(r=n.annotations)&&l.append(o,r)}e.setAll(o)}}}),i)},UqVc:function(e,t,o){var n,r=t,i=o("oAGj");r.SuggestionUtils=(n=function(){},i.defineClass({name:"SuggestionUtils",ctor:n,props:{normalizedWeights:function(e){var t,o,n=[];if(null!=(t=i.min(e))&&null!=(o=i.max(e)))for(var r=o-t==0,a=i.iter(e);!a.done;a.next()){var l=a.value;if(r)n.push(1);else{var s=(l-t)/(o-t);n.push(s)}}return n},weightsEqualNaNOrEmpty:function(e){if(0==e.length==1)return!0;for(var t=i.iter(e);!t.done;t.next()){var o=t.value;if(1==isNaN(o))return!0}return!1}}}),n)},VDg0:function(e,t,o){var n,r=t,i=o("oAGj"),a=o("8t9B");r.LockupConfiguration=(n=function(e,t,o,n,r,l,s,u,c,h,d,g,p,f,m){void 0===n&&(n=null),void 0===r&&(r=null),void 0===l&&(l=!1),void 0===s&&(s=!1),void 0===u&&(u=null),void 0===c&&(c=null),void 0===h&&(h=a.HighlightMethod.Manual),void 0===d&&(d=[]),void 0===g&&(g=[]),void 0===p&&(p=null),void 0===f&&(f=!1),void 0===m&&(m=!1),this.text=e,this.style=t,this.containerSize=o,this.placement=n,this.parentBounds=r,this.useOptimization=l,this.forceLetterForma=s,this.preferredFontSize=u,this.expansionSize=c,this.highlightMethod=h,this.characterStyleRanges=i.clone(d),this.autoTextRanges=i.clone(g),this.rowWordLengths=i.clone(p),this.allowFewerLineBreaks=f,this.fitContainerToArea=m},i.defineClass({name:"LockupConfiguration",ctor:n,props:{clone:function(){return new n(this.text,this.style,this.containerSize,this.placement,this.parentBounds,this.useOptimization,this.forceLetterForma,this.preferredFontSize,this.expansionSize,this.highlightMethod,this.characterStyleRanges,this.autoTextRanges,this.rowWordLengths,this.allowFewerLineBreaks,this.fitContainerToArea)}}}),n)},WlyK:function(e,t,o){var n,r,i=t,a=o("oAGj"),l=o("C42b"),s=o("fNpk"),u=o("3DEm"),c=o("sIWg"),h=o("9BFu");i.RetargetCompatibilityScore=(n=function e(t,o,n){var r,i,d,g,p,f;this.rejectThreshold=-500,h.WeightedScore.call(this,e.Features.NUM_FEAT),this.setWeight(e.Features.LENGTH_TEXT_DIFF,-100),this.setWeight(e.Features.TYPE_RETARGETABLE_IMAGES_DIFF,-200),this.setWeight(e.Features.NUM_RETARGETABLE_IMAGES_DIFF,-1e3),this.setWeight(e.Features.IMAGE_SIMILARITY,-50),this.setWeight(e.Features.DESIGN_SIZE_DIFF,-2e4),this.setWeight(e.Features.GRID_DESIGN,200),this.setWeight(e.Features.FLOATING_IMAGE_DESIGN,300),this.setWeight(e.Features.SALIENT_COVERAGE_DISSIMILARITY,-100),this.setWeight(e.Features.RANDOM_NOISE,-100),this.setFeatureName(e.Features.LENGTH_TEXT_DIFF,"Text Length Difference"),this.setFeatureName(e.Features.NUM_FLOATING_IMAGE_DIFF,"Floating Image Difference"),this.setFeatureName(e.Features.TYPE_RETARGETABLE_IMAGES_DIFF,"Type Retargetable Images Difference"),this.setFeatureName(e.Features.NUM_RETARGETABLE_IMAGES_DIFF,"# Retargetable Images Difference"),this.setFeatureName(e.Features.IMAGE_SIMILARITY,"Image Similarity"),this.setFeatureName(e.Features.DESIGN_SIZE_DIFF,"Design Size Difference"),this.setFeatureName(e.Features.GRID_DESIGN,"Grid Design"),this.setFeatureName(e.Features.FLOATING_IMAGE_DESIGN,"Floating Image Design"),this.setFeatureName(e.Features.SALIENT_COVERAGE_DISSIMILARITY,"Salient Coverage Dissimilarity"),this.setFeatureName(e.Features.RANDOM_NOISE,"Random Noise");var m=a.clone(o.edgeMap),y=a.clone(n.edgeMap);if(null!=y&&null!=m)if(m.length==y.length){for(var v=1e-5,S=a.iter(a.range(0,y.length,!1));!S.done;S.next())v+=y[A=S.value];for(var C=0,T=a.iter(a.range(0,m.length,!1));!T.done;T.next()){var A=T.value;C+=Math.abs(m[A]-y[A]/v)}s.LegacyCoreAssert.isFalse(isNaN(C),"image difference evaluated to NaN",void 0,"RetargetCompatibilityScore.init","RetargetCompatibilityScore.swift",75),this.setFeature(e.Features.IMAGE_SIMILARITY,C)}else this.setFeature(e.Features.IMAGE_SIMILARITY,0);function F(e,t){return e.length>t.length}for(var k=a.sort(o.lockupStrings.concat(),F),L=a.sort(n.lockupStrings.concat(),F),b=(C=[],[]),_=a.iter(a.range(0,Math.min(k.length,L.length),!1));!_.done;_.next()){A=_.value;var R=a.toDouble(k[A].length),I=a.toDouble(L[A].length);C.push(R-I),b.push(Math.max(R,I))}var w=this.norm(C)/(this.norm(b)+.001);this.setFeature(e.Features.LENGTH_TEXT_DIFF,w);var D=a.toInt((r=o.numRetargetableFloatingImages)||null!=r?r:0),x=a.toInt((i=n.numRetargetableFloatingImages)||null!=i?i:this.getNumberOfFloatingImages(n.visualGroupInfo)),P=(d=o.numRetargetableBackgroundImages)||null!=d?d:Math.max(o.numImages-a.toDouble(D),0),E=(g=n.numRetargetableBackgroundImages)||null!=g?g:Math.max(n.numImages-a.toDouble(x),0);this.setFeature(e.Features.NUM_FLOATING_IMAGE_DIFF,a.toDouble(Math.abs(D-x)));var M=(p=o.numRetargetableFloatingImages)||null!=p?p:0,N=(f=n.numRetargetableFloatingImages)||null!=f?f:0,G=P+M,B=E+N,O=Math.abs(G-B);G>B&&(O*=10),this.setFeature(e.Features.NUM_RETARGETABLE_IMAGES_DIFF,O);var U=Math.abs(P-E)+Math.abs(M-N),H=G<4?0:U;0==G&&N>0&&(H=100),this.setFeature(e.Features.TYPE_RETARGETABLE_IMAGES_DIFF,H);var z=N>0?1:0;this.setFeature(e.Features.FLOATING_IMAGE_DESIGN,z);var Y=c.TheoRect.fromSize(n.size),W=c.TheoRect.fromSize(o.size).similarity(Y);this.setFeature(e.Features.DESIGN_SIZE_DIFF,W),this.setFeature(e.Features.GRID_DESIGN,""==n.layoutID?0:1);var V=u.MathUtils.absDouble(o.salientCoverage-n.salientCoverage);this.setFeature(e.Features.SALIENT_COVERAGE_DISSIMILARITY,V),this.setFeature(e.Features.RANDOM_NOISE,a.toDouble(l.CoreRandom.nextInt)/a.toDouble(l.CoreRandom.randMax))},r={},a.defineClass({name:"RetargetCompatibilityScore",ctor:n,superName:"WeightedScore",statics:{Features:{get:function(){return void 0===r.Features&&(r.Features=a.defineEnum("Features",{LENGTH_TEXT_DIFF:0,NUM_FLOATING_IMAGE_DIFF:1,NUM_RETARGETABLE_IMAGES_DIFF:2,TYPE_RETARGETABLE_IMAGES_DIFF:3,FLOATING_IMAGE_DESIGN:4,IMAGE_SIMILARITY:5,DESIGN_SIZE_DIFF:6,GRID_DESIGN:7,SALIENT_COVERAGE_DISSIMILARITY:8,RANDOM_NOISE:9,NUM_FEAT:10})),r.Features}}},props:{norm:function(e){for(var t=0,o=a.iter(e);!o.done;o.next()){var n=o.value;t+=n*n}return Math.sqrt(t)},getNumberOfFloatingImages:function(e){for(var t=0,o=a.iter(e);!o.done;o.next()){var n=o.key,r=o.value;if("type"==n&&"frame"==r)t+=1;else if("children"==n){var i;if(i=a.as(r,["Array",["Dictionary","String","AnyObject"]]))for(var l=a.iter(i);!l.done;l.next()){var s=l.value;t+=this.getNumberOfFloatingImages(s)}}}return t},reject:function(){return this.score<this.rejectThreshold}}}),n)},X1F6:function(e,t,o){var n,r,i=t,a=o("oAGj"),l=o("EGPT"),s=o("ascj"),u=o("QgZx"),c=o("53P9"),h=o("iCxV"),d=o("fNpk"),g=o("cEEQ"),p=o("c+uM"),f=o("tGKA"),m=o("8t9B"),y=o("3UhB"),v=o("oKlP"),S=o("oKI3"),C=o("uUew"),T=o("sIWg"),A=o("1NAc");i.PathLayoutStrategy=(n=function(){this.trackingScalar=1.5,this.precision=.003,this.ascentCoeff=.594,this.concavityCoeff=1,this.requiredCoverageClosed=.99,this.requiredCoverageOpen=.99,this.coverageThresholdMustCenter=.98,this.sampleFontSize=32,this.minFontSize=8,this.maxFontSize=600,this.maxIterations=100,g.BaseLockupLayoutStrategy.call(this)},a.defineClass({name:"PathLayoutStrategy",ctor:n,superName:"BaseLockupLayoutStrategy",statics:{_implements:function(e){return"LockupLayoutStrategy"==e}},props:{supportsConfiguration:function(e){return p.LockupStyle.isPath(e.style.layout)},fitText:function(e){return e.style.alignment!=p.LockupAlignment.Right},layout:function(e){var t,o=e.containerSize,n=e.style,r=n.tracking*this.trackingScalar,i=e.text;i=this.newLinesToSpaces(i);var l=n.font.fontData;l.allCapsAllowed&&(i=i.toUpperCase());var u=g.getTypographicBoundingRatiosOfString(i,l,!1),c=S.TextPathLibrary.getPathForLockupStyle(n),h=this.transformPath(c,o,e.fitContainerToArea),d=h[0];c=h[1];var p=this.precision*d.hypotenuse,m=this.getCorrectedPathLen(c,u.heightFromBaselineRatio*this.sampleFontSize,p),y=c.isClosed()?this.requiredCoverageClosed:this.requiredCoverageOpen,F=this.measureLetters(i,e.characterStyleRanges,this.sampleFontSize,n,l,r,u.hasUppercase,c.isClosed()),k=F.renderableItemCount,L=a.clone(F.letterInfos),b=F.truncatedText,_=this.estimateFontSizeToFit(c,b,L.length,l,u,r,p);_=Math.min(Math.max(this.minFontSize,_),this.maxFontSize);for(var R=0,I=this.minFontSize,w=this.maxFontSize,D=0,x=null;R<this.maxIterations&&I<w;){var P=c.clone();if(P=(x=this.placeLetters(P,L,u,_,p)).path,x.placements.length<L.length)w=_;else{if((D=1-this.getCorrectedPathLen(P,u.heightFromBaselineRatio*this.sampleFontSize,p)/m)>=y)break;I=_}_=(I+w)/2,R+=1}((t=a.opt(x,(function(e){return 0==e.placements.length})))||null!=t)&&t&&(x.placements.push(f.Matrix2D.Identity),D=1),D<this.coverageThresholdMustCenter&&(x=this.placeLettersAndCenter(c,L,u,_,p));var E=this.fitText(e),M=x.bounds,N=M.size,G=1;if(E){var B=e.fitContainerToArea?d:o;(N.width>B.width||N.height>B.height)&&(G=(N=this.getFitSize(M,B)).width/M.width),c=(c=c.offset(v._minus_TheoPoint_TheoPoint(v.TheoPoint.ZERO,M.origin))).multiply(new A.TheoSize(G,G))}for(var O=c.getBounds(),U=u.heightFromBaselineRatio*_*G,H=[],z=a.iter(a.toSequence(x.placements));!z.done;z.next()){var Y=z.value,W=Y.offset,V=Y.element,K=L[W],X=E?M:O,j=(V.tx-X.minX)*G,q=(V.ty-X.minY)*G,Z=new f.Matrix2D(V.a,V.b,V.c,V.d,j,q),J=_*K.fontSizeAdjustRatio*G,Q=g.LockupItem.init_bc20(s.ColorRole.FieldPrimary,K.characterStyle,new A.TheoSize(K.unitWidth*J,U),Z,K.character,K.font,J,J,u,0,new C.TextRange(W,W+1));H.push(Q)}var $=E?T.TheoRect.fromSize(N).unionWith(O).size:O.size;return new g.LayoutResults(H,$,f.Matrix2D.Identity,u,$.aspectRatio,this.getAnnotations(k,H.length))},placeOneLetter:function(e,t,o,n,r){var i=e,l=n*this.ascentCoeff,s=this.concavityCoeff*l,u=e.findTValueByCorrectedPrefixLength(l,s,o,r);if(u>=a.toDouble(e.numSegments))return{placement:null,t:0,path:e};var c=e.findTValueByCorrectedPrefixLength(l,s,t/2,r);d.LegacyCoreAssert.isTrue(c<a.toDouble(e.numSegments),"t-value by corrected prefix length out of range",void 0,"PathLayoutStrategy.placeOneLetter","PathLayoutStrategy.swift",240);var h=e.pointAt(c),g=e.tangentUnitVectorAt(c),p=Math.atan2(g.y,g.x);return{placement:f.Matrix2D.translationXY(-t/2,-n).rotate(Math.cos(p),Math.sin(p)).translate(h),t:u,path:i=i.truncate(u).suffix}},placeLetters:function(e,t,o,n,r){for(var i=o.heightFromBaselineRatio*n,l=0,s=T.TheoRect.Zero,u=[],c=e,h=a.iter(t);!h.done;h.next()){var d=h.value,g=n*d.fontSizeAdjustRatio,p=d.unitWidth*g,f=d.unitTrackedWidth*g,m=d.unitYAdjust*g,y=this.placeOneLetter(c,p,f,i-m,r);c=y.path;var v=y.placement;if(null==v)break;u.push(v);var S=new T.TheoRect(0,0,f,i).transform(v);s=s.unionWith(S),l+=f}return{placements:u,bounds:s,composedWidth:l,path:c}},placeLettersAndCenter:function(e,t,o,n,r){var i=this.placeLetters(e,t,o,n,r);if(i.placements.length<t.length)return i;for(var a=0,l=r,s=0;(Math.abs(a-l)>.01*(a+l)||i.placements.length<t.length)&&s<this.maxIterations;){a>l||i.placements.length<t.length?a-=(a-l)/2:a+=(l-a)/2;var u=e.truncate(e.findTValueByCorrectedPrefixLength(0,0,a,r)).suffix;l=(i=this.placeLetters(u,t,o,n,r)).placements.length<t.length?0:i.path.getLength(r),s+=1}return i},calculateLeading:function(e,t){return e.style.spacing},adjustSizeForLeading:function(e,t,o,n){return A.TheoSize.Zero},calculateTracking:function(e,t){return e.style.tracking},adjustSizeForTracking:function(e,t,o,n){return null},getFitSize:function(e,t,o){void 0===o&&(o=1);var n,r,i=e.width,a=e.height,l=0==a?1/0:i/a,s=t.width,u=t.height,c=s/u,h=o>1?o:1/o;return l<c?(r=u,n=u*(c=Math.min(c,l*h))):(n=s,r=s/(c=Math.max(c,l/h))),new A.TheoSize(n,r)},transformPath:function(e,t,o){var n,r,i=e.getBounds();if(o){var a=i.size,l=Math.sqrt(t.width*t.height/(a.width*a.height));n=(r=e.multiply(new A.TheoSize(l,l))).getBounds().size}else{n=this.getFitSize(i,t,e.flex);var s=0==i.width?1:n.width/i.width,u=0==i.height?1:n.height/i.height;r=e.multiply(new A.TheoSize(s,u))}return[n,r]},getCorrectedPathLen:function(e,t,o){var n=t*this.ascentCoeff,r=this.concavityCoeff*n;return e.getCorrectedLength(n,r,o)},estimateFontSizeToFit:function(e,t,o,n,r,i,l){var s=a.clone(h.Host.textModelUtils.getGlyphPositions(t,n,32,!1)),u=a.toDouble(e.isClosed()?o:o-1)*i*32,c=a.last(s)+u,d=e.getLength(l);return 32*d/(c-(this.getCorrectedPathLen(e,32*r.heightFromBaselineRatio,l)-d))},getCharacterStyle:function(e,t,o){for(var n=a.iter(e);!n.done;n.next()){var r=n.value;if(t>=r.start&&t<r.end)return m.TypeLockupController.HIGHLIGHT_STYLE}return""},measureLetters:function(e,t,o,n,r,l,s,d){var g,p=a.clone(c.GraphemeUtils.splitGraphemes(e)),f=p.length,v=e;f>this.maxLetterLayoutGraphemeCount&&(v=(p=p.slice(0,this.maxLetterLayoutGraphemeCount)).join());var S=p.length,C=a.opt(a.opt(n.characterStyles[m.TypeLockupController.HIGHLIGHT_STYLE],(function(e){return e.font})),(function(e){return e.fontData}))||r,T=y.TypeLockupUtils.getCharFontAdjust(n,s,!1),A=y.TypeLockupUtils.getCharFontYAdjust(n,o,o*T),F=[],k=[],L=[],b=l<=.25;b&&(k=a.clone(h.Host.textModelUtils.getGlyphPositions(e,r,o,!1)),L=a.clone(a.eq(u._equality_FontDescriptor_FontDescriptor,C,r)?k:h.Host.textModelUtils.getGlyphPositions(e,C,o,!1)));for(var _,R,I=!1,w=a.iter(a.toSequence(p));!w.done;w.next()){var D=w.value,x=D.offset,P=D.element,E=(g=R)||null!=g?g:this.getCharacterStyle(t,x,x+1);x<S-1&&(R=this.getCharacterStyle(t,x+1,x+2));var M=E==m.TypeLockupController.HIGHLIGHT_STYLE,N=M?C:r,G=M?T:1,B=M?A/(o*G):0,O=0;if(b&&E==R){var U=a.clone(M?L:k);O=(U[x+1]-U[x])/o}else O=h.Host.textModelUtils.measureBoundsForLayout(P,N,o,0).width/o;var H=new i.LetterInfo(P,N,G,E,O,B,x!=S-1||d?l:0);(I=y.TypeLockupUtils.isWhiteSpace(P))&&(_=H),F.push(H)}return d&&!I&&null!=_&&F.push(_),{renderableItemCount:f,truncatedText:v,letterInfos:F}},newLinesToSpaces:function(e){return a.replaceAll(e,"\n"," ")},reflow:function(e,t,o,n){var r=o.style,i=o.text,l=Math.min(c.GraphemeUtils.countGraphemes(i),this.maxLetterLayoutGraphemeCount)>n.itemsForReflow.length;if(1==S.TextPathLibrary.getPathForLockupStyle(r).flex&&!l){for(var s=n.size,u=e.fitAspectRatioWithin(s.aspectRatio),h=u.width/s.width,d=[],p=a.iter(n.itemsForReflow);!p.done;p.next()){var m,y,v,C,T,A,F=p.value;if(null!=(i=F.text)&&(m=F.font)&&null!=(y=F.pointSize)&&null!=(v=F.rowPointSize)&&(C=F.typographicBoundingRatios)&&null!=(T=F.rowIndex)&&(A=F.rangeInLockup)){var k=y*h;if(k>this.maxFontSize||k<this.minFontSize)return null;var L=F.placement.transformValues,b=L.tx*h,_=L.ty*h,R=f.Matrix2D.rotation(L.rotCosine,L.rotSine).translateXY(b,_),I=g.LockupItem.init_bc20(F.colorRole,F.characterStyle,F.size.multiply(h),R,i,m,y*h,v*h,C,T,A);d.push(I)}}return new g.LayoutResults(d,u,n.placement,n.typographicBoundingRatios,n.avgRowAspect,n.annotations)}return null},supportsReturns:function(){return!1},annotate:function(e,t,o,n){var r=c.GraphemeUtils.countGraphemes(e),i=a.clone(this.getAnnotations(r,n)),s=a.clone(g.BaseLockupLayoutStrategy.prototype.annotate.call(this,e,t,o,n));return l.AnnotationState.concat(i,s)},getAnnotations:function(e,t){return t<e?[new l.Annotation(l.AnnotationID.TextTruncated,l.AnnotationPriority.High)]:t>this.maxLetterLayoutRecommendedGraphemeCount?[new l.Annotation(l.AnnotationID.TooMuchCurvedText)]:null}}}),n),i.LetterInfo=(r=function(e,t,o,n,r,i,a){this.character=e,this.font=t,this.fontSizeAdjustRatio=o,this.characterStyle=n,this.unitWidth=r,this.unitYAdjust=i,this.unitTrackedWidth=r+a},a.defineClass({name:"LetterInfo",ctor:r}),r)},XupS:function(e,t,o){var n,r=t,i=o("oAGj"),a=o("ascj"),l=o("JEnV"),s=o("cEEQ"),u=o("c+uM"),c=o("tGKA"),h=o("3DEm"),d=o("EoOi"),g=o("VJ9E"),p=o("ol4x"),f=o("8t9B"),m=o("oKlP"),y=o("1NAc");r.AutoTextLayoutStrategy=(n=function(){this.tokens_=null,this.text_=null,this.typeParams_=null,this.hiliteRanges_=null,this.autoRanges_=null,this.previousAutoAlignment_=u.LockupAlignment.UNSET,this.scale_=1,this.prevStyle_=null,this.prevFont_=null,this.prevHiliteFont_=null,this.prevTracking_=null,this.defaultStrategy_=null,this.cachedTree_=null,this.cachedAspectRatio=1,s.BaseLockupLayoutStrategy.call(this)},i.defineClass({name:"AutoTextLayoutStrategy",ctor:n,superName:"BaseLockupLayoutStrategy",statics:{_implements:function(e){return"LockupLayoutStrategy"==e}},props:{sameStyle:function(e){if(!i.eq(g._equality_TheoFont_TheoFont,this.prevFont_,e.font)||this.prevTracking_!=e.tracking)return!1;var t=i.opt(e.characterStyles[f.TypeLockupController.HIGHLIGHT_STYLE],(function(e){return e.font}));return null==this.prevHiliteFont_?null==t:null!=t&&i.eq(g._equality_TheoFont_TheoFont,this.prevHiliteFont_,t)},supportsConfiguration:function(e){return u.LockupStyle.isAutoLayout(e.style.layout)},calculateTracking:function(e,t){return null!=this.defaultStrategy_?this.defaultStrategy_.calculateTracking(e,t):e.style.tracking},calculateLeading:function(e,t){return null!=this.defaultStrategy_?this.defaultStrategy_.calculateLeading(e,t):e.style.spacing},adjustSizeForTracking:function(e,t,o,n){if(null!=this.defaultStrategy_)return this.defaultStrategy_.adjustSizeForTracking(e,t,o,n);var r;if(this.previousAutoAlignment_!=u.LockupAlignment.UNSET&&(r=this.cachedTree_)){var a=d.TypographyComposer.adjustTree(r,this.previousAutoAlignment_),l=a.tree.getBounds().size;this.tokens_=i.clone(d.TypographyComposer.buildTokenListFromTree(r,this.prevStyle_.font.fontData,i.opt(i.opt(this.prevStyle_.characterStyles[f.TypeLockupController.HIGHLIGHT_STYLE],(function(e){return e.font})),(function(e){return e.fontData})),n));var s=(a=d.TypographyComposer.adjustTree(r,this.previousAutoAlignment_)).tree.getBounds().size;return new y.TheoSize(this.scale_*(s.width-l.width),this.scale_*(s.height-l.height))}return null},adjustSizeForLeading:function(e,t,o,n){if(null!=this.defaultStrategy_)return this.defaultStrategy_.adjustSizeForLeading(e,t,o,n);var r;if(this.previousAutoAlignment_!=u.LockupAlignment.UNSET&&(r=this.cachedTree_)){p.TypographyLayout.lineSpacing=o;var i=d.TypographyComposer.adjustTree(r,this.previousAutoAlignment_),a=i.tree.getBounds().size;p.TypographyLayout.lineSpacing=n;var l=(i=d.TypographyComposer.adjustTree(r,this.previousAutoAlignment_)).tree.getBounds().size;return new y.TheoSize(this.scale_*(l.width-a.width),this.scale_*(l.height-a.height))}return y.TheoSize.Zero},updateTokens:function(e,t,o,n){null!=this.tokens_&&null!=this.text_&&this.text_==e&&null!=this.prevStyle_&&this.sameStyle(t)&&null!=this.hiliteRanges_&&f.TypeLockupController.rangesEqual(this.hiliteRanges_,o)&&null!=this.autoRanges_&&f.TypeLockupController.rangesEqual(this.autoRanges_,n)||(this.text_=e,this.hiliteRanges_=o.concat(),this.autoRanges_=n.concat(),this.previousAutoAlignment_=u.LockupAlignment.UNSET,this.prevStyle_=t,this.prevFont_=t.font,this.prevHiliteFont_=i.opt(t.characterStyles[f.TypeLockupController.HIGHLIGHT_STYLE],(function(e){return e.font})),this.prevTracking_=t.tracking,this.cachedTree_=null,this.tokens_=i.clone(d.TypographyComposer.buildTokenList(this.text_,this.hiliteRanges_,this.autoRanges_,t)))},layout:function(e){if(!d.TypographyComposer.canHandleText(e.text)||0==e.autoTextRanges.length||e.style.alignment==u.LockupAlignment.UNSET)return null==this.defaultStrategy_&&(this.defaultStrategy_=new l.EvenRowHeightsLayoutStrategy(u.LockupAlignment.Left)),i.opt(this.defaultStrategy_,(function(t){return t.layout(e)}));this.defaultStrategy_=null;var t,o=[],n=f.TypeLockupController.HIGHLIGHT_STYLE,r=e.containerSize,g=e.style.alignment;this.updateTokens(e.text,e.style,e.characterStyleRanges,e.autoTextRanges);var p=e.style.relativeFontScale==u.LockupStyle.UNSET_RELATIVE_FONT_SCALE?d.TypographyComposer.getDefaultRelativeFontScale(g):e.style.relativeFontScale;this.typeParams_=new d.TypographyParams(r,e.style.spacing,p);var y,v=new d.TypographyComposer(this.typeParams_,this.tokens_);null!=this.cachedTree_&&this.previousAutoAlignment_==g&&h.MathUtils.absDouble(this.cachedAspectRatio-r.aspectRatio)<.1?y=d.TypographyComposer.layoutTree(this.cachedTree_):(y=v.layout(g),this.cachedTree_=y.tree),this.previousAutoAlignment_=g;var S=y.tree.getBounds();e.fitContainerToArea?this.scale_=Math.sqrt(r.width*r.height/(S.width*S.height)):r.aspectRatio>S.aspectRatio?this.scale_=r.height/S.height:this.scale_=r.width/S.width;for(var C=new s.TypographicBoundingRatios(0,0,0,0,0,!1),T=i.clone(y.matrices),A=e.style,F=new m.TheoPoint(S.minX,S.minY),k=i.iter(i.toSequence(y.tokens));!k.done;k.next()){var L,b=k.value,_=b.offset,R=b.element,I=y.matrices[_].calculateTransformValuesSKRT(),w=this.scale_*I.yscale*d.TypographyComposer.DEFAULT_FONT_SIZE,D=c.Matrix2D.Identity.rotate(I.rotCosine,I.rotSine).translateTo((I.tx-F.x)*this.scale_,(I.ty-F.y)*this.scale_-R.postVertOffset*w);L=1==R.styleWeight&&i.opt(i.opt(A.characterStyles[n],(function(e){return e.font})),(function(e){return e.fontData}))||A.font.fontData;var x=s.LockupItem.init_bc20(a.ColorRole.FieldPrimary,1==R.styleWeight?n:null,T[_].transformRect(R.bounds).size.multiply(this.scale_),D,R.text,L,w,w,C,_,R.range);o.push(x)}return t=S.size.multiply(this.scale_),this.cachedAspectRatio=t.aspectRatio,new s.LayoutResults(o,t,c.Matrix2D.Identity,C,0,s.BaseLockupLayoutStrategy.createMultipleReturnAnnotations(e.text))}}}),n)},YSlt:function(e,t,o){var n,r,i=t,a=o("oAGj"),l=o("iCxV"),s=o("3DEm"),u=o("Zifs");i.ColorForComparison=(n=function(){this.role=""},a.defineClass({name:"ColorForComparison",ctor:n,props:{init_c063:function(e,t,o){void 0===o&&(o=""),this.color=e,this.weight=t,this.role=o},init_implicit:function(e,t,o){void 0===o&&(o=""),this.color=e,this.weight=t,this.role=o},clone:function(){return n.init_implicit(this.color,this.weight,this.role)}}}),n),i.ColorRankSuggester=(r=function(){},a.defineClass({name:"ColorRankSuggester",ctor:r,superName:"CoreObject",props:{weightedColorContrastRanker:function(e,t,o){var n;void 0===o&&(o=!1);var r=15*a.toDouble(e.length);o&&(r*=2);for(var i=a.repeat(0,t.length),l=a.iter(a.range(0,t.length,!1));!l.done;l.next()){for(var s=l.value,c=t[s],h=0,d=a.iter(a.range(0,e.length,!1));!d.done;d.next()){var g,p=d.value;if(g=e[p].color){var f=(n=e[p].weight)||null!=n?n:1;if(a.eq(u._equality_SolidColor_SolidColor,c,g))h+=1;else{var m=(1*g.perceptualDifference(c)+50*Math.pow(g.lightnessDifference(c)/50,2)*.7)/2;i[s]+=m*f}}}var y=a.toDouble(h)/a.toDouble(e.length);y>.4||h==e.length||i[s]<r?i[s]=0:i[s]*=1-y}return i},getVarianceOfColors:function(e){if(e.length<1)return a.opt(l.Host.logging,(function(e){return e.info("ColorRankSuggester.getVarianceOfColors() has no colors in listOfCompared")})),0;var t=[];t.push([]),t.push([]),t.push([]),t.push([]);for(var o=a.iter(e);!o.done;o.next()){var n;(n=(f=o.value).color)&&(t[0].push(n.red),t[1].push(n.green),t[2].push(n.blue),t[3].push(n.alpha))}for(var r=[],i=a.iter(t);!i.done;i.next()){var c,h=i.value;null!=(c=s.MathUtils.getMean(h))&&r.push(c)}if(4!=r.length)return a.opt(l.Host.logging,(function(e){return e.info("ColorRankSuggester.getVarianceOfColors(): Unable to get complete avgRGBA values. # Values = "+a.toString(r.length))})),0;for(var d=new u.SolidColor(r[0],r[1],r[2],r[3]),g=[],p=a.iter(e);!p.done;p.next()){var f;(f=p.value.color)&&g.push(f.perceptualDifference(d))}return this.getVarianceFromDifferences(g)},getVarianceFromDifferences:function(e){for(var t=0,o=a.iter(e);!o.done;o.next()){var n=o.value;t+=n*n}return t/a.toDouble(e.length)}}}),r)},ZK0l:function(e,t,o){var n,r=t,i=o("oAGj"),a=o("SpAV"),l=o("CWW7"),s=o("yGNn"),u=o("ascj"),c=o("FNB+"),h=o("H9Ol"),d=o("6ZWm"),g=o("yHU1"),p=o("Pil/"),f=o("cmoc"),m=o("x7yN"),y=o("/afT"),v=o("pnSN"),S=o("X0GW"),C=o("NkBu"),T=o("U010"),A=o("fdtz"),F=o("lmwz"),k=o("fNpk"),L=o("tGKA"),b=o("JFv5"),_=o("voLh"),R=o("DjTP"),I=o("T6jX"),w=o("8t9B"),D=o("mL0c"),x=o("zjod"),P=o("QTen");r.GroupController=(n=function(e,t,o){this.preserveResizeController_=!1,this.resizeLayoutController_=null,this.preferrededResizeType_=null,this.lastLayoutType_=null,h.FormaController.call(this,e,t,o)},i.defineClass({name:"GroupController",ctor:n,superName:"FormaController",statics:{KIND:{get:function(){return"group"}},USER_GROUP_PROPERTY:"user-group",isImageOrVideo:function(e){return e.kind==A.ImageForma.KIND||e.kind==x.VideoForma.KIND}},props:{oldBounds:{get:function(){return this.oldBounds_}},updatedChild:{get:function(){return this.updatedChild_},set:function(e){this.updatedChild_=e}},preserveResizeController:{get:function(){return this.preserveResizeController_},set:function(e){this.preserveResizeController_=e}},preferredResizeType:{get:function(){return this.preferrededResizeType_},set:function(e){this.preferrededResizeType_=e}},resizeLayoutController:{get:function(){return this.resizeLayoutController_}},lastLayoutType:{get:function(){return this.lastLayoutType_}},selectable:{get:function(){return this.userGroup}},duplicatable:{get:function(){return this.userGroup}},replaceable:{get:function(){return!1}},userGroup:{get:function(){var e;return!(!(e=i.opt(this.forma,(function(e){return e.hasIntent(c.Forma.INTENT_USER_GROUP)})))&&null==e)&&e}},maintainAspectRatio:{get:function(){if(this.userGroup)return!0;if(this.forma.hasIntent(c.Forma.INTENT_INFERRED_TEMP_GROUP))for(var e=i.iter(this.forma.visitAsArray(c.FormaTraversal.JustChildren));!e.done;e.next()){var t=e.value;if(null!=t.controller&&t.finalFrame.equalWithAccuracy(this.forma.finalFrame,10))return t.controller instanceof w.TypeLockupController||t.controller.maintainAspectRatio}return!1}},clone:function(e){return h.FormaController.prototype.clone.call(this,e)},addFormaToGroup:function(e){var t;(t=i.as(this.forma,v.GroupForma))&&t.appendChild(e,!0)},removeFormaFromGroup:function(e){var t;(t=i.as(this.forma,v.GroupForma))&&(i.opt(i.as(e.controller,n),(function(e){return e.handleRemoval()})),t.removeChild(e))},handleRemoval:function(){},replaceChildWithForma:function(e,t,o){var r,a;if(void 0===o&&(o=!1),n.isImageOrVideo(e)&&k.LegacyCoreAssert.isTrue(t.kind==e.kind,"replacing an ImageForma or VideoForma with an unexpected kind",{kind:t.kind},"GroupController.replaceChildWithForma","GroupController.swift",206),(a=i.as(this.forma,v.GroupForma))&&null!=(r=a.indexOfChild(e))){a.insertChildAt(t,r),null!=e.allowUserMove&&(t.allowUserMove=e.allowUserMove),t.matchColors(e),t.style.blendMode=e.style.blendMode;var l,s,h,g=e.rotationInRadians();if(e.controller.rotate(-g),t.isLogo()||t.isSticker()||F.ImageFacade.getCutoutModeForForma(e)!=T.CutoutMode.Off&&F.ImageFacade.canSetTightCropToCutoutMask(i.as(e,f.FrameForma))?t.controller.fitInArea(e.frame):(t.allowUserMove=!1,t.controller.fit(e.frame)),t.allowUserMove=e.allowUserMove,t.intent=e.intent,F.ImageFacade.formaHasMask(e)&&(l=F.ImageFacade.getFrameFormaForForma(e))&&(s=i.opt(F.ImageFacade.getFrameFormaForForma(t),(function(e){return e.controller})))&&(h=i.opt(F.ImageFacade.getImageFormaForForma(t),(function(e){return e.controller})))&&l.placement.determinant<0){var p=l.placement.transformValuesRKST.yscale<0;s.flip(p),h.flip(p)}e.controller.rotate(g),t.controller.rotate(g),e.removeFromParent();var m,y=i.clone(t.filterWithCallback(n.isImageOrVideo)),S=i.clone(e.filterWithCallback(n.isImageOrVideo));if(y.length>0){for(var b=i.iter(y);!b.done;b.next()){var _,R,I=b.value;if((_=i.as(I,A.ImageForma))&&i.as(I.controller,C.ImageController)&&(_.hasAlpha()&&e.isBackgroundImage()&&(I.allowUserMove=!1),!_.hasAlpha()||t.isLogo()||t.isSticker()||(R=i.as(t.controller,d.FrameController))&&R.fitWithCrop(e.frame,d.CropType.FitBorder)),S.length>0){var w,D,x,E,M=o,N=S[0];if(w=i.as(N,A.ImageForma)){var G,B,O=w.style.clone();(G=i.as(O,P.VideoStyle))&&((B=i.as(I.style,P.VideoStyle))?(G.startTime=B.startTime,G.duration=B.duration):t.isImage()&&!t.isVideo()&&(O=G.downgradeToImageStyle())),I.applyStyle(O)}if(0==M&&(D=i.opt(i.opt(i.as(I,A.ImageForma),(function(e){return e.contentNode})),(function(e){return e.mediaMetadata})))&&(x=i.opt(i.opt(i.as(N,A.ImageForma),(function(e){return e.contentNode})),(function(e){return e.mediaMetadata})))&&null!=D.assetID&&null!=x.assetID&&D.assetID==x.assetID&&(M=!0),1==M){var U=I,H=N,z=L.Matrix2D.uniformScaling(U.bounds.aspectRatio>=1?U.bounds.width/H.bounds.width:U.bounds.height/H.bounds.height);U.placement=z.inverse.concat(H.placement)}(E=F.ImageFacade.getMaskFormaForForma(e))&&F.ImageFacade.setMaskForForma(t,E)}}var Y;(Y=i.as(y[0],A.ImageForma))&&i.opt(i.opt(Y.contentNode,(function(e){return e.image})),(function(e){return e.whenLoaded().then((function(e){return Y.page.colorLibraryController.extractImageColors()}))}))}(m=i.opt(i.opt(i.opt(this.forma,(function(e){return e.page.document})),(function(e){return e.controller})),(function(e){return e.selection})))&&(m.removeStaleSelections(),m.isSelected(e)&&m.deselectForma(e),k.LegacyCoreAssert.isTrue(m.selectedCount==m.asFormaArray().length,"selection count does not match number of entries in selected forma array",void 0,"GroupController.replaceChildWithForma","GroupController.swift",372))}else if(a=i.as(this.forma,f.FrameForma)){var W,V;null!=e.frame&&i.eq(c._equality_Forma_Forma,F.ImageFacade.getMaskFormaForForma(a),e)&&(F.ImageFacade.setMaskForForma(a,t),null!=e.allowUserMove&&(t.allowUserMove=e.allowUserMove),null!=(W=e.style.colors.colorID(u.ColorRole.FieldPrimary))&&t.style.colors.setColorId(u.ColorRole.FieldPrimary,W),null!=(V=e.style.colors.colorID(u.ColorRole.FieldSecondary))&&t.style.colors.setColorId(u.ColorRole.FieldSecondary,V))}},match:function(e){h.FormaController.prototype.match.call(this,e),this.updateGroup()},postClone:function(e){},getPinBounds:function(e){return e==D.PinBoundsType.ChildrenBounds?this.forma.childrenBoundsInCoordSpace(L.Matrix2D.Identity):i.opt(this.forma,(function(e){return e.bounds}))},processEvent:function(e){var t,o,n,r;if(r=i.as(e,p.BeginPointerTrackingEvent)){var a=!(!(t=i.opt(i.opt(this.forma,(function(e){return e.controller})),(function(e){return e.userGroup})))&&null==t)&&t,l=(o=i.opt(i.opt(i.opt(this.forma,(function(e){return e.page.document})),(function(e){return e.controller})),(function(e){return e.selection.selectedCount})))||null!=o?o:0,s=!(!(n=i.opt(i.opt(i.opt(this.forma,(function(e){return e.page.document})),(function(e){return e.controller})),(function(e){return e.selection.isSelected(r.dragTargetForma)})))&&null==n)&&n,u=!1;return l<=1&&s&&(u=this.forma.page.document.controller.enableMoveableChildren),r.trackingResponse=a&&!u?g.BeginPointerTrackingResponseEnum.TrackAsGroup:g.BeginPointerTrackingResponseEnum.TrackWithinGroup,!1}return h.FormaController.prototype.processEvent.call(this,e)},childUpdate:function(e){void 0===e&&(e=null),this.updatedChild_=e,this.updateGroup()},beginChildResizeEvent:function(e){},endChildResizeEvent:function(e){var t,o;((t=i.opt(i.opt(i.opt(this.forma,(function(e){return e.page.document})),(function(e){return e.controller})),(function(e){return e.selection.inCropMode})))||null!=t)&&t||!(o=i.opt(i.opt(this.forma,(function(e){return e.controller})),(function(e){return e.userGroup})))&&null==o||!o||S.GroupFacade.updateUserGroupHierarchy(this.forma)},processBeginFormaResize:function(e){h.FormaController.prototype.processBeginFormaResize.call(this,e),this.preserveResizeController_=!0},processEndFormaResize:function(e){h.FormaController.prototype.processEndFormaResize.call(this,e),this.preserveResizeController_=!1},childMoveableInDirection:function(e,t){return!0},groupVisualParent:{get:function(){return y.GroupDetector.getGroupVisualParent(this.forma)}},processFormaDrag:function(e){h.FormaController.prototype.processFormaDrag.call(this,e)},processBeginFormaDrag:function(e){h.FormaController.prototype.processBeginFormaDrag.call(this,e)},processEndFormaDrag:function(e){h.FormaController.prototype.processEndFormaDrag.call(this,e)},afterProcessBeginFormaDrag:function(e){e.dragDelegate.draggedFormae.forEach((function(e){return i.opt(i.opt(e.controller,(function(e){return e.alignmentDetector})),(function(e){return e.update(!0)}))}))},canClaimForma:function(e){return!1},claimForma:function(e){this.forma!=e.parent&&!i.eq(c._equality_Forma_Forma,this.forma,e)&&this.canClaimForma(e)&&i.opt(i.as(this.forma,v.GroupForma),(function(t){return t.appendChild(e,!0)}))},beginUpdateGroup:function(e){void 0===e&&(e=null),null==this.oldBounds_&&(this.oldBounds_=null!=e?e:i.opt(this.forma,(function(e){return e.bounds})),null==this.resizeLayoutController_&&this.setCurrentResizeLayoutController(),this.blockUpdate||i.opt(this.resizeLayoutController_,(function(e){return e.beginUpdateGroup()})))},setCurrentResizeLayoutController:function(){var e=this.preferredResizeType;if(null==e){var t=this.forma.childCount;e=this.userGroup?b.ResizeLayoutType.Proportional:t>I.TheoDocumentUtils.DESIGN_COMPLEXITY_HEURISTIC_THRESHOLD?b.ResizeLayoutType.Fit:t<=3||this.kind!=n.KIND?b.ResizeLayoutType.Pin:b.ResizeLayoutType.Spring}e==b.ResizeLayoutType.Pin?this.resizeLayoutController_=new b.PinLayoutController(this.forma):e==b.ResizeLayoutType.Spring?(this.kind==w.TypeLockupController.KIND&&k.LegacyCoreAssert.fail("Don't use a spring layout with a typelockup. It's overkill and lockups should be extremely fast.",void 0,"GroupController.setCurrentResizeLayoutController","GroupController.swift",565),this.resizeLayoutController_=new R.SpringLayoutController(this.forma)):e==b.ResizeLayoutType.Proportional?this.resizeLayoutController_=new _.ProportionalLayoutController(this.forma):e==b.ResizeLayoutType.Fit?this.resizeLayoutController_=new m.FitLayoutController(this.forma):(a.CoreAssert.fail("Invalid layout type, defaulting to proportional",void 0,"GroupController.setCurrentResizeLayoutController","GroupController.swift",577),this.resizeLayoutController_=new _.ProportionalLayoutController(this.forma)),this.lastLayoutType_=e},endUpdateGroup:function(){this.oldBounds_=null,this.blockUpdate||i.opt(this.resizeLayoutController_,(function(e){return e.endUpdateGroup()})),this.preserveResizeController_||(this.resizeLayoutController_=null)},updateGroup:function(){this.blockUpdate||null==this.oldBounds_||this.oldBounds_.equal(this.forma.bounds)||(this.beginBlockedUpdate(),i.opt(this.resizeLayoutController_,(function(e){return e.updateGroup()})),this.endBlockedUpdate())},applyColors:function(e,t){if(void 0===t&&(t=u.ColorRole.FieldPrimary),this.userGroup)for(var o=i.iter(this.forma.visitAsArray(c.FormaTraversal.JustChildren));!o.done;o.next()){var n;(n=o.value.controller)&&n.applyColors(e,t)}else h.FormaController.prototype.applyColors.call(this,e,t)},currentOpacity:{get:function(){for(var e,t=[],o=i.iter(this.forma.visitAsArray(c.FormaTraversal.JustChildren));!o.done;o.next()){var n=o.value,r=(e=i.opt(n.controller,(function(e){return e.currentOpacity})))||null!=e?e:1;t.includes(r)||t.push(r)}return t.length>0?t.length>1?1:t[0]:1}},applyOpacity:function(e){if(this.userGroup)for(var t=i.iter(this.forma.visitAsArray(c.FormaTraversal.JustChildren));!t.done;t.next()){var o;(o=t.value.controller)&&o.applyOpacity(e)}else h.FormaController.prototype.applyOpacity.call(this,e)},copyTo:function(e,t,o,n){void 0===e&&(e=null),void 0===t&&(t=null),void 0===o&&(o=null),void 0===n&&(n=!0);var r,a=this;return this.userGroup?(r=i.as(this.forma,v.GroupForma))?l.CreationFacade.copyItems(r.childrenAsArray,e,n,void 0,t,o).then((function(e){return S.GroupFacade.groupItems(e)})).then((function(e){var t;return(t=i.as(e,c.Forma))?(t.match(a.forma),t):null})):s.CorePromise.reject("Should never get here. GroupController must have a GroupForma"):h.FormaController.prototype.copyTo.call(this,e,t,null,n)},doesContrast:function(){var e;if(e=i.as(this.forma,v.GroupForma))for(var t=i.iter(i.range(0,e.childCount,!1));!t.done;t.next()){var o,n=t.value;if((o=i.opt(e.childAt(n),(function(e){return e.controller})))&&!o.doesContrast())return!1}return!0},contrastCheck:function(e){if(void 0===e&&(e=!0),this.userGroup)for(var t=i.iter(this.forma.visitAsArray(c.FormaTraversal.JustChildren));!t.done;t.next()){var o;(o=t.value.controller)&&o.contrastCheck(e)}else h.FormaController.prototype.contrastCheck.call(this,e)}}}),n)},ZLO9:function(e,t,o){var n,r=t,i=o("oAGj"),a=o("gXiO");r.RetargetDocumentData=(n=function(e,t,o,n,r,l,s,u,c,h,d,g,p){this.docID=e,this.size=t,this.lockupStrings=i.clone(o),this.focus=n,this.numImages=r,this.edgeMap=i.clone(s),this.layoutID=u,this.numMoveable=l,this.numGridCells=c,this.textRoles=i.clone(h),this.shapeRoles=i.clone(d),this.salientCoverage=g,this.visualGroupInfo=i.clone(p),a.CoreObject.call(this)},i.defineClass({name:"RetargetDocumentData",ctor:n,superName:"CoreObject"}),n)},Zc5V:function(e,t,o){var n,r=t,i=o("oAGj");r.GridArrangementUtils=(n=function(){},i.defineClass({name:"GridArrangementUtils",ctor:n,statics:{MAX_COLS:100,ASPECT_RATIO_EPSILON:.005,getArrangement:function(e,t,o,r){var a=i.max(r),l=e*i.toDouble(o)/i.toDouble(a),s=n.getBestFittingArrangement(l,t,a),u=s.numCols,c=n.evaluateAllSegments(e,t,o,r,u),h=c.penalty,d=c.aspectRatioDelta;if(0!=h)for(var g=n.getColumnCountSearchRange(o,u),p=i.iter(i.range(g.start,g.end,!0));!p.done;p.next()){var f=p.value;if(f!=s.numCols){var m=(c=n.evaluateAllSegments(e,t,o,r,f)).penalty,y=c.aspectRatioDelta;(m<h||m==h&&y<d)&&(u=f,h=m,d=y)}}return{numRows:n.getNumRows(o,u),numCols:u}},getNumRows:function(e,t){return i.toInt(e/t)+(e%t==0?0:1)},getGridAspectRatio:function(e,t,o){var r=n.getNumRows(t,o);return i.toDouble(o)/i.toDouble(r)*e},getBestFittingArrangement:function(e,t,o,r,a){var l,s;void 0===r&&(r=1),void 0===a&&(a=n.MAX_COLS);var u=Math.min(o,a);if(r<u){l=i.toInt((r+u)/2),s=n.getGridAspectRatio(t,o,l);var c=Math.abs(e-s);if(c>n.ASPECT_RATIO_EPSILON){var h,d=(h=s<e?n.getBestFittingArrangement(e,t,o,l+1,u):n.getBestFittingArrangement(e,t,o,r,l-1)).numCols,g=h.aspectRatio;Math.abs(e-g)<c&&(l=d,s=g)}}else s=n.getGridAspectRatio(t,o,l=r);return{numCols:l,aspectRatio:s}},evaluateAllSegments:function(e,t,o,r,a){for(var l=0,s=0,u=i.iter(r);!u.done;u.next()){var c=u.value;n.evaluateOneSegment(c,a)||(l+=1),s+=1/n.getGridAspectRatio(t,c,a)}return s=1/s,{penalty:l,aspectRatioDelta:Math.abs(e-s)}},evaluateOneSegment:function(e,t){if(e<=t)return!0;var o=e%t;0==o&&(o=t);var r=i.toDouble(o)/i.toDouble(t),a=.5;return t>4&&n.getNumRows(e,t)>2&&(a=.25),r>=a},getColumnCountSearchRange:function(e,t){var o=Math.min(2,i.toInt(e/6));return{start:Math.max(1,t-o),end:Math.min(t+o,e)}}}}),n)},aKgf:function(e,t,o){var n,r,i,a=t,l=o("oAGj"),s=o("tGKA"),u=o("358a"),c=o("Ird5"),h=o("jfma"),d=o("sq5L"),g=o("yjxF"),p=o("Aj79"),f=o("Ucb9"),m=o("g6aL"),y=o("kwVJ"),v=o("Zifs"),S=o("Q+4n"),C=o("hgLm"),T=o("oKlP"),A=o("sIWg"),F=o("1NAc");a.IViewHandler=l.defineProtocol("IViewHandler",{fitToView:"() -> Void",fillToView:"() -> Void",zoomTo:"(Double) -> Void",zoomToPoint:"(Double, TheoPoint, Boolean) -> Void",zoomByMatrix:"(Matrix2D) -> Void",panBy:"(TheoPoint) -> Void",panTo:"(TheoPoint) -> Void",canPan:"() -> Boolean",setViewSize:"(TheoSize) -> Void",pageSizeChanged:"() -> Void",getViewToDocMatrix:"() -> Matrix2D",getFitScale:"() -> Double",getFillScale:"() -> Double",getMinScale:"() -> Double",getMaxScale:"() -> Double",getFullCanvasGraph:"(PGMExportSettings, Boolean) -> PGMGraph"}),a.NullViewHandler=(n=function(){},r={},l.defineClass({name:"NullViewHandler",ctor:n,statics:{instance:{get:function(){return void 0===r.instance&&(r.instance=new n),r.instance}},_implements:function(e){return"IViewHandler"==e}},props:{fitToView:function(){},fillToView:function(){},zoomTo:function(e){},zoomToPoint:function(e,t,o){},zoomByMatrix:function(e){},panBy:function(e){},panTo:function(e){},canPan:function(){return!1},setViewSize:function(e){},pageSizeChanged:function(){},getViewToDocMatrix:function(){return s.Matrix2D.Identity},getFitScale:function(){return 1},getFillScale:function(){return 1},getMinScale:function(){return.05},getMaxScale:function(){return 8},getFullCanvasGraph:function(e,t){return null}}}),n),a.StandardViewHandler=(i=function(e,t){this.dc=e,this.model=t},l.defineClass({name:"StandardViewHandler",ctor:i,statics:{PASTEBOARD_ENTITY:"pasteboard",PASTEBOARD_GROUP_ENTITY:"pasteboard-group",_implements:function(e){return"IViewHandler"==e}},props:{fitToView:function(){var e;if(e=this.model){var t=this.getFitScale();e.beginUpdates(),e.mutable.view.setFit(!0),e.mutable.view.setScale(t),l.opt(this.dc,(function(e){return e.viewScale=t})),e.mutable.view.setOffset(T.TheoPoint.ZERO),e.updatesComplete()}},fillToView:function(){var e;if(e=this.model){var t=this.getFillScale();e.beginUpdates(),e.mutable.view.setFill(!0),e.mutable.view.setScale(t),l.opt(this.dc,(function(e){return e.viewScale=t}));var o=e.mutable.view.getOffset(),n=this.validateOffset(new T.TheoPoint(0,o.y));e.mutable.view.setOffset(n),e.updatesComplete()}},zoomTo:function(e){var t;if(t=this.model){t.beginUpdates();var o=t.mutable.view.getScale(),n=t.mutable.view.getOffset();t.mutable.view.setFit(!1),t.mutable.view.setFill(!1);var r=Math.min(Math.max(this.getMinScale(),e),this.getMaxScale());t.mutable.view.setScale(r),l.opt(this.dc,(function(e){return e.viewScale=r}));var i=n.multiply(r/o);this.panTo(i),t.updatesComplete()}},zoomToPoint:function(e,t,o){var n;if(n=this.model){var r=this.getViewToDocMatrix().transformPoint(t);n.beginUpdates(),this.zoomTo(e);var i=l.opt(this.getViewToDocMatrix().inverse,(function(e){return e.transformPoint(r)}))||T.TheoPoint.ZERO;if(o)this.panBy(T._minus_TheoPoint_TheoPoint(i,t));else{var a=A.TheoRect.fromSize(n.mutable.view.getViewSize());this.panBy(T._minus_TheoPoint_TheoPoint(i,a.center))}n.updatesComplete()}},zoomByMatrix:function(e){var t;if(t=this.model){var o=e.transformValues,n=t.mutable.view.getScale()*o.xscale,r=new T.TheoPoint(o.tx,o.ty);t.beginUpdates(),this.panBy(r),this.zoomTo(n),t.updatesComplete()}},canPan:function(){var e;if(e=this.model){var t=this.getFitScale();if(e.view.getScale()>t)return!0;var o,n=e.view.getPanInsets();if(!n.equal(S.TheoInsets.Zero)&&(o=l.opt(e.activePage.get(),(function(e){return e.pageSize})))){var r=e.view.getScale(),i=A.TheoRect.fromSize(o.multiply(r)),a=A.TheoRect.fromSize(e.view.getViewSize()).withInsets(n);if(i.width>a.width||i.height>a.height)return!0}}return!1},panBy:function(e){var t;if(t=this.model){t.beginUpdates();var o=t.mutable.view.getOffset(),n=T._plus_TheoPoint_TheoPoint(o,e),r=this.validateOffset(n);t.mutable.view.setOffset(r),t.updatesComplete()}},panTo:function(e){var t;if(t=this.model){t.beginUpdates();var o=this.validateOffset(e);t.mutable.view.setOffset(o),t.updatesComplete()}},setViewSize:function(e){var t;if(t=this.model){if(t.beginUpdates(),t.mutable.view.setViewSize(e),t.mutable.view.getFit())this.fitToView();else if(t.mutable.view.getFill())this.fillToView();else{var o=t.mutable.view.getOffset(),n=this.validateOffset(o);this.panTo(n)}t.updatesComplete()}},pageSizeChanged:function(){var e;(e=this.model)&&(e.view.getViewSize().equal(F.TheoSize.Zero)||this.fitToView())},getViewToDocMatrix:function(){var e,t,o=s.Matrix2D.Identity;if((e=this.model)&&(t=l.opt(e.activePage.get(),(function(e){return e.pageSize})))){var n=e.view.getScale(),r=e.view.getViewSize(),i=A.TheoRect.fromSize(r).center,a=t.multiply(n).multiply(.5);o=o.translateXY(a.width-i.x,a.height-i.y);var u=e.view.getOffset();o=(o=o.translate(u)).scaleXY(1/n,1/n)}return o},getFitScale:function(){var e,t;if((e=this.model)&&(t=l.opt(e.activePage.get(),(function(e){return e.pageSize})))){var o=e.mutable.view.getViewSize(),n=e.mutable.view.getMargin(),r=Math.max(10,o.width-2*n),i=Math.max(10,o.height-2*n),a=new F.TheoSize(r,i),s=t.myAspectRatioFitWithin(a);return Math.min(Math.max(this.getMinScale(),s.width/t.width),this.getMaxScale())}return 1},getFillScale:function(){var e,t;if((e=this.model)&&(t=l.opt(e.activePage.get(),(function(e){return e.pageSize})))){var o=e.mutable.view.getViewSize(),n=e.mutable.view.getMargin(),r=Math.max(10,o.width-2*n),i=Math.max(10,o.height-2*n),a=new F.TheoSize(r,i),s=t.myAspectRatioFillWithin(a);return Math.min(Math.max(this.getMinScale(),s.width/t.width),this.getMaxScale())}return 1},getMinScale:function(){return.05},getMaxScale:function(){return 8},validateOffset:function(e){if(!this.canPan())return T.TheoPoint.ZERO;var t,o;if((t=this.model)&&(o=l.opt(t.activePage.get(),(function(e){return e.pageSize})))){var n=t.view.getViewSize(),r=t.view.getScale(),i=o.multiply(r),a=e,s=t.view.getMargin(),u=A.TheoRect.fromSize(i),c=A.TheoRect.fromSize(n),h=u.moveToPoint(c.center.add(e),new T.TheoPoint(.5,.5));h.minX>c.center.x?h=h.moveToPoint(new T.TheoPoint(c.center.x,h.minY),new T.TheoPoint(0,0)):h.maxX<c.center.x&&(h=h.moveToPoint(new T.TheoPoint(c.center.x,h.minY),new T.TheoPoint(1,0)),a=new T.TheoPoint(-i.width/2+n.width/2-s,a.y)),a=T._minus_TheoPoint_TheoPoint(h.center,c.center),h.minY>c.center.y?h=h.moveToPoint(new T.TheoPoint(h.minX,c.center.y),new T.TheoPoint(0,0)):h.maxY<c.center.y&&(h=h.moveToPoint(new T.TheoPoint(h.minX,c.center.y),new T.TheoPoint(0,1))),a=T._minus_TheoPoint_TheoPoint(h.center,c.center);var d=this.getFitScale();return(t.mutable.view.getFit()||r<d)&&(a=new T.TheoPoint(a.x,0)),a}return e},getFullCanvasGraph:function(e,t){var o,n,r;if((o=this.model)&&(n=l.opt(this.dc,(function(e){return e.document})))&&(r=u.PagesFacade.getActivePage(n).pgm.getGraph(e))){t&&(r=y.PGMWatermarkingUtils.addWatermark(r));var a=A.TheoRect.fromSize(o.mutable.view.getViewSize()),S=o.view.getScale(),F=l.opt(this.getViewToDocMatrix().inverse,(function(e){return e.transformPoint(T.TheoPoint.ZERO)}))||T.TheoPoint.ZERO,k=new v.SolidColor(245/255,245/255,245/255,1),L=A.TheoRect.fromSize(o.mutable.view.getViewSize()),b=new C.TheoRectanglePath(L),_=new f.PGMShape(i.PASTEBOARD_ENTITY,g.PGMNodeMetadata.EMPTY,c.PGMAnimationList.EMPTY,a,[b],k),R=new p.PGMReference(_,new h.PGMCompositingParams(s.Matrix2D.Identity)),I=new p.PGMReference(r.root,new h.PGMCompositingParams(s.Matrix2D.scalingXY(S,S).translate(F))),w=new m.PGMSimpleGroup(i.PASTEBOARD_GROUP_ENTITY,g.PGMNodeMetadata.EMPTY,c.PGMAnimationList.EMPTY,[R,I]);return new d.PGMGraph(w,a,r.duration,r.resources)}return null}}}),i)},aO0D:function(e,t,o){var n,r,i,a,l,s=t,u=o("oAGj"),c=o("gXiO");s.CropAsset=(n=function(e,t){this.id=e,this.iconId=t},u.defineClass({name:"CropAsset",ctor:n,superName:"CoreObject"}),n),s.CropShape=(r=function(e,t,o){this.fixAspectRatio=o,s.CropAsset.call(this,e,t)},u.defineClass({name:"CropShape",ctor:r,superName:"CropAsset"}),r),s.RasterMask=(i=function(e,t,o,n,r){void 0===r&&(r="image/png"),this.width=o,this.height=n,this.mimeType=r,s.CropAsset.call(this,e,t)},u.defineClass({name:"RasterMask",ctor:i,superName:"CropAsset"}),i),s.CropAssetLibrary=(a=function(){c.CoreObject.call(this)},l={},u.defineClass({name:"CropAssetLibrary",ctor:a,superName:"CoreObject",statics:{shapes:{get:function(){return void 0===l.shapes&&(l.shapes=[new s.CropShape("circle","crop_shape_circle",!0),new s.CropShape("roundedRectangle","crop_shape_roundedRectangle",!1),new s.CropShape("equilateralTriangle","crop_shape_equilateralTriangle",!1),new s.CropShape("rightTriangle","crop_shape_rightTriangle",!1),new s.CropShape("oval","crop_shape_oval",!1),new s.CropShape("halfCircle","crop_shape_halfCircle",!0),new s.CropShape("diamond","crop_shape_diamond",!1),new s.CropShape("hexagon","crop_shape_hexagon",!1),new s.CropShape("parallelogram","crop_shape_parallelogram",!1),new s.CropShape("pentagon","crop_shape_pentagon",!1),new s.CropShape("heart","crop_shape_heart",!0),new s.CropShape("star","crop_shape_star",!0)]),l.shapes}},rasterMasks:{get:function(){return void 0===l.rasterMasks&&(l.rasterMasks=[new s.RasterMask("raster-01","raster-01",1418,1050),new s.RasterMask("raster-Brush-Frame-1","raster-Brush-Frame-1",1126,1050),new s.RasterMask("raster-Brush-Frame-2","raster-Brush-Frame-2",1126,1050),new s.RasterMask("raster-Brush-Frame-3","raster-Brush-Frame-3",1126,1050),new s.RasterMask("raster-Torn-Edge-1","raster-Torn-Edge-1",956,1050),new s.RasterMask("raster-Torn-Edge-2","raster-Torn-Edge-2",755,1050),new s.RasterMask("raster-Torn-Edge-3","raster-Torn-Edge-3",1400,2161),new s.RasterMask("raster-Torn-Edge-4","raster-Torn-Edge-4",956,1050),new s.RasterMask("raster-film-frame-2","raster-film-frame-2",616,1050),new s.RasterMask("raster-film-strip-frame-1","raster-film-strip-frame-1",850,782)]),l.rasterMasks}},getListOfShapes:function(){return a.shapes},getListOfRasterMasks:function(){return a.rasterMasks},getCropShapeFromID:function(e){return a.shapes.find((function(t){return t.id==e}),this)},getRasterMaskFromID:function(e){return a.rasterMasks.find((function(t){return t.id==e}),this)}}}),a)},"aen+":function(e,t,o){var n,r=t,i=o("oAGj"),a=o("H9Ol");r.AbsolutePositionController=(n=function(e,t,o){a.FormaController.call(this,e,t,o)},i.defineClass({name:"AbsolutePositionController",ctor:n,superName:"FormaController",statics:{KIND:{get:function(){return"AbsolutePositionController"}}}}),n)},"b/QB":function(e,t,o){var n,r=t,i=o("oAGj"),a=o("yhkb"),l=o("gXiO"),s=o("ascj"),u=o("4JYN"),c=o("SDdr"),h=o("uWOl"),d=o("fNpk"),g=o("Zifs");r.ImageFilterLibrary=(n=function(){this.styleMixes={Darken:[.1,.3,.5,.7]},this.duotonePresetCategories=["kPop","kBold","kSoft"],this.duotonePresets=[new u.DuotonePreset(g.SolidColor.fromHex(5082,1),g.SolidColor.fromHex(1114024,1),"kPop"),new u.DuotonePreset(g.SolidColor.fromHex(751854,1),g.SolidColor.fromHex(15789840,1),"kPop"),new u.DuotonePreset(g.SolidColor.fromHex(5082,1),g.SolidColor.fromHex(1110527,1),"kPop"),new u.DuotonePreset(g.SolidColor.fromHex(14883254,1),g.SolidColor.fromHex(16247874,1),"kPop"),new u.DuotonePreset(g.SolidColor.fromHex(4325517,1),g.SolidColor.fromHex(16752147,1),"kPop"),new u.DuotonePreset(g.SolidColor.fromHex(4135615,1),g.SolidColor.fromHex(16707312,1),"kPop"),new u.DuotonePreset(g.SolidColor.fromHex(0,1),g.SolidColor.fromHex(16771584,1),"kBold"),new u.DuotonePreset(g.SolidColor.fromHex(0,1),g.SolidColor.fromHex(65496,1),"kBold"),new u.DuotonePreset(g.SolidColor.fromHex(0,1),g.SolidColor.fromHex(16711680,1),"kBold"),new u.DuotonePreset(g.SolidColor.fromHex(0,1),g.SolidColor.fromHex(4849045,1),"kBold"),new u.DuotonePreset(g.SolidColor.fromHex(16735699,1),g.SolidColor.fromHex(16777215,1),"kBold"),new u.DuotonePreset(g.SolidColor.fromHex(58623,1),g.SolidColor.fromHex(16777215,1),"kBold"),new u.DuotonePreset(g.SolidColor.fromHex(9907339,1),g.SolidColor.fromHex(7789055,1),"kSoft"),new u.DuotonePreset(g.SolidColor.fromHex(28017,1),g.SolidColor.fromHex(16753128,1),"kSoft"),new u.DuotonePreset(g.SolidColor.fromHex(1973790,1),g.SolidColor.fromHex(16767731,1),"kSoft"),new u.DuotonePreset(g.SolidColor.fromHex(2038862,1),g.SolidColor.fromHex(16777215,1),"kSoft"),new u.DuotonePreset(g.SolidColor.fromHex(5709851,1),g.SolidColor.fromHex(16771003,1),"kSoft"),new u.DuotonePreset(g.SolidColor.fromHex(12865137,1),g.SolidColor.fromHex(15460804,1),"kSoft")],this._duotonePresetIndex=-1,this.imageStyles=[h.ImageStyle.init_1265(h.ImageStyle.NAME_NONE),h.ImageStyle.init_1265(h.ImageStyle.NAME_GREYSCALE,s.ColorTable.init_25f6([{key:s.ColorRole.FieldPrimary,value:"themeDerivedDark"},{key:s.ColorRole.FieldSecondary,value:"themeDerivedLight"}]),c.CompositeFilter.init_514f(void 0,"Duotone",1,"normal",void 0,void 0,"duotone")),h.ImageStyle.init_1265(h.ImageStyle.NAME_DARKEN,s.ColorTable.init_25f6([{key:s.ColorRole.FieldPrimary,value:"themeDerivedDark"},{key:s.ColorRole.FieldSecondary,value:"themeDerivedDark"}]),c.CompositeFilter.init_514f(void 0,"Duotone",.5,"normal",void 0,void 0,"duotone")),h.ImageStyle.init_1265(h.ImageStyle.NAME_BLUR,null,c.CompositeFilter.init_514f(void 0,"Blur",1,"none",void 0,void 0,"none")),h.ImageStyle.init_1265(h.ImageStyle.NAME_OVERLAY,s.ColorTable.init_25f6([{key:s.ColorRole.FieldPrimary,value:i.as(a.ColorLibraryController.FILTER_OVERLAY_KEYS[0],"String")}]),c.CompositeFilter.init_514f(void 0,"ReduceContrastOverlay",.25,"overlay",!1,.5,"offset",1,1)),h.ImageStyle.init_1265(h.ImageStyle.NAME_MULTIPLY,s.ColorTable.init_25f6([{key:s.ColorRole.FieldPrimary,value:a.ColorLibraryController.FILTER_MULTIPLY_KEYS[1]}]),c.CompositeFilter.init_514f(void 0,"DesaturateMultiply",.4,"multiply",!0,void 0,"offset",.5,1)),h.ImageStyle.init_1265(h.ImageStyle.NAME_BLEND,s.ColorTable.init_25f6([{key:s.ColorRole.FieldPrimary,value:a.ColorLibraryController.FILTER_BLEND_KEYS[2]}]),c.CompositeFilter.init_514f(void 0,"Blend",.3,"normal",!1,void 0,"none")),h.ImageStyle.init_1265(h.ImageStyle.NAME_DUOTONE,s.ColorTable.init_25f6([{key:s.ColorRole.FieldPrimary,value:i.as(a.ColorLibraryController.FILTER_DUOTONE_LOW_KEYS[2],"String")},{key:s.ColorRole.FieldSecondary,value:i.as(a.ColorLibraryController.FILTER_DUOTONE_HIGH_KEYS[0],"String")}]),c.CompositeFilter.init_514f(void 0,"Duotone",1,"normal",void 0,void 0,"duotone")),h.ImageStyle.init_1265(h.ImageStyle.NAME_SCREEN,s.ColorTable.init_25f6([{key:s.ColorRole.FieldPrimary,value:a.ColorLibraryController.FILTER_SCREEN_KEYS[0]}]),c.CompositeFilter.init_514f(void 0,"Screen",.4,"screen",!1,void 0,"none")),h.ImageStyle.init_1265(h.ImageStyle.NAME_NEWDUOTONE,s.ColorTable.init_2768(g.SolidColor.BLACK,g.SolidColor.WHITE),c.CompositeFilter.init_514f(void 0,"Duotone",1,"normal",void 0,void 0,"duotone"))],l.CoreObject.call(this)},i.defineClass({name:"ImageFilterLibrary",ctor:n,superName:"CoreObject",props:{getImageStyle:function(e){for(var t,o=i.iter(this.imageStyles);!o.done;o.next()){var n=o.value;if(e==n.name){t=n;break}}return t},getAllImageStyles:function(){return this.imageStyles},getDefaultDuotonePreset:function(e){var t=i.clone(this.getDuotonePresets());return-1==this._duotonePresetIndex?this._duotonePresetIndex=0:e&&(this._duotonePresetIndex=(this._duotonePresetIndex+1)%t.length),t[this._duotonePresetIndex]},getDuotonePresetCategories:function(){return this.duotonePresetCategories},getDuotonePresets:function(){return this.duotonePresets},getDuotonePresetAtIndex:function(e){var t=i.clone(this.getDuotonePresets());return e>=0&&e<t.length?t[e]:(d.LegacyCoreAssert.fail("Bad duotone preset index",void 0,"ImageFilterLibrary.getDuotonePresetAtIndex","ImageFilterLibrary.swift",296),u.DuotonePreset.DEFAULT)},getDuotonePresetIndex:function(e){for(var t=i.iter(i.toSequence(this.getDuotonePresets()));!t.done;t.next()){var o=t.value,n=o.offset,r=o.element;if(i.eq(u._equality_DuotonePreset_DuotonePreset,e,r)||i.eq(u._equality_DuotonePreset_DuotonePreset,e,r.swap()))return n}return-1},getNextImageStyleOfSameType:function(e,t){void 0===t&&(t=!0);var o,n,r,l,u=e.name,g=!0;switch(u){case"None":o=this.getImageStyle(h.ImageStyle.NAME_NONE);break;case"Greyscale":o=this.getImageStyle(h.ImageStyle.NAME_GREYSCALE);break;case"Blur":o=this.getImageStyle(h.ImageStyle.NAME_BLUR);break;case"Darken":(o=i.as(this.getImageStyle(h.ImageStyle.NAME_DARKEN).clone(),h.ImageStyle)).colorLibrary=e.colorLibrary;break;case"Overlay":case"Multiply":case"Blend":case"Screen":if((o=i.as(this.getImageStyle(u).clone(),h.ImageStyle)).colorLibrary=e.colorLibrary,null==(m=e.colors.colorID(s.ColorRole.FieldPrimary)))return d.LegacyCoreAssert.fail("Style missing FieldPrimary key",{styleName:u},"ImageFilterLibrary.getNextImageStyleOfSameType","ImageFilterLibrary.swift",348),null;var p=a.ColorLibraryController.getNextKeyInSet(m),f=p[0];g=A=p[1],o.colors.setColorId(s.ColorRole.FieldPrimary,f);break;case"DuoTone":var m;if((o=i.as(this.getImageStyle(h.ImageStyle.NAME_DUOTONE).clone(),h.ImageStyle)).colorLibrary=e.colorLibrary,null==(m=e.colors.colorID(s.ColorRole.FieldPrimary)))return d.LegacyCoreAssert.fail("Missing color key",void 0,"ImageFilterLibrary.getNextImageStyleOfSameType","ImageFilterLibrary.swift",363),null;var y,v=a.ColorLibraryController.getNextKeyInSet(m),S=v[0];if(v[1],o.colors.setColorId(s.ColorRole.FieldPrimary,S),null==(y=e.colors.colorID(s.ColorRole.FieldSecondary)))return d.LegacyCoreAssert.fail("Missing color key",void 0,"ImageFilterLibrary.getNextImageStyleOfSameType","ImageFilterLibrary.swift",377),null;var C=a.ColorLibraryController.getNextKeyInSet(y),T=C[0],A=C[1];o.colors.setColorId(s.ColorRole.FieldSecondary,T),g=A;break;case"NewDuoTone":(o=i.as(this.getImageStyle(u).clone(),h.ImageStyle)).colorLibrary=e.colorLibrary;var F=e.colors.fieldShadows;o.colors.fieldShadows=e.colors.fieldHighlights,o.colors.fieldHighlights=F;break;default:o=this.getImageStyle(h.ImageStyle.NAME_NONE)}if((n=this.styleMixes[u])&&null!=(r=i.opt(i.as(e.filter,c.CompositeFilter),(function(e){return e.mix})))&&t&&g&&null!=(l=i.indexOf(n,r))){var k=n[(l+1)%n.length];o.filter.mix=k}return i.opt(o,(function(t){return t.adjustments=e.adjustments})),i.opt(o,(function(t){return t.opacity=e.opacity})),o},getImageStyles:function(){return[this.getImageStyle(h.ImageStyle.NAME_NONE),this.getImageStyle(h.ImageStyle.NAME_NEWDUOTONE),this.getImageStyle(h.ImageStyle.NAME_GREYSCALE),this.getImageStyle(h.ImageStyle.NAME_DARKEN),this.getImageStyle(h.ImageStyle.NAME_OVERLAY),this.getImageStyle(h.ImageStyle.NAME_BLEND),this.getImageStyle(h.ImageStyle.NAME_SCREEN),this.getImageStyle(h.ImageStyle.NAME_DUOTONE),this.getImageStyle(h.ImageStyle.NAME_MULTIPLY)]},hasNextStyleOfSameType:function(e){var t;return!!(t=this.getNextImageStyleOfSameType(e,!0))&&!e.equals(t)}}}),n)},bSZx:function(e,t,o){var n,r=t,i=o("oAGj"),a=o("P83h"),l=o("9Lk3");r.GridSuggestion=(n=function(e,t,o){void 0===e&&(e=null),this.gridStyle_=t,this.forma_=e,this.score_=o},i.defineClass({name:"GridSuggestion",ctor:n,superName:"CoreObject",props:{gridStyle:{get:function(){return this.gridStyle_}},score:{get:function(){return this.score_.score}},weightedScore:{get:function(){return this.score_}},apply:function(){if(i.info("Grid score:"),i.info(this.score_.asString),null!=this.forma_){var e,t=new a.FormaTransformChangedEvent(this.forma_);this.forma_.beginUpdate(t),(e=i.as(this.forma_.controller,l.GridController))&&(this.gridStyle_.forma=this.forma_,e.applyGridStyleWithMapping(this.gridStyle_,!0)),this.forma_.endUpdate(t)}}}}),n)},bccX:function(e,t,o){var n,r=t,i=o("oAGj"),a=o("7siz");r.IAttributesModel=i.defineProtocol("IAttributesModel",{find:"(String) -> IEditorAttribute"}),r.AttributesState=(n=function(e){void 0===e&&(e=null),this.attributes=i.clone(e||{})},i.defineClass({name:"AttributesState",ctor:n,superName:"EditorStateMember",statics:{_implements:function(e){return"IAttributesModel"==e}},props:{clone:function(){return new n(this.attributes)},find:function(e){return this.attributes[e]},add:function(e){this.beforeChange(),this.attributes[e.key]=e,this.afterChange()},remove:function(e){this.beforeChange(),i.removeKey(this.attributes,e),this.afterChange()},clear:function(){this.beforeChange(),i.removeAll(this.attributes),this.afterChange()},diff:function(e){for(var t=[],o=i.iter(this.attributes);!o.done;o.next()){var n,r=o.key,l=o.value;(n=e.attributes[r])&&l.isEqualTo(n)||t.push(a.EditorModelChangedMessage.CHG_ATTRIBUTE_PREFIX+r)}for(var s=i.iter(e.attributes);!s.done;s.next())r=s.key,null==this.attributes[r]&&t.push(a.EditorModelChangedMessage.CHG_ATTRIBUTE_PREFIX+r);return t}}}),n)},bqbo:function(e,t,o){var n,r,i,a,l,s,u,c,h,d,g,p,f,m,y,v,S,C,T,A=t,F=o("oAGj"),k=o("Tq01"),L=o("0wFF"),b=o("Dz6V"),_=o("aO0D"),R=o("CWW7"),I=o("yGNn"),w=o("iCxV"),D=o("U010"),x=o("q5zr"),P=o("fdtz"),E=o("lmwz"),M=o("uWOl"),N=o("358a"),G=o("T6jX"),B=o("Kkml");A.ReplaceImagesWithColorsAction=(n=function e(t,o,n){void 0===n&&(n=!0),this.formae=F.clone(t),this.colors=F.clone(o),this.selectReplacements=n,k.Action.call(this,e.TYPE)},F.defineClass({name:"ReplaceImagesWithColorsAction",ctor:n,superName:"Action",statics:{TYPE:"ReplaceImagesWithColorsAction"},props:{getUserAction:function(e){return B.UserActions.ReplaceImageWithShape()},execute:function(e){var t=F.clone(this.formae||e.selection.asFormaArray()),o=F.clone(E.ImageFacade.replaceImagesWithColors(t,this.colors));return G.TheoDocumentUtils.updateConstrainedImageInfo(e.document),0==o.length?I.CorePromise.reject("did not get any Forma back from ImageFacade.replaceImageWithColors"):(this.newSelection=F.clone(o),I.CorePromise.resolve(new k.FormaActionResult(o)))},updateSelection:function(e){return null!=this.newSelection&&this.selectReplacements&&e.selection.replaceSelectionWithFormae(this.newSelection),this.newSelection}}}),n),A.SetImageFilterAction=(r=function e(t,o,n,r){void 0===o&&(o=!1),void 0===n&&(n=null),void 0===r&&(r=null),this.style=t,this.applyFilterToAllBackgroundImages=o,this.shadowsColor=n,this.highlightsColor=r,k.Action.call(this,e.TYPE)},F.defineClass({name:"SetImageFilterAction",ctor:r,superName:"Action",statics:{TYPE:"SetImageFilterAction"},props:{getUserAction:function(e){return B.UserActions.ApplyFilter()},execute:function(e){var t,o;return this.style.name==M.ImageStyle.NAME_NEWDUOTONE&&((t=this.shadowsColor)&&(this.style.colors.fieldShadows=t),(o=this.highlightsColor)&&(this.style.colors.fieldHighlights=o)),E.ImageFacade.applyImageFilter(e,this.style,this.applyFilterToAllBackgroundImages),I.CorePromise.resolve(null)}}}),r),A.ShuffleImageFilterAction=(i=function e(t,o,n){void 0===n&&(n=!1),this.style=t,this.page=o,this.applyFilterToAllBackgroundImages=n,k.Action.call(this,e.TYPE)},F.defineClass({name:"ShuffleImageFilterAction",ctor:i,superName:"Action",statics:{TYPE:"ShuffleImageFilterAction"},props:{getUserAction:function(e){return B.UserActions.ShuffleFilter()},execute:function(e){var t=this.page.imageFilterLibrary.getNextImageStyleOfSameType(this.style,!0);return null!=t&&E.ImageFacade.applyImageFilter(e,t,this.applyFilterToAllBackgroundImages),I.CorePromise.resolve(new k.ImageStyleActionResult(t))}}}),i),A.SetImageCutoutAction=(a=function e(t,o,n,r,i,a){void 0===n&&(n=D.ImageCutoutModelLibrary.CURRENT_MODEL),void 0===r&&(r=D.ImageCutoutModelLibrary.DEFAULT_MASK_SIZE),void 0===i&&(i=D.ImageCutoutModelLibrary.DEFAULT_TIMEOUT),void 0===a&&(a=!0),this.formaToMask=t,this.cutout=o,this.model=n,this.maskSize=r,this.timeout=i,this.allowTightCrop=a,k.Action.call(this,e.TYPE,new k.ActionExecutionOptions(b.ActionFeedbackWaitingType.Loading,b.ActionFeedbackMessageType.Error))},F.defineClass({name:"SetImageCutoutAction",ctor:a,superName:"Action",statics:{TYPE:"SetImageCutoutAction"},props:{getUserAction:function(e){return B.UserActions.SetImageCutout()},execute:function(e){var t,o=this;return(t=E.ImageFacade.getFrameFormaForForma(this.formaToMask))?this.cutout.mode==D.CutoutMode.Off?(F.opt(w.Host.logging,(function(e){return e.logToAnalytics(L.AnalyticsConstants.kAnalyticsDataEditImageRestoreBackgroundApplied,{})})),E.ImageFacade.removeCutoutMaskFromImage(t)):E.ImageFacade.createAndLoadCutoutMaskForImage(t,this.model,this.maskSize,this.timeout,this.cutout.mode).then((function(e){var n;return(n=F.as(e,P.ImageForma))&&E.ImageFacade.finalizeCutoutAfterMaskLoad(t,n,o.cutout.mode,null,null,o.allowTightCrop),null})):I.CorePromise.reject("Failed to apply cutout to forma")}}}),a),A.ApplyCutoutMaskToImageAction=(l=function e(t,o,n,r,i,a){void 0===r&&(r=null),void 0===i&&(i=null),void 0===a&&(a=D.CutoutMode.Off),this.forma=t,this.url=o,this.mimeType=n,this.componentID=r,this.maskMetadata=i,this.mode=a,k.Action.call(this,e.TYPE)},F.defineClass({name:"ApplyCutoutMaskToImageAction",ctor:l,superName:"Action",statics:{TYPE:"ApplyCutoutMaskToImageAction"},props:{getUserAction:function(e){return B.UserActions.ApplyCutoutMaskToImage()},execute:function(e){var t,o=this;return(t=E.ImageFacade.getFrameForForma(this.forma))?E.ImageFacade.applyCutoutMaskToImage(t,this.url,this.mimeType,this.componentID,this.maskMetadata).then((function(e){var n,r;return(n=F.as(e,P.ImageForma))&&(E.ImageFacade.finalizeCutoutAfterMaskLoad(t,n,o.mode,void 0,void 0,!0,!1),w.Host.platform.isWeb||(r=n.contentNode)&&null==o.maskMetadata&&r.removeTag(x.ImageContentNode.IMAGE_MASK_METADATA_TAG)),null})):I.CorePromise.reject("Failed to apply cutout to forma")}}}),l),A.EnterRefineCutoutModeAction=(s=function e(t){this.forma=t,k.Action.call(this,e.TYPE)},F.defineClass({name:"EnterRefineCutoutModeAction",ctor:s,superName:"Action",statics:{TYPE:"EnterRefineCutoutModeAction"},props:{getUserAction:function(e){return B.UserActions.EnterRefineCutoutMode()},execute:function(e){var t;if(t=E.ImageFacade.getFrameFormaForForma(this.forma)){var o=t.page.refineCutoutController.enterRefineCutoutMode(t);return I.CorePromise.fromCoreError(o)}return I.CorePromise.reject("Not an image or frame")}}}),s),A.ExitRefineCutoutModeAction=(u=function e(t,o,n){void 0===n&&(n=!0),this.forma=t,this.commit=o,this.isMaskDirty=n,k.Action.call(this,e.TYPE,new k.ActionExecutionOptions(b.ActionFeedbackWaitingType.Loading,b.ActionFeedbackMessageType.Error))},F.defineClass({name:"ExitRefineCutoutModeAction",ctor:u,superName:"Action",statics:{TYPE:"ExitRefineCutoutModeAction"},props:{getUserAction:function(e){return B.UserActions.ExitRefineCutoutMode()},execute:function(e){var t;return(t=E.ImageFacade.getFrameFormaForForma(this.forma))?t.page.refineCutoutController.exitRefineCutoutMode(t,this.commit,this.isMaskDirty):I.CorePromise.reject("Not an image or frame")}}}),u),A.UpdateCutoutMaskMode=F.defineEnum("UpdateCutoutMaskMode",{RefineCutout:0,ResetToOriginal:1,Invert:2,AutoCutout:3}),A.UpdateCutoutMaskAction=(c=function e(t,o,n,r,i,a){void 0===o&&(o=A.UpdateCutoutMaskMode.RefineCutout),void 0===r&&(r=null),void 0===i&&(i=D.CutoutMode.BackgroundRemoval),void 0===a&&(a=null),this.forma=t,this.maskUpdateMode=o,this.url=n,this.componentID=r,this.cutoutMode=i,this.maskMetadata=a,k.Action.call(this,e.TYPE)},F.defineClass({name:"UpdateCutoutMaskAction",ctor:c,superName:"Action",statics:{TYPE:"UpdateCutoutMaskAction"},props:{getUserAction:function(e){switch(this.maskUpdateMode){case 3:return B.UserActions.SetImageCutout();case 2:return B.UserActions.InvertCutoutMask();case 1:return B.UserActions.RemoveCutoutMaskCompletely();case 0:return B.UserActions.UpdateCutoutMask()}},execute:function(e){var t,o,n;return(t=E.ImageFacade.getCutoutMaskFormaForForma(this.forma))&&(o=t.contentNode)?(E.ImageFacade.setCutoutModeForForma(this.forma,this.cutoutMode),(n=this.maskMetadata)?o.setTag(x.ImageContentNode.IMAGE_MASK_METADATA_TAG,n.encode()):o.removeTag(x.ImageContentNode.IMAGE_MASK_METADATA_TAG),o.url=this.url,o.componentID=this.componentID,I.CorePromise.resolve(null)):I.CorePromise.reject("Mask or content node missing")}}}),c),A.ToggleRefineCutoutFullImageAction=(h=function e(t){this.forma=t,k.Action.call(this,e.TYPE)},F.defineClass({name:"ToggleRefineCutoutFullImageAction",ctor:h,superName:"Action",statics:{TYPE:"ToggleRefineCutoutFullImageAction"},props:{getUserAction:function(e){return B.UserActions.ToggleRefineCutoutFullImage()},execute:function(e){var t;if(t=E.ImageFacade.getFrameFormaForForma(this.forma)){var o=t.page.refineCutoutController.toggleUnmaskedImage(t);return I.CorePromise.fromCoreError(o)}return I.CorePromise.reject("Not an image or frame")}}}),h),A.ChangeImageAdjustmentsAction=(d=function(){},F.defineClass({name:"ChangeImageAdjustmentsAction",ctor:d,superName:"Action",statics:{TYPE:"ChangeImageAdjustmentsAction",ActionWithDictionary:function(e,t){return void 0===t&&(t=null),d.init_f8e4(e,t)},ActionWithKeyValue:function(e,t,o){return void 0===o&&(o=null),d.init_dd66(e,t,o)}},props:{init_dd66:function(e,t,o){void 0===o&&(o=null),this.adjustments=F.dict([e,t]),this.formaeToAdjust=F.clone(o),k.Action.call(this,d.TYPE)},init_f8e4:function(e,t){void 0===t&&(t=null),this.adjustments=F.clone(e),this.formaeToAdjust=F.clone(t),k.Action.call(this,d.TYPE)},getUserAction:function(e){return B.UserActions.ChangeImageAdjustments()},execute:function(e){var t=this;return F.clone(this.formaeToAdjust||e.selection.asFormaArray()).forEach((function(e){if(e.isImage()){var o,n=E.ImageFacade.getImageFormaForForma(e);if(o=F.opt(n,(function(e){return e.style}))){for(var r=F.iter(t.adjustments);!r.done;r.next()){var i=r.key,a=r.value;o.adjustments=F.opt(o.adjustments,(function(e){return e.copyWithNewValue(a,i)}))}F.opt(n,(function(e){return e.applyStyle(o)}))}}})),I.CorePromise.resolve(null)}}}),d),A.ApplyShapeMaskToImageAction=(g=function e(t,o,n){void 0===o&&(o=null),void 0===n&&(n=null),this.forma=t,this.shapeId=o,this.usingFrameBounds=n,k.Action.call(this,e.TYPE)},F.defineClass({name:"ApplyShapeMaskToImageAction",ctor:g,superName:"Action",statics:{TYPE:"ApplyShapeMaskToImageAction"},props:{getUserAction:function(e){return B.UserActions.ApplyShapeMaskToImage()},execute:function(e){var t,o,n;return null!=(t=this.shapeId)?(o=_.CropAssetLibrary.getCropShapeFromID(t))&&(n=E.ImageFacade.getFrameFormaForForma(this.forma))?E.ImageFacade.applyMaskToForma(n,o,this.usingFrameBounds).thenReturn(null):I.CorePromise.reject("Failed to apply shape mask to forma"):(E.ImageFacade.removeMaskForForma(this.forma),I.CorePromise.resolve(null))}}}),g),A.ApplyRasterMaskToImageAction=(p=function e(t,o,n,r){void 0===o&&(o=null),void 0===n&&(n=!0),void 0===r&&(r=null),this.forma=t,this.rasterMaskId=o,this.removeClipMask=n,this.usingFrameBounds=r,k.Action.call(this,e.TYPE)},F.defineClass({name:"ApplyRasterMaskToImageAction",ctor:p,superName:"Action",statics:{TYPE:"ApplyRasterMaskToImageAction"},props:{getUserAction:function(e){return B.UserActions.ApplyRasterMaskToImage()},execute:function(e){var t,o,n,r,i;return null!=(t=this.rasterMaskId)?(o=_.CropAssetLibrary.getRasterMaskFromID(t))&&(n=E.ImageFacade.getFrameFormaForForma(this.forma))?E.ImageFacade.applyMaskToForma(n,o,this.usingFrameBounds).thenReturn(null):I.CorePromise.reject("Failed to apply raster mask to forma"):(this.removeClipMask&&E.ImageFacade.removeMaskForForma(this.forma),(r=E.ImageFacade.getCutoutMaskFormaForForma(this.forma))&&(i=r.contentNode)&&(E.ImageFacade.removeCutoutForForma(this.forma),R.CreationFacade.removeContentNodeFromDocument(i,e.document)),I.CorePromise.resolve(null))}}}),p),A.SetImageAsFloatingAction=(f=function e(){k.Action.call(this,e.TYPE)},F.defineClass({name:"SetImageAsFloatingAction",ctor:f,superName:"Action",statics:{TYPE:"SetImageAsFloatingAction"},props:{getUserAction:function(e){return B.UserActions.SetImageAsFloating()},execute:function(e){var t;return(t=e.selection.formaAt(0))&&E.ImageFacade.setFloatingImage(t),I.CorePromise.resolve(null)}}}),f),A.SetImageAsBackgroundAction=(m=function e(){k.Action.call(this,e.TYPE)},F.defineClass({name:"SetImageAsBackgroundAction",ctor:m,superName:"Action",statics:{TYPE:"SetImageAsBackgroundAction"},props:{getUserAction:function(e){return B.UserActions.SetImageAsBackground()},execute:function(e){var t;return(t=e.selection.formaAt(0))&&E.ImageFacade.setBackgroundImage(t),I.CorePromise.resolve(null)}}}),m),A.AddHiddenImageToGridAction=(y=function e(t){this.formae=F.clone(t),k.Action.call(this,e.TYPE)},F.defineClass({name:"AddHiddenImageToGridAction",ctor:y,superName:"Action",statics:{TYPE:"AddHiddenImageToGridAction"},props:{getUserAction:function(e){return B.UserActions.AddHiddenImageToGrid()},execute:function(e){for(var t=F.iter(this.formae);!t.done;t.next()){var o;(o=t.value.parent)&&E.ImageFacade.addHiddenImageToGrid(o)}return I.CorePromise.resolve(null)}}}),y),A.EnterCropModeAction=(v=function e(t){this.forma=t,k.Action.call(this,e.TYPE)},F.defineClass({name:"EnterCropModeAction",ctor:v,superName:"Action",statics:{TYPE:"EnterCropModeAction"},props:{getUserAction:function(e){return B.UserActions.EnterCropMode()},execute:function(e){var t;return(t=E.ImageFacade.getImageFormaForForma(this.forma))&&E.ImageFacade.enterCropMode(t),I.CorePromise.resolve(null)}}}),v),A.ExitCropModeAction=(S=function e(){k.Action.call(this,e.TYPE)},F.defineClass({name:"ExitCropModeAction",ctor:S,superName:"Action",statics:{TYPE:"ExitCropModeAction"},props:{getUserAction:function(e){return B.UserActions.ExitCropMode()},execute:function(e){var t;return(t=e.document)&&E.ImageFacade.exitCropMode(N.PagesFacade.getActivePage(t).root),I.CorePromise.resolve(null)}}}),S),A.SetImageCropToFreeformAction=(C=function e(t){this.forma=t,k.Action.call(this,e.TYPE)},F.defineClass({name:"SetImageCropToFreeformAction",ctor:C,superName:"Action",statics:{TYPE:"SetImageCropToFreeformAction"},props:{getUserAction:function(e){return B.UserActions.SetImageCropToFreeform()},execute:function(e){return E.ImageFacade.removeMaskForForma(this.forma),E.ImageFacade.setImageCropToFreeform(this.forma),I.CorePromise.resolve(null)}}}),C),A.CropImageToRatioAction=(T=function e(t,o,n){void 0===o&&(o=0),void 0===n&&(n=null),this.forma=t,this.ratio=o,this.usingFrameBounds=n,k.Action.call(this,e.TYPE)},F.defineClass({name:"CropImageToRatioAction",ctor:T,superName:"Action",statics:{TYPE:"CropImageToRatioAction"},props:{getUserAction:function(e){return B.UserActions.CropImageToRatio()},execute:function(e){return E.ImageFacade.cropImageToRatio(this.forma,this.ratio,this.usingFrameBounds),I.CorePromise.resolve(null)}}}),T)},cEBg:function(e,t,o){var n,r,i,a,l,s,u,c,h=t,d=o("oAGj"),g=o("Tq01"),p=o("0wFF"),f=o("yGNn"),m=o("FNB+"),y=o("fWxZ"),v=o("P83h"),S=o("iCxV"),C=o("8vXU"),T=o("K9Oa"),A=o("358a"),F=o("JFv5"),k=o("5XIA"),L=o("uxH+"),b=o("Kkml");h.ChangePageSizeAction=(n=function e(t,o,n,r){void 0===n&&(n=!1),void 0===r&&(r=p.AnalyticsConstants.kAnalyticsDataPageActionLocationEditor),this.pages=d.clone(t),this.designSize=o,this.logAnalytics=n,this.location=r,g.Action.call(this,e.TYPE)},d.defineClass({name:"ChangePageSizeAction",ctor:n,superName:"Action",statics:{TYPE:"ChangePageSizeAction"},props:{getUserAction:function(e){var t=A.PagesFacade.getScopeIdentifier(this.pages);return b.UserActions.ChangePageSize(t)},execute:function(e){for(var t=this,o=d.iter(this.pages);!o.done;o.next()){var n,r=o.value;if(n=d.as(r.root.controller,L.RootController)){var i=new k.PageResizeScore(r.root),a=r.database.beginTransaction("try_resize",null);T.PageFacade.setPageDesignSize(r,this.designSize),i.evaluateDocument();var l=F.ResizeLayoutType.Fit;if(n.preferredResizeType!=l&&i.reject()){if(d.opt(S.Host.logging,(function(e){return e.logToNewRelic(C.RemoteLoggingEvent.RESIZE_STRATEGY,{type:"Fallback"})})),a.rollback(),S.Host.platform.isAndroid){var s=new v.FormaHierarchyChangedEvent(r.root);s.duration=.2,r.root.beginUpdate(s),r.root.endUpdate(s)}a=r.database.beginTransaction("try_resize2",null);var u=n.preferredResizeType;n.preferredResizeType=l,T.PageFacade.setPageDesignSize(r,this.designSize),n.preferredResizeType=u,a.end()}else a.end()}}if(this.logAnalytics){var c=this.designSize.id;d.opt(S.Host.logging,(function(e){return e.logToAnalytics(p.AnalyticsConstants.kAnalyticsEventResizeApplied,{contextualData1:p.AnalyticsConstants.kAnalyticsDataPrefixNumPagesResized+":"+t.pages.length,contextualData2:p.AnalyticsConstants.kAnalyticsDataPrefixPageActionLocation+":"+t.location,contextualData3:p.AnalyticsConstants.kAnalyticsDataPrefixResizedTo+":"+c})}))}return f.CorePromise.resolve(null)}}}),n),h.RecordOriginalPageSizeAction=(r=function e(t){this.page=t,g.Action.call(this,e.TYPE)},d.defineClass({name:"RecordOriginalPageSizeAction",ctor:r,superName:"Action",statics:{TYPE:"RecordOriginalPageSizeAction"},props:{getUserAction:function(e){return b.UserActions.RecordOriginalPageSize()},execute:function(e){return this.page.originalSizeID=this.page.sizeID,f.CorePromise.resolve(null)}}}),r),h.RecordOriginalPageSizesAction=(i=function e(){g.Action.call(this,e.TYPE)},d.defineClass({name:"RecordOriginalPageSizesAction",ctor:i,superName:"Action",statics:{TYPE:"RecordOriginalPageSizesAction"},props:{getUserAction:function(e){return b.UserActions.RecordOriginalPageSize()},execute:function(e){var t;return(t=e.document)&&A.PagesFacade.visitPages(t,(function(e){return e.originalSizeID=e.sizeID,!0})),f.CorePromise.resolve(null)}}}),i),h.RecordCreateFromRemixAction=(a=function e(t){this.page=t,g.Action.call(this,e.TYPE)},d.defineClass({name:"RecordCreateFromRemixAction",ctor:a,superName:"Action",statics:{TYPE:"RecordCreateFromRemixAction"},props:{getUserAction:function(e){return b.UserActions.RecordCreateFromRemix()},execute:function(e){for(var t=d.iter(this.page.root.visitAsArray(m.FormaTraversal.PreOrder));!t.done;t.next()){var o=t.value;o.setTag(m.Forma.TAG_CREATED_FROM_REMIX,"true"),o.hasTag(m.Forma.TAG_RECOMMENDATION_TYPE)&&o.removeTag(m.Forma.TAG_RECOMMENDATION_TYPE),o.hasTag(m.Forma.TAG_RECOMMENDATION_SOURCE)&&o.removeTag(m.Forma.TAG_RECOMMENDATION_SOURCE)}return f.CorePromise.resolve(null)}}}),a),h.AddPageAction=(l=function e(t,o,n,r){void 0===o&&(o=null),void 0===n&&(n=!1),void 0===r&&(r=p.AnalyticsConstants.kAnalyticsDataPageActionLocationEditor),this.at=t,this.pageSize=o,this.logAnalytics=n,this.location=r,g.Action.call(this,e.TYPE)},d.defineClass({name:"AddPageAction",ctor:l,superName:"Action",statics:{TYPE:"AddPageAction"},props:{getUserAction:function(e){return b.UserActions.AddPage()},execute:function(e){var t,o,n=this;if(o=e.document){if(!A.PagesFacade.canAddPages(o))return f.CorePromise.reject("Can't add any more pages");var r=A.PagesFacade.addNewPage(o,this.at,this.pageSize);if(this.logAnalytics){var i=(t=d.opt(this.pageSize,(function(e){return e.id})))||null!=t?t:p.AnalyticsConstants.kAnalyticsDataPageSizeSameAsSelected,a=r.getPageExportData().asString;d.opt(S.Host.logging,(function(e){return e.logToAnalytics(p.AnalyticsConstants.kAnalyticsEventAddPagePressed,{contextualData1:p.AnalyticsConstants.kAnalyticsDataPrefixPageActionLocation+":"+n.location,contextualData2:p.AnalyticsConstants.kAnalyticsDataPrefixPageSizeId+":"+i,contextualData3:p.AnalyticsConstants.kAnalyticsDataPrefixPageSize+":"+a})}))}return A.PagesFacade.setActivePage(r),f.CorePromise.resolve(new g.PageActionResult([r]))}return f.CorePromise.reject("Not a valid doc")}}}),l),h.DeletePagesAction=(s=function e(t,o,n,r){void 0===o&&(o=!1),void 0===n&&(n=p.AnalyticsConstants.kAnalyticsDataPageActionLocationEditor),void 0===r&&(r=p.AnalyticsConstants.kAnalyticsDataPageActionMethodButton),this.pages=d.clone(t),this.logAnalytics=o,this.location=n,this.method=r,g.Action.call(this,e.TYPE)},d.defineClass({name:"DeletePagesAction",ctor:s,superName:"Action",statics:{TYPE:"DeletePagesAction"},props:{getUserAction:function(e){return b.UserActions.DeletePages()},execute:function(e){var t,o=this;if(0==this.pages.length)return f.CorePromise.resolve(null);if(t=e.document){if(!A.PagesFacade.canDeletePages(t,this.pages.length))return f.CorePromise.reject("Can't delete all pages");var n,r=this.pages.map((function(e){return t.getPageIndex(e)}),this);d.sortInPlace(r);var i=d.last(r)+1;return i<t.getPageCount()&&(n=t.getPageAtIndex(i)),this.pages.forEach((function(e){return A.PagesFacade.deletePage(e)})),A.PagesFacade.setActivePage(n||t.lastPage),this.logAnalytics&&d.opt(S.Host.logging,(function(e){return e.logToAnalytics(p.AnalyticsConstants.kAnalyticsEventDeletePagePressed,{contextualData1:p.AnalyticsConstants.kAnalyticsDataPrefixPageActionLocation+":"+o.location,contextualData2:p.AnalyticsConstants.kAnalyticsDataPrefixPageActionMethod+":"+o.method})})),f.CorePromise.resolve(null)}return f.CorePromise.reject("Not a valid doc")}}}),s),h.DuplicatePagesAction=(u=function e(t,o,n,r,i){void 0===o&&(o=!1),void 0===n&&(n=p.AnalyticsConstants.kAnalyticsDataPageActionLocationEditor),void 0===r&&(r=p.AnalyticsConstants.kAnalyticsDataPageActionMethodButton),void 0===i&&(i=e.invalidIndex),this.pages=d.clone(t),this.logAnalytics=o,this.location=n,this.method=r,this.pageIndex=i,g.Action.call(this,e.TYPE)},d.defineClass({name:"DuplicatePagesAction",ctor:u,superName:"Action",statics:{TYPE:"DuplicatePagesAction",invalidIndex:-1},props:{getUserAction:function(e){return b.UserActions.DuplicatePages()},execute:function(e){var t,o=this;return(t=e.document)?A.PagesFacade.canAddPages(t,this.pages.length)?A.PagesFacade.duplicatePages(this.pages,t,this.pageIndex).then((function(e){var t,n;return(t=d.as(e,["Array",y.FormaPage]))?((n=d.first(t))&&A.PagesFacade.setActivePage(n),o.logAnalytics&&d.opt(S.Host.logging,(function(e){return e.logToAnalytics(p.AnalyticsConstants.kAnalyticsEventDuplicatePagePressed,{contextualData1:p.AnalyticsConstants.kAnalyticsDataPrefixPageActionLocation+":"+o.location,contextualData2:p.AnalyticsConstants.kAnalyticsDataPrefixPageActionMethod+":"+o.method})})),f.CorePromise.resolve(new g.PageActionResult(t))):f.CorePromise.reject("duplication did not yield a page")})):f.CorePromise.reject("Can't duplicate these many pages"):f.CorePromise.reject("Not a valid doc")}}}),u),h.MovePagesAction=(c=function e(t,o){this.pages=d.clone(t),this.to=o,g.Action.call(this,e.TYPE)},d.defineClass({name:"MovePagesAction",ctor:c,superName:"Action",statics:{TYPE:"MovePagesAction"},props:{getUserAction:function(e){return b.UserActions.MovePages()},execute:function(e){return A.PagesFacade.movePages(this.pages,this.to),f.CorePromise.resolve(null)}}}),c)},cEEQ:function(e,t,o){var n,r,i,a,l=t,s=o("oAGj"),u=o("EGPT"),c=o("SpAV"),h=o("53P9"),d=o("fNpk"),g=o("9kak"),p=o("tGKA"),f=o("1NAc");l.LockupItemType=s.defineEnum("LockupItemType",{Text:0,Path:1,Artwork:2}),l.LockupItem=(n=function(){this.spaceWidth=null,this.complementaryStyleWordWidth=null,this.complementaryStyleSpaceWidth=null,this.canAppendNext=!1,this.isFullCanvas=!1},s.defineClass({name:"LockupItem",ctor:n,props:{init_447b:function(e){this.type=e.type,this.colorRole=e.colorRole,this.size=e.size,this.placement=e.placement,this.text=e.text,this.font=e.font,this.pointSize=e.pointSize,this.rowPointSize=e.rowPointSize,this.rowIndex=e.rowIndex,this.margins=e.margins,this.typographicBoundingRatios=e.typographicBoundingRatios,this.characterStyle=e.characterStyle,this.rangeInLockup=e.rangeInLockup,this.spaceWidth=e.spaceWidth,this.complementaryStyleWordWidth=e.complementaryStyleWordWidth,this.complementaryStyleSpaceWidth=e.complementaryStyleSpaceWidth,this.canAppendNext=e.canAppendNext,this.path=e.path,this.artworkID=e.artworkID,this.preScale=e.preScale,this.isFullCanvas=e.isFullCanvas},init_bc20:function(e,t,o,n,r,i,a,s,u,c,h,d,g,p,f,m){void 0===d&&(d=null),void 0===g&&(g=null),void 0===p&&(p=null),void 0===f&&(f=null),void 0===m&&(m=!1),this.type=l.LockupItemType.Text,this.colorRole=e,this.characterStyle=t,this.size=o,this.placement=n,this.text=r,this.font=i,this.pointSize=a,this.rowPointSize=s,this.typographicBoundingRatios=u,this.rowIndex=c,this.rangeInLockup=h,this.margins=d,this.spaceWidth=g,this.complementaryStyleWordWidth=p,this.complementaryStyleSpaceWidth=f,this.canAppendNext=m},init_79d9:function(e,t,o,n,r,i,a){void 0===r&&(r=null),void 0===i&&(i=!1),void 0===a&&(a=null),this.type=l.LockupItemType.Path,this.colorRole=e,this.size=t,this.placement=o,this.path=n,this.rowIndex=r,this.isFullCanvas=i,this.characterStyle=a},init_fbd7:function(e,t,o,n,r,i,a){void 0===i&&(i=null),void 0===a&&(a=null),this.type=l.LockupItemType.Artwork,this.colorRole=e,this.size=t,this.placement=o,this.artworkID=n,this.preScale=r,this.rowIndex=i,this.characterStyle=a},clone:function(){return n.init_447b(this)},hasCharacterStyle:{get:function(){var e;return!(!(e=s.isEmpty(this.characterStyle))&&null==e||e)}},append:function(e){var t,o,n,r,i,a,s,u;if(d.LegacyCoreAssert.isTrue(this.type==l.LockupItemType.Text&&e.type==l.LockupItemType.Text,"Only text lockup items support appending",void 0,"LockupItem.append","LockupLayoutStrategy.swift",165),d.LegacyCoreAssert.isTrue(this.canAppendNext,"Asked to append to an item that does not support it",void 0,"LockupItem.append","LockupLayoutStrategy.swift",166),null!=(t=this.text)&&(o=this.rangeInLockup)&&null!=(n=this.spaceWidth)&&null!=(r=this.pointSize)&&(i=this.font)&&null!=(a=e.text)&&(s=e.rangeInLockup)&&null!=(u=e.spaceWidth)){var c=r*i.spaceWidthRatio,h=Math.abs(n-c)<.001?" ":"";this.text=t+h+a,this.rangeInLockup=o.unionWith(s),this.size=new f.TheoSize(this.size.width+n+e.size.width,Math.max(this.size.height,e.size.height)),this.spaceWidth=u,this.canAppendNext=e.canAppendNext}}}}),n),l.descenderCharacters="gjqpyQ",l.shortCharacters=" qweryuopasg;zxcvnm,.*-~",l.tallSpecialsThatAreNotCaps="!^'",l.TypographicBoundingRatios=(r=function(e,t,o,n,r,i){this.sideInsetRatio=e,this.textVerticalOffsetRatio=t,this.backingVerticalOffsetRatio=o,this.heightRatio=n,this.heightFromBaselineRatio=r,this.hasUppercase=i},s.defineClass({name:"TypographicBoundingRatios",ctor:r}),r),l.getTypographicBoundingRatiosOfString=function(e,t,o){void 0===o&&(o=!0);for(var n=e.split("\n").join(),r=!1,i=!1,a=!1,u=!1,c=!1,h=!1,d=!1,g=!1,p=!1,f=t.meanRatio,m=0,y=0,v=0,S=0,C=0,T=0,A=s.iter(s.chars(n));!A.done;A.next()){var F=A.value,k=!1,L=!1;" "!=F&&(y+=1,k||null==t.upperCaseCharsDict[F]?L||null==t.lowerCaseCharsDict[F]||(L=!0):k=!0,!r&&k?r=!0:!i&&L&&(i=!0),null!=t.meanCharsDict[F]?v+=t.meanRatio:null!=t.capCharsDict[F]?(c=!0,v+=t.capRatio):null!=t.ascentCharsDict[F]?(u=!0,v+=t.ascentRatio):null!=t.meanAccentCharsDict[F]?(h=!0,v+=t.meanAccentRatio):null!=t.capAccentCharsDict[F]?(a=!0,v+=t.capAccentRatio):(c=!0,v+=t.capRatio),k&&(y+=1,v+=t.capRatio),k||L||""==F||""==F||""==F||(p=!0),null!=t.tailCharsDict[F]?(d=!0,S+=t.tailRatio):null!=t.descentCharsDict[F]&&(g=!0,S+=t.descentRatio))}if(p&&(f=1),a&&(f=Math.max(f,t.capAccentRatio)),u&&(f=Math.max(f,t.ascentRatio)),c&&(f=Math.max(f,t.capRatio)),h&&(f=Math.max(f,t.meanAccentRatio)),d&&(m=Math.max(m,t.tailRatio)),g&&(m=Math.max(m,t.descentRatio)),y>0&&(C=v/y,T=S/y),o){var b=f-(r?t.capRatio:t.meanRatio);C=f+=Math.max(0,m-b),T=m}var _=m/2,R=t.baselineOffsetRatio+f,I=.8*(f-C-m+T),w=f+m;return new l.TypographicBoundingRatios(_,R,I,w,f,r)},l.LayoutResults=(i=function e(t,o,n,r,i,a){void 0===a&&(a=null),this.itemsForReflow_=s.clone(t),this.items_=s.clone(e.optimize(t));for(var u=0,c=0,h=0,d=1e5,g=0,p=0,f=0,m={},y=s.iter(this.items_);!y.done;y.next()){var v=y.value;v.type==l.LockupItemType.Text&&(u+=v.size.height,c+=v.pointSize,h+=1,v.rowIndex<d&&(d=v.rowIndex),v.rowIndex>g&&(g=v.rowIndex),null==m[v.rowIndex]&&(p+=v.pointSize,m[v.rowIndex]=!0),v.pointSize>f&&(f=v.pointSize))}this.size=o,this.placement=n,this.numberOfLines=g<d?0:g-d+1,this.avgLinePointSize=p/s.toDouble(this.numberOfLines),this.avgTextItemHeight=u/h,this.avgTextPointSize=c/h,this.largestPointSize=f,this.typographicBoundingRatios=r,this.avgRowAspect=i,this.annotations=s.clone(a)},s.defineClass({name:"LayoutResults",ctor:i,statics:{optimize:function(e){for(var t=[],o=null,n=s.iter(e);!n.done;n.next()){var r,i=n.value.clone();i.canAppendNext&&null==o?o=i:(r=o)?(r.append(i),i.canAppendNext||(t.push(r),o=null)):t.push(i)}return(r=o)&&(d.LegacyCoreAssert.fail("Why does the last lockup item claim to be appendable?",void 0,"LayoutResults.optimize","LockupLayoutStrategy.swift",497),t.push(r)),t},mirrorItems:function(e,t){for(var o=[],n=s.iter(e);!n.done;n.next()){var r=n.value;r.placement=p.Matrix2D.scalingXY(-1,1).translateXY(r.size.width,0).concat(r.placement.scaleXY(-1,1)).translateXY(t,0),o.splice(0,0,r)}return o}},props:{items:{get:function(){return this.items_}},itemsForReflow:{get:function(){return this.itemsForReflow_}},flipForRightToLeft:function(){var e=this.size.width;this.items_=s.clone(i.mirrorItems(this.items_,e)),this.itemsForReflow_=s.clone(i.mirrorItems(this.itemsForReflow_,e))}}}),i),l.LockupLayoutStrategy=s.defineProtocol("LockupLayoutStrategy",{supportsConfiguration:"(LockupConfiguration) -> Boolean",layout:"(LockupConfiguration) -> LayoutResults",reflow:"(TheoSize, TheoPoint, LockupConfiguration, LayoutResults) -> LayoutResults",calculateTracking:"(LockupConfiguration, TheoSize) -> Double",calculateLeading:"(LockupConfiguration, TheoSize) -> Double",adjustSizeForLeading:"(TheoRect, LayoutResults, Double, Double) -> TheoSize",adjustSizeForTracking:"(String, LayoutResults, Double, Double) -> TheoSize",annotate:"(String, TheoSize, LockupStyle, Integer) -> Array<Annotation>"}),l.LockupLayoutStrategyFactory=s.defineProtocol("LockupLayoutStrategyFactory",{supportsConfiguration:"(LockupConfiguration) -> Boolean",createForConfiguration:"(LockupConfiguration) -> LockupLayoutStrategy"}),l.BaseLockupLayoutStrategy=(a=function(){this.maxLetterLayoutGraphemeCount=100,this.maxLetterLayoutRecommendedGraphemeCount=50},s.defineClass({name:"BaseLockupLayoutStrategy",ctor:a,statics:{createMultipleReturnAnnotations:function(e){return e.includes("\n\n")?[new u.Annotation(u.AnnotationID.MultipleReturns)]:null},_implements:function(e){return"LockupLayoutStrategy"==e}},props:{supportsConfiguration:function(e){return d.LegacyCoreAssert.fail("Implement in subclass",void 0,"BaseLockupLayoutStrategy.supportsConfiguration","LockupLayoutStrategy.swift",624),!1},layout:function(e){return d.LegacyCoreAssert.fail("implement in subclass",void 0,"BaseLockupLayoutStrategy.layout","LockupLayoutStrategy.swift",629),new l.LayoutResults([],new f.TheoSize(0,0),p.Matrix2D.Identity,new l.TypographicBoundingRatios(0,1,0,1,1,!1),0)},reflow:function(e,t,o,n){return null},calculateTracking:function(e,t){return d.LegacyCoreAssert.fail("implement in subclass",void 0,"BaseLockupLayoutStrategy.calculateTracking","LockupLayoutStrategy.swift",658),0},calculateLeading:function(e,t){return d.LegacyCoreAssert.fail("implement in subclass",void 0,"BaseLockupLayoutStrategy.calculateLeading","LockupLayoutStrategy.swift",665),0},adjustSizeForLeading:function(e,t,o,n){var r=n-o;return new f.TheoSize(0,s.toDouble(t.numberOfLines-1)*(e.width/t.avgRowAspect)*(.75*r))},adjustSizeForTracking:function(e,t,o,n){var r,i=0,a=n-o;if(0!=a){for(var l=-1,u=0,c=0,d=0,g=0,p=e,m=s.iter(t.items);!m.done;m.next()){var y=m.value;y.rowIndex!=l?(d>g&&(g=d,i=u),c=y.placement.tx,u=0):u+=a*y.pointSize;var v=h.GraphemeUtils.countGraphemes((r=y.text)||null!=r?r:""),S=v>0?v-1:0;u+=a*y.pointSize*s.toDouble(S),d=y.placement.tx+y.size.width-c,y.rangeInLockup.start>0&&" "==p.substr(y.rangeInLockup.start-1,1)&&c!=y.placement.tx&&(n<0?u-=a*y.pointSize:u+=a*y.pointSize),l=y.rowIndex}d>g&&(g=d,i=u)}return new f.TheoSize(i,0)},getPrecomputedRows:function(e,t){var o=[];if(0==e.length||0==t.length)return o;for(var n=new g.LockupRowInfo,r=0,i=0,a=s.iter(e);!a.done;a.next()){var l=a.value;l.isNewLine||(i>=t[r]&&(o.push(n),n=new g.LockupRowInfo,r+=1,i=0),n.addWord(l),i+=1)}return o.push(n),o},supportsReturns:function(){return!0},supportsMultipleReturns:function(){return!1},annotate:function(e,t,o,n){return this.supportsReturns()&&!this.supportsMultipleReturns()?a.createMultipleReturnAnnotations(e):null},getLockupSize:function(e,t,o){var n=e,r=t;return isNaN(n)&&(c.CoreAssertDebugOnly.fail("BaseLockupLayoutStrategy - width not a number for postscriptname "+o,void 0,"BaseLockupLayoutStrategy.getLockupSize","LockupLayoutStrategy.swift",804),n=20),isNaN(r)&&(c.CoreAssertDebugOnly.fail("BaseLockupLayoutStrategy - height not a number for postscriptname "+o,void 0,"BaseLockupLayoutStrategy.getLockupSize","LockupLayoutStrategy.swift",808),r=20),new f.TheoSize(n,r)},getLockupPlacement:function(e,t,o){var n=e,r=t;return isNaN(n)&&(c.CoreAssertDebugOnly.fail("BaseLockupLayoutStrategy - x not a number for postscriptname "+o,void 0,"BaseLockupLayoutStrategy.getLockupPlacement","LockupLayoutStrategy.swift",817),n=0),isNaN(r)&&(c.CoreAssertDebugOnly.fail("BaseLockupLayoutStrategy - y not a number for postscriptname "+o,void 0,"BaseLockupLayoutStrategy.getLockupPlacement","LockupLayoutStrategy.swift",821),r=0),p.Matrix2D.translationXY(n,r)}}}),a)},cRpU:function(e,t,o){var n,r,i,a,l,s,u,c,h,d,g,p,f,m,y,v,S,C,T,A,F,k,L,b,_=t,R=o("oAGj"),I=o("Tq01"),w=o("yGNn"),D=o("6Rk9"),x=o("iCxV"),P=o("c+uM"),E=o("Vm85"),M=o("8t9B"),N=o("oKlP"),G=o("oKI3"),B=o("Kkml");_.SetTextAction=(n=function e(t,o,n,r){void 0===n&&(n=null),void 0===r&&(r=E.ReplaceTextStrategy.Auto),this.text=t,this.forma=o,this.charStyleRanges=R.clone(n),this.strategy=r,I.Action.call(this,e.TYPE)},R.defineClass({name:"SetTextAction",ctor:n,superName:"Action",statics:{TYPE:"SetText"},props:{getUserAction:function(e){return B.UserActions.SetText(this.forma.formaID)},execute:function(e){return E.TextFacade.replaceTextForLockup(this.forma,this.text,this.charStyleRanges,this.strategy),w.CorePromise.resolve(null)}}}),n),_.SetTextCollapseAction=(r=function e(t,o,n,r,i,a){void 0===r&&(r=null),void 0===i&&(i=!1),void 0===a&&(a=E.ReplaceTextStrategy.Auto),this.text=t,this.forma=o,this.charStyleRanges=R.clone(r),this.strategy=a,this.scope=n,this.useLastPin=i,I.Action.call(this,e.TYPE)},R.defineClass({name:"SetTextCollapseAction",ctor:r,superName:"Action",statics:{TYPE:"SetTextCollapse",lastPin:null},props:{getUserAction:function(e){return B.UserActions.SetTextCollapse(this.scope)},execute:function(e){var t=this.useLastPin?r.lastPin:null;return r.lastPin=E.TextFacade.replaceTextForLockup(this.forma,this.text,this.charStyleRanges,this.strategy,t,this.fitInPage),w.CorePromise.resolve(null)},fitInPage:function(e,t,o){var n=D.GeometryFacade.NEEDS_FITTING_MAX_INITIAL_RATIO,r=n;D.GeometryFacade.fitInPage(e,t,o,void 0,n,r)}}}),r),_.SetFontAction=(i=function e(t,o,n,r,i,a){void 0===o&&(o=!1),void 0===n&&(n=null),void 0===r&&(r=null),void 0===i&&(i=[]),void 0===a&&(a=null),this.font=t,this.charStyleMode=o,this.recommendationSource=n,this.recommendationType=r,this.matchedIDS=R.clone(i),this.formae=R.clone(a),I.Action.call(this,e.TYPE)},R.defineClass({name:"SetFontAction",ctor:i,superName:"Action",statics:{TYPE:"SetFont"},props:{getUserAction:function(e){return B.UserActions.SetFont(e.selection.IDs.join(","))},execute:function(e){var t=R.clone(this.formae||e.selection.asFormaArray());E.TextFacade.setFont(this.font,t,this.charStyleMode,this.recommendationSource,this.recommendationType),1==t.length&&R.opt(R.as(t[0].controller,M.TypeLockupController),(function(e){return e.snapSizeToBounds()}));for(var o=[],n=R.iter(this.matchedIDS);!n.done;n.next()){var r,i=n.value;(r=R.opt(e.document,(function(e){return e.formaByID(i)})))&&o.push(r)}return E.TextFacade.setFont(this.font,o,!1,this.recommendationSource,this.recommendationType),w.CorePromise.resolve(null)}}}),i),_.ReplaceMissingFontsAction=(a=function e(){I.Action.call(this,e.TYPE)},R.defineClass({name:"ReplaceMissingFontsAction",ctor:a,superName:"Action",statics:{TYPE:"ReplaceMissingFonts"},props:{getUserAction:function(e){return B.UserActions.ReplaceMissingFonts()},execute:function(e){var t;return(t=e.document)?(E.TextFacade.replaceMissingFonts(t),w.CorePromise.resolve(null)):w.CorePromise.reject("Missing doc")}}}),a),_.ChangeTextLayoutAndAlignmentAction=(l=function e(t,o,n,r,i,a){void 0===n&&(n=!1),void 0===r&&(r=G.TextPathID.UNSET),void 0===i&&(i=null),void 0===a&&(a=P.VerticalLockupAlignment.UNSET),P.LockupStyle.isPath(t)?(r==G.TextPathID.Custom&&null==i||r!=G.TextPathID.Custom&&null!=i)&&R.opt(x.Host.logging,(function(e){return e.warning("pathID/customPath mismatch")})):r==G.TextPathID.UNSET&&null==i||R.opt(x.Host.logging,(function(e){return e.warning("Why are we providing a path or path id with a non-path layout?")})),this.layout=t,this.alignment=o,this.pathID=r,this.customPath=i,this.charStyleMode=n,this.verticalAlignment=a,I.Action.call(this,e.TYPE)},R.defineClass({name:"ChangeTextLayoutAndAlignmentAction",ctor:l,superName:"Action",statics:{TYPE:"ChangeTextLayoutAndAlignment"},props:{getUserAction:function(e){return B.UserActions.ChangeTextAlignment(e.selection.IDs.join(","))},execute:function(e){var t=R.clone(e.selection.asFormaArray());return E.TextFacade.setLayoutAndAlignment(this.layout,this.alignment,t,this.charStyleMode,this.pathID,this.customPath,this.verticalAlignment),t.forEach((function(e){return R.opt(R.as(e.controller,M.TypeLockupController),(function(e){return e.snapSizeToBounds()}))})),w.CorePromise.resolve(null)}}}),l),_.ChangeTextLineSpacingAction=(s=function e(t,o){void 0===o&&(o=!1),this.lineSpacing=t,this.charStyleMode=o,I.Action.call(this,e.TYPE)},R.defineClass({name:"ChangeTextLineSpacingAction",ctor:s,superName:"Action",statics:{TYPE:"ChangeTextLineSpacing"},props:{getUserAction:function(e){return B.UserActions.ChangeLineSpacing()},execute:function(e){return E.TextFacade.setLineSpacing(this.lineSpacing,e.selection.asFormaArray(),this.charStyleMode),w.CorePromise.resolve(null)}}}),s),_.ChangeTextAttributesAction=(u=function e(t,o,n,r,i,a){void 0===r&&(r=!1),void 0===i&&(i=G.TextPathID.UNSET),void 0===a&&(a=null),this.layout=t,this.alignment=o,this.lineSpacing=n,this.charStyleMode=r,this.pathID=i,this.customPath=a,I.Action.call(this,e.TYPE)},R.defineClass({name:"ChangeTextAttributesAction",ctor:u,superName:"Action",statics:{TYPE:"ChangeTextAttributes"},props:{getUserAction:function(e){return B.UserActions.ChangeTextAttributes()},execute:function(e){return this.layout==P.LockupLayout.SKIP&&this.alignment==P.LockupAlignment.SKIP||E.TextFacade.setLayoutAndAlignment(this.layout,this.alignment,e.selection.asFormaArray(),this.charStyleMode,this.pathID,this.customPath),isNaN(this.lineSpacing)||E.TextFacade.setLineSpacing(this.lineSpacing,e.selection.asFormaArray(),this.charStyleMode),w.CorePromise.resolve(null)}}}),u),_.SetFontSizeAction=(c=function e(t,o,n){void 0===o&&(o=new N.TheoPoint(.5,.5)),void 0===n&&(n=null),this.size=t,this.pin=o,this.formae=R.clone(n),I.Action.call(this,e.TYPE)},R.defineClass({name:"SetFontSizeAction",ctor:c,superName:"Action",statics:{TYPE:"SetFontSize"},props:{getUserAction:function(e){return B.UserActions.SetFontSize()},execute:function(e){return E.TextFacade.setFontSize(this.size,this.formae||e.selection.asFormaArray(),this.pin),w.CorePromise.resolve(null)}}}),c),_.MatchSizeAction=(h=function e(t,o,n){this.size=t,this.snapSizes=R.clone(o),this.pin=n,I.Action.call(this,e.TYPE)},R.defineClass({name:"MatchSizeAction",ctor:h,superName:"Action",statics:{TYPE:"MatchSize"},props:{getUserAction:function(e){return isNaN(this.size)?B.UserActions.MatchSize():B.UserActions.ResizeItem()},execute:function(e){var t;return t=isNaN(this.size)?E.TextFacade.matchNextSize(this.snapSizes,this.pin,e.selection.asFormaArray()):E.TextFacade.matchNearestSize(this.size,this.snapSizes,this.pin,e.selection.asFormaArray()),w.CorePromise.resolve(new I.DoubleActionResult(t))}}}),h),_.SetLineBreakAction=(d=function e(t,o){void 0===o&&(o=!1),this.lineBreak=t,this.charStyleMode=o,I.Action.call(this,e.TYPE)},R.defineClass({name:"SetLineBreakAction",ctor:d,superName:"Action",statics:{TYPE:"SetLineBreak"},props:{getUserAction:function(e){return B.UserActions.ToggleLineBreak()},execute:function(e){return E.TextFacade.setLineBreak(this.lineBreak,e.selection.asFormaArray(),this.charStyleMode),w.CorePromise.resolve(null)}}}),d),_.SetNextSpacingSequenceAction=(g=function e(t){this.sequence=t,I.Action.call(this,e.TYPE)},R.defineClass({name:"SetNextSpacingSequenceAction",ctor:g,superName:"Action",statics:{TYPE:"SetNextSpacingSequence"},props:{getUserAction:function(e){return B.UserActions.SetNextSpacingSequence()},execute:function(e){return E.TextFacade.setNextSpacingSequence(this.sequence,e.selection.asFormaArray()),w.CorePromise.resolve(null)}}}),g),_.SetTrackingAction=(p=function e(t,o){this.tracking=t,this.pin=o,I.Action.call(this,e.TYPE)},R.defineClass({name:"SetTrackingAction",ctor:p,superName:"Action",statics:{TYPE:"SetTracking"},props:{getUserAction:function(e){return B.UserActions.SetTracking()},execute:function(e){return E.TextFacade.setTracking(this.tracking,this.pin,e.selection.asFormaArray()),w.CorePromise.resolve(null)}}}),p),_.SetLeadingAction=(f=function e(t,o){this.leading=t,this.pin=o,I.Action.call(this,e.TYPE)},R.defineClass({name:"SetLeadingAction",ctor:f,superName:"Action",statics:{TYPE:"SetLeading"},props:{getUserAction:function(e){return B.UserActions.SetLeading()},execute:function(e){return E.TextFacade.setLeading(this.leading,this.pin,e.selection.asFormaArray()),w.CorePromise.resolve(null)}}}),f),_.SetRelativeFontScaleAction=(m=function e(t){this.relativeFontScale=t,I.Action.call(this,e.TYPE)},R.defineClass({name:"SetRelativeFontScaleAction",ctor:m,superName:"Action",statics:{TYPE:"SetRelativeFontScale"},props:{getUserAction:function(e){return B.UserActions.SetRelativeFontScale()},execute:function(e){return E.TextFacade.setRelativeFontScale(this.relativeFontScale,e.selection.asFormaArray()),w.CorePromise.resolve(null)}}}),m),_.SetPaddingAction=(y=function e(t){this.padding=t,I.Action.call(this,e.TYPE)},R.defineClass({name:"SetPaddingAction",ctor:y,superName:"Action",statics:{TYPE:"SetPadding"},props:{getUserAction:function(e){return B.UserActions.SetPadding()},execute:function(e){return E.TextFacade.setPadding(this.padding,e.selection.asFormaArray()),w.CorePromise.resolve(null)}}}),y),_.SetTextLookAction=(v=function e(t,o){void 0===o&&(o=!0),this.look=t,this.heuristicAttributes=o,I.Action.call(this,e.TYPE)},R.defineClass({name:"SetTextLookAction",ctor:v,superName:"Action",statics:{TYPE:"SetTextLook"},props:{getUserAction:function(e){return B.UserActions.SetTextLook(e.selection.IDs.join(","))},execute:function(e){return E.TextFacade.setTextLook(this.look,e.selection.asFormaArray(),this.heuristicAttributes),w.CorePromise.resolve(null)}}}),v),_.SetTextEffectsAttributesAction=(S=function e(t,o,n){this.outlineStrokeWeight=t,this.shadowOffset=o,this.shadowAngle=n,I.Action.call(this,e.TYPE)},R.defineClass({name:"SetTextEffectsAttributesAction",ctor:S,superName:"Action",statics:{TYPE:"SetTextEffectsAttributes"},props:{getUserAction:function(e){return B.UserActions.SetTextEffectsAttributes()},execute:function(e){return E.TextFacade.setTextEffectsAttributes(this.outlineStrokeWeight,this.shadowOffset,this.shadowAngle,e.selection.asFormaArray()),w.CorePromise.resolve(null)}}}),S),_.SetHighlightMethodAction=(C=function e(t,o){void 0===o&&(o=!1),this.method=t,this.charStyleMode=o,I.Action.call(this,e.TYPE)},R.defineClass({name:"SetHighlightMethodAction",ctor:C,superName:"Action",statics:{TYPE:"SetHighlightMethod"},props:{getUserAction:function(e){return B.UserActions.SetHighlightMethod(e.selection.IDs.join(","))},execute:function(e){return E.TextFacade.setHightlightMethod(this.method,e.selection.asFormaArray(),this.charStyleMode),w.CorePromise.resolve(null)}}}),C),_.EnterCharStyleModeAction=(T=function e(t){this.forma=t,I.Action.call(this,e.TYPE)},R.defineClass({name:"EnterCharStyleModeAction",ctor:T,superName:"Action",statics:{TYPE:"EnterCharStyleMode"},props:{getUserAction:function(e){var t,o=!1;return(t=R.as(this.forma.controller,M.TypeLockupController))&&(o=0==t.charStyleRanges.length),B.UserActions.EnterCharStyleMode(o)},execute:function(e){return e.selection.inCharStyleMode=!0,E.TextFacade.setCharStyleMode(this.forma,!0),w.CorePromise.resolve(null)}}}),T),_.ExitCharStyleModeAction=(A=function e(t){this.forma=t,I.Action.call(this,e.TYPE)},R.defineClass({name:"ExitCharStyleModeAction",ctor:A,superName:"Action",statics:{TYPE:"ExitCharStyleMode"},props:{getUserAction:function(e){return B.UserActions.ExitCharStyleMode()},execute:function(e){return e.selection.inCharStyleMode=!1,E.TextFacade.setCharStyleMode(this.forma,!1),w.CorePromise.resolve(null)}}}),A),_.ApplyCharStyleAction=(F=function e(t,o,n,r){this.textForma=t,this.characterStyle=o,this.applyMode=n,this.startRange=r,I.Action.call(this,e.TYPE)},R.defineClass({name:"ApplyCharStyleAction",ctor:F,superName:"Action",statics:{TYPE:"ApplyCharStyle"},props:{getUserAction:function(e){return B.UserActions.ApplyCharStyle()},execute:function(e){var t=E.TextFacade.applyCharStyle(this.textForma,this.characterStyle,this.applyMode,this.startRange,!0);return w.CorePromise.resolve(new I.TextRangeActionResult(t))}}}),F),_.ApplyCharStyleWithoutUIAction=(k=function(e,t,o,n){this.textForma=e,this.characterStyle=t,this.applyMode=o,this.startRange=n,I.Action.call(this,_.ApplyCharStyleAction.TYPE)},R.defineClass({name:"ApplyCharStyleWithoutUIAction",ctor:k,superName:"Action",statics:{TYPE:"ApplyCharStyleWithoutUI"},props:{getUserAction:function(e){return B.UserActions.ApplyCharStyleWithoutUI()},execute:function(e){var t=E.TextFacade.applyCharStyle(this.textForma,this.characterStyle,this.applyMode,this.startRange,!1);return w.CorePromise.resolve(new I.TextRangeActionResult(t))}}}),k),_.ApplyTextStyleSuggestionAction=(L=function e(t,o,n,r){this.style=t,this.forma=o,this.wheelEvaluator=n,this.useEnhancedWheel=r,I.Action.call(this,e.TYPE)},R.defineClass({name:"ApplyTextStyleSuggestionAction",ctor:L,superName:"Action",statics:{TYPE:"ApplyTextStyleSuggestion"},props:{getUserAction:function(e){return B.UserActions.ApplyTextStyleSuggestion(this.forma.formaID)},execute:function(e){var t;(o=R.as(this.forma.controller,M.TypeLockupController))&&null!=o.styleController.getSessionContainerSize()&&null!=o.styleController.getSessionContainerCenter()&&(o.size=o.styleController.getSessionContainerSize(),(t=o.styleController.getSessionContainerCenter())&&this.forma.moveCenterToPoint(t));var o,n=E.TextFacade.applyTextStyleSuggestion(this.style,this.forma,this.wheelEvaluator,this.useEnhancedWheel);return(o=R.as(this.forma.controller,M.TypeLockupController))&&o.snapSizeToBounds(),w.CorePromise.resolve(new I.LockupStyleActionResult(n))}}}),L),_.ApplyNextTextEmphasisSuggestionAction=(b=function e(t,o){this.forma=t,this.wheelEvaluator=o,I.Action.call(this,e.TYPE)},R.defineClass({name:"ApplyNextTextEmphasisSuggestionAction",ctor:b,superName:"Action",statics:{TYPE:"ApplyTextEmphasisSuggestion"},props:{getUserAction:function(e){return B.UserActions.ApplyTextEmphasisSuggestion(this.forma.formaID)},execute:function(e){var t=R.clone(E.TextFacade.applyNextTextEmphasisSuggestion(this.forma,this.wheelEvaluator));return w.CorePromise.resolve(new I.TextEmphasisActionResult(t))}}}),b)},cYVN:function(e,t,o){var n,r=t,i=o("oAGj"),a=o("fNpk");r.RoleData=(n=function(e,t,o){for(var n=i.iter(t);!n.done;n.next()){var r=n.value;a.LegacyCoreAssert.isTrue(null!=o[r],"nil feature value",void 0,"RoleData.init","RoleData.swift",24)}for(var l=i.iter(i.keys(o));!l.done;l.next())r=l.value,a.LegacyCoreAssert.isTrue(t.includes(r),"missing feature order",void 0,"RoleData.init","RoleData.swift",27);this.forma=e,this.featureOrder=i.clone(t),this.featureValues=i.clone(o)},i.defineClass({name:"RoleData",ctor:n,props:{feat:function(e){return this.featureValues[e]},getUniqueKey:function(){for(var e="",t=i.iter(this.getFeatureVector());!t.done;t.next()){var o=t.value;e=e+i.toString("%.2f",o)+"-"}return e=i.replaceAll(e,".","")},asString:{get:function(){for(var e="",t=i.iter(this.featureOrder);!t.done;t.next()){var o=t.value,n=Math.round(1e3*this.featureValues[o])/1e3;e+=o+": "+i.toString(n)+",\n"}return e}},asJson:{get:function(){return"{\n"+this.asString+"\n}"}},getFeatureVector:function(){for(var e=[],t=i.iter(this.featureOrder);!t.done;t.next()){var o=t.value;e.push(this.featureValues[o])}return e}}}),n)},d2x6:function(e,t,o){var n,r=t,i=o("oAGj"),a=o("gXiO"),l=o("fNpk"),s=o("tGKA"),u=o("7l9C"),c=o("1NAc");r.TypographyTree=(n=function(){a.CoreObject.call(this),this.root_=null},i.defineClass({name:"TypographyTree",ctor:n,superName:"CoreObject",statics:{buildArchetypeTree:function(e){var t=new n;if(e.length>1){for(var o=-1,r=[],a=[],l=i.iter(i.toSequence(e));!l.done;l.next()){var s=l.value,h=s.offset,d=s.element,g=n.createTextNode(d,h);if(r.length>0&&d.weight!=o){var p=r[0];r.shift();for(var f=i.iter(r);!f.done;f.next()){var m=f.value;p=C=n.createGroupNode(p,m,u.AlignmentIdiom.LRBB)}a.push(p),r.splice(0)}r.push(g),o=d.weight}if(r.length>0){p=r[0],r.shift();for(var y=i.iter(r);!y.done;y.next())m=y.value,p=C=n.createGroupNode(p,m,u.AlignmentIdiom.LRBB);a.push(p)}var v=a[0];a.shift();for(var S=i.iter(a);!S.done;S.next())p=S.value,v=C=n.createGroupNode(v,p,u.AlignmentIdiom.LRBB);t.setRoot(v)}else{g=n.createTextNode(i.first(e),0);var C=n.createGroupNode(g,new u.SpacerNode(1,new c.TheoSize(0,0)),u.AlignmentIdiom.LRBB);t.setRoot(C)}return t},createTextNode:function(e,t){return new u.TextNode(e,t)},createGroupNode:function(e,t,o){var n=new u.GroupNode(e,t);return n.transAlign=o,n}},props:{setRoot:function(e){this.root_=e},getRoot:function(){return this.root_},getBounds:function(){return this.root_.localbounds()},calcGlobal:function(e){if(e.isSame(this.root_)){var t=e.local();e.globalMat=new s.Matrix2D(t.a,t.b,t.c,t.d,t.tx,t.ty)}else if(i.opt(e.parent,(function(e){return null==e.globalMat}))&&this.calcGlobal(e.parent),e instanceof u.TextNode){var o=new s.Matrix2D(1,0,0,1,0,e.getVerticalOffset());e.globalMat=o.concat(e.local()).concat(e.parent.globalMat)}else e.globalMat=e.local().concat(e.parent.globalMat);e instanceof u.GroupNode&&(this.calcGlobal(e.getChild(!0)),this.calcGlobal(e.getChild(!1)))},calcGlobalMatrices:function(){this.root_.calcTransform(),this.calcGlobal(this.root_)},rotateNode:function(e){if(null!=e.parent&&!i.opt(e.parent,(function(e){return null==e.parent}))){var t=e.parent,o=t.parent;if(null!=o.parent){var n=o.parent;t.parent=n,n.getChild(!0).isSame(o)?n.setChild(t,!0):n.setChild(t,!1)}else t.parent=null,this.setRoot(t);o.getChild(!0).isSame(t)?(o.setChild(t.getChild(!1),!0),t.setChild(o,!1)):(o.setChild(t.getChild(!0),!1),t.setChild(o,!0)),o.parent=t}},findCommonAncestor:function(e){l.LegacyCoreAssert.isTrue(e.length>1,"findCommonAncestor expects at least two nodes",void 0,"TypographyTree.findCommonAncestor","TypographyTree.swift",155);for(var t=[],o=[],n=e[0].parent;null!=n;)t.push(n),o.push(1),n=n.parent;for(var r=i.iter(i.range(1,e.length-1,!0));!r.done;r.next())for(n=e[r.value].parent;null!=n;){for(var a=n.getId(),s=i.iter(i.toSequence(t));!s.done;s.next()){var u=s.value,c=u.offset;if(u.element.getId()==a){o[c]+=1;break}}n=n.parent}for(var h=i.iter(i.toSequence(o));!h.done;h.next()){var d=h.value;if(c=d.offset,d.element==e.length)return t[c]}return l.LegacyCoreAssert.fail("Can't find common ancestor TypographyNode",void 0,"TypographyTree.findCommonAncestor","TypographyTree.swift",184),null},description:{get:function(){var e="TypographyTree:\r\n";return null!=this.root_&&(e+=this.root_.description),e}}}}),n)},d3iY:function(e,t,o){var n,r,i=t,a=o("oAGj"),l=o("EGPT"),s=o("ascj"),u=o("Zc5V"),c=o("53P9"),h=o("iCxV"),d=o("cEEQ"),g=o("9kak"),p=o("c+uM"),f=o("KdeS"),m=o("tGKA"),y=o("8t9B"),v=o("3UhB"),S=o("uUew"),C=o("1NAc");i.LetterGridLayoutStrategy=(n=function(){this.trackingScalar=3,this.spacingScalar=3,d.BaseLockupLayoutStrategy.call(this)},a.defineClass({name:"LetterGridLayoutStrategy",ctor:n,superName:"BaseLockupLayoutStrategy",statics:{_implements:function(e){return"LockupLayoutStrategy"==e}},props:{supportsConfiguration:function(e){return p.LockupStyle.isLetterGrid(e.style.layout)},layout:function(e){var t=[],o=0,n=0,r=0,i=this.getWireframeLayout(e),l=i.typographicBoundingRatios,u=a.clone(i.rows);if(0==!u.length){var c,h,g,p,f=i.horizontalPaddingRatio,S=i.verticalPaddingRatio,T=this.getCombinedAspectRatio(u,f,S),A=e.style,F=i.font;null!=(p=e.preferredFontSize)?(h=(c=p)*l.heightRatio,g=(n=(o=i.constraintWidth)/T)/a.toDouble(u.length)):(T<i.constraintAspectRatio?(n=i.constraintHeight,o=i.constraintHeight*T):(o=i.constraintWidth,n=i.constraintWidth/T),c=(h=(g=n/a.toDouble(u.length))/(1+S))/l.heightRatio);var k=S*h,L=f*h;i.charFontAdjustRatio>1&&(c/=i.charFontAdjustRatio);for(var b=c*F.capRatio,_=c*l.textVerticalOffsetRatio-b,R=a.opt(a.opt(A.characterStyles[y.TypeLockupController.HIGHLIGHT_STYLE],(function(e){return e.font})),(function(e){return e.fontData}))||F,I=c*i.charFontAdjustRatio,w=v.TypeLockupUtils.getCharFontYAdjust(A,c,I),D=k/2+_,x=a.iter(a.toSequence(u));!x.done;x.next()){var P=x.value,E=P.offset,M=P.element;if(0==!M.words.length)for(var N=a.first(M.words).aspectRatio*h,G=N+L,B=L/2+M.colOffsetLeft*G,O=a.iter(M.words);!O.done;O.next()){var U=O.value,H=U.characterStyle,z=H==y.TypeLockupController.HIGHLIGHT_STYLE,Y=z?R:F,W=z?I:c,V=U.relativeMargins.multiply(h),K=V.width,X=B+K,j=D+(z?w:0),q=d.LockupItem.init_bc20(s.ColorRole.FieldPrimary,H,new C.TheoSize(N-2*K,b),m.Matrix2D.translationXY(X,j),U.text,Y,W,c,l,E,U.rangeInLockup,V);t.push(q),B+=G}D+=g}r=this.getWidestRowAndAspectRatio(u,f,S).aspectRatio}return new d.LayoutResults(t,new C.TheoSize(o,n),m.Matrix2D.Identity,l,r,this.getAnnotations(i.renderableItemCount,t.length))},getCharacterStyle:function(e,t,o){for(var n=a.iter(e);!n.done;n.next()){var r=n.value;if(t>=r.start&&t<r.end)return y.TypeLockupController.HIGHLIGHT_STYLE}return""},getWireframeLayout:function(e,t){var o;void 0===t&&(t=null);for(var n=e.text.toUpperCase(),r=e.style,l=r.alignment,s=e.containerSize,p=(t||s).width,m=(t||s).height,T=p/m,A=r.spacing*this.spacingScalar,F=r.tracking*this.trackingScalar,k=r.font.fontData,L=d.getTypographicBoundingRatiosOfString(n,k,!1),b=0,_=0,R=0,I=0,w=[],D=(o=e.preferredFontSize)||null!=o?o:32,x=a.opt(a.opt(r.characterStyles[y.TypeLockupController.HIGHLIGHT_STYLE],(function(e){return e.font})),(function(e){return e.fontData}))||k,P=v.TypeLockupUtils.getCharFontAdjust(r,L.hasUppercase,!1),E=D*P,M=[],N=a.clone(c.GraphemeUtils.splitGraphemes(n)),G=a.iter(a.toSequence(N));!G.done;G.next()){var B=G.value,O=B.offset,U=B.element,H=v.TypeLockupUtils.isWhiteSpace(U);if(H||(R+=1),_<this.maxLetterLayoutGraphemeCount){if(H){if("\n"==U){var z=I;I=O-b,w.push(I-z)}b+=1}else _+=1;var Y=this.getCharacterStyle(e.characterStyleRanges,O,O+1)==y.TypeLockupController.HIGHLIGHT_STYLE,W=Y?x:k,V=Y?E:D,K=h.Host.textModelUtils.measureBoundsForLayout(U,W,V,0);M.push(K.width)}}w.push(_-I);var X,j=Math.max(D,E)*L.heightRatio,q=a.max(M)/j,Z=(q+F)/(1+A);X=null!=e.preferredFontSize?a.toInt(Math.floor(p/(a.max(M)+F*j))):u.GridArrangementUtils.getArrangement(T,Z,_,w).numCols;for(var J=new g.LockupRowInfo,Q=[],$=a.iter(a.toSequence(N));!$.done;$.next()){var ee=$.value;if(O=ee.offset,U=ee.element,v.TypeLockupUtils.isWhiteSpace(U))"\n"==U&&(this.commitRow(Q,J,X,l),J=new g.LockupRowInfo);else{var te=(q-M[O]/j)/2,oe=new f.LockupWordInfo(U,q,0,this.getCharacterStyle(e.characterStyleRanges,O,O+1),1,!1,!0,new S.TextRange(O,O+1),new C.TheoSize(te,0));if(J.words.length==X&&(this.commitRow(Q,J,X,l),J=new g.LockupRowInfo),J.addWord(oe),0==(_-=1))break}}return this.commitRow(Q,J,X,l),i.WireframeLayout.init_d3ad(k,L,P,p,m,T,F,A,Q,X,R)},commitRow:function(e,t,o,n){var r=a.toDouble(o-t.words.length);n==p.LockupAlignment.Right?t.colOffsetLeft=r:n==p.LockupAlignment.Center&&(t.colOffsetLeft=r/2,t.colOffsetRight=r/2),e.push(t)},calculateTracking:function(e,t){var o=this.getWireframeLayout(e,t),n=a.clone(o.rows);if(0==n.length)return e.style.tracking;var r=this.getCombinedAspectRatio(n,0,o.verticalPaddingRatio),i=o.constraintHeight*r,l=e.containerSize.width;if(i<l){var s=a.toDouble(n.length);return(l-i)/a.toDouble(o.numCols)/(o.constraintHeight/s/(1+o.verticalPaddingRatio))/this.trackingScalar}return-i},calculateLeading:function(e,t){var o=this.getWireframeLayout(e,t),n=a.clone(o.rows);if(0==n.length)return e.style.spacing;var r=this.getCombinedAspectRatio(n,o.horizontalPaddingRatio,0),i=o.constraintWidth/r,l=e.containerSize.height;if(i<l){var s=a.toDouble(n.length),u=i/s;return(l/s-u)/u/this.spacingScalar}return-i},adjustSizeForLeading:function(e,t,o,n){if(0==!t.items.length){var r=n-o,i=a.first(t.items);return new C.TheoSize(0,a.toDouble(t.numberOfLines)*i.rowPointSize*i.typographicBoundingRatios.heightRatio*r*this.spacingScalar)}return C.TheoSize.Zero},adjustSizeForTracking:function(e,t,o,n){var r=this.getNumColsInLayout(t);if(r>0){var i=n-o,l=a.first(t.items);return new C.TheoSize(l.rowPointSize*l.typographicBoundingRatios.heightRatio*i*this.trackingScalar*a.toDouble(r),0)}return C.TheoSize.Zero},getNumColsInLayout:function(e){for(var t=0,o=0,n=-1,r=a.iter(e.items);!r.done;r.next()){var i=r.value;n!=i.rowIndex?(n=i.rowIndex,o=1):o+=1,t=Math.max(t,o)}return t},calculateRowAspectRatio:function(e,t,o,n){var r=a.toDouble(e.words.length),i=r+a.toDouble(n),l=e.aspectRatio*i/r;return(l+=i*t)/(1+o)},getWidestRowAndAspectRatio:function(e,t,o){for(var n,r=0,i=a.iter(e);!i.done;i.next()){var l=i.value,s=this.calculateRowAspectRatio(l,t,o,a.toInt(l.colOffsetLeft+l.colOffsetRight));s>r&&(n=l,r=s)}return{row:n,aspectRatio:r}},getCombinedAspectRatio:function(e,t,o){return this.getWidestRowAndAspectRatio(e,t,o).aspectRatio/a.toDouble(e.length)},supportsMultipleReturns:function(){return!0},annotate:function(e,t,o,n){var r=c.GraphemeUtils.splitGraphemes(e).filter((function(e){return!v.TypeLockupUtils.isWhiteSpace(e)}),this),i=a.clone(this.getAnnotations(r.length,n)),s=a.clone(d.BaseLockupLayoutStrategy.prototype.annotate.call(this,e,t,o,n));return l.AnnotationState.concat(i,s)},getAnnotations:function(e,t){return t<e?[new l.Annotation(l.AnnotationID.TextTruncated,l.AnnotationPriority.High)]:t>this.maxLetterLayoutRecommendedGraphemeCount?[new l.Annotation(l.AnnotationID.TooMuchGridText)]:null}}}),n),i.WireframeLayout=(r=function(){},a.defineClass({name:"WireframeLayout",ctor:r,props:{init_d3ad:function(e,t,o,n,r,i,l,s,u,c,h){this.font=e,this.typographicBoundingRatios=t,this.charFontAdjustRatio=o,this.constraintWidth=n,this.constraintHeight=r,this.constraintAspectRatio=i,this.horizontalPaddingRatio=l,this.verticalPaddingRatio=s,this.rows=a.clone(u),this.numCols=c,this.renderableItemCount=h},init_implicit:function(e,t,o,n,r,i,l,s,u,c,h){this.font=e,this.typographicBoundingRatios=t,this.charFontAdjustRatio=o,this.constraintWidth=n,this.constraintHeight=r,this.constraintAspectRatio=i,this.horizontalPaddingRatio=l,this.verticalPaddingRatio=s,this.rows=a.clone(u),this.numCols=c,this.renderableItemCount=h}}}),r)},d820:function(e,t,o){var n,r=t,i=o("oAGj"),a=o("7siz");r.IHandlesModel=i.defineProtocol("IHandlesModel",{getAll:"() -> Array<BaseHandle>"}),r.IMutableHandlesModel=i.defineProtocol("IMutableHandlesModel",{clear:"() -> Void",setAll:"(Array<BaseHandle>) -> Void"}),r.HandlesState=(n=function(e){void 0===e&&(e=null),this.handles=i.clone(e||[])},i.defineClass({name:"HandlesState",ctor:n,superName:"EditorStateMember",statics:{_implements:function(e){return"IMutableHandlesModel"==e||"IHandlesModel"==e}},props:{clone:function(){return new n(this.handles)},getAll:function(){return this.handles},clear:function(){this.setAll([])},setAll:function(e){this.beforeChange(),this.handles=i.clone(e),this.afterChange()},diff:function(e){return[a.EditorModelChangedMessage.CHG_HANDLES]}}}),n)},dHJt:function(e,t,o){var n,r=t,i=o("oAGj"),a=o("16hp"),l=o("6Rk9"),s=o("iCxV"),u=o("tGKA"),c=o("oKlP");r.BadgeLayoutController=(n=function(e,t){void 0===t&&(t=!0),this._formae=i.clone(e),this._usePerceivedBounds=t},i.defineClass({name:"BadgeLayoutController",ctor:n,props:{update:function(e){if(void 0===e&&(e=null),0!=this._formae.length){var t=this._formae[0],o=t.page.root,n=l.GeometryFacade.getFormaeBounds(this._formae,this._usePerceivedBounds),r=new a.FormaPlacementSuggester(t,o),h=i.clone(r.createPlacementSuggestions(!0,n.aspectRatio));if(0==!h.length){var d=h[0].location,g=d.height/n.height,p=u.Matrix2D.translation(d.origin);null!=e&&(p=u.Matrix2D.translation(new c.TheoPoint(e.x-.5*n.width*g,e.y-.5*n.height*g)));for(var f=i.iter(this._formae);!f.done;f.next()){var m=f.value;m.bounds=m.bounds.scale(g,c.TheoPoint.ZERO);var y=m.totalPlacement,v=(y.tx-n.minX)*g,S=(y.ty-n.minY)*g;m.placement=new u.Matrix2D(y.a,y.b,y.c,y.d,v,S).concat(p)}}else i.opt(s.Host.logging,(function(e){return e.warning("Did not find a placement suggestion for badge.")}))}}}}),n)},eLsM:function(e,t,o){var n,r,i,a=t,l=o("oAGj"),s=o("cmoc"),u=o("G/OM"),c=o("fdtz"),h=o("lmwz"),d=o("37nf"),g=o("358a"),p=o("djAF"),f=o("8t9B"),m=o("zjod");a.IFeatureSetHandler=l.defineProtocol("IFeatureSetHandler",{updateFeatureSets:"(FeatureSetsState) -> Void"}),a.NullFeatureSetHandler=(n=function(){},r={},l.defineClass({name:"NullFeatureSetHandler",ctor:n,statics:{instance:{get:function(){return void 0===r.instance&&(r.instance=new n),r.instance}},_implements:function(e){return"IFeatureSetHandler"==e}},props:{updateFeatureSets:function(e){}}}),n),a.StandardFeatureSetHandler=(i=function(e){this.dc=e},l.defineClass({name:"StandardFeatureSetHandler",ctor:i,statics:{_implements:function(e){return"IFeatureSetHandler"==e}},props:{updateFeatureSets:function(e){var t,o,n,r,i,a,d,y,v,S,C=this,T=0,A=0,F=0,k=0,L=0,b=0,_=!1,R=!1,I=!1,w=!1,D=0,x=!1,P=!1,E=!1,M=!1,N=!1,G=!1,B=0,O=0,U=0,H=(t=l.opt(this.dc,(function(e){return e.selection.selectedCount})))||null!=t?t:0,z=!1;if((S=l.opt(this.dc,(function(e){return e.document})))&&(U=g.PagesFacade.getActivePage(S).root.filterWithCallback((function(e){return!(!(o=l.opt(e.controller,(function(e){return e.canMultiSelect})))&&null==o)&&o})).length),l.opt(this.dc,(function(e){return e.selection.forEachSelected((function(e){var t;e.isTypeLockup()&&(T+=1),(e instanceof c.ImageForma||e instanceof s.FrameForma)&&(F+=1),(e instanceof m.VideoForma||(t=l.as(e,s.FrameForma))&&t.childAt(0)instanceof m.VideoForma)&&(k+=1),e instanceof p.ShapeForma&&(L+=1),((n=l.opt(e.controller,(function(e){return e.moveable})))||null!=n)&&n&&(A+=1),((r=l.opt(e.controller,(function(e){return e.opacityChangeable})))||null!=r)&&r&&(O+=1),((i=l.opt(e.controller,(function(e){return e.canGroup})))||null!=i)&&i&&(b+=1),((a=l.opt(e.controller,(function(e){return e.userGroupMember})))||null!=a)&&a&&(e.controller.userGroup&&!e.controller.userGroupChild?_=!0:e.controller.userGroup||(_=!e.controller.enableChildMove)),((d=l.opt(e.controller,(function(e){return e.deleteable})))||null!=d)&&d&&(D+=1),((y=l.opt(e.controller,(function(e){return e.duplicatable})))||null!=y)&&y&&(B+=1),z=z||e.isShape()||e.isTypeLockup(),1==H&&(C.hasLicenseInfo(e)&&(R=!0),l.opt(e.controller,(function(e){return null!=e.settings}))&&(I=!0),((v=l.opt(e.controller,(function(e){return e.replaceable})))||null!=v)&&v&&(x=!0),e.controller instanceof f.TypeLockupController&&(w=!0),P=h.ImageFacade.canCropImage(e),E=h.ImageFacade.canSetBackgroundImage(e),M=h.ImageFacade.canSetFloatingImage(e),N=h.ImageFacade.canApplyBackgroundColor(e),G=h.ImageFacade.canApplyCutout(e))}))})),F>0&&(z=!1),e.clear(),1==T&&1==H&&e.add(new u.TextFrameAttributesFeature),A==H&&A>1&&e.add(new u.AlignSpacingAttributesFeature(!0,A>2,!0,!0)),O==H&&O>0&&e.add(new u.OpacityAttributesFeature),H>0&&e.add(new u.FormaEditFeature(U>1,B==H,b==H&&b>1,_,z,D==H,I,w)),F+L==H){var Y=new u.ImageFeature(F==H&&F>0,x,R,P,E,M,N,G);e.add(Y)}k==H&&e.add(new u.VideoAttributesFeature)},hasLicenseInfo:function(e){var t=d.ImageUtils.getMediaMetadataForForma(e);return!(null==t||!t.sourceHasLicense())}}}),i)},eiag:function(e,t,o){var n,r=t,i=o("oAGj"),a=o("gXiO");r.FormaPlacementInput=(n=function(e,t,o,n,r,l,s){this.forma=e,this.otherRects=i.clone(t),this.floatingRects=i.clone(o),this.textRects=i.clone(n),this.imageRects=i.clone(r),this.images=i.clone(l),this.backgroundRegions=i.clone(s),a.CoreObject.call(this)},i.defineClass({name:"FormaPlacementInput",ctor:n,superName:"CoreObject"}),n)},elwG:function(e,t,o){var n,r,i,a,l=t,s=o("oAGj"),u=o("FNB+"),c=o("iCxV"),h=o("lmwz"),d=o("6Tzw");l.IClickHandler=s.defineProtocol("IClickHandler",{handleClick:"(FormaClickEvent) -> Void",handleDoubleClick:"(FormaDoubleClickEvent) -> Void"}),l.NullClickHandler=(n=function(){},r={},s.defineClass({name:"NullClickHandler",ctor:n,statics:{instance:{get:function(){return void 0===r.instance&&(r.instance=new n),r.instance}},_implements:function(e){return"IClickHandler"==e}},props:{handleClick:function(e){},handleDoubleClick:function(e){}}}),n),l.StandardClickHandler=(i=function(e){this.dc=e},s.defineClass({name:"StandardClickHandler",ctor:i,statics:{_implements:function(e){return"IClickHandler"==e}},props:{nearestSelectable:function(e,t){var o,n,r=null;if(r=((o=s.opt(s.opt(e,(function(e){return e.controller})),(function(e){return e.selectable})))||null!=o)&&o?e:s.opt(e,(function(e){return e.visit(u.FormaTraversal.NearestAncestor,(function(e,t,o){return!(!(n=s.opt(e.controller,(function(e){return e.selectable})))&&null==n)&&n}))})),this.dc.selection.inCharStyleMode)return r;var i,a,l=1==t.modifierKeys.shift||1==t.modifierKeys.command||1==t.modifierKeys.control;if((i=s.opt(r,(function(e){return e.controller})))&&(a=i.userGroupRoot)){if(l&&this.dc.selection.isSelected(a))return r=a;for(var c=[a],h=s.clone(a.filterWithCallback((function(e){return null!=e.controller}))),d=[],g=s.iter(h);!g.done;g.next()){var p,f,m,y=g.value;if((p=y.totalPlacement.inverse)&&(f=y.bounds)&&(m=t.clickLocation)){var v=p.transformPoint(m);!f.containsPoint(v)||!y.controller.selectable||y.controller.userGroup&&!this.dc.enableMoveableChildren||s.containsEq(c,y,u._equality_Forma_Forma)||(y.controller.userGroup?c.push(y):d.splice(0,0,y))}}c=c.concat(d);var S=!1;if(r=s.first(c),c.length>1)for(var C=s.iter(s.range(0,c.length,!1));!C.done;C.next()){var T=C.value;this.dc.selection.isSelected(c[T])&&(r=c[k=T==c.length-1?0:T+1],S=!0)}if(!S)for(var A=s.iter(this.dc.selection.asFormaArray());!A.done;A.next()){var F=A.value;if(F.isDescendent(a))if(this.dc.enableMoveableChildren){for(var k=0,L=s.iter(s.range(0,c.length,!1));!L.done;L.next())T=L.value,F.isDescendent(c[T])&&(k=Math.min(T+1,c.length-1));r=c[k]}else r=s.last(c)}}return r},handleClick:function(e){var t,o=this;if(t=this.nearestSelectable(e.forma,e)){var n=1==e.modifierKeys.shift||1==e.modifierKeys.command||1==e.modifierKeys.control;c.Host.platform.isWeb||(c.Host.platform.isIOS||c.Host.platform.isAndroid),n&&!this.dc.selection.inCharStyleMode?this.dc.selection.isSelected(t)?this.dc.selection.deselectForma(t):this.canAddToSelection(t)&&d.SelectionFacade.selectFormae([t]):this.dc.selection.isSelected(t)?c.Host.platform.isWeb||this.dc.selection.inCropMode||this.dc.selection.deselectForma(t):s.opt(c.Host.platform,(function(e){return 1==e.isWeb||o.dc.selection.selectedCount<2||t.controller.canMultiSelect}))&&!this.dc.selection.inCropMode&&(this.dc.selection.inCharStyleMode=!1,this.dc.selection.replaceSelection(t),this.dc.controllerSettingsState.settings=null)}s.opt(this.dc,(function(t){return t.notifyClick(e)}))},canAddToSelection:function(e){var t,o,n;if(s.opt(this.dc,(function(e){return 0==e.selection.selectedCount})))return!0;if(n=s.opt(this.dc,(function(e){return e.selection.formaAt(0)}))){var r=e;return r.isImage()&&(r=h.ImageFacade.getFrameFormaForForma(r)||e),!(!(t=s.opt(r.controller,(function(e){return e.moveable})))&&null==t)&&t&&!(!(o=s.opt(n.controller,(function(e){return e.moveable})))&&null==o)&&o}return!0},handleDoubleClick:function(e){s.opt(e.forma.controller,(function(t){return t.onEvent(e)})),s.opt(this.dc,(function(t){return t.notifyDoubleClick(e)}))}}}),i),l.CropModeClickHandler=(a=function(e){l.StandardClickHandler.call(this,e)},s.defineClass({name:"CropModeClickHandler",ctor:a,superName:"StandardClickHandler",statics:{_implements:function(e){return"IClickHandler"==e}},props:{handleDoubleClick:function(e){}}}),a)},fGVU:function(e,t,o){var n,r=t,i=o("oAGj"),a=o("NkBu"),l=o("RkYL"),s=o("sW6f"),u=o("zjod");r.VideoController=(n=function(e,t,o){a.ImageController.call(this,e,t,o)},i.defineClass({name:"VideoController",ctor:n,superName:"ImageController",statics:{KIND:{get:function(){return"video"}}},props:{replaceable:{get:function(){return!0}},duplicatable:{get:function(){return!1}},canMultiSelect:{get:function(){return!1}},contentNode:{get:function(){var e=i.opt(i.as(this.forma,u.VideoForma),(function(e){return e.videoContentID}));return null==e?null:i.as(i.opt(i.opt(this.forma,(function(e){return e.page.document})),(function(t){return t.content.nodeByID(e)})),s.VideoContentNode)}},videoDuration:{get:function(){return i.opt(this.contentNode,(function(e){return e.duration}))||l.TheoTime.Zero}}}}),n)},g8Fi:function(e,t,o){var n,r,i,a,l,s=t,u=o("oAGj"),c=o("gXiO"),h=o("iCxV"),d=o("fNpk"),g=o("90dd"),p=o("oKlP"),f=o("ZoS2");s.PointerTypeEnum=u.defineEnum("PointerTypeEnum",{Mouse:0,Touch:1}),s.PointerStatus=u.defineEnum("PointerStatus",{DragFree:0,DragHeld:1,DragActive:2,DragInactive:3}),s.PointerMark=(n=function(e,t){this.when=e,this.point=t},u.defineClass({name:"PointerMark",ctor:n,props:{div:function(e){return new n(this.when/e,{x:this.point.x/e,y:this.point.y/e})}}}),n),s._minus_PointerMark_PointerMark=function(e,t){return new s.PointerMark(e.when-t.when,{x:e.point.x-t.point.x,y:e.point.y-t.point.y})},s._plus_PointerMark_PointerMark=function(e,t){return new s.PointerMark(e.when+t.when,{x:e.point.x+t.point.x,y:e.point.y+t.point.y})},s.PointerState=(r=function(e,t,o,n,r){this.down=!1,this.cancelled=!1,this.tapCount=1,this.modifierKeys={},this.pointerStatus=s.PointerStatus.DragFree,this.slippage=p.TheoPoint.ZERO,this.id=e,this.type=t,this.currentPage=o,this.startLocation=n,this.currentLocation=n,this.startTime=r,this.currentTime=r,this.history=[],c.CoreObject.call(this),this.updateHistory(r,n)},u.defineClass({name:"PointerState",ctor:r,superName:"CoreObject",props:{updateState:function(e){d.LegacyCoreAssert.isTrue(e.type==this.type&&e.onPage===this.currentPage&&e.id==this.id,"pointer update type/page/id does not match",void 0,"PointerState.updateState","PointersState.swift",142),this.currentLocation=e.loc,this.currentTime=e.when,this.updateHistory(e.when,e.loc),this.tapCount=e.tapCount,this.cancelled=e.cancelled,this.viewportTransform=e.viewportTransform,this.modifierKeys=u.clone(e.modifierKeys)},updateHistory:function(e,t){var o=this.history.length-28;o>0&&this.history.splice(0,o),this.history.push(new s.PointerMark(e,{x:t.x,y:t.y}))},pointerVelocity:function(){for(var e=h.Host.async.getSystemUptimeInSeconds()-.2,t=[],o=this.history.length-1;o>=0&&!(this.history[o].when<e);)t.splice(0,0,this.history[o]),o-=1;for(var n=u.clone(function(e,t){var o=u.clone(e),n=t;if(n>e.length&&(n=e.length),n<=1)return o;for(var r=u.iter(u.range(1,n,!1));!r.done;r.next())for(var i=r.value,a=u.iter(u.range(0,e.length-i,!1));!a.done;a.next())o[i+(h=a.value)]=s._plus_PointerMark_PointerMark(o[i+h],e[h]);for(var l=u.iter(u.range(1,n,!1));!l.done;l.next())o[i=l.value]=o[i].div(u.toDouble(i+1));for(var c=u.iter(u.range(n,e.length,!1));!c.done;c.next()){var h;o[h=c.value]=o[h].div(u.toDouble(n))}return o}(t,3)),r=3,i=2,a=0,l=0;r<n.length;){var c=s._minus_PointerMark_PointerMark(n[r],n[i]);a+=c.when,l+=Math.sqrt(c.point.x*c.point.x+c.point.y*c.point.y),r+=1,i+=1}var d=l/a;return isNaN(d)?0:d}}}),r),s.PointerUpdate=(i=function(e,t,o,n,r){this.cancelled=!1,this.tapCount=1,this.id=e,this.type=t,this.onPage=o,this.loc=n,this.when=r,this.cancelled=!1,this.tapCount=1,this.modifierKeys={}},u.defineClass({name:"PointerUpdate",ctor:i,superName:"CoreObject"}),i),s.PointersState=(a=function(){this.LONG_PRESS_TIME_THRESHOLD=1.25,this.LONG_PRESS_DIST_THRESHOLD=50,this.pointers_=[],f.TheoPublishingObject.call(this)},u.defineClass({name:"PointersState",ctor:a,superName:"TheoPublishingObject",statics:{_implements:function(e){return"TheoMessagePublisher"==e}},props:{onPointersDown:function(e){for(var t=[],o=u.iter(e);!o.done;o.next()){var n,r=o.value;(n=this.pointerByID(r.id))&&(d.LegacyCoreAssert.isTrue(r.type==s.PointerTypeEnum.Mouse,"unexpected update type",{type:r.type},"PointersState.onPointersDown","PointersState.swift",326),u.remove(this.pointers_,n)),(n=new s.PointerState(r.id,r.type,r.onPage,r.loc,r.when)).viewportTransform=r.viewportTransform,n.down=!0,n.modifierKeys=u.clone(r.modifierKeys),this.pointers_.push(n),t.push(n)}this.publish(new s.PointersStateChangeMessage(this,s.PointersStateChangeTypeEnum.PointersDown,t))},onPointersMoved:function(e){for(var t=[],o=u.iter(e);!o.done;o.next()){var n=o.value,r=this.pointerByID(n.id);null==r&&((r=new s.PointerState(n.id,n.type,n.onPage,n.loc,n.when)).down=!1,d.LegacyCoreAssert.isTrue(n.type==s.PointerTypeEnum.Mouse,"unexpected update type",{type:n.type},"PointersState.onPointersMoved","PointersState.swift",355),this.pointers_.push(r)),r.updateState(n),t.push(r)}this.publish(new s.PointersStateChangeMessage(this,s.PointersStateChangeTypeEnum.PointersMoved,t))},onPointersUp:function(e){for(var t=[],o=u.iter(e);!o.done;o.next()){var n,r=o.value;(n=this.pointerByID(r.id))&&(n.type==s.PointerTypeEnum.Touch&&u.remove(this.pointers_,n),n.updateState(r),t.push(n))}var i=new s.PointersStateChangeMessage(this,s.PointersStateChangeTypeEnum.PointersUp,t);this.publish(i)},forEachPointer:function(e){for(var t=u.iter(this.pointers_);!t.done;t.next())e(t.value)},forEachPointerDown:function(e){for(var t=u.iter(this.pointers_);!t.done;t.next()){var o=t.value;o.down&&e(o)}},pointerCount:function(){return this.pointers_.length},pointerDownCount:function(){for(var e=0,t=u.iter(this.pointers_);!t.done;t.next())t.value.down&&(e+=1);return e},pointerByID:function(e){for(var t=u.iter(this.pointers_);!t.done;t.next()){var o=t.value;if(o.id==e)return o}return null}}}),a),s.PointersStateChangeTypeEnum=u.defineEnum("PointersStateChangeTypeEnum",{PointersDown:0,PointersMoved:1,PointersUp:2}),s.PointersStateChangeMessage=(l=function e(t,o,n){this.changeType=o,this.pointers=u.clone(n),g.TheoMessage.call(this,e.TYPE,t)},u.defineClass({name:"PointersStateChangeMessage",ctor:l,superName:"TheoMessage",statics:{TYPE:{get:function(){return"PointersStateChangeMessage"}}}}),l)},h67N:function(e,t,o){var n,r=t,i=o("oAGj"),a=o("gXiO"),l=o("6ZWm"),s=o("tQF8"),u=o("4mVB"),c=o("iCxV"),h=o("fdtz"),d=o("fNpk"),g=o("3v9D"),p=o("sIWg");r.GridLibrary=(n=function(){this.gridStyles=[u.GridStyle.init_bf40("Single","Simple",[new s.GridCell(new p.TheoRect(0,0,1,1))],void 0,void 0,void 0,l.CropType.PreserveFocus),u.GridStyle.init_bf40("Single-Overlap","Banner",[new s.GridCell(new p.TheoRect(0,0,1,1)),new s.GridCell(new p.TheoRect(.25,0,.75,1),null,.75)]),u.GridStyle.init_bf40("Single-Center-Overlap","Banner",[new s.GridCell(new p.TheoRect(0,0,1,1)),new s.GridCell(new p.TheoRect(.25,.25,.75,.75),null,.75)]),u.GridStyle.init_bf40("Half-2",void 0,[new s.GridCell(new p.TheoRect(0,0,.5001,1)),new s.GridCell(new p.TheoRect(.5001,0,1,1))]),u.GridStyle.init_bf40("Third-2",void 0,[new s.GridCell(new p.TheoRect(0,0,1/3,1)),new s.GridCell(new p.TheoRect(1/3,0,1,1))]),u.GridStyle.init_bf40("Half-2-1",void 0,[new s.GridCell(new p.TheoRect(0,0,.5001,.5001)),new s.GridCell(new p.TheoRect(0,.5001,.5001,1)),new s.GridCell(new p.TheoRect(.5001,0,1,1))]),u.GridStyle.init_bf40("Third-2-1",void 0,[new s.GridCell(new p.TheoRect(0,0,1/3,1)),new s.GridCell(new p.TheoRect(1/3,0,1,.5001)),new s.GridCell(new p.TheoRect(1/3,.5001,1,1))]),u.GridStyle.init_bf40("Third-3",void 0,[new s.GridCell(new p.TheoRect(0,0,1/3,1)),new s.GridCell(new p.TheoRect(1/3,0,2/3,1)),new s.GridCell(new p.TheoRect(2/3,0,1,1))]),u.GridStyle.init_bf40("Half-2-2",void 0,[new s.GridCell(new p.TheoRect(0,0,.5,.5)),new s.GridCell(new p.TheoRect(0,.5,.5,1)),new s.GridCell(new p.TheoRect(.5,0,1,.5)),new s.GridCell(new p.TheoRect(.5,.5,1,1))]),u.GridStyle.init_bf40("Half-3-1",void 0,[new s.GridCell(new p.TheoRect(0,0,1/3,1/3)),new s.GridCell(new p.TheoRect(0,1/3,1/3,2/3)),new s.GridCell(new p.TheoRect(0,2/3,1/3,1)),new s.GridCell(new p.TheoRect(1/3,0,1,1))]),u.GridStyle.init_bf40("Half-1-3",void 0,[new s.GridCell(new p.TheoRect(0,0,.5001,1)),new s.GridCell(new p.TheoRect(.5001,0,1,1/3)),new s.GridCell(new p.TheoRect(.5001,1/3,1,2/3)),new s.GridCell(new p.TheoRect(.5001,2/3,1,1))]),u.GridStyle.init_bf40("Third-1-2-1",void 0,[new s.GridCell(new p.TheoRect(0,0,1/3,1)),new s.GridCell(new p.TheoRect(1/3,0,2/3,.5001)),new s.GridCell(new p.TheoRect(1/3,.5001,2/3,1)),new s.GridCell(new p.TheoRect(2/3,0,1,1))]),u.GridStyle.init_bf40("Half-2-2-Offset",void 0,[new s.GridCell(new p.TheoRect(.5,0,1,.35)),new s.GridCell(new p.TheoRect(0,.65,.5,1)),new s.GridCell(new p.TheoRect(0,0,.5,.65)),new s.GridCell(new p.TheoRect(.5,.35,1,1))]),u.GridStyle.init_bf40("Fourth-1",void 0,[new s.GridCell(new p.TheoRect(0,0,1/4,1)),new s.GridCell(new p.TheoRect(1/4,0,.5001,1)),new s.GridCell(new p.TheoRect(.5001,0,3/4,1)),new s.GridCell(new p.TheoRect(3/4,0,1,1))]),u.GridStyle.init_bf40("Half-2-3",void 0,[new s.GridCell(new p.TheoRect(0,0,1,.5001)),new s.GridCell(new p.TheoRect(0,.5001,.5001,1)),new s.GridCell(new p.TheoRect(.5001,.5001,1,.75)),new s.GridCell(new p.TheoRect(.5001,.75,1,1))]),u.GridStyle.init_bf40("Half-1-3",void 0,[new s.GridCell(new p.TheoRect(0,0,.5001,1)),new s.GridCell(new p.TheoRect(.5001,0,3/4,.5001)),new s.GridCell(new p.TheoRect(3/4,0,1,.5001)),new s.GridCell(new p.TheoRect(.5001,.5001,1,1))]),u.GridStyle.init_bf40("Third-2-3-2",void 0,[new s.GridCell(new p.TheoRect(0,0,.75,.25)),new s.GridCell(new p.TheoRect(.75,0,1,.75)),new s.GridCell(new p.TheoRect(.25,.25,.75,.75)),new s.GridCell(new p.TheoRect(0,.25,.25,1)),new s.GridCell(new p.TheoRect(.25,.75,1,1))]),u.GridStyle.init_bf40("Third-1-3-1",void 0,[new s.GridCell(new p.TheoRect(0,0,1/3,1)),new s.GridCell(new p.TheoRect(1/3,0,2/3,1/3)),new s.GridCell(new p.TheoRect(1/3,1/3,2/3,2/3)),new s.GridCell(new p.TheoRect(1/3,2/3,2/3,1)),new s.GridCell(new p.TheoRect(2/3,0,1,1))]),u.GridStyle.init_bf40("Fifth-5",void 0,[new s.GridCell(new p.TheoRect(0,0,.2,1)),new s.GridCell(new p.TheoRect(.2,0,.4,1)),new s.GridCell(new p.TheoRect(.4,0,.6,1)),new s.GridCell(new p.TheoRect(.6,0,.8,1)),new s.GridCell(new p.TheoRect(.8,0,1,1))]),u.GridStyle.init_bf40("Third-2-1-2",void 0,[new s.GridCell(new p.TheoRect(0,0,1/3,2/3)),new s.GridCell(new p.TheoRect(0,2/3,1/3,1)),new s.GridCell(new p.TheoRect(1/3,0,2/3,1)),new s.GridCell(new p.TheoRect(2/3,0,1,1/3)),new s.GridCell(new p.TheoRect(2/3,1/3,1,1))]),u.GridStyle.init_bf40("Third-1-1-4",void 0,[new s.GridCell(new p.TheoRect(0,0,2/3,1)),new s.GridCell(new p.TheoRect(2/3,0,1,1/4)),new s.GridCell(new p.TheoRect(2/3,1/4,1,.5001)),new s.GridCell(new p.TheoRect(2/3,.5001,1,3/4)),new s.GridCell(new p.TheoRect(2/3,3/4,1,1))]),u.GridStyle.init_bf40("Split-3-2",void 0,[new s.GridCell(new p.TheoRect(0,0,1/3,.5001)),new s.GridCell(new p.TheoRect(0,.5001,.5001,1)),new s.GridCell(new p.TheoRect(1/3,0,2/3,.5001)),new s.GridCell(new p.TheoRect(2/3,0,1,.5001)),new s.GridCell(new p.TheoRect(.5001,.5001,1,1))]),u.GridStyle.init_bf40("Split-2-3",void 0,[new s.GridCell(new p.TheoRect(0,0,.5001,.5001)),new s.GridCell(new p.TheoRect(0,.5001,1/3,1)),new s.GridCell(new p.TheoRect(.5001,0,1,.5001)),new s.GridCell(new p.TheoRect(1/3,.5001,2/3,1)),new s.GridCell(new p.TheoRect(2/3,.5001,1,1))]),u.GridStyle.init_bf40("Half-3-3",void 0,[new s.GridCell(new p.TheoRect(0,0,.5,1/3)),new s.GridCell(new p.TheoRect(0,1/3,.5,2/3)),new s.GridCell(new p.TheoRect(0,2/3,.5,1)),new s.GridCell(new p.TheoRect(.5,0,1,1/3)),new s.GridCell(new p.TheoRect(.5,1/3,1,2/3)),new s.GridCell(new p.TheoRect(.5,2/3,1,1))]),u.GridStyle.init_bf40("Split-2-2-2",void 0,[new s.GridCell(new p.TheoRect(0,0,1/3,2/3)),new s.GridCell(new p.TheoRect(0,2/3,1/3,1)),new s.GridCell(new p.TheoRect(1/3,0,2/3,.5001)),new s.GridCell(new p.TheoRect(1/3,.5001,2/3,1)),new s.GridCell(new p.TheoRect(2/3,0,1,1/3)),new s.GridCell(new p.TheoRect(2/3,1/3,1,1))]),u.GridStyle.init_bf40("Quarter-2-2-2-2",void 0,[new s.GridCell(new p.TheoRect(0,0,.5001,2/3)),new s.GridCell(new p.TheoRect(0,2/3,1/4,1)),new s.GridCell(new p.TheoRect(1/4,2/3,.5001,1)),new s.GridCell(new p.TheoRect(.5001,0,3/4,1/3)),new s.GridCell(new p.TheoRect(3/4,0,1,1/3)),new s.GridCell(new p.TheoRect(.5001,1/3,1,1))]),u.GridStyle.init_bf40("Third-2-2-3",void 0,[new s.GridCell(new p.TheoRect(0,0,2/3,2/3)),new s.GridCell(new p.TheoRect(0,2/3,1/3,1)),new s.GridCell(new p.TheoRect(1/3,2/3,2/3,1)),new s.GridCell(new p.TheoRect(2/3,0,1,1/3)),new s.GridCell(new p.TheoRect(2/3,1/3,1,2/3)),new s.GridCell(new p.TheoRect(2/3,2/3,1,1))]),u.GridStyle.init_bf40("Third-3-2-2",void 0,[new s.GridCell(new p.TheoRect(0,0,1/3,1/3)),new s.GridCell(new p.TheoRect(0,1/3,1/3,2/3)),new s.GridCell(new p.TheoRect(0,2/3,1/3,1)),new s.GridCell(new p.TheoRect(1/3,0,1,2/3)),new s.GridCell(new p.TheoRect(1/3,2/3,2/3,1)),new s.GridCell(new p.TheoRect(2/3,2/3,1,1))]),u.GridStyle.init_bf40("Split-3-1-3",void 0,[new s.GridCell(new p.TheoRect(0,0,1/3,1/3)),new s.GridCell(new p.TheoRect(0,1/3,1,2/3)),new s.GridCell(new p.TheoRect(0,2/3,1/3,1)),new s.GridCell(new p.TheoRect(1/3,0,2/3,1/3)),new s.GridCell(new p.TheoRect(1/3,2/3,2/3,1)),new s.GridCell(new p.TheoRect(2/3,0,1,1/3)),new s.GridCell(new p.TheoRect(2/3,2/3,1,1))]),u.GridStyle.init_bf40("Split-2-3-2",void 0,[new s.GridCell(new p.TheoRect(0,0,.5001,1/3)),new s.GridCell(new p.TheoRect(0,1/3,1/3,2/3)),new s.GridCell(new p.TheoRect(0,2/3,.5001,1)),new s.GridCell(new p.TheoRect(1/3,1/3,2/3,2/3)),new s.GridCell(new p.TheoRect(.5001,0,1,1/3)),new s.GridCell(new p.TheoRect(2/3,1/3,1,2/3)),new s.GridCell(new p.TheoRect(.5001,2/3,1,1))]),u.GridStyle.init_bf40("Half-4-4",void 0,[new s.GridCell(new p.TheoRect(0,0,.5001,1/4)),new s.GridCell(new p.TheoRect(0,1/4,.5001,.5001)),new s.GridCell(new p.TheoRect(0,.5001,.5001,3/4)),new s.GridCell(new p.TheoRect(0,3/4,.5001,1)),new s.GridCell(new p.TheoRect(.5001,0,1,1/4)),new s.GridCell(new p.TheoRect(.5001,1/4,1,.5001)),new s.GridCell(new p.TheoRect(.5001,.5001,1,3/4)),new s.GridCell(new p.TheoRect(.5001,3/4,1,1))]),u.GridStyle.init_bf40("Split-3-2-3",void 0,[new s.GridCell(new p.TheoRect(0,0,1/3,1/3)),new s.GridCell(new p.TheoRect(0,1/3,.5001,2/3)),new s.GridCell(new p.TheoRect(0,2/3,1/3,1)),new s.GridCell(new p.TheoRect(1/3,0,2/3,1/3)),new s.GridCell(new p.TheoRect(1/3,2/3,2/3,1)),new s.GridCell(new p.TheoRect(2/3,0,1,1/3)),new s.GridCell(new p.TheoRect(.5001,1/3,1,2/3)),new s.GridCell(new p.TheoRect(2/3,2/3,1,1))]),u.GridStyle.init_bf40("Third-3-3-3",void 0,[new s.GridCell(new p.TheoRect(0,0,1/3,1/3)),new s.GridCell(new p.TheoRect(0,1/3,1/3,2/3)),new s.GridCell(new p.TheoRect(0,2/3,1/3,1)),new s.GridCell(new p.TheoRect(1/3,0,2/3,1/3)),new s.GridCell(new p.TheoRect(1/3,1/3,2/3,2/3)),new s.GridCell(new p.TheoRect(1/3,2/3,2/3,1)),new s.GridCell(new p.TheoRect(2/3,0,1,1/3)),new s.GridCell(new p.TheoRect(2/3,1/3,1,2/3)),new s.GridCell(new p.TheoRect(2/3,2/3,1,1))]),u.GridStyle.init_bf40("Third-4-1-4",void 0,[new s.GridCell(new p.TheoRect(0,0,1/3,1/4)),new s.GridCell(new p.TheoRect(0,1/4,1/3,.5001)),new s.GridCell(new p.TheoRect(0,.5001,1/3,3/4)),new s.GridCell(new p.TheoRect(0,3/4,1/3,1)),new s.GridCell(new p.TheoRect(1/3,0,2/3,1)),new s.GridCell(new p.TheoRect(2/3,0,1,1/4)),new s.GridCell(new p.TheoRect(2/3,1/4,1,.5001)),new s.GridCell(new p.TheoRect(2/3,.5001,1,3/4)),new s.GridCell(new p.TheoRect(2/3,3/4,1,1))]),u.GridStyle.init_bf40("Third-4-3-2",void 0,[new s.GridCell(new p.TheoRect(0,0,1/3,1/4)),new s.GridCell(new p.TheoRect(0,1/4,1/3,.5001)),new s.GridCell(new p.TheoRect(0,.5001,1/3,3/4)),new s.GridCell(new p.TheoRect(0,3/4,1/3,1)),new s.GridCell(new p.TheoRect(1/3,0,2/3,1/3)),new s.GridCell(new p.TheoRect(1/3,1/3,2/3,2/3)),new s.GridCell(new p.TheoRect(1/3,2/3,2/3,1)),new s.GridCell(new p.TheoRect(2/3,0,1,.5001)),new s.GridCell(new p.TheoRect(2/3,.5001,1,1))]),u.GridStyle.init_bf40("Split-2-3-4",void 0,[new s.GridCell(new p.TheoRect(0,0,.5001,1/3)),new s.GridCell(new p.TheoRect(0,1/3,1/3,2/3)),new s.GridCell(new p.TheoRect(0,2/3,1/4,1)),new s.GridCell(new p.TheoRect(.5001,0,1,1/3)),new s.GridCell(new p.TheoRect(1/3,1/3,2/3,2/3)),new s.GridCell(new p.TheoRect(1/4,2/3,.5001,1)),new s.GridCell(new p.TheoRect(2/3,1/3,1,2/3)),new s.GridCell(new p.TheoRect(.5001,2/3,3/4,1)),new s.GridCell(new p.TheoRect(3/4,2/3,1,1))])],a.CoreObject.call(this)},i.defineClass({name:"GridLibrary",ctor:n,superName:"CoreObject",props:{layoutSuggestionModel:{get:function(){return null==this.layoutSuggestionModel_&&(this.layoutSuggestionModel_=i.opt(c.Host.learning,(function(e){return e.loadLayoutSuggestionModel()}))),this.layoutSuggestionModel_},set:function(e){this.layoutSuggestionModel_=e}},canFlipStyle:function(e){return!["Single","Single-Center-Overlap","Half-2-2","Third-2-3-2","Third-2-3-2-Spaced","Third-3-3-3","Third-2-2-3","Half-2-3","Third-4-3-2","Half-1-3","Third-3-2-2","Split-2-3-4"].includes(e.name)},basicFullDesignGridStyle:function(){var e=this.getGridStyle("Single");return e.moveableShift=!1,e},getAllGrids:function(){for(var e=[],t=i.iter(this.gridStyles);!t.done;t.next()){var o=t.value;e.push(o),this.canFlipStyle(o)&&e.push(o.flipRegion())}return e},getLayoutsForRoot:function(e,t){void 0===t&&(t=null);var o,n=[],r=[];if(!(o=e.controller.getGridController()))return d.LegacyCoreAssert.fail("should always have a grid at this point",void 0,"GridLibrary.getLayoutsForRoot","GridLibrary.swift",558),[];for(var a=g.LayoutSuggester.init_abc1(o.forma,t),l=i.clone(e.filterWithCallback((function(e){return null!=e.controller&&e.controller.floating}))),s=i.clone(e.filterWithCallback((function(e){return null!=e.parent&&e.parent.isBackgroundImage()}))),u=s.length,c=!0,p=i.iter(s);!p.done;p.next()){var f=p.value;if(i.opt(i.opt(i.as(f,h.ImageForma),(function(e){return e.contentNode})),(function(e){return null==e.focusRegion}))){c=!1;break}}var m=[],y=1,v=c&&u>1?1:0,S=c?1:2,C=c?1:0;u>5&&(c?(y=0==l.length?2:1,v=0==l.length?2:1,S=0==l.length?0:1,C=0==l.length?0:1):(y=0==l.length?4:2,S=0==l.length?0:2));var T,A=i.clone(a.createSuggestions(!0,!1,!1,!1,y));(r=i.clone(a.createEqualSizeSuggestions(!1,10)),i.append(A,r),A.length>0&&i.append(m,A.slice(0,Math.min(y,A.length))),c&&(A=i.clone(a.createSuggestions(!0,!1,!1,!0,v))).length>0&&i.append(m,A.slice(0,Math.min(v,A.length))),0==!l.length)&&((T=i.clone(a.createSuggestions(!0,!1,!0,!1,S))).length>0&&i.append(m,T.slice(0,Math.min(S,T.length))),c&&(T=i.clone(a.createSuggestions(!0,!1,!0,!0,C))).length>0&&i.append(m,T.slice(0,Math.min(C,T.length))),i.append(r,a.createEqualSizeSuggestions(!0,10)));for(var F=i.iter(i.range(0,m.length,!1));!F.done;F.next())(E=m[P=F.value]).gridStyle.name="ContentAwareGrid-"+i.toString(P),E.gridStyle.category="Suggested",E.gridStyle.forma=o.forma,n.push(E.gridStyle);for(var k=i.clone(a.predictLayoutIds(3,n)),L=i.iter(k);!L.done;L.next()){var b=L.value;if(D=this.getGridStyle(b)){var _=D.clone();_.category="Suggested",n.push(_)}}for(var R=e.filterWithCallback((function(e){return e.isBackgroundImage()})).length,I=[],w=i.iter(this.gridStyles);!w.done;w.next()){var D;(D=w.value).nonOverlappingCells().length>=R&&(n.push(D),I.push(D),this.canFlipStyle(D)&&(n.push(D.flipRegion()),I.push(D.flipRegion())))}for(var x=i.iter(i.range(0,r.length,!1));!x.done;x.next()){for(var P,E,M=(E=r[P=x.value]).gridStyle,N=!1,G=i.iter(I);!G.done;G.next())if(G.value.geometricEquals(M)){N=!0;break}N||n.push(M)}return n},getGridsByCellNumber:function(e,t){if(void 0===t&&(t=!0),1==e&&0==t)return[this.getGridStyle("Single")];for(var o=[],n=i.iter(this.gridStyles);!n.done;n.next()){var r=n.value,a=r.nonOverlappingCells().length;(t?a>=e:a==e)&&!r.anyOverlap&&(o.push(r),this.canFlipStyle(r)&&o.push(r.flipRegion()))}return 0==o.length&&d.LegacyCoreAssert.fail("No matching grids in the library. Need to implement a generic grid creator.",void 0,"GridLibrary.getGridsByCellNumber","GridLibrary.swift",623),o},getGridStyle:function(e){for(var t,o=i.iter(this.gridStyles);!o.done;o.next()){var n=o.value;if(e==n.name){t=n;break}if(this.canFlipStyle(n)){var r=n.flipRegion();if(e==r.name){t=r;break}}}return t},getCategoryForStyle:function(e){var t;return null!=(t=e.category)?t:"Single"==e.name?"Simple":e.name.includes("Overlap")?"Banner":e.name.includes("ContentAwareGrid")?"Suggested":"Grid"}}}),n)},h8Q5:function(e,t,o){var n,r=t,i=o("oAGj"),a=o("hb8m"),l=o("PXFs");r.WheelSuggestionEvaluator=(n=function(e){this.lockupStyleEvaluator=new a.LockupStyleEvaluator(e),this.postTextStylesServiceInterface=new l.PostTextStylesServiceInterface(e,this.lockupStyleEvaluator.getLockupReadabilityEvaluator())},i.defineClass({name:"WheelSuggestionEvaluator",ctor:n,superName:"CoreObject",props:{getTextStyleSuggestion:function(e){return this.postTextStylesServiceInterface.advancedFeatures?this.postTextStylesServiceInterface.getAdvancedTextStyleSuggestion(e):this.postTextStylesServiceInterface.getTextStyleSuggestion(e)}}}),n)},hJqd:function(e,t,o){var n,r,i,a,l=t,s=o("oAGj"),u=o("Tq01"),c=o("kYI4"),h=o("Kkml");l.BrandifyAction=(n=function e(t,o,n,r,i){void 0===n&&(n=!0),void 0===r&&(r=!0),void 0===i&&(i=!0),this.pages=s.clone(o),this.authoringContext=t,this.applyFonts=n,this.applyColors=i,this.addLogo=r,u.Action.call(this,e.TYPE)},s.defineClass({name:"BrandifyAction",ctor:n,superName:"Action",statics:{TYPE:"BrandifyAction"},props:{getUserAction:function(e){return h.UserActions.BrandDocument()},execute:function(e){return c.BrandingFacade.brandifyDocument(this.pages,this.authoringContext,this.applyFonts,this.addLogo,this.applyColors)}}}),n),l.ChangeBrandingAction=(r=function e(t,o,n){this.fromDocAuthoringContextID=o,this.fromActiveAuthoringContextID=n,this.toAuthoringContext=t,u.Action.call(this,e.TYPE)},s.defineClass({name:"ChangeBrandingAction",ctor:r,superName:"Action",statics:{TYPE:"ChangeBrandingAction"},props:{getUserAction:function(e){return h.UserActions.ChangeBranding(this.fromDocAuthoringContextID,this.fromActiveAuthoringContextID,s.opt(this.toAuthoringContext,(function(e){return e.id})))},execute:function(e){return c.BrandingFacade.changeBranding(e.document,this.toAuthoringContext)}}}),r),l.AddBrandingAction=(i=function e(t){this.authoringContext=t,u.Action.call(this,e.TYPE)},s.defineClass({name:"AddBrandingAction",ctor:i,superName:"Action",statics:{TYPE:"AddBrandingAction"},props:{getUserAction:function(e){return h.UserActions.AddBranding()},execute:function(e){return c.BrandingFacade.addBranding(e.document,this.authoringContext)}}}),i),l.RemoveBrandingAction=(a=function e(t){void 0===t&&(t=!0),this.undoable=t,u.Action.call(this,e.TYPE)},s.defineClass({name:"RemoveBrandingAction",ctor:a,superName:"Action",statics:{TYPE:"RemoveBrandingAction"},props:{getUserAction:function(e){return h.UserActions.RemoveBranding()},execute:function(e){return c.BrandingFacade.removeBranding(e.document)}}}),a)},hb8m:function(e,t,o){var n,r=t,i=o("oAGj"),a=o("wc1n"),l=o("xRbc"),s=o("HG3C"),u=o("c+uM"),c=o("35Q0");r.LockupStyleEvaluator=(n=function e(t){this.forma_=t,this.initialStyle_=t.style,this.backgroundVariance=s.LockupReadabilityEvaluator.calculateBackgroundVariance(t),this.lockupVisualWeightEvaluator=new s.LockupReadabilityEvaluator(this.backgroundVariance,t),this.oldReadabilityInformation=i.clone(this.lockupVisualWeightEvaluator.getLockupReadabilityInformation(this.forma_,this.initialStyle_)),this.featuresNeeded=[l.LockupRoleFeatures.SurroundingAlignment];var o=a.FeatureExtractorFactory.getFeatureExtractor(a.FeatureExtractorType.LockupStyle,this.forma_,this.featuresNeeded);this.majorityAlignment=e.getSurroundingAlignment(o)},i.defineClass({name:"LockupStyleEvaluator",ctor:n,superName:"CoreObject",statics:{getCollisionPercentage:function(e){var t,o=0;return null!=(t=e.numericFeatureForKey(l.LockupRoleFeatures.CollisionPercentage))&&(o=t),o},getSurroundingAlignment:function(e){var t,o,n=u.LockupAlignment.UNSET;return null!=(t=e.featureForKey(l.LockupRoleFeatures.SurroundingAlignment))&&null!=(o=i.as(t,u.LockupAlignment))&&(n=o),n}},props:{getMajorityAlignment:function(){return this.majorityAlignment},styleEvaluatedWithReadability:function(e){var t=e;return 1==e.wheelUsed||e.isEqualTo(this.initialStyle_)?e:(this.newReadabilityInformation=i.clone(this.lockupVisualWeightEvaluator.getLockupReadabilityInformation(this.forma_,e)),e.backing==u.LockupBacking.Knockout&&(t=null),null!=t&&this.replaceBadBackingShapes(t),e.layout!=u.LockupLayout.FitJustified&&e.layout!=u.LockupLayout.Path&&e.layout!=u.LockupLayout.LetterGrid&&this.majorityAlignment!=u.LockupAlignment.UNSET&&e.alignment!=this.majorityAlignment&&(t=null),null!=this.newReadabilityInformation&&null!=this.oldReadabilityInformation&&this.newReadabilityInformation.readabilityScore<=this.oldReadabilityInformation.readabilityScore/2&&(t=null),t)},replaceBadBackingShapes:function(e){if(e.backing==u.LockupBacking.SVGBackground){var t=e.backing,o=e.backingArtworkID;c.ShapeLibrary.isBackingShapeAutoLayoutCompatible(t,o)||(e.backingArtworkID="square_001")}},initializeReadabilityInformation:function(e){this.newReadabilityInformation=i.clone(this.lockupVisualWeightEvaluator.getLockupReadabilityInformation(this.forma_,e))},getOldReadabilityInformation:function(){return this.oldReadabilityInformation},getNewReadabilityInformation:function(){return this.newReadabilityInformation},getLockupReadabilityEvaluator:function(){return this.lockupVisualWeightEvaluator}}}),n)},hsXA:function(e,t,o){var n,r,i,a,l=t,s=o("oAGj"),u=o("1HsO"),c=o("t1qz"),h=o("Mr7n");l.IHandlesHandler=s.defineProtocol("IHandlesHandler",{handleTransformEvent:"(HandleTransformEvent) -> Void",handleFormaDragEvents:"(PSMFormaDragControllerEvent) -> Void",updateHandles:"(IMutableHandlesModel) -> Void"}),l.NullHandlesHandler=(n=function(){},r={},s.defineClass({name:"NullHandlesHandler",ctor:n,statics:{instance:{get:function(){return void 0===r.instance&&(r.instance=new n),r.instance}},_implements:function(e){return"IHandlesHandler"==e}},props:{handleTransformEvent:function(e){},handleFormaDragEvents:function(e){},updateHandles:function(e){}}}),n),l.IHandleGenerator=s.defineProtocol("IHandleGenerator",{addHandles:"(BaseHandlesHandler) -> Array<BaseHandle>"}),l.IHandleProcessor=s.defineProtocol("IHandleProcessor",{handleTransformEvent:"(BaseHandlesHandler, HandleTransformEvent) -> Boolean",handleFormaDragEvents:"(BaseHandlesHandler, PSMFormaDragControllerEvent) -> Boolean"}),l.BaseHandlesHandler=(i=function(e,t){this.dc=null,this.model=null,this.delegate=null,this.activeTransform=u.TransformType.None,this.handleGenerators=[],this.handleProcessors=[],this.dc=e,this.delegate=t},s.defineClass({name:"BaseHandlesHandler",ctor:i,superName:"CoreObject",statics:{_implements:function(e){return"IHandlesHandler"==e}},props:{handleTransformEvent:function(e){for(var t=s.iter(this.handleProcessors);!t.done&&!t.value.handleTransformEvent(this,e);t.next());},handleFormaDragEvents:function(e){for(var t=s.iter(this.handleProcessors);!t.done&&!t.value.handleFormaDragEvents(this,e);t.next());},updateHandles:function(e){for(var t=[],o=s.iter(this.handleGenerators);!o.done;o.next()){var n=o.value;s.append(t,n.addHandles(this))}e.setAll(t)},addHandleGenerator:function(e){this.handleGenerators.push(e)},removeHandleGenerator:function(e){this.handleGenerators=this.handleGenerators.filter((function(t){return t!==e}),this)},clearHandleGenerators:function(){this.handleGenerators=[]},addHandleProcessor:function(e){this.handleProcessors.push(e)},removeHandleProcessor:function(e){this.handleProcessors=this.handleProcessors.filter((function(t){return t!==e}),this)},clearHandleProcessors:function(){this.handleProcessors=[]}}}),i),l.StandardHandlesHandler=(a=function(e,t,o){l.BaseHandlesHandler.call(this,e,o),this.addHandleGenerator(c.StandardHandleGenerator.instance),this.addHandleProcessor(new h.StandardHandleProcessor(t))},s.defineClass({name:"StandardHandlesHandler",ctor:a,superName:"BaseHandlesHandler",statics:{_implements:function(e){return"IHandlesHandler"==e}}}),a)},hywZ:function(e,t,o){var n,r=t,i=o("oAGj"),a=o("UGKO"),l=o("cmoc"),s=o("xe42"),u=o("16hp"),c=o("9Lk3"),h=o("iCxV"),d=o("3DEm"),g=o("uxH+"),p=o("K0Rh"),f=o("sIWg");r.LogoPlacementSuggester=(n=function(e,t){this.CONTRAST_WEIGHT=-10,this.END_BORDER=.98,this.START_BORDER=.02,this.MID_CANONICAL=.5,this.MIN_LIGHTNESS_DIFF=20,this.SYMMETRIC_THRESHOLD=300,u.FormaPlacementSuggester.call(this,e,t)},i.defineClass({name:"LogoPlacementSuggester",ctor:n,superName:"FormaPlacementSuggester",statics:{KIND:{get:function(){return"LogoPlacementSuggester"}}},props:{createPlacementSuggestions:function(e,t){void 0===t&&(t=null);var o=this;if(null==this.group.frame)return[];var n=this.group.frame;if(this.group.kind==p.RootForma.KIND){var r=this.group.page.pageSize;n=f.TheoRect.fromSize(r);var l,h=0,m=this.group.root;if(null!=i.as(m.controller,g.RootController)){var y,v=i.clone(m.filterByControllerKind(c.GridController.KIND));v.length>0&&(y=i.as(v[0].controller,c.GridController))&&(h=y.margin)}(l=this.forma.finalFrame)&&h>0&&(h<l.height||h<l.width)&&(n=f.TheoRect.fromXYWH(h,h,r.width-2*h,r.height-2*h))}for(var S,C=u.FormaPlacementSuggester.createPlacementInputs(this.forma,this.group),T=i.clone(this.getSearchLocations(this.forma,n,C,e,t)),A=-1/0,F=this.initializeLogoPlacementScore(C),k=i.iter(T);!k.done;k.next()){for(var L=k.value,b=u.FormaPlacementSuggester.createPlacementSuggestion(this.forma,L,n,C,F),_=0,R=i.iter(C.backgroundRegions);!R.done;R.next()){var I=R.value;if(null!=L.intersectionWith(I.finalFrame)){var w=i.opt(this.forma.controller,(function(e){return e.getAverageColor(o.forma.finalFrame)})),D=i.opt(I.controller,(function(e){return e.getAverageColor(L)}));if(null!=w&&null!=D&&!i.opt(D,(function(e){return e.contrasts(w)}))){var x=d.MathUtils.absDouble(this.MIN_LIGHTNESS_DIFF-i.opt(D,(function(e){return e.lightnessDifference(w)})));_=d.MathUtils.maxDouble(_,x)}}}i.opt(b.weightedScore,(function(e){return e.setFeature(s.FormaPlacementScore.Features.CONTRAST,i.toDouble(_))})),b.weightedScore.reject()||(F=this.initializeLogoPlacementScore(C)),b.score-A>1e-8&&(A=b.score,S=b,F=this.initializeLogoPlacementScore(C))}return[i.as(S,a.IDesignSuggestion)]},getSearchLocations:function(e,t,o,n,r){void 0===r&&(r=null),null!=r&&i.opt(h.Host.logging,(function(e){return e.warning("LogoPlacementSuggestor.getSearchLocations ignores requested aspect ratio")}));var a,l=[];if(a=e.finalFrame){var s=a.height,u=a.width,c=t.evalXY(this.END_BORDER,this.END_BORDER),d=new f.TheoRect(c.x-u,c.y-s,c.x,c.y),g=t.evalXY(this.END_BORDER,this.START_BORDER),p=new f.TheoRect(g.x-u,g.y,g.x,g.y+s);l.push(d),l.push(p);for(var m=i.iter(this.getContentAlignedLocations(t));!m.done;m.next()){var y=m.value;t.contains(y)&&l.push(y)}var v=t.evalXY(this.MID_CANONICAL,this.START_BORDER),S=new f.TheoRect(v.x-u/2,v.y,v.x+u/2,v.y+s),C=t.evalXY(this.START_BORDER,this.START_BORDER),T=new f.TheoRect(C.x,C.y,C.x+u,C.y+s),A=t.evalXY(this.START_BORDER,this.END_BORDER),F=new f.TheoRect(A.x,A.y-s,A.x+u,A.y),k=t.evalXY(this.MID_CANONICAL,this.END_BORDER),L=new f.TheoRect(k.x-u/2,k.y-s,k.x+u/2,k.y),b=this.getSymmetricContentLocations();b&&(l.push(L),l.push(F)),l.push(S),l.push(T),b||(l.push(F),l.push(L))}return l},initializeLogoPlacementScore:function(e){var t=new s.FormaPlacementScore(e);return t.setWeight(s.FormaPlacementScore.Features.XSYMM,0),t.setWeight(s.FormaPlacementScore.Features.YSYMM,0),t.setWeight(s.FormaPlacementScore.Features.EDGE,0),t.setWeight(s.FormaPlacementScore.Features.DISTANCE_TO_CENTER,0),t.setWeight(s.FormaPlacementScore.Features.ALIGNMENT,0),t.setWeight(s.FormaPlacementScore.Features.CONTRAST,i.toDouble(this.CONTRAST_WEIGHT)),t.setWeight(s.FormaPlacementScore.Features.TEXT_OVERLAP,-1e4),t.setWeight(s.FormaPlacementScore.Features.FLOATING_ELEMENT_OVERLAP,-5e3),t},getContentAlignedLocations:function(e){var t,o,n,r;if((t=i.as(this.forma,l.FrameForma))&&(o=t.root)&&(n=o.finalFrame)&&(r=this.forma.finalFrame)){var a=r.height,s=r.width,u=i.clone(o.filterWithCallback((function(e){return null!=e.controller&&e.controller.floating})));if(u.length>0){var c=i.sort(u,(function(e,t){return e.finalFrame.maxY-n.minY<t.finalFrame.maxY-n.minY})),h=i.clone(c[c.length-1].finalFrame.points),d=i.clone(c[0].finalFrame.points),g=i.opt(o.finalFrame,(function(e){return e.locate(h[1].x,h[1].y)})),p=e.evalXY(i.opt(g,(function(e){return e.x})),i.opt(g,(function(e){return e.y}))+this.START_BORDER+.03),m=new f.TheoRect(p.x,p.y,p.x+s,p.y+a),y=i.opt(o.finalFrame,(function(e){return e.locate(h[3].x,h[3].y)})),v=e.evalXY(i.opt(y,(function(e){return e.x})),i.opt(y,(function(e){return e.y}))+this.START_BORDER+.03),S=new f.TheoRect(v.x-s,v.y,v.x,v.y+a),C=i.opt(o.finalFrame,(function(e){return e.locate(d[0].x,d[0].y)})),T=e.evalXY(i.opt(C,(function(e){return e.x})),i.opt(C,(function(e){return e.y}))-this.START_BORDER-.03);return[m,S,new f.TheoRect(T.x-s/2,T.y-a,T.x+s/2,T.y)]}}return[]},getSymmetricContentLocations:function(){var e,t,o,n=this;if((e=i.as(this.forma,l.FrameForma))&&(t=e.root)&&(o=t.finalFrame)){var r=i.clone(t.filterWithCallback((function(e){return null!=e.controller&&e.controller.floating})));return!(r.filter((function(e){return d.MathUtils.absDouble(o.center.distanceTo(e.finalFrame.center))<n.SYMMETRIC_THRESHOLD}),this).length<=i.toInt(r.length/2))}return!1}}}),n)},i0RJ:function(e,t,o){o("oAGj")},i5Hy:function(e,t,o){var n,r,i,a,l,s,u,c,h,d,g=t,p=o("oAGj"),f=o("gXiO"),m=o("yGNn"),y=o("SmK9"),v=o("iCxV"),S=o("8vXU"),C=o("C4JV"),T=o("rxGp"),A=o("fNpk"),F=o("6azk"),k=o("90dd"),L=o("ZoS2"),b=o("rrhp");g.SaveResult=(n=function(){f.CoreObject.call(this)},r={},p.defineClass({name:"SaveResult",ctor:n,superName:"CoreObject",statics:{NONE:{get:function(){return void 0===r.NONE&&(r.NONE=new n),r.NONE}},COMPLETE:{get:function(){return void 0===r.COMPLETE&&(r.COMPLETE=new g.SaveComplete),r.COMPLETE}},CANCELED:{get:function(){return void 0===r.CANCELED&&(r.CANCELED=new g.SaveCanceled),r.CANCELED}},fromPromiseAny:function(e){var t;return null==e?(A.LegacyCoreAssert.fail("Save promise should resolve with a SaveResult, not nil",void 0,"SaveResult.fromPromiseAny","SaveManager.swift",23),n.NONE):(t=p.as(e,n))?t:(A.LegacyCoreAssert.fail("Save promise should resolve with a SaveResult",{actualResult:e},"SaveResult.fromPromiseAny","SaveManager.swift",28),n.NONE)}}}),n),g.SaveComplete=(i=function(){g.SaveResult.call(this)},p.defineClass({name:"SaveComplete",ctor:i,superName:"SaveResult",props:{toString:function(){return"SaveComplete"}}}),i),g.SaveCanceled=(a=function(){g.SaveResult.call(this)},p.defineClass({name:"SaveCanceled",ctor:a,superName:"SaveResult",props:{toString:function(){return"SaveCanceled"}}}),a),g.SaveErrorMissingState=(l=function(){g.SaveResult.call(this)},p.defineClass({name:"SaveErrorMissingState",ctor:l,superName:"SaveResult",props:{toString:function(){return"SaveErrorMissingState"}}}),l),g.SaveErrorSaveFailed=(s=function(e){this.errorObject=e},p.defineClass({name:"SaveErrorSaveFailed",ctor:s,superName:"SaveResult",props:{toString:function(){return"SaveErrorSaveFailed: "+this.errorObject}}}),s),g.SaveErrorValidationFailed=(u=function(e){this.error=e},p.defineClass({name:"SaveErrorValidationFailed",ctor:u,superName:"SaveResult",props:{toString:function(){return"SaveErrorValidationFailed: "+this.error.error}}}),u),g.SaveErrorExceptionDuringSave=(c=function(e){this.exception=e},p.defineClass({name:"SaveErrorExceptionDuringSave",ctor:c,superName:"SaveResult",props:{toString:function(){return"SaveErrorExceptionDuringSave: "+this.exception}}}),c),g.SaveMessage=(h=function e(t,o,n,r){void 0===r&&(r=null),this.message=o,this.stateID=n,this.reason=r,k.TheoMessage.call(this,e.TYPE,t)},p.defineClass({name:"SaveMessage",ctor:h,superName:"TheoMessage",statics:{TYPE:"SaveMessage",SAVE_SCHEDULED:"save-scheduled",SAVE_COMPLETED:"save-completed",SAVE_SUCCESSFUL:"save-successful",SAVE_CANCELED:"save-canceled",SAVE_FAILED:"save-failed"}}),h),g.SaveManager=(d=function(){this.saveQueue_="com.adobe.theo.core.save",this.saveTimer_=null,this.saveDelaySeconds_=8,this.saveImmediateDelay_=0,this.savePromise_=null,this.suspendCount_=0,this.undoSubscription=null,this.saveLock_=v.Host.async.newLock(),L.TheoPublishingObject.call(this)},p.defineClass({name:"SaveManager",ctor:d,superName:"TheoPublishingObject",statics:{_implements:function(e){return"TheoMessagePublisher"==e}},props:{subscribeWithCallback:function(e,t){var o=L.TheoPublishingObject.prototype.subscribeWithCallback.call(this,e,t);return null!=this.savePromise_&&e(new g.SaveMessage(this,g.SaveMessage.SAVE_SCHEDULED,this.pendingSaveState_)),o},subscribe:function(e,t){var o=L.TheoPublishingObject.prototype.subscribe.call(this,e,t);return null!=this.savePromise_&&e.onMessage(new g.SaveMessage(this,g.SaveMessage.SAVE_SCHEDULED,this.pendingSaveState_)),o},enable:function(e){var t,o=this;v.Host.logging.logForCategory(T.LogCategories.kSaveMgr,"enable SaveManager for "+p.toString(p.opt(p.opt(this.owner,(function(e){return e.document})),(function(e){return e.uuid})))+" at "+p.toString(e),S.LogLevelEnum.INFO_LEVEL),this.lastSaveState_=e,(t=p.opt(this.owner,(function(e){return e.undoRedoMgr})))&&null==this.undoSubscription&&(this.undoSubscription=t.subscribeWithCallback((function(e){var t;(t=p.as(e,b.UndoRedoMessage))&&t.changeType==b.UndoRedoMessage.UNDO_REDO_STATE_CLEAN&&o.requestSave().fail((function(e){return A.LegacyCoreAssert.fail("Save failed",{status:p.toString(e)},"SaveManager.enable","SaveManager.swift",197)}))}),b.UndoRedoMessage.TYPE))},disable:function(){v.Host.logging.logForCategory(T.LogCategories.kSaveMgr,"disable SaveManager for "+p.toString(p.opt(p.opt(this.owner,(function(e){return e.document})),(function(e){return e.uuid}))),S.LogLevelEnum.INFO_LEVEL),p.opt(this.undoSubscription,(function(e){return e.unsubscribe()})),this.undoSubscription=null,this.cancelPendingSave()},markInitialState:function(){var e,t;(e=p.opt(this.owner,(function(e){return e.document})))&&null!=(t=p.opt(e.database.immutableState,(function(e){return e.guid})))&&(this.lastSaveState_=t)},suspend:function(){var e=this;this.ensureDeferredPromise(),this.saveLock_.runInLock((function(){0==e.suspendCount_&&(p.opt(e.saveTimer_,(function(e){return e.cancel()})),e.saveTimer_=null),e.suspendCount_+=1}))},resume:function(){var e=this;this.saveLock_.runInLock((function(){var t;e.suspendCount_>0&&(e.suspendCount_-=1),0==e.suspendCount_&&((t=p.opt(e.owner,(function(e){return e.undoRedoMgr})))&&t.currentlyExecutingAction()||e.requestSave())}))},cancelPendingSave:function(){var e;(e=this.saveTimer_)&&(e.cancel(),v.Host.logging.logForCategory(T.LogCategories.kSaveMgr,"cancelPendingSave for "+p.toString(p.opt(p.opt(this.owner,(function(e){return e.document})),(function(e){return e.uuid})))+" at "+p.toString(this.pendingSaveState_),S.LogLevelEnum.INFO_LEVEL)),this.saveTimer_=null,p.opt(this.savePromise_,(function(e){return e.resolve(g.SaveResult.CANCELED)})),this.savePromise_=null},flushPendingSave:function(){var e;0==this.suspendCount_&&(e=this.savePromise_)&&(this.savePromise_=null,this.validateAndSave(e))},branchForState:function(e){return e==this.lastSaveState_?this.lastSavedBranch_:null},requestSave:function(e,t){void 0===e&&(e=!1),void 0===t&&(t=!1);var o,n,r=this;if((o=p.opt(this.owner,(function(e){return e.document})))&&null!=(n=p.opt(o.database.immutableState,(function(e){return e.guid})))){v.Host.logging.logForCategory(T.LogCategories.kSaveMgr,"requestSave for "+o.uuid+" at "+n,S.LogLevelEnum.INFO_LEVEL);var i,a=!1,l=this.ensureDeferredPromise();if(o.documentInited&&((i=this.saveTimer_)&&(i.cancel(),this.saveTimer_=null),this.saveLock_.runInLock((function(){t?(r.pendingSaveState_=n,a=0==r.suspendCount_):r.runningSaveState_==n?r.pendingSaveState_=null:null==r.runningSaveState_&&r.lastSaveState_==n?(r.pendingSaveState_=null,0==r.suspendCount_&&r.savePromise_.resolve(g.SaveResult.COMPLETE)):(r.pendingSaveState_=n,a=0==r.suspendCount_)}))),a){v.Host.logging.logForCategory(T.LogCategories.kSaveMgr,"doScheduleSave for "+o.uuid+" at "+this.pendingSaveState_,S.LogLevelEnum.INFO_LEVEL);var s=e?this.saveImmediateDelay_:this.saveDelaySeconds_;this.saveTimer_=v.Host.async.startTimer(s,(function(){return r.flushPendingSave()}))}return l}return m.CorePromise.reject(new g.SaveErrorMissingState)},pendingSave:{get:function(){return p.opt(this.savePromise_,(function(e){return e.promise}))}},runningSaveStateID:{get:function(){return this.runningSaveState_}},ensureDeferredPromise:function(){var e=this,t=null;return this.saveLock_.runInLock((function(){(null==e.savePromise_||e.savePromise_.promise.finalized)&&(e.savePromise_=m.CorePromise.deferred(),e.publish(new g.SaveMessage(e,g.SaveMessage.SAVE_SCHEDULED,e.pendingSaveState_)),e.savePromise_.promise.finished((function(t,o){g.SaveResult.fromPromiseAny(t)==g.SaveResult.CANCELED?e.publish(new g.SaveMessage(e,g.SaveMessage.SAVE_COMPLETED,e.lastSaveState_,g.SaveMessage.SAVE_CANCELED)):e.publish(new g.SaveMessage(e,g.SaveMessage.SAVE_COMPLETED,e.lastSaveState_,o?g.SaveMessage.SAVE_SUCCESSFUL:g.SaveMessage.SAVE_FAILED))}))),t=e.savePromise_.promise})),t},validateAndSave:function(e){var t=this;this.saveTimer_=null,A.LegacyCoreAssert.isTrue(null!=this.owner,"Save manager has no owner. Document closed without calling willCloseDocument?",void 0,"SaveManager.validateAndSave","SaveManager.swift",369),null!=this.pendingSaveState_?(v.Host.logging.logForCategory(T.LogCategories.kSaveMgr,"validateAndSave for "+p.toString(p.opt(p.opt(this.owner,(function(e){return e.document})),(function(e){return e.uuid})))+" at "+this.pendingSaveState_,S.LogLevelEnum.INFO_LEVEL),v.Host.async.postOnWorkerThread(this.saveQueue_,(function(){var o=!1;if(t.saveLock_.runInLock((function(){o=null!=t.runningSaveState_})),o)t.savePromise_=e,t.requestSave(!0);else{t.saveLock_.runInLock((function(){A.LegacyCoreAssert.isTrue(null==t.runningSaveState_,"Save shouldn't be running. Worker queue shouldn't be concurrent.",void 0,"SaveManager.validateAndSave","SaveManager.swift",385),t.runningSaveState_=t.pendingSaveState_,t.pendingSaveState_=null}));var n,r=t.validate();(n=p.as(r,y.DBValidationError))?t.saveLock_.runInLock((function(){t.runningSaveState_=null,e.reject(new g.SaveErrorValidationFailed(n))})):v.Host.exception.executeWithExceptionHandler((function(){return t.save().finished((function(o,n){n?t.saveLock_.runInLock((function(){t.runningSaveState_=null,e.resolve(g.SaveResult.COMPLETE),null!=t.savePromise_&&t.savePromise_!==e&&null==t.pendingSaveState_&&(t.savePromise_.resolve(g.SaveResult.COMPLETE),t.savePromise_=null)})):t.saveLock_.runInLock((function(){t.runningSaveState_=null,e.reject(new g.SaveErrorSaveFailed(o))}))}))}),(function(o){p.opt(t.saveLock_,(function(e){return e.runInLock((function(){t.runningSaveState_=null}))})),e.reject(new g.SaveErrorExceptionDuringSave(o))}))}}))):e.resolve(g.SaveResult.COMPLETE)},validate:function(){var e,t,o;return(e=p.opt(this.owner,(function(e){return e.document})))&&null!=(t=this.runningSaveState_)&&(o=e.database.getState(t))?o.validate():new y.DBValidationError},save:function(){var e,t,o=this;if((e=p.opt(this.owner,(function(e){return e.document})))&&null!=(t=this.runningSaveState_)){var n=new F.MiniDocumentBranch(e.uuid),r=new C.JSONDocumentEncoder(n);return e.encodeStateByID(t,r),r.finish(),this.saveLock_.runInLock((function(){o.lastSavedBranch_=n,o.lastSaveState_=o.runningSaveState_})),v.Host.logging.logForCategory(T.LogCategories.kSaveMgr,"requestSaveDocumentAt for "+e.uuid+" at "+t,S.LogLevelEnum.INFO_LEVEL),e.requestSaveDocumentAt(t)}return m.CorePromise.reject(g.SaveResult.CANCELED)}}}),d)},iSwi:function(e,t,o){var n,r=t,i=o("oAGj"),a=o("cZuM"),l=o("Z25M"),s=o("CaSj"),u=o("FNB+"),c=o("cmoc"),h=o("G1DZ"),d=o("9Lk3"),g=o("ZK0l"),p=o("/afT"),f=o("X0GW"),m=o("iCxV"),y=o("fdtz"),v=o("lmwz"),S=o("c+uM"),C=o("JFv5"),T=o("uxH+"),A=o("LqGn"),F=o("djAF"),k=o("T6jX"),L=o("8t9B"),b=o("sIWg"),_=o("qSCS");r.RetargetSuggester=(n=function e(t,o,n,r){var a=n.firstPage;this.origModelSize_=a.pageSize,this.model_=a.root,this.modelDoc_=n,this.originalRoot_=o,this.filterFormae_=i.clone(r),e.conformPageForApplicationToRoot(a,t),s.DesignSuggester.call(this,t,t)},i.defineClass({name:"RetargetSuggester",ctor:n,superName:"DesignSuggester",statics:{KIND:{get:function(){return"RetargetSuggester"}},FORMA_TYPE_TAG:"forma:type",FORMA_TYPE_DECORATION:"type:decoration",FORMA_TYPE_CONTENT_IMAGE:"type:content-image",conformPageForApplicationToRoot:function(e,t){var o=e.document,r=o.beginTransaction("cleanupRoot"),a=e.root;o.controller.setAutomaticLayoutInteractionMode(),e.root.isModel=!0,e.root.bounds=b.TheoRect.fromSize(e.pageSize),e.animationController.hasAnimation&&m.Host.logging.info("model has animation"),a.controller.createGridControllerIfNone(),n.cleanupRoot(a),n.removeDesignVariationFormae(a),i.clone(a.filterWithCallback((function(e){return e.hasIntent(u.Forma.INTENT_ICON)||v.ImageFacade.isFloatingImage(e)}))).length>0&&i.opt(i.as(e.root.controller,T.RootController),(function(e){return e.preferredResizeType=C.ResizeLayoutType.Fit}));for(var s=i.iter(a.filterWithCallback((function(e){return e.hasIntent(u.Forma.INTENT_ICON)})));!s.done;s.next()){var c,h,d=s.value;(c=i.as(d,F.ShapeForma))&&(h=i.as(c.contentNode,_.URLBasedContentNode))&&h.setDoNotLoadURL()}e.setPageSize(t.page.pageSize),f.GroupFacade.removeAllGroups(e.root);for(var g=i.iter(a.filterWithCallback((function(e){return e.isBackgroundImage()})));!g.done;g.next()){var p,y=g.value;l.DesignFeatureUtils.isDecorativeTemplateBackground(y)&&(p=v.ImageFacade.getImageFormaForForma(y))&&(y.allowUserMove=!0,y.intent=u.Forma.INTENT_FLOATING_IMAGE,p.intent=u.Forma.INTENT_FLOATING_IMAGE)}r.end()},cleanupRoot:function(e){var t;(t=i.opt(i.as(e.controller,T.RootController),(function(e){return e.getGridController()})))&&t.cleanupUnusedBackgroundCellColors();for(var o=i.clone(e.filterWithCallback((function(e){return e.isTypeLockup()}))),r=i.iter(o);!r.done;r.next()){var a,l,s=r.value;if((a=i.as(s.controller,L.TypeLockupController))&&(l=a.lockupStyle)&&(a.updateGroup(),a.snapSizeToBounds(),1==a.numLines()&&!S.LockupStyle.isPath(l.layout))){l.spacing=S.LockupStyle.DEFAULT_SPACING;for(var c=i.iter(o);!c.done;c.next()){var h=c.value;if(!i.eq(u._equality_Forma_Forma,s,h)){var d=i.as(h.controller,L.TypeLockupController);d.updateGroup();var g=d.numLines(),p=i.opt(d.lockupStyle,(function(e){return e.alignment})),f=1==g||g>1&&(p==S.LockupAlignment.Center||p==S.LockupAlignment.UNSET),m=1==g||g>1&&p==S.LockupAlignment.Left,y=1==g||g>1&&p==S.LockupAlignment.Right;a.beginBlockedUpdate(),n.frameAligned(s,h,.5,null)&&f?(l.alignment=S.LockupAlignment.Center,l.layout=S.LockupLayout.Standard):n.frameAligned(s,h,0,null)&&m?(l.alignment=S.LockupAlignment.Left,l.layout=S.LockupLayout.Standard):n.frameAligned(s,h,1,null)&&y?(l.alignment=S.LockupAlignment.Right,l.layout=S.LockupLayout.Standard):(l.alignment=S.LockupAlignment.Center,l.layout=S.LockupLayout.Standard),a.endBlockedUpdate(),a.styleChanged()}}}}},removeDesignVariationFormae:function(e){for(var t,o=i.clone(e.filterWithCallback((function(e){return!(!(t=i.opt(e.controller,(function(e){return e.floating})))&&null==t)&&t}))),n=i.iter(o);!n.done;n.next()){var r,a=n.value;null!=(r=a.source)&&h.FormaSourceUtils.isDesignVariation(r)&&a.removeFromParent()}},frameAligned:function(e,t,o,n){var r=e.frame,l=t.frame;if(null==r||null==l||null==o&&null==n)return!1;var s,u=1;(s=i.opt(e.page.view,(function(e){return e.getViewportTransform()})))&&(u=Math.sqrt(Math.abs(s.determinant)));var c=a.AlignmentDetector.DISTANCE_THRESHOLD/u,h=!0;return null!=o&&(h=h&&Math.abs(r.evalXY(o,.5).x-l.evalXY(o,.5).x)<c),null!=n&&(h=h&&Math.abs(r.evalXY(.5,n).y-l.evalXY(.5,n).y)<c),h},getMoveable:function(e){var t,o,n;return(!(t=i.opt(e.controller,(function(e){return e.userGroupChild})))&&null==t||!t)&&!l.DesignFeatureUtils.isRetargetableImage(e)&&(!(!(o=i.opt(e.controller,(function(e){return e.userGroup})))&&null==o||!o)||!(!e.isTypeLockup()&&!e.hasIntent(u.Forma.INTENT_ICON))||!!(n=i.as(e,c.FrameForma))&&n.controller.moveable)},isGraphicDecoration:function(e,t){return void 0===t&&(t=!1),e.hasIntent(u.Forma.INTENT_ICON)||v.ImageFacade.isFloatingImage(e)&&!l.DesignFeatureUtils.isRetargetableFloatingImage(e,t)&&v.ImageFacade.getImageFormaForForma(e).contentUrl!=_.URLBasedContentNode.DO_NOT_LOAD_DATA_URL},isRemixedDecoration:function(e){var t;if(((t=i.opt(e.controller,(function(e){return e.userGroup})))||null!=t)&&t){var o=e;return i.clone(o.filterWithCallback(n.isRemixedDecoration,u.FormaTraversal.JustChildren)).length==o.childCount}return n.isRemixedShapeOrImageDecoration(e)},isRemixedShapeOrImageDecoration:function(e){var t,o,n;return!(!e.hasIntent(u.Forma.INTENT_ICON)&&!v.ImageFacade.isFloatingImage(e))&&(!(v.ImageFacade.isFloatingImage(e)&&((t=i.opt(e.controller,(function(e){return e.userGroupMember})))||null!=t)&&t||l.DesignFeatureUtils.isRetargetableImage(e))&&(!(((o=i.opt(i.opt(e.parent,(function(e){return e.controller})),(function(e){return e.userGroup})))||null!=o)&&o&&e.parent.childrenAsArray.filter((function(t){return!i.eq(u._equality_Forma_Forma,t,e)}),this).filter((function(e){return e.isText()}),this).length>0)&&(null!=(n=e.getTag(u.Forma.TAG_CREATED_FROM_REMIX))&&"true"==n)))},shouldAttemptLayoutSuggestion:function(e){var t,o,r=e.page.getAllSelectableTopLevel().filter((function(e){return(!(t=i.opt(e.source,(function(e){return e.includes(h.FormaSourceNamespace.DesignVariation)})))&&null==t||!t)&&e.kind!=y.ImageForma.KIND&&!!(o=e.controller)&&o.floating&&!o.userGroupChild;var o}),this),a=i.clone(e.filterWithCallback((function(e){return e.isTypeLockup()}))),s=i.clone(e.filterWithCallback(l.DesignFeatureUtils.isRetargetableImageFromUserDesign)),u=i.clone(e.filterWithCallback(n.isRemixedShapeOrImageDecoration)),c=i.clone(e.filterWithCallback((function(e){return(!(o=i.opt(e.source,(function(e){return e.includes(h.FormaSourceNamespace.DesignVariation)})))&&null==o||!o)&&n.isGraphicDecoration(e)}))),d=i.toInt(.5*i.toDouble(k.TheoDocumentUtils.DESIGN_COMPLEXITY_HEURISTIC_THRESHOLD));return!(0==s.length||r.length>d||a.length>d||u.length>d||c.length>d)}},props:{model:{get:function(){return this.model_}},matchDesignGroupsToModel:function(e,t){if(0==e.length||0==t.length)return[[{a:[],b:[]}]];var o=[],n=i.clone(e);t.length<n.length&&(n=i.clone(p.GroupDetector.mergeFormaGroups(n,t.length)));for(var r=i.sort(t,(function(e,t){var o,n;return!(!(o=k.TheoDocumentUtils.unionFinalFrame(e))||!(n=k.TheoDocumentUtils.unionFinalFrame(t)))&&o.area>n.area})),a=t.length-n.length,l=a>0?a+1:1,s=i.iter(i.range(0,l,!1));!s.done;s.next()){var u=s.value,c=i.clone(r);function h(e,t){var o=k.TheoDocumentUtils.unionFinalFrame(e),n=k.TheoDocumentUtils.unionFinalFrame(t),r=(o.center.y-n.center.y)/e[0].root.frame.height;return(n.area-o.area)/Math.max(n.area,o.area)+r<0}c.length>n.length&&(c=c.splice(u,n.length));for(var d,g,f=i.sort(n,h),m=[],y=i.sort(c,h).concat(),v=[],S=i.iter(i.range(0,y.length,!1));!S.done;S.next())v.push([]);for(var C=i.iter(i.range(0,f.length,!1));!C.done;C.next()){var T=C.value,A=i.clone(f[T]),F=T%y.length;i.append(v[F],A)}for(var L=i.iter(i.range(0,y.length,!1));!L.done;L.next()){var b=L.value;v[b].length>0&&m.push({a:v[b],b:y[b]})}u>0&&m.length>0&&(d=k.TheoDocumentUtils.unionFinalFrame(m[0].a))&&(g=k.TheoDocumentUtils.unionFinalFrame(m[0].b))&&d.area>5*g.area||o.push(m)}return o},createFormaMatches:function(e,t){var o,r=this,a=t.page.document.beginTransaction("tagForma"),s=i.clone(t.filterWithCallback((function(e){return n.isGraphicDecoration(e,!0)})));s=s.filter((function(e){return!r.filterFormae_.includes(e.formaID)}),this);for(var c=i.iter(s);!c.done;c.next())c.value.setTag(n.FORMA_TYPE_TAG,n.FORMA_TYPE_DECORATION);var h=i.clone(e.filterWithCallback(n.isRemixedDecoration)),d=[{a:[],b:[]}];(m.Host.platform.isWeb||this.filterFormae_.length>0)&&(d=[{a:[],b:s}]),d.push({a:h,b:[]});var g=i.clone(e.filterWithCallback(n.getMoveable)),f=i.clone(t.filterWithCallback(n.getMoveable));f=f.filter((function(e){return!i.containsEq(s,e,u._equality_Forma_Forma)&&!r.filterFormae_.includes(e.formaID)&&((o=i.opt(i.as(e.controller,L.TypeLockupController),(function(e){return e.text.length})))||null!=o?o:2)>1}),this),g=g.filter((function(e){return!i.containsEq(h,e,u._equality_Forma_Forma)}),this);for(var y=i.clone(e.filterWithCallback(l.DesignFeatureUtils.isRetargetableImageFromUserDesign)),v=i.clone(t.filterWithCallback(l.DesignFeatureUtils.isRetargetableImageFromTemplate)),S=[],C=i.iter(i.range(0,v.length,!1));!C.done;C.next()){var T=C.value;v[T].setTag(n.FORMA_TYPE_TAG,n.FORMA_TYPE_CONTENT_IMAGE),T<y.length?S.push({a:[y[T]],b:[v[T]]}):S.push({a:[],b:[v[T]]})}a.end();var A=[],F=i.clone(this.getBasicMatch(e,t));F.push({a:g,b:f}),A.push(F);for(var k=i.clone(p.GroupDetector.detectProximityGroups(g,null,!1)),b=i.clone(p.GroupDetector.detectProximityGroups(f,e.bounds.height/this.origModelSize_.height*200,!1)),_=i.iter(this.matchDesignGroupsToModel(k,b));!_.done;_.next()){var R=_.value,I=[];i.append(I,R),i.append(I,S),i.append(I,d),i.append(I,this.getBasicMatch(e,t)),A.push(I)}return A},getBasicMatch:function(e,t){var o=[];o.push({a:[i.as(e,u.Forma)],b:[i.as(t,u.Forma)]});var n=i.clone(e.filterWithCallback((function(e){return i.opt(e.controller,(function(e){return e.kind==d.GridController.KIND}))}),u.FormaTraversal.JustChildren)),r=i.clone(t.filterWithCallback((function(e){return i.opt(e.controller,(function(e){return e.kind==d.GridController.KIND}))}),u.FormaTraversal.JustChildren));return o.push({a:[n[0]],b:[r[0]]}),o},createSuggestions:function(){for(var e=i.clone(this.createFormaMatches(this.originalRoot_,this.model)),t=this.model.filterWithCallback((function(e){return e.isTypeLockup()})).concat(this.originalRoot_.filterWithCallback((function(e){return e.isTypeLockup()}))),o=i.iter(t);!o.done;o.next()){var n=o.value;i.opt(i.as(n.controller,g.GroupController),(function(e){return e.beginBlockedUpdate()}))}for(var r=[],a=i.iter(i.range(0,e.length,!1));!a.done;a.next()){var l=a.value;r.push(new A.RetargetSuggestion(this.forma,this.originalRoot_,this.model,this.modelDoc_,e[l],l>0))}for(var s=i.iter(t);!s.done;s.next())n=s.value,i.opt(i.as(n.controller,g.GroupController),(function(e){return e.endBlockedUpdate()}));return r}}}),n)},j89o:function(e,t,o){var n,r,i,a,l,s=t,u=o("oAGj"),c=o("Tq01"),h=o("yGNn"),d=o("T8w7"),g=o("Kkml");s.SetOpacityAction=(n=function e(t,o){void 0===o&&(o=null),this.opacity=t,this.formae=u.clone(o),c.Action.call(this,e.TYPE)},u.defineClass({name:"SetOpacityAction",ctor:n,superName:"Action",statics:{TYPE:"SetOpacityAction"},props:{getUserAction:function(e){return g.UserActions.ChangeOpacity()},execute:function(e){return d.OpacityFacade.applyOpacity(this.opacity,this.formae||e.selection.asFormaArray()),h.CorePromise.resolve(null)}}}),n),s.SetTextOpacityAction=(r=function e(t,o){void 0===o&&(o=null),this.opacity=t,this.formae=u.clone(o),c.Action.call(this,e.TYPE)},u.defineClass({name:"SetTextOpacityAction",ctor:r,superName:"Action",statics:{TYPE:"SetTextOpacityAction"},props:{getUserAction:function(e){return g.UserActions.ChangeOpacity()},execute:function(e){return d.OpacityFacade.applyTextOpacity(this.opacity,this.formae||e.selection.asFormaArray()),h.CorePromise.resolve(null)}}}),r),s.SetShapeOpacityAction=(i=function e(t,o){void 0===o&&(o=null),this.opacity=t,this.formae=u.clone(o),c.Action.call(this,e.TYPE)},u.defineClass({name:"SetShapeOpacityAction",ctor:i,superName:"Action",statics:{TYPE:"SetShapeOpacityAction"},props:{getUserAction:function(e){return g.UserActions.ChangeOpacity()},execute:function(e){return d.OpacityFacade.applyShapeOpacity(this.opacity,this.formae||e.selection.asFormaArray()),h.CorePromise.resolve(null)}}}),i),s.SetBackgroundOpacityAction=(a=function e(t,o){this.opacity=t,this.page=o,c.Action.call(this,e.TYPE)},u.defineClass({name:"SetBackgroundOpacityAction",ctor:a,superName:"Action",statics:{TYPE:"SetBackgroundOpacityAction"},props:{getUserAction:function(e){return g.UserActions.SetBackgroundOpacity()},execute:function(e){return d.OpacityFacade.applyBackgroundOpacity(this.opacity,this.page),h.CorePromise.resolve(null)}}}),a),s.SetBlendModeAction=(l=function e(t,o){void 0===o&&(o=null),this.blendMode=t,this.formae=u.clone(o),c.Action.call(this,e.TYPE)},u.defineClass({name:"SetBlendModeAction",ctor:l,superName:"Action",statics:{TYPE:"SetBlendModeAction"},props:{getUserAction:function(e){return g.UserActions.ChangeBlendMode()},execute:function(e){return d.OpacityFacade.applyBlendMode(this.blendMode,this.formae||e.selection.asFormaArray()),h.CorePromise.resolve(null)}}}),l)},jcfx:function(e,t,o){var n,r,i,a=t,l=o("oAGj"),s=o("C42b"),u=o("HWAX"),c=o("FNB+"),h=o("9Lk3"),d=o("NkBu"),g=o("fNpk"),p=o("c+uM"),f=o("7Ta2"),m=o("JO5d"),y=o("8t9B");a.ProfilingCategories=l.defineEnum("ProfilingCategories",{Title:0,Subtitle:1,Body:2,Action:3,GraphicContent:4,Backing:5,Background:6,Separator:7,Decoration:8,NUM_CATEGORIES:9}),a.ColorProfiles=(n=function(){this.PrimaryProfileMedians={},this.BackgroundProfileMedians={},this.PrimaryProfileMedians[a.ProfilingCategories.Title]=[.12545,.09302,.94901],this.PrimaryProfileMedians[a.ProfilingCategories.Subtitle]=[.077319,.04819,.94901],this.PrimaryProfileMedians[a.ProfilingCategories.Body]=[.044715,.12156,.94901],this.PrimaryProfileMedians[a.ProfilingCategories.Action]=[.06959,.04819,.97647],this.BackgroundProfileMedians[a.ProfilingCategories.Title]=[.12581,.20392,.94901],this.BackgroundProfileMedians[a.ProfilingCategories.Subtitle]=[.079709,.44815,.94313],this.BackgroundProfileMedians[a.ProfilingCategories.Body]=[.07142,.20129,.96274],this.BackgroundProfileMedians[a.ProfilingCategories.Action]=[.5,.46886,.89803],this.PrimaryProfileMedians[a.ProfilingCategories.GraphicContent]=[.5,.6,1],this.PrimaryProfileMedians[a.ProfilingCategories.Backing]=[.5,.3,1],this.PrimaryProfileMedians[a.ProfilingCategories.Background]=[.5,.3,1],this.PrimaryProfileMedians[a.ProfilingCategories.Separator]=[.5,.3,1],this.PrimaryProfileMedians[a.ProfilingCategories.Decoration]=[.5,.6,1]},l.defineClass({name:"ColorProfiles",ctor:n}),n),a.ProfilingColorMap=(r=function e(){this.colorSet=[];for(var t=l.iter(this.profilingCatgoriesCases());!t.done;t.next()){var o=t.value;null==e.currentPrimaryIndices[o]&&(e.currentPrimaryIndices[o]=0),null==e.currentBackgroundIndices[o]&&(e.currentBackgroundIndices[o]=0)}},i={},l.defineClass({name:"ProfilingColorMap",ctor:r,statics:{PrimaryMap:{},BackgroundMap:{},currentPrimaryIndices:{},currentBackgroundIndices:{},paletteMappingDictionary:{},paletteMappingSelection:{},currentDocumentID:"",backingColorKey:"_Backing",lockupMSLPrimaryColorKey:"_MSLPrimary",lockupMSLBackingColorKey:"_MSLBacking",noKeyFound:"noKeyFound",textCategories:{get:function(){return void 0===i.textCategories&&(i.textCategories=[a.ProfilingCategories.Title,a.ProfilingCategories.Subtitle,a.ProfilingCategories.Body,a.ProfilingCategories.Action]),i.textCategories}},shapeCategories:{get:function(){return void 0===i.shapeCategories&&(i.shapeCategories=[a.ProfilingCategories.GraphicContent,a.ProfilingCategories.Backing,a.ProfilingCategories.Background,a.ProfilingCategories.Separator,a.ProfilingCategories.Decoration]),i.shapeCategories}}},props:{reset:function(){r.PrimaryMap={},r.BackgroundMap={},r.currentPrimaryIndices={},r.currentBackgroundIndices={},r.paletteMappingDictionary={},r.paletteMappingSelection={},r.currentDocumentID=""},updateRoleProfilingColorMap:function(e){var t;(t=e.document)&&(r.currentDocumentID=t.uuid),this.colorSet=e.colorLibraryController.getThemeColorKeys().concat(e.colorLibraryController.getProfilingColorKeys()),(new r).eraseCurrentPaletteMappingSelection(),r.PrimaryMap={},r.BackgroundMap={};for(var o=new a.ColorProfiles,n=l.iter(this.profilingCatgoriesCases());!n.done;n.next()){var i=n.value;if(null!=o.PrimaryProfileMedians[i]){var s=this.colorSet.length;r.PrimaryMap[i]=l.clone(this.selectRoleProfilingColors(e,i,!1,!0,s))}}for(var u=l.iter(this.profilingCatgoriesCases());!u.done;u.next())i=u.value,null!=o.BackgroundProfileMedians[i]&&(s=this.colorSet.length,r.BackgroundMap[i]=l.clone(this.selectRoleProfilingColors(e,i,!0,!0,s)))},updateIfCurrentDocumentHasChanged:function(e){var t;(t=e.document)&&r.currentDocumentID!=t.uuid&&this.updateRoleProfilingColorMap(e)},updateCurrentColorIndices:function(){for(var e=l.iter(this.profilingCatgoriesCases());!e.done;e.next()){var t=e.value;if(i=r.PrimaryMap[t]){var o=s.CoreRandom.nextIntUniform(i.length);r.currentPrimaryIndices[t]=o}}for(var n=l.iter(this.profilingCatgoriesCases());!n.done;n.next()){var i;if(t=n.value,(i=r.BackgroundMap[t])&&i.length>0){var a=null==r.currentBackgroundIndices[t]?-1:r.currentBackgroundIndices[t];r.currentBackgroundIndices[t]=(a+1)%i.length}}},checkIfMappingIsEmpty:function(){return null==r.PrimaryMap[a.ProfilingCategories.Title]},checkIfTwoFormaAreInSamePaletteMappingGroup:function(e,t){for(var o=!1,n=l.iter(l.keys(r.paletteMappingDictionary));!n.done;n.next()){var i=n.value;r.paletteMappingDictionary[i].includes(e)&&r.paletteMappingDictionary[i].includes(t)&&(o=!0)}return o},getMappingKeyForFormaID:function(e){for(var t=r.noKeyFound,o=l.iter(l.keys(r.paletteMappingDictionary));!o.done;o.next()){var n=o.value;r.paletteMappingDictionary[n].includes(e)&&(t=n)}return t},overridePaletteMappingDueToContrast:function(e,t){var o,n=this.getMappingKeyForFormaID(t),i=e;return n!=r.noKeyFound&&(null!=(o=r.paletteMappingSelection[n])?i=o:r.paletteMappingSelection[n]=e),i},overridePaletteMappingDueToContrastAndForceDifference:function(e,t,o,n){var i=this.getMappingKeyForFormaID(t),a=e;if(i!=r.noKeyFound)if(null!=(c=r.paletteMappingSelection[i]))a=c;else{if(this.checkIfColorAlreadyAssignedToPaletteMapping(a))for(var s=l.iter(l.range(0,o.length,!1));!s.done;s.next()){var c,h=s.value;if(null!=(c=u.ColorSelectorUtils.getContrastingChoice(!1,[o[h]],[n[h]]))&&!this.checkIfColorAlreadyAssignedToPaletteMapping(c)){a=c;break}}r.paletteMappingSelection[i]=a}return a},checkIfColorAlreadyAssignedToPaletteMapping:function(e){for(var t=!1,o=l.iter(l.keys(r.paletteMappingSelection));!o.done;o.next()){var n=o.value;r.paletteMappingSelection[n]==e&&(t=!0)}return t},eraseCurrentPaletteMappingSelection:function(){r.paletteMappingSelection={}},eraseCurrentPaletteMappingDictionary:function(){r.paletteMappingDictionary={}},setPaletteMappingForFormaWithSameRGBColor:function(e){var t,o=this;if(this.eraseCurrentPaletteMappingDictionary(),t=e.root.controller){var n=l.clone(t.getCurrentColors(e.root.style));n.length>0&&this.updateMappingDictionary(n[0].rgbString,e.root.formaID)}e.root.visitAll(c.FormaTraversal.PreOrder,(function(e){var t,n,i,a,s,u,c=e.formaID;if((a=l.as(e.controller,y.TypeLockupController))&&((s=e.style.colors.fieldPrimary)&&o.updateMappingDictionary(s.rgbString,c),(u=e.style.colors.fieldSecondary)&&null!=(t=l.opt(l.as(e.style,p.LockupStyle),(function(e){return e.backing})))&&t!=p.LockupBacking.None&&o.updateMappingDictionary(u.rgbString,c+r.backingColorKey),(n=a.getCurrentMSLPrimaryColor())&&o.updateMappingDictionary(n.rgbString,c+r.lockupMSLPrimaryColorKey),(i=a.getCurrentMSLBackingColor())&&o.updateMappingDictionary(i.rgbString,c+r.lockupMSLBackingColorKey)),l.as(e.controller,m.ShapeController)&&(s=e.style.colors.fieldPrimary)&&o.updateMappingDictionary(s.rgbString,c),a=l.as(e.controller,h.GridController))for(var g=l.clone(a.getCellIdsGroupedByColor()),f=l.iter(l.keys(g));!f.done;f.next())for(var v=f.value,S=l.iter(g[v]);!S.done;S.next())c=S.value,o.updateMappingDictionary(v,c);l.as(e.controller,d.ImageController)&&null!=e.style.filter&&((s=e.style.colors.fieldPrimary)&&o.updateMappingDictionary(s.rgbString,c),(u=e.style.colors.fieldSecondary)&&o.updateMappingDictionary(u.rgbString,c+r.backingColorKey))}))},getNumPaletteMappingGroups:function(){return l.keys(r.paletteMappingDictionary).length},getCurrentPaletteMapping:function(){return l.clone(r.paletteMappingDictionary)},updateMappingDictionary:function(e,t){for(var o=!1,n=l.iter(l.keys(r.paletteMappingDictionary));!n.done;n.next()){var i=n.value;u.ColorSelectorUtils.compareTwoColorStringsWithMargin(i,e)&&(r.paletteMappingDictionary[i].includes(t)||r.paletteMappingDictionary[i].push(t),o=!0)}o||(r.paletteMappingDictionary[e]=[t])},getPrimaryColorsForRoleGlobal:function(e,t,o){var n,i,a=[];if(this.updateIfCurrentDocumentHasChanged(o),(n=r.PrimaryMap[e])&&null!=(i=r.currentPrimaryIndices[e]))if(i<n.length){for(var s=l.iter(l.range(i,n.length,!1));!s.done;s.next()){var u=s.value;a.push(n[u])}for(var c=l.iter(l.range(0,i,!1));!c.done;c.next())u=c.value,a.push(n[u])}else a=l.clone(n);return a},getBackgroundColorsForRoleGlobal:function(e,t,o){var n,i,a=[];if(this.updateIfCurrentDocumentHasChanged(o),(n=r.BackgroundMap[e])&&null!=(i=r.currentBackgroundIndices[e]))if(i<n.length){for(var s=l.iter(l.range(i,n.length,!1));!s.done;s.next()){var u=s.value;a.push(n[u])}for(var c=l.iter(l.range(0,i,!1));!c.done;c.next())u=c.value,a.push(n[u])}else a=l.clone(n);return a},getPrimaryColorsForRoleIndividual:function(e,t,o){return this.colorSet=e.colorLibraryController.getThemeColorKeys().concat(e.colorLibraryController.getProfilingColorKeys()),this.selectRoleProfilingColors(e,t,!1,!1,o)},getBackgroundColorsForRoleIndividual:function(e,t,o){return this.colorSet=e.colorLibraryController.getThemeColorKeys().concat(e.colorLibraryController.getProfilingColorKeys()),this.selectRoleProfilingColors(e,t,!0,!1,o)},getProfilingCategoryForInferredRole:function(e){var t=a.ProfilingCategories.Body;return e.role==f.InferredRoleType.Title||e.role==f.InferredRoleType.Quote?t=a.ProfilingCategories.Title:e.role==f.InferredRoleType.SubTitle?t=a.ProfilingCategories.Subtitle:e.role==f.InferredRoleType.Social||e.role==f.InferredRoleType.Action?t=a.ProfilingCategories.Action:e.role==f.InferredRoleType.Body||e.role==f.InferredRoleType.Contact?t=a.ProfilingCategories.Body:e.role==f.InferredRoleType.GraphicContent||e.role==f.InferredRoleType.Logo?t=a.ProfilingCategories.GraphicContent:e.role==f.InferredRoleType.Seperator?t=a.ProfilingCategories.Separator:e.role==f.InferredRoleType.Backing?t=a.ProfilingCategories.Backing:e.role==f.InferredRoleType.Background?t=a.ProfilingCategories.Background:e.role==f.InferredRoleType.Decoration?t=a.ProfilingCategories.Decoration:g.LegacyCoreAssert.fail("role not supported",void 0,"ProfilingColorMap.getProfilingCategoryForInferredRole","ProfilingColorMap.swift",471),t},countColorUsage:function(e,t){for(var o=0,n=[r.PrimaryMap,r.BackgroundMap],i=l.clone(this.profilingCatgoriesCases()),a=l.iter(n);!a.done;a.next())for(var s=a.value,u=l.iter(i);!u.done;u.next()){var c,h=u.value;if(this.anyCategoryOverlap(t,h)&&(c=s[h]))for(var d=l.iter(c);!d.done;d.next())d.value==e&&(o+=1)}return o},anyCategoryOverlap:function(e,t){return!(!r.textCategories.includes(e)||!r.textCategories.includes(t))||!(!r.shapeCategories.includes(e)||!r.shapeCategories.includes(t))},selectRoleProfilingColors:function(e,t,o,n,r){void 0===r&&(r=2);var i=[],s=new a.ColorProfiles,u=[];if(o&&null==s.BackgroundProfileMedians[t]||!o&&null==s.PrimaryProfileMedians[t])return g.LegacyCoreAssert.fail("category not supported in selectRoleProfilingColors",void 0,"ProfilingColorMap.selectRoleProfilingColors","ProfilingColorMap.swift",524),[];for(var c=l.iter(this.colorSet);!c.done;c.next()){var h,d=c.value;if(h=e.colorLibraryController.getSolidColorForKey(d)){var p=0,f=0;o?p=this.getColorHSBDistance(h,s.BackgroundProfileMedians[t]):(p=this.getColorHSBDistance(h,s.PrimaryProfileMedians[t]),f=(n?1e3:0)*l.toDouble(this.countColorUsage(d,t))),i.push(p+f)}}for(var m=l.iter(l.range(0,r,!1));!m.done;m.next()){var y=l.min(i);if(null!=y){var v=l.indexOf(i,y);u.push(this.colorSet[v]),i[v]+=1e3}}return u},profilingCatgoriesCases:function(){for(var e=[],t=a.ProfilingCategories.NUM_CATEGORIES,o=l.iter(l.range(0,t,!1));!o.done;o.next()){var n=o.value;e.push(a.ProfilingCategories.toCaseValue(n))}return e},getColorHSBDistance:function(e,t){var o=[e.asHSB.h,e.asHSB.s,e.asHSB.b],n=Math.min(Math.abs(o[0]-t[0]),360-Math.abs(o[0]-t[0]));n/=180;var r=Math.abs(o[1]-t[1]),i=Math.abs(o[2]-t[2])/255;return Math.sqrt(n*n+r*r+i*i)}}}),r)},jo4Y:function(e,t,o){var n,r=t,i=o("oAGj"),a=o("Tq01"),l=o("CWW7"),s=o("yGNn"),u=o("Kkml");r.DeleteAction=(n=function e(t,o){void 0===t&&(t=null),void 0===o&&(o=!0),this.formaeToDelete=i.clone(t),this.undoable=o,a.Action.call(this,e.TYPE)},i.defineClass({name:"DeleteAction",ctor:n,superName:"Action",statics:{TYPE:"DeleteAction"},props:{canDo:function(e){return null!=this.formaeToDelete||e.selection.selectedCount>0},getUserAction:function(e){return u.UserActions.DeleteItem(this.undoable)},execute:function(e){var t=this;return new s.CorePromise((function(o,n){return l.CreationFacade.deleteFormae(t.formaeToDelete||e.selection.asFormaArray(),(function(){return o(null)}))}))}}}),n)},k7ZV:function(e,t,o){o("oAGj")},lYNH:function(e,t,o){var n,r,i,a=t,l=o("oAGj"),s=o("uj1m"),u=o("7Ta2"),c=o("taeg");a.ShapeRoleSuggesterFactory=(n=function(){},l.defineClass({name:"ShapeRoleSuggesterFactory",ctor:n,statics:{Create:function(e){return void 0===e&&(e=""),"MLP"==e?new a.ShapeRoleSuggesterMLP:new a.ShapeRoleSuggesterSimple}}}),n),a.ShapeRoleSuggesterMLP=(r=function(){c.RoleSuggesterMLP.call(this)},l.defineClass({name:"ShapeRoleSuggesterMLP",ctor:r,superName:"RoleSuggesterMLP",statics:{_implements:function(e){return"RoleSuggesterProtocol"==e}},props:{getRoleModel:function(){var e=s.MLPModel.loadNNModel("ShapeRole");return l.opt(e,(function(e){return e.finalSoftmax=!1})),e}}}),r),a.ShapeRoleSuggesterSimple=(i=function(){},l.defineClass({name:"ShapeRoleSuggesterSimple",ctor:i,statics:{_implements:function(e){return"RoleSuggesterProtocol"==e}},props:{getRole:function(e){var t=u.InferredRoleType.Undefined;return e.forma.isGridCell()&&(t=e.forma.controller.floating?u.InferredRoleType.Backing:u.InferredRoleType.Background),u.InferredRole.init_84d1(t,1)}}}),i)},lbYW:function(e,t,o){var n,r,i,a=t,l=o("oAGj"),s=o("Tq01"),u=o("O8XL"),c=o("yGNn"),h=o("Kkml");a.AlignFormaeAction=(n=function e(t){this.alignType=t,s.Action.call(this,e.TYPE)},l.defineClass({name:"AlignFormaeAction",ctor:n,superName:"Action",statics:{TYPE:"AlignFormaeAction"},props:{getUserAction:function(e){return h.UserActions.AlignFormae()},execute:function(e){return u.AlignmentFacade.alignFormae(this.alignType,e.selection.asFormaArray()),c.CorePromise.resolve(null)}}}),n),a.DistributeFormaeAction=(r=function e(t){this.distType=t,s.Action.call(this,e.TYPE)},l.defineClass({name:"DistributeFormaeAction",ctor:r,superName:"Action",statics:{TYPE:"DistributeFormaeAction"},props:{getUserAction:function(e){return h.UserActions.DistributeFormae()},execute:function(e){return u.AlignmentFacade.distributeFormae(this.distType,e.selection.asFormaArray()),c.CorePromise.resolve(null)}}}),r),a.ArrangeFormaeAction=(i=function e(t){this.horizontal=t,s.Action.call(this,e.TYPE)},l.defineClass({name:"ArrangeFormaeAction",ctor:i,superName:"Action",statics:{TYPE:"ArrangeFormaeAction"},props:{getUserAction:function(e){return h.UserActions.DistributeFormae()},execute:function(e){return u.AlignmentFacade.arrangeFormae(this.horizontal,e.selection.asFormaArray()),c.CorePromise.resolve(null)}}}),i)},lgJd:function(e,t,o){o("oAGj")},lq1z:function(e,t,o){var n,r,i,a,l=t,s=o("oAGj"),u=o("gXiO"),c=o("iCxV"),h=o("3lr5"),d=o("fNpk"),g=o("uj1m"),p=o("txj3"),f=o("K0Rh"),m=o("nrTo"),y=o("djAF"),v=o("ThKb");l.useNNModel=!0,l.linearLearningRate=.5,l.nnLearningRate=.005,s.gvar(l,"sharedSuggester_",(function(){return new l.FontSuggester})),l.concatSecondIntoFirst=function(e,t){for(var o=s.iter(t.descriptors);!o.done;o.next()){var n=o.value;e.append(n)}},l.FontSuggester=(n=function(){u.CoreObject.call(this)},r={},s.defineClass({name:"FontSuggester",ctor:n,superName:"CoreObject",statics:{sharedSuggester:{get:function(){return l.sharedSuggester_}},cache:{get:function(){return void 0===r.cache&&(r.cache=new m.PredictionCacheDouble),r.cache},set:function(e){r.cache=e}}},props:{getFontFeatures:function(e,t){var o,r,i=s.clone(e.selectedLockup.pts),a=i[0].x,u=i[0].y,c=i[3].x,h=i[3].y,d=(a+c)/2,g=(u+h)/2,p=e.width,m=e.height,v=e.selectedLockup.wordCount,S=e.selectedLockup.width,C=e.selectedLockup.height,T=e.numImages,A="root";if(r=s.opt(t.root,(function(e){return e.filterWithCallback((function(e){return null!=e.finalFrame&&null!=e.controller&&!e.controller.moveable&&(e.isBackgroundImage()||e.kind==y.ShapeForma.KIND||e.kind==f.RootForma.KIND)}))})))for(var F=s.iter(r);!F.done;F.next()){var k=F.value;k.isBackgroundImage()&&k.finalFrame.outsetXY(20,20).contains(t.finalFrame)?A="image":k.kind==y.ShapeForma.KIND&&(A="shape")}o=[p,m,p*m,Math.atan2(m,p),s.toDouble(e.lockups.length),s.toDouble(T),a/p,u/m,d/p,g/m,c/p,h/m,s.toDouble(v),S,C,S*C/s.toDouble(v),"root"==A?1:0,"image"==A?1:0,"shape"==A?1:0];var L=e.selectedLockup.styleAttributes.backing,b=e.selectedLockup.styleAttributes.layout;return n.cache.cleanup(t.page.document.uuid),new l.FontFeatures(o,L,b)},suggestFonts:function(e,t){if(null!=c.Host.fontProvider){var o=c.Host.fontProvider.getIncludedFonts(h.ANY_DOCUMENT),n=e.currentDocumentFonts.clone();l.concatSecondIntoFirst(n,e.recentlyUsedFonts),l.concatSecondIntoFirst(n,o),t(n)}},onlineLearning:function(e,t){var o,n;if(l.useNNModel){if(o=g.MLPModel.loadNNModel("Font")){var r=t.regularFeatures.concat(),i=s.repeat(0,58),a=s.repeat(0,4);null!=(D=s.indexOf(o.shapes,t.shape))&&(i[D]=1),null!=(x=s.indexOf(o.layouts,t.layout))&&(a[x]=1),r=r.concat(i).concat(a),d.LegacyCoreAssert.isTrue(81==r.length,"unexpected feature vector size",{count:r.length},"FontSuggester.onlineLearning","FontSuggester.swift",115);var u=s.clone(o.fonts),h=o.coefficients.length,f=s.repeat(0,o.coefficients[h-1].rows),m=new v.TheoMatrix([r]).subtract(o.featureScalingMean).divide(o.featureScalingStd);if(null!=(P=s.indexOf(u,e.postScriptName))&&P>=0&&P<f.length){f[P]=1;var y=new v.TheoMatrix([f]),S=new p.NNMLPClassifier(o.coefficients,o.intercepts),C=s.clone(S.forwardPropagate(m.transpose())),T=C.AL,A=s.clone(C.caches),F=s.clone(S.backwardPropagate(T,y.transpose(),A)),k=s.clone(F.dWs),L=s.clone(F.dbs);s.info("nn cost: "+S.computeCost(T,y.transpose())+")");for(var b=[],_=[],R=s.iter(s.range(0,h,!1));!R.done;R.next()){var I=R.value;b.push(o.coefficients[I].subtract(k[I].multiplyConstant(l.nnLearningRate))),_.push(o.intercepts[I].subtract(L[I].multiplyConstant(l.nnLearningRate)))}d.LegacyCoreAssert.isTrue(b.length==o.coefficients.length,"count mismatch: new weights and model coefficients",void 0,"FontSuggester.onlineLearning","FontSuggester.swift",138),d.LegacyCoreAssert.isTrue(_.length==o.intercepts.length,"count mismatch: new biases and model intercepts",void 0,"FontSuggester.onlineLearning","FontSuggester.swift",139);var w=new g.MLPModel(o.featureScalingMean,o.featureScalingStd,b,_,o.shapes,o.fonts,o.layouts,o.roles);s.opt(c.Host.learning,(function(e){return e.updateFontSuggestionNNModel(w)}))}}}else if(n=s.opt(c.Host.learning,(function(e){return e.loadFontSuggestionLinearModel()}))){var D,x,P;if(r=t.regularFeatures.concat(),i=s.repeat(0,58),a=s.repeat(0,4),null!=(D=s.indexOf(n.shapes,t.shape))&&(i[D]=1),null!=(x=s.indexOf(n.layouts,t.layout))&&(a[x]=1),r=r.concat(i).concat(a),d.LegacyCoreAssert.isTrue(81==r.length,"unexpected feature vector size",{count:r.length},"FontSuggester.onlineLearning","FontSuggester.swift",160),m=new v.TheoMatrix([r]).subtract(n.featureScalingMean).divide(n.featureScalingStd),u=s.clone(n.fonts),f=s.repeat(0,u.length),null!=(P=s.indexOf(u,e.postScriptName))&&P>=0&&P<f.length){f[P]=1,y=new v.TheoMatrix([f]);var E=m.matrixMultiply(n.coefficient.transpose()).add(n.intercept).sigmoid().subtract(y),M=n.coefficient.subtract(E.transpose().matrixMultiply(m).multiplyConstant(l.linearLearningRate)),N=n.intercept.subtract(E.multiplyConstant(l.linearLearningRate));w=new l.FontLinearModel(n.featureScalingMean,n.featureScalingStd,M,N,n.shapes,n.fonts,n.layouts),s.opt(c.Host.learning,(function(e){return e.updateFontSuggestionLinearModel(w)}))}}},clearCache:function(){n.cache.clearCache()},getScores:function(e,t){var o=t.getUniqueKey();if(null==n.cache.getCacheValue(o)){var r,i,a=[];if(l.useNNModel){if(r=g.MLPModel.loadNNModel("Font")){var u=t.regularFeatures.concat(),h=s.repeat(0,58),f=s.repeat(0,4);null!=(b=s.indexOf(r.shapes,t.shape))&&(h[b]=1),null!=(_=s.indexOf(r.layouts,t.layout))&&(f[_]=1),u=u.concat(h).concat(f),d.LegacyCoreAssert.isTrue(81==u.length,"unexpected feature vector size",{count:u.length},"FontSuggester.getScores","FontSuggester.swift",205);for(var m=new v.TheoMatrix([u]).subtract(r.featureScalingMean).divide(r.featureScalingStd),y=new p.NNMLPClassifier(r.coefficients,r.intercepts).predict(m.transpose()),S=s.clone(y.transpose().asArray),C=s.clone(r.fonts),T={},A=s.iter(s.toSequence(S[0]));!A.done;A.next()){var F=A.value,k=F.offset,L=F.element;T[C[k]]=L}e.forEach((function(e){var t;null!=(t=T[e.postScriptName])?a.push(t):a.push(0)}))}}else if(i=s.opt(c.Host.learning,(function(e){return e.loadFontSuggestionLinearModel()}))){var b,_;u=t.regularFeatures.concat(),h=s.repeat(0,58),f=s.repeat(0,4),null!=(b=s.indexOf(i.shapes,t.shape))&&(h[b]=1),null!=(_=s.indexOf(i.layouts,t.layout))&&(f[_]=1),u=u.concat(h).concat(f),d.LegacyCoreAssert.isTrue(81==u.length,"unexpected feature vector size",{count:u.length},"FontSuggester.getScores","FontSuggester.swift",239),y=(m=new v.TheoMatrix([u]).subtract(i.featureScalingMean).divide(i.featureScalingStd)).matrixMultiply(i.coefficient.transpose()).add(i.intercept),S=s.clone(y.sigmoid().asArray),C=s.clone(i.fonts),T={};for(var R=s.iter(s.toSequence(S[0]));!R.done;R.next()){var I=R.value;k=I.offset,L=I.element,T[C[k]]=L}e.forEach((function(e){var t;null!=(t=T[e.postScriptName])?a.push(t):a.push(0)}))}n.cache.setCacheValue(o,a)}return n.cache.getCacheValue(o)}}}),n),l.FontFeatures=(i=function(e,t,o){this.regularFeatures=s.clone(e),this.shape=t,this.layout=o},s.defineClass({name:"FontFeatures",ctor:i,props:{getUniqueKey:function(){for(var e="",t=s.iter(this.regularFeatures);!t.done;t.next()){var o=t.value;e=e+s.toString("%.2f",o)+"-"}return e=(e=e+this.shape+"-")+this.layout+"-"}}}),i),l.FontLinearModel=(a=function(e,t,o,n,r,i,a){this.featureScalingMean=e,this.featureScalingStd=t,this.coefficient=o,this.intercept=n,this.shapes=s.clone(r),this.fonts=s.clone(i),this.layouts=s.clone(a),this.fontMap={}},s.defineClass({name:"FontLinearModel",ctor:a,props:{data:function(){return s.clone(s.as({model:{coef:this.coefficient.asArray,intercept:this.intercept.asFlatArray,shapes:this.shapes,fonts:this.fonts,layouts:this.layouts},featureScalingMean:this.featureScalingMean.asFlatArray,featureScalingStd:this.featureScalingStd.asFlatArray},["Dictionary","String","Any"]))}}}),a)},lqhW:function(e,t,o){var n,r,i,a,l=t,s=o("oAGj"),u=o("gXiO"),c=o("ylxa"),h=o("1NAc");l.DesignSize=(n=function(e,t,o,n,r,i,a){this.label=e,this.subLabel=t,this.id=o,this.iconId=n,this.category=r,this.aspectRatio=i,this.exportData=a},s.defineClass({name:"DesignSize",ctor:n,superName:"CoreObject"}),n),l.DesignSizeCategory=(r=function(e,t){this.id=e,this.label=t},s.defineClass({name:"DesignSizeCategory",ctor:r,superName:"CoreObject"}),r),l.DesignSizeCategories=(i=function(){u.CoreObject.call(this)},a={},s.defineClass({name:"DesignSizeCategories",ctor:i,superName:"CoreObject",statics:{SocialPost:{get:function(){return void 0===a.SocialPost&&(a.SocialPost=new l.DesignSizeCategory("socialPost","SOCIAL POST")),a.SocialPost}},Print:{get:function(){return void 0===a.Print&&(a.Print=new l.DesignSizeCategory("print","PRINT")),a.Print}},SocialProfile:{get:function(){return void 0===a.SocialProfile&&(a.SocialProfile=new l.DesignSizeCategory("socialProfile","SOCIAL PROFILE")),a.SocialProfile}},Standard:{get:function(){return void 0===a.Standard&&(a.Standard=new l.DesignSizeCategory("standard","STANDARD")),a.Standard}},Custom:{get:function(){return void 0===a.Custom&&(a.Custom=new l.DesignSizeCategory("Custom","Custom")),a.Custom}},Default:{get:function(){return void 0===a.Default&&(a.Default=new l.DesignSizeCategory("Default","Default")),a.Default}},getCategories:function(){return[i.SocialPost,i.Print,i.SocialProfile,i.Standard]}}}),i),l.DesignSizeLibrary=function(){var e=function(){u.CoreObject.call(this)},t={};return s.defineClass({name:"DesignSizeLibrary",ctor:e,superName:"CoreObject",statics:{MAX_EDGE:2560,CUSTOM_ID:"Custom",designSizes:{get:function(){return void 0===t.designSizes&&(t.designSizes=[new l.DesignSize("k_Instagram_label","k_Instagram_subLabel","Instagram","instagram_icon",l.DesignSizeCategories.SocialPost,1,new c.FormaPageExportData(new h.TheoSize(1080,1080),c.PageExportFormat.PIXELS)),new l.DesignSize("k_InstagramStory_label","k_InstagramStory_subLabel","InstagramStory","instagram_icon",l.DesignSizeCategories.SocialPost,.5625,new c.FormaPageExportData(new h.TheoSize(1080,1920),c.PageExportFormat.PIXELS)),new l.DesignSize("k_InstagramPortrait_label","k_InstagramPortrait_subLabel","InstagramPortrait","instagram_icon",l.DesignSizeCategories.SocialPost,.8,new c.FormaPageExportData(new h.TheoSize(1080,1350),c.PageExportFormat.PIXELS)),new l.DesignSize("k_InstagramLandscape_label","k_InstagramLandscape_subLabel","InstagramLandscape","instagram_icon",l.DesignSizeCategories.SocialPost,1.91,new c.FormaPageExportData(new h.TheoSize(1080,566),c.PageExportFormat.PIXELS)),new l.DesignSize("k_Facebook_label","k_Facebook_subLabel","Facebook","facebook_icon",l.DesignSizeCategories.SocialPost,1.91,new c.FormaPageExportData(new h.TheoSize(1200,628),c.PageExportFormat.PIXELS)),new l.DesignSize("k_Pinterest_label","k_Pinterest_subLabel","Pinterest","pinterest_icon",l.DesignSizeCategories.SocialPost,.666969147,new c.FormaPageExportData(new h.TheoSize(735,1102),c.PageExportFormat.PIXELS)),new l.DesignSize("k_YouTubeThumbnail_label","k_YouTubeThumbnail_subLabel","YouTubeThumbnail","youtube_icon",l.DesignSizeCategories.SocialPost,1.77777777778,new c.FormaPageExportData(new h.TheoSize(1280,720),c.PageExportFormat.PIXELS)),new l.DesignSize("k_LinkedInBlogPost_label","k_LinkedInBlogPost_subLabel","LinkedInBlogPost","linkedin_icon",l.DesignSizeCategories.SocialPost,1.91082803,new c.FormaPageExportData(new h.TheoSize(1200,628),c.PageExportFormat.PIXELS)),new l.DesignSize("k_SnapchatStory_label","k_SnapchatStory_subLabel","SnapchatStory","snapchat_icon",l.DesignSizeCategories.SocialPost,.5625,new c.FormaPageExportData(new h.TheoSize(1080,1920),c.PageExportFormat.PIXELS)),new l.DesignSize("k_Twitter_label","k_Twitter_subLabel","Twitter","twitter_icon",l.DesignSizeCategories.SocialPost,1.79104477612,new c.FormaPageExportData(new h.TheoSize(1200,670),c.PageExportFormat.PIXELS)),new l.DesignSize("k_Letter_label","k_Letter_subLabel","Letter","",l.DesignSizeCategories.Print,.772727,new c.FormaPageExportData(new h.TheoSize(8.5,11),c.PageExportFormat.INCHES,c.FormaPageExportData.DEFAULT_PPI)),new l.DesignSize("k_Poster_label","k_Poster_subLabel","Poster","",l.DesignSizeCategories.Print,.647,new c.FormaPageExportData(new h.TheoSize(11,17),c.PageExportFormat.INCHES,c.FormaPageExportData.DEFAULT_PPI)),new l.DesignSize("k_Card_label","k_Card_subLabel","Card","",l.DesignSizeCategories.Print,.71428571,new c.FormaPageExportData(new h.TheoSize(5,7),c.PageExportFormat.INCHES,c.FormaPageExportData.DEFAULT_PPI)),new l.DesignSize("k_A5_label","k_A5_subLabel","A5","",l.DesignSizeCategories.Print,.70483871,new c.FormaPageExportData(new h.TheoSize(148,210),c.PageExportFormat.MILLIMETERS,c.FormaPageExportData.DEFAULT_PPI)),new l.DesignSize("k_A4_label","k_A4_subLabel","A4","",l.DesignSizeCategories.Print,.70695553,new c.FormaPageExportData(new h.TheoSize(210,297),c.PageExportFormat.MILLIMETERS,c.FormaPageExportData.DEFAULT_PPI)),new l.DesignSize("k_A3_label","k_A3_subLabel","A3","",l.DesignSizeCategories.Print,.7071155,new c.FormaPageExportData(new h.TheoSize(297,420),c.PageExportFormat.MILLIMETERS,c.FormaPageExportData.DEFAULT_PPI)),new l.DesignSize("k_FacebookProfileCover_label","k_FacebookProfileCover_subLabel","FacebookProfileCover","facebook_icon",l.DesignSizeCategories.SocialProfile,2.62820513,new c.FormaPageExportData(new h.TheoSize(1640,624),c.PageExportFormat.PIXELS)),new l.DesignSize("k_PageCover_label","k_PageCover_subLabel","FacebookPageCover","facebook_icon",l.DesignSizeCategories.SocialProfile,1.77777777778,new c.FormaPageExportData(new h.TheoSize(1200,675),c.PageExportFormat.PIXELS)),new l.DesignSize("k_EventCover_label","k_EventCover_subLabel","FacebookEventCover","facebook_icon",l.DesignSizeCategories.SocialProfile,1.91,new c.FormaPageExportData(new h.TheoSize(1920,1005),c.PageExportFormat.PIXELS)),new l.DesignSize("k_YouTubeChannelArt_label","k_YouTubeChannelArt_subLabel","YouTubeChannelArt","youtube_icon",l.DesignSizeCategories.SocialProfile,1.77777777778,new c.FormaPageExportData(new h.TheoSize(2560,1440),c.PageExportFormat.PIXELS)),new l.DesignSize("k_TwitchBanner_label","k_TwitchBanner_subLabel","TwitchBanner","twitch_icon",l.DesignSizeCategories.SocialProfile,4,new c.FormaPageExportData(new h.TheoSize(1920,480),c.PageExportFormat.PIXELS)),new l.DesignSize("k_TwitterHeader_label","k_TwitterHeader_subLabel","TwitterHeader","twitter_icon",l.DesignSizeCategories.SocialProfile,3,new c.FormaPageExportData(new h.TheoSize(1500,500),c.PageExportFormat.PIXELS)),new l.DesignSize("k_EtsyCover_label","k_EtsyCover_subLabel","EtsyCover","etsy_icon",l.DesignSizeCategories.SocialProfile,4,new c.FormaPageExportData(new h.TheoSize(3360,840),c.PageExportFormat.PIXELS)),new l.DesignSize("k_LinkedInProfileCover_label","k_LinkedInProfileCover_subLabel","LinkedInProfileCover","linkedin_icon",l.DesignSizeCategories.SocialProfile,3.878787878787879,new c.FormaPageExportData(new h.TheoSize(1536,396),c.PageExportFormat.PIXELS)),new l.DesignSize("k_EventbriteEventImage_label","k_EventbriteEventImage_subLabel","EventbriteEventImage","eventbrite_icon",l.DesignSizeCategories.SocialProfile,2,new c.FormaPageExportData(new h.TheoSize(2160,1080),c.PageExportFormat.PIXELS)),new l.DesignSize("k_Phone_label","k_Phone_subLabel","iPhone","phone_icon",l.DesignSizeCategories.Standard,.5625,new c.FormaPageExportData(new h.TheoSize(1080,1920),c.PageExportFormat.PIXELS)),new l.DesignSize("k_Square_label","k_Square_subLabel","Square","",l.DesignSizeCategories.Standard,1,new c.FormaPageExportData(new h.TheoSize(2560,2560),c.PageExportFormat.PIXELS)),new l.DesignSize("k_Landscape_label","k_Landscape_subLabel","3:2","",l.DesignSizeCategories.Standard,1.5,new c.FormaPageExportData(new h.TheoSize(2550,1700),c.PageExportFormat.PIXELS)),new l.DesignSize("k_Slide_label","k_Slide_subLabel","4:3","",l.DesignSizeCategories.Standard,1.33333333333,new c.FormaPageExportData(new h.TheoSize(2560,1920),c.PageExportFormat.PIXELS)),new l.DesignSize("k_Widescreen_label","k_Widescreen_subLabel","16:9","",l.DesignSizeCategories.Standard,1.77777777778,new c.FormaPageExportData(new h.TheoSize(2560,1440),c.PageExportFormat.PIXELS)),new l.DesignSize("k_Portrait_label","k_Portrait_subLabel","2:3","",l.DesignSizeCategories.Standard,.66666666666,new c.FormaPageExportData(new h.TheoSize(1700,2550),c.PageExportFormat.PIXELS)),new l.DesignSize("k_Banner_label","k_Banner_subLabel","3:1","",l.DesignSizeCategories.Standard,3,new c.FormaPageExportData(new h.TheoSize(2559,853),c.PageExportFormat.PIXELS)),new l.DesignSize("k_Wide_label","k_Wide_subLabel","2:1","",l.DesignSizeCategories.Standard,2,new c.FormaPageExportData(new h.TheoSize(2560,1280),c.PageExportFormat.PIXELS)),new l.DesignSize("k_Tall_label","k_Tall_subLabel","1:2","",l.DesignSizeCategories.Standard,.5,new c.FormaPageExportData(new h.TheoSize(1280,2560),c.PageExportFormat.PIXELS)),new l.DesignSize("k_SparkVideoSlide_label","k_SparkVideoSlide_subLabel","SparkVideoSlide","sparkvideo_icon",l.DesignSizeCategories.Standard,1.77777777778,new c.FormaPageExportData(new h.TheoSize(1280,720),c.PageExportFormat.PIXELS)),new l.DesignSize("k_SparkVideoSlideSquare_label","k_SparkVideoSlideSquare_subLabel","SparkVideoSlideSquare","sparkvideo_icon",l.DesignSizeCategories.Standard,1,new c.FormaPageExportData(new h.TheoSize(720,720),c.PageExportFormat.PIXELS)),new l.DesignSize("k_KindleCover_label","k_KindleCover_subLabel","KindleCover","kindle_icon",l.DesignSizeCategories.Standard,.625,new c.FormaPageExportData(new h.TheoSize(1600,2560),c.PageExportFormat.PIXELS)),new l.DesignSize("k_BlogPost_label","k_BlogPost_subLabel","BlogPost","blog_icon",l.DesignSizeCategories.Standard,1.78,new c.FormaPageExportData(new h.TheoSize(712,400),c.PageExportFormat.PIXELS))]),t.designSizes}},getListOfResizeShapes:function(){return e.designSizes},getById:function(t){for(var o=s.iter(e.designSizes);!o.done;o.next()){var n=o.value;if(n.id==t)return n}return null},getCustomSize:function(t,o,n,r){return new l.DesignSize("k_Custom_label","k_Custom_subLabel",e.CUSTOM_ID,"custom_icon",l.DesignSizeCategories.Custom,t/o,new c.FormaPageExportData(new h.TheoSize(t,o),n,n==c.PageExportFormat.PIXELS?null:r))},getOriginalSize:function(e,t){return new l.DesignSize("k_OriginalSize_label","","Original","",l.DesignSizeCategories.Default,e/t,new c.FormaPageExportData(new h.TheoSize(e,t),c.PageExportFormat.PIXELS))},getByCategory:function(t){return e.designSizes.filter((function(e){return e.category.id==t}),this)}}}),e}()},mCIK:function(e,t,o){var n,r,i,a,l,s=t,u=o("oAGj"),c=o("fWxZ"),h=o("iCxV"),d=o("358a"),g=o("90dd"),p=o("ZoS2"),f=o("1NAc");s.PageThumbnail=(n=function(e,t,o,n,r){this.id=e,this.data=t,this.width=o,this.height=n,this.isStale=r},u.defineClass({name:"PageThumbnail",ctor:n,superName:"CoreObject"}),n),s.PageThumbnailGenerationResponse=(r=function(e,t){this.data=e,this.pageModelVersion=t},u.defineClass({name:"PageThumbnailGenerationResponse",ctor:r,superName:"CoreObject"}),r),s.PageThumbnailCache=(i=function(){this.entriesByPageId_={},p.TheoPublishingObject.call(this)},u.defineClass({name:"PageThumbnailCache",ctor:i,superName:"TheoPublishingObject",statics:{_implements:function(e){return"TheoMessagePublisher"==e}},props:{attach:function(e){this.doc_=e},getThumbnailsForAllPages:function(){var e,t=this,o=[];return(e=this.doc_)&&d.PagesFacade.visitPages(e,(function(e){var n;return(n=t.getPageThumbnail(e))&&o.push(n),!0})),o},getPageThumbnail:function(e){var t,o=e.id;if(t=this.entriesByPageId_[e.id]){var n=t.forPageModelVersion<e.modelVersion;return new s.PageThumbnail(o,t.data,t.width,t.height,n)}return null},updateAllThumbnails:function(e,t){void 0===e&&(e=-1),void 0===t&&(t=-1);var o=this,n={};u.keys(this.entriesByPageId_).forEach((function(e){n[e]=!0}));var r,i=new s.PageThumbnailsChangedMessage(this);(r=this.doc_)&&d.PagesFacade.visitPages(r,(function(r){var a;return n[r.id]=!1,null!=(a=o.updatePageThumbnail(r,e,t))&&i.recordChange(a,r.id),!0}));for(var a=u.iter(n);!a.done;a.next()){var l=a.key;a.value&&this.discardThumbnailByPageId(l)&&i.recordChange(s.PageThumbnailsChangedMessage.CHG_REMOVED,l)}i.isEmpty||this.publish(i)},updatePageThumbnail:function(e,t,o){void 0===t&&(t=-1),void 0===o&&(o=-1);var n,r=this,i=!1,a=!1;if(n=h.Host.pageThumbnailUtils){var l=e.modelVersion,c=this.entriesByPageId_[e.id];if(u.opt(c,(function(e){return e.forPageModelVersion==l})))return null;var d=this.determineThumbnailSize(e,t,o);null==c&&(c=new s.PageThumbnailCacheEntry(d.width,d.height),this.entriesByPageId_[e.id]=c,i=!0);var g=!0;n.generatePageThumbnail(e,d.width,d.height).then((function(t){var o,i,l;if((o=u.as(t,s.PageThumbnailGenerationResponse))&&null!=(i=o.data)&&(l=r.entriesByPageId_[e.id])){var c;if(null!=(c=l.data)&&n.discardPageThumbnail(c),l.setViewData(i,d.width,d.height,o.pageModelVersion),!g){var h={updated:[e.id]};r.publish(new s.PageThumbnailsChangedMessage(r,h))}a=!0}return null})).fail((function(e){var t=u.clone(null==e?{}:{error:e});return u.opt(h.Host.logging,(function(e){return e.logAssertFailure("Failed to generate page thumbnail",t)})),null})),g=!1}return i?s.PageThumbnailsChangedMessage.CHG_ADDED:a?s.PageThumbnailsChangedMessage.CHG_UPDATED:null},ensureAllThumbnails:function(e,t){void 0===e&&(e=-1),void 0===t&&(t=-1);var o,n=this,r=[];return(o=this.doc_)&&d.PagesFacade.visitPages(o,(function(o){var i=n.entriesByPageId_[o.id];if(null==i){var a=n.determineThumbnailSize(o,e,t);i=new s.PageThumbnailCacheEntry(a.width,a.height),n.entriesByPageId_[o.id]=i,r.push(o.id)}return!0})),r},discardPageThumbnail:function(e){return this.discardThumbnailByPageId(e.id)},discardThumbnailByPageId:function(e){var t,o,n;return!!(t=this.entriesByPageId_[e])&&(u.removeKey(this.entriesByPageId_,e),(o=h.Host.pageThumbnailUtils)&&null!=(n=t.data)&&o.discardPageThumbnail(n),!0)},determineThumbnailSize:function(e,t,o){void 0===t&&(t=-1),void 0===o&&(o=-1);var n=e.pageSize,r=0,i=0;if(o>0&&t<0){var a=(r=o)/n.width;i=n.height*a}else a=(i=t>0?t:300)/n.height,r=n.width*a;return new f.TheoSize(r,i)}}}),i),s.PageThumbnailCacheEntry=(a=function(e,t){this.forPageModelVersion_=c.PageModelVersions.INVALID,this.width_=e,this.height_=t},u.defineClass({name:"PageThumbnailCacheEntry",ctor:a,props:{setViewData:function(e,t,o,n){n>this.forPageModelVersion_&&(this.data_=e,this.width_=t,this.height_=o,this.forPageModelVersion_=n)},width:{get:function(){return this.width_}},height:{get:function(){return this.height_}},data:{get:function(){return this.data_}},forPageModelVersion:{get:function(){return this.forPageModelVersion_}}}}),a),s.PageThumbnailsChangedMessage=(l=function e(t,o){void 0===o&&(o={}),this.changes=u.clone(o),g.TheoMessage.call(this,e.TYPE,t)},u.defineClass({name:"PageThumbnailsChangedMessage",ctor:l,superName:"TheoMessage",statics:{CHG_ADDED:"added",CHG_UPDATED:"updated",CHG_REMOVED:"removed",TYPE:"PageThumbnailsChangedMessage"},props:{recordChange:function(e,t){var o=u.clone(this.changes[e]||[]);o.push(t),this.changes[e]=u.clone(o)},isEmpty:{get:function(){return 0==u.count(this.changes)}}}}),l)},mD2h:function(e,t,o){var n,r,i,a=t,l=o("oAGj"),s=o("7siz"),u=o("FNB+");a.IActiveSwapModel=l.defineProtocol("IActiveSwapModel",{getActive:"() -> ActiveSwap"}),a.ActiveSwap=(n=function(e,t){this.swapThumbnailForma=e,this.swapThumbnailLocation=t},r={},l.defineClass({name:"ActiveSwap",ctor:n,superName:"CoreObject",statics:{NONE:{get:function(){return void 0===r.NONE&&(r.NONE=new n(null,null)),r.NONE}}}}),n),a.ActiveSwapState=(i=function(e){void 0===e&&(e=null),this.activeSwap=e||a.ActiveSwap.NONE},l.defineClass({name:"ActiveSwapState",ctor:i,superName:"EditorStateMember",statics:{_implements:function(e){return"IActiveSwapModel"==e}},props:{clone:function(){return new i(this.activeSwap)},getActive:function(){return this.activeSwap},setActive:function(e){this.beforeChange(),this.activeSwap=e,this.afterChange()},diff:function(e){return l.eq(u._equality_Forma_Forma,this.activeSwap.swapThumbnailForma,e.activeSwap.swapThumbnailForma)&&this.activeSwap.swapThumbnailLocation==e.activeSwap.swapThumbnailLocation?[]:[s.EditorModelChangedMessage.CHG_SWAP_STATE]}}}),i)},mL0c:function(e,t,o){var n,r=t,i=o("oAGj"),a=o("tGKA"),l=o("oKlP");r.PinBoundsType=i.defineEnum("PinBoundsType",{ChildrenBounds:0,Bounds:1}),r.TheoPin=(n=function(e,t,o,n,r,i,a,l,s,u){void 0===l&&(l=0),void 0===s&&(s=0),void 0===u&&(u=!1),this.forma=e,this.pinType=t,this.pinPoint=o,this.referenceForma=n,this.referencePinType=r,this.referencePoint=i,this.targetHeight=a,this.absoluteHeightDistance=l,this.relativeHeightDistance=s,this.useAbsoluteHeight=u,this.containedInParent=e.parent.finalFrame.insetRel(-.1,-.1,-.1,-.1).contains(e.finalFrame)},i.defineClass({name:"TheoPin",ctor:n,superName:"CoreObject",statics:{evalPinPoint:function(e,t,o){var n;if(n=i.opt(e.controller,(function(e){return e.getPinBounds(t)}))){var r=n.eval(o);return e.totalPlacement.transformPoint(r)}return null}},props:{offset:function(){var e,t,o;if((e=n.evalPinPoint(this.forma,this.pinType,this.pinPoint))&&(t=n.evalPinPoint(this.referenceForma,this.referencePinType,this.referencePoint))&&null!=(o=i.opt(this.referenceForma.controller,(function(e){return e.currentHeightScale})))){var r=this.useAbsoluteHeight?this.absoluteHeightDistance:o*this.relativeHeightDistance,a=1==this.pinPoint.y?-1:1;return new l.TheoPoint(t.x-e.x,t.y-e.y+a*r)}return l.TheoPoint.ZERO},offsetMatrix:function(){var e=this.offset(),t=l._minus_TheoPoint_TheoPoint(this.forma.totalPlacement.inverse.concat(this.forma.placement).transformPoint(e),this.forma.totalPlacement.inverse.concat(this.forma.placement).transformPoint(l.TheoPoint.ZERO));return a.Matrix2D.translation(t)},isRelativePin:{get:function(){return 0!=this.absoluteHeightDistance||0!=this.relativeHeightDistance}}}}),n)},"n/CE":function(e,t,o){var n,r,i,a=t,l=o("oAGj"),s=o("quOg"),u=o("FNB+"),c=o("cmoc"),h=o("9Lk3"),d=o("6Rk9"),g=o("iCxV"),p=o("fNpk"),f=o("uxH+"),m=o("K0Rh"),y=o("90dd"),v=o("ZoS2");a.SelectionStateChangedMessage=(n=function e(t){y.TheoMessage.call(this,e.TYPE,t)},l.defineClass({name:"SelectionStateChangedMessage",ctor:n,superName:"TheoMessage",statics:{TYPE:{get:function(){return"SelectionStateChangedMessage"}}}}),n),a.SelectionMode=l.defineEnum("SelectionMode",{Normal:0,Spacing:1,Crop:2,RefineCutout:3}),a.SelectionStateModeChangedMessage=(r=function e(t){y.TheoMessage.call(this,e.TYPE,t)},l.defineClass({name:"SelectionStateModeChangedMessage",ctor:r,superName:"TheoMessage",statics:{TYPE:{get:function(){return"SelectionStateModeChangedMessage"}}}}),r),a.SelectionState=(i=function(){this.selected_=[],this.selectionMode_=a.SelectionMode.Normal,this.inCharStyleMode=!1,this.inReplaceMode=!1,v.TheoPublishingObject.call(this)},l.defineClass({name:"SelectionState",ctor:i,superName:"TheoPublishingObject",statics:{_implements:function(e){return"TheoMessagePublisher"==e}},props:{inSpacingMode:{get:function(){return this.selectionMode_==a.SelectionMode.Spacing},set:function(e){this.selectionMode_=e?a.SelectionMode.Spacing:a.SelectionMode.Normal,l.opt(this.owner,(function(e){return e.updateHandles()}))}},inCropMode:{get:function(){return this.selectionMode_==a.SelectionMode.Crop},set:function(e){var t=e?a.SelectionMode.Crop:a.SelectionMode.Normal;t!=this.selectionMode_&&(this.selectionMode_=t,this.publishSelectionModeChange(),l.opt(this.owner,(function(e){return e.updateHandles()})))}},inRefineCutoutMode:{get:function(){return this.selectionMode_==a.SelectionMode.RefineCutout},set:function(e){var t=e?a.SelectionMode.RefineCutout:a.SelectionMode.Normal;t!=this.selectionMode_&&(this.selectionMode_=t,this.publishSelectionModeChange(),l.opt(this.owner,(function(e){return e.updateHandles()})))}},publishSelectionChange:function(){this.publish(new a.SelectionStateChangedMessage(this))},publishSelectionModeChange:function(){this.publish(new a.SelectionStateModeChangedMessage(this))},selectedCount:{get:function(){return this.selected_.length}},selectedCountInDocument:{get:function(){return this.asFormaArray().length}},IDs:{get:function(){return this.selected_},set:function(e){var t=this;0==this.selectedCount&&0==e.length||(this.clearSelection(!1),e.forEach((function(e){var o;(o=l.opt(l.opt(t.owner,(function(e){return e.document})),(function(t){return t.formaByID(e)})))&&t.selectForma(o,!1)})),this.publishSelectionChange())}},asFormaArray:function(){var e=[];return this.forEachSelected((function(t){l.containsEq(e,t,u._equality_Forma_Forma)||e.push(t)})),e},forEachSelected:function(e){var t=this;this.selected_.forEach((function(o){var n;(n=l.opt(l.opt(t.owner,(function(e){return e.document})),(function(e){return e.formaByID(o)})))&&e(n)}))},formaAt:function(e){var t=this;if(e<0||e>=this.selected_.length)return p.LegacyCoreAssert.fail("Invalid index for SelectionState.formaAt",void 0,"SelectionState.formaAt","SelectionState.swift",185),null;var o=l.opt(l.opt(this.owner,(function(e){return e.document})),(function(o){return o.formaByID(t.selected_[e])}));return null==o&&l.opt(g.Host.logging,(function(e){return e.warning("SelectionState.formaAt(index) is nil even though index is in range")})),o},isFormaSelectable:function(e){var t;if(((t=l.opt(e.controller,(function(e){return e.userGroupChild})))||null!=t)&&t)for(var o=l.iter(this.asFormaArray());!o.done;o.next()){var n,r,i=o.value;if((n=l.opt(i.controller,(function(e){return e.userGroupRoot})))&&(r=l.opt(e.controller,(function(e){return e.userGroupRoot})))&&n==r)return!1}return!this.isSelected(e)&&this.owner.allowSelectionChanges},selectForma:function(e,t){void 0===t&&(t=!0),this.selectFormae([e],t)},selectFormae:function(e,t){void 0===t&&(t=!0);for(var o=l.iter(e);!o.done;o.next()){var n=o.value;this.isFormaSelectable(n)&&(l.opt(n.parent,(function(e){return e.kind==c.FrameForma.KIND&&(n.isImage()||n.isVideo())}))?this.selected_.push(n.parent.formaID):this.selected_.push(n.formaID))}t&&this.publishSelectionChange()},replaceSelection:function(e){this.replaceSelectionWithFormae([e])},replaceSelectionWithFormae:function(e){this.clearSelectionArray(),this.selectFormae(e)},deselectForma:function(e,t){void 0===t&&(t=!0),this.deselectFormae([e],t)},deselectFormae:function(e,t){if(void 0===t&&(t=!0),this.owner.allowSelectionChanges){for(var o=l.iter(e);!o.done;o.next()){var n=o.value;this.isSelected(n)&&(l.remove(this.selected_,n.formaID),l.opt(n.parent,(function(e){return e.kind==c.FrameForma.KIND}))&&this.isSelected(n.parent)&&l.remove(this.selected_,n.parent.formaID))}t&&this.publishSelectionChange()}},isSelected:function(e){return this.selected_.includes(e.formaID)},isGroupSelected:function(e){var t,o;return(o=l.opt(e.controller,(function(e){return e.userGroupRoot})))?this.selected_.includes(o.formaID):!(!(t=l.opt(e.controller,(function(e){return e.userGroup})))&&null==t||!t)&&this.selected_.includes(e.formaID)},clearSelectionArray:function(){var e=this;if(this.removeStaleSelections(),this.owner.allowSelectionChanges){var t=[];this.forEachSelected((function(o){e.owner.interactionMode==s.InteractionMode.AutomaticGrid&&null!=o.controller&&o.controller.kind==h.GridController.KIND||t.push(o.formaID)}));for(var o=l.iter(t);!o.done;o.next()){var n=o.value;l.remove(this.selected_,n)}}},clearSelection:function(e){void 0===e&&(e=!0),this.owner.allowSelectionChanges&&this.selectedCount>0&&(this.clearSelectionArray(),e&&this.publishSelectionChange())},clearSelectionNoUpdate:function(){this.owner.allowSelectionChanges&&this.clearSelectionArray()},removeStaleSelections:function(e){void 0===e&&(e=!0);var t=this,o=[];this.selected_.forEach((function(e){null==l.opt(l.opt(t.owner,(function(e){return e.document})),(function(t){return t.formaByID(e)}))&&o.push(e)}));for(var n=l.iter(o);!n.done;n.next()){var r=n.value;l.remove(this.selected_,r)}e&&o.length>0&&this.owner.allowSelectionChanges&&this.publishSelectionChange()},getSelectionDescription:function(){var e,t,o=this.selectedCountInDocument>0?"k_Selection_Multiple":"",n=[];return this.forEachSelected((function(o){var r="";if(((e=l.opt(o.controller,(function(e){return e.userGroup})))||null!=e)&&e)r="k_Selection_Group";else if(o.isText()||o.isTypeLockup())r="k_Selection_Text";else if(o.isSticker())r="k_Selection_GIF";else if(o.isVideo())r="k_Selection_Video";else if(o.isLogo())r="k_Selection_Logo";else if(o.isShape()&&!o.isGridCell())r="k_Selection_Icon";else if(o.isShape()&&o.isGridCell())r="k_Selection_Background";else if(o.isBackgroundImage()||o.isImage())r="k_Selection_Image";else if(o.kind==m.RootForma.KIND){var i;(i=l.opt(l.as(o.controller,f.RootController),(function(e){return e.getGridController()})))&&((t=l.opt(i.gridStyle,(function(e){return e.gridCells.length})))||null!=t?t:0)>0&&(r="k_Selection_Border"),""==r&&(r="k_Selection_Background")}n.includes(r)||n.push(r)})),1==n.length&&(o=n[0]),o},getSelectionBounds:function(){var e=l.clone(this.asFormaArray());return d.GeometryFacade.getFormaeBounds(e)}}}),i)},nELi:function(e,t,o){var n,r,i=t,a=o("oAGj"),l=o("Tq01"),s=o("0wFF"),u=o("yGNn"),c=o("wNKJ"),h=o("FNB+"),d=o("6ZWm"),g=o("X0GW"),p=o("iCxV"),f=o("fdtz"),m=o("fAXt"),y=o("Kkml");i.ScaleAction=(n=function e(t,o,n){void 0===n&&(n=!0),this.scale=t,this.formaeToScale=a.clone(o),this.groupScale=n,l.Action.call(this,e.TYPE)},a.defineClass({name:"ScaleAction",ctor:n,superName:"Action",statics:{TYPE:{get:function(){return"ScaleAction"}}},props:{getUserAction:function(e){return y.UserActions.ScaleItem()},execute:function(e){var t,o,n,r,i=(null!=this.formaeToScale?a.clone(this.formaeToScale):e.selection.asFormaArray().map((function(e){var t=a.clone(e.filterByKind(f.ImageForma.KIND,h.FormaTraversal.JustChildren));return t.length>0&&!t[0].controller.floating?t[0]:e}),this)).filter((function(e){return!(!(t=a.opt(e.controller,(function(e){return e.scalable})))&&null==t)&&t}),this),l=null;i.length>1&&this.groupScale&&(n=g.GroupFacade.createGroupFromFormae(i))&&(i.splice(0),i.push(n),l=n);for(var y=a.iter(i);!y.done;y.next()){var v,S=y.value;m.TransformFacade.scaleForma(S,this.scale),c.DragFacade.rescueFormaToPageBounds(S),(v=(o=a.as(S.controller,d.FrameController))||null!=o?o:a.as(a.opt(S.parent,(function(e){return e.controller})),d.FrameController))&&(v.updateParentGroup(),v.fitChildrenToFrame()),S.isImage()?p.Host.platform.isWeb||a.opt(p.Host.logging,(function(e){return e.logToAnalytics(s.AnalyticsConstants.kAnalyticsDataImageResized,{})})):S.isShape()?a.opt(p.Host.logging,(function(e){return e.logToAnalytics(s.AnalyticsConstants.kAnalyticsDataShapeResized,{})})):S.isText()&&a.opt(p.Host.logging,(function(e){return e.logToAnalytics(s.AnalyticsConstants.kAnalyticsDataTextResized,{})}))}return(r=l)&&g.GroupFacade.cleanupGroup(r),u.CorePromise.resolve(null)}}}),n),i.RescueAction=(r=function(){},a.defineClass({name:"RescueAction",ctor:r,superName:"Action",statics:{TYPE:{get:function(){return"RescueAction"}}},props:{init_d41d:function(){l.Action.call(this,r.TYPE)},init_e169:function(e){this.formaeToRescue=a.clone(e),l.Action.call(this,r.TYPE)},getUserAction:function(e){return y.UserActions.RescueItem()},execute:function(e){var t;return(null!=this.formaeToRescue?a.clone(this.formaeToRescue):e.selection.asFormaArray().map((function(e){var t=a.clone(e.filterByKind(f.ImageForma.KIND,h.FormaTraversal.JustChildren));return t.length>0&&!t[0].controller.floating?t[0]:e}),this)).filter((function(e){return!(!(t=a.opt(e.controller,(function(e){return e.scalable})))&&null==t)&&t}),this).forEach((function(e){var t;a.as(e,f.ImageForma)&&(t=a.as(a.opt(e.parent,(function(e){return e.controller})),d.FrameController))?(t.updateParentGroup(),t.fitChildrenToFrame()):c.DragFacade.rescueFormaToPageBounds(e)})),u.CorePromise.resolve(null)}}}),r)},"nQ/X":function(e,t,o){var n,r=t,i=o("oAGj"),a=o("Nk+Q"),l=o("CMNw"),s=o("UUXZ"),u=o("PSFa"),c=o("JzRL"),h=o("elwG"),d=o("qUXk"),g=o("u+mS"),p=o("eLsM"),f=o("hsXA"),m=o("aKgf");r.CharStyleModeDesignController=(n=function(e,t){this.dc=e,d.DesignController.call(this),this.handles=new f.BaseHandlesHandler(e,this),this.drag=new g.DragFacadeBasedDragHandler(e,t,this),this.click=new h.StandardClickHandler(e),this.actions=new l.StandardActionHandler(e),this.attributes=new u.StandardAttributesHandler(e),this.featureSets=new p.StandardFeatureSetHandler(e),this.actionFeedback=new a.StandardActionFeedbackHandler(t),this.annotations=new s.StandardAnnotationsHandler(t),this.view=new m.StandardViewHandler(e,t),this.activePage=new c.StandardActivePageHandler(e,t)},i.defineClass({name:"CharStyleModeDesignController",ctor:n,superName:"DesignController"}),n)},nrTo:function(e,t,o){var n,r,i,a=t,l=o("oAGj"),s=o("iCxV");a.RolePredictionCacheProtocol=l.defineProtocol("RolePredictionCacheProtocol",{getCacheValue:"(String) -> InferredRole",setCacheValue:"(String, InferredRole) -> Void",cleanup:"(String) -> Void"}),a.RolePredictionCache=(n=function(){},l.defineClass({name:"RolePredictionCache",ctor:n,statics:{_implements:function(e){return"RolePredictionCacheProtocol"==e}},props:{getCacheValue:function(e){return l.opt(s.Host.logging,(function(e){return e.error("This method must be overridden")})),null},setCacheValue:function(e,t){l.opt(s.Host.logging,(function(e){return e.error("This method must be overridden")}))},cleanup:function(e){l.opt(s.Host.logging,(function(e){return e.error("This method must be overridden")}))}}}),n),a.PredictionCacheDouble=(r=function(){},l.defineClass({name:"PredictionCacheDouble",ctor:r,statics:{cache:{},currentDocID:""},props:{getCacheValue:function(e){return r.cache[e]},setCacheValue:function(e,t){r.cache[e]=l.clone(t)},cleanup:function(e){e!=r.currentDocID&&(r.currentDocID=e,r.cache={})},clearCache:function(){r.cache={}}}}),r),a.PredictionCacheInferredRole=(i=function(){a.RolePredictionCache.call(this)},l.defineClass({name:"PredictionCacheInferredRole",ctor:i,superName:"RolePredictionCache",statics:{cache:{},currentDocID:"",_implements:function(e){return"RolePredictionCacheProtocol"==e}},props:{getCacheValue:function(e){return i.cache[e]},setCacheValue:function(e,t){i.cache[e]=l.clone(t)},cleanup:function(e){e!=i.currentDocID&&(i.currentDocID=e,i.cache={})}}}),i)},"o+xL":function(e,t,o){var n,r=t,i=o("oAGj"),a=o("Tq01"),l=o("0wFF"),s=o("yGNn"),u=o("6ZWm"),c=o("pnSN"),h=o("X0GW"),d=o("iCxV"),g=o("lmwz"),p=o("Kkml");r.RotateAction=(n=function e(t,o,n,r){void 0===r&&(r=!0),this.angle=t,this.initialImagePlacement=o,this.formaeToRotate=i.clone(n),this.groupRotation=r,a.Action.call(this,e.TYPE)},i.defineClass({name:"RotateAction",ctor:n,superName:"Action",statics:{TYPE:{get:function(){return"RotateAction"}}},props:{getUserAction:function(e){return p.UserActions.RotateItem()},execute:function(e){var t,o=null;null!=this.formaeToRotate?o=i.clone(this.formaeToRotate):(o=[],e.selection.selectedCount>0&&e.selection.forEachSelected((function(e){return o.push(e)})));var n=i.clone(o).filter((function(e){return i.opt(e.controller,(function(e){return 1==e.rotateable}))}),this);if(0==n.length)return s.CorePromise.resolve(null);var r,a,p=null;n.length>1&&this.groupRotation&&(r=h.GroupFacade.createGroupFromFormae(n))&&(n.splice(0),n.push(r),p=r);for(var f=i.iter(n);!f.done;f.next()){var m,y,v=f.value;if((m=g.ImageFacade.getImageFormaForForma(v))&&(y=this.initialImagePlacement)){var S=y.transformValues,C=m.placement.transformValues,T=C.xscale>0?1:-1,A=C.yscale>0?1:-1;m.placement=m.placement.scaleTo(S.xscale*T,S.yscale*A)}var F,k=this.angle;v.controller.rotate(k),(F=(t=i.as(v.controller,u.FrameController))||null!=t?t:i.as(i.opt(v.parent,(function(e){return e.controller})),u.FrameController))&&(F.updateParentGroup(),F.fitChildrenToFrame()),v.isImage()?d.Host.platform.isWeb||i.opt(d.Host.logging,(function(e){return e.logToAnalytics(l.AnalyticsConstants.kAnalyticsDataImageRotated,{})})):v.isShape()?i.opt(d.Host.logging,(function(e){return e.logToAnalytics(l.AnalyticsConstants.kAnalyticsDataShapeRotated,{})})):v.isText()?i.opt(d.Host.logging,(function(e){return e.logToAnalytics(l.AnalyticsConstants.kAnalyticsDataTextRotated,{})})):v.kind==c.GroupForma.KIND&&i.opt(d.Host.logging,(function(e){return e.logToAnalytics(l.AnalyticsConstants.kAnalyticsDataMultiRotated,{})}))}return(a=p)&&h.GroupFacade.cleanupGroup(a),s.CorePromise.resolve(null)}}}),n)},oKI3:function(e,t,o){var n,r,i=t,a=o("oAGj"),l=o("fNpk"),s=o("c+uM"),u=o("BgH2"),c=o("oKlP");i.TextPathID=a.defineEnum("TextPathID",{UNSET:-1,Custom:0,Circle:1,SemiCircleUp:2,SemiCircleDown:3,ArcUp:4,ArcDown:5,Wave:6,Rect:7,Line:8}),i.TextPathLibrary=(n=function(){},r={},a.defineClass({name:"TextPathLibrary",ctor:n,statics:{getPathForLockupStyle:function(e){var t=e.layout;l.LegacyCoreAssert.isTrue(s.LockupStyle.isPath(t),"Why are we asking for a path for a non path layout?",void 0,"TextPathLibrary.getPathForLockupStyle","TextPathLibrary.swift",42);var o=e.pathID;return l.LegacyCoreAssert.isFalse(o==i.TextPathID.UNSET,"Why are we asking for a path when pathID is not set?",void 0,"TextPathLibrary.getPathForLockupStyle","TextPathLibrary.swift",45),o==i.TextPathID.Custom?(l.LegacyCoreAssert.isTrue(null!=e.customPath,"No custom path",void 0,"TextPathLibrary.getPathForLockupStyle","TextPathLibrary.swift",47),e.customPath):n.getPathByID(o)},getPathByID:function(e){var t;return(t=n.paths[e])?t.clone():(l.LegacyCoreAssert.fail("Unsupported path id",{id:e},"TextPathLibrary.getPathByID","TextPathLibrary.swift",59),n.circlePath)},isPathSymmetric:function(e){switch(e){case 1:case 6:case 7:case 8:return!0;case 2:case 3:case 4:case 5:case 0:return!1;case-1:return l.LegacyCoreAssert.fail("Unsupported path id",{id:e},"TextPathLibrary.isPathSymmetric","TextPathLibrary.swift",83),!1;default:return l.LegacyCoreAssert.fail("Unsupported path id",{id:e},"TextPathLibrary.isPathSymmetric","TextPathLibrary.swift",86),!1}},c:.551915024494,quad0:{get:function(){return void 0===r.quad0&&(r.quad0=new u.TextPathSegment(new c.TheoPoint(0,0),new c.TheoPoint(0,-n.c),new c.TheoPoint(1-n.c,-1),new c.TheoPoint(1,-1))),r.quad0}},quad1:{get:function(){return void 0===r.quad1&&(r.quad1=new u.TextPathSegment(new c.TheoPoint(1,-1),new c.TheoPoint(1+n.c,-1),new c.TheoPoint(2,-n.c),new c.TheoPoint(2,0))),r.quad1}},quad2:{get:function(){return void 0===r.quad2&&(r.quad2=new u.TextPathSegment(new c.TheoPoint(2,0),new c.TheoPoint(2,n.c),new c.TheoPoint(1+n.c,1),new c.TheoPoint(1,1))),r.quad2}},quad3:{get:function(){return void 0===r.quad3&&(r.quad3=new u.TextPathSegment(new c.TheoPoint(1,1),new c.TheoPoint(1-n.c,1),new c.TheoPoint(0,n.c),new c.TheoPoint(0,0))),r.quad3}},quad2Prime:{get:function(){return void 0===r.quad2Prime&&(r.quad2Prime=new u.TextPathSegment(new c.TheoPoint(0,0),new c.TheoPoint(0,n.c),new c.TheoPoint(1-n.c,1),new c.TheoPoint(1,1))),r.quad2Prime}},quad3Prime:{get:function(){return void 0===r.quad3Prime&&(r.quad3Prime=new u.TextPathSegment(new c.TheoPoint(1,1),new c.TheoPoint(1+n.c,1),new c.TheoPoint(2,n.c),new c.TheoPoint(2,0))),r.quad3Prime}},upArc:{get:function(){return void 0===r.upArc&&(r.upArc=new u.TextPathSegment(new c.TheoPoint(0,0),new c.TheoPoint(2,-1),new c.TheoPoint(4,-1),new c.TheoPoint(6,0))),r.upArc}},downArc:{get:function(){return void 0===r.downArc&&(r.downArc=new u.TextPathSegment(new c.TheoPoint(0,0),new c.TheoPoint(2,1),new c.TheoPoint(4,1),new c.TheoPoint(6,0))),r.downArc}},wave:{get:function(){return void 0===r.wave&&(r.wave=new u.TextPathSegment(new c.TheoPoint(0,0),new c.TheoPoint(2,-2),new c.TheoPoint(4,2),new c.TheoPoint(6,0))),r.wave}},lineTop:{get:function(){return void 0===r.lineTop&&(r.lineTop=new u.TextPathSegment(new c.TheoPoint(0,0),new c.TheoPoint(.3,0),new c.TheoPoint(.7,0),new c.TheoPoint(1,0))),r.lineTop}},lineRight:{get:function(){return void 0===r.lineRight&&(r.lineRight=new u.TextPathSegment(new c.TheoPoint(1,0),new c.TheoPoint(1,.3),new c.TheoPoint(1,.7),new c.TheoPoint(1,1))),r.lineRight}},lineBottom:{get:function(){return void 0===r.lineBottom&&(r.lineBottom=new u.TextPathSegment(new c.TheoPoint(1,1),new c.TheoPoint(.7,1),new c.TheoPoint(.3,1),new c.TheoPoint(0,1))),r.lineBottom}},lineLeft:{get:function(){return void 0===r.lineLeft&&(r.lineLeft=new u.TextPathSegment(new c.TheoPoint(0,1),new c.TheoPoint(0,.7),new c.TheoPoint(0,.3),new c.TheoPoint(0,0))),r.lineLeft}},circlePath:{get:function(){return void 0===r.circlePath&&(r.circlePath=new u.TextPath([n.quad0,n.quad1,n.quad2,n.quad3])),r.circlePath}},semicirclePath:{get:function(){return void 0===r.semicirclePath&&(r.semicirclePath=new u.TextPath([n.quad0,n.quad1])),r.semicirclePath}},semicircleDownPath:{get:function(){return void 0===r.semicircleDownPath&&(r.semicircleDownPath=new u.TextPath([n.quad2Prime,n.quad3Prime])),r.semicircleDownPath}},upArcPath:{get:function(){return void 0===r.upArcPath&&(r.upArcPath=new u.TextPath([n.upArc],2.5)),r.upArcPath}},downArcPath:{get:function(){return void 0===r.downArcPath&&(r.downArcPath=new u.TextPath([n.downArc],2.5)),r.downArcPath}},wavePath:{get:function(){return void 0===r.wavePath&&(r.wavePath=new u.TextPath([n.wave])),r.wavePath}},rectPath:{get:function(){return void 0===r.rectPath&&(r.rectPath=new u.TextPath([n.lineTop,n.lineRight,n.lineBottom,n.lineLeft],1/0)),r.rectPath}},linePath:{get:function(){return void 0===r.linePath&&(r.linePath=new u.TextPath([n.lineTop])),r.linePath}},paths:{get:function(){return void 0===r.paths&&(r.paths={1:n.circlePath,2:n.semicirclePath,3:n.semicircleDownPath,4:n.upArcPath,5:n.downArcPath,6:n.wavePath,7:n.rectPath,8:n.linePath}),r.paths}}}}),n)},oknb:function(e,t,o){var n,r,i=t,a=o("oAGj"),l=o("90dd"),s=o("ZoS2");i.ControllerSettingsState=(n=function(){s.TheoPublishingObject.call(this)},a.defineClass({name:"ControllerSettingsState",ctor:n,superName:"TheoPublishingObject",statics:{_implements:function(e){return"TheoMessagePublisher"==e}},props:{settings:{get:function(){return this.settings_},set:function(e){this.settings_=e,this.publish(new i.ControllerSettingsStateChangeMessage(this,this.settings))}}}}),n),i.ControllerSettingsStateChangeMessage=(r=function e(t,o){this.settings=o,l.TheoMessage.call(this,e.TYPE,t)},a.defineClass({name:"ControllerSettingsStateChangeMessage",ctor:r,superName:"TheoMessage",statics:{TYPE:{get:function(){return"ControllerSettingsStateChangeMessage"}}}}),r)},ol4x:function(e,t,o){var n,r,i,a,l,s,u,c,h,d,g,p=t,f=o("oAGj"),m=o("iCxV"),y=o("fNpk"),v=o("3DEm"),S=o("EoOi"),C=o("7l9C"),T=o("uUew"),A=o("1NAc");p.SpacerIdiom=f.defineEnum("SpacerIdiom",{insertLeft:0,insertRight:1,insertAbove:2,insertBelow:3}),p.LineMeasurements=(n=function(e,t){this.node=e,this.index=t,this.leaves=f.clone(e.getTextNodes()),this.width=e.localbounds().width},f.defineClass({name:"LineMeasurements",ctor:n}),n),p.TypographyLayout=(r=function(){this.fontScalingDiff=.25},f.defineClass({name:"TypographyLayout",ctor:r,statics:{worstScore:9999999.9,lineSpacing:.2,weightPairedText:function(e,t,o,n){if(void 0===n&&(n=null),o<2)return null;for(var r=[],i=f.toDouble(t.length)/f.toDouble(2*o),a=i,l=0,s=f.iter(f.range(0,o-1,!0));!s.done;s.next()){for(var u=v.MathUtils.minInt(f.toInt(a),t.length);l<u;)r.push(t[l]),l+=1;a+=i,l=u=v.MathUtils.minInt(f.toInt(a),t.length),a+=i}return r},divideIntoPairs:function(e,t,o){void 0===o&&(o=null);var n=f.toInt(t.length/2);if(n<2)return null;var i=v.MathUtils.minInt(v.MathUtils.maxInt(f.toInt(t.length/4),2),n);return r.weightPairedText(e,t,i,o)},scaleToRange:function(e,t,o,n){return e<0||e>1?n:t+e*(o-t)},longestWord:function(e){return f.sort(e,(function(e,t){return e.length>t.length}))[0]},longestRun:function(e,t){for(var o=0,n=null,r=f.iter(e);!r.done;r.next()){var i=r.value;t&&i.propagateDown(C.AlignmentIdiom.LRBB),i.calcTransform();var a=i.localbounds().width;a>o&&(o=a,n=i)}return n},longestLine:function(e){for(var t=null,o=0,n=f.iter(e);!n.done;n.next()){var r=n.value,i=r.localbounds().width;i>o&&(o=i,t=r)}return t},canRotate:function(e){e.calcTransform();var t=e.localbounds();return t.width/t.height>1},getDesiredSize:function(e,t){var o=t.aspectRatio,n=e.width,r=n/o;return r<e.height&&(n*=e.height/r,r=e.height),new A.TheoSize(n,r)},insertSpacer:function(e,t,o,n,r,i){var a=t.parent,l=new C.SpacerNode(n,o),s=r==p.SpacerIdiom.insertLeft||r==p.SpacerIdiom.insertAbove?new C.GroupNode(l,t):new C.GroupNode(t,l);return s.transAlign=i,s.parent=a,a.getChild(!0).isSame(t)?a.setChild(s,!0):a.setChild(s,!1),l},getScore:function(e,t){return v.MathUtils.absDouble(e.aspectRatio/t.aspectRatio-1)}},props:{category:function(){return S.TypographyLayoutCategory.UNSET},calculateWeighting:function(e,t,o,n){return void 0===o&&(o=null),void 0===n&&(n=null),null},supportsRelativeFontScale:function(){return!1},getDefaultRelativeFontScale:function(){return.5},arrangeWeightedText:function(e,t,o){},arrangeText:function(e,t,o){},adjustTree:function(e){y.LegacyCoreAssert.fail("Calling an abstract method.",void 0,"TypographyLayout.adjustTree","TypographyLayout.swift",114)}}}),r),p.SimpleAlignmentTypographyLayout=(i=function(e){this.alignment_=e,p.TypographyLayout.call(this)},f.defineClass({name:"SimpleAlignmentTypographyLayout",ctor:i,superName:"TypographyLayout",props:{calculateWeighting:function(e,t,o,n){if(void 0===o&&(o=null),void 0===n&&(n=null),f.toInt(t.length/2)<1)return null;if(null!=o&&o.length>0&&(o[0].start>0||o[0].end<t.length-1)){for(var r=[],i=f.iter(o);!i.done;i.next())for(var a=i.value,l=a.start;l<=a.end;)r.push(t[l]),l+=1;return r}return p.TypographyLayout.divideIntoPairs(e,t,n)},arrangeText:function(e,t,o){for(var n=f.iter(t);!n.done;n.next()){var r=n.value;r.propagateDown(C.AlignmentIdiom.LRBB),null!=r.parent&&(r.parent.transAlign=this.alignment_)}}}}),i),p.ReflowAlignmentTypographyLayout=(a=function(e){p.SimpleAlignmentTypographyLayout.call(this,e)},f.defineClass({name:"ReflowAlignmentTypographyLayout",ctor:a,superName:"SimpleAlignmentTypographyLayout",props:{arrangeText:function(e,t,o){if(1!=e.getRoot().getTextNodes().length){var n;if(t.length>1)n=e.findCommonAncestor(t);else{if(!(f.first(t)instanceof C.GroupNode))return;n=f.first(t)}n.optimizeFlow(this.alignment_,o.size_,C.ReflowType.FULL)}else p.SimpleAlignmentTypographyLayout.prototype.arrangeText.call(this,e,t,o)}}}),a),p.DoubletTypographyLayout=(l=function(){p.TypographyLayout.call(this)},f.defineClass({name:"DoubletTypographyLayout",ctor:l,superName:"TypographyLayout",props:{calculateWeighting:function(e,t,o,n){if(void 0===o&&(o=null),void 0===n&&(n=null),t.length<4)return null;var r=[];if(null!=o&&1==o.length&&(0==o[0].start&&o[o.length-1].end<t.length-1||o[0].start>0&&o[o.length-1].end==t.length-1)){for(var i=f.iter(o);!i.done;i.next())for(var a=i.value,l=a.start;l<=a.end;)r.push(t[l]),l+=1;return r}for(var s=f.toInt(e.length/2),u=f.iter(t);!u.done;u.next()){var c=u.value;if(!(c.start<s))break;r.push(c)}return r}}}),l),p.RotateTypographyLayout=(s=function(e){this.flavor_=e,p.SimpleAlignmentTypographyLayout.call(this,C.AlignmentIdiom.LLtb),this.fontScalingDiff=.1},f.defineClass({name:"RotateTypographyLayout",ctor:s,superName:"SimpleAlignmentTypographyLayout",statics:{FULL_START:0,FIT_START:1,TOP_START:2,BOTTOM_START:3,FULL_END:4,FIT_END:5,TOP_END:6,BOTTOM_END:7,MAX_LINES:4},props:{category:function(){return S.TypographyLayoutCategory.Rotate},calculateWeighting:function(e,t,o,n){if(void 0===o&&(o=null),void 0===n&&(n=null),t.length<2)return null;if(this.flavor_<s.FULL_END){if(t[0].length>2)return(r=[]).push(t[0]),r}else if(t[t.length-1].length>2){var r;return(r=[]).push(t[t.length-1]),r}return null},arrangeText:function(e,t,o){var n,r,i;1==t[0].getWeight()?(n=t[0],r=t[1],n.rotateAlign=C.TypographyNode.CounterClockwise,i=C.AlignmentIdiom.LLtb):(n=t[1],r=t[0],n.rotateAlign=C.TypographyNode.Clockwise,i=C.AlignmentIdiom.RRtb),n.propagateDown(C.AlignmentIdiom.LRBB),n.calcTransform();var a,l,u=n.localbounds();switch(this.flavor_){case 2:case 3:case 6:case 7:l=.5,a=!1;break;default:l=1,a=!0}var c,h=new A.TheoSize(v.MathUtils.maxDouble(1,u.height*o.size_.aspectRatio-u.width),l*u.height);if(r instanceof C.GroupNode){var d,g;switch(this.flavor_){case 1:case 5:d=C.ReflowType.FIT,g=2;break;case 0:case 4:d=C.ReflowType.FULL,g=2;break;case 2:case 6:d=C.ReflowType.TOP,g=1;break;default:d=C.ReflowType.BOTTOM,g=1}c=r.optimizeFlow(i,h,d,g)}else c=1;e.getRoot().calcTransform(),r.scaleAlign=u.height/r.localbounds().height,a?e.getRoot().transAlign=C.AlignmentIdiom.LRtt:(r.scaleAlign*=f.toDouble(c)/f.toDouble(v.MathUtils.maxInt(s.MAX_LINES,r.getTextNodes().length)),this.flavor_==s.BOTTOM_START||this.flavor_==s.BOTTOM_END?e.getRoot().transAlign=C.AlignmentIdiom.LRbb:e.getRoot().transAlign=C.AlignmentIdiom.LRtt)},adjustTree:function(e){var t=e.getRoot().getChild(!0),o=e.getRoot().getChild(!1);t.scaleAlign=1,o.scaleAlign=1,e.getRoot().calcTransform();var n=this.flavor_==s.FIT_START||this.flavor_==s.FIT_END||this.flavor_==s.FULL_START||this.flavor_==s.FULL_END;if(1==t.getWeight()){if(o.scaleAlign=t.localbounds().height/o.localbounds().height,!n){var r=f.clone(o.getLines());o.scaleAlign*=f.toDouble(r.length)/f.toDouble(v.MathUtils.maxInt(s.MAX_LINES,o.getTextNodes().length))}}else t.scaleAlign=o.localbounds().height/t.localbounds().height,n||(r=f.clone(t.getLines()),t.scaleAlign*=f.toDouble(r.length)/f.toDouble(v.MathUtils.maxInt(s.MAX_LINES,t.getTextNodes().length)))}}}),s),p.DropCapTypographyLayout=(u=function(e){this.flavor_=e,p.SimpleAlignmentTypographyLayout.call(this,C.AlignmentIdiom.LLtb),this.fontScalingDiff=.1},f.defineClass({name:"DropCapTypographyLayout",ctor:u,superName:"SimpleAlignmentTypographyLayout",statics:{FULL:0,FIT:1,TOP:2,BOTTOM:3,MAX_LINES:4},props:{category:function(){return S.TypographyLayoutCategory.DropCap},calculateWeighting:function(e,t,o,n){if(void 0===o&&(o=null),void 0===n&&(n=null),(this.flavor_==u.FULL||this.flavor_==u.FIT)&&t.length<2)return null;var r=null,i=f.clone(m.Host.pathUtils.matchesForRegexInString("^[0-9]+[%]$",e));return i.length>0?((r=[]).push(new T.TextRange(0,i[0].length-1)),r.push(new T.TextRange(i[0].length-1,i[0].length)),r):(i=f.clone(m.Host.pathUtils.matchesForRegexInString("^\\$[0-9]+[\\.][0-9][0-9]",e))).length>0?((r=[]).push(new T.TextRange(0,i[0].length-3)),r.push(new T.TextRange(i[0].length-3,i[0].length)),r):((i=f.clone(m.Host.pathUtils.matchesForRegexInString("^[0-9a-zA-Z]",e))).length>0&&(r=[]).push(new T.TextRange(0,i[0].length)),r)},arrangeText:function(e,t,o){var n=t[0]instanceof C.TextNode?t[0]:t[0].getTextNodes()[0],r=n.parent;if(r.getId()!=e.getRoot().getId()){var i;i=r.getChild(!0).getId()==n.getId()?r.getChild(!1):r.getChild(!0);var a=r.parent;a.getChild(!0).getId()==r.getId()?a.setChild(i,!0):a.setChild(i,!1),r.parent=null,r.setChild(e.getRoot(),!1),e.setRoot(r)}e.getRoot().transAlign=C.AlignmentIdiom.LRtt,n.calcTransform();var l,s=n.localbounds();l=this.flavor_==u.TOP||this.flavor_==u.BOTTOM?.5:1;var c,h=new A.TheoSize(v.MathUtils.maxDouble(1,s.height*o.size_.aspectRatio-s.width),l*s.height),d=e.getRoot().getChild(!1);c=d instanceof C.GroupNode?this.flavor_==u.FULL||this.flavor_==u.FIT?d.optimizeFlow(C.AlignmentIdiom.LLtb,h,this.flavor_==u.FIT?C.ReflowType.FIT:C.ReflowType.FULL,2):d.optimizeFlow(C.AlignmentIdiom.LLtb,h,this.flavor_==u.TOP?C.ReflowType.TOP:C.ReflowType.BOTTOM,1):1,e.getRoot().calcTransform(),d.scaleAlign=s.height/d.localbounds().height,this.flavor_==u.TOP||this.flavor_==u.BOTTOM?(d.scaleAlign*=f.toDouble(c)/f.toDouble(v.MathUtils.maxInt(u.MAX_LINES,d.getTextNodes().length)),this.flavor_==u.BOTTOM?e.getRoot().transAlign=C.AlignmentIdiom.LRbb:e.getRoot().transAlign=C.AlignmentIdiom.LRtt):e.getRoot().transAlign=C.AlignmentIdiom.LRtt},adjustTree:function(e){var t=e.getRoot().getChild(!0),o=e.getRoot().getChild(!1);if(t.scaleAlign=1,o.scaleAlign=1,e.getRoot().calcTransform(),o.scaleAlign=t.localbounds().height/o.localbounds().height,this.flavor_==u.TOP||this.flavor_==u.BOTTOM){var n=f.clone(o.getLines());o.scaleAlign*=f.toDouble(n.length)/f.toDouble(v.MathUtils.maxInt(u.MAX_LINES,o.getTextNodes().length))}}}}),u),p.TripletTypographyLayout=(c=function(){p.TypographyLayout.call(this)},f.defineClass({name:"TripletTypographyLayout",ctor:c,superName:"TypographyLayout",props:{calculateWeighting:function(e,t,o,n){if(void 0===o&&(o=null),void 0===n&&(n=null),t.length<3)return null;if(null!=o&&(1==o.length&&o[0].start>0&&o[0].end<t.length-1||2==o.length&&0==o[0].start&&o[o.length-1].end==t.length-1)){for(var r=[],i=f.iter(o);!i.done;i.next())for(var a=i.value,l=a.start;l<=a.end;)r.push(t[l]),l+=1;return r}var s=1,u=t.length-2;if(s<u){var c=0;for(l=s;l<=u;)c+=t[l].length,l+=1;for(var h=f.toInt(e.length/3);u-s>1&&c>h;)t[s].length>t[u].length?c-=t[u-=1].length:c-=t[s+=1].length}for(var d=[];s<=u;)d.push(t[s]),s+=1;return d}}}),c),p.MiddleTypographyLayout=(h=function(e){this.flavor_=e,p.TripletTypographyLayout.call(this)},f.defineClass({name:"MiddleTypographyLayout",ctor:h,superName:"TripletTypographyLayout",statics:{TRIPLET:0,TRIPLET_ROTATED_MIDDLE:1,TRIPLET_ROTATED_MIDDLE_MULTI:2,TRIPLET_ROTATED_ENDS:3,minEndGlyphCount:12},props:{category:function(){return S.TypographyLayoutCategory.Triplet},calculateWeighting:function(e,t,o,n){if(void 0===o&&(o=null),void 0===n&&(n=null),t.length<3)return null;if(null!=o&&1==o.length&&o[0].start>0&&o[0].end<t.length-1){var r=!1;switch(this.flavor_){case 0:r=o[0].start>2&&o[0].end<t.length-3;break;case 2:r=o[0].length>1;break;case 3:for(var i=0,a=f.iter(f.range(0,o[0].start-1,!0));!a.done;a.next())i+=t[d=a.value].length;if(i<h.minEndGlyphCount){i=0;for(var l=f.iter(f.range(o[0].end+1,t.length-1,!0));!l.done;l.next())i+=t[d=l.value].length;i<h.minEndGlyphCount&&(r=!0)}break;default:r=!0}if(r){for(var s=[],u=f.iter(o);!u.done;u.next())for(var c=u.value,d=c.start;d<=c.end;)s.push(t[d]),d+=1;return s}}var g=null;if(this.flavor_==h.TRIPLET_ROTATED_MIDDLE_MULTI)return t.length<8&&((g=[]).push(t[0]),g.push(t[t.length-1])),g;if(this.flavor_==h.TRIPLET){if(t.length>4){var p=0,m=f.toInt(t.length/2);if((T=t.length-3)>3)for(var y=f.iter(f.range(3,T,!0));!y.done;y.next())t[d=y.value].length>p&&(p=t[d].length,m=d);(g=[]).push(t[m])}return g}if(this.flavor_==h.TRIPLET_ROTATED_ENDS){i=0;for(var v=f.iter(t);!v.done;v.next())i+=v.value.length;var S=f.toInt(i/4);if(S<h.minEndGlyphCount){i=0;for(var C=0;i<S;)i+=t[C].length,C+=1;i=0;for(var T=t.length-1;i<S;)i+=t[T].length,T-=1;if(C>0&&T<t.length-1&&C<T)for(g=[];C<T;)g.push(t[C]),C+=1}return g}if(t.length>2){g=[];var A=f.sort(t,(function(e,t){return e.length>t.length}));for(d=0;A[d]==t[0]||A[d]==t[t.length-1];)d+=1;g.push(A[d])}return g},arrangeText:function(e,t,o){if(t[1].propagateDown(C.AlignmentIdiom.LRBB),this.flavor_==h.TRIPLET_ROTATED_ENDS)t[0].propagateDown(C.AlignmentIdiom.LRBB),t[2].propagateDown(C.AlignmentIdiom.LRBB);else if(this.flavor_==h.TRIPLET){t[1].calcTransform();var n,r,i=t[1].localbounds(),a=new A.TheoSize(i.height,i.height);(n=f.as(t[0],C.GroupNode))&&n.optimizeFlow(C.AlignmentIdiom.RRtb,a,C.ReflowType.FULL,3,3),(r=f.as(t[2],C.GroupNode))&&r.optimizeFlow(C.AlignmentIdiom.LLtb,a,C.ReflowType.FULL,3,3)}else t[0].propagateDown(C.AlignmentIdiom.RRtb),t[2].propagateDown(C.AlignmentIdiom.LLtb);var l;if(this.flavor_==h.TRIPLET_ROTATED_MIDDLE?t[1].rotateAlign=C.TypographyNode.Clockwise:this.flavor_==h.TRIPLET_ROTATED_MIDDLE_MULTI?t[1].rotateAlign=C.TypographyNode.CounterClockwise:this.flavor_==h.TRIPLET_ROTATED_ENDS&&(t[0].rotateAlign=C.TypographyNode.CounterClockwise,t[2].rotateAlign=C.TypographyNode.Clockwise),t[1].calcTransform(),i=t[1].localbounds(),f.clone(t[1].getTextNodes()).length>1&&(this.flavor_!=h.TRIPLET_ROTATED_MIDDLE_MULTI||t[1].getText().length>4)){t[0].calcTransform();var s=t[0].localbounds();t[2].calcTransform();var u=t[2].localbounds(),c=v.MathUtils.maxDouble(s.height,u.height);l=v.MathUtils.maxDouble(1,c*o.size_.aspectRatio-(s.width+u.width)),this.flavor_==h.TRIPLET_ROTATED_MIDDLE?t[1].optimizeFlow(C.AlignmentIdiom.LLtb,new A.TheoSize(c,l),C.ReflowType.FIT,2):t[1].optimizeFlow(C.AlignmentIdiom.LLtb,new A.TheoSize(l,c),C.ReflowType.FIT),t[1].calcTransform(),l=(i=t[1].localbounds()).height*o.size_.aspectRatio-i.width}else l=i.height*o.size_.aspectRatio-i.width;if(t[0].calcTransform(),t[2].calcTransform(),s=t[0].localbounds(),u=t[2].localbounds(),this.flavor_==h.TRIPLET_ROTATED_MIDDLE_MULTI)t[1].scaleAlign=v.MathUtils.maxDouble(s.height,u.height)/i.height;else if(this.flavor_==h.TRIPLET_ROTATED_ENDS)t[1].calcTransform(),i=t[1].localbounds(),t[0].scaleAlign=i.height/s.height,t[2].scaleAlign=i.height/u.height;else{var d=v.MathUtils.maxDouble(this.fontScalingDiff,l/(s.width+u.width+t[0].getMargin()+t[2].getMargin()));if(t[0].scaleAlign=d,t[2].scaleAlign=d,t[0].calcTransform(),t[2].calcTransform(),this.flavor_==h.TRIPLET_ROTATED_MIDDLE){var g=t[0].localbounds().height/i.height,p=t[2].localbounds().height/i.height;(d=v.MathUtils.maxDouble(g,p))>1&&(g>p?g>1&&(d=1/g):p>1&&(d=1/p),t[0].scaleAlign*=d,t[2].scaleAlign*=d)}else{var m=t[0].localbounds().height,y=i.height,S=t[2].localbounds().height;(m>=.5*y||S>=.5*i.height)&&(t[0].scaleAlign*=y/m,t[2].scaleAlign*=y/S)}}t[0].parent.transAlign=C.AlignmentIdiom.LRtt,t[2].parent.transAlign=C.AlignmentIdiom.LRbb},adjustTree:function(e){var t=e.getRoot().getChild(!0).getChild(!0),o=e.getRoot().getChild(!0).getChild(!1),n=e.getRoot().getChild(!1);if(this.flavor_==h.TRIPLET){t.scaleAlign=1,n.scaleAlign=1,e.getRoot().calcTransform();var r=o.localbounds().height;t.scaleAlign=r/t.localbounds().height,n.scaleAlign=r/n.localbounds().height}else if(this.flavor_==h.TRIPLET_ROTATED_MIDDLE_MULTI)o.scaleAlign=1,e.getRoot().calcTransform(),o.scaleAlign=v.MathUtils.maxDouble(t.localbounds().height,n.localbounds().height)/o.localbounds().height;else if(this.flavor_==h.TRIPLET_ROTATED_MIDDLE){t.scaleAlign=1,n.scaleAlign=1,e.getRoot().calcTransform();var i=t.localbounds().height/o.localbounds().height,a=n.localbounds().height/o.localbounds().height,l=v.MathUtils.maxDouble(i,a);l>1&&(i>a?i>1&&(l=1/i):a>1&&(l=1/a),t.scaleAlign*=l,n.scaleAlign*=l)}else this.flavor_==h.TRIPLET_ROTATED_ENDS?(t.scaleAlign=1,n.scaleAlign=1,e.getRoot().calcTransform(),r=o.localbounds().height,t.scaleAlign=r/t.localbounds().height,n.scaleAlign=r/n.localbounds().height):p.TripletTypographyLayout.prototype.adjustTree.call(this,e)}}}),h),p.QuadraticTypographyLayout=(d=function(){p.TypographyLayout.call(this)},f.defineClass({name:"QuadraticTypographyLayout",ctor:d,superName:"TypographyLayout",props:{calculateWeighting:function(e,t,o,n){if(void 0===o&&(o=null),void 0===n&&(n=null),t.length<4)return null;if(null!=o&&2==o.length&&(0==o[0].start&&o[o.length-1].end<t.length-1||o[0].start>0&&o[o.length-1].end==t.length-1)){for(var r=[],i=f.iter(o);!i.done;i.next())for(var a=i.value,l=a.start;l<=a.end;)r.push(t[l]),l+=1;return r}var s=[];s.push([]),s.push([]),s.push([]),s.push([]);for(var u=0,c=t.length%2==0?f.toInt(t.length/2)-1:f.toInt(t.length/2),h=c;u<h;)s[0].push(t[u]),s[1].splice(0,0,t[h]),u+=1,h-=1;if(u==h){var d=s[0][s[0].length-1].end-s[0][0].start,g=s[1][s[1].length-1].end-s[1][0].start;v.MathUtils.absInt(g+t[u].length-d)>v.MathUtils.absInt(d+t[u].length-g)?s[0].push(t[u]):s[1].splice(0,0,t[u])}if(s[0][s[0].length-1].end-s[0][0].start<2||s[1][s[1].length-1].end-s[1][0].start<2)return null;for(u=c+1,h=t.length-1;u<h;)s[2].push(t[u]),s[3].splice(0,0,t[h]),u+=1,h-=1;if(u==h){var p=s[2][s[2].length-1].end-s[2][0].start,m=s[3][s[3].length-1].end-s[3][0].start;v.MathUtils.absInt(m+t[u].length-p)>v.MathUtils.absInt(p+t[u].length-m)?s[2].push(t[u]):s[3].splice(0,0,t[u])}if(s[2][s[2].length-1].end-s[2][0].start<2||s[3][s[3].length-1].end-s[3][0].start<2)return null;var y=[];return f.append(y,s[0]),f.append(y,s[2]),y}}}),d),p.FitRotateFitTypographyLayout=(g=function(e){this.rotateFirst_=e,p.QuadraticTypographyLayout.call(this)},f.defineClass({name:"FitRotateFitTypographyLayout",ctor:g,superName:"QuadraticTypographyLayout",props:{category:function(){return S.TypographyLayoutCategory.RotateFit},arrangeText:function(e,t,o){var n,r,i,a;e.rotateNode(t[0].parent),o.size_.aspectRatio>1?(n=o.size_.width/2,r=o.size_.height):(n=o.size_.width,r=o.size_.height/2),this.rotateFirst_?((i=e.findCommonAncestor([t[0],t[1]])).optimizeFlow(C.AlignmentIdiom.LLtb,new A.TheoSize(r,n),C.ReflowType.FIT),(a=e.findCommonAncestor([t[2],t[3]])).optimizeFlow(C.AlignmentIdiom.LLtb,new A.TheoSize(n,r),C.ReflowType.FIT),i.rotateAlign=C.TypographyNode.CounterClockwise):((i=e.findCommonAncestor([t[0],t[1]])).optimizeFlow(C.AlignmentIdiom.LLtb,new A.TheoSize(n,r),C.ReflowType.FIT),(a=e.findCommonAncestor([t[2],t[3]])).optimizeFlow(C.AlignmentIdiom.LLtb,new A.TheoSize(r,n),C.ReflowType.FIT),a.rotateAlign=C.TypographyNode.CounterClockwise),i.calcTransform(),a.calcTransform(),o.size_.aspectRatio>1?(a.scaleAlign=i.localbounds().height/a.localbounds().height,e.getRoot().transAlign=C.AlignmentIdiom.LRtt):(a.scaleAlign=i.localbounds().width/a.localbounds().width,e.getRoot().transAlign=C.AlignmentIdiom.LLtb)},adjustTree:function(e){var t=e.getRoot().getChild(!0),o=e.getRoot().getChild(!1);t.scaleAlign=1,o.scaleAlign=1,e.getRoot().calcTransform(),e.getRoot().transAlign==C.AlignmentIdiom.LRtt?o.scaleAlign=t.localbounds().height/o.localbounds().height:o.scaleAlign=t.localbounds().width/o.localbounds().width}}}),g)},"p+tC":function(e,t,o){var n,r,i,a=t,l=o("oAGj"),s=o("fNpk"),u=o("uj1m"),c=o("txj3"),h=o("nrTo"),d=o("35Q0"),g=o("UqVc"),p=o("ThKb");a.predictCategory=!0,a.RawDataShapeSuggester=(n=function(){},l.defineClass({name:"RawDataShapeSuggester",ctor:n,props:{init_b1f8:function(e,t,o,n,r,i,a,l,s,u){this.numImages=e,this.numShapes=t,this.charLength=o,this.lineHeight=n,this.font=r,this.layout=i,this.textWidth=a,this.textHeight=l,this.centerX=s,this.centerY=u},getUniqueKey:function(){var e="";return e=(e=(e=(e=(e=(e=(e=(e=(e=(e=e+l.toString(this.numImages)+"-")+l.toString(this.numShapes)+"-")+l.toString(this.charLength)+"-")+l.toString(this.lineHeight)+"-")+this.font+"-")+this.layout+"-")+l.toString(this.textWidth)+"-")+l.toString(this.textHeight)+"-")+l.toString(this.centerX)+"-")+l.toString(this.centerY)+"-"},init_implicit:function(e,t,o,n,r,i,a,l,s,u){this.numImages=e,this.numShapes=t,this.charLength=o,this.lineHeight=n,this.font=r,this.layout=i,this.textWidth=a,this.textHeight=l,this.centerX=s,this.centerY=u},clone:function(){return n.init_implicit(this.numImages,this.numShapes,this.charLength,this.lineHeight,this.font,this.layout,this.textWidth,this.textHeight,this.centerX,this.centerY)}}}),n),a.ShapeSuggester=(r=function(){this.shapeCatMap={},this.shapeCatMap.banner=d.TagGroup.banner,this.shapeCatMap.square=d.TagGroup.square,this.shapeCatMap.other=d.TagGroup.other,this.shapeCatMap.circle=d.TagGroup.circle,this.shapeCatMap.decorative=d.TagGroup.decorative,this.shapeCatMap.none=d.TagGroup.none,l.defctor(this)},i={},l.defineClass({name:"ShapeSuggester",ctor:r,statics:{cache:{get:function(){return void 0===i.cache&&(i.cache=new h.PredictionCacheDouble),i.cache},set:function(e){i.cache=e}}},props:{getShapeSuggesterFeatures:function(e,t){var o=e.numImages,n=e.shapeCount,i=e.selectedLockup.charCount,s=l.toInt(e.selectedLockup.lineHeight),u=e.selectedLockup.font,c=e.selectedLockup.styleAttributes.layout,h=l.clone(e.selectedLockup.pts),d=(h[0].x+h[3].x)/2/e.width,g=(h[0].y+h[3].y)/2/e.height,p=l.toInt(e.selectedLockup.width),f=l.toInt(e.selectedLockup.height),m=l.clone(a.RawDataShapeSuggester.init_b1f8(o,n,i,s,u,c,p,f,d,g));return r.cache.cleanup(t.page.document.uuid),m},getScores:function(e,t){var o=this,n=t.getUniqueKey();if(null==r.cache.getCacheValue(n)){var i,h=[],f=0;if(i=u.MLPModel.loadNNModel("Shape")){var m,y,v,S=l.repeat(0,55),C=l.repeat(0,4),T=l.repeat(0,8);T[0]=l.toDouble(t.numShapes),T[1]=l.toDouble(t.numShapes),T[2]=l.toDouble(t.charLength),T[3]=l.toDouble(t.lineHeight),T[4]=l.toDouble(t.textWidth),T[5]=l.toDouble(t.textHeight),T[6]=l.toDouble(t.centerX),T[7]=l.toDouble(t.centerY),null!=(y=l.indexOf(i.fonts,t.font))&&(S[y]=1),null!=(v=l.indexOf(i.layouts,t.layout))&&(C[v]=1);var A=T.concat(S).concat(C);s.LegacyCoreAssert.isTrue(67==A.length,"unexpected feature vector size",{count:A.length},"ShapeSuggester.getScores","ShapeSuggester.swift",148);var F=new p.TheoMatrix([A]).subtract(i.featureScalingMean).divide(i.featureScalingStd),k=new c.NNMLPClassifier(i.coefficients,i.intercepts).predict(F.transpose()),L=l.clone(k.transpose().asArray);m=l.clone(i.shapes);for(var b={},_=l.iter(l.toSequence(L[0]));!_.done;_.next()){var R=_.value,I=R.offset,w=R.element;b[m[I]]=w,f=Math.max(f,w)}0==a.predictCategory?e.forEach((function(e){var t;null!=(t=b[e])?h.push(t+.2):h.push(0)})):e.forEach((function(e){var t=0;m.forEach((function(n){var r;l.opt(d.ShapeLibrary.getShapeDataForArtworkId(e),(function(e){return 1==e.tags.includes(o.shapeCatMap[n])}))&&null!=(r=b[n])&&(t=r)})),"row"==e?t=f+.5:l.opt(d.ShapeLibrary.getShapeDataForArtworkId(e),(function(e){return 1==e.tags.includes(o.shapeCatMap.none)}))&&(t=.1),h.push(t)}))}r.cache.setCacheValue(n,(new g.SuggestionUtils).normalizedWeights(h))}return r.cache.getCacheValue(n)}}}),r)},p8vO:function(e,t,o){var n,r,i,a,l=t,s=o("oAGj"),u=o("Tq01"),c=o("4mEG"),h=o("CWW7"),d=o("yGNn"),g=o("iCxV"),p=o("mBzD"),f=o("q5zr"),m=o("fNpk"),y=o("VkKB"),v=o("RkYL"),S=o("Yspk"),C=o("Kkml"),T=o("mxdD"),A=o("QTen");l.ChangeVideoVolumeAction=(n=function e(t){void 0===t&&(t=A.VideoStyle.volumeOff),this.volumeLevel=t,u.Action.call(this,e.TYPE)},s.defineClass({name:"ChangeVideoVolumeAction",ctor:n,superName:"Action",statics:{TYPE:"ChangeVideoVolumeAction"},props:{getUserAction:function(e){return C.UserActions.ChangeVideoVolume()},execute:function(e){return T.VideoFacade.changeVideoVolume(e.selection.asFormaArray(),this.volumeLevel),d.CorePromise.resolve(null)}}}),n),l.UpdateVideoStyleTrimAction=(r=function e(t,o,n,r,i,a){var l;void 0===a&&(a=null),this.forma=t,this.newTrim=o,this.padding=n,this.isLocalVideo=r,this.posterParams=i,u.Action.call(this,(l=a)||null!=l?l:e.TYPE)},s.defineClass({name:"UpdateVideoStyleTrimAction",ctor:r,superName:"Action",statics:{TYPE:{get:function(){return"UpdateVideoStyleTrimAction"}}},props:{getUserAction:function(e){return C.UserActions.TrimVideo()},executeIfAble:function(e){var t,o;if((t=s.as(this.forma.style,A.VideoStyle))&&(o=this.forma.videoContentNode)){if(!this.isLocalVideo)return t.startTime=this.newTrim.start,t.endTime=this.newTrim.end,this.updatePoster(e),d.CorePromise.resolve(new u.FormaActionResult([this.forma]));var n=S.TheoTimeRange.makeFromDuration(o.originalDuration),r=S.TheoTimeRange.makeFromStartAndDuration(o.offsetInOriginal||v.TheoTime.Zero,o.duration),i=this.newTrim.padBy(this.padding.seconds,n);if(m.LegacyCoreAssert.isTrue(n.contains(r),"trimmed range not in original range",void 0,"UpdateVideoStyleTrimAction.executeIfAble","VideoActions.swift",70),m.LegacyCoreAssert.isTrue(n.contains(this.newTrim),"new trim not in original range",void 0,"UpdateVideoStyleTrimAction.executeIfAble","VideoActions.swift",71),o.wasTrimmed&&r.contains(i))return t.startTime=this.newTrim.start.subtract(r.start),t.endTime=this.newTrim.end.subtract(r.start),this.updatePoster(e),d.CorePromise.resolve(new u.FormaActionResult([this.forma]))}return null},updatePoster:function(e){var t,o,n;(t=this.posterParams)&&(o=e.document)&&(n=s.as(o.content.createNode(f.ImageContentNode.KIND,null),f.ImageContentNode))&&(n.url=t.url,n.mimeType=t.mimeType,n.pixelWidth=t.width,n.pixelHeight=t.height,h.CreationFacade.removeContentNodeFromDocument(this.forma.contentNode,o),this.forma.contentNode=n,h.CreationFacade.addContentNodeToDocument(n,o))},execute:function(e){return this.executeIfAble(e)||d.CorePromise.reject("Cannot trim video - trim window outside of content")}}}),r),l.VideoInfoUpdate=(i=function(e,t){this.pre=e,this.post=t},s.defineClass({name:"VideoInfoUpdate",ctor:i}),i),l.TrimVideoAction=(a=function e(t,o,n,r,i,a,s,u,c){this.videoURL=n,this.videoID=o,this.outputURL=i,this.mimeType=r,this.progress=a,l.UpdateVideoStyleTrimAction.call(this,t,s,u,!0,c,e.TYPE),m.LegacyCoreAssert.isTrue(null==o&&null!=n||null!=o&&null==n,"only one of video id and URL should be provided",void 0,"TrimVideoAction.init","VideoActions.swift",162)},s.defineClass({name:"TrimVideoAction",ctor:a,superName:"UpdateVideoStyleTrimAction",statics:{TYPE:{get:function(){return"TrimVideoAction"}}},props:{execute:function(e){var t,o=this;if(C=l.UpdateVideoStyleTrimAction.prototype.executeIfAble.call(this,e))return C;if(t=this.forma.videoContentNode){var n,r=S.TheoTimeRange.makeFromDuration(t.originalDuration),i=S.TheoTimeRange.makeFromStartAndDuration(t.offsetInOriginal||v.TheoTime.Zero,t.duration),a=this.newTrim.padBy(this.padding.seconds,r);if(m.LegacyCoreAssert.isTrue(r.contains(i),"trimmed range not in original range",void 0,"TrimVideoAction.execute","VideoActions.swift",179),m.LegacyCoreAssert.isTrue(r.contains(this.newTrim),"new trim not in original range",void 0,"TrimVideoAction.execute","VideoActions.swift",180),n=g.Host.videoUtils){var u,h,f,C=null,T=this.outputURL,A=this.progress;if(null!=(u=this.videoURL)?C=n.getAttributesForVideoAtUrl(u).then((function(e){return n.trimVideoAtUrl(u,T,a,A).then((function(t){return new l.VideoInfoUpdate(s.as(e,p.VideoInfo),s.as(t,p.VideoInfo))}))})):null!=(h=this.videoID)&&(C=n.getAttributesForVideoWithId(h).then((function(e){return n.trimVideoWithId(h,T,a,A).then((function(t){return new l.VideoInfoUpdate(s.as(e,p.VideoInfo),s.as(t,p.VideoInfo))}))}))),f=C)return f.then((function(n){var r,u,h;if((r=s.as(n,l.VideoInfoUpdate))&&(u=r.pre)&&(h=r.post)){var g=a.start,p=u.duration,f=new c.ReplaceVideoFormaContentAction(o.forma,o.outputURL,o.mimeType,h.width,h.height,h.duration,g,i.duration,g,p,[],o.posterParams,!1,t.mediaMetadata||y.MediaMetadata.init_4d41(),t.localIdentifier);return e.designController.actions.doAction(f)}return d.CorePromise.reject("Unexpected trim results")}))}}return d.CorePromise.reject("An error occurred while trimming")}}}),a)},pjjd:function(e,t,o){var n,r,i,a=t,l=o("oAGj"),s=o("Tq01"),u=o("0wFF"),c=o("CWW7"),h=o("yGNn"),d=o("wNKJ"),g=o("FNB+"),p=o("iCxV"),f=o("fdtz"),m=o("lmwz"),y=o("tGKA"),v=o("358a"),S=o("djAF"),C=o("enh0"),T=o("Kkml");a.DuplicateAction=(n=function e(t,o,n,r){void 0===r&&(r=!1),this.formaeToDuplicate=l.clone(t),this.offsetDuplicates=o,this.selectDuplicates=n,this.isDragShortcut=r,s.Action.call(this,e.TYPE)},l.defineClass({name:"DuplicateAction",ctor:n,superName:"Action",statics:{TYPE:"DuplicateAction",canAddImages:function(e){if(0==e.length)return!1;for(var t=0,o=l.iter(e);!o.done;o.next())o.value.isImage()&&(t+=1);return m.ImageFacade.canAddImages(e[0].root,t)},useSelection:function(){return new n(null,!0,!0,!1)}},props:{getUserAction:function(e){return T.UserActions.DuplicateItems(this.formaeToDuplicate||e.selection.asFormaArray())},execute:function(e){var t=this;return c.CreationFacade.duplicateItems(this.formaeToDuplicate||e.selection.asFormaArray(),this.offsetDuplicates,!1,this.isDragShortcut).then((function(e){var o;return(o=l.as(e,["Array",g.Forma]))?(t.selectDuplicates&&(t.newSelection=l.clone(o)),new s.FormaActionResult(o)):h.CorePromise.reject("did not get an array of Forma back from CreationFacade.duplicateItems")}))},updateSelection:function(e){return null!=this.newSelection&&this.selectDuplicates&&e.selection.replaceSelectionWithFormae(this.newSelection),this.newSelection}}}),n),a.CopyToAction=(r=function e(t,o,n){void 0===n&&(n=0),this.formaeToCopy=l.clone(t),this.destPage=o,this.offsetValue=n,s.Action.call(this,e.TYPE)},l.defineClass({name:"CopyToAction",ctor:r,superName:"Action",statics:{TYPE:"CopyToAction",canAddImages:function(e,t){if(0==e.length)return!1;for(var o=0,n=l.iter(e);!n.done;n.next())n.value.isImage()&&(o+=1);return m.ImageFacade.canAddImages(t.root,o)},useSelection:function(e){return new r(null,e)}},props:{getUserAction:function(e){return T.UserActions.CopyToItems()},execute:function(e){var t=this;return c.CreationFacade.copyItems(this.formaeToCopy||e.selection.asFormaArray(),this.destPage,void 0,!1).then((function(e){var o;if(o=l.as(e,["Array",g.Forma])){var n=!1,r=!1,i=!1;0!=t.offsetValue&&o.forEach((function(e){return e.move(y.Matrix2D.translationXY(t.offsetValue,t.offsetValue))}));for(var a=l.iter(o);!a.done;a.next()){var c=a.value;d.DragFacade.rescueFormaToPageBounds(c),c.visit(g.FormaTraversal.PreOrder,(function(e,t,o){return e instanceof f.ImageForma&&(n=!0),e instanceof C.TextForma&&(r=!0),e instanceof S.ShapeForma&&(i=!0),n&&r&&i}))}var m=l.opt(l.first(t.formaeToCopy),(function(e){return e.page.document==t.destPage.document?"sameProject":"ccxProject"})),v="";return n&&(v+="image "),r&&(v+="text "),i&&(v+="shape "),l.opt(p.Host.logging,(function(e){return e.logToAnalytics(u.AnalyticsConstants.kAnalyticsEventPaste,{contextualData1:u.AnalyticsConstants.kAnalyticDataPasteSource+":"+m,contextualData2:u.AnalyticsConstants.kAnalyticDataPasteObjectType+":"+v,contextualData3:u.AnalyticsConstants.kAnalyticDataPasteStatus+":success"})})),new s.FormaActionResult(o)}return h.CorePromise.reject("did not get an array of Forma back from CreationFacade.copyItems")}))}}}),r),a.CopyToPasteboardAction=(i=function(e){this.formaeToCopy=l.clone(e),s.Action.call(this,a.CopyToAction.TYPE)},l.defineClass({name:"CopyToPasteboardAction",ctor:i,superName:"Action",statics:{TYPE:"CopyToPasteboardAction",pasteboardPage:null},props:{getUserAction:function(e){return T.UserActions.CopyToPasteboard()},execute:function(e){return i.pasteboardPage=v.PagesFacade.createNewPage(e.document,this.formaeToCopy[0].page,!1),c.CreationFacade.copyItems(this.formaeToCopy,i.pasteboardPage,void 0,!1).then((function(e){var t;return(t=l.as(e,["Array",g.Forma]))?new s.FormaActionResult(t):h.CorePromise.reject("did not get an array of Forma back from CreationFacade.copyItems")}))}}}),i)},qKrA:function(e,t,o){var n,r=t,i=o("oAGj"),a=o("7siz");r.IActivePageModel=i.defineProtocol("IActivePageModel",{get:"() -> FormaPage"}),r.IMutableActivePageModel=i.defineProtocol("IMutableActivePageModel",{reset:"() -> Void",set:"(FormaPage) -> Void"}),r.ActivePageState=(n=function(e){void 0===e&&(e=null),this.page=e},i.defineClass({name:"ActivePageState",ctor:n,superName:"EditorStateMember",statics:{_implements:function(e){return"IMutableActivePageModel"==e||"IActivePageModel"==e}},props:{clone:function(){return new n(this.page)},get:function(){return this.page},reset:function(){this.page=null},set:function(e){this.beforeChange(),this.page=e,this.afterChange()},diff:function(e){return this.page==e.get()?[]:[a.EditorModelChangedMessage.CHG_ACTIVE_PAGE]}}}),n)},qUXk:function(e,t,o){var n,r,i,a=t,l=o("oAGj"),s=o("Nk+Q"),u=o("CMNw"),c=o("UUXZ"),h=o("PSFa"),d=o("JzRL"),g=o("elwG"),p=o("gXiO"),f=o("u+mS"),m=o("eLsM"),y=o("hsXA"),v=o("G9CY"),S=o("JU+l"),C=o("9X7Y"),T=o("aKgf");a.HandlerFactory=(n=function(){},l.defineClass({name:"HandlerFactory",ctor:n,props:{drag:{get:function(){return f.NullDragHandler.instance}},click:{get:function(){return g.NullClickHandler.instance}},resize:{get:function(){return S.NullResizeHandler.instance}},rotate:{get:function(){return C.NullRotateHandler.instance}},actions:{get:function(){return u.NullActionHandler.instance}},handles:{get:function(){return y.NullHandlesHandler.instance}},attributes:{get:function(){return h.NullAttributesHandler.instance}},featureSets:{get:function(){return m.NullFeatureSetHandler.instance}},view:{get:function(){return T.NullViewHandler.instance}},activePage:{get:function(){return d.NullActivePageHandler.instance}}}}),n),a.DesignController=(r=function(){this.click=g.NullClickHandler.instance,this.drag=f.NullDragHandler.instance,this.resize=S.NullResizeHandler.instance,this.move=v.NullMoveHandler.instance,this.rotate=C.NullRotateHandler.instance,this.actions=u.NullActionHandler.instance,this.handles=y.NullHandlesHandler.instance,this.attributes=h.NullAttributesHandler.instance,this.featureSets=m.NullFeatureSetHandler.instance,this.actionFeedback=s.NullActionFeedbackHandler.instance,this.annotations=c.NullAnnotationsHandler.instance,this.view=T.NullViewHandler.instance,this.activePage=d.NullActivePageHandler.instance,p.CoreObject.call(this)},i={},l.defineClass({name:"DesignController",ctor:r,superName:"CoreObject",statics:{NullController:{get:function(){return void 0===i.NullController&&(i.NullController=new r),i.NullController}}},props:{configureEditorModel:function(e){this.handles.updateHandles(e.mutable.handles),this.attributes.updateAttributes(e.mutable.attributes),this.featureSets.updateFeatureSets(e.mutable.featureSets),this.annotations.updateAnnotations(e.mutable.annotations)}}}),r)},quOg:function(e,t,o){var n,r,i,a,l=t,s=o("oAGj"),u=o("0wFF"),c=o("70fJ"),h=o("oknb"),d=o("rsKm"),g=o("qUXk"),p=o("7S/6"),f=o("BbDD"),m=o("7siz"),y=o("waL6"),v=o("yHU1"),S=o("Pil/"),C=o("OdB2"),T=o("P83h"),A=o("iCxV"),F=o("bqbo"),k=o("358a"),L=o("g8Fi"),b=o("KIfs"),_=o("i5Hy"),R=o("n/CE"),I=o("cRpU"),w=o("90dd"),D=o("ZoS2"),x=o("rrhp");l.InteractionMode=s.defineEnum("InteractionMode",{DefaultInteraction:0,SelectionFocused:1,AutomaticGrid:2}),l.ClickMessage=(n=function e(t,o){this.state=t,w.TheoMessage.call(this,e.TYPE,o)},s.defineClass({name:"ClickMessage",ctor:n,superName:"TheoMessage",statics:{TYPE:{get:function(){return"ClickMessage"}}}}),n),l.DoubleClickMessage=(r=function e(t,o){this.state=t,w.TheoMessage.call(this,e.TYPE,o)},s.defineClass({name:"DoubleClickMessage",ctor:r,superName:"TheoMessage",statics:{TYPE:{get:function(){return"DoubleClickMessage"}}}}),r),l.DesignControllerPSMDelegate=(i=function(e){this.dc=e},s.defineClass({name:"DesignControllerPSMDelegate",ctor:i,statics:{_implements:function(e){return"IPSMDelegate"==e}},props:{handleEvent:function(e){var t,o,n,r;(t=s.as(e,S.PSMFormaDragControllerEvent))?this.dc.designControllerHandlesPointers?this.dc.designController.handles.handleFormaDragEvents(t):t.dragDelegate.dragController.onEvent(t):(o=s.as(e,S.BeginPointerTrackingEvent))?s.opt(o.forma.controller,(function(e){return e.onEvent(o)})):(n=s.as(e,S.FormaClickEvent))?this.dc.designControllerHandlesPointers?this.dc.designController.click.handleClick(n):s.opt(n.forma.controller,(function(e){return e.onEvent(n)})):(r=s.as(e,S.FormaDoubleClickEvent))&&(this.dc.designControllerHandlesPointers?this.dc.designController.click.handleDoubleClick(r):s.opt(r.forma.controller,(function(e){return e.onEvent(r)})))}}}),i),l.DocumentController=(a=function(){var e;this.blockNonSelectedUpdates_=!1,this.interactionMode_=l.InteractionMode.DefaultInteraction,this.pointerStateMachine_=null,this.viewScale_=1,this.designControllerHandlesPointers=!1,this.designControllerHandlesSwap=!0,this.enableMoveableChildren=!1,this.formaEventStackCounter=0,this.currentGestureActionsLogged=[],this.currentGestureScope="",this.controllerFactory_=new y.FormaControllerFactory(null),this.pointers_=new L.PointersState,this.selection_=new R.SelectionState,this.editorModel_=new m.EditorModel,this.designControllerFactory_=new p.DesignControllerFactory,this.controllerSettingsState_=new h.ControllerSettingsState,this.undoRedoMgr_=new x.UndoRedoManager(((e=s.opt(A.Host.platform,(function(e){return e.isMobile})))||null!=e)&&e?x.UndoRedoSelectionPolicyEnum.PreserveSelection:x.UndoRedoSelectionPolicyEnum.RestoreSelection),this.designController_=g.DesignController.NullController,this.saveMgr_=new _.SaveManager,D.TheoPublishingObject.call(this),this.controllerFactory_.owner=this,this.pointers_.owner=this,this.selection_.owner=this,this.editorModel_.owner=this,this.designControllerFactory_.owner=this,this.controllerSettingsState_.owner=this,this.undoRedoMgr_.owner=this,this.saveMgr_.owner=this,this.updateEditorModel(),this.selection_.subscribe(this,R.SelectionStateChangedMessage.TYPE),this.selection_.subscribe(this,R.SelectionStateModeChangedMessage.TYPE),this.pointers_.subscribe(this,L.PointersStateChangeMessage.TYPE),f.DocumentSingletonTracker.creatingDocumentSingleton(this)},s.defineClass({name:"DocumentController",ctor:a,superName:"TheoPublishingObject",statics:{_implements:function(e){return"TheoMessageSubscriber"==e||"TheoMessagePublisher"==e}},props:{controllerFactory:{get:function(){return this.controllerFactory_}},document:{get:function(){return this.doc_}},selection:{get:function(){return this.selection_}},model:{get:function(){return this.editorModel_}},designController:{get:function(){return this.designController_}},controllerSettingsState:{get:function(){return this.controllerSettingsState_}},pointers:{get:function(){return this.pointers_}},pointerStateMachine:{get:function(){return this.pointerStateMachine_}},undoRedoMgr:{get:function(){return this.undoRedoMgr_}},saveMgr:{get:function(){return this.saveMgr_}},updateEditorModel:function(){var e=this;this.designController_=this.designControllerFactory_.getNewDesignController(this.editorModel_),this.editorModel_.beginUpdates(),s.opt(this.designController_,(function(t){return t.configureEditorModel(e.editorModel_)})),this.editorModel_.updatesComplete()},onMessage:function(e){var t,o,n;e instanceof R.SelectionStateChangedMessage?(this.formaEventStackCounter=0,this.updateEditorModel()):e instanceof R.SelectionStateModeChangedMessage?this.updateEditorModel():(t=s.as(e,L.PointersStateChangeMessage))?null==this.pointerStateMachine_&&t.changeType==L.PointersStateChangeTypeEnum.PointersDown?(this.pointerStateMachine_=new b.PointerStateMachine(new v.FormaPagePointerStateMachineDelegate(new l.DesignControllerPSMDelegate(this))),this.pointerStateMachine_.attach(this,this.pointers),this.pointerStateMachine_.onMessage(t)):null!=this.pointerStateMachine_&&0==this.pointers.pointerDownCount()&&(this.pointerStateMachine_.onMessage(t),this.pointerStateMachine_.detach(),this.pointerStateMachine_=null):(o=s.as(e,C.FormaBeginUpdateMessage))?this.selection.isSelected(o.event.forma)&&(this.formaEventStackCounter+=1):(n=s.as(e,C.FormaEndUpdateMessage))?((n.event instanceof T.FormaGroupEvent||n.event instanceof T.FormaUngroupEvent)&&this.updateEditorModel(),this.selection.isSelected(n.event.forma)&&this.formaEventStackCounter>0&&(this.formaEventStackCounter-=1,0==this.formaEventStackCounter&&this.updateHandlesAndAnnotations())):e instanceof C.BeginFormaResizeMessage?s.opt(this.formaPageView,(function(e){return e.beginUserResize()})):e instanceof C.EndFormaResizeMessage&&s.opt(this.formaPageView,(function(e){return e.endUserResize()}))},notifyClick:function(e){this.publish(new l.ClickMessage(e,this))},notifyDoubleClick:function(e){this.publish(new l.DoubleClickMessage(e,this))},formaUpdateSubscription:{get:function(){return this.formaUpdateSubscription_},set:function(e){var t;(t=this.formaUpdateSubscription_)&&t.unsubscribe(),this.formaUpdateSubscription_=e}},beginFormaResizeSubscription:{get:function(){return this.beginFormaResizeSubscription_},set:function(e){s.opt(this.beginFormaResizeSubscription_,(function(e){return e.unsubscribe()})),this.beginFormaResizeSubscription_=e}},endFormaResizeSubscription:{get:function(){return this.endFormaResizeSubscription_},set:function(e){s.opt(this.endFormaResizeSubscription_,(function(e){return e.unsubscribe()})),this.endFormaResizeSubscription_=e}},formaBeginUpdateSubscription:{get:function(){return this.formaBeginUpdateSubscription_},set:function(e){s.opt(this.formaBeginUpdateSubscription_,(function(e){return e.unsubscribe()})),this.formaBeginUpdateSubscription_=e}},subscribeToPage:function(e){this.formaUpdateSubscription=e.subscribe(this,C.FormaEndUpdateMessage.TYPE),this.formaBeginUpdateSubscription=e.subscribe(this,C.FormaBeginUpdateMessage.TYPE),this.beginFormaResizeSubscription=e.subscribe(this,C.BeginFormaResizeMessage.TYPE),this.endFormaResizeSubscription=e.subscribe(this,C.EndFormaResizeMessage.TYPE)},attach:function(e){var t;this.doc_=e,this.updateEditorModel(),(t=s.opt(this.doc_,(function(e){return e.firstPage})))&&s.opt(this.designController_,(function(e){return e.activePage.set(t)})),this.undoRedoMgr_.setup()},canDoAction:function(e){return this.designController.actions.canDoAction(e)},doAction:function(e){var t=!1;this.doActionWithCompletion(e,(function(e,o){t=!0})),t||s.opt(A.Host.logging,(function(e){return e.warning("You've called doAction() which may presume the action is synchronous, but it's not. Consider using doActionWithCompletion instead.")}))},doActionWithCompletion:function(e,t){var o=null!=this.undoRedoMgr_.gestureScope,n=!1;if(o&&(this.undoRedoMgr_.gestureScope!=this.currentGestureScope&&(this.currentGestureActionsLogged=[],this.currentGestureScope=this.undoRedoMgr_.gestureScope),(n=null!=s.indexOf(this.currentGestureActionsLogged,e.type))||this.currentGestureActionsLogged.push(e.type)),e.type!=I.SetTextCollapseAction.TYPE&&e.type!=c.ApplyColorAction.TYPE&&e.type!=c.ApplyColorWithRoleAction.TYPE&&e.type!=F.SetImageFilterAction.TYPE&&e.type!=d.ModifyColorThemeAction.TYPE&&(!o||o&&!n)){var r=this.selection.asFormaArray().map((function(e){return e.kind}),this);s.opt(A.Host.logging,(function(t){return t.logToAnalytics(u.AnalyticsConstants.kAnalyticsDataActionPerformed,{contextualData2:e.type,contextualData3:"Formae Selected: ["+r.join(",")+"]"})})),s.opt(A.Host.logging,(function(t){return t.logBreadcrumbToNewRelic(e.type,{formaeInvolved:"["+r.join(",")+"]"})}))}this.designController.actions.doActionWithCallback(e,t)},allowSelectionChanges:{get:function(){return this.interactionMode_!=l.InteractionMode.SelectionFocused}},undoWithCompletion:function(e){this.undoRedoMgr.undo(e)},redoWithCompletion:function(e){this.undoRedoMgr.redo(e)},setSelectionFocusedInteraction:function(){this.interactionMode_=l.InteractionMode.SelectionFocused},inSelectionFocusedInteractionMode:{get:function(){return this.interactionMode_==l.InteractionMode.SelectionFocused}},setAutomaticLayoutInteractionMode:function(){this.interactionMode_=l.InteractionMode.AutomaticGrid},inAutomaticLayoutInteractionMode:{get:function(){return this.interactionMode_==l.InteractionMode.AutomaticGrid}},setDefaultInteractionMode:function(){this.interactionMode_=l.InteractionMode.DefaultInteraction},inDefaultInteractionMode:{get:function(){return this.interactionMode_==l.InteractionMode.DefaultInteraction}},interactionMode:{get:function(){return this.interactionMode_},set:function(e){this.interactionMode_=e}},viewScale:{get:function(){return this.viewScale_},set:function(e){this.viewScale_=e}},formaPageView:{get:function(){var e;return(e=this.doc_)?k.PagesFacade.getActivePage(e).view:null}},updateHandles:function(){var e=this;this.editorModel_.beginUpdates(),s.opt(this.designController_,(function(t){return t.handles.updateHandles(e.editorModel_.mutable.handles)})),this.editorModel_.updatesComplete()},updateAnnotations:function(){var e=this;this.editorModel_.beginUpdates(),s.opt(this.designController_,(function(t){return t.annotations.updateAnnotations(e.editorModel_.mutable.annotations)})),this.editorModel_.updatesComplete()},updateHandlesAndAnnotations:function(){var e=this;this.editorModel_.beginUpdates(),s.opt(this.designController_,(function(t){return t.handles.updateHandles(e.editorModel_.mutable.handles)})),s.opt(this.designController_,(function(t){return t.annotations.updateAnnotations(e.editorModel_.mutable.annotations)})),this.editorModel_.updatesComplete()}}}),a)},raY1:function(e,t,o){var n,r=t,i=o("oAGj"),a=o("Tq01"),l=o("CWW7"),s=o("Kkml");r.AddFormaAction=(n=function e(t,o,n){this.page=t,this.forma=o,this.params=n,a.Action.call(this,e.TYPE)},i.defineClass({name:"AddFormaAction",ctor:n,superName:"Action",statics:{TYPE:"AddFormaAction"},props:{getUserAction:function(e){return s.UserActions.AddImage()},execute:function(e){return l.CreationFacade.addForma(this.page,this.forma,this.params)}}}),n)},rrhp:function(e,t,o){var n,r,i,a,l,s=t,u=o("oAGj"),c=o("0wFF"),h=o("yGNn"),d=o("P83h"),g=o("ZhwN"),p=o("iCxV"),f=o("8vXU"),m=o("rxGp"),y=o("fNpk"),v=o("358a"),S=o("90dd"),C=o("ZoS2"),T=o("Kkml");s.IDocumentStateManager=u.defineProtocol("IDocumentStateManager",{resetStates:"() -> Void",getRootState:"() -> IDocumentState",beginNewState:"(String) -> Void",endNewState:"() -> IDocumentState",setCurrentState:"(IDocumentState) -> Void",getNewStateNestingDepth:"() -> Integer"}),s.IDocumentState=u.defineProtocol("IDocumentState",{}),s.PatchStatus=(n=function(e){this.depth=0,this.newStateBegun=e},u.defineClass({name:"PatchStatus",ctor:n}),n),s.TimelineState=(r=function(e,t){this.actionDepth=0,this.patch=null,this.beginSelectedFormaIDs=[],this.endSelectedFormaIDs=[],this.beginActivePage=null,this.endActivePage=null,this.beganInCharStyleMode=!1,this.endedInCharStyleMode=!1,this.compoundingActionWrapperEvent=null,this.branchName=null,this.action=e,this.state=t},u.defineClass({name:"TimelineState",ctor:r,props:{description:{get:function(){var e;return(e=this.branchName)||null!=e?e:u.opt(this.action,(function(e){return e.description}))}}}}),r),s.Timeline=(i=function(e,t){this.states=[],this.current=-1,void 0===e&&(e=null),void 0===t&&(t=null),this.gesture=e,this.name=t},u.defineClass({name:"Timeline",ctor:i,statics:{gesture:function(e){return new i(e,null)},branch:function(e){return new i(null,e)}},props:{currentState:{get:function(){return this.current<0||this.current>this.states.length?null:this.states[this.current]}}}}),i),s.UndoRedoChangeDirection=u.defineEnum("UndoRedoChangeDirection",{Undo:"undo",Redo:"redo"}),s.UndoRedoMessage=(a=function e(t,o,n,r){void 0===n&&(n=null),void 0===r&&(r=null),this.changeType=o,this.changeAction=n,this.changeDirection=r,S.TheoMessage.call(this,e.TYPE,t)},u.defineClass({name:"UndoRedoMessage",ctor:a,superName:"TheoMessage",statics:{TYPE:"UndoRedoMessage",UNDO_REDO_CHANGE:"state-changed",UNDO_REDO_GESTURE_BEGIN:"gesture-begin",UNDO_REDO_GESTURE_END:"gesture-end",UNDO_REDO_STATE_CLEAN:"state-clean"}}),a),s.UndoRedoSelectionPolicyEnum=u.defineEnum("UndoRedoSelectionPolicyEnum",{RestoreSelection:"restore",PreserveSelection:"preserve"}),s.UndoRedoManager=(l=function(e){this.applyingUpdatedPatchesDepth=0,this.waitingCallbacks=[],this.timeline=new s.Timeline,this.timelineStack=[],this.patches=[],this.gestureUA=null,this.lock=p.Host.async.newLock(),this.safeUndoRedoListeners={},this._lastUndoRedoListenerID=0,this._selectionPolicy=e,C.TheoPublishingObject.call(this)},u.defineClass({name:"UndoRedoManager",ctor:l,superName:"TheoPublishingObject",statics:{_implements:function(e){return"TheoMessagePublisher"==e}},props:{setup:function(){var e;(e=u.opt(this.owner,(function(e){return e.document})))&&(this.stateMgr=u.opt(p.Host.factories,(function(t){return t.constructDocumentStateManager(e)}))),this.reset()},shouldCollapseActions:function(e,t){return null!=e&&null!=t&&e.description==t.description&&e.scope==t.scope},updateSelection:function(e,t,o){var n;if(this._selectionPolicy==s.UndoRedoSelectionPolicyEnum.PreserveSelection)u.opt(this.owner,(function(e){return e.selection.removeStaleSelections(!1)})),"user-action"!=e&&"cancel-branch"!=e&&("set-index"==e&&t>o?r=(h=this.timeline.states[t]).beginActivePage:(i=this.timeline.currentState)&&(r=i.endActivePage),(a=r)&&v.PagesFacade.setActivePage(a));else{var r,i,a,l=[],c=!1;if("cancel-branch"==e)l=u.clone(u.opt(this.owner,(function(e){return e.selection.IDs}))||[]),c=!(!(n=u.opt(this.owner,(function(e){return e.selection.inCharStyleMode})))&&null==n)&&n;else if("set-index"==e&&t>o){var h=this.timeline.states[t];l=u.clone(h.beginSelectedFormaIDs),c=h.beganInCharStyleMode,r=h.beginActivePage}else(i=this.timeline.currentState)&&(l=u.clone(i.endSelectedFormaIDs),c=i.endedInCharStyleMode,r=i.endActivePage);if("set-index"==e){c=!1;for(var d=[],g=u.iter(l);!g.done;g.next()){var p,f=g.value;(p=u.opt(u.opt(this.owner,(function(e){return e.document})),(function(e){return e.formaByID(f)})))&&(p.isText()||d.push(f))}l=u.clone(d)}"user-action"!=e&&((a=r)&&v.PagesFacade.setActivePage(a),u.opt(this.owner,(function(e){return e.selection.inCharStyleMode=c})),u.opt(this.owner,(function(e){return e.selection.IDs=u.clone(l)})))}},reset:function(){u.opt(this.stateMgr,(function(e){return e.resetStates()})),this.timeline=new s.Timeline,this.timeline.states.push(new s.TimelineState(null,u.opt(this.stateMgr,(function(e){return e.getRootState()})))),this.timeline.current=0,u.opt(this.owner,(function(e){return e.saveMgr.markInitialState()})),this.publishEvent(s.UndoRedoMessage.UNDO_REDO_CHANGE),this.publishEvent(s.UndoRedoMessage.UNDO_REDO_STATE_CLEAN)},debugDescribeCurrentState:function(){var e,t,o=this.timelineStack.length>0?"[branch depth "+u.toString(this.timelineStack.length)+"] ":"";return o+="Index "+u.toString(this.timeline.current),(e=this.timeline.currentState)?(t=e.action)?o+=" ("+t.description+")":o+=" (Initial state)":o+=" (Invalid state)",o},beginBranch:function(){this.beginNamedBranch(null)},beginNamedBranch:function(e){p.Host.logging.logForCategory(m.LogCategories.kUndoMgr,"Starting new branch @ "+this.debugDescribeCurrentState(),f.LogLevelEnum.INFO_LEVEL),y.LegacyCoreAssert.isTrue(null==this.gestureScope,"Should not branch in the middle of a running gesture",void 0,"UndoRedoManager.beginNamedBranch","UndoRedoManager.swift",346),this.timelineStack.push(this.timeline);var t=s.Timeline.branch(e);t.states.push(this.timeline.currentState),t.current=0,this.timeline=t},endBranch:function(e){var t=this;if(this.timelineStack.length>0){p.Host.logging.logForCategory(m.LogCategories.kUndoMgr,(e?"Committing":"Canceling")+" branch @ "+this.debugDescribeCurrentState(),f.LogLevelEnum.INFO_LEVEL);var o=this.timelineStack.pop();if(e){var n=this.timeline.currentState,r=this.timeline.name;if(this.timeline=o,n===this.timeline.currentState);else{if(this.timeline.current<this.timeline.states.length-1){var i=this.timeline.current+1,a=this.timeline.states.length-i;this.timeline.states.splice(i,a)}u.opt(n,(function(e){return e.branchName=r})),this.timeline.states.push(n),this.timeline.current=this.timeline.states.length-1}this.publishEvent(s.UndoRedoMessage.UNDO_REDO_CHANGE)}else this.timeline=o,u.opt(this.stateMgr,(function(e){return e.setCurrentState(t.timeline.currentState.state)})),this.applyPatches((function(){t.updateSelection("cancel-branch",-1,-1),t.publishEvent(s.UndoRedoMessage.UNDO_REDO_CHANGE)}));0==this.timelineStack.length&&this.publishEvent(s.UndoRedoMessage.UNDO_REDO_STATE_CLEAN)}else y.LegacyCoreAssert.fail("endBranch: branch stack underflow",{currentState:this.debugDescribeCurrentState()},"UndoRedoManager.endBranch","UndoRedoManager.swift",406)},beginGesture:function(){if(y.LegacyCoreAssert.isTrue(null==this.gestureScope,"Beginning gesture scope when gesture already running",void 0,"UndoRedoManager.beginGesture","UndoRedoManager.swift",428),null!=this.gestureScope&&this.endGesture(!1),null==this.gestureScope){p.Host.logging.logForCategory(m.LogCategories.kUndoMgr,"Starting new gesture branch @ "+this.debugDescribeCurrentState(),f.LogLevelEnum.INFO_LEVEL),this.publishEvent(s.UndoRedoMessage.UNDO_REDO_GESTURE_BEGIN),this.timelineStack.push(this.timeline);var e=s.Timeline.gesture(g.GUIDUtils.makeGUID());e.states.push(this.timeline.currentState),e.current=0,this.timeline=e,this.gestureUA=null}},endGesture:function(e){var t,o=this;y.LegacyCoreAssert.isTrue(null!=this.gestureScope,"Ending gesture scope when no gesture running",void 0,"UndoRedoManager.endGesture","UndoRedoManager.swift",447),null!=this.gestureScope&&(p.Host.logging.logForCategory(m.LogCategories.kUndoMgr,"Ending gesture branch @ "+this.debugDescribeCurrentState(),f.LogLevelEnum.INFO_LEVEL),null!=this.gestureUA?(t=this.timeline.currentState)&&this.endActionState(t,(function(){o.endBranch(e),o.publishEvent(s.UndoRedoMessage.UNDO_REDO_GESTURE_END),o.gestureUA=null})):(this.endBranch(e),this.publishEvent(s.UndoRedoMessage.UNDO_REDO_GESTURE_END)))},gestureScope:{get:function(){return this.timeline.gesture}},gestureActionDesc:{get:function(){return u.opt(this.gestureUA,(function(e){return e.description}))}},beginUserActionAsync:function(e){var t=this;return new h.CorePromise((function(o,n){return t.beginUserAction(e,(function(){return o(null)}))}))},endUserActionAsync:function(){var e=this;return new h.CorePromise((function(t,o){return e.endUserAction((function(){return t(null)}))}))},beginUserAction:function(e,t){var o,n=this;p.Host.logging.logForCategory(m.LogCategories.kUndoMgr,"beginUserAction @ ("+e.description+")",f.LogLevelEnum.INFO_LEVEL);var r=this.timeline.currentState;if(r.actionDepth>0)y.LegacyCoreAssert.fail("Nested user action detected",{new:e.description,current:r.action.description},"UndoRedoManager.beginUserAction","UndoRedoManager.swift",513),r.actionDepth+=1,t();else{this.timeline.states.length>this.timeline.current+1&&this.timeline.states.splice(this.timeline.current+1,this.timeline.states.length-this.timeline.current-1);var i=this.shouldCollapseActions(r.action,e),a=e.collapseSequential==T.CollapseBehavior.ALWAYS||e.collapseSequential==T.CollapseBehavior.GESTURE_DEPENDENT&&null!=this.gestureScope;if(null!=this.gestureScope&&null!=this.gestureUA&&i&&a)r.actionDepth=1,t();else{var l,c=new s.TimelineState(e,null);function h(o,r){null!=n.gestureScope&&null==n.gestureUA&&(n.gestureUA=e),n.timeline.states.push(o),n.timeline.current=n.timeline.states.length-1,r?n.applyPatches((function(){o.actionDepth=1,u.opt(n.stateMgr,(function(t){return t.beginNewState(e.description)})),t()})):(o.actionDepth=1,u.opt(n.stateMgr,(function(t){return t.beginNewState(e.description)})),t())}if(c.beginSelectedFormaIDs=u.clone(u.opt(this.owner,(function(e){return e.selection.IDs}))||[]),c.beganInCharStyleMode=!(!(o=u.opt(this.owner,(function(e){return e.selection.inCharStyleMode})))&&null==o)&&o,(l=u.opt(this.owner,(function(e){return e.document})))&&(c.beginActivePage=v.PagesFacade.getActivePage(l)),!(null!=this.gestureScope&&this.timeline.current>=1)||a&&i)if((!e.compounding||a)&&i&&this.timeline.current>=1){for(var g,S=!1,C=this.timeline.current-1;C>0&&this.shouldCollapseActions(this.timeline.states[C].action,e);)C-=1;e.compounding||((g=c.beginActivePage)&&(c.compoundingActionWrapperEvent=new d.FormaNullChangedEvent(g.root),g.beginUpdate(c.compoundingActionWrapperEvent)),u.opt(this.stateMgr,(function(e){return e.setCurrentState(n.timeline.states[C].state)})),S=!0),a&&this.timeline.states.splice(C+1,1),h(c,S)}else h(c,!1);else(g=c.beginActivePage)&&(c.compoundingActionWrapperEvent=new d.FormaNullChangedEvent(g.root),g.beginUpdate(c.compoundingActionWrapperEvent)),this.endActionState(this.timeline.currentState,(function(){u.opt(n.stateMgr,(function(e){return e.setCurrentState(n.timeline.states[0].state)})),h(c,!0)}));this.notifySafeUndoRedoListeners()}}},endActionState:function(e,t){var o,n,r=this;null!=e.compoundingActionWrapperEvent&&(u.opt(e.beginActivePage,(function(t){return t.endUpdate(e.compoundingActionWrapperEvent)})),e.compoundingActionWrapperEvent=null),e.actionDepth=0,e.endSelectedFormaIDs=u.clone(u.opt(this.owner,(function(e){return e.selection.IDs}))||[]),e.endedInCharStyleMode=!(!(o=u.opt(this.owner,(function(e){return e.selection.inCharStyleMode})))&&null==o)&&o,(n=u.opt(this.owner,(function(e){return e.document})))&&(e.endActivePage=v.PagesFacade.getActivePage(n)),this.applyPatches((function(){for(;r.waitingCallbacks.length>0&&0==r.timeline.currentState.actionDepth;)r.waitingCallbacks.shift()();r.updateSelection("user-action",-1,-1),r.publishEvent(s.UndoRedoMessage.UNDO_REDO_CHANGE),r.gestureUA=null,t(),0==r.timelineStack.length&&0==r.timeline.currentState.actionDepth&&r.publishEvent(s.UndoRedoMessage.UNDO_REDO_STATE_CLEAN)}))},endUserAction:function(e){var t;(t=this.timeline.currentState)?(p.Host.logging.logForCategory(m.LogCategories.kUndoMgr,"endUserAction @ "+this.debugDescribeCurrentState(),f.LogLevelEnum.INFO_LEVEL),y.LegacyCoreAssert.isTrue(this.timeline.current>0,"first timeline entry should always be initial state, not a user action",void 0,"UndoRedoManager.endUserAction","UndoRedoManager.swift",664),y.LegacyCoreAssert.isTrue(null!=t.action,"invalid current state for ending a user action",void 0,"UndoRedoManager.endUserAction","UndoRedoManager.swift",665),0==t.actionDepth?y.LegacyCoreAssert.fail("User action stack underflow",void 0,"UndoRedoManager.endUserAction","UndoRedoManager.swift",668):t.actionDepth>1||null!=this.gestureScope&&null!=this.gestureUA?(t.actionDepth-=1,e()):this.endActionState(t,e)):y.LegacyCoreAssert.fail("invalid current state for ending a user action",void 0,"UndoRedoManager.endUserAction","UndoRedoManager.swift",687)},cancelUserAction:function(e){var t,o=this;if(t=this.timeline.currentState)if(p.Host.logging.logForCategory(m.LogCategories.kUndoMgr,"cancelUserAction @ "+this.debugDescribeCurrentState(),f.LogLevelEnum.INFO_LEVEL),y.LegacyCoreAssert.isTrue(this.timeline.current>0,"first timeline entry should always be initial state, not a user action",void 0,"UndoRedoManager.cancelUserAction","UndoRedoManager.swift",699),0==t.actionDepth)y.LegacyCoreAssert.fail("User action stack underflow",void 0,"UndoRedoManager.cancelUserAction","UndoRedoManager.swift",702);else{if(t.actionDepth>1)return y.LegacyCoreAssert.fail("Can not cancel a user action with a depth greater than 1",void 0,"UndoRedoManager.cancelUserAction","UndoRedoManager.swift",704),this.endUserAction(e);var n;t.actionDepth=0,t.endSelectedFormaIDs=u.clone(u.opt(this.owner,(function(e){return e.selection.IDs}))||[]),(n=u.opt(this.owner,(function(e){return e.document})))&&(t.endActivePage=v.PagesFacade.getActivePage(n));var r=this.getCurrentTimelineIndex(),i=r-1;t.state=u.opt(this.stateMgr,(function(e){return e.endNewState()})),this.notifySafeUndoRedoListeners(),this.setCurrentTimelineIndex(i,(function(){for(o.removeTimelineStateAtIndex(r),o.publishEvent(s.UndoRedoMessage.UNDO_REDO_CHANGE);o.waitingCallbacks.length>0&&0==o.timeline.currentState.actionDepth;)o.waitingCallbacks.shift()();o.gestureUA=null,e(),0==o.timelineStack.length&&0==o.timeline.currentState.actionDepth&&o.publishEvent(s.UndoRedoMessage.UNDO_REDO_STATE_CLEAN)}))}else y.LegacyCoreAssert.fail("invalid current state for ending a user action",void 0,"UndoRedoManager.cancelUserAction","UndoRedoManager.swift",738)},getActionDepth:function(){var e;return(e=u.opt(this.timeline.currentState,(function(e){return e.actionDepth})))||null!=e?e:0},registerPatch:function(e){this.patches.push(e)},getPatchDepth:function(){var e;return(e=u.opt(u.opt(this.timeline.currentState,(function(e){return e.patch})),(function(e){return e.depth})))||null!=e?e:-1},beginPatch:function(){var e,t;(e=this.timeline.currentState)&&((t=e.patch)?(t.newStateBegun||(u.opt(this.stateMgr,(function(e){return e.beginNewState("patch")})),t.newStateBegun=!0),t.depth+=1):y.LegacyCoreAssert.fail("Invalid beginPatch: not in a patching context.",void 0,"UndoRedoManager.beginPatch","UndoRedoManager.swift",788))},endPatch:function(){var e,t;(e=this.timeline.currentState)&&((t=e.patch)?t.depth>0?t.depth-=1:y.LegacyCoreAssert.fail("Patch stack underflow!",void 0,"UndoRedoManager.endPatch","UndoRedoManager.swift",802):y.LegacyCoreAssert.fail("Invalid beginPatch: not in a patching context.",void 0,"UndoRedoManager.endPatch","UndoRedoManager.swift",805))},invalidatePatches:function(e){var t=this;0==this.getActionDepth()&&null==this.gestureScope?(this.applyingUpdatedPatchesDepth+=1,this.applyPatches((function(){t.publishEvent("state-updated"),t.applyingUpdatedPatchesDepth-=1,0==t.timelineStack.length&&0==t.timeline.currentState.actionDepth&&t.publishEvent(s.UndoRedoMessage.UNDO_REDO_STATE_CLEAN),e()}))):e()},undo:function(e){var t,o,n=this;y.LegacyCoreAssert.isTrue(null==this.gestureScope,"Should not undo in the middle of a running gesture",void 0,"UndoRedoManager.undo","UndoRedoManager.swift",842),(o=u.opt(this.owner,(function(e){return e.document})))&&v.PagesFacade.clearPageFormaCaches(o),this.timeline.current<=0?e():(u.opt(p.Host.logging,(function(e){return e.logToAnalytics(c.AnalyticsConstants.kAnalyticsDataUndo,{contextualData2:"actionDescription:"+((t=n.getUndoDescription())||null!=t?t:"unknown")})})),this.setCurrentTimelineIndex(this.timeline.current-1,e,s.UndoRedoChangeDirection.Undo))},redo:function(e){var t,o,n=this;y.LegacyCoreAssert.isTrue(null==this.gestureScope,"Should not redo in the middle of a running gesture",void 0,"UndoRedoManager.redo","UndoRedoManager.swift",863),(o=u.opt(this.owner,(function(e){return e.document})))&&v.PagesFacade.clearPageFormaCaches(o),this.timeline.current==this.timeline.states.length-1?e():(u.opt(p.Host.logging,(function(e){return e.logToAnalytics(c.AnalyticsConstants.kAnalyticsDataRedo,{contextualData2:"actionDescription:"+((t=n.getRedoDescription())||null!=t?t:"unknown")})})),this.setCurrentTimelineIndex(this.timeline.current+1,e,s.UndoRedoChangeDirection.Redo))},canShowUndoRedoUI:function(e){var t=this;u.opt(this.lock,(function(o){return o.runInLock((function(){var o=t.timeline.states.reduce((function(e,t){return e&&null!=t.state}),!0);e(t.timeline.current>0&&o,t.timeline.current<t.timeline.states.length-1&&o,o)}))}))},addSafeUndoRedoListener:function(e){return this._lastUndoRedoListenerID+=1,this.safeUndoRedoListeners[this._lastUndoRedoListenerID]=e,this._lastUndoRedoListenerID},removeSafeUndoRedoListener:function(e){u.removeKey(this.safeUndoRedoListeners,e)},notifySafeUndoRedoListeners:function(){for(var e=u.iter(u.values(this.safeUndoRedoListeners));!e.done;e.next())(0,e.value)()},getUndoDescription:function(){return this.timeline.current<=0?null:u.opt(this.timeline.currentState,(function(e){return e.description}))},getRedoDescription:function(){return this.timeline.current==this.timeline.states.length-1?null:this.timeline.states[this.timeline.current+1].description},applyPatches:function(e){var t,o=this,n=this.timeline.states[this.timeline.current];y.LegacyCoreAssert.isTrue(null==n.patch,"applying patches before previous patch context is finished!",void 0,"UndoRedoManager.applyPatches","UndoRedoManager.swift",958),y.LegacyCoreAssert.isTrue(0==n.actionDepth,"should not apply patches while user action still mutating",void 0,"UndoRedoManager.applyPatches","UndoRedoManager.swift",959),n.patch=new s.PatchStatus(((t=u.opt(this.stateMgr,(function(e){return e.getNewStateNestingDepth()})))||null!=t?t:0)>0),function e(t,r){t>=o.patches.length?r():(n!==o.timeline.states[o.timeline.current]&&u.opt(p.Host.logging,(function(e){return e.warning("unexpected change of timeline during patching")})),y.LegacyCoreAssert.isTrue(null!=n.patch&&0==n.patch.depth,"unexpected state between patches",void 0,"UndoRedoManager.applyPatches","UndoRedoManager.swift",971),o.patches[t]((function(){return e(t+1,r)})))}(0,(function(){n!==o.timeline.currentState&&u.opt(p.Host.logging,(function(e){return e.warning("unexpected change of timeline during patching")})),n.patch.newStateBegun&&(n.state=u.opt(o.stateMgr,(function(e){return e.endNewState()})),o.notifySafeUndoRedoListeners()),n.patch=null,e()}))},getTimelineLength:function(){return this.timeline.states.length},getCurrentTimelineState:function(){return this.timeline.currentState},getCurrentTimelineIndex:function(){return this.timeline.current},getTimelineStateAtIndex:function(e){return y.LegacyCoreAssert.isTrue(e>=0&&e<this.timeline.states.length,"getTimelineStateAtIndex: index out of range",void 0,"UndoRedoManager.getTimelineStateAtIndex","UndoRedoManager.swift",1019),this.timeline.states[e]},publishUndoEvent:function(e){var t;((t=u.opt(u.opt(this.owner,(function(e){return e.document})),(function(e){return e.documentInited})))||null!=t)&&t&&(this.publish(new s.UndoRedoMessage(this,s.UndoRedoMessage.UNDO_REDO_CHANGE,e,s.UndoRedoChangeDirection.Undo)),this.publishEvent(s.UndoRedoMessage.UNDO_REDO_STATE_CLEAN))},publishRedoEvent:function(e){var t;((t=u.opt(u.opt(this.owner,(function(e){return e.document})),(function(e){return e.documentInited})))||null!=t)&&t&&(this.publish(new s.UndoRedoMessage(this,s.UndoRedoMessage.UNDO_REDO_CHANGE,e,s.UndoRedoChangeDirection.Redo)),this.publishEvent(s.UndoRedoMessage.UNDO_REDO_STATE_CLEAN))},publishEvent:function(e){var t;(e!=s.UndoRedoMessage.UNDO_REDO_CHANGE||((t=u.opt(u.opt(this.owner,(function(e){return e.document})),(function(e){return e.documentInited})))||null!=t)&&t)&&this.publish(new s.UndoRedoMessage(this,e))},removeTimelineStateAtIndex:function(e){y.LegacyCoreAssert.isTrue(e>0,"removeStateAtIndex: should not remove the initial state!",void 0,"UndoRedoManager.removeTimelineStateAtIndex","UndoRedoManager.swift",1053),y.LegacyCoreAssert.isTrue(e!=this.timeline.current,"removeStateAtIndex: should not remove the current state!",void 0,"UndoRedoManager.removeTimelineStateAtIndex","UndoRedoManager.swift",1054),y.LegacyCoreAssert.isTrue(e>=0&&e<this.timeline.states.length,"removeStateAtIndex: index out of range",void 0,"UndoRedoManager.removeTimelineStateAtIndex","UndoRedoManager.swift",1055),e>0&&e<this.timeline.states.length&&(this.timeline.states.splice(e,1),e<this.timeline.current&&(this.timeline.current-=1),this.publishEvent("timeline-changed"))},setCurrentTimelineIndex:function(e,t,o){void 0===o&&(o=null);var n,r=this,i=o==s.UndoRedoChangeDirection.Undo,a=o==s.UndoRedoChangeDirection.Redo;if(p.Host.logging.logForCategory(m.LogCategories.kUndoMgr,"setting timeline index to "+u.toString(e)+" @ "+this.debugDescribeCurrentState(),f.LogLevelEnum.INFO_LEVEL),e!=this.timeline.current&&e>=0&&e<this.timeline.states.length){var l=u.opt(this.timeline.currentState,(function(e){return e.action})),c=this.timeline.current;this.timeline.current=e;var h=u.opt(this.timeline.currentState,(function(e){return e.action}));return u.opt(this.stateMgr,(function(e){return e.setCurrentState(r.timeline.currentState.state)})),this.applyPatches((function(){r.updateSelection("set-index",c,e),i?r.publishUndoEvent(l):a?r.publishRedoEvent(h):r.publishEvent(s.UndoRedoMessage.UNDO_REDO_CHANGE),t()}))}t(),(n=u.opt(this.owner,(function(e){return e.document})))&&v.PagesFacade.clearPageFormaCaches(n)},whenNoCurrentAction:function(e){0==this.timeline.currentState.actionDepth?e():this.waitingCallbacks.push(e)},currentlyExecutingAction:function(){var e;return null!=this.gestureScope||!!(e=this.timeline.currentState)&&(this.getActionDepth()>0||null!=e.patch)},establishSelectionStates:function(){var e,t=this;u.opt(this.timeline.currentState,(function(e){return e.endSelectedFormaIDs=u.clone(u.opt(t.owner,(function(e){return e.selection.IDs}))||[])})),(e=u.opt(this.owner,(function(e){return e.document})))&&u.opt(this.timeline.currentState,(function(t){return t.endActivePage=v.PagesFacade.getActivePage(e)}))}}}),l)},rsKm:function(e,t,o){var n,r,i,a=t,l=o("oAGj"),s=o("Tq01"),u=o("yGNn"),c=o("gBh/"),h=o("c+uM"),d=o("358a"),g=o("8t9B"),p=o("Kkml");a.ApplyColorThemeAction=(n=function e(t,o,n,r){void 0===r&&(r=!1),this.themeColors=l.clone(t),this.themeID=o,this.doShuffle=r,this.pages=l.clone(n),s.Action.call(this,e.TYPE)},l.defineClass({name:"ApplyColorThemeAction",ctor:n,superName:"Action",statics:{TYPE:"ApplyColorThemeAction"},props:{getUserAction:function(e){var t=d.PagesFacade.getScopeIdentifier(this.pages);return this.doShuffle?p.UserActions.ShuffleColorTheme():p.UserActions.SetColorTheme(t)},execute:function(e){for(var t=l.iter(this.pages);!t.done;t.next()){var o=t.value;c.ColorThemeFacade.applyColorTheme(this.themeColors,this.themeID,o)}return this.doShuffle&&c.ColorThemeFacade.shuffleColorTheme(this.pages),u.CorePromise.resolve(new s.ActionResult)}}}),n),a.ShuffleColorThemeAction=(r=function e(t){this.pages=l.clone(t),s.Action.call(this,e.TYPE)},l.defineClass({name:"ShuffleColorThemeAction",ctor:r,superName:"Action",statics:{TYPE:"ShuffleColorThemeAction"},props:{getUserAction:function(e){return p.UserActions.ShuffleColorTheme()},execute:function(e){return c.ColorThemeFacade.shuffleColorTheme(this.pages),u.CorePromise.resolve(new s.ActionResult)}}}),r),a.ModifyColorThemeAction=(i=function e(t,o,n){this.color=t,this.key=o,this.pages=l.clone(n),s.Action.call(this,e.TYPE)},l.defineClass({name:"ModifyColorThemeAction",ctor:i,superName:"Action",statics:{TYPE:"ModifyColorThemeAction"},props:{getUserAction:function(e){return p.UserActions.ModifyColorTheme()},execute:function(e){for(var t=this,o=l.iter(this.pages);!o.done;o.next()){var n=o.value;c.ColorThemeFacade.modifyColorTheme(this.color,this.key,n),n.root.filterByControllerKind(g.TypeLockupController.KIND).forEach((function(e){var o;if(o=l.opt(l.as(e.style,h.LockupStyle),(function(e){return e.characterStyles.Highlight}))){var n=!1;o.colors.forEachColor((function(o,r,i){r!=t.key||n||(l.opt(e.controller,(function(e){return e.styleChanged()})),n=!0)}))}}))}return u.CorePromise.resolve(new s.ActionResult)}}}),i)},sTUO:function(e,t,o){var n,r,i=t,a=o("oAGj"),l=o("Tq01"),s=o("yGNn"),u=o("MYNe"),c=o("Kkml");i.ChangeZOrderAction=(n=function e(t){this.zIndex=t,l.Action.call(this,e.TYPE)},a.defineClass({name:"ChangeZOrderAction",ctor:n,superName:"Action",statics:{TYPE:"ChangeZOrderAction"},props:{getUserAction:function(e){return c.UserActions.ChangeZOrder()},execute:function(e){var t=e.selection.formaAt(0);return u.LayerFacade.setZOrder(this.zIndex,t),s.CorePromise.resolve(null)}}}),n),i.SendForwardBackwardAction=(r=function e(t,o){this.direction=t,this.formae=a.clone(o),l.Action.call(this,e.TYPE)},a.defineClass({name:"SendForwardBackwardAction",ctor:r,superName:"Action",statics:{TYPE:"SendForwardBackwardAction"},props:{getUserAction:function(e){return c.UserActions.SendForwardBackward()},execute:function(e){u.LayerFacade.sortInZOrder(this.formae);var t=a.clone(u.LayerFacade.sortInZOrder(e.selection.asFormaArray()));this.direction!=u.ZOrderEnum.Back&&this.direction!=u.ZOrderEnum.Forward||(this.formae=a.reverse(this.formae));for(var o=a.iter(this.formae);!o.done;o.next()){var n,r=o.value,i=u.LayerFacade.getZOrder(r),l=u.LayerFacade.getMinLayerIndex(r);if(null!=(n=a.opt(r.controller,(function(e){return e.getReorderableLayerCount()}))))switch(this.formae.length<t.length&&(this.direction==u.ZOrderEnum.Front?n-=t.length-this.formae.length:this.direction==u.ZOrderEnum.Back&&(l+=t.length-this.formae.length)),this.direction){case"forward":i<n+l-1&&u.LayerFacade.setZOrder(i+1,r);break;case"backward":i!=l&&u.LayerFacade.setZOrder(i-1,r);break;case"front":i!=n+l-1&&u.LayerFacade.setZOrder(n+l-1,r);break;case"back":i!=l&&u.LayerFacade.setZOrder(l,r)}}return s.CorePromise.resolve(null)}}}),r)},t1qz:function(e,t,o){var n,r,i=t,a=o("oAGj"),l=o("FNB+"),s=o("cmoc"),u=o("iCxV"),c=o("1HsO"),h=o("fNpk"),d=o("c+uM"),g=o("tGKA"),p=o("8t9B");i.StandardHandleGenerator=(n=function(){},r={},a.defineClass({name:"StandardHandleGenerator",ctor:n,statics:{instance:{get:function(){return void 0===r.instance&&(r.instance=new n),r.instance}},_implements:function(e){return"IHandleGenerator"==e}},props:{addHandles:function(e){var t,o;if(o=a.opt(e.dc,(function(e){return e.selection}))){var n=a.clone(o.asFormaArray());return 0==n.length?this.handleNoSelectionCase(e):o.inCharStyleMode?this.handleCharStyleSelectionCase(e,n):1==n.length?o.inCropMode||!(t=a.opt(n[0].controller,(function(e){return e.userGroupMember})))&&null==t||!t?this.handleSingleSelectionCase(e,n[0]):this.handleGroupSelectionCase(e,n[0]):this.handleMultiSelectionCase(e,n)}return[]},handleNoSelectionCase:function(e){return[]},handleSingleSelectionCase:function(e,t){var o,n,r,i,u,h,g,f=[];if((h=t.controller)&&(g=t.bounds)){var m=[],y=[];h.moveable&&(m.push(c.TransformType.Translate),t.isShape()&&!t.hasIntent(l.Forma.INTENT_ICON)||y.push(c.BoxHandleDisplayHint.ThinOutline));var v,S=!(!(o=a.opt(h.owner,(function(e){return e.selection.inSpacingMode})))&&null==o)&&o;t.isTypeLockup()&&(y.push(c.BoxHandleDisplayHint.TextFrame),(v=a.as(h,p.TypeLockupController))&&(v.text.length>300&&y.push(c.BoxHandleDisplayHint.SuppressResizeAnimation),d.LockupStyle.isKnockoutLook(v.lockupStyle.textLook)&&y.push(c.BoxHandleDisplayHint.SuppressResizeAnimation))),t.isShape()&&y.push(c.BoxHandleDisplayHint.Shape);var C=!(!(n=a.opt(h.owner,(function(e){return e.selection.inCropMode})))&&null==n)&&n;if(C&&y.push(c.BoxHandleDisplayHint.CropMode),!h.rotateable||S||C||(m.push(c.TransformType.RotateAboutCenter),t instanceof s.FrameForma&&!h.moveable&&y.push(c.BoxHandleDisplayHint.SuppressRotationHandle)),!h.userGroupChild||((r=a.opt(h.owner,(function(e){return e.enableMoveableChildren})))||null!=r)&&r){if(h.floating&&!t.isGridCell()){m.push(c.TransformType.TopLeftCornerTranslate);var T=a.as(t.style,d.LockupStyle),A=(i=a.opt(T,(function(e){return e.layout})))||null!=i?i:d.LockupLayout.Standard;null==T||!S||d.LockupStyle.isPath(A)||d.LockupStyle.isAutoLayout(A)?(m.push(c.TransformType.TopRightCornerTranslate),m.push(c.TransformType.BottomLeftCornerTranslate),m.push(c.TransformType.BottomRightCornerTranslate),((u=a.opt(a.as(h,p.TypeLockupController),(function(e){return e.canResizeHorizontally})))||null!=u)&&u&&(m.push(c.TransformType.LeftSideTranslate),m.push(c.TransformType.RightSideTranslate),a.opt(T,(function(e){return e.alignment==d.LockupAlignment.Right}))&&y.push(c.BoxHandleDisplayHint.PreferLeftSideHandle))):(m.push(c.TransformType.LetterSpacing),m.push(c.TransformType.LineSpacing))}for(var F=a.iter(h.visibleSelectionHandlePositions);!F.done;F.next()){var k=F.value;.5==k.x?0==k.y?m.push(c.TransformType.TopSideTranslate):m.push(c.TransformType.BottomSideTranslate):.5==k.y&&(0==k.x?m.push(c.TransformType.LeftSideTranslate):m.push(c.TransformType.RightSideTranslate))}}f.push(new c.BoxTransformHandles(new c.BoxReference(t.totalPlacement,g),m,y,e.activeTransform,t.formaID))}return f},handleGroupSelectionCase:function(e,t){var o,n,r,i,l=[];if((r=t.controller)&&(i=t.bounds)){var s=[c.TransformType.RotateAboutCenter,c.TransformType.TopLeftCornerTranslate,c.TransformType.TopRightCornerTranslate,c.TransformType.BottomLeftCornerTranslate,c.TransformType.BottomRightCornerTranslate];if(h.LegacyCoreAssert.isTrue(r.userGroupMember,"asked for group handles when selected forma is not a group member",void 0,"StandardHandleGenerator.handleGroupSelectionCase","StandardHandleGenerator.swift",176),r.userGroupChild){var g=!(!(o=a.opt(e.dc,(function(e){return e.enableMoveableChildren})))&&null==o)&&o,f=[];g?(f.push(c.BoxHandleDisplayHint.ThinOutline),r.userGroup&&f.push(c.BoxHandleDisplayHint.GroupOutlineColor)):(f.push(c.BoxHandleDisplayHint.SuppressTranslationHandle),f.push(c.BoxHandleDisplayHint.WideOutline));var m,y,v,S=a.clone(g?s:[c.TransformType.Translate]);if(m=a.as(r,p.TypeLockupController)){f.push(c.BoxHandleDisplayHint.TextFrame);var C=!(!(n=a.opt(r.owner,(function(e){return e.selection.inSpacingMode})))&&null==n)&&n;g&&!C&&m.canResizeHorizontally&&(S.push(c.TransformType.LeftSideTranslate),S.push(c.TransformType.RightSideTranslate),a.opt(a.as(t.style,d.LockupStyle),(function(e){return e.alignment==d.LockupAlignment.Right}))&&f.push(c.BoxHandleDisplayHint.PreferLeftSideHandle))}if(l.push(new c.BoxTransformHandles(new c.BoxReference(t.totalPlacement,i),S,f,e.activeTransform,t.formaID)),(y=g?t.parent:r.userGroupRoot)&&(v=y.bounds)){var T=[c.BoxHandleDisplayHint.GroupOutlineColor];g?T.push(c.BoxHandleDisplayHint.WideOutline):(T.push(c.BoxHandleDisplayHint.SuppressTranslationHandle),T.push(c.BoxHandleDisplayHint.ThinOutline),v=v.outsetXY(8,8)),l.splice(0,0,new c.BoxTransformMultipleFormae(new c.BoxReference(y.totalPlacement,v),g?[]:s,T,e.activeTransform,u.Host.platform.isIOS?t.formaID:y.formaID,[y.formaID]))}}else l.push(new c.BoxTransformMultipleFormae(new c.BoxReference(t.totalPlacement,i),s,[c.BoxHandleDisplayHint.ThinOutline,c.BoxHandleDisplayHint.GroupOutlineColor],e.activeTransform,t.formaID,[t.formaID]))}return l},handleMultiSelectionCase:function(e,t){var o=[],n=[];n.push(c.BoxHandleDisplayHint.ThinOutline);for(var r=[],i=null,s=a.iter(t);!s.done;s.next()){var u=s.value,h=u.finalFrame,d=u.formaID;if(i=null==i?h:i.unionWith(h),u.hasIntent(l.Forma.INTENT_INFERRED_TEMP_GROUP)){i=u.finalFrame;break}r.includes(d)||r.push(d)}if(a.sortInPlace(r),null==i)return[];var p=[c.TransformType.Translate,c.TransformType.TopLeftCornerTranslate,c.TransformType.TopRightCornerTranslate,c.TransformType.BottomLeftCornerTranslate,c.TransformType.BottomRightCornerTranslate];return o.push(new c.BoxTransformMultipleFormae(new c.BoxReference(g.Matrix2D.Identity,i),p,n,e.activeTransform,r.reduce((function(e,t){return e+"/"+t}),""),r)),o},handleCharStyleSelectionCase:function(e,t){return[]}}}),n)},taeg:function(e,t,o){var n,r,i=t,a=o("oAGj"),l=o("iCxV"),s=o("txj3"),u=o("nrTo"),c=o("7Ta2"),h=o("ThKb");i.RoleSuggesterMLP=(n=function(){},r={},a.defineClass({name:"RoleSuggesterMLP",ctor:n,statics:{cache:{get:function(){var e;return void 0===r.cache&&(r.cache=((e=a.opt(l.Host.platform,(function(e){return e.isService})))||null!=e)&&e?a.opt(l.Host.learning,(function(e){return e.getHostPredictionCache()})):new u.PredictionCacheInferredRole),r.cache},set:function(e){r.cache=e}},_implements:function(e){return"RoleSuggesterProtocol"==e}},props:{getRoleModel:function(){return null},getRole:function(e){var t,o,r=a.clone(c.InferredRole.init_84d1()),i=e.getUniqueKey();if(null==n.cache.getCacheValue(i)){var l,u=0,d="",g=0,p="";if(l=this.getRoleModel()){var f,m=a.clone(e.getFeatureVector()),y=a.clone(m),v=new h.TheoMatrix([y]).subtract(l.featureScalingMean).divide(l.featureScalingStd),S=new s.NNMLPClassifier(l.coefficients,l.intercepts,l.finalSoftmax).predict(v.transpose()),C=a.clone(S.transpose().asArray);f=a.clone(l.roles);for(var T={},A=a.iter(a.toSequence(C[0]));!A.done;A.next()){var F=A.value,k=F.offset,L=F.element;T[f[k]]=L,L>u?(g=u,p=d,u=L,d=f[k]):L>g&&(g=L,p=f[k])}}var b=(t=c.InferredRoleType.toCaseValue(d))||null!=t?t:c.InferredRoleType.Undefined,_=(o=c.InferredRoleType.toCaseValue(p))||null!=o?o:c.InferredRoleType.Undefined;r=a.clone(c.InferredRole.init_84d1(b,u,_,g)),n.cache.setCacheValue(i,r)}return n.cache.getCacheValue(i)}}}),n)},"u+mS":function(e,t,o){var n,r,i,a,l,s=t,u=o("oAGj"),c=o("Tq01"),h=o("mD2h"),d=o("pjjd"),g=o("wNKJ"),p=o("FNB+"),f=o("Pil/"),m=o("cmoc"),y=o("H1Z2"),v=o("hsXA"),S=o("lmwz"),C=o("D89E");s.IDragHandler=u.defineProtocol("IDragHandler",{handleFormaDragEvents:"(PSMFormaDragControllerEvent) -> Void"}),s.NullDragHandler=(n=function(){},r={},u.defineClass({name:"NullDragHandler",ctor:n,statics:{instance:{get:function(){return void 0===r.instance&&(r.instance=new n),r.instance}},_implements:function(e){return"IDragHandler"==e}},props:{handleFormaDragEvents:function(e){},isDragging:function(){return!1}}}),n),s.DragFacadeBasedDragHandler=(i=function(e,t,o){this.dragging=!1,this.swappableFormae=[],this.swapTargetForma=null,this.inSwapMode=!1,this.originalPlacement=null,this.swapModeHandleGenerator=new C.SwapModeHandleGenerator,this.originalHandleGenerators=[],this.dc=e,this.model=t,this.delegate=o},u.defineClass({name:"DragFacadeBasedDragHandler",ctor:i,statics:{_implements:function(e){return"IDragHandler"==e}},props:{updateHandles:function(){var e,t;(e=this.model)&&(t=this.delegate)&&(e.beginUpdates(),t.handles.updateHandles(e.mutable.handles),e.updatesComplete())},handleFormaDragEvents:function(e){var t,o,n,r,i,a,l,s=this;if((o=this.dc)&&(n=this.model)&&(r=this.delegate))if(i=u.as(e,f.BeginFormaDragEvent)){(b=u.as(r.handles,v.BaseHandlesHandler))&&(this.originalHandleGenerators=u.clone(b.handleGenerators)),this.swappableFormae=u.clone(g.DragFacade.getSwappableFormae(i)),null!=u.first(e.dragDelegate.draggedFormae)&&(this.originalPlacement=u.opt(u.first(e.dragDelegate.draggedFormae),(function(e){return e.placement}))),o.undoRedoMgr.beginBranch();var m=u.clone(e.dragDelegate.draggedFormae),S=m.filter((function(e){return u.opt(e.controller,(function(e){return 1==e.duplicatable}))}),this).length>0;1==e.dragDelegate.modifierKeys.alt&&1==S&&o.doAction(new d.DuplicateAction(m,!1,!1,!0)),o.undoRedoMgr.beginGesture();var C=u.opt(o.document,(function(e){return e.beginTransaction("begin_forma_drag")}));g.DragFacade.processBeginFormaDrag(i),u.opt(C,(function(e){return e.end()})),this.updateHandles()}else if(a=u.as(e,f.FormaDragEvent)){if(null==(_=this.getDraggedFormaForEvent(e)))return;var T=this.swapTargetForma;if(o.designControllerHandlesSwap&&((t=u.opt(u.opt(_,(function(e){return e.controller})),(function(e){return e.floating})))||null!=t)&&!t){var A=u.opt(o.document,(function(e){return e.beginTransaction("enter_swap_mode")})),F=g.DragFacade.getSwapState(a,this.swappableFormae,T,this.inSwapMode,this.originalPlacement),k=F[0],L=F[1];this.inSwapMode=k,this.swapTargetForma=L,u.opt(A,(function(e){return e.end()}))}if(!u.eq(p._equality_Forma_Forma,this.swapTargetForma,T)){var b=u.as(r.handles,v.BaseHandlesHandler);u.opt(b,(function(e){return e.clearHandleGenerators()})),null==this.swapTargetForma||u.eq(p._equality_Forma_Forma,this.swapTargetForma,_)?(u.opt(b,(function(e){return e.removeHandleGenerator(s.swapModeHandleGenerator)})),this.swapModeHandleGenerator.clearSwapTargetForma()):(u.opt(b,(function(e){return e.addHandleGenerator(s.swapModeHandleGenerator)})),this.swapModeHandleGenerator.setSwapTargetForma(this.swapTargetForma))}this.inSwapMode||o.doActionWithCompletion(new y.DragAction(a,null),(function(e,t){var o,r;(o=u.as(e,c.DragActionResult))&&(r=o.snapLines)&&(n.beginUpdates(),n.mutable.snapLines.setAll(r),n.updatesComplete())})),this.inSwapMode&&(n.beginUpdates(),n.mutable.activeSwap.setActive(new h.ActiveSwap(_,a.drag.pointers[0].currentLocation)),n.updatesComplete()),this.updateHandles()}else if(l=u.as(e,f.EndFormaDragEvent)){n.beginUpdates(),n.mutable.snapLines.clear(),n.updatesComplete();var _=this.getDraggedFormaForEvent(e);if(this.inSwapMode){if(b=u.as(r.handles,v.BaseHandlesHandler)){b.clearHandleGenerators();for(var R=u.iter(this.originalHandleGenerators);!R.done;R.next()){var I=R.value;b.addHandleGenerator(I)}}if(n.beginUpdates(),n.mutable.activeSwap.setActive(new h.ActiveSwap(null,null)),n.updatesComplete(),null==_)return o.selection.clearSelection(),this.updateHandles(),this.swapTargetForma=null,this.inSwapMode=!1,this.originalPlacement=null,o.undoRedoMgr.endGesture(!1),void o.undoRedoMgr.endBranch(!1);null==this.swapTargetForma||u.eq(p._equality_Forma_Forma,this.swapTargetForma,_)?(o.selection.replaceSelection(_),this.updateHandles(),this.swapTargetForma=null,this.inSwapMode=!1,this.originalPlacement=null,o.undoRedoMgr.endGesture(!1),o.undoRedoMgr.endBranch(!1)):o.doActionWithCompletion(new y.DragAction(l,this.swapTargetForma),(function(e,t){o.selection.replaceSelection(_),s.updateHandles(),s.swapTargetForma=null,s.inSwapMode=!1,s.originalPlacement=null,o.undoRedoMgr.endGesture(!0),o.undoRedoMgr.endBranch(!0)}))}else o.doActionWithCompletion(new y.DragAction(l,null),(function(e,t){s.updateHandles(),s.swapTargetForma=null,s.inSwapMode=!1,s.originalPlacement=null,o.undoRedoMgr.endGesture(!0),o.undoRedoMgr.endBranch(!0)}))}},getDraggedFormaForEvent:function(e){var t,o;return 0==!e.dragDelegate.draggedFormae.length&&(o=u.first(e.dragDelegate.draggedFormae),((t=u.opt(o,(function(e){return e.isImage()})))||null!=t)&&t&&(o=u.opt(o,(function(e){return e.parent})))),o}}}),i),s.CroppingDragFacadeBasedDragHandler=(a=function(e,t,o){s.DragFacadeBasedDragHandler.call(this,e,t,o)},u.defineClass({name:"CroppingDragFacadeBasedDragHandler",ctor:a,superName:"DragFacadeBasedDragHandler",statics:{_implements:function(e){return"IDragHandler"==e}},props:{getDraggedFormaForEvent:function(e){var t,o=s.DragFacadeBasedDragHandler.prototype.getDraggedFormaForEvent.call(this,e);return u.opt(o,(function(e){return e.kind==m.FrameForma.KIND}))&&(t=S.ImageFacade.getImageFormaForForma(o))&&(o=t),o}}}),a),s.MultiObjectDragHandler=(l=function(e,t,o){this.startPlacements={},this.basePlacements={},this.dragging=!1,this.dc=e,this.model=t,this.delegate=o},u.defineClass({name:"MultiObjectDragHandler",ctor:l,statics:{_implements:function(e){return"IDragHandler"==e}},props:{updateHandles:function(){var e,t;(e=this.model)&&(t=this.delegate)&&(e.beginUpdates(),t.handles.updateHandles(e.mutable.handles),e.updatesComplete())},handleFormaDragEvents:function(e){var t,o,n,r,i,a=this;if((t=this.dc)&&(o=this.model))if(n=u.as(e,f.BeginFormaDragEvent)){for(var l=u.clone(e.dragDelegate.draggedFormae),s=!0,h=u.iter(l);!h.done;h.next()){var p=h.value;u.opt(p.controller,(function(e){return 0==e.duplicatable}))&&(s=!1)}t.undoRedoMgr.beginBranch(),1==e.dragDelegate.modifierKeys.alt&&1==s&&t.doAction(new d.DuplicateAction(l,!1,!1,!0));var m=u.opt(t.document,(function(e){return e.beginTransaction("begin_multiselect_forma_drag")}));g.DragFacade.processBeginFormaDrag(n),u.opt(m,(function(e){return e.end()})),t.undoRedoMgr.beginGesture(),this.updateHandles()}else(r=u.as(e,f.FormaDragEvent))?t.doActionWithCompletion(new y.DragAction(r,null),(function(e,t){var n,r;(n=u.as(e,c.DragActionResult))&&(r=n.snapLines)&&(o.beginUpdates(),o.mutable.snapLines.setAll(r),o.updatesComplete(),a.updateHandles())})):(i=u.as(e,f.EndFormaDragEvent))&&(o.beginUpdates(),o.mutable.snapLines.clear(),o.updatesComplete(),t.doActionWithCompletion(new y.DragAction(i,null),(function(e,o){a.updateHandles(),t.undoRedoMgr.endGesture(!0),t.undoRedoMgr.endBranch(!0)})),this.updateHandles())},isDragging:function(){return this.dragging}}}),l)},"uxH+":function(e,t,o){var n,r=t,i=o("oAGj"),a=o("yhkb"),l=o("AVHO"),s=o("ascj"),u=o("FNB+"),c=o("cmoc"),h=o("9Lk3"),d=o("ZK0l"),g=o("pnSN"),p=o("fdtz"),f=o("fNpk"),m=o("8t9B"),y=o("3UhB");r.RootController=(n=function(e,t,o){d.GroupController.call(this,e,t,o)},i.defineClass({name:"RootController",ctor:n,superName:"GroupController",statics:{KIND:{get:function(){return"root"}}},props:{selectable:{get:function(){return!0}},moveable:{get:function(){return!1}},deleteable:{get:function(){return!1}},flippable:{get:function(){return!1}},nudgeable:{get:function(){return!1}},replaceable:{get:function(){var e=i.clone(this.forma.filterByControllerKind(h.GridController.KIND)),t=i.clone(this.forma.filterWithCallback((function(e){return e.isBackgroundImage()})));return 0==e.length&&0==t.length}},processFormaDoubleClick:function(e){this.owner.controllerSettingsState.settings=new l.RootControllerSettings(this)},getSuggestableColors:function(){for(var e=i.clone(d.GroupController.prototype.getSuggestableColors.call(this)),t=i.iter(this.forma.filterWithCallback((function(e){return e.isTypeLockup()})));!t.done;t.next()){var o,n=t.value;if(o=i.as(n.controller,m.TypeLockupController)){var r=o.lockupStyle.colors.fieldPrimary;if(o.textBacked&&(r=o.lockupStyle.colors.fieldSecondary),null!=r){for(var a=[],l=i.iter(e);!l.done;l.next()){var s=l.value;s[0].rgbColor.contrasts(r,!1)&&a.push(s)}return a}}}return e},suggestTransparentBackground:function(){var e=i.clone(y.TypeLockupUtils.getFullCanvasLockups(this.forma));if(e.length>0&&i.opt(e[0].lockupStyle,(function(e){return 1==e.backingOpacity})))return!0;var t,o=this.forma.filterWithCallback((function(e){var t,o;return!(!(t=i.as(e,p.ImageForma))||!(o=i.as(e.parent,c.FrameForma)))&&!t.hasAlpha()&&o.isBackgroundImage()})).length,n=1,r=i.clone(this.forma.filterByControllerKind(h.GridController.KIND));return!(r.length>0&&(t=i.as(r[0].controller,h.GridController))&&(n=t.gridStyle.gridCells.length,t.margin>.01))&&(0==o&&1==n)},setBackgroundTransparency:function(e){var t=this;i.opt(this.forma,(function(o){return o.style.colors.fieldPrimary=i.opt(i.opt(t.forma,(function(e){return e.style.colors.fieldPrimary})),(function(t){return t.withAlphaOf(e)}))}));for(var o=i.iter(this.forma.filterWithCallback((function(e){return h.GridController.isBackgroundColoredCell(e)})));!o.done;o.next())o.value.style.opacity=e},getBackgroundTransparency:function(){var e;return(e=i.opt(i.opt(this.forma,(function(e){return e.style.colors.fieldPrimary})),(function(e){return e.alpha})))||null!=e?e:1},createGridControllerIfNone:function(){var e=i.clone(this.forma.filterByControllerKind(h.GridController.KIND));return 0==e.length&&(this.applyGridStyle(this.owner.document.gridLibrary.basicFullDesignGridStyle()),e=i.clone(this.forma.filterByControllerKind(h.GridController.KIND))),e.length>0?i.as(e[0].controller,h.GridController):null},getGridController:function(){var e=i.clone(this.forma.filterByControllerKind(h.GridController.KIND));return e.length>0?i.as(e[0].controller,h.GridController):null},applyGridStyle:function(e,t){void 0===t&&(t=0);var o=i.clone(this.forma.filterByControllerKind(h.GridController.KIND));o.length>1&&f.LegacyCoreAssert.fail("can't have more than one grid at the moment",void 0,"RootController.applyGridStyle","RootController.swift",163);var n=null,r=!1;if(0==o.length){var l=this.forma.root.page.createFormaWithController(g.GroupForma.KIND,h.GridController.KIND);l.applyStyle(this.owner.document.gridLibrary.basicFullDesignGridStyle()),this.forma.insertChildAt(l,0),n=i.as(l.controller,h.GridController),f.LegacyCoreAssert.isTrue(i.opt(i.opt(n,(function(e){return e.gridStyle})),(function(e){return 1==e.gridCells.length})),"Created a brand new grid controller. Why isn't there 1 grid cell?",void 0,"RootController.applyGridStyle","RootController.swift",177),r=!0}else n=i.as(o[0].controller,h.GridController);n.beginBlockedUpdate();var c=i.opt(this.forma,(function(e){return e.bounds}));n.forma.bounds=c;for(var d=i.iter(this.forma.visitAsArray(u.FormaTraversal.JustChildren));!d.done;d.next()){var p=d.value;i.eq(u._equality_Forma_Forma,p,n.forma)||(p.controller.moveable?n.forma.appendChild(p):n.forma.insertChildAt(p,0))}if(n.endBlockedUpdate(),n.applyStyle(e,t),r){var m,y=n.gridStyle.gridCells[0];null!=(m=this.forma.style.colors.colorID(s.ColorRole.FieldPrimary))&&(n.gridStyle.updateCell(y,null,m,null),m!=a.ColorLibraryController.BLACK_KEY&&this.forma.style.colors.setColorId(s.ColorRole.FieldPrimary,"themeColor0"==m?"themeColor1":"themeColor0"),i.opt(n,(function(e){return e.updateGroup()})))}},preferredResizeType:{get:function(){return d.GroupController._getters.preferredResizeType.call(this)},set:function(e){var t;d.GroupController._setters.preferredResizeType.call(this,e),(t=this.getGridController())&&(t.preferredResizeType=e)}}}}),n)},"v/sv":function(e,t,o){var n,r=t,i=o("oAGj"),a=o("CaSj"),l=o("FNB+"),s=o("tQF8"),u=o("/afT"),c=o("pnSN"),h=o("TP4q"),d=o("bSZx"),g=o("Dq5S"),p=o("oKlP");r.GridCellContent=i.defineEnum("GridCellContent",{None:0,Image:1,Text:2,Count:3}),r.GridSuggester=(n=function(e,t,o){this.gridForma_=null,void 0===o&&(o=null),this.gridStyle_=t,this.preserveMapping_=i.clone(o),this.gridForma_=e},i.defineClass({name:"GridSuggester",ctor:n,superName:"CoreObject",statics:{KIND:{get:function(){return"GridSuggester"}},defaultWeights:[-.4869963787443057,.10451788427313968,-10,.3841333333333332,.1438482857676463,.05953378239352733,-.7134725705040772,-.7,.2460712826952826,1.7685714285714302,1.7685714285714302,-1.42857142857143,-1.42857142857143,.2857180890092063,.2915071572811428,-.2857180890092063,-.2915071572811428,-.1822757614386357,-.1502170111498276,-.13002813087151563,-.16114682148449702,.28162418627853086,.2916486562661698,.3658656280531089,.31731319724602053,-.05177320346844536,-.04974606109777501,-.03389292805397268,-.021441808254260175,.14285700582863953,.961358333706472,-2.871390476190484,2.531390476190476,-.4,-.6],styleWeightMatrix:{checkerBoard:[-4,.3,-.6,.4,.3,.2,-.7,-.7,0,0,0,0,0,0,0,0,0,0,0,0,0,2,2,2,2,0,0,0,0,0,2,-100,100,-.4,-.6],imageOnTop:[0,.3,-.4,.4,.3,.2,-.7,-.7,0,-5,5,5,-5,0,0,0,0,0,-100,0,100,1,-2,1,-2,0,0,0,0,0,.3,0,0,-.4,-.6],imageOnBottom:[0,.3,-.4,.4,.3,.2,-.7,-.7,0,-5,5,5,-5,0,0,0,0,0,100,0,-100,1,-2,1,-2,0,0,0,0,0,.3,0,0,-.4,-.6],imageLeft:[0,.3,-.4,.4,.3,.2,-.7,-.7,0,5,-5,-5,5,0,0,0,0,-100,0,100,0,-2,1,-2,1,0,0,0,0,0,.3,0,0,-.4,-.6],imageRight:[0,.3,-.4,.4,.3,.2,-.7,-.7,0,5,-5,-5,5,0,0,0,0,100,0,-100,0,-2,1,-2,1,0,0,0,0,0,.3,0,0,-.4,-.6],textTowardCenter:[0,.3,-.7,.4,.3,.2,-.7,-.7,0,5,5,-5,-5,1,1,-1,-1,0,0,0,0,5,5,-1,-1,100,100,-100,-100,1,0,0,0,-.4,-.6],imageTowardCenter:[0,.3,-.7,.4,.3,.2,-.7,-.7,0,5,5,-5,-5,1,1,-1,-1,0,0,0,0,-1,-1,5,5,-100,-100,100,100,0,5,0,0,-.4,-.6]}},props:{sortCells:function(e,t){return e.bounds.minY<t.bounds.minY||!(e.bounds.minY>t.bounds.minY)&&e.bounds.minX<t.bounds.minX},createPreservedGroupMatches:function(e,t){var o=e.concat();i.sortInPlace(o,this.sortCells);for(var n=[],r=i.iter(t);!r.done;r.next()){var l=r.value;i.containsEq(n,l,s._equality_GridCell_GridCell)||n.push(l)}i.sortInPlace(n,this.sortCells);for(var u=[],c=i.iter(n);!c.done;c.next())u.push([]);for(var h=i.iter(t);!h.done;h.next()){var d=h.key;l=h.value,u[i.indexOfEq(n,l,s._equality_GridCell_GridCell)].push(d)}for(var g=Math.max(u.length,o.length),p=i.clone(a.DesignSuggester.getPermutations(g)),f=[],m=i.iter(p);!m.done;m.next()){for(var y=m.value,v={},S=i.iter(i.range(0,g,!1));!S.done;S.next())for(var C=S.value,T=i.clone(u[C%u.length]),A=i.iter(T);!A.done;A.next()){d=A.value;var F=o[y[C]%o.length];i.opt(this.gridForma_,(function(e){return e.page.formaByID(d)}))&&(v[d]=F)}for(var k=!1,L=i.iter(f);!L.done;L.next()){var b=L.value;this.mappingEqual(v,b)&&(k=!0)}k||f.push(v)}return f},createFormaMatches:function(e,t){if(null!=this.preserveMapping_&&i.count(this.preserveMapping_)>0&&!t)return this.createPreservedGroupMatches(e,this.preserveMapping_);for(var o=this.gridForma_,n=i.clone(o.filterWithCallback((function(e){return e.isBackgroundImage()}))),r=[],c=[],h=i.iter(i.range(0,e.length-1,!0));!h.done;h.next()){for(var d=e[q=h.value],g=!1,f=i.iter(i.range(0,q,!0));!f.done;f.next()){var m=e[f.value];!i.eq(s._equality_GridCell_GridCell,d,m)&&d.bounds.intersects(m.bounds)&&(g=!0,c.push(m))}g||r.push(d)}for(var y=Math.max(n.length,r.length),v=Math.max(250-20*n.length,100),S=i.clone(a.DesignSuggester.getPermutations(y,v)),C=[],T=i.iter(S);!T.done;T.next()){var A=T.value,F={};if(n.length>0)for(var k=i.iter(i.range(0,y,!1));!k.done;k.next())F[n[(q=k.value)%n.length].formaID]=e[A[q]%e.length];for(var L=!1,b=i.iter(C);!b.done;b.next()){var _=b.value;this.mappingEqual(F,_)&&(L=!0)}L||C.push(F)}for(var R=[],I=i.iter(o.visitAsArray(l.FormaTraversal.JustChildren));!I.done;I.next()){var w=I.value;w.controller.floating&&R.push(w)}i.sortInPlace(R,(function(e,t){return e.finalFrame.center.distanceTo(p.TheoPoint.ZERO)<t.finalFrame.center.distanceTo(p.TheoPoint.ZERO)}));var D=e.length-n.length;if(this.gridStyle_.moveableShift&&R.length>0){var x=[];if(R.length<=D)for(var P=i.iter(R);!P.done;P.next()){var E=P.value;x.push([E])}else x=i.clone(u.GroupDetector.detectProximityGroups(R));D>x.length&&(x=i.clone(u.GroupDetector.splitFormaGroups(x,D)));for(var M=[],N=i.iter(C);!N.done;N.next()){_=N.value;for(var G=i.clone(c),B=i.iter(_);!B.done;B.next()){var O=B.value;G.push(O)}for(var U=[],H=i.iter(e);!H.done;H.next()){d=H.value;for(var z=!1,Y=i.iter(G);!Y.done;Y.next()){var W=Y.value;i.eq(s._equality_GridCell_GridCell,W,d)&&(z=!0)}z&&0!=D||U.push(d)}i.shuffleInPlace(U);for(var V=i.iter([!1,!0]);!V.done;V.next()){var K=V.value;if((1==D||1==x.length)&&K)break;for(var X=i.clone(_),j=i.iter(i.range(0,x.length,!1));!j.done;j.next()){var q=j.value,Z=i.clone(x[q]);K&&(Z=i.clone(x[x.length-q-1]));for(var J=i.iter(i.range(0,Z.length,!1));!J.done;J.next())X[Z[J.value].formaID]=U[Math.min(q,U.length-1)]}M.push(X)}}C=i.clone(M)}return C},mappingEqual:function(e,t){for(var o=i.iter(e);!o.done;o.next()){var n=o.key,r=o.value;if(!i.eq(s._equality_GridCell_GridCell,t[n],r))return!1}return!0},createSuggestions:function(e){void 0===e&&(e=null);var t=this.gridStyle_.gridCells.map((function(e){return e.clone()}),this),o=i.clone(this.createFormaMatches(t,this.gridStyle_.anyOverlap));if(0==o.length)return[];for(var r=[],a=i.iter(o[0]);!a.done;a.next()){var l,s=a.key;(l=i.opt(this.gridForma_,(function(e){return e.page.formaByID(s)})))&&(l.controller.floating||l.isBackgroundImage())&&r.push(g.LayoutItem.init_b14a(l))}var u=i.clone(null!=e?e:n.defaultWeights);t.length>5&&(u=i.clone(n.styleWeightMatrix.checkerBoard));for(var p=[],f=i.iter(o);!f.done;f.next()){var m=f.value,y=this.createGridStyle(t,m),v=new h.GridScore(y,this.gridForma_.frame,r,this.gridForma_,void 0,u);p.push(new d.GridSuggestion(i.as(this.gridForma_,c.GroupForma),y,v))}return i.sort(p,(function(e,t){return e.score>t.score}))},createGridStyle:function(e,t){for(var o=this.gridStyle_.clone(),n=[],r=i.iter(e);!r.done;r.next()){var a=r.value;n.push(a.clone())}for(var l={},s=i.iter(t);!s.done;s.next())for(var u=s.key,c=(a=s.value,i.iter(n));!c.done;c.next()){var h=c.value;if(a.bounds==h.bounds){l[u]=h;break}}return o.setGridCells(n.concat()),o.setFormaMapping(l),o.forma=this.gridForma_,o}}}),n)},vV1H:function(e,t,o){var n,r=t,i=o("oAGj"),a=o("Tq01"),l=o("0wFF"),s=o("yGNn"),u=o("iCxV"),c=o("Kkml");r.FlipAction=(n=function e(t,o){void 0===t&&(t=!1),void 0===o&&(o=null),this.vertical=t,this.formaeToFlip=i.clone(o),a.Action.call(this,e.TYPE)},i.defineClass({name:"FlipAction",ctor:n,superName:"Action",statics:{TYPE:{get:function(){return"FlipAction"}}},props:{getUserAction:function(e){return c.UserActions.FlipItem()},execute:function(e){var t=this,o=null;return null!=this.formaeToFlip?o=i.clone(this.formaeToFlip):(o=[],e.selection.selectedCount>0&&e.selection.forEachSelected((function(e){return o.push(e)}))),i.clone(o).filter((function(e){return i.opt(e.controller,(function(e){return 1==e.flippable}))}),this).forEach((function(e){e.controller.flip(t.vertical),e.isShape()?t.vertical?i.opt(u.Host.logging,(function(e){return e.logToAnalytics(l.AnalyticsConstants.kAnalyticsDataIconFlippedVertical,{})})):i.opt(u.Host.logging,(function(e){return e.logToAnalytics(l.AnalyticsConstants.kAnalyticsDataIconFlippedHorizontal,{})})):e.isText()&&i.opt(u.Host.logging,(function(e){return e.logToAnalytics(l.AnalyticsConstants.kAnalyticsDataTextFlipped,{})}))})),s.CorePromise.resolve(null)}}}),n)},vYM0:function(e,t,o){var n,r=t,i=o("oAGj"),a=o("yhkb"),l=o("C42b"),s=o("iCxV"),u=o("umUn");r.ColorLibraryMap=(n=function(){},i.defineClass({name:"ColorLibraryMap",ctor:n,statics:{remapColors:function(e,t,o,r){var a=[];e.forEachColor((function(e,l,s){var u;if(u=null==l?s:i.opt(t.color(l),(function(e){return e.rgbColor}))){var c=i.opt(r,(function(e){return e[u.hex]}));null==c&&(c=n.findACloseColor(u,o),null!=r&&(r[u.hex]=c)),a.push({key:e,value:c})}})),e.setColorIDs(a)},detachFromLibrary:function(e,t,o){void 0===o&&(o=null);var n=[];e.forEachColor((function(e,t,o){return n.push({role:e,colorID:t,color:o})}));for(var r=i.iter(n);!r.done;r.next()){var a,l,s=r.value;(a=null==s.colorID?s.color:i.opt(t.color(s.colorID),(function(e){return e.rgbColor})))&&(null!=(l=i.opt(o,(function(e){return e.getKeyOfColorInTheme(u.TheoColor.init_5344(a))})))?e.setColorId(s.role,l):e.setColor(s.role,a))}},findACloseColor:function(e,t,o){void 0===o&&(o=20);var n=e.lightness,r=null,u=[];if(t.forEachColor((function(e,t){if(e.startsWith("theme")){var r=Math.abs(t.rgbColor.lightness-n);r<=o&&u.push({id:e,distance:r})}})),0==u.length)i.opt(s.Host.logging,(function(e){return e.info("Unable to find closest color in ColorLibraryMap.findACloseColor")})),r=a.ColorLibraryController.BLACK_KEY;else{var c=i.sort(u,(function(e,t){return e.distance<t.distance}));r=c[l.CoreRandom.nextIntUniform(Math.min(c.length,3))].id}return r}}}),n)},voLh:function(e,t,o){var n,r=t,i=o("oAGj"),a=o("gXiO"),l=o("FNB+"),s=o("Pil/"),u=o("P83h"),c=o("fdtz"),h=o("djAF"),d=o("oKlP"),g=o("zjod");r.ProportionalLayoutController=(n=function(e){this.group_=e,this.oldBounds_={},a.CoreObject.call(this)},i.defineClass({name:"ProportionalLayoutController",ctor:n,superName:"CoreObject",statics:{_implements:function(e){return"ResizeLayoutController"==e}},props:{setInitBounds:function(){this.oldBounds_[this.group_.formaID]=this.group_.bounds},beginUpdateGroup:function(){this.startBounds_=this.group_.bounds,null==this.oldBounds_[this.group_.formaID]&&(this.oldBounds_[this.group_.formaID]=this.group_.bounds);for(var e=i.iter(this.group_.visitAsArray(l.FormaTraversal.JustChildren));!e.done;e.next()){var t=e.value;null==this.oldBounds_[t.formaID]&&(this.oldBounds_[t.formaID]=t.bounds)}},updateGroup:function(){if(null!=this.startBounds_){var e=this.startBounds_.size,t=this.group_.bounds.size,o=new d.TheoPoint(t.width/e.width,t.height/e.height),n=new u.FormaAnimationTransactionEvent(this.group_);this.group_.beginUpdate(n);for(var r=i.iter(this.group_.visitAsArray(l.FormaTraversal.JustChildren));!r.done;r.next()){var a,p,f,m=r.value;if(m.kind!=c.ImageForma.KIND&&m.kind!=g.VideoForma.KIND&&(a=m.frame)&&(p=this.oldBounds_[m.formaID])&&(f=this.oldBounds_[this.group_.formaID])&&a.area>0){var y,v,S=m.placement.transformValues,C=Math.abs(S.rotCosine)/(Math.abs(S.rotCosine)+Math.abs(S.rotSine)),T=Math.abs(S.rotSine)/(Math.abs(S.rotCosine)+Math.abs(S.rotSine)),A=new d.TheoPoint(o.x*C+o.y*T,o.x*T+o.y*C);if(null!=m.controller&&m.controller.maintainAspectRatio){var F=new d.TheoPoint(t.width/f.size.width,t.height/f.size.height),k=new d.TheoPoint(F.x*C+F.y*T,F.x*T+F.y*C),L=Math.min(k.x,k.y);y=p.scaleXY(L,L,new d.TheoPoint(0,0))}else y=i.opt(m.bounds,(function(e){return e.scaleXY(A.x,A.y,new d.TheoPoint(0,0))}));(v=i.as(m,h.ShapeForma))?i.opt(v.controller,(function(e){return e.onEvent(new s.FormaResizeEvent(v,i.opt(y,(function(e){return e.size})),new d.TheoPoint(0,0)))})):m.bounds=y,m.moveCenterToPoint(new d.TheoPoint(a.center.x*o.x,a.center.y*o.y))}}this.group_.endUpdate(n)}},endUpdateGroup:function(){}}}),n)},waL6:function(e,t,o){var n,r=t,i=o("oAGj"),a=o("gXiO"),l=o("6ZWm"),s=o("9Lk3"),u=o("ZK0l"),c=o("iCxV"),h=o("NkBu"),d=o("uxH+"),g=o("JO5d"),p=o("8t9B"),f=o("fGVU");r.FormaControllerFactory=(n=function(e){this.constructors_={},this.owner_=e,a.CoreObject.call(this),this.setConstructors()},i.defineClass({name:"FormaControllerFactory",ctor:n,superName:"CoreObject",props:{owner:{get:function(){return this.owner_},set:function(e){this.owner_=e,this.setConstructors()}},setConstructors:function(){var e=this;this.constructors_[u.GroupController.KIND]=function(t,o,n){return new u.GroupController(t,o,i.opt(e,(function(e){return e.owner_})))},this.constructors_[d.RootController.KIND]=function(t,o,n){return new d.RootController(t,o,i.opt(e,(function(e){return e.owner_})))},this.constructors_[l.FrameController.KIND]=function(t,o,n){return new l.FrameController(t,o,i.opt(e,(function(e){return e.owner_})))},this.constructors_[h.ImageController.KIND]=function(t,o,n){return new h.ImageController(t,o,i.opt(e,(function(e){return e.owner_})))},this.constructors_[f.VideoController.KIND]=function(t,o,n){return new f.VideoController(t,o,i.opt(e,(function(e){return e.owner_})))},this.constructors_[g.ShapeController.KIND]=function(t,o,n){return new g.ShapeController(t,o,i.opt(e,(function(e){return e.owner_})))},this.constructors_[p.TypeLockupController.KIND]=function(t,o,n){return new p.TypeLockupController(t,o,i.opt(e,(function(e){return e.owner_})))},this.constructors_[s.GridController.KIND]=function(t,o,n){return new s.GridController(t,o,i.opt(e,(function(e){return e.owner_})))},this.constructors_.AbsolutePositionController=function(t,o,n){return new d.RootController(t,o,i.opt(e,(function(e){return e.owner_})))},this.constructors_.responsive=function(t,o,n){return new u.GroupController(t,o,i.opt(e,(function(e){return e.owner_})))}},createController:function(e,t){var o=this.constructors_[e];return null==o?(i.opt(c.Host.logging,(function(t){return t.warning("createController: No constructor for kind "+e+" available.")})),null):o(e,t,this.owner_)}}}),n)},wpCo:function(e,t,o){var n,r=t,i=o("oAGj"),a=o("Tq01"),l=o("0wFF"),s=o("6h7+"),u=o("iCxV"),c=o("358a"),h=o("Kkml");r.AddBadgeAction=(n=function e(t,o,n,r,i){void 0===o&&(o=null),void 0===r&&(r=null),void 0===i&&(i=s.BadgeType.Lockup),this.badgeDoc=t,this.formaToReplace=o,this.badgeID=n,this.badgeType=i,this.addParams=r,a.Action.call(this,e.TYPE)},i.defineClass({name:"AddBadgeAction",ctor:n,superName:"Action",statics:{TYPE:"AddBadgeAction"},props:{getUserAction:function(e){return h.UserActions.AddBadge()},execute:function(e){var t=this,o=e.document;return s.BadgeFacade.addBadge(this.badgeDoc,this.badgeID,c.PagesFacade.getActivePage(o),this.formaToReplace,i.opt(this.addParams,(function(e){return e.atPagePoint}))).then((function(e){var o;return(o=i.opt(i.as(e,a.FormaActionResult),(function(e){return e.formae})))&&(t.newSelection=i.clone(o)),i.opt(u.Host.logging,(function(e){return e.logToAnalytics(l.AnalyticsConstants.kDesignIngredientAdded,{contextualData1:"designIngredientId:"+t.badgeID,contextualData2:"designIngredientType:"+t.badgeType})})),e}))},updateSelection:function(e){return u.Host.platform.isWeb&&null==this.formaToReplace||null==this.newSelection||e.selection.replaceSelectionWithFormae(this.newSelection),this.newSelection}}}),n)},"ws+m":function(e,t,o){var n,r,i=t,a=o("oAGj"),l=o("6ZWm"),s=o("7Ta2");i.ImageRoleSuggesterFactory=(n=function(){},a.defineClass({name:"ImageRoleSuggesterFactory",ctor:n,statics:{Create:function(e){return void 0===e&&(e=""),new i.ImageRoleSuggesterSimple}}}),n),i.ImageRoleSuggesterSimple=(r=function(){},a.defineClass({name:"ImageRoleSuggesterSimple",ctor:r,statics:{_implements:function(e){return"RoleSuggesterProtocol"==e}},props:{getRole:function(e){var t,o=e.forma,n=s.InferredRoleType.Undefined;if(t=a.as(o.controller,l.FrameController)){if(o.isGridCell())return s.InferredRole.init_84d1(s.InferredRoleType.Background,1);if(o.isLogo())return s.InferredRole.init_84d1(s.InferredRoleType.Logo,1,s.InferredRoleType.GraphicContent,.5);if(t.floating)return s.InferredRole.init_84d1(s.InferredRoleType.GraphicContent,1)}return s.InferredRole.init_84d1(n,1)}}}),r)},x6FH:function(e,t,o){var n,r,i,a,l,s=t,u=o("oAGj"),c=o("Tq01"),h=o("yGNn"),d=o("x35w"),g=o("358a"),p=o("Kkml");s.CreatePaddedCollageAction=(n=function e(){c.Action.call(this,e.TYPE)},u.defineClass({name:"CreatePaddedCollageAction",ctor:n,superName:"Action",statics:{TYPE:"CreatePaddedCollageAction"},props:{getUserAction:function(e){return p.UserActions.CreateCollage()},execute:function(e){var t,o;return(t=u.opt(e.document,(function(e){return e.firstPage})))?(o=d.GridFacade.createPaddedCollage(t))?h.CorePromise.resolve(new c.FormaActionResult([o])):h.CorePromise.reject("could not get or create page grid"):h.CorePromise.reject("no document or page?")}}}),n),s.SetGridParametersAction=(r=function e(t,o){this.spacing=t,this.margin=o,c.Action.call(this,e.TYPE)},u.defineClass({name:"SetGridParametersAction",ctor:r,superName:"Action",statics:{TYPE:"SetGridParametersAction"},props:{getUserAction:function(e){return p.UserActions.SetLayoutMargin()},execute:function(e){var t;if(t=e.document){var o,n=g.PagesFacade.getActivePage(t);if(d.GridFacade.setPageGridParameters(n,this.spacing,this.margin),this.spacing==this.margin&&(o=d.GridFacade.getPageGrid(n,!1))&&o.spacing!=o.margin){var r=Math.min(o.spacing,o.margin);d.GridFacade.setPageGridParameters(n,r,r)}return h.CorePromise.resolve(null)}return h.CorePromise.reject("no document or page?")}}}),r),s.SwapGridFormaAction=(i=function e(t,o){this.a=t,this.b=o,c.Action.call(this,e.TYPE)},u.defineClass({name:"SwapGridFormaAction",ctor:i,superName:"Action",statics:{TYPE:"SwapGridFormaAction"},props:{getUserAction:function(e){return p.UserActions.SwapGridCells()},execute:function(e){return d.GridFacade.isChildSwappable(this.a)&&d.GridFacade.isChildSwappable(this.b)?(d.GridFacade.swapChildren(this.a,this.b),h.CorePromise.resolve(null)):h.CorePromise.reject("grid children not swappable? or no grid controller?")}}}),i),s.SetGridStyleAction=(a=function e(t,o,n){this.style=t,this.variation=o,this.pages=u.clone(n),c.Action.call(this,e.TYPE)},u.defineClass({name:"SetGridStyleAction",ctor:a,superName:"Action",statics:{TYPE:"SetGridStyleAction"},props:{getUserAction:function(e){var t=g.PagesFacade.getScopeIdentifier(this.pages);return p.UserActions.SetGridStyle(t)},execute:function(e){for(var t=u.iter(this.pages);!t.done;t.next()){var o=t.value;d.GridFacade.applyGridStyle(this.style,this.variation,o)}return h.CorePromise.resolve(null)}}}),a),s.EnterGridLayoutModeAction=(l=function e(){c.Action.call(this,e.TYPE)},u.defineClass({name:"EnterGridLayoutModeAction",ctor:l,superName:"Action",statics:{TYPE:"EnterGridLayoutModeAction"},props:{getUserAction:function(e){return p.UserActions.EnterGridLayoutMode()},execute:function(e){var t;if(t=e.document){var o,n=g.PagesFacade.getActivePage(t);if(o=d.GridFacade.getPageGrid(n,!0))return o.enterLayoutMode(),h.CorePromise.resolve(null)}return h.CorePromise.reject("no page or grid?")}}}),l)},x7yN:function(e,t,o){var n,r=t,i=o("oAGj"),a=o("gXiO"),l=o("FNB+"),s=o("Pil/"),u=o("9Lk3"),c=o("djAF"),h=o("oKlP");r.FitLayoutController=(n=function(e){this.group_=e,a.CoreObject.call(this)},i.defineClass({name:"FitLayoutController",ctor:n,superName:"CoreObject",statics:{_implements:function(e){return"ResizeLayoutController"==e}},props:{beginUpdateGroup:function(){this.oldBounds_=this.group_.bounds},updateGroup:function(){if(null!=this.oldBounds_){var e=this.oldBounds_.size,t=this.group_.bounds.size,o=new h.TheoPoint(t.width/e.width,t.height/e.height),n=Math.min(o.x,o.y),r=h.TheoPoint.ZERO;r=o.x>o.y?new h.TheoPoint(Math.max((t.width-e.width*n)/2,0),0):new h.TheoPoint(0,Math.max((t.height-e.height*n)/2,0));for(var a=i.iter(this.group_.visitAsArray(l.FormaTraversal.JustChildren));!a.done;a.next()){var d,g,p=a.value;if((d=p.frame)&&d.area>0)if(g=i.as(p.controller,u.GridController))g.resizeWithFit(this.group_.bounds,n,r);else{var f,m=i.opt(p.bounds,(function(e){return e.scale(n,new h.TheoPoint(0,0))}));(f=i.as(p,c.ShapeForma))?i.opt(f.controller,(function(e){return e.onEvent(new s.FormaResizeEvent(f,i.opt(m,(function(e){return e.size})),new h.TheoPoint(0,0)))})):p.bounds=m,p.moveCenterToPoint(new h.TheoPoint(d.center.x*n+r.x,d.center.y*n+r.y))}}}},endUpdateGroup:function(){}}}),n)},xRbc:function(e,t,o){var n,r=t,i=o("oAGj"),a=o("wc1n"),l=o("cYVN"),s=o("35Q0");r.LockupRoleFeatures=i.defineEnum("LockupRoleFeatures",{WordCount:"WordCount",CharacterCount:"CharacterCount",intsSpecialsCount:"intsSpecialsCount",webReferencesCount:"webReferencesCount",checkSocialChar:"checkSocialChar",Spacing:"Spacing",Padding:"Padding",ShapeFilled:"ShapeFilled",TextWidth:"TextWidth",TextHeight:"TextHeight",PercentageArea:"PercentageArea",CenterX:"CenterX",CenterY:"CenterY",PageHeight:"PageHeight",PageWidth:"PageWidth",otherLockupPercDesignArea:"otherLockupPercDesignArea",TextCount:"TextCount",actionWordsCount:"actionWordsCount",TextString:"TextString",BackingShape:"BackingShape",PerAreaAllLockups:"PercentageAreaAllLockups",CollisionPercentage:"CollisionPercentage",SurroundingAlignment:"SurroundingAlignment"}),r.LockupRoleData=(n=function(e,t,o){l.RoleData.call(this,e,t,o)},i.defineClass({name:"LockupRoleData",ctor:n,superName:"RoleData",statics:{digits:"0123456789/@|",webReferenceStrings:[".com","http",".edu",".org",".gov"],actionWordStrings:["join","now","today","try","view","swipe"],socialMediaStrings:["#","instagram"],getLockupRoleData:function(e){var t=[r.LockupRoleFeatures.WordCount,r.LockupRoleFeatures.CharacterCount,r.LockupRoleFeatures.intsSpecialsCount,r.LockupRoleFeatures.checkSocialChar,r.LockupRoleFeatures.webReferencesCount,r.LockupRoleFeatures.Spacing,r.LockupRoleFeatures.Padding,r.LockupRoleFeatures.ShapeFilled,r.LockupRoleFeatures.TextWidth,r.LockupRoleFeatures.TextHeight,r.LockupRoleFeatures.PercentageArea,r.LockupRoleFeatures.CenterX,r.LockupRoleFeatures.CenterY,r.LockupRoleFeatures.PageWidth,r.LockupRoleFeatures.PageHeight,r.LockupRoleFeatures.otherLockupPercDesignArea,r.LockupRoleFeatures.TextCount,r.LockupRoleFeatures.actionWordsCount],o=[r.LockupRoleFeatures.TextString,r.LockupRoleFeatures.BackingShape,r.LockupRoleFeatures.PerAreaAllLockups],l=a.FeatureExtractorFactory.getFeatureExtractor(a.FeatureExtractorType.LockupStyle,e,i.as(t.concat(o),["Array","String"])),s=i.clone(l.numericalFeatures);i.removeKey(s,r.LockupRoleFeatures.PerAreaAllLockups);var u=l.categoricalFeatureForKey(r.LockupRoleFeatures.TextString),c=l.categoricalFeatureForKey(r.LockupRoleFeatures.BackingShape),h=l.numericFeatureForKey(r.LockupRoleFeatures.PerAreaAllLockups);return s[r.LockupRoleFeatures.actionWordsCount]=i.toDouble(n.getNumActionWordReferences(u)),s[r.LockupRoleFeatures.checkSocialChar]=n.checkSocialMediaCharacters(u,c)?1:0,s[r.LockupRoleFeatures.intsSpecialsCount]=i.toDouble(n.getNumIntsAndSpecials(u)),s[r.LockupRoleFeatures.webReferencesCount]=i.toDouble(n.getNumWebReferences(u)),s[r.LockupRoleFeatures.otherLockupPercDesignArea]=h-s[r.LockupRoleFeatures.PercentageArea],new n(e,t,s)},getNumIntsAndSpecials:function(e){for(var t=0,o=i.iter(i.range(0,e.length,!1));!o.done;o.next()){var r=o.value,a=e.substr(r,1);n.digits.includes(a)&&(t+=1)}return t},getNumWebReferences:function(e){for(var t=0,o=i.iter(n.webReferenceStrings);!o.done;o.next()){var r=o.value;e.toLowerCase().includes(r)&&(t+=1)}return t},getNumActionWordReferences:function(e){for(var t=0,o=i.iter(n.actionWordStrings);!o.done;o.next()){var r=o.value;e.toLowerCase().includes(r)&&(t+=1)}return t},checkSocialMediaCharacters:function(e,t){for(var o,r=!1,a=i.iter(n.socialMediaStrings);!a.done;a.next()){var l=a.value;e.includes(l)&&(r=!0)}return(o=s.ShapeLibrary.shapeDictionary[t])&&o.category==s.ShapeCategory.Social&&(r=!0),r},checkLockupIsGraphic:function(e,t){for(var o=!1,n="",r=i.iter(i.range(0,e.length,!1));!r.done;r.next()){var a=r.value,l=e.substr(a,1);" "!=l&&"\n"!=l&&"\t"!=l&&"\r"!=l&&(n+=l)}return n.length<=1&&t.category!=s.ShapeCategory.None&&(o=!0),o}}}),n)},xe42:function(e,t,o){var n,r,i=t,a=o("oAGj"),l=o("9BFu");i.FormaPlacementScore=(n=function e(t){this.rejectThreshold=-100,l.WeightedScore.call(this,e.Features.NUM_FEAT),this.setWeight(e.Features.XSYMM,10),this.setWeight(e.Features.YSYMM,10),this.setWeight(e.Features.CONTRAST,1),0==t.textRects.length?(this.setWeight(e.Features.EDGE,-500),this.setWeight(e.Features.FACE,-1e3)):(this.setWeight(e.Features.EDGE,-50),this.setWeight(e.Features.FACE,0)),this.setWeight(e.Features.SIZE,100),this.setWeight(e.Features.TEXT_OVERLAP,-5e3),this.setWeight(e.Features.FLOATING_ELEMENT_OVERLAP,-1e3),this.setWeight(e.Features.DISTANCE_TO_CENTER,-20),this.setWeight(e.Features.IMAGE_EDGE_OVERLAP,-500),this.setWeight(e.Features.REGION_BOUNDARY_OVERLAP,-40),this.setWeight(e.Features.ALIGNMENT,50),this.setWeight(e.Features.ASPECT_RATIO,t.forma.isImage()?0:20),this.setFeatureName(e.Features.XSYMM,"X- Symmetry"),this.setFeatureName(e.Features.YSYMM,"Y- Symmetry"),this.setFeatureName(e.Features.CONTRAST,"Contrast"),this.setFeatureName(e.Features.EDGE,"Edges"),this.setFeatureName(e.Features.FACE,"Faces"),this.setFeatureName(e.Features.SIZE,"Size"),this.setFeatureName(e.Features.TEXT_OVERLAP,"Text Overlap"),this.setFeatureName(e.Features.FLOATING_ELEMENT_OVERLAP,"Floating Element Overlap"),this.setFeatureName(e.Features.DISTANCE_TO_CENTER,"Distance To Center"),this.setFeatureName(e.Features.IMAGE_EDGE_OVERLAP,"Image Edge Overlap"),this.setFeatureName(e.Features.REGION_BOUNDARY_OVERLAP,"Region Boundary Overlap"),this.setFeatureName(e.Features.ALIGNMENT,"Alignment"),this.setFeatureName(e.Features.ASPECT_RATIO,"Aspect Ratio")},r={},a.defineClass({name:"FormaPlacementScore",ctor:n,superName:"WeightedScore",statics:{Features:{get:function(){return void 0===r.Features&&(r.Features=a.defineEnum("Features",{XSYMM:1,YSYMM:2,CONTRAST:3,EDGE:4,FACE:5,SIZE:6,TEXT_OVERLAP:7,FLOATING_ELEMENT_OVERLAP:8,IMAGE_EDGE_OVERLAP:9,REGION_BOUNDARY_OVERLAP:10,DISTANCE_TO_CENTER:11,ALIGNMENT:12,ASPECT_RATIO:13,NUM_FEAT:14})),r.Features}}},props:{reject:function(){return this.score<this.rejectThreshold}}}),n)},"y/On":function(e,t,o){var n,r,i=t,a=o("oAGj"),l=o("Tq01"),s=o("0wFF"),u=o("yGNn"),c=o("FNB+"),h=o("P83h"),d=o("pnSN"),g=o("X0GW"),p=o("iCxV"),f=o("Kkml");i.GroupAction=(n=function e(t,o,n){void 0===t&&(t=null),void 0===o&&(o=!0),void 0===n&&(n=""),this.formaeToGroup=a.clone(t),this.selectGroup=o,this.method=n,l.Action.call(this,e.TYPE)},a.defineClass({name:"GroupAction",ctor:n,superName:"Action",statics:{TYPE:"GroupAction"},props:{getUserAction:function(e){return f.UserActions.GroupItems()},execute:function(e){var t=this;return g.GroupFacade.groupItems(this.formaeToGroup||e.selection.asFormaArray()).then((function(e){var o=a.as(e,c.Forma);if(null!=o){var n;if(t.selectGroup&&(t.newSelection=[o]),n=a.as(o,d.GroupForma)){var r=g.GroupFacade.getGroupDepth(n);a.opt(p.Host.logging,(function(e){return e.logToAnalytics(s.AnalyticsConstants.kAnalyticsDataGroupPressed,{contextualData1:"count:"+n.childCount,contextualData2:"depth:"+r,contextualData3:"method:"+t.method})}))}return new l.FormaActionResult([o])}return u.CorePromise.reject("did not get a GroupForma back from GroupFacade.groupItems")}))},updateSelection:function(e){if(null!=this.newSelection&&this.selectGroup){e.selection.replaceSelectionWithFormae(this.newSelection);for(var t=a.iter(this.newSelection);!t.done;t.next()){var o=t.value,n=new h.FormaGroupEvent(o);o.beginUpdate(n),o.endUpdate(n)}}return this.newSelection}}}),n),i.UngroupAction=(r=function e(t,o,n){void 0===t&&(t=null),void 0===o&&(o=!0),void 0===n&&(n=""),this.formaeToUngroup=a.clone(t),this.selectUngroup=o,this.method=n,l.Action.call(this,e.TYPE)},a.defineClass({name:"UngroupAction",ctor:r,superName:"Action",statics:{TYPE:"UngroupAction"},props:{getUserAction:function(e){return f.UserActions.UngroupItems()},execute:function(e){var t=this,o=a.clone(this.formaeToUngroup||e.selection.asFormaArray());return g.GroupFacade.ungroupItems(o).then((function(e){var n;if(n=a.as(e,["Array",c.Forma])){t.selectUngroup&&(t.newSelection=a.clone(n));var r=s.AnalyticsConstants.kAnalyticsDataGroupUngroupPressed;return o.length>1&&(r=s.AnalyticsConstants.kAnalyticsDataMultiselectUngroupPressed),a.opt(p.Host.logging,(function(e){return e.logToAnalytics(r,{contextualData1:"count:"+n.length,contextualData3:"method:"+t.method})})),new l.FormaActionResult(n)}return u.CorePromise.reject("did not get a set of forma back from GroupFacade.ungroupItems")}))},updateSelection:function(e){if(null!=this.newSelection&&this.selectUngroup){e.selection.removeStaleSelections(),e.selection.selectFormae(this.newSelection);for(var t=a.iter(this.newSelection);!t.done;t.next()){var o=t.value,n=new h.FormaUngroupEvent(o);o.beginUpdate(n),o.endUpdate(n)}}return this.newSelection}}}),r)},yHU1:function(e,t,o){var n,r,i,a=t,l=o("oAGj"),s=o("gXiO"),u=o("quOg"),c=o("FNB+"),h=o("Pil/"),d=o("fWxZ"),g=o("P83h"),p=o("iCxV"),f=o("1HsO"),m=o("8vXU"),y=o("lmwz"),v=o("rxGp"),S=o("fNpk"),C=o("g8Fi"),T=o("KIfs"),A=o("6Tzw"),F=o("mxdD");a.BeginPointerTrackingResponseEnum=l.defineEnum("BeginPointerTrackingResponseEnum",{TrackAsGroup:0,TrackWithinGroup:1,DoNotTrack:2}),a.IPSMDelegate=l.defineProtocol("IPSMDelegate",{handleEvent:"(PSMFormaControllerEvent) -> Void"}),a.nearestFormaWithController=function(e){return null==e?(p.Host.logging.logForCategory(v.LogCategories.kDrag,"nearestFormaWithController nil startingForma",m.LogLevelEnum.ERROR_LEVEL),null):l.opt(e,(function(e){return e.visit(c.FormaTraversal.NearestAncestor,(function(e,t,o){return null!=e.controller}))}))},a.getNearestActionableController=function(e){return null==e?(p.Host.logging.logForCategory(v.LogCategories.kDrag,"getNearestActionableController nil startingForma",m.LogLevelEnum.ERROR_LEVEL),null):e.visit(c.FormaTraversal.NearestAncestor,(function(e,t,o){var n;return!!(n=e.controller)&&(n.selectable||n.moveable)}))},a.targetForma=function(e,t,o){if(null==t)return[null,null];for(var n=a.getNearestActionableController(t),r=t;null!=n;){if(null==n.controller)return S.LegacyCoreAssert.fail("PSMpD getNearest calls failed",void 0,"targetForma","FormaDrag.swift",79),[null,r];var i,l=h.BeginPointerTrackingEvent.init_bef7(n,[r],o);if(e.handleEvent(l),l.trackingResponse!=a.BeginPointerTrackingResponseEnum.TrackAsGroup)return l.trackingResponse==a.BeginPointerTrackingResponseEnum.TrackWithinGroup?[n.controller,r]:(S.LegacyCoreAssert.isTrue(l.trackingResponse==a.BeginPointerTrackingResponseEnum.DoNotTrack,"unknown tracking response",void 0,"targetForma","FormaDrag.swift",105),[null,r]);if(!(i=n.parent))return[null,r];r=n,n=a.nearestFormaWithController(i),S.LegacyCoreAssert.isTrue(null!=n,"nearestFormaWithController unexpectedly returned nil",{kind:i.kind},"targetForma","FormaDrag.swift",92)}return[null,r]},a.FormaState=(n=function(e,t){this.draggedForma_=e,this.startPlacement_=t},l.defineClass({name:"FormaState",ctor:n,props:{update:function(){this.startPlacement_=this.draggedForma_.placement},clone:function(){return new n(this.draggedForma_,this.startPlacement_)}}}),n),a.FormaPageDragDelegate=(r=function(e,t,o){this.draggedFormae_=[],this.delegate=e,this.dragController=t,this.modifierKeys={},s.CoreObject.call(this);for(var n=l.iter(o);!n.done;n.next()){var r=n.value;this.targetNewForma(r)}},l.defineClass({name:"FormaPageDragDelegate",ctor:r,superName:"CoreObject",statics:{_implements:function(e){return"ActiveDragDelegateProtocol"==e}},props:{draggedFormae:{get:function(){return this.draggedFormae_.map((function(e){return e.draggedForma_}),this)}},updateModifierKeys:function(e){e.pointers.length>0&&(this.modifierKeys=l.clone(e.pointers[0].modifierKeys))},targetNewForma:function(e){this.draggedFormae_.push(new a.FormaState(e,e.placement))},startPlacementObsolete:{get:function(){return l.first(this.draggedFormae_).startPlacement_}},forEachDraggedForma:function(e){for(var t=l.iter(this.draggedFormae_);!t.done;t.next()){var o=t.value;e(o.draggedForma_,o.startPlacement_)}},activeDragDidBegin:function(e){var t=new h.BeginFormaDragEvent(e);this.delegate.handleEvent(t)},activeDragDidActivate:function(e){return 1!=e.pointers.length||e.pointers[0].type!=C.PointerTypeEnum.Mouse},activeDragDidDeactivate:function(e,t){if(t){var o=new g.FormaAlignmentChangedEvent(l.first(this.draggedFormae),[],null);l.first(this.draggedFormae).beginUpdate(o),l.first(this.draggedFormae).endUpdate(o)}},activeDragClaimNewPointers:function(e,t,o){var n=[],r=[],i=e.pointers.length;S.LegacyCoreAssert.isTrue(i>0&&t.length>0,"no pointers participating in active drag",void 0,"FormaPageDragDelegate.activeDragClaimNewPointers","FormaDrag.swift",222);for(var a=!0,s=l.iter(this.draggedFormae);!s.done;s.next()){var u;if((u=s.value.controller)&&!u.rotateable){a=!1;break}}for(var c=l.iter(t);!c.done;c.next()){var h=c.value;o?n.push(h):a?r.push(h):n.push(h)}return e.commitWithNewPointers(r,!0),n=n.concat(r)},activeDragDidCommit:function(e){for(var t=l.iter(l.range(0,this.draggedFormae_.length,!1));!t.done;t.next()){var o=t.value;this.draggedFormae_[o].update()}},activeDragDidMove:function(e,t){var o=new h.FormaDragEvent(e);this.delegate.handleEvent(o),this.updateModifierKeys(e)},activeDragDidChangePace:function(e,t,o){},activeDragHeldPointerEndedAsTap:function(e,t){},activeDragDidEnd:function(e,t,o){if(t){var n=new h.EndFormaDragEvent(e);this.delegate.handleEvent(n)}else for(var r=l.opt(e.pointerStateMachine,(function(e){return e.owner})).selection,i=l.iter(o);!i.done;i.next()){var s=i.value;if(!s.cancelled){var u,c,g=l.opt(l.as(s.currentPage,d.FormaPage),(function(e){return e.formaAtPoint(s.startLocation,void 0,null)}));if(null==g)return;(u=a.getNearestActionableController(g))&&(s.tapCount%2==1?((c=new h.FormaClickEvent(u)).clickLocation=s.startLocation,c.modifierKeys=l.clone(e.activeDragDelegate.modifierKeys),!p.Host.platform.isWeb&&A.SelectionFacade.enableAdditionalMultiSelectGestures()&&null!=u.controller&&u.controller.canMultiSelect&&(r.selectedCount>1||o.length>1)&&(c.modifierKeys.shift=!0),this.delegate.handleEvent(c)):((c=new h.FormaDoubleClickEvent(u)).clickLocation=s.startLocation,c.modifierKeys=l.clone(e.activeDragDelegate.modifierKeys),this.delegate.handleEvent(c)))}}}}}),r),a.FormaPagePointerStateMachineDelegate=(i=function(e){this.myDrags=[],this.delegate=e,s.CoreObject.call(this)},l.defineClass({name:"FormaPagePointerStateMachineDelegate",ctor:i,superName:"CoreObject",statics:{_implements:function(e){return"PointerStateMachineDelegateProtocol"==e}},props:{activeDragDidFinish:function(e,t){l.remove(this.myDrags,t)},formaeInFlight:function(){for(var e=[],t=l.iter(this.myDrags);!t.done;t.next()){var o=t.value.activeDragDelegate;e=e.concat(o.draggedFormae)}return e},createDragsForPointers:function(e,t,o,n){for(var r=l.clone(t),i=l.clone(this.newDragsForPointers(e,r,o,n)),a=l.iter(i);!a.done;a.next()){var s=a.value;e.appendDrag(s),this.myDrags.push(s)}return r},newDragsForPointers:function(e,t,o,n){var r=[];if(0==t.length)return r;var i=l.as(e.owner,u.DocumentController),s=l.opt(i,(function(e){return e.selection})),h=function(e,t){var o,n;return(o=l.opt(e,(function(e){return e.viewportTransform})))||(o=l.opt(l.opt(t,(function(e){return e.page.view})),(function(e){return e.getViewportTransform()})))?Math.sqrt(Math.abs(o.determinant)):null!=(n=l.opt(i,(function(e){return e.viewScale})))?n:1},g=!0;if(p.Host.platform.isWeb&&!s.inCropMode){g=!1;for(var m=l.iter(t);!m.done;m.next())if(m.value.type==C.PointerTypeEnum.Touch){g=!0;break}if(!g&&(A.SelectionFacade.isMultiSelect(s)||A.SelectionFacade.isGroupSelect(s))&&1==t.length&&t[0].type==C.PointerTypeEnum.Mouse){var v=l.clone(i.model.handles.getAll());if(v.length>0&&null!=l.as(v[0],f.BoxTransformHandles)){var S=v[0],k=S.reference.bounds,L=S.reference.placement.inverse.transformPoint(t[0].currentLocation);g=k.containsPoint(L)}}}var b,_=null,R=[];if(b=l.opt(s,(function(e){return e.asFormaArray()})))for(var I=l.iter(b);!I.done;I.next()){var w,D,x,P=I.value,E=P;l.opt(s,(function(e){return 1==e.inCropMode&&y.ImageFacade.isFrame(P)}))?(w=y.ImageFacade.getImageFormaForForma(P))&&(E=w):((D=F.VideoFacade.getVideoFormaForForma(P))&&(E=D),(x=y.ImageFacade.getImageFormaForForma(P))&&(x.isLogo()||(E=x)));var M=a.targetForma(this.delegate,E,s),N=M[0],G=M[1];(z=N)&&(Y=G)&&(null==_?(_=z,R.push(Y)):l.opt(_,(function(e){return e.kind==z.kind}))&&R.push(Y))}if(g&&null!=_&&0==n){(J=new a.FormaPageDragDelegate(this.delegate,_,R)).modifierKeys=l.clone(t[0].modifierKeys);for(var B=!0,O=l.iter(R);!O.done;O.next()){var U=O.value;if((z=U.controller)&&!z.rotateable){B=!1;break}}if(!B)for(;t.length>1;)t.pop();var H=new T.ActiveDrag(e,J,t,null,h(null,null));r.push(H)}for(;t.length>0;){var z,Y,W=t.pop(),V=(E=l.opt(l.as(W.currentPage,d.FormaPage),(function(e){return e.formaAtPoint(W.startLocation,void 0,null)})),a.targetForma(this.delegate,E,s));if(N=V[0],G=V[1],(z=N)&&(Y=G)){for(var K=l.iter(r);!K.done;K.next()){var X=K.value,j=X.activeDragDelegate,q=j.dragController==z&&l.eq(c._equality_Forma_Forma,l.first(j.draggedFormae),Y);if(!o||q){if(Y.controller.rotateable){var Z=[W];X.commitWithNewPointers(Z,!0)}H=X;break}}if(null==H){if(!o&&n+r.length>0)break;var J;(J=_==z&&l.containsEq(R,Y,c._equality_Forma_Forma)&&n+r.length==0?new a.FormaPageDragDelegate(this.delegate,z,R):new a.FormaPageDragDelegate(this.delegate,z,[Y])).modifierKeys=l.clone(W.modifierKeys),Z=[W],H=new T.ActiveDrag(e,J,Z,null,h(W,Y)),r.push(H)}}}return r}}}),i)},yhkb:function(e,t,o){var n,r,i=t,a=o("oAGj"),l=o("kYI4"),s=o("SpAV"),u=o("9WSY"),c=o("gXiO"),h=o("C42b"),d=o("ascj"),g=o("R0Y+"),p=o("dJuF"),f=o("FNB+"),m=o("9Lk3"),y=o("m404"),v=o("fdtz"),S=o("uWOl"),C=o("fNpk"),T=o("c+uM"),A=o("jcfx"),F=o("uxH+"),k=o("Zifs"),L=o("aN2p"),b=o("umUn"),_=o("T6jX"),R=o("8t9B");i.ColorLibraryController=(n=function e(t,o){this._themeKeys=null,this.DERIVED_LIGHT_BRIGHTNESS=.98,this.DERIVED_LIGHT_SATURATION=.03,this.DERIVED_DARK_BRIGHTNESS=.05;var n=this;c.CoreObject.call(this),this.library=t,this.page=o,this.librarySubscription_=a.opt(this.library,(function(e){return e.subscribe(n,u.ColorLibraryChangedMessage.TYPE)})),this.library.setColors({black:b.TheoColor.init_5344(k.SolidColor.BLACK,null,null),white:b.TheoColor.init_5344(k.SolidColor.WHITE,null,null)}),null==t.color("themeColor0")&&null==t.color("themeColor1")&&this.library.setColors({themeColor0:b.TheoColor.init_5344(e.defaultColor0,null,null),themeColor1:b.TheoColor.init_5344(e.defaultColor1,null,null),themeDerivedDark:b.TheoColor.init_5344(new k.SolidColor(.1,0,.1,1),null,null),themeDerivedLight:b.TheoColor.init_5344(new k.SolidColor(1,.9,1,1),null,null)})},r={},a.defineClass({name:"ColorLibraryController",ctor:n,superName:"CoreObject",statics:{kDefaultNumThemeColors:5,BLACK_KEY:"black",WHITE_KEY:"white",USER_KEY_PREFIX:"userColor",BW_KEYS:{get:function(){return void 0===r.BW_KEYS&&(r.BW_KEYS=[n.BLACK_KEY,n.WHITE_KEY]),r.BW_KEYS}},THEME_DERIVED_BW_KEYS:["themeDerivedLight","themeDerivedDark"],THEME_PROFILING_DERIVED_COLORS:["theme0Light","theme0Dark","theme1Light","theme1Dark","theme2Light","theme2Dark","theme3Light","theme3Dark","theme4Light","theme4Dark"],DERIVED_BASE_KEYS:["filterBase1","filterBase2","filterBase3"],FILTER_MULTIPLY_KEYS:["filterMultiply1","filterMultiply2","filterMultiply3"],FILTER_OVERLAY_KEYS:["filterOverlay1","filterOverlay2","filterOverlay3"],FILTER_BLEND_KEYS:["filterBlend1","filterBlend2","filterBlend3"],FILTER_SCREEN_KEYS:["filterScreen1","filterScreen2","filterScreen3"],FILTER_DUOTONE_LOW_KEYS:["filterDuotoneLow1","filterDuotoneLow2","filterDuotoneLow3"],FILTER_DUOTONE_HIGH_KEYS:["filterDuotoneHigh1","filterDuotoneHigh2","filterDuotoneHigh3"],IMAGE_KEYS:["imageColor0","imageColor1","imageColor2","imageColor3","imageColor4","imageColor5","imageColor6","imageColor7","imageColor8","imageColor9"],IMAGE_DERIVED_KEYS:["imageDerivedDominant","imageDerivedInteresting"],getLightnessContrastKey:function(e){return e+"LightnessContrast"},getBackgroundContrastKey:function(e){return e+"BackgroundContrast"},DERIVED_KEY_MAP:{filterOverlay1:"filterBase1",filterOverlay2:"filterBase2",filterOverlay3:"filterBase3",filterMultiply1:"filterBase1",filterMultiply2:"filterBase2",filterMultiply3:"filterBase3",filterScreen1:"filterBase1",filterScreen2:"filterBase2",filterScreen3:"filterBase3",filterBlend1:"filterBase1",filterBlend2:"filterBase2",filterBlend3:"filterBase3",filterDuotoneLow1:"filterBase1",filterDuotoneLow2:"filterBase2",filterDuotoneLow3:"filterBase3",filterDuotoneHigh1:"filterBase1",filterDuotoneHigh2:"filterBase2",filterDuotoneHigh3:"filterBase3"},ALL_DERIVED_KEYS:{get:function(){return void 0===r.ALL_DERIVED_KEYS&&(r.ALL_DERIVED_KEYS=n.makeAllKeys()),r.ALL_DERIVED_KEYS}},makeAllKeys:function(){var e=a.clone(n.THEME_DERIVED_BW_KEYS);return a.append(e,n.THEME_PROFILING_DERIVED_COLORS),a.append(e,n.DERIVED_BASE_KEYS),a.append(e,n.FILTER_MULTIPLY_KEYS),a.append(e,n.FILTER_OVERLAY_KEYS),a.append(e,n.FILTER_BLEND_KEYS),a.append(e,n.FILTER_SCREEN_KEYS),a.append(e,n.FILTER_DUOTONE_LOW_KEYS),a.append(e,n.FILTER_DUOTONE_HIGH_KEYS),a.append(e,n.THEME_PROFILING_DERIVED_COLORS),e},defaultColor0:{get:function(){return void 0===r.defaultColor0&&(r.defaultColor0=new k.SolidColor(.95,.05,.05,1)),r.defaultColor0}},defaultColor1:{get:function(){return void 0===r.defaultColor1&&(r.defaultColor1=new k.SolidColor(.95,.05,.95,1)),r.defaultColor1}},getNextKeyInSet:function(e){var t,o=e.substr(e.length-1,1);if(o>="0"&&o<="9"&&null!=(t=a.toInt(o))){var r=e.substr(0,e.length-1),i=r+a.toString(t+1);if(n.ALL_DERIVED_KEYS.includes(i))return[i,!1];if(i=r+"1",n.ALL_DERIVED_KEYS.includes(i))return[i,!0]}return[e,!1]},keyFromImage:function(e){return!(!n.IMAGE_KEYS.includes(e)&&!n.IMAGE_DERIVED_KEYS.includes(e))},toTheoColors:function(e){for(var t=[],o=a.iter(e);!o.done;o.next()){var n=o.value;t.push(b.TheoColor.init_5344(n.color))}return t},toThemeColorsWithRole:function(e,t){var o=[];C.LegacyCoreAssert.isTrue(e.length==t.length,"themeColors and colorsWithRole mismatch in count",void 0,"ColorLibraryController.toThemeColorsWithRole","ColorLibraryController.swift",2027);for(var n=a.iter(a.range(0,Math.min(e.length,t.length),!1));!n.done;n.next()){var r=n.value;o.push(new g.ThemeColorWithRole(t[r].role,e[r]))}return o},_implements:function(e){return"TheoMessageSubscriber"==e}},props:{randomDbl:function(){return a.toDouble(h.CoreRandom.nextInt)/a.toDouble(h.CoreRandom.randMax)},getNumThemeColorKeys:function(){return this.getThemeColorKeys().length},getThemeColorKeys:function(){var e=this,t=[];return null==this._themeKeys&&(this._themeKeys=[],this.library.forEachColor((function(t,o){t.includes("themeColor")&&!t.includes("Contrast")&&e.library.color(t)&&e._themeKeys.push(t)})),0==this._themeKeys.length&&(this._themeKeys.push("themeColor0"),this._themeKeys.push("themeColor1"))),a.append(t,a.sort(this._themeKeys)),t},getNumProfilingColorsKeys:function(){return this.getProfilingColorKeys().length},getProfilingColorKeys:function(){for(var e=[],t=2*this.getNumThemeColorKeys(),o=a.iter(a.range(0,Math.min(t,n.THEME_PROFILING_DERIVED_COLORS.length),!1));!o.done;o.next()){var r=o.value,i=n.THEME_PROFILING_DERIVED_COLORS[r];this.library.color(i)&&e.push(i)}return e},setLightnessContrastColorAndReturnKey:function(e,t){var o=n.getLightnessContrastKey(e);if(null==this.library.color(o)){var r=t.rgbColor.contrastWithSelf();this.setTheoColorToLibrary(b.TheoColor.init_5344(r,null,null),o)}return o},isSparkColorInUse:function(e){return this.areSparkColorsInUse([e])},areSparkColorsInUse:function(e){if(0==e.length)return!1;for(var t=a.iter(a.toSequence(this.getThemeColorKeys()));!t.done;t.next()){var o=t.value.element,n=this.library.color(o);if(null!=n.sparkElementID&&n.sparkElementID.length>0&&e.includes(n.sparkElementID))return!0}return!1},areAnySparkColorsInUse:function(){for(var e=a.iter(a.toSequence(this.getThemeColorKeys()));!e.done;e.next()){var t=e.value.element,o=this.library.color(t);if(a.opt(o,(function(e){return null!=e.sparkElementID&&o.sparkElementID.length>0})))return!0}return!1},getSparkColor:function(e){if(a.isEmpty(e))return null;for(var t=a.iter(a.toSequence(this.getThemeColorKeys()));!t.done;t.next()){var o=t.value.element,n=this.library.color(o);if(null!=n.sparkElementID&&n.sparkElementID==e)return n}return null},updateSparkColor:function(e){for(var t=a.iter(a.toSequence(this.getThemeColorKeys()));!t.done;t.next()){var o=t.value.element,r=this.library.color(o);if(null!=r.sparkElementID&&r.sparkElementID==e.sparkElementID){this.library.setColor(o,e);var i=n.getLightnessContrastKey(o);if(null!=this.library.color(i)){var l=e.rgbColor.contrastWithSelf();this.setTheoColorToLibrary(b.TheoColor.init_5344(l,null,null),i)}return void this.updateDerivedColors()}}C.LegacyCoreAssert.fail("asked to update spark color which isn't currently used.",void 0,"ColorLibraryController.updateSparkColor","ColorLibraryController.swift",382)},calculateShadeDelta:function(e){for(var t=a.iter(a.toSequence(this.getThemeColorKeys()));!t.done;t.next()){var o=t.value.element,n=this.library.color(o);if(n.isBrandkitColor()&&n.isBrandkitPrimaryColor())for(var r=a.iter(e);!r.done;r.next()){var i=r.value;if(i.isBrandkitPrimaryColor()){var l=n.getBrandkitShadeRole(),s=i.getBrandkitShadeRole();if(null!=l&&null!=s){var u=l.substr(b.SHADE_ROLE_PREFIX.length),c=s.substr(b.SHADE_ROLE_PREFIX.length),h=a.toInt(u),d=a.toInt(c);if(null!=h&&null!=d)return d-h}return 0}}}return 0},updateSparkColorsByRole:function(e){for(var t=[],o=e.concat(),n=this.calculateShadeDelta(e),r=a.iter(a.toSequence(this.getThemeColorKeys()));!r.done;r.next()){var i=r.value.element;if((l=this.library.color(i)).isBrandkitColor()){var l,s=(l=this.library.color(i)).getBrandkitShadeRole();if(null!=s&&0!=n){var u=s.substr(b.SHADE_ROLE_PREFIX.length),c=a.toInt(u);if(null!=c&&(C.LegacyCoreAssert.isTrue(c>=0&&c<=6,"Shade out of range",void 0,"ColorLibraryController.updateSparkColorsByRole","ColorLibraryController.swift",453),0!=c&&6!=c)){var h=c+n;h<=0?h+=5:h>=6&&(h-=5),C.LegacyCoreAssert.isTrue(h>=0&&h<=6,"Desired shade out of range",void 0,"ColorLibraryController.updateSparkColorsByRole","ColorLibraryController.swift",467),s=b.SHADE_ROLE_PREFIX+a.toString(h)}}for(var d=!1,g=a.iter(o);!g.done;g.next()){var p=g.value;if(null!=s){if(p.getBrandkitShadeRole()==s){this.library.setColor(i,p),t.push(p),a.remove(o,p),d=!0;break}}else if(l.isBrandkitPrimaryColor()&&p.isBrandkitPrimaryColor()||l.isBrandkitSecondaryColor()&&p.isBrandkitSecondaryColor()){this.library.setColor(i,p),t.push(p),a.remove(o,p),d=!0;break}}if(!d)for(var f=a.iter(t);!f.done;f.next())if((p=f.value).isBrandkitSecondaryColor()){this.library.setColor(i,p),d=!0;break}}}this.updateDerivedColors(),a.info("updateSparkColorsByRole given list of "+e.length+" new colors. Used "+t.length+" of them.")},addNewThemeColorKey:function(){for(var e=2,t=a.clone(this.getThemeColorKeys());t.includes("themeColor"+a.toString(e));)e+=1;var o="themeColor"+a.toString(e);return this._themeKeys.push(o),o},addNewThemeKeyWithColor:function(e){var t=this.addNewThemeColorKey();return this.library.setColor(t,e),t},ensureDerivedColorsAreSet:function(){if(0==this.library.hasEntries(n.ALL_DERIVED_KEYS)){for(var e=a.clone(this.getColorThemeAsArrayOfTheoColors()),t=a.clone(this.generateDerivedColorsForTheme(e)),o={},r=a.iter(t);!r.done;r.next()){var i=r.key,l=r.value;null==this.library.color(i)&&(o[i]=l)}a.opt(this.library,(function(e){return e.setColors(o)}))}},getTheoColorForSolidColor:function(e){for(var t=a.clone(this.getThemeColorKeys()),o=a.iter(t);!o.done;o.next()){var n=o.value,r=this.library.color(n);if(null!=r&&a.eq(k._equality_SolidColor_SolidColor,e,r.rgbColor))return r}return b.TheoColor.init_5344(e,null,null)},getKeyOfColorInTheme:function(e){for(var t,o=this.getThemeColorKeys().concat(n.THEME_DERIVED_BW_KEYS),r=a.iter(o);!r.done;r.next()){var i=r.value;if(a.eq(k._equality_SolidColor_SolidColor,e.rgbColor,a.opt(this.library.color(i),(function(e){return e.rgbColor})))){t=i;break}}return t},getCurrentThemeHexString:function(){for(var e=[],t=a.iter(this.getThemeColorKeys());!t.done;t.next()){var o,n=t.value;(o=this.library.color(n))&&e.push(o.rgbColor.hex)}return e.join(",")},getBaseThemeKeyForDerivedKey:function(e){var t,o,r;return null!=(o=n.DERIVED_KEY_MAP[e])&&(r=this.library.color(o))&&(t=this.getKeyOfColorInTheme(r)),t},ensureUniqueColors:function(e){for(var t=a.sort(e,(function(e,t){return e.lightness<t.lightness})),o=[],n=a.iter(t);!n.done;n.next()){var r=n.value;(0==o.length||r.distanceTo(a.last(o).rgbColor)>2.3)&&o.push(b.TheoColor.init_5344(r,null,null))}if(o.length<e.length){for(var i=e.length-o.length,l=o[o.length-1].rgbColor.red,s=o[o.length-1].rgbColor.green,u=o[o.length-1].rgbColor.blue,c=o[o.length-1].rgbColor.alpha,h=a.iter(a.range(1,i,!0));!h.done;h.next()){var d=h.value,g=l+a.toDouble(d)*(1-l)/a.toDouble(i),p=s+a.toDouble(d)*(1-s)/a.toDouble(i),f=u+a.toDouble(d)*(1-u)/a.toDouble(i);o.push(b.TheoColor.init_5344(new k.SolidColor(g,p,f,c),null,null))}return o=a.reverse(o)}return o},generateDerivedColorsForTheme:function(e){if(e.length<this.getNumThemeColorKeys())return{};var t={},o=e[0].rgbColor.asHSB,r=new y.HSBColor(o.h,o.s,this.DERIVED_DARK_BRIGHTNESS,o.alpha),i=new y.HSBColor(o.h,this.DERIVED_LIGHT_SATURATION,this.DERIVED_LIGHT_BRIGHTNESS,o.alpha);t.themeDerivedDark=b.TheoColor.init_5344(r.asRGB,null,null),t.themeDerivedLight=b.TheoColor.init_5344(i.asRGB,null,null);for(var l=a.iter(a.range(0,e.length,!1));!l.done;l.next()){var s=(o=e[C=l.value].rgbColor.asHSB).b<.22?.03:o.b-.2,u=o.b>.78?.97:o.b+.2,c=o.s<.22?.03:o.s-.2,h=o.s>.78?.97:o.s+.2;r=new y.HSBColor(o.h,h,s,o.alpha),i=new y.HSBColor(o.h,c,u,o.alpha),t["theme"+a.toString(C)+"Dark"]=b.TheoColor.init_5344(r.asRGB,null,null),t["theme"+a.toString(C)+"Light"]=b.TheoColor.init_5344(i.asRGB,null,null)}for(var d=[],g=a.iter(a.range(0,2,!0));!g.done;g.next()){for(var p=g.value,f=0,m=0,v=a.iter(a.toSequence(e));!v.done;v.next()){var S=v.value,C=S.offset,T=S.element;if(!d.includes(C)){var A=T.rgbColor,F=0;A.asHSB.s>.1&&(F+=100+A.asHSB.s),A.asLAB.l>30&&(F+=100);for(var k=100,L=a.iter(d);!L.done;L.next()){var _=L.value;k=Math.min(k,A.asLAB.hueDistance(e[_].rgbColor.asLAB))}f<(F+=k)&&(f=F,m=C)}}d.push(m);var R=e[m];t[n.DERIVED_BASE_KEYS[p]]=R;var I=R.rgbColor.asHSB;t[n.FILTER_MULTIPLY_KEYS[p]]=b.TheoColor.init_5344(new y.HSBColor(I.h,(I.s+.5)/2,(I.b+1)/2,I.alpha).asRGB,null,null),t[n.FILTER_OVERLAY_KEYS[p]]=b.TheoColor.init_5344(new y.HSBColor(I.h,(I.s+1)/2,(I.b+1)/2,I.alpha).asRGB,null,null),t[n.FILTER_BLEND_KEYS[p]]=b.TheoColor.init_5344(new y.HSBColor(I.h,I.s,I.b,I.alpha).asRGB,null,null),t[n.FILTER_SCREEN_KEYS[p]]=b.TheoColor.init_5344(new y.HSBColor(I.h,I.s,I.b,I.alpha).asRGB,null,null),t[n.FILTER_DUOTONE_LOW_KEYS[p]]=b.TheoColor.init_5344(new y.HSBColor(I.h,Math.min(I.s,.8),Math.min(I.b,.2),I.alpha).asRGB,null,null),t[n.FILTER_DUOTONE_HIGH_KEYS[p]]=b.TheoColor.init_5344(new y.HSBColor(I.h,Math.min(I.s,.8),Math.max(I.b,.8),I.alpha).asRGB,null,null)}return t},updateDerivedColors:function(){var e=a.clone(this.getColorThemeAsArrayOfTheoColors()),t=a.clone(this.generateDerivedColorsForTheme(e));this.library.setColors(t)},setTheoColorToLibrary:function(e,t){var o,n=this.library.color(t);this.library.setColor(t,e),(o=a.opt(this.page,(function(e){return e.document})))&&(null!=e.sparkElementID?l.BrandingFacade.brandDocumentForElement(o,e.sparkElementID,l.AUTHORING_CONTEXT_TYPE_COLOR):a.opt(n,(function(e){return null!=e.sparkElementID}))&&l.BrandingFacade.unBrandDocumentIfNoBrandedElements(o))},getSolidColorForKey:function(e){var t=this.library.color(e);return a.opt(t,(function(e){return e.rgbColor}))},getTheoColorForKey:function(e){return this.library.color(e)},clearCache:function(){this._themeKeys=null},regenerateThemeKeyCache:function(){this.clearCache(),this.getThemeColorKeys()},onMessage:function(e){var t;if((t=a.as(e,u.ColorLibraryChangedMessage))&&null!=this._themeKeys&&t.isAfter){for(var o=!1,n=a.iter(t.affectedColorIDs);!n.done;n.next()){var r=n.value;if(a.opt(this.library,(function(e){return null!=e.color(r)}))){o=!0;break}}o&&this.clearCache()}},recordUndoState:function(){return this.library.recordUndoState()},restoreUndoState:function(e){var t;(t=a.as(e,["Dictionary","String",p.DBProperty]))&&(this.library.matchProperties(t),this.clearCache())},isDefaultInitialTheme:function(){var e,t,o=a.clone(this.getThemeColorKeys());return!(2!=o.length||!(e=a.opt(a.opt(this.library,(function(e){return e.color(o[0])})),(function(e){return e.rgbColor})))||!(t=a.opt(a.opt(this.library,(function(e){return e.color(o[1])})),(function(e){return e.rgbColor}))))&&(a.eq(k._equality_SolidColor_SolidColor,e,n.defaultColor0)&&a.eq(k._equality_SolidColor_SolidColor,t,n.defaultColor1))},getColorThemeAsArrayOfSolidColors:function(){for(var e=[],t=a.clone(this.getThemeColorKeys()),o=a.iter(t);!o.done;o.next()){var n,r=o.value;(n=this.library.color(r))&&e.push(n.rgbColor)}return a.sort(e,(function(e,t){return e.lightness<t.lightness}))},getColorThemeAsArrayOfTheoColors:function(){var e=[],t=a.clone(this.getThemeColorKeys());a.sortInPlace(t);for(var o=a.iter(t);!o.done;o.next()){var n,r=o.value;(n=this.library.color(r))&&e.push(n)}return a.sort(e,(function(e,t){return e.rgbColor.lightness<t.rgbColor.lightness}))},getThemeDerivedColorsAsArrayOfSolidColors:function(){for(var e=[],t=a.iter(a.toSequence(n.THEME_DERIVED_BW_KEYS));!t.done;t.next()){var o,r=t.value.element;(o=this.library.color(r))&&e.push(o.rgbColor)}return e},getThemeDerivedColorsAsArrayOfTheoColors:function(){for(var e=[],t=a.iter(a.toSequence(n.THEME_DERIVED_BW_KEYS));!t.done;t.next()){var o,r=t.value.element;(o=this.library.color(r))&&e.push(o)}return e},applyLegacyFilterColorsAndReturnKeys:function(e){var t,o,r,i;if((r=a.as(e,S.ImageStyle))&&r.name==S.ImageStyle.NAME_NEWDUOTONE)return{primaryKey:t,secondaryKey:o};if(i=e.filter){var l,s;switch(i.name){case"Greyscale":case"GreyscaleDark":t="themeDerivedDark",o="themeDerivedDark";break;case"Monochrome":t=n.FILTER_MULTIPLY_KEYS[0];break;case"Duotone":t=n.FILTER_DUOTONE_LOW_KEYS[0],o=n.FILTER_DUOTONE_HIGH_KEYS[1];break;case"DesaturateMultiply":t=n.FILTER_MULTIPLY_KEYS[0];break;case"ReduceContrastOverlay":t=n.FILTER_OVERLAY_KEYS[0];break;default:t=n.FILTER_MULTIPLY_KEYS[0]}(l=e.colors.color(d.ColorRole.FieldPrimary))&&this.library.setColor(t,b.TheoColor.init_5344(l,null,null)),(s=e.colors.color(d.ColorRole.FieldSecondary))&&null!=o&&this.library.setColor(o,b.TheoColor.init_5344(s,null,null))}return{primaryKey:t,secondaryKey:o}},mergeSolidColorDictionaries:function(e,t){for(var o=a.clone(e),n=a.iter(t);!n.done;n.next()){var r=n.key,i=n.value;o[r]=i}return o},mergeTheoColorDictionaries:function(e,t){for(var o=a.clone(e),n=a.iter(t);!n.done;n.next()){var r=n.key,i=n.value;o[r]=i}return o},applyLegacyColorThemeFromDocument:function(e){var t,o={},n=[];if(t=a.opt(e,(function(e){return e.colorTheme})))for(var r=a.iter(a.range(0,5,!1));!r.done;r.next()){var i,l=r.value;if(i=a.as(t.swatchByTag("theme",a.toString(l)),L.SimpleSwatch)){var s,u=this.getThemeColorKeys()[l];if(s=i.color){var c=b.TheoColor.init_5344(s,null,null);o[u]=c,n.push(c)}}}else for(var h=a.iter(a.range(0,this.getNumThemeColorKeys(),!1));!h.done;h.next()){l=h.value;var d=1/a.toDouble(l+1),g=(u=this.getThemeColorKeys()[l],new k.SolidColor(d,d,d,1));c=b.TheoColor.init_5344(g,null,null),o[u]=c,n.push(c)}var p=a.clone(this.generateDerivedColorsForTheme(n));this.library.setColors(this.mergeTheoColorDictionaries(o,p))},deleteThemeColorsFromPage:function(e){for(var t=a.iter(e);!t.done;t.next()){var o=t.value;this.library.setColor(o,null)}var n;(n=this.page)&&(n.root.visitAll(f.FormaTraversal.PreOrder,(function(t){var o=t.style.colors.colorID(d.ColorRole.FieldPrimary);null!=o&&e.includes(o)&&t.style.colors.setColorId(d.ColorRole.FieldPrimary,"themeColor0");var n=t.style.colors.colorID(d.ColorRole.FieldSecondary);null!=n&&e.includes(n)&&t.style.colors.setColorId(d.ColorRole.FieldSecondary,"themeColor1");var r=t.style.colors.colorID(d.ColorRole.Border);null!=r&&e.includes(r)&&t.style.colors.setColorId(d.ColorRole.Border,"themeDerivedDark");var i=t.style.colors.colorID(d.ColorRole.Shadow);null!=i&&e.includes(i)&&t.style.colors.setColorId(d.ColorRole.Shadow,"themeDerivedDark")})),this.clearCache())},deleteExtraThemeColors:function(e){var t=[],o=a.clone(this.getThemeColorKeys()),r="themeColor".length;for(a.sortInPlace(o,(function(e,t){var o=e.substr(r),n=t.substr(r);return a.toInt(o)<a.toInt(n)}));o.length>e;){var i=o.pop();t.push(i),t.push(n.getLightnessContrastKey(i)),t.push(n.getBackgroundContrastKey(i))}this.deleteThemeColorsFromPage(t)},applyColorTheme:function(e,t,o){if(void 0===o&&(o=!1),e.length<2)C.LegacyCoreAssert.fail("Color themes must have at least 2 colors",void 0,"ColorLibraryController.applyColorTheme","ColorLibraryController.swift",1303);else{if(this.library.paletteID=t,o&&e.length==this.getNumThemeColorKeys()){function n(e,t){return e.rgbColor.print()<t.rgbColor.print()}var r=a.clone(this.getColorThemeAsArrayOfTheoColors());a.sortInPlace(r,n);for(var i=a.sort(e,n),s=!0,u=a.iter(a.range(0,i.length,!1));!u.done;u.next()){var c=u.value;if(!a.eq(b._equality_TheoColor_TheoColor,r[c],i[c])){s=!1;break}}if(s)return}var h,d={},g=[];this.getNumThemeColorKeys()>e.length&&this.deleteExtraThemeColors(e.length);for(var p=a.iter(a.toSequence(e));!p.done;p.next()){var f=p.value,m=f.offset,y=f.element;d[m<this.getNumThemeColorKeys()?this.getThemeColorKeys()[m]:this.addNewThemeColorKey()]=y,g.push(y),null==h&&null!=y.sparkElementID&&(h=y)}var v,S,T=a.clone(this.generateDerivedColorsForTheme(g));this.library.setColors(this.mergeTheoColorDictionaries(d,T)),(v=a.opt(this.page,(function(e){return e.document})))&&(null!=h?l.BrandingFacade.brandDocumentForElement(v,h.sparkElementID,l.AUTHORING_CONTEXT_TYPE_COLOR):l.BrandingFacade.unBrandDocumentIfNoBrandedElements(v)),(S=this.page)&&(new A.ProfilingColorMap).updateRoleProfilingColorMap(S)}},enteredPalettePicker:function(){var e;(e=this.page)&&(new A.ProfilingColorMap).setPaletteMappingForFormaWithSameRGBColor(e)},returnCurrentPaletteMapping:function(){return(new A.ProfilingColorMap).getCurrentPaletteMapping()},getRandomBackgroundColor:function(){var e,t=a.clone(this.getThemeColorKeys());return(e=a.opt(this.page,(function(e){return e.document})))&&(l.BrandingFacade.isDocumentBranded(e,!1)||a.append(t,n.THEME_DERIVED_BW_KEYS)),t[h.CoreRandom.nextIntUniform(t.length)]},shuffleColorAssignments:function(){this.shuffleColorAssignmentsUsingMap()},applyNewColorToFormaStyle:function(e,t,o){var n;e.colors.setColorId(d.ColorRole.FieldPrimary,t),null!=(n=o)&&(e.colors.supportsRole(d.ColorRole.FieldSecondary)&&e.colors.setColorId(d.ColorRole.FieldSecondary,n),e.colors.supportsRole(d.ColorRole.Border)&&e.colors.setColorId(d.ColorRole.Border,n),e.colors.supportsRole(d.ColorRole.Shadow)&&e.colors.setColorId(d.ColorRole.Shadow,n))},shuffleColorAssignmentsUsingMap:function(e){void 0===e&&(e={});var t,o,n,r,i,l,u=this,c={};if(l=this.page){var h=(t=e[F.RootController.KIND])||null!=t?t:this.getRandomBackgroundColor();if(c[F.RootController.KIND]=h,l.root.style.colors.setColorId(d.ColorRole.FieldPrimary,h),(new A.ProfilingColorMap).updateRoleProfilingColorMap(l),(new A.ProfilingColorMap).updateCurrentColorIndices(),_.TheoDocumentUtils.enableFastHeuristicsForComplexPage(l,!0)){var g=a.clone(a.shuffle(this.getColorThemeAsArrayOfTheoColors()));return this.applyColorTheme(g,(o=this.library.paletteID)||null!=o?o:""),c}var p={};l.root.visitAll(f.FormaTraversal.PreOrder,(function(t){var o;if(o=t.controller){var l=!m.GridController.isBackgroundColoredCell(t);o instanceof m.GridController&&(o.shuffleColorAssignment(),l=!1);var h,g,f=o.kind+((n=p[o.kind])||null!=n?n:0),y=o.kind+((r=p[o.kind])||null!=r?r:0)+"_Highlight";if(null!=(h=e[f])){var v,S=e[f+"Secondary"];if(u.applyNewColorToFormaStyle(t.style,h,S),v=a.as(o,R.TypeLockupController)){var C,T;if(0==!v.charStyleRanges.length&&null!=(C=e[y])&&(T=a.opt(v.lockupStyle,(function(e){return e.characterStyles[R.TypeLockupController.HIGHLIGHT_STYLE]})))){var A=e[y+"Secondary"];u.applyNewColorToFormaStyle(T,C,A),v.updateGroup()}v.styleController.backgroundContrastCheck(!1,!0)}}else l&&o.shuffleColorAssignment();c[f]=t.style.colors.colorID(d.ColorRole.FieldPrimary),t.style.colors.supportsRole(d.ColorRole.FieldSecondary)&&(c[f+"Secondary"]=t.style.colors.colorID(d.ColorRole.FieldSecondary),s.CoreAssertDebugOnly.isTrue(!t.style.colors.supportsRole(d.ColorRole.Border)||t.style.colors.colorID(d.ColorRole.Border)==c[f+"Secondary"],"Shuffle gave us a different border color",void 0,"ColorLibraryController.shuffleColorAssignmentsUsingMap","ColorLibraryController.swift",1545),s.CoreAssertDebugOnly.isTrue(!t.style.colors.supportsRole(d.ColorRole.Shadow)||t.style.colors.colorID(d.ColorRole.Shadow)==c[f+"Secondary"],"Shuffle gave us a different shadow color",void 0,"ColorLibraryController.shuffleColorAssignmentsUsingMap","ColorLibraryController.swift",1546)),(v=a.as(o,R.TypeLockupController))&&(g=a.opt(a.opt(v.lockupStyle,(function(e){return e.characterStyles[R.TypeLockupController.HIGHLIGHT_STYLE]})),(function(e){return e.colors})))&&0==!v.charStyleRanges.length&&(v.updateGroup(),c[y]=g.colorID(d.ColorRole.FieldPrimary),g.supportsRole(d.ColorRole.FieldSecondary)&&(c[y+"Secondary"]=g.colorID(d.ColorRole.FieldSecondary),s.CoreAssertDebugOnly.isTrue(!g.supportsRole(d.ColorRole.Border)||g.colorID(d.ColorRole.Border)==c[y+"Secondary"],"Shuffle gave us a different border color",void 0,"ColorLibraryController.shuffleColorAssignmentsUsingMap","ColorLibraryController.swift",1555),s.CoreAssertDebugOnly.isTrue(!g.supportsRole(d.ColorRole.Shadow)||g.colorID(d.ColorRole.Shadow)==c[y+"Secondary"],"Shuffle gave us a different shadow color",void 0,"ColorLibraryController.shuffleColorAssignmentsUsingMap","ColorLibraryController.swift",1556))),p[o.kind]=((i=p[o.kind])||null!=i?i:0)+1}}))}return c},createInitialThemeFromImage:function(){var e;if(e=this.page){var t,o,r=null,i=a.clone(e.root.filterWithCallback((function(e){return e instanceof v.ImageForma})));if(i.length>0&&(t=a.as(i[0],v.ImageForma))&&(r=a.opt(t.contentNode,(function(e){return e.image}))),o=r){var l=a.clone(o.getImageColors(n.kDefaultNumThemeColors)),s=a.clone(this.ensureUniqueColors(l));this.applyColorTheme(s,"image"),this.shuffleColorAssignments()}else C.LegacyCoreAssert.fail("createInitialThemeFromImage has no image to create a theme from",void 0,"ColorLibraryController.createInitialThemeFromImage","ColorLibraryController.swift",1588)}},extractImageColors:function(){var e;if(e=this.page){var t,o,r=[],i=[],l={},s=a.clone(e.root.filterWithCallback((function(e){return e instanceof v.ImageForma&&!e.isLogo()&&e.parent.isBackgroundImage()})));s.length>0&&(t=a.as(s[s.length-1],v.ImageForma))&&(o=a.opt(t.contentNode,(function(e){return e.image})))&&(r=a.clone(o.getImageColors(n.kDefaultNumThemeColors)),i=a.clone(this.ensureUniqueColors(r)));for(var u=a.iter(a.toSequence(i));!u.done;u.next()){var c=u.value,h=c.offset,d=c.element;l[n.IMAGE_KEYS[h]]=d}this.library.setColors(l)}},getSuggestedColorThemesAsArraysOfTheoColors:function(){var e=[],t=[];null==this.library.color(n.IMAGE_KEYS[0])&&this.extractImageColors();for(var o=a.iter(a.toSequence(n.IMAGE_KEYS));!o.done;o.next()){var r,i=o.value.element;(r=this.library.color(i))&&t.push(r)}if(t.length>0){var l=a.clone(this.removeSimilarColors(t));l.length>2&&e.push(l)}var s=[];this.getTheoColorsUsedInPage(s);var u=n.kDefaultNumThemeColors-s.length+1;if(s.length>1&&u>0){for(var c=0,h=[],d=[],g=a.iter(s);!g.done;g.next()){var p=g.value,f=p.rgbColor.lightness;f>4&&f<96&&(h.push(p),d.push(p),c<u&&(c+=1,h.push(b.TheoColor.init_5344(p.rgbColor.contrastWithSelf())),f>50?d.push(b.TheoColor.init_5344(p.rgbColor.darkenForTint())):d.push(b.TheoColor.init_5344(p.rgbColor.lightenForTint()))))}var m=a.clone(this.removeSimilarColors(d));m.length>2&&e.push(m);var y=a.clone(this.removeSimilarColors(h));y.length>2&&e.push(y)}return e},removeSimilarColors:function(e){for(var t=a.sort(e,(function(e,t){return e.rgbColor.lightness<t.rgbColor.lightness})),o=[],n=a.iter(t);!n.done;n.next()){var r=n.value;(0==o.length||r.rgbColor.distanceTo(a.last(o).rgbColor)>2.3)&&o.push(r)}return o},getSuggestedColorsAsArraysOfTheoColors:function(){for(var e=a.clone(this.getSuggestedColorThemesAsArraysOfTheoColors()),t=[],o=a.iter(e);!o.done;o.next())for(var n=o.value,r=a.iter(n);!r.done;r.next()){var i=r.value;t.push(i)}return t},addUnlinkedColor:function(e){for(var t=0,o="unlinked"+a.toString(t),n=this.library.color(o);null!=n;)t+=1,o="unlinked"+a.toString(t),n=this.library.color(o);return this.library.setColor(o,b.TheoColor.init_5344(e,null,null)),o},getTheoColorsUsedInPage:function(e){var t,o=[];if(t=this.page){t.root.visitAll(f.FormaTraversal.PreOrder,(function(e){var t;null!=(t=e.style.colors.colorID(d.ColorRole.FieldPrimary))&&(o.includes(t)||o.push(t)),null!=(t=e.style.colors.colorID(d.ColorRole.FieldSecondary))&&(o.includes(t)||o.push(t)),null!=(t=e.style.colors.colorID(d.ColorRole.Border))&&(o.includes(t)||o.push(t)),null!=(t=e.style.colors.colorID(d.ColorRole.Shadow))&&(o.includes(t)||o.push(t))}));for(var n=a.iter(o);!n.done;n.next()){var r=n.value,i=this.library.color(r);null!=i&&e.push(i)}}},unusedColorKeys:function(e,t){var o=this,n=a.clone(this.getThemeColorKeys());if(t){for(var r=a.iter(this.getThemeColorKeys());!r.done;r.next()){var i=r.value,l=this.library.color(i);null!=l&&l.isBrandkitColor()&&a.remove(n,i)}if(0==n.length)return n}return a.opt(this.page,(function(t){return t.root.visitAll(f.FormaTraversal.PreOrder,(function(t){var r;if(null!=e&&t.formaID==e.formaID||(null!=(l=t.style.colors.colorID(d.ColorRole.FieldPrimary))&&(a.remove(n,l),null!=(s=o.getBaseThemeKeyForDerivedKey(l))&&null!=(u=a.indexOf(n,s))&&n.splice(u,1)),null!=(l=t.style.colors.colorID(d.ColorRole.FieldSecondary))&&(a.remove(n,l),null!=(s=o.getBaseThemeKeyForDerivedKey(l))&&null!=(u=a.indexOf(n,s))&&n.splice(u,1)),null!=(l=t.style.colors.colorID(d.ColorRole.Border))&&(a.remove(n,l),null!=(s=o.getBaseThemeKeyForDerivedKey(l))&&null!=(u=a.indexOf(n,s))&&n.splice(u,1)),null!=(l=t.style.colors.colorID(d.ColorRole.Shadow))&&(a.remove(n,l),null!=(s=o.getBaseThemeKeyForDerivedKey(l))&&null!=(u=a.indexOf(n,s))&&n.splice(u,1))),r=a.as(t.style,T.LockupStyle))for(var i=a.iter(r.characterStyles);!i.done;i.next()){var l,s,u,c=i.value;null!=(l=c.colors.colorID(d.ColorRole.FieldPrimary))&&(a.remove(n,l),null!=(s=o.getBaseThemeKeyForDerivedKey(l))&&null!=(u=a.indexOf(n,s))&&n.splice(u,1)),null!=(l=c.colors.colorID(d.ColorRole.FieldSecondary))&&(a.remove(n,l),null!=(s=o.getBaseThemeKeyForDerivedKey(l))&&null!=(u=a.indexOf(n,s))&&n.splice(u,1)),null!=(l=c.colors.colorID(d.ColorRole.Border))&&(a.remove(n,l),null!=(s=o.getBaseThemeKeyForDerivedKey(l))&&null!=(u=a.indexOf(n,s))&&n.splice(u,1)),null!=(l=c.colors.colorID(d.ColorRole.Shadow))&&(a.remove(n,l),null!=(s=o.getBaseThemeKeyForDerivedKey(l))&&null!=(u=a.indexOf(n,s))&&n.splice(u,1))}}))})),n},addColorsToTheme:function(e,t){for(var o=a.clone(this.unusedColorKeys(t,!0)),r=[],i=a.iter(a.range(0,e.length,!1));!i.done;i.next()){var l,s,u,c=e[i.value];null!=(s=this.getKeyOfColorInTheme(c))?(l=s,o.includes(s)&&a.remove(o,s)):(l=o.length>0?o[0]:this.addNewThemeColorKey(),this.setTheoColorToLibrary(c,l),null!=(u=a.indexOf(o,l))&&o.splice(u,1),this.setTheoColorToLibrary(b.TheoColor.init_5344(c.rgbColor.contrastWithSelf(),null,null),n.getLightnessContrastKey(l))),r.push(l)}return C.LegacyCoreAssert.isTrue(r.length==e.length,"should return as many keys as added colors",void 0,"ColorLibraryController.addColorsToTheme","ColorLibraryController.swift",1969),r},addColorsWithRoleToTheme:function(e,t){var o=a.clone(n.toTheoColors(e)),r=a.clone(this.addColorsToTheme(o,t));return C.LegacyCoreAssert.isTrue(r.length==o.length,"themeColors and theoColors mismatch in count",void 0,"ColorLibraryController.addColorsWithRoleToTheme","ColorLibraryController.swift",1978),n.toThemeColorsWithRole(r,e)},getKeyOfNearColorInTheme:function(e){for(var t,o=this.getThemeColorKeys().concat(n.THEME_DERIVED_BW_KEYS),r=a.iter(o);!r.done;r.next()){var i,l=r.value;if((i=a.opt(this.library.color(l),(function(e){return e.rgbColor})))&&i.distanceTo(e)<.01){t=l;break}}return t}}}),n)},zbwF:function(e,t,o){var n,r,i,a=t,l=o("oAGj"),s=o("xRbc"),u=o("uj1m"),c=o("7Ta2"),h=o("taeg");a.LockupRoleSuggesterFactory=(n=function(){},l.defineClass({name:"LockupRoleSuggesterFactory",ctor:n,statics:{Create:function(e){return void 0===e&&(e=""),"MLP"==e?new a.LockupRoleSuggesterMLP:new a.LockupRoleSuggesterSimple}}}),n),a.LockupRoleSuggesterMLP=(r=function(){h.RoleSuggesterMLP.call(this)},l.defineClass({name:"LockupRoleSuggesterMLP",ctor:r,superName:"RoleSuggesterMLP",statics:{_implements:function(e){return"RoleSuggesterProtocol"==e}},props:{getRoleModel:function(){return u.MLPModel.loadNNModel("TextRole")}}}),r),a.LockupRoleSuggesterSimple=(i=function(){},l.defineClass({name:"LockupRoleSuggesterSimple",ctor:i,statics:{_implements:function(e){return"RoleSuggesterProtocol"==e}},props:{getRole:function(e){var t,o=c.InferredRoleType.Undefined;if(t=l.as(e,s.LockupRoleData)){var n=t.feat(s.LockupRoleFeatures.WordCount),r=t.feat(s.LockupRoleFeatures.TextCount),i=t.feat(s.LockupRoleFeatures.TextHeight),a=t.feat(s.LockupRoleFeatures.intsSpecialsCount),u=t.feat(s.LockupRoleFeatures.checkSocialChar)>0,h=t.feat(s.LockupRoleFeatures.PercentageArea),d=t.feat(s.LockupRoleFeatures.otherLockupPercDesignArea);o=n<=5&&i>=80||n<=9&&i>=250?c.InferredRoleType.Title:n<=14?c.InferredRoleType.SubTitle:c.InferredRoleType.Body,a>=5&&n<=18&&i<=220&&(o=c.InferredRoleType.Contact),u&&(o=c.InferredRoleType.Social),r<=3&&h>d&&(o!=c.InferredRoleType.Body&&o!=c.InferredRoleType.Social||(o=c.InferredRoleType.Title))}return c.InferredRole.init_84d1(o,1)}}}),i)}}]);
//# sourceMappingURL=theo-core-model-controllers-dcc2281d.js.map