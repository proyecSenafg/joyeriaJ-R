(window.webpackJsonptheoWebApp=window.webpackJsonptheoWebApp||[]).push([[2],{"+IES":function(e,t,n){var r=t,o=n("oAGj");r.MotionLogic=o.defineProtocol("MotionLogic",{apply:"(Forma, Array<KeyFrame>, Dictionary<String>) -> Void"})},"+qi7":function(e,t,n){var r,o=t,a=n("oAGj"),i=n("tGKA"),s=n("JO5d"),l=n("Zifs"),u=n("djAF"),c=n("35Q0"),d=n("oKlP"),h=n("sIWg");o.FormaCalloutUtils=(r=function(){},a.defineClass({name:"FormaCalloutUtils",ctor:r,props:{applyLockupHighlightBox:function(e){var t;(t=e.root)&&(this.applyLockupHighlightBoxTriangle(e,t),this.applyLockupHighlightBoxRectangle(e,t))},removeLockupHighlightBox:function(e){var t;if(t=e.root)for(var n=a.clone(t.filterWithCallback((function(e){return"temp-struct-vis"==e.intent}))),r=a.iter(n);!r.done;r.next())(e=r.value).removeFromParent()},applyLockupHighlightBoxTriangle:function(e,t){var n=t.page.createFormaWithController(u.ShapeForma.KIND,s.ShapeController.KIND);t.appendChild(n),n.intent="temp-struct-vis",c.ShapeLibrary.applyToShapeForma(n,"tri"),n.style.colors.fieldPrimary=new l.SolidColor(1,0,0,1),n.style.opacity=.9;var r=a.clone(e.totalPlacement.transformPoints(e.bounds.points));if(r[0].x<250){var o=(r[2].y+r[3].y)/2,p=r[3].y-r[2].y,f=o-.25*(T=r[3].y-r[2].y<200?Math.max(p,70):200),m=o+.25*T,g=r[2].x,y=r[2].x+.5*T,_=h.TheoRect.fromPoints(new d.TheoPoint(y,f),new d.TheoPoint(g,m));n.controller.fit(_),n.placement=new i.Matrix2D(0,-1,1,0,0,0),n.moveCenterToPoint(_.center)}else{o=(r[1].y+r[0].y)/2;var T,C=r[1].y-r[0].y;f=o-.25*(T=r[1].y-r[0].y<200?Math.max(C,70):200),m=o+.25*T,g=r[0].x,y=r[0].x-.5*T,_=h.TheoRect.fromPoints(new d.TheoPoint(y,f),new d.TheoPoint(g,m)),n.controller.fit(_),n.placement=new i.Matrix2D(0,1,-1,0,0,0),n.moveCenterToPoint(_.center)}},applyLockupHighlightBoxRectangle:function(e,t){var n=t.page.createFormaWithController(u.ShapeForma.KIND,s.ShapeController.KIND);t.appendChild(n),n.intent="temp-struct-vis",c.ShapeLibrary.applyToShapeForma(n,"square_001"),n.style.colors.fieldPrimary=new l.SolidColor(1,0,0,1),n.style.opacity=.9;var r,o=a.clone(e.totalPlacement.transformPoints(e.bounds.points));if(o[0].x<250){var i=(o[3].y+o[2].y)/2,p=o[3].y-o[2].y,f=i-.1*(T=o[3].y-o[2].y<200?Math.max(p,70):200),m=i+.1*T,g=.5*T,y=o[2].x+g,_=o[2].x+(g+100);r=h.TheoRect.fromPoints(new d.TheoPoint(_,f),new d.TheoPoint(y,m))}else{i=(o[1].y+o[0].y)/2;var T,C=o[1].y-o[0].y;f=i-.1*(T=o[1].y-o[0].y<200?Math.max(C,70):200),m=i+.1*T,g=.5*T,y=o[0].x-g,_=o[0].x-(g+100),r=h.TheoRect.fromPoints(new d.TheoPoint(_,f),new d.TheoPoint(y,m))}n.controller.fit(r)}}}),r)},"/9Bx":function(e,t,n){var r,o=t,a=n("oAGj"),i=n("gXiO"),s=n("2bF5");o.MoaColorMap=(r=function(){i.CoreObject.call(this)},a.defineClass({name:"MoaColorMap",ctor:r,superName:"CoreObject",statics:{createIdentityColorMap:function(){for(var e=[],t=a.iter(a.range(0,s.MoaConstants.kMoaColorMapSizeRGB,!1));!t.done;t.next()){var n=t.value;e.push(a.toDouble(n))}return e},createBrightnessColorMap:function(e){var t=Math.max(-100,Math.min(100,e))/100*85;return r.createColorMapFromListOfYValues(0,255,[42.5+.6*t,127.5+t,212.5+.5*t],3)},createContrastColorMap:function(e){var t=Math.max(-100,Math.min(100,e)),n=63.75*(e<0?t/200:t/100);return r.createColorMapFromListOfYValues(0,255,[63.75-n,191.25+n],2)},createExposureColorMap:function(e){var t=Math.max(-100,Math.min(100,e));return t=t<0?-e*e/100:e*e/100,r.createColorMapFromListOfYValues(e,255+e,[],0)},createShadowsColorMap:function(e){if(0!=e){var t=Math.max(-100,Math.min(100,e))/100;t<0&&(t*=1.25);var n=25.5*t;return r.createColorMapFromListOfYValues(n,255,[25.5+n,76.5+.75*n,127.5,178.5,229.5],5)}return r.createIdentityColorMap()},createHighlightsColorMap:function(e){if(0!=e){var t=Math.max(-100,Math.min(100,e))/100;t>0&&(t*=1.25);var n=25.5*t;return r.createColorMapFromListOfYValues(0,255+.75*n,[25.5,76.5,127.5,178.5+n,229.5+n],5)}return r.createIdentityColorMap()},createFadeColorMap:function(e){var t,n=Math.max(-100,Math.min(100,e))/100;return r.createColorMapFromListOfYValues(t=n<0?128*n:72*n,255-.5*t,[63.75,191.25],2)},createWarmthColorMaps:function(e){var t,n,o,i=a.repeat(a.repeat(0,s.MoaConstants.kMoaColorMapSizeRGB),3),l=Math.max(-100,Math.min(100,e))/100;if(l<-.6)t=-15*(1-(u=-(l+.6)/.4))+-90*u,n=5*(1-u)+-10*u,o=60*(1-u)+100*u;else if(l<0)t=-15*(u=-l/.6),n=5*u,o=60*u;else if(l>.6)t=30*(1-(u=(l-.6)/.4))+65*u,n=10*(1-u)+-5*u,o=-30*(1-u)+-127.5*u;else{var u;t=30*(u=l/.6),n=10*u,o=-30*u}var c=[127.5+t],d=[127.5+n],h=[127.5+o],p=.35*t,f=.35*n,m=.35*o,g=t<0?255+t:255+.5*t,y=n<0?255+n:255+.5*n,_=o<0?255+o:255+.5*o;return i[0]=a.clone(r.createColorMapFromListOfYValues(p,g,c,1)),i[1]=a.clone(r.createColorMapFromListOfYValues(f,y,d,1)),i[2]=a.clone(r.createColorMapFromListOfYValues(m,_,h,1)),i},createTintColorMaps:function(e){var t,n,o,i=a.repeat(a.repeat(0,s.MoaConstants.kMoaColorMapSizeRGB),3),l=Math.max(-100,Math.min(100,e))/100;if(l<-.6)t=-10*(1-(u=-(l+.6)/.4))+-90*u,n=45*(1-u)+40*u,o=-20*(1-u)+-70*u;else if(l<0)t=-10*(u=-l/.6),n=45*u,o=-20*u;else if(l>.6)t=15*(1-(u=(l-.6)/.4))+45*u,n=-15*(1-u)+-75*u,o=25*(1-u)+45*u;else{var u;t=15*(u=l/.6),n=-15*u,o=25*u}var c=[127.5+t],d=[127.5+n],h=[127.5+o],p=.35*t,f=.35*n,m=.35*o,g=t<0?255+t:255+.5*t,y=n<0?255+n:255+.5*n,_=o<0?255+o:255+.5*o;return i[0]=a.clone(r.createColorMapFromListOfYValues(p,g,c,1)),i[1]=a.clone(r.createColorMapFromListOfYValues(f,y,d,1)),i[2]=a.clone(r.createColorMapFromListOfYValues(m,_,h,1)),i},createColorMapFromListOfYValues:function(e,t,n,o){if(o<1)return r.createColorMapForTwoYVals(e,t);var i=a.repeat(0,s.MoaConstants.kMoaColorMapSizeRGB),l=(a.toDouble(s.MoaConstants.kMoaColorMapSizeRGB)-1)/a.toDouble(o),u=0;if(1==o){for(var c=e,d=n[0],h=t,p=a.iter(a.range(0,s.MoaConstants.kMoaColorMapSizeRGB-1,!1));!p.done;p.next()){var f=p.value,m=(T=1-(_=a.toDouble(f)/(a.toDouble(s.MoaConstants.kMoaColorMapSizeRGB)-1)))*T*c+2*T*_*d+_*_*h;i[f]=r.MoaColorClamp(m)}return i[0]=r.MoaColorClamp(e),i[s.MoaConstants.kMoaColorMapSizeRGB-1]=r.MoaColorClamp(t),i}var g=0,y=l;for(c=e,d=n[u],h=.5*(n[u]+n[u+1]),f=0;f<=a.toInt(l)&&f<s.MoaConstants.kMoaColorMapSizeRGB;)m=(T=1-(_=a.toDouble(f)/l))*T*c+2*T*_*d+_*_*h,i[f]=r.MoaColorClamp(m),f+=1;for(;u<o-2;)for(u+=1,g=a.toDouble(u)*l,y+=l,c=.5*(n[u-1]+n[u]),d=n[u],h=.5*(n[u]+n[u+1]);f<=a.toInt(y)&&f<s.MoaConstants.kMoaColorMapSizeRGB;)m=(T=1-(_=(a.toDouble(f)-g)/l))*T*c+2*T*_*d+_*_*h,i[f]=r.MoaColorClamp(m),f+=1;for(g=(a.toDouble(u)+1)*l,c=.5*(n[u]+n[u+1]),d=n[u+1],h=t;f<s.MoaConstants.kMoaColorMapSizeRGB-1;){var _,T;m=(T=1-(_=(a.toDouble(f)-g)/l))*T*c+2*T*_*d+_*_*h,i[f]=r.MoaColorClamp(m),f+=1}return i[0]=r.MoaColorClamp(e),i[s.MoaConstants.kMoaColorMapSizeRGB-1]=r.MoaColorClamp(t),i},createColorMapForTwoYVals:function(e,t){for(var n=a.repeat(0,s.MoaConstants.kMoaColorMapSizeRGB),r=a.iter(a.range(0,s.MoaConstants.kMoaColorMapSizeRGB,!1));!r.done;r.next()){var o=r.value,i=a.toDouble(o)/a.toDouble(s.MoaConstants.kMoaColorMapSizeRGB),l=1-i;n[o]=i*t+l*e}return n},combineColorMaps:function(e,t){for(var n=a.repeat(0,s.MoaConstants.kMoaColorMapSizeRGB),r=s.MoaConstants.kMoaColorMapSizeRGB-1,o=a.iter(a.range(0,s.MoaConstants.kMoaColorMapSizeRGB,!1));!o.done;o.next()){var i=o.value,l=e[i];if(l<=0)n[i]=t[0];else if(l>=a.toDouble(r))n[i]=t[r];else{var u=a.toInt(l),c=l-a.toDouble(u);n[i]=(1-c)*t[u]+c*t[u+1]}}return n},MoaColorClamp:function(e){return e>255?255:e<0?0:e},roundColorMap:function(e){for(var t=a.iter(a.range(0,s.MoaConstants.kMoaColorMapSizeRGB,!1));!t.done;t.next()){var n=t.value;e[n]=Math.round(e[n])}}}}),r)},"/afT":function(e,t,n){var r,o=t,a=n("oAGj"),i=n("cZuM"),s=n("gXiO"),l=n("FNB+"),u=n("9Lk3"),c=n("ZK0l"),d=n("pnSN"),h=n("NkBu"),p=n("fdtz"),f=n("fNpk"),m=n("tGKA"),g=n("K0Rh"),y=n("T6jX"),_=n("oKlP"),T=n("sIWg");o.GroupDetector=(r=function(){s.CoreObject.call(this)},a.defineClass({name:"GroupDetector",ctor:r,superName:"CoreObject",statics:{Y_DISTANCE_THRESHOLD:150,X_DISTANCE_THRESHOLD:0,mergeFormaGroups:function(e,t){if(t>=e.length)return f.LegacyCoreAssert.fail("can't merge if the target is greater or equal than the number of groups",void 0,"GroupDetector.mergeFormaGroups","GroupDetector.swift",33),e;for(var n=e.concat();n.length>1&&n.length>t;){for(var r=1/0,o=null,i=null,s=a.iter(a.range(0,n.length,!1));!s.done;s.next()){var l,u=s.value;if(l=y.TheoDocumentUtils.unionFinalFrame(n[u]))for(var c=a.iter(a.range(0,n.length,!1));!c.done;c.next()){var d,h;u!=(d=c.value)&&(h=y.TheoDocumentUtils.unionFinalFrame(n[d]))&&l.L1Distance(h)<=r&&(o=u,i=d,r=l.L1Distance(h))}}if(null==(u=o)||null==(d=i))break;n[u]=n[u].concat(n[d]),n.splice(d,1)}return n},splitFormaGroups:function(e,t){for(var n=0,o=a.iter(e);!o.done;o.next())n+=o.value.length;for(var i=e.concat();i.length<n&&i.length<t;){for(var s=-1,l=null,u=a.iter(a.range(0,i.length,!1));!u.done;u.next()){var c=u.value;if(i[c].length>1){var d=r.groupFrame(i[c]);(null==l||d.area>l.area)&&(s=c,l=d)}}if(null==l){f.LegacyCoreAssert.fail("should have found a group to split",void 0,"GroupDetector.splitFormaGroups","GroupDetector.swift",111);break}var h=r.splitGroup(i[s]),p=h[0],m=h[1];i[s]=a.clone(p),i.splice(s+1,0,m)}return i},groupFrame:function(e){if(0==e.length)return T.TheoRect.Zero;for(var t=e[0].finalFrame,n=a.iter(e);!n.done;n.next()){var r=n.value;t=t.unionWith(r.finalFrame)}return t},splitGroup:function(e){if(e.length<=1)return f.LegacyCoreAssert.fail("should have found a group to split",void 0,"GroupDetector.splitGroup","GroupDetector.swift",142),[e,[]];for(var t=e[0].finalFrame,n=a.iter(e);!n.done;n.next()){var r=n.value;t=t.unionWith(r.finalFrame)}for(var o=0,i=0,s=a.iter(e);!s.done;s.next()){r=s.value;for(var u=a.iter(e);!u.done;u.next()){var c,d,h=u.value;a.eq(l._equality_Forma_Forma,r,h)||(c=r.finalFrame)&&(d=h.finalFrame)&&(o+=c.xDistance(d),i+=c.yDistance(d))}}var p=o>.01&&i<.01,m=a.sort(e,(function(e,t){var n,r;return(n=e.finalFrame)&&(r=t.finalFrame)?p?n.center.x<r.center.x:n.center.y<r.center.y:(f.LegacyCoreAssert.fail("nil frames when splitting groups",void 0,"GroupDetector.splitGroup","GroupDetector.swift",178),!1)})),g=[],y=[],_=0,T=m.length-1,C=m[_].finalFrame,v=m[T].finalFrame;for(g.push(m[_]),y.push(m[T]);_<T-1;){var P=C.area<v.area;m[_+1].finalFrame.intersects(C)&&(P=!0),m[T-1].finalFrame.intersects(v)&&(P=!1),P?(_+=1,g.push(m[_]),C=C.unionWith(m[_].finalFrame)):(T-=1,y.push(m[T]),v=v.unionWith(m[T].finalFrame))}return f.LegacyCoreAssert.isTrue(g.length+y.length==m.length,"counts don't match",void 0,"GroupDetector.splitGroup","GroupDetector.swift",221),[g,y]},shareVisualParent:function(e,t){var n=r.getVisualParent(e).finalFrame,o=r.getVisualParent(t).finalFrame;return r.visualParentFramesOverlap(n,o)},visualParentFramesOverlap:function(e,t){var n;return!!(n=e.intersectionWith(t))&&n.area/Math.max(t.area,e.area)>.95},detectOverlapGroups:function(e){var t=[],n=a.sort(e,(function(e,t){return e.finalFrame.area>t.finalFrame.area}));if(n.length<=1)return t;for(var r=[],o=a.iter(a.range(0,n.length-1,!1));!o.done;o.next()){var i=o.value;if(!a.containsEq(r,n[i],l._equality_Forma_Forma)){for(var s=[n[i]],u=a.iter(a.range(i+1,n.length,!1));!u.done;u.next()){var c,d=u.value;(c=n[i].finalFrame.intersectionWith(n[d].finalFrame))&&!a.containsEq(r,n[d],l._equality_Forma_Forma)&&c.area/n[d].finalFrame.area>.5&&s.push(n[d])}if(s.length>1){for(var h=a.iter(s);!h.done;h.next()){var p=h.value;r.push(p)}t.push(s)}}}for(var f=[],m=a.iter(t);!m.done;m.next()){var g=m.value,y=a.sort(g,(function(e,t){var n,r;return null!=(n=a.opt(e.parent,(function(t){return t.indexOfChild(e)})))&&null!=(r=a.opt(t.parent,(function(e){return e.indexOfChild(t)})))&&n<r}));f.push(y)}return f},detectProximityGroups:function(e,t,n){if(void 0===t&&(t=null),void 0===n&&(n=!1),0==e.length)return[];var o=null!=t?t:r.Y_DISTANCE_THRESHOLD,s=e.concat();a.sortInPlace(s,(function(e,t){return e.finalFrame.center.distanceTo(_.TheoPoint.ZERO)<t.finalFrame.center.distanceTo(_.TheoPoint.ZERO)}));var u,c=[],d=s.concat(),h=1,p=a.first(s);(u=a.opt(a.opt(p,(function(e){return e.page.view})),(function(e){return e.getViewportTransform()})))&&(h=Math.sqrt(Math.abs(u.determinant)));for(var f=a.iter(s);!f.done;f.next()){var m=f.value,g=[];if(n){var y=i.AlignmentDetector.DISTANCE_THRESHOLD/h,T=i.AlignmentDetector.init_a00d(m);g=a.clone(T.detectFormaAlignments(y))}if(a.containsEq(d,m,l._equality_Forma_Forma)){var C=[];C.push(m);var v=m.finalFrame;if(null==v)continue;for(var P=!0;P;){P=!1;for(var S=a.iter(d);!S.done;S.next()){var A,D=S.value;if(!a.eq(l._equality_Forma_Forma,D,m)&&(A=D.finalFrame)){var E=A.xDistance(v),R=A.yDistance(v),F=o;if(n){for(var I=!1,b=a.iter(g);!b.done;b.next()){var O=b.value;a.eq(l._equality_Forma_Forma,O.forma,D)&&(I=!0)}if(!I)continue}R<=F&&E<=F&&(v=v.unionWith(A),P=!0,C.push(D))}}for(var k=a.iter(C);!k.done;k.next())D=k.value,a.remove(d,D)}c.push(C)}}return c},shareVisualParent0:function(e,t){for(var n=a.clone(e.root.filterWithCallback((function(e){return e.isGraphic()}))),r=null,o=null,i=e.finalFrame,s=t.finalFrame,u=a.iter(n);!u.done;u.next()){var c,d,h=u.value;h.kind==p.ImageForma.KIND||h.isDescendent(e)||h.isDescendent(t)||(c=h.finalFrame)&&((d=c.intersectionWith(i))&&d.area/i.area>.75&&(r=h),(d=c.intersectionWith(s))&&d.area/s.area>.75&&(o=h))}return a.eq(l._equality_Forma_Forma,r,o)},getVisualParent:function(e){var t=e.finalFrame;return r.getVisualParentHelper(e,t)},getGroupVisualParent:function(e){var t=e.childrenFinalFrame;return r.getVisualParentHelper(e,t)},getVisualParentHelper:function(e,t){for(var n=e.root,r=a.clone(e.root.filterWithCallback((function(t){var n=t.isDescendent(e);return!(a.eq(l._equality_Forma_Forma,t,e)||n||null==t.controller||t.controller.kind==h.ImageController.KIND||t.controller.kind==u.GridController.KIND||!t.isBackgroundImage()&&t.hasIntent(l.Forma.INTENT_ICON)&&t.kind!=g.RootForma.KIND)}))),o=a.iter(r);!o.done;o.next()){var i,s=o.value;(i=s.finalFrame)&&i.contains(t)&&i.area<=n.finalFrame.area&&(n=s)}return n},detectVerticalAlignmentGroups:function(e){var t=[];if(0==e.length)return t;for(var n=e.concat();n.length>0;){var r,o=n[0],s=null,u=i.AlignmentDetector.init_a00d(o),c=[o];a.remove(n,o);for(var d=a.iter(u.detectFormaAlignments(i.AlignmentDetector.DISTANCE_THRESHOLD));!d.done;d.next()){var h=d.value;u.isVerticalAlignment(h.line.type)&&null!=h.forma&&a.containsEq(n,h.forma,l._equality_Forma_Forma)&&(s!=h.line.type&&null!=s||(s=h.line.type,a.containsEq(c,h.forma,l._equality_Forma_Forma)||(c.push(h.forma),a.remove(n,h.forma))))}null==s&&(s=null!=(r=a.opt(c[0].controller,(function(e){return e.preferredXAlignment})))?r:i.AlignmentType.CenterX),t.push({alignment:s,formae:c})}return t},flattenInferredGroups:function(e){for(var t=a.iter(e.visitAsArray(l.FormaTraversal.JustChildren));!t.done;t.next()){var n=t.value;if(n.hasIntent(l.Forma.INTENT_INFERRED_TEMP_GROUP)){for(var r=a.iter(n.visitAsArray(l.FormaTraversal.JustChildren));!r.done;r.next()){var o=r.value;e.appendChild(o,!0)}n.removeFromParent(),a.opt(a.as(e.controller,u.GridController),(function(e){return e.inferGridCellAssignment()}))}}},inferVisualParentGroup:function(e,t){for(var n=t.finalFrame,r=a.clone(e.filterWithCallback((function(e){return null!=e.controller&&e.controller.floating}),l.FormaTraversal.JustChildren)),o=[],i=a.iter(r);!i.done;i.next()){var s,u,h=i.value;a.eq(l._equality_Forma_Forma,h,t)||(s=h.finalFrame)&&(u=n.intersectionWith(s))&&u.area/s.area>.75&&o.push(h)}if(o.length>0){var p=t.page.createFormaWithController(d.GroupForma.KIND,c.GroupController.KIND);p.allowUserMove=!0,p.intent=l.Forma.INTENT_INFERRED_TEMP_GROUP,e.appendChild(p),p.placement=m.Matrix2D.translationXY(n.minX,n.minY),p.bounds=T.TheoRect.fromSize(n.size);for(var f=a.iter(o);!f.done;f.next()){var g=f.value;p.appendChild(g,!0)}return p}return null},createOverlapGroups:function(e){for(var t=a.clone(e.filterWithCallback((function(e){return null!=e.controller&&e.kind!=p.ImageForma.KIND&&e.controller.floating&&!e.hasIntent(l.Forma.INTENT_INFERRED_TEMP_GROUP)}),l.FormaTraversal.JustChildren)),n=[],o=a.iter(r.detectOverlapGroups(t));!o.done;o.next()){var i=o.value,s=e.page.createFormaWithController(d.GroupForma.KIND,c.GroupController.KIND);s.allowUserMove=!0,s.intent=l.Forma.INTENT_INFERRED_TEMP_GROUP,e.appendChild(s);for(var u=i[0].frame,h=a.iter(i);!h.done;h.next()){var f=h.value;u=u.unionWith(f.frame)}var g=u;s.placement=m.Matrix2D.translationXY(g.minX,g.minY),s.bounds=T.TheoRect.fromSize(g.size);for(var y=a.iter(i);!y.done;y.next())f=y.value,s.appendChild(f,!0);n.push(s)}return n},inferVisualGroups:function(e){return[]}}}),r)},"0wFF":function(e,t,n){var r,o=t,a=n("oAGj"),i=n("gXiO");o.AnalyticsConstants=(r=function(){i.CoreObject.call(this)},a.defineClass({name:"AnalyticsConstants",ctor:r,superName:"CoreObject",statics:{kAllowAnalyticsKey:"shareuser_preference",kAnalyticsDataRegistrationStart:"Signup Start",kAnalyticsDataRegistrationSuccess:"Signup Success",kAnalyticsDataRegistrationFailure:"Signup Failure",kAnalyticsDataLoginStart:"Login Start",kAnalyticsDataLoginAttempt:"Login Attempt",kAnalyticsDataLoginSuccess:"Login Success",kAnalyticsDataLoginCancel:"Login Cancel",kAnalyticsDataLogoutAttempted:"Logout Attempted",kAnalyticsDataLogoutCancel:"Logout Cancel",kAnalyticsDataRegistrationStep:"Registration Step",kAnalyticsDataAuthStep:"Auth Step",kAnalyticsDataLoginMethod:"method",kAnalyticsValueLoginFacebook:"facebook",kAnalyticsValueLoginGoogle:"google",kAnalyticsValueLoginApple:"apple",kAnalyticsValueLoginAdobeID:"AdobeID",kAnalyticsValueLoginKeychain:"keychain",kAnalyticsDataLowMemoryWarning:"lowMemoryWarning",kAnalyticsDataAuthStatusLoggedInOnline:"Logged In : Online",kAnalyticsDataAuthStatusLoggedInOffline:"Logged In : Offline",kAnalyticsDataAuthStatusLoggedOutOnline:"Logged Out : Online",kAnalyticsDataAuthStatusLoggedOutOffline:"Logged Out : Offline",kAnalyticsDataGeneric1:"contextualData1",kAnalyticsDataGeneric2:"contextualData2",kAnalyticsDataGeneric3:"contextualData3",kAnalyticsDataGeneric4:"contextualData4",kAnalyticsDataGeneric5:"contextualData5",kAnalyticsDataGeneric6:"contextualData6",kAnalyticsDataGeneric7:"contextualData7",kAnalyticsDataGeneric8:"contextualData8",kAnalyticsDataGeneric9:"contextualData9",kAnalyticsDataGeneric10:"contextualData10",kAnalyticsDataGeneric11:"contextualData11",kAnalyticsDataGeneric12:"contextualData12",kAnalyticsDataGeneric13:"contextualData13",kAnalyticsDataGeneric14:"contextualData14",kAnalyticsDataGeneric15:"contextualData15",kAnalyticsDataGeneric16:"contextualData16",kAnalyticsDataGeneric17:"contextualData17",kAnalyticsDataGeneric18:"contextualData18",kAnalyticsDataGeneric19:"contextualData19",kAnalyticsDataGeneric20:"contextualData20",kAnalyticsDataGeneric21:"contextualData21",kAnalyticsDataGeneric22:"contextualData22",kAnalyticsDataGeneric23:"contextualData23",kAnalyticsDataGeneric24:"contextualData24",kAnalyticsDataGeneric25:"contextualData25",kAnalyticsDataGeneric26:"contextualData26",kAnalyticsDataGeneric27:"contextualData27",kAnalyticsDataGeneric28:"contextualData28",kAnalyticsDataGeneric29:"contextualData29",kAnalyticsDataGeneric30:"contextualData30",kAnalyticsDataGeneric31:"contextualData31",kAnalyticsDataGeneric32:"contextualData32",kAnalyticsDataGeneric33:"contextualData33",kAnalyticsDataGeneric34:"contextualData34",kAnalyticsDataGeneric35:"contextualData35",kAnalyticsDataGeneric36:"contextualData36",kAnalyticsLabelAdobeEventName:"adb.event.eventInfo.eventName",kAnalyticsLabelAdobeEventAction:"adb.event.eventInfo.eventAction",kAnalyticsLabelTrackingID:"mobile.theo.trackingId",kAnalyticsLabelPlatformName:"adb.page.pageInfo.platform",kAnalyticsValuePlatformiOS:"ios",kAnalyticsValuePlatformAndroid:"android",kAnalyticsLabelProductCategory:"adb.page.pageInfo.productCategory",kAnalyticsValueProductCategory:"mobile",kAnalyticsLabelNamespace:"adb.page.pageInfo.namespace",kAnalyticsValueNamespace:"theo",kAnalyticsLabelUserAuthStatus:"adb.user.profile.attributes.authStatus",kAnalyticsLabelUserProfileID:"adb.user.profile.profileId",kAnalyticsLabelUserAuthId:"authId",kAnalyticsLabelSDKsUsed:"adb.page.pageInfo.isSDKUtilized",kAnalyticsValueCreativeSDK:"Creative SDK",kAnalyticsLabelDeviceUsed:"device",kAnalyticsLabelPageName:"adb.page.pageInfo.pageName",kAnalyticsLabelProductVersion:"adb.page.pageInfo.productVersion",kAnalyticsLabelAdobeEventInfo:"adb.event.eventInfo.type",kAnalyticsEventDooploSearched:"dooploSearched",kAnalyticsEventLowMemoryWarning:"lowMemoryWarning",kAnalyticsDataImageSearchTerm:"searchTerm",kAnalyticsDooploImageUnavailableError:"Dooplo Image Unavailable Error",kAnalyticsLabelDooploImageURL:"mobile.theo.DooploImageURL",kAnalyticsEventGiphySearched:"giphySearched",kAnalyticsEventAdobeStockSearched:"adobeStockSearched",kAnalyticsEventAdobeStockLicenseImageClicked:"license_adobe_stock_image_clicked",kAnalyticsEventAdobeStockLicenseImageConfirmed:"license_adobe_stock_image_confirmed",kAnalyticsEventAdobeStockLicenseImageCanceled:"license_adobe_stock_image_canceled",kAnalyticsEventAdobeStockLicenseImageSucceed:"license_adobe_stock_image_Succeed",kAnalyticsEventAdobeStockLicenseImageFailed:"license_adobe_stock_image_Failed",kAnalyticsEventAdobeStockLicenseImageNoSubscription:"license_adobe_stock_image_no_subscription",kAnalyticsDataClipboardCopy:"Clipboard Copy",kAnalyticsDataGeneralError:"General Error",kAnalyticsDataSharingAction:"Sharing Action",kAnalyticsDataScreenshotCaptured:"screenShotCaptured",kAnalyticsBaseEvent:"mobile.theo.event",kAnalyticsDataRegistrationCancel:"Signup Cancel",kAnalyticsDataLogoutSuccess:"Logout Success",kAnalyticsDataLogoutFailure:"Logout Failure",kAnalyticsDataCreateNewAttempt:"projectworkFlow:createProjectAttempt",kAnalyticsDataCreateNewCancel:"projecWorkFlow:createProjectCancel",kAnalyticsDataProjectCreated:"projectCreated",kAnalyticsDataProjectOpened:"projectOpened",kAnalyticsDataViewedMerchandising:"viewedMerchandising",kAnalyticsMerchandisingTriggerBrandify:"brandify",kAnalyticsMerchandisingTriggerWatermark:"watermark",kAnalyticsMerchandisingTriggerResize:"resize",kAnalyticsMerchandisingTriggerLogo:"logo",kAnalyticsMerchandisingTriggerFont:"fontAdd",kAnalyticsMerchandisingTriggerFontRecommendations:"fontRecommendationsPicker",kAnalyticsMerchandisingTriggerResubscribe:"resubscribe",kAnalyticsMerchandisingTriggerPremiumTemplate:"messagingModalPremiumTemplateUpgrade",kAnalyticsMerchandisingTriggerCCLEmptyState:"cclEmptyState",kAnalyticsDataMerchandisingTriggerUseLibraryAssets:"messagingModalMerchLibraryUseAssets",kAnalyticsMerchandisingTriggerShare:"shareSheet",kAnalyticsMerchandisingTriggerMerchandisingBar:"merchandisingBar",kAnalyticsMerchandisingTriggerAppNavUpgrade:"appNavUpgrade",kAnalyticsMerchandisingClickedCTA:"clickedMerchandisingCTA",kAnalyticsMerchandisingClickedMaybeLater:"clickedMerchandisingMaybeLater",kAnalyticsMerchandisingShowPopover:"showPopOver",kAnalyticsMerchandisingTriggerEditCutout:"editCutout",kAnalyticsEventAddedBrandingToProject:"addedBrandingToProject",kAnalyticsDataKeyProjectID:"projectID",kAnalyticsDataViewedOnboarding:"viewedOnboarding",kAnalyticsDataOnboardingTriggerColorPicker:"colorPickerOnboarding",kAnalyticsDataOnboardingTriggerPartialBrand:"partialBrandOnboarding",kAnalyticsDataOnboardingTriggerIncompleteBrandify:"incompleteBrandifyOnboarding",kAnalyticsDataOnboardingTriggerAddLogoPartialBrandkit:"addLogoPartialBrandkitOnboarding",kAnalyticsLabelTrigger:"trigger",kAnalyticsLabelPremiumEntitled:"premiumEntitled",kAnalyticsLabelDeviceLanguage:"deviceLanguage",kAnalyticsLabelDisplayedLanguage:"displayedLanguage",kAnalyticsDataEditDesign:"projectWorkFlow:editDesign",kAnalyticsDataDeleteDesign:"projectWorkFlow:deleteDesign",kAnalyticsDataDuplicateDesign:"projectWorkFlow:duplicateDesign",kDidEditDocumentPalette:"editor:colorEditor:didEditDocumentPalette",kDidEditSelectionColor:"editor:colorEditor:didEditSelectionColor",kDidSampleHSVColor:"editor:colorEditor:didSampleHSVColor",kDidSampleDocumentColor:"editor:colorEditor:didSampleDocumentColor",kDidChooseSwatchColor:"editor:colorEditor:didChooseSwatchColor",kDidVisitHexPicker:"editor:colorEditor:didVisitHexPicker",kDidCopyHexColor:"editor:colorEditor:didCopyHexColor",kDidPasteHexColor:"editor:colorEditor:didPasteHexColor",kAnalyticsDataUndo:"project:undoPressed",kAnalyticsDataRedo:"project:redoPressed",kAnalyticsDataActionPerformed:"project:actionPerformed",kAnalyticsDataActionDescription:"actionDescription",kAnalyticsDataAddPressed:"editor:addPressed",kAnalyticsDataAddTextPressed:"editor:addTextPressed",kAnalyticsDataAddImagePressed:"editor:addImagePressed",kAnalyticsDataImageLayerPressed:"editor:imageLayerPressed",kAnalyticsDataProjectCreateTypeScratch:"projectCreateType:scratch",kAnalyticsDataProjectCreateTypeTemplate:"projectCreateType:templates",kAnalyticsDataVideoTypeVideo:"videoType:video",kAnalyticsDataVideoTypeLivePhoto:"videoType:livePhoto",kAnalyticsDataActionTypeSuccess:"actionType:success",kAnalyticsDataAddLogoPressed:"editor:addLogoPressed",kAnalyticsDataAddIconPressed:"editor:addIconPressed",kAnalyticsDataDesignFilterPressed:"editor:designFilterPressed",kAnalyticsDataStickersPressed:"editor:stickersPressed",kAnalyticsDataAddButtonSelected:"editor:addButtonSelected",kAnalyticsDataAddTextSelected:"editor:addTextSelected",kAnalyticsDataAddImageSelected:"editor:addImageSelected",kAnalyticsDataAddLogoSelected:"editor:addLogoSelected",kAnalyticsDataAddIconSelected:"editor:addIconSelected",kAnalyticsDataAddStickerSelected:"editor:addStickerSelected",kAnalyticsDataColorSelect:"editor:colorSelected",kAnalyticsDataLayoutSelect:"editor:layoutSelected",kAnalyticsDataResizeSelect:"editor:resizeSelected",kAnalyticsDataBrandSelect:"editor:brandSelected",kAnalyticsDataViewFeaturedPosters:"lobby:viewFeaturedPosters",kAnalyticsDataViewMyDesigns:"lobby:viewMyDesigns",kAnalyticsDataAnimationEffectsPressed:"editor:effectsPressed",kAnalyticsDataAnimationEffectsViewed:"editor:effectsViewed",kAnalyticsMerchandisingTriggerEnterDesign:"postEnterDesign",kAnalyticsMerchandisingTriggerEditPost:"postEditPost",kAnalyticsDataAddVideoPressed:"editor:addVideoPressed",kAnalyticsDataImageAdded:"editor:imageAdded",kAnalyticsDataImageWithAlphaAdded:"editor:imageWithAlphaAdded",kAnalyticsDataLogoAdded:"editor:logoAdded",kAnalyticsDataTextAdded:"editor:textAdded",kAnalyticsDataIconAdded:"editor:iconAdded",kAnalyticsDataStickerAdded:"editor:stickerAdded",kAnalyticsDataBrandedTemplateUsed:"editor:brandedTemplateUsed",kAnalyticsDataAddBrandPressed:"editor:addBrandPressed",kAnalyticsDataBrandSwitchPressed:"editor:brandSwitchPressed",kAnalyticsDataNewBrandApplied:"editor:newBrandApplied",kAnalyticsDataBrandifyUsed:"editor:brandifyUsed",kAnalyticsDataCustomThemePressed:"brand:customThemePressed",kAnalyticsDataFreeBrandMerchandisingViewed:"editor:freeBrandMerchandisingViewed",kAnalyticsDataNoBrandMerchandisingViewed:"editor:noBrandMerchandisingViewed",kAnalyticsDataOneBrandMerchandisingViewed:"editor:oneBrandMerchandisingViewed",kAnalyticsDesignViewNetworkInfo:"editor:networkInfo",kAnalyticsDataThemeSelect:"editor:themeSelected",kAnalyticsDataColorPressed:"editor:colorPressed",kAnalyticsDataColorThemeCategoryViewAllPressed:"editor:colorThemeCategoryViewAllPressed",kAnalyticsDataColorThemeSelected:"editor:colorThemeSelected",kAnalyticsDataColorThemeCategoryName:"colorThemeCategoryName",kAnalyticsDataIsColorThemeSearch:"isColorThemeSearch",kAnalyticsDataColorThemeCustomSearchEntered:"editor:colorThemeCustomSearchEntered",kAnalyticsDataColorSearchTerm:"colorSearchTerm",kAnalyticsDataLayoutPressed:"editor:layoutPressed",kAnalyticsDataResizePressed:"editor:resizePressed",kAnalyticsDataBrandPressed:"editor:brandPressed",kAnalyticsDataCutoutSelect:"editor:cutout:selected",kAnalyticsDataEffectsFilterSelect:"editor:effects:filterSelected",kAnalyticsDataEffectsEnhanceSelect:"editor:effects:enhanceSelected",kAnalyticsDataEffectsAnimationSelect:"editor:effects:animationSelected",kAnalyticsDataLayoutLayoutSelect:"editor:layout:layoutSelected",kAnalyticsDataLayoutSpacingSelect:"editor:layout:spacingSelected",kAnalyticsDataLayoutBackgroundSelect:"editor:layout:bgColorSelected",kAnalyticsDataBackgroundColorSelect:"editor:bgColorSelected",kAnalyticsDataTextSelected:"editor:text:selected",kAnalyticsDataImageSelected:"editor:image:selected",kAnalyticsDataShapeSelected:"editor:shape:selected",kAnalyticsDataLogoSelected:"editor:logo:selected",kAnalyticsDataMultiSelected:"editor:multi:selected",kAnalyticsDataBackgroundSelected:"editor:background:selected",kAnalyticsDataAlignmentGroupSelected:"editor:alignmentGroup:selected",kAnalyticsDataTextDeleted:"editor:text:deleted",kAnalyticsDataImageDeleted:"editor:image:deleted",kAnalyticsDataCellDeleted:"editor:cell:deleted",kAnalyticsDataShapeDeleted:"editor:shape:deleted",kAnalyticsDataStickerDeleted:"editor:sticker:deleted",kAnalyticsDataGroupDeleted:"editor:group:deleted",kAnalyticsDataImageFlipped:"editor:image:flipped",kAnalyticsDataShapeFlipped:"editor:shape:flipped",kAnalyticsDataIconFlippedVertical:"editor:icon:verticalFlipPressed",kAnalyticsDataIconFlippedHorizontal:"editor:icon:horizontalFlipPressed",kAnalyticsDataTextFlipped:"editor:text:flipped",kAnalyticsDataImageNudged:"editor:image:nudged",kAnalyticsDataShapeNudged:"editor:shape:nudged",kAnalyticsDataTextNudged:"editor:text:nudged",kAnalyticsDataMultipleNudged:"editor:multi:nudged",kAnalyticsDataImageRotated:"editor:image:rotated",kAnalyticsDataShapeRotated:"editor:shape:rotated",kAnalyticsDataTextRotated:"editor:text:rotated",kAnalyticsDataMultiRotated:"editor:multi:rotated",kAnalyticsDataImageResized:"editor:image:resized",kAnalyticsDataShapeResized:"editor:shape:resized",kAnalyticsDataTextResized:"editor:text:resized",kAnalyticsDataMultiResized:"editor:multi:resized",kAnalyticsDataTextDuplicated:"editor:text:duplicated",kAnalyticsDataImageDuplicated:"editor:image:duplicated",kAnalyticsDataIconDuplicated:"editor:icon:duplicated",kAnalyticsDataShapeDuplicated:"editor:shape:duplicated",kAnalyticsDataImageEditCutoutPressed:"editor:image:editCutoutPressed",kAnalyticsDataImageEditCutoutBrushSizeAdjusted:"editor:image:cutoutBrushSizeAdjusted",kAnalyticsDataImageEditCutoutRestorePressed:"editor:image:cutoutRestorePressed",kAnalyticsDataImageEditCutoutResetPressed:"editor:image:cutoutResetPressed",kAnalyticsDataImageEditCutoutInvertPressed:"editor:image:cutoutInvertPressed",kAnalyticsDataImageEditCutoutShowImageToggled:"editor:image:cutoutShowImageToggled",kAnalyticsDataImageEditCutoutCompleted:"editor:image:cutoutCompleted",kAnalyticsDataImageEditCutoutCancelled:"editor:image:cutoutCancelled",kAnalyticsIconAdded:"core:iconAdded",kAnalyticsIconReplaced:"core:iconReplaced",kAnalyticsIconDeleted:"core:iconDeleted",kAnalyticsFormaeAligned:"core:formaeAligned",kAnalyticsFormaeDistributed:"core:formaeDistributed",kAnalyticsFormaeArranged:"core:formaeArranged",kAnalyticsFormaeDragged:"core:formaeDragged",kAnalyticsDataColorOpen:"Preview Color",kAnalyticsDataThemeOpen:"Preview Theme",kAnalyticsDataFilterOpen:"Preview Filter",kAnalyticsImageAddedToFrame:"core:imageAddedToFrame",kAnalyticsImageReplaced:"core:imageReplaced",kAnalyticsVideoTrimmed:"editVideo:videoTrimmed",kAnalyticsVideoAudioAdjusted:"editVideo:audioAdjusted",kAnalyticsVideoAudioAdjustedDefault:"audioLevel:default",kAnalyticsVideoAudioAdjustedLow:"audioLevel:low",kAnalyticsVideoAudioAdjustedMute:"audioLevel:mute",kAnalyticsDataColorCellConfirm:"editor:colorConfirmed",kAnalyticsDataThemeCellConfirm:"editor:themeConfirmed",kAnalyticsDataFilterCellConfirm:"editor:filterConfirmed",kAnalyticsDataCutoutCellConfirm:"editor:cutoutConfirmed",kAnalyticsDataEnhanceConfirm:"editor:enhanceConfirmed",kAnalyticsDataLayoutConfirm:"editor:layoutConfirmed",kAnalyticsDataBrandConfirm:"editor:brandConfirmed",kAnalyticsDataLayoutLayoutConfirm:"editor:layout:layoutConfirmed",kAnalyticsDataLayoutSpacingConfirm:"editor:layout:spacingConfirmed",kAnalyticsDataLayoutSizeConfirm:"editor:layout:sizeConfirmed",kAnalyticsDataLayoutBackgroundColorConfirm:"editor:layout:bgColorConfirmed",kAnalyticsDataBackgroundColorCellConfirm:"editor:bgColorConfirmed",kAnalyticsDataColorCellCancel:"editor:colorCancelled",kAnalyticsDataThemeCellCancel:"editor:themeCancelled",kAnalyticsDataFilterCellCancel:"editor:filterCancelled",kAnalyticsDataCutoutCellCancel:"editor:cutoutCancelled",kAnalyticsDataEnhanceCancel:"editor:enhanceCancelled",kAnalyticsDataLayoutCancel:"editor:layoutCancelled",kAnalyticsDataBrandCancel:"editor:brandCancelled",kAnalyticsDataGlobalEffectCancel:"editor:globalEffectCancelled",kAnalyticsDataAddStickerCancel:"editor:addStickerCancelled",kAnalyticsDataLayoutLayoutCancel:"editor:layout:layoutCancelled",kAnalyticsDataLayoutSpacingCancel:"editor:layout:spacingCancelled",kAnalyticsDataLayoutSizeCancel:"editor:layout:sizeCancelled",kAnalyticsDataLayoutBackgroundColorCancel:"editor:layout:bgColorCancelled",kAnalyticsDataBackgroundColorCellCancel:"editor:bgColorCancelled",kAnalyticsDataColorCellChanged:"editor:colorChanged",kAnalyticsDataThemeCellChanged:"editor:themeChanged",kAnalyticsDataFilterCellChanged:"editor:image:filtersApplied",kAnalyticsDataCutoutCellChanged:"editor:cutoutChanged",kAnalyticsDataLayoutChanged:"editor:layoutChanged",kAnalyticsDataLayoutLayoutChanged:"editor:layout:layoutChanged",kAnalyticsDataLayoutSpacingChanged:"editor:layout:spacingChanged",kAnalyticsDataLayoutSizeChanged:"editor:layout:sizeChanged",kAnalyticsDataLayoutBackgroundColorChanged:"editor:layout:bgColorChanged",kAnalyticsDataLayoutCustomSizeSelected:"editor:layout:customSizeSelected",kAnalyticsDataLayoutCustomSizeDidConfirmed:"editor:layout:customSizeDidConfirmed",kAnalyticsDataLayoutCustomSizeDidCanceled:"editor:layout:customSizeDidCanceled",kAnalyticsDataBackgroundColorCellChanged:"editor:bgColorChanged",kAnalyticsDataWheelChoice:"editor:wheelSelected",kAnalyticsDataWheelDone:"editor:wheelSelectionConfirmed",kAnalyticsDataWheelCancel:"editor:wheelSelectionCanceled",kAnalyticsDataBackingOpen:"editor:backingSelected",kAnalyticsDataBackingConfirm:"editor:backingConfirmed",kAnalyticsDataBackingCancel:"editor:backingCancelled",kAnalyticsDataDuotoneOpen:"editor:duotoneSelected",kAnalyticsDataDuotoneConfirm:"editor:duotoneConfirmed",kAnalyticsDataDuotoneCancel:"editor:duotoneCancelled",kAnalyticsDataFilterName:"filterName",kAnalyticsDataFilterType:"filterUsed",kAnalyticsDataDuotoneCustom:"Custom",kAnalyticsDataDuotonePreset:"Preset",kAnalyticsDataDuotoneSwap:"Swap",kAnalyticsDataDuotoneDefault:"Default",kAnalyticsDataFontOpen:"launchedFontPicker",kAnalyticsDataFontConfirm:"pickedFont",kAnalyticsDataFontCancel:"canceledFontPicker",kAnalyticsDataFontChanged:"changedFont",kAnalyticsDataAddFontsPressed:"fontPicker:addFontsPressed",kAnalyticsDataFontRecsOpen:"launchedFontRecsPicker",kAnalyticsDataFontRecsConfirm:"pickedFontRec",kAnalyticsDataFontRecsCancel:"canceledFontRecsPicker",kAnalyticsDataFontRecsChanged:"changedFontRec",kAnalyticsDataFontRecommendationMenuPressed:"editor:fontRecommendationMobileMenuPressed",kAnalyticsDataFontRecommendationPressed:"editor:fontRecommendationPressed",kAnalyticsDataFontSimilarPressed:"editor:fontRecommendationSimilarFontPressed",kAnalyticsDataFontRecommendationMore:"editor:fontRecommendationMore",kAnalyticsDataFontRecommendationBack:"editor:fontRecommendationBack",kAnalyticsDataFontSimilarIconPressed:"editor:fontRecommendationSimilarIconPressed",kAnalyticsDataFontRecommendationSelected:"editor:fontRecommendationSelected",kAnalyticsDataFontPanel:"panel",kAnalyticsDataFontText:"font",kAnalyticsDataFontRecommendations:"recommendation",kAnalyticsDataFontSimilar:"similar",kAnalyticsDataFontOriginal:"original",kAnalyticsDataTextID:"textID",kAnalyticsDataFontName:"fontName",kAnalyticsDataFontFamily:"fontFamily",kAnalyticsDataFontType:"fontType",kAnalyticsDataFontRecommendationSource:"recommendationSource",kAnalyticsDataFontRecommendationType:"recommendationType",kAnalyticsDataFontAlternatives:"alternatives",kAnalyticsDataAnonymizedText:"anonymizedText",kAnalyticsDataTextContext:"txtCtx",kAnalyticsDataDocumentContext:"docCtx",kAnalyticsDataTextScripts:"textScripts",kAnalyticsDataOriginalFont:"originalFont",kAnalyticsDataSimilarFont:"similarFont",kAnalyticsDataFontApplyToAll:"applyToAllToggleActive",kAnalyticsDataFontMode:"pickerMode",kAnalyticsDataFontModeFace:"face",kAnalyticsDataFontModeHeadline:"headline",kAnalyticsDataFontModeBody:"body",kAnalyticsDataFontModeCard:"card",kAnalyticsDataOpacityOpen:"editor:opacitySelected",kAnalyticsDataOpacityConfirm:"editor:opacityConfirmed",kAnalyticsDataOpacityCancel:"editor:opacityCancelled",kAnalyticsDataBorderOpen:"editor:borderSelected",kAnalyticsDataBorderConfirm:"editor:borderConfirmed",kAnalyticsDataBorderCancel:"editor:borderCancelled",kAnalyticsDataBorderColorSelected:"editor:text:borderColorSelected",kAnalyticsDataCornerOpen:"editor:cornerSelected",kAnalyticsDataCornerConfirm:"editor:cornerConfirmed",kAnalyticsDataCornerCancel:"editor:cornerCancelled",kAnalyticsDataAdjustOpen:"editor:adjustSelected",kAnalyticsDataAdjustConfirm:"editor:adjustConfirmed",kAnalyticsDataAdjustCancel:"editor:adjustCancelled",kAnalyticsDataEditFormaOpen:"editor:editFormaSelected",kAnalyticsDataEditFormaConfirm:"editor:editFormaConfirmed",kAnalyticsDataEditFormaCancel:"editor:editFormaCancelled",kAnalyticsDataAlignFormaeOpen:"editor:alignFormaeSelected",kAnalyticsDataAlignFormaeConfirm:"editor:alignFormaeConfirmed",kAnalyticsDataAlignFormaeCancel:"editor:alignFormaeCancelled",kAnalyticsDataDistributeFormaeOpen:"editor:distributeFormaeSelected",kAnalyticsDataDistributeFormaeConfirm:"editor:distributeFormaeConfirmed",kAnalyticsDataDistributeFormaeCancel:"editor:distributeFormaeCancelled",kAnalyticsDataAdjustNudgeOpen:"editor:adjustNudgeSelected",kAnalyticsDataAdjustNudgeConfirm:"editor:adjustNudgeConfirmed",kAnalyticsDataAdjustNudgeCancel:"editor:adjustNudgeCancelled",kAnalyticsDataAdjustRotateOpen:"editor:adjustRotateSelected",kAnalyticsDataAdjustRotateConfirm:"editor:adjustRotateConfirmed",kAnalyticsDataAdjustRotateCancel:"editor:adjustRotateCancelled",kAnalyticsDataAdjustRotateButtonSelected:"editor:adjustRotateButtonSelected",kAnalyticsDataAdjustScaleOpen:"editor:adjustScaleSelected",kAnalyticsDataAdjustScaleConfirm:"editor:adjustScaleConfirmed",kAnalyticsDataAdjustScaleCancel:"editor:adjustScaleCancelled",kAnalyticsDataAdjustFlipOpen:"editor:adjustFlipSelected",kAnalyticsDataAdjustFlipConfirm:"editor:adjustFlipConfirmed",kAnalyticsDataAdjustFlipCancel:"editor:adjustFlipCancelled",kAnalyticsDataAdjustFlipH:"editor:adjustFlippedH",kAnalyticsDataAdjustFlipV:"editor:adjustFlippedV",kAnalyticsDataEditMultiselect:"editor:editMultiselect",kAnalyticsDataEditDeselect:"editor:editDeselect",kAnalyticsDataEditDelete:"editor:editDelete",kAnalyticsDataEditDuplicate:"editor:editDuplicate",kAnalyticsDataEditGroup:"editor:editGroup",kAnalyticsDataEditUngroup:"editor:editUngroup",kAnalyticsDataEditLicense:"editor:editLicense",kAnalyticsDataEditReplaceImage:"editor:replaceImage",kAnalyticsDataEditTextEdit:"editor:textEdit",kAnalyticsDataEditMultistyleText:"editor:multistyleText",kAnalyticsDataEditImageCrop:"editImage:cropPressed",kAnalyticsDataEditImageCropRatioSelected:"editImage:cropRatioSelected",kAnalyticsDataEditImageCropShapeSelected:"editImage:cropShapeSelected",kAnalyticsDataEditImageCropRasterMaskSelected:"editImage:cropRasterMaskSelected",kAnalyticsDataEditImageCropCompleted:"editImage:cropCompleted",kAnalyticsDataEditImageCropImageAdjusted:"editImage:cropImageAdjusted",kAnalyticsDataEditImageLayerSelected:"editImage:layerSelected",kAnalyticsDataEditImageRemoveBackgroundApplied:"editor:backgroundRemoveApplied",kAnalyticsDataEditImageRestoreBackgroundApplied:"editor:backgroundRestoreApplied",kAnalyticsDataEditImageRemoveBackgroundPressed:"editImage:removeBackgroundPressed",kAnalyticsDataEditImageReturnBackgroundPressed:"editImage:returnBackgroundPressed",kAnalyticsDataEditImageRemoveBackgroundLimitedTimePopupDismissed:"editor:limitedTimePopupDismissed",kAnalyticsDataGroupPressed:"editor:multiselect:groupPressed",kAnalyticsDataGroupUngroupPressed:"editor:group:ungroupPressed",kAnalyticsDataMultiselectUngroupPressed:"editor:multiselect:ungroupPressed",kAnalyticsDataEditSound:"editor:sound",kAnalyticsDataZoomEntered:"zoomEntered",kAnalyticsDataZoomChanged:"zoomChanged",kAnalyticsDataZoomExited:"zoomExited",kAnalyticsDataZoomIn:"in",kAnalyticsDataZoomOut:"out",kAnalyticsDataZoomNone:"none",kAnalyticsDataZoomPan:"pan",kAnalyticsDataZoomButton:"button",kAnalyticsDataZoomGesture:"gesture",kAnalyticsDataObjectDeselected:"objectDeselected",kAnalyticsDataCancelButton:"cancel",kAnalyticsDataDoneButton:"done",kAnalyticsDataCheckButton:"check",kAnalyticsDataDownloadButton:"download",kAnalyticsDataShareButton:"share",kAnalyticsDataDeselectTap:"deselect",kAnalyticsDataSelectionDeselectAll:"editor:selectionDeselectAll",kAnalyticsDataSelectionSelectAll:"editor:selectionSelectAll",kAnalyticsDataSelectionTouchEnd:"editor:selectionTouchEnd",kAnalyticsDataSelectionConfirm:"editor:selectionConfirm",kAnalyticsDataSelectionMarqueeSelect:"editor:selectionMarqueeSelect",kAnalyticsDataSelectionMultiple:"editor:selectionMultiple",kAnalyticsDataLayerOpen:"editor:layerSelected",kAnalyticsDataLayerConfirm:"editor:layerConfirmed",kAnalyticsDataLayerCancel:"editor:layerCancelled",kAnalyticsDataTextFrameEdited:"editor:textFrameEdited",kAnalyticsDataTextSpacingOpen:"editor:textSpacingSelected",kAnalyticsDataTextSpacingConfirm:"editor:textSpacingConfirmed",kAnalyticsDataTextSpacingCancel:"editor:textSpacingCancelled",kAnalyticsDataTextSpacingChanged:"editor:textSpacingChanged",kAnalyticsDataTextPaddingChanged:"editor:text:shapeSizeValueChanged",kAnalyticsDataTextLineHeightChanged:"editor:text:lineSpacingValueChanged",kAnalyticsDataTextTrackingChanged:"editor:text:letterSpacingValueChanged",kAnalyticsDataTextAlignmentOpen:"editor:alignmentSelected",kAnalyticsDataTextAlignmentConfirm:"editor:alignmentConfirmed",kAnalyticsDataTextAlignmentCancel:"editor:alignmentCancelled",kAnalyticsDataTextAlignmentChanged:"editor:alignmentChanged",kAnalyticsDataTextLayoutSelected:"editor:textLayoutSelected",kAnalyticsDataTextHighlightOpen:"editor:highlightSelected",kAnalyticsDataTextHighlightConfirm:"editor:highlightConfirmed",kAnalyticsDataTextHighlightCancel:"editor:highlightCancelled",kAnalyticsDataTextEffectsOpen:"editor:effectsSelected",kAnalyticsDataTextEffectsConfirm:"editor:effectsConfirmed",kAnalyticsDataTextEffectsCancel:"editor:effectsCancelled",kAnalyticsDataTextOpacityOpen:"editor:textOpacitySelected",kAnalyticsDataTextOpacityConfirm:"editor:textOpacityConfirmed",kAnalyticsDataTextOpacityCancel:"editor:textOpacityCancelled",kAnalyticsDataTextOutlineOpen:"editor:outlineSelected",kAnalyticsDataTextOutlineConfirm:"editor:outlineConfirmed",kAnalyticsDataTextOutlineCancel:"editor:outlineCancelled",kAnalyticsDataTextShadowOpen:"editor:shadowSelected",kAnalyticsDataTextShadowConfirm:"editor:shadowConfirmed",kAnalyticsDataTextShadowCancel:"editor:shadowCancelled",kAnalyticsDataTextColorOpen:"editor:textColorSelected",kAnalyticsDataTextColorConfirm:"editor:textColorConfirmed",kAnalyticsDataTextColorCancel:"editor:textColorCancelled",kAnalyticsDataTextShapeEnabled:"editor:text:shapeEnabled",kAnalyticsDataTextShapeDisabled:"editor:text:shapeDisabled",kAnalyticsDataTextShadowEnabled:"editor:text:shadowEnabled",kAnalyticsDataTextShadowDisabled:"editor:text:shadowDisabled",kAnalyticsDataTextOutlineEnabled:"editor:text:outlineEnabled",kAnalyticsDataTextOutlineDisabled:"editor:text:outlineDisabled",kAnalyticsDataTextShapeMaskEnabled:"editor:text:shapeMaskEnabled",kAnalyticsDataTextShapeMaskDisabled:"editor:text:shapeMaskDisabled",kAnalyticsDataTextOutlineOnlyEnabled:"editor:text:outlineOnlyEnabled",kAnalyticsDataTextOutlineOnlyDisabled:"editor:text:outlineOnlyDisabled",kAnalyticsDataTextOutlineThicknessChanged:"editor:text:outlineThicknessValueChanged",kAnalyticsDataTextShadowDistanceChanged:"editor:text:shadowDistanceValueChanged",kAnalyticsDataTextShadowDirectionChanged:"editor:text:shadowDirectionValueChanged",kAnalyticsDataTextShapeOpacityChanged:"editor:text:shapeOpacityValueChanged",kAnalyticsDataTextOpacityChanged:"editor:text:opacityValueChanged",kAnalyticsDataTextFillColorSelected:"editor:text:fillColorSelected",kAnalyticsDataTextShapeColorSelected:"editor:text:shapeColorSelected",kAnalyticsDataTextShadowColorSelected:"editor:text:shadowColorSelected",kAnalyticsDataTextOutlineColorSelected:"editor:text:outlineColorSelected",kAnalyticsDataTextShuffleColorSelected:"editor:text:shuffleColorSelected",kAnalyticsDataTextShapeSelected:"editor:text:shapeSelected",kAnalyticsDataShapeShuffleColorSelected:"editor:shape:shuffleColorSelected",kAnalyticsDataTextInspectorConfirm:"editor:textInspectorConfirm",kAnalyticsDataTextInspectorCancel:"editor:textInspectorCancel",kAnalyticsDataShapeFillColorSelected:"editor:shapeFillColorSelected",kAnalyticsDataShapeBorderColorSelected:"editor:shapeBorderColorSelected",kAnalyticsDataTextTopBarEnterTextEditor:"editor:topBarEnterTextEditor",kAnalyticsDataTextDoubleTapEnterTextEditor:"editor:textEditStarted",kAnalyticsDataTextTopBarEnterCharacterStyleMode:"editor:topBarEnterCharStyleMode",kAnalyticsDataTextEditPaneEnterCharacterStyleMode:"editor:editPaneEnterCharStyleMode",kAnalyticsDataTextOnObjectEnterCharacterStyleMode:"editor:onObjectEnterCharStyleMode",kAnalyticsDataTextLongPressEnterCharacterStyleMode:"editor:longPressEnterCharStyleMode",kAnalyticsDataTextInCharacterStyleModePostfix:":inCharStyleMode",kAnalyticsDataTextEditorDone:"editor:textEditDone",kAnalyticsDataTextEditorCancel:"editor:textEditCancel",kAnalyticsDataSizeOpen:"editor:sizeSelected",kAnalyticsDataSizeConfirm:"editor:sizeConfirmed",kAnalyticsDataSizeCancel:"editor:sizeCancelled",kAnalyticsDataImageAdjustBlurOpen:"editor:imageEffectBlurSelected",kAnalyticsDataImageAdjustBlurConfirm:"editor:imageEffectBlurConfirmed",kAnalyticsDataImageAdjustBlurCancel:"editor:imageEffectBlurCancelled",kAnalyticsDataImageAdjustSharpenOpen:"editor:imageAdjustSharpenSelected",kAnalyticsDataImageAdjustSharpenConfirm:"editor:imageAdjustSharpenConfirmed",kAnalyticsDataImageAdjustSharpenCancel:"editor:imageAdjustSharpenCancelled",kAnalyticsDataImageAdjustContrastOpen:"editor:imageAdjustContrastSelected",kAnalyticsDataImageAdjustContrastConfirm:"editor:imageAdjustContrastConfirmed",kAnalyticsDataImageAdjustContrastCancel:"editor:imageAdjustContrastCancelled",kAnalyticsDataImageAdjustBrightnessOpen:"editor:imageAdjustBrightnessSelected",kAnalyticsDataImageAdjustBrightnessConfirm:"editor:imageAdjustBrightnessConfirmed",kAnalyticsDataImageAdjustBrightnessCancel:"editor:imageAdjustBrightnessCancelled",kAnalyticsDataImageAdjustSaturationOpen:"editor:imageAdjustSaturationSelected",kAnalyticsDataImageAdjustSaturationConfirm:"editor:imageAdjustSaturationConfirmed",kAnalyticsDataImageAdjustSaturationCancel:"editor:imageAdjustSaturationCancelled",kAnalyticsDataImageAdjustWarmthOpen:"editor:imageAdjustWarmthSelected",kAnalyticsDataImageAdjustWarmthConfirm:"editor:imageAdjustWarmthConfirmed",kAnalyticsDataImageAdjustWarmthCancel:"editor:imageAdjustWarmthCancelled",kAnalyticsDataImageAdjusted:"editor:imageAdjusted",kAnalyticsDataTypekitMetricsFailed:"typekit:metrics:failed",kAnalyticsDataTypekitInstalled:"typekit:installed",kAnalyticsDataTypekitPickerLaunch:"typekit:pickerLaunch",kAnalyticsDataTypekitBrowserLaunch:"typekit:browserLaunch",kAnalyticsDataTypekitApplyFontSDKPicker:"typekit:applyFontSDKPicker",kAnalyticsDataTypekitApplyFont:"typekit:applyFont",kAnalyticsDataExportFontUsage:"exportFontUsage",kAnalyticsDataFontSource:"fontSource",kAnalyticsDataFontRecUsed:"fontRecUsed",kAnalyticsDataFontRecSource:"fontRecSource",kAnalyticsDataFontRecSourceCounts:"recommendationSourceCounts",kAnalyticsDataFontRecTypeCounts:"recommendationTypeCounts",kAnalyticsDataWatermarkSelectedPerProject:"editor:watermarkSelected_perProject",kAnalyticsDataWatermarkSelectedShareToRemove:"editor:watermarkSelected_shareToRemove",kAnalyticsDataWatermarkRemovedPerProject:"editor:watermarkRemoved_perProject",kAnalyticsDataWatermarkRemovedShareToRemove:"editor:watermarkRemoved_shareToRemove",kAnalyticsDataWatermarkRemoveCancelledPerProject:"editor:watermarkRemoveCancelled_perProject",kAnalyticsDataWatermarkRemoveCancelledShareToRemove:"editor:watermarkRemoveCancelled_shareToRemove",kAnalyticsDataWatermarkShownPerProject:"editor:watermarkShown_perProject",kAnalyticsDataWatermarkShownShareToRemove:"editor:watermarkShown_shareToRemove",kAnalyticsDataWatermarkPerProjectCohort:"editor:perProjectWatermarkCohortAssignment",kAnalyticsDataWatermarkShareToRemoveCohort:"editor:shareToRemoveWatermarkCohortAssignment",kAnalyticsDataWatermarkHiddenCohort:"editor:noWatermarkCohortAssignment",kAnalyticsDataWatermarkSelectedRemoveOnce:"editor:watermarkSelected_removeOnce",kAnalyticsDataWatermarkSelectedPayToRemove:"editor:watermarkSelected_payToRemove",kAnalyticsDataWatermarkRemovedRemoveOnce:"editor:watermarkRemoved_removeOnce",kAnalyticsDataWatermarkRemovedPayToRemove:"editor:watermarkRemoved_payToRemove",kAnalyticsDataWatermarkRemoveCancelledRemoveOnce:"editor:watermarkRemoveCancelled_removeOnce",kAnalyticsDataWatermarkRemoveCancelledPayToRemove:"editor:watermarkRemoveCancelled_payToRemove",kAnalyticsDataWatermarkShownRemoveOnce:"editor:watermarkShown_removeOnce",kAnalyticsDataWatermarkShownPayToRemove:"editor:watermarkShown_payToRemove",kAnalyticsDataWatermarkPayToRemove:"editor:payToRemoveWatermarkVariantAssignment",kAnalyticsDataWatermarkRemoveOnce:"editor:removeOnceVariantAssignment",kAnalyticsDataWatermarkPressed:"editor:watermarkPressed",kAnalyticsDataFollowUsInstagramPressed:"organizer:followUsInstagramPressed",kAnalyticsDataFollowUsInstagramCancelled:"organizer:followUsInstagramCancelled",kAnalyticsDataSharePosterStartEvent:"share:shareBegin",kAnalyticsDataSharePosterCancel:"share:shareCancelled",kAnalyticsDataSharePosterSuccess:"share:shareSuccess",kAnalyticsDataSharePosterMetadata:"share:documentMetadata",kAnalyticsDataSharePosterRemixTemplatePublished:"share:remixTemplatePublished",kAnalyticsDataSharePosterCreateRemixAllowPressed:"share:createRemixAllowPressed",kAnalyticsDataSharePosterCreateRemixDismissPressed:"share:createRemixDismissPressed",kAnalyticsDataSharePosterDiscoverabilityChanged:"share:communityPlatformDiscoverabilityChanged",kAnalyticsDataSharePosterInstagramStoryPressed:"share:instagramStoryPressed",kAnalyticsDataSharePosterSnapchatPressed:"share:snapchatPressed",kAnalyticsDataSharePosterCreateTemplateTapped:"share:createTemplateTapped",kAnalyticsDataSharePosterFacebookTapped:"share:facebookTapped",kAnalyticsDataSharePosterTwitterTapped:"share:twitterTapped",kAnalyticsDataSharePosterInstagramTapped:"share:instagramTapped",kAnalyticsDataSharePosterMessagesTapped:"share:messagesTapped",kAnalyticsDataSharePosterWhatsAppTapped:"share:whatsAppTapped",kAnalyticsDataSharePosterMailTapped:"share:mailTapped",kAnalyticsDataSharePosterCopyLinkTapped:"share:copyLinkTapped",kAnalyticsDataSharePosterCopySaveToCameraRollTapped:"share:saveToCameraRollTapped",kAnalyticsDataSharePosterMoreTapped:"share:moreTapped",kAnalyticsDataSharePosterDoneTapped:"share:doneTapped",kAnalyticsDataSharePosterCancelTapped:"share:cancelTapped",kAnalyticsDataSharePosterSuccessAction:"Content Publishes",kAnalyticsDataResharePosterSuccessAction:"Content Republishes",kAnalyticsDataSharePosterTransparentBackgroundTapped:"share:transparentBackgroundTapped",kAnalyticsDataSharePosterSolidBackgroundTapped:"share:solidBackgroundTapped",kAnalyticsDataFormaColorSelected:"editor:formaColorSelected",kAnalyticsDataFormaColorConfirm:"editor:formaColorConfirmed",kAnalyticsDataFormaColorCancel:"editor:formaColorCancelled",kAnalyticsDataFormaColorChanged:"editor:formaColorChanged",kAnalyticsDataOrganizerLoad:"app:launch",kAnalyticsDataTemplatesPressed:"home:templatesPressed",kAnalyticsDataMyPostsPressed:"home:myPostsPressed",kAnalyticsDataScrollFeaturedPosters:"lobby:scrollFeaturedPosters",kAnalyticsDataScrollMyDesigns:"lobby:scrollMyDesigns",kAnalyticsDataCreateNewTapped:"lobby:createNewTapped",kAnalyticsDataFollowOpenInstagram:"lobby:followInstagramOpened",kAnalyticsDataFollowOpenSafari:"lobby:followSafariOpened",kAnalyticsDataFollowInspirationInstagramDidDisplayButtonOnTop:"inspirationInstagramDidDisplayButtonOnTop",kAnalyticsDataFollowInspirationInstagramDidDisplayButtonOnBottom:"inspirationInstagramDidDisplayButtonOnBottom",kAnalyticsDataFollowInspirationInstagramDidPressHeader:"inspirationInstagramDidPressHeader",kAnalyticsDataFollowInspirationInstagramDidPressFooter:"inspirationInstagramDidPressFooter",kAnalyticsDataFollowSettingsInstagram:"settingsInstagramButtonPressed",kAnalyticsDataFollowSettingsTwitter:"settingsTwitterButtonPressed",kAnalyticsDataFollowSettingsFacebook:"settingsFacebookButtonPressed",kAnalyticsDataSettingsAccountViewed:"settingsAccountViewed",kAnalyticsDataViralShareWatermark:"viral:wm:sharedViaViral",kAnalyticsDataViralShareWithLinkWatermark:"wm:Viral Link",kAnalyticsDataViralShareWatermarkAttempt:"viral:wm:shareAttempt",kAnalyticsDataViralShareWatermarkCancel:"viral:wm:shareFail",kAnalyticsDataViralSharePremium:"viral:p:sharedViaViral",kAnalyticsDataViralShareWithLinkPremium:"p:Viral Link",kAnalyticsDataViralSharePremiumAttempt:"viral:p:shareAttempt",kAnalyticsDataViralSharePremiumCancel:"viral:p:shareFail",kAnalyticsDataViralSummitLogo:"viral:summitLogo:sharedViaViral",kAnalyticsDataViralSummitLogoRemove:"viral:summitLogo:remove",kAnalyticsDataApplicationDidBecomeActive:"applicationDidBecomeActive",kAnalyticsDataCancel:"rating:cancel",kAnalyticsDataLoveIt:"rating:loveIt:corrected",kAnalyticsDataFeedback:"rating:feedback:corrected",kAnalyticsOnboardingScreenViewed:"onboarding:screenViewed",kAnalyticsOnboardingScreenDismissed:"onboarding:screenDismissed",kAnalyticsOnboardingStartNowClicked:"onboarding:startNowClicked",kAnalyticsOnboardingSkipToSignInClicked:"onboarding:skipToSignInClicked",kAnalyticsOnboardingNextClicked:"onboarding:nextClicked",kAnalyticsOnboardingBackClicked:"onboarding:backClicked",kAnalyticsDataLoginFailed:"login:failed",kAnalyticsDataLoginBeganAccountCreation:"login:facebook:beganAccountCreation",kAnalyticsDataLoginTOSDisplayed:"login:facebook:tos:displayed",kAnalyticsDataLoginTOSAccepted:"login:facebook:tos:accepted",kAnalyticsDataLoginMarketingOptInDisplayed:"login:facebook:marketingOptIn:displayed",kAnalyticsDataLoginMarketingOptInOptionSelected:"login:facebook:marketingOptIn:optionSelected",kAnalyticsDataLoginMarketingOptInDoneClicked:"login:facebook:marketingOptIn:doneClicked",kAnalyticsDataLoginMarketingOptInLearnMoreClicked:"login:facebook:marketingOptIn:learnMoreClicked",kAnalyticsSummitDesignsUnlocked:"lobby:unlockSummitDesigns",kAnalyticsDataAnimationCancel:"editor:animation:animationCancel",kAnalyticsDataAnimationPressed:"editor:animationPressed",kAnalyticsDataAnimationViewed:"editor:animationViewed",kAnalyticsDataAnimationPreviewed:"animationPreviewed",kAnalyticsDataAnimationConfirmed:"animationConfirmed",kAnalyticsDataAnimationExportCancelled:"project:exportCancelled",kAnalyticsDataAnimationExportBegan:"project:exportBegan",kAnalyticsDataCategoryEntered:"organizer:category:entered",kAnalyticsDataCategoryExited:"organizer:category:exited",kAnalyticsDataPreviewEntered:"organizer:preview:entered",kAnalyticsDataPreviewExited:"organizer:preview:exited",kAnalyticsDataPreviewCancelled:"organizer:preview:cancelled",kAnalyticsDataPreviewDownloadSuccess:"organizer:preview:download:success",kAnalyticsDataPreviewDownloadFailed:"organizer:preview:download:failed",kAnalyticsDataPreviewDownloadRetry:"organizer:preview:download:retry",kAnalyticsDataPreviewTemplateName:"organizer:preview:templateName",kAnalyticsDataPreviewAuthorName:"organizer:preview:authorName",kAnalyticsDataPreviewRemixCountIcon:"organizer:preview:remix:countIconPressed",kAnalyticsDataPreviewRemixCountLabel:"organizer:preview:remix:countLabelPressed",kAnalyticsDataPreviewRemixMoreOptions:"organizer:preview:remix:moreOptionsPressed",kAnalyticsDataPreviewRemixMoreOptionsCopyLink:"organizer:preview:remix:moreOptions:copyLink",kAnalyticsDataPreviewRemixMoreOptionsShare:"organizer:preview:remix:moreOptions:share",kAnalyticsDataPreviewRemixMoreOptionsReport:"organizer:preview:remix:moreOptions:report",kAnalyticsDataPreviewRemixMoreOptionsCancel:"organizer:preview:remix:moreOptions:cancel",kAnalyticsDataTemplateSearchTapped:"templateSearchTapped",kAnalyticsDataTemplateSearchBegan:"templateSearchBegan",kAnalyticsDataTemplateSearchQuerySubmitted:"templateSearchSubmitted",kAnalyticsDataTemplateSearchCancelled:"templateSearchCancelled",kAnalyticsDataSearchCategory:"searchCategory",kAnalyticsValueAllTemplatesCategory:"all-templates",kAnalyticsDataTemplatePreviewEntered:"organizer:preview:entered",kAnalyticsDataTemplateEditPressed:"organizer:preview:editPressed",kAnalyticsDataTemplateDuplicatePressed:"organizer:preview:duplicatedProjectPressed",kAnalyticsDataTemplateRenamePressed:"organizer:preview:renamePressed",kAnalyticsDataTemplateFeedViewed:"templateFeedViewed",kAnalyticsDataTemplatePressed:"templatePressed",kAnalyticsDataTemplateUpgradePressed:"template:upgradePressed",kAnalyticsDataPaidWelcomeViewed:"paidWelcomeViewed",kAnalyticsDataProjectExportCompleted:"project:exportCompleted",kAnalyticsDataProjectExportCompletedDNA:"project:exportCompletedDNA",kAnalyticsDataSparkFormat:"sparkFormat",kAnalyticsDataPreviewPosterMoreOptions:"organizer:preview:poster:moreOptionsPressed",kAnalyticsDataPreviewPosterMoreOptionsCopyLink:"organizer:preview:poster:moreOptions:copyLink",kAnalyticsDataPreviewPosterMoreOptionsUnpublish:"organizer:preview:poster:moreOptions:unpublish",kAnalyticsDataPreviewPosterMoreOptionsRename:"organizer:preview:poster:moreOptions:rename",kAnalyticsDataPreviewPosterMoreOptionsMoveProject:"organizer:preview:poster:moreOptions:moveProject",kAnalyticsDataPreviewPosterMoreOptionsCancel:"organizer:preview:poster:moreOptions:cancel",kAnalyticsDataPreviewPosterRenameConfirm:"organizer:preview:poster:moreOptions:rename:renameConfirm",kAnalyticsDataPreviewPosterRenameCancel:"organizer:preview:poster:moreOptions:rename:renameCancel",kAnalyticsDataTemplatePreviewed:"templatePreviewed",kAnalyticsDataPeekPost:"organizer:peek:post",kAnalyticsDataPopPost:"organizer:pop:post",kAnalyticsDataPeekTemplate:"organizer:peek:template",kAnalyticsDataPopTemplate:"organizer:pop:template",kAnalyticsDataPeekRemix:"organizer:peek:remix",kAnalyticsDataPopRemix:"organizer:pop:remix",kAnalyticsDataProjectEnterSelectionMode:"organizer:selectionMode:entered",kAnalyticsDataProjectCancelSelectionMode:"organizer:selectionMode:cancelled",kAnalyticsDataProjectSelected:"organizer:selectionMode:selectProject",kAnalyticsDataProjectDeselected:"organizer:selectionMode:deselectProject",kAnalyticsDataProjectsDeleted:"organizer:selectionMode:deleteProject",kAnalyticsDataProjectsMoved:"organizer:selectionMode:moveProjects",kAnalyticsDataProjectsWorkspaceSelection:"organizer:selectionMode:moveProjects:pickerSelected",kAnalyticsDataBrandkitPickerSelected:"organizer:brandkit:pickerSelected",kAnalyticsDataBrandkitPickerCancelled:"organizer:brandkit:pickerCancelled",kAnalyticsDataBrandkitSetActive:"organizer:brandkit:setActive",kAnalyticsDataBrandkitMoveProject:"organizer:brandkit:moveProject",kAnalyticsDataBrandkitElementUsed:"brandkit:elementUsed",kAnalyticsDataBrandkitCreatediOS:"brandkit:created:ios",kAnalyticsDataBrandkitCreatedAndroid:"brandkit:created:android",kAnalyticsDataDisplayMerchandising:"displayMerchandising",kAnalyticsDataDisplayPurchasePanel:"displayPurchasePanel",kAnalyticsDataDismissPurchasePanel:"dismissPurchasePanel",kAnalyticsDataPurchaseFlowPlanTypeSelected:"purchaseFlow:planTypeSelected",kAnalyticsDataPurchaseFlowCommitmentTypeSelected:"purchaseFlow:commitmentTypeSelected",kAnalyticsDataPurchaseFlowCheckoutButtonClicked:"purchaseFlow:checkoutButtonClicked",kAnalyticsDataPlanTabProperty:"planTab",kAnalyticsDataCommitmentTypeProperty:"commitmentType",kAnalyticsDataPlanTabMobile:"mobile",kAnalyticsDataPlanTabAllAccess:"all-access",kAnalyticsDataCommitmentTypeMonthly:"monthly",kAnalyticsDataCommitmentTypeAnnual:"annual",kAnalyticsDataDismissReasonSuccess:"success",kAnalyticsDataDismissReasonFailure:"failure",kAnalyticsDataDismissReasonCancel:"cancel",kAnalyticsDataMerchandisingSourceWatermark:"watermark",kAnalyticsDataMerchandisingSourceResize:"resize",kAnalyticsDataMerchandisingSourceLogo:"logo",kAnalyticsDataMerchandisingSourceAccount:"account",kAnalyticsDataMerchandisingSourceSettings:"settings",kAnalyticsDataMerchandisingSourceBrandify:"brandify",kAnalyticsDataMerchandisingSourceBrandedTemplate:"brandedTemplate",kAnalyticsDataMerchandisingSourceEditPost:"editPost",kAnalyticsDataMerchandisingSourceDesign:"enterDesign",kAnalyticsDataMerchandisingSourcePremiumTemplate:"premiumTemplate",kAnalyticsDataMerchandisingMessagingModalPremiumTemplate:"messagingModalPremiumTemplateUpgrade",kAnalyticsDataMerchandisingSourceFontPicker:"fontAdd",kAnalyticsDataMerchandisingSourceDeepLink:"deepLink",kAnalyticsDataMerchandisingSourceUseLibraryAssets:"messagingModalMerchLibraryUseAssets",kAnalyticsDataMerchandisingSourceAdobeStock:"messagingModalPremiumStockUpgrade",kAnalyticsDataMerchandisingSourceFontRecommendations:"fontRecommendations",kAnalyticsDataMerchandisingSourceEditCutout:"editCutout",kAnalyticsDataMerchandisingSourceHomeReturnAfterDay1:"homeReturnAfterDay1",kAnalyticsDataMerchandisingSourceDesignAssets:"messagingModalPremiumDesignAssetsUpgrade",kAnalyticsDataMerchandisingSourceBackgrounds:"messagingModalPremiumBackgroundUpgrade",kAnalyticsDataMerchandisingSourceFirstExport:"firstExport",kAnalyticsDataLivePhotoAdded:"editor:livePhotoAdded",kAnalyticsDataLivePhotoStillAdded:"editor:livePhotoStillAdded",kAnalyticsEventPushNotification:"pushNotifictionRegistrationStatus",kAnalyticsEventPushNotificationChanged:"pushNotifictionRegistrationStatusChanged",kAnalyticsDataImagePickerSelected:"imagePicker:pickerSelected",kAnalyticsDataImagePickerImageChanged:"imagePicker:imageChanged",kAnalyticsDataImagePickerCancelled:"imagePicker:pickerCancelled",kAnalyticsDataImagePickerSourceSelected:"imagePicker:sourceSelected",kAnalyticsDataImagePickerSourceCancelled:"imagePicker:sourceCancelled",kAnalyticsDataPeekImage:"imagePicker:peek:image",kAnalyticsDataPopImage:"imagePicker:pop:image",kAnalyticsDataDiagnosticsMessageEvent:"diagnostics:message",kAnalyticsDataExperimentAudienceDetermined:"experiments:audienceDetermined",kAnalyticsDataRemixInspirationUpdated:"organizer:remixInspirationUpdated",kAnalyticsSocialRemixTriggered:"socialRemix:triggered",kAnalyticsSocialRemixPresentedSignInToast:"socialRemix:presentedSignInToast",kAnalyticsSocialScreenUnwound:"socialRemix:screenUnwound",kAnalyticsTepidCreatorOpen:"pushNotification:tepidCreator:open",kAnalyticsTepidCreatorRegister:"pushNotification:tepidCreator:register",kAnalyticsTepidCreatorUnregister:"pushNotification:tepidCreator:unregister",kSettingsOptionSelectedPrefix:"settingOption:selected",kAnalyticsEventSearchAd:"searchAdAttribution",kAnalyticsEventUserNotFromSearchAd:"searchAdAttribution:userNotFromSearchAd",kAnalyticsEventDoclistStartup:"doclistStartup",kAnalyticsEventDocCompleteSync:"docSyncComplete",kAnalyticsEventDoclistPurge:"doclistPurge",kAnalyticsDataResizeStart:"resize:resizeBegin",kAnalyticsDataResizeCancel:"resize:resizeCancel",kAnalyticsDataResizeConfirm:"resize:resizeConfirmed",kAnalyticsDataResizeChange:"resize:changeSize",kAnalyticsEventUsedBrandkitPalette:"usedBrandKitPalette",kAnalyticsEventUsedBrandkitBGColor:"usedBrandKitBGColor",kAnalyticsEventUsedBrandkitFontColor:"usedBrandKitFontColor",kAnalyticsEventUsedBrandkitFont:"usedBrandKitFont",kAnalyticsEventUsedBrandkitLogo:"brandKitLogoApplied",kAnalyticsEventReplacedBrandkitLogo:"brand:logoReplaced",kAnalyticsLabelSource:"Source",kAnalyticsLabelReason:"reason",kAnalyticsAccessGranted:"accessGranted",kAnalyticsElementType:"elementType",kAnalyticsDataDocumentID:"document:id",kAnalyticsDataDocumentCommunityPlatformAssetID:"document:communityPlatformAssetID",kAnalyticsDataDeepLink:"deepLink",kAnalyticsDataDocumentCommunityPlatformDiscoverable:"document:communityPlatformDiscoverable",kAnalyticsDataAdobe360WorkflowInitiated:"adobe360Workflow:initiated",kAnalyticsDataAdobe360WorkflowCompleted:"adobe360Workflow:completed",kAnalyticsDataDocumentSourceID:"document:source:id",kAnalyticsDataDocumentSourceType:"document:source:type",kAnalyticsDataDocumentMetadata:"document:metadata",kAnalyticsDataDocumentMetadata2:"document:metadata2",kAnalyticsDataDocumentMetadata3:"document:metadata3",kAnalyticsDataDocumentMetadata4:"document:metadata4",kAnalyticsOnboardingScreenID:"onboarding:screenID",kAnalyticsOnboardingScreenViewDuration:"onboarding:screenViewDurationInSeconds",kAnalyticsDataSharesInCurrentVersion:"rate:sharesInCurrent",kAnalyticsDataSharesInAllVersions:"rate:sharesInAllVersions",kAnalyticsDataLoginFacebookIMSLoginMethod:"login:facebook:imsLoginMethod",kAnalyticsDataLoginFailedErrorCode:"login:failed:errorCode",kAnalyticsDataLoginFailedIMSErrorString:"login:failed:imsErrorString",kAnalyticsDataLoginFailedUnderlyingErrorDomain:"login:failed:underlyingErrorDomain",kAnalyticsDataLoginFailedUnderlyingErrorCode:"login:failed:underlyingErrorCode",kAnalyticsDataLoginFailedUnderlyingErrorUserInfo:"login:failed:underlyingErrorUserInfo",kAnalyticsDataLoginMarketingOptInValue:"login:facebook:marketingOptIn:optInValue",kAnalyticsDataAnimationExportType:"animation:animationExportType",kAnalyticsDataWheelDetent:"editor:wheelDetent",kAnalyticsDataNumLockups:"editor:numLockups",kAnalyticsDataSelectionCount:"editor:selection:count",kAnalyticsDataSelectionValue:"editor:selection:value",kAnalyticsDataCategory:"organizer:category:id",kAnalyticsDataPreviewIsForDirectRemix:"organizer:preview:isForDirectRemix",kAnalyticsDataDeviceToken:"devicetoken",kAnalyticsDataBundleIdentifier:"bundleIdentifier",kAnalyticsDataPushNotificationOpen:"pushNotification:open",kAnalyticsDataPushNotificationConfirm:"pushNotification:confirm",kAnalyticsDataPushNotificationCancel:"pushNotification:cancel",kAnalyticsDataPaletteID:"editor:palette:id",kAnalyticsDataFilterID:"editor:filter:id",kAnalyticsDataCutoutID:"editor:cutout:id",kAnalyticsDataThemeID:"editor:theme:id",kAnalyticsDataAnimationID:"editor:animation:id",kAnalyticsDataFontID:"editor:font:id",kAnalyticsDataBackingShapeID:"editor:backingShape:id",kAnalyticsDataTextLookID:"editor:textLook:id",kAnalyticsDataColorID:"editor:color:id",kAnalyticsDataLayoutID:"editor:layout:id",kAnalyticsDataLayoutSpacing:"editor:layout:spacing",kAnalyticsDataLayoutMargin:"editor:layout:margin",kAnalyticsDataTextLineHeight:"editor:text:lineHeight",kAnalyticsDataTextPadding:"editor:text:padding",kAnalyticsDataTextTracking:"editor:text:tracking",kAnalyticsDataTextShadowAngle:"editor:text:shadowAngle",kAnalyticsDataResizeSizeID:"resize:sizeID",kAnalyticsDataResizeInitialSize:"resize:initialSize",kAnalyticsDataDiagnosticsIssueId:"diagnostics:issueId",kAnalyticsDataDiagnosticsMessage:"diagnostics:message",kAnalyticsDataExperimentId:"experiments:audienceDetermined:experimentId",kAnalyticsDataExperimentAudienceId:"experiments:audienceDetermined:audienceId",kAnalyticsDataSocialRemixSource:"socialRemix:source",kAnalyticsDataSocialScreenID:"socialRemix:screenUnwound:screenId",kAnalyticsDataSearchAdIadAttribution:"searchAdAttribution:iadAttribution",kAnalyticsDataSearchAdClickDate:"searchAdAttribution:clickDate",kAnalyticsDataSearchAdKeyword:"searchAdAttribution:keyword",kAnalyticsDataSearchAdConversionDate:"searchAdAttribution:conversionDate",kAnalyticsDataSearchAdCampaignId:"searchAdAttribution:campaignId",kAnalyticsDataSearchAdCampaignName:"searchAdAttribution:campaignName",kAnalyticsDataSearchAdOrgName:"searchAdAttribution:orgName",kAnalyticsDataSearchAdCreativeId:"searchAdAttribution:creativeId",kAnalyticsDataSearchAdCreativeName:"searchAdAttribution:creativeName",kAnalyticsDataSearchAdLineItemId:"searchAdAttribution:lineItemId",kAnalyticsDataSearchAdLineItemName:"searchAdAttribution:lineItemName",kAnalyticsDataSearchAdGroupId:"searchAdAttribution:adGroupId",kAnalyticsDataSearchAdGroupName:"searchAdAttribution:adGroupName",kAnalyticsEventBranchIoReferredFromBranchLink:"branchIo:referredFromBranchLink",kAnalyticsDataBranchIoReferringLink:"branchIoReferringLink",kAnalyticsDataBranchIoMarketingTitle:"branchIoMarketingTitle",kAnalyticsDataBranchIoCampaign:"branchIoCampaign",kAnalyticsDataBranchIoChannel:"branchIoChannel",kAnalyticsDataBranchIoIsFirstSession:"branchIoIsFirstSession",kAnalyticsDataBranchIoRemixablePostCpid:"branchIoRemixablePostCpid",kAnalyticsDataBrandkitEnabled:"brandkit:enabled",kAnalyticsDataBrandkitId:"brandkit:id",kAnalyticsDataBrandkitCount:"brandkit:count",kAnalyticsDataBrandkitTemplateName:"brandkit:template:name",kAnalyticsDataBrandkitNewPost:"brandkit:newPost",kAnalyticsDataNewProject:"newProject",kAnalyticsDataRemixDesign:"Remix Design",kAnalyticsDataNotFound:"Not found",kAnalyticsDataTrue:"true",kAnalyticsDataFalse:"false",kAnalyticsDataFree:"free",kAnalyticsDataPaid:"paid",kAnalyticsEventAssertFailed:"assertFailed",kAnalyticsEventClickOccured:"multiselect:clickOccured",kAnalyticsEventCoeditingMobileBlockDialogViewed:"coediting:mobileBlockViewed",kAnalyticsEventCoeditingMobileBlockWebPageDialogViewed:"coediting:mobileDialogueViewed",kAnalyticsEventCoeditingProjectPreviewed:"coediting:projectPreviewed",kAnalyticsEventCollabLeavePressed:"collab:leavePressed",kAnalyticsEventCoeditingDeleteCollabErrorViewed:"coediting:deleteCollabErrorViewed",kAnalyticsEventCollabStockDuplicateBlocked:"collab:stockDuplicateBlocked",kDesignIngredientAdded:"designIngredient:added",kDesignIngredientBackingShapeChanged:"editor:textLockupShapeChanged",kDesignIngredientFontChanged:"editor:textLockupFontSelected",kDesignIngredientColorChanged:"editor:textLockupColorSelected",kAnalyticsLayoutCenterType:"center",kAnalyticsLayoutLeftType:"left",kAnalyticsLayoutRightType:"right",kAnalyticsLayoutMagicType:"magic",kAnalyticsLayoutCurvedType:"curvedText",kAnalyticsLayoutGridType:"gridText",kAnalyticsLayoutAutoType:"autoText",kAnalyticsLayoutCircleType:"circle",kAnalyticsLayoutSemiCircleType:"semiCircle",kAnalyticsLayoutInvertedSemiCircleType:"invertedSemiCircle",kAnalyticsLayoutLetterGridLeftType:"letterGridLeft",kAnalyticsLayoutLetterGridRightType:"letterGridRight",kAnalyticsLayoutLetterGridCenterType:"letterGridCenter",kAnalyticsLayoutAutoDropCapType:"autoDropCap",kAnalyticsLayoutAutoTripletType:"autoTriplet",kAnalyticsLayoutAutoRotateType:"autoRotate",kAnalyticsLayoutAutoRotateFitType:"autoRotateFit",kAnalyticsEventIconChosen:"iconChosen",kAnalyticsEventImageChosen:"imageChosen",kAnalyticsDataImageSourceType:"imageSource",kAnalyticsDataImageSourceTypeAdobeStock:"adobestock",kAnalyticsDataImageSourceTypeLightroom:"lightroom",kAnalyticsDataImageSourceTypeLibraries:"libraries",kAnalyticsDataImageSourceTypeCamera:"camera",kAnalyticsDataImageSourceTypeCameraRoll:"cameraRoll",kAnalyticsDataImageSourceTypeUpload:"upload",kAnalyticsDataImageSourceTypeDropbox:"dropbox",kAnalyticsDataImageSourceTypeGooglePhotos:"gphotos",kAnalyticsDataImageSourceTypeGoogleDrive:"gdrive",kAnalyticsDataImageSourceTypeAdobeStockFree:"stock:free",kAnalyticsDataImageSourceTypePixabay:"dooplo:pixabay",kAnalyticsDataImageSourceTypeNounProject:"dooplo:nounproject",kAnalyticsDataImageSourceTypeFiles:"fileBrowser",kAnalyticsDataImageSourceTypePatterns:"patterns",kAnalyticsDataImageSourceTypeSolidColor:"solidColor",kAnalyticsDataImageSourceTypePhotoLibrary:"photoLibrary",kAnalyticsDataImageSourceTypeVideos:"videos",kAnalyticsDataImageSourceTypeStockPhotos:"stockPhotos",kAnalyticsDataImageSourceTypeFiles2:"files",kAnalyticsEventCCLImageAssetsSourcePressed:"ccLibrarySourcePressed",kAnalyticsEventCCLImageAssetsPlaceImage:"imageChosen",kAnalyticsEventCCLImageAssetsPlaceImageSource:"imageSource",kAnalyticsEventBlendModePressed:"editor:blendModePressed",kAnalyticsEventBlendModeSelected:"editor:blendModeSelected",kAnalyticsEventPhotoAdded:"editor:photoAdded",kAnalyticsEventPhotoAddPressed:"editor:photoAddPressed",kAnalyticsEventDesignAssetsPressed:"editor:designAssetsPressed",kAnalyticsEventDesignAssetsAddPressed:"editor:designAssetAddPressed",kAnalyticsEventBackgroundsPressed:"editor:backgroundsPressed",kAnalyticsEventShapesPressed:"editor:iconsPressed",kAnalyticsEventBackgroundsAddPressed:"editor:backgroundAddPressed",kAnalyticsEventAssetAdded:"editor:assetAdded",kAnalyticsEventBackgroundAdded:"editor:backgroundAdded",kAnalyticsEventShapeAdded:"editor:iconAdded",kAnalyticsEventMorePressed:"editor:morePressed",kAnalyticsEventKeywordEntered:"search:keywordEntered",kAnalyticsEventFiltersPressed:"search:filtersPressed",kAnalyticsEventPhotosPressed:"editor:photosPressed",kAnalyticsDataAssetPath:"assetPath",kAnalyticsDataFilters:"filters",kAnalyticsDataSearchType:"searchType",kAnalyticsDataIsPremium:"isPremium",kAnalyticsDataKeyword:"keyword",kAnalyticsDataAssetId:"assetID",kAnalyticsDataParentPath:"parentPath",kAnalyticsDataImageLayer:"imageLayer",kAnalyticsDataImageFloating:"floating",kAnalyticsDataImageBackground:"background",kAnalyticsDataIsReplacing:"isReplacing",kAnalyticsDataType:"type",kAnalyticsDataLocation:"location",kAnalyticsDataResultsCount:"resultsCount",kAnalyticsDataSourceDesignAssets:"designAssets",kAnalyticsDataSourceBackgrounds:"backgrounds",kAnalyticsDataSourcePhotos:"photos",kAnalyticsDataSourceTemplates:"templates",kAnalyticsDataSourceProjects:"projects",kAnalyticsDataSource:"source",kAnalyticsDataEditor:"editor",kAnalyticsDataHome:"home",kAnalyticsDataTemplateSearch:"templateSearch",kAnalyticsDataTemplateLocation:"templateLocation",kAnalyticsDataCreateLocation:"createLocation",kAnalyticsDataHomeSelectTemplate:"homeSelectTemplate",kAnalyticsDataHomeTemplateSearch:"homeTemplateSearch",kAnalyticsDataHomeCreateFromScratchTaskModule:"homeCreateFromScratchTaskModule",kAnalyticsDataCollection:"collection",kAnalyticsDataSearchRecent:"recent",kAnalyticsDataSearchSuggested:"suggested",kAnalyticsDataSearchDirect:"direct",kAnalyticsDataNounProjectType:"icon",kAnalyticsDataBasicShapeType:"basicShape",kAnalyticsEditorIconColorSelected:"editor:icon:colorSelected",kAnalyticsColorPickerDisplayed:"colorPickerDisplayed",kAnalyticsEditorIconSelected:"editor:iconSelected",kAnalyticMethodCanvas:"canvas",kAnalyticsLayer:"layer",kAnalyticsMethod:"method",kAnalyticsAcceptMethod:"acceptMethod",kAnalyticsBasicShapeProperty:"basicShapeProperty",kAnalyticsBasicShapePropertyFill:"fill",kAnalyticsBasicShapePropertyBorder:"border",kAnalyticsMobileRebrandOnboardingCompleted:"mobileRebrandOnboardingCompleted",kAnalyticsDataImagesNumber:"numOfImages",kAnalyticsEventDesignFilterSelected:"editor:designFilterSelected",kAnalyticsGenericNone:"none",kAnalyticsEventHomePageViewed:"homePageViewed",kAnalyticsEventTemplatesUseCaseClicked:"project:useCaseClicked",kAnalyticsEventTemplatesMorePressed:"morePressed",kAnalyticsEventMenuPlusPressed:"menuPlusPressed",kAnalyticsMenuPlusMorePressed:"menuPlusMorePressed",kAnalyticsMenuQuickActionMorePressed:"quickAction:morePressed",kAnalyticsMenuQuickActionClicked:"quickAction:ctaPressed",kAnalyticsMenuQuickAction:"menuQuickAction",kAnalyticsEventMenuQuickActionPressed:"menuQuickActionPressed",kAnalyticsMenuQuickActionMore:"moreQuickAction",kAnalyticsMenuMore:"more",kAnalyticsMenuRemoveBackground:"removeBackground",kAnalyticsMenuImageResize:"imageResize",kAnalyticsMenuLogoMaker:"Logo",kAnalyticsMenuConvertToGIF:"convertToGIF",kAnalyticsMenuComingSoon:"comingSoon",kAnalyticsMenuMenuPlus:"menuPlus",kAnalyticsMenuQuickActionType:"quickActionType",kAnalyticsMenuActionLocation:"actionLocation",kAnalyticsMenuClickLocation:"clickLocation",kAnalyticsMenuUseCaseTrigger:"useCaseTrigger",kAnalyticsMenuUseCaseLabel:"useCaseLabel",kAnalyticsMenuResizeVideo:"resizeVideo",kAnalyticsMenuTrimVideo:"trimVideo",kAnalyticsMenuMergeVideo:"mergeVideo",kAnalyticQuickActionAssetUploaded:"quickAction:assetUploaded",kAnalyticQuickActionEditorDisplayed:"project:editorDisplayed",kAnalyticQuickActionUploadCompleted:"quickAction:uploadCompleted",kAnalyticQuickActionError:"quickAction:error",kAnalyticQuickActionStartEndFrameSelected:"quickAction:startEndFrameSelected",kAnalyticQuickActionZoomChanged:"quickAction:zoomChanged",kAnalyticQuickActionDragPan:"quickAction:draggedToPan",kAnalyticQuickActionSizeSelected:"quickAction:sizeSelected",kAnalyticQuickActionDownloadPressed:"quickAction:downloadPressed",kAnalyticQuickActionAssetUploadCanceled:"quickAction:assetUploadCanceled",kAnalyticQuickActionSizeDropdownPressed:"quickAction:sizeDropdownPressed",kAnalyticQuickActionTrimPressed:"quickAction:trimPressed",kAnalyticQuickActionAudioMuted:"quickAction:audioMuted",kAnalyticQuickActionFillScreenPressed:"quickAction:fillScreenPressed",kAnalyticQuickActionDeleteAssetPressed:"quickAction:deleteAssetPressed",kAnalyticQuickActionVideoOrderChanged:"quickAction:videoOrderChanged",kAnalyticQuickActionCancelProcessingPressed:"quickAction:cancelProcessingPressed",kAnalyticQuickActionExportCompleted:"project:exportCompleted",kAnalyticsKeepEditingBtnPressed:"project:keepEditingPressed",kAnalyticsErrorWithQuickAction:"project:errorMessageViewed",kAnalyticQuickActionResizeVideo:"resizeVideo",kAnalyticQuickActionTrimVideo:"trimVideo",kAnalyticQuickActionMergeVideo:"mergeVideo",kAnalyticQuickActionMethod:"method",kAnalyticQuickActionMethodTrimHandles:"trimHandles",kAnalyticQuickActionMethodUploadPressed:"uploadPressed",kAnalyticQuickActionFileFormat:"fileFormat",kAnalyticQuickActionCodec:"codec",kAnalyticQuickActionFileSize:"fileSize",kAnalyticQuickActionFileResolution:"fileResolution",kAnalyticQuickActionVideoDuration:"videoDuration",kAnalyticQuickActionMimeType:"mimeType",kAnalyticQuickActionAudioCodec:"audioCodec",kAnalyticQuickActionLocation:"actionLocation",kAnalyticQuickActionCausalAction:"causalAction",kAnalyticQuickActionErrorMessage:"errorMessage",kAnalyticQuickActionInternalSystemError:"internalSystemError",kAnalyticQuickActionFailedAtStage:"failedAtStage",kAnalyticQuickActionSizeCategory:"sizeCategory",kAnalyticQuickActionSize:"size",kAnalyticQuickActionIsReExport:"isReExport",kAnalyticQuickActionUserInterruptedUpload:"userInterruptedUpload",kAnalyticQuickActionActionBar:"actionBar",kAnalyticsDataContentCalId:"contentCalID",kAnalyticsDataChannelsSelected:"channelsSelected",kAnalyticsValueInstagram:"instagram",kAnalyticsDataMediaAdded:"mediaAdded",kAnalyticsDataAppPublishedTo:"appPublishedTo",kAnalyticsDataPublishStatus:"publishStatus",kAnalyticsValuePublishStatusActive:"active",kAnalyticsValuePublishStatusComplete:"complete",kAnalyticsValuePublishStatusOverdue:"overdue",kAnalyticsValuePublishStatusCancelled:"cancelled",kAnalyticsCCalPushNotificationPressed:"postReminderNotificationPressed",kAnalyticsCCalViewAllRemindersPressed:"contentCal:viewAllRemindersPressed",kAnalyticsCCalPublishPostCTAPressedFromReminders:"contentCal:publishPostCTAPressedFromReminders",kAnalyticsCCalPublishPostPressed:"contentCal:publishPostPressed",kAnalyticsCCalPublishConfirmationViewed:"contentCal:publishConfirmationViewed",kAnalyticsCCalPublishInitiated:"contentCal:publishInitiated",kAnalyticsCCalPublishConfirmModalDontAskAgain:"contentCal:publishConfirmModalDontAskAgain",kAnalyticsCCalPublishModalDismissed:"contentCal:publishConfirmModalDismissed",kAnalyticsCCalPostPublished:"contentCal:postPublished",kAnalyticsCCalPostNotificationDisabled:"contentCal:postNotificationDisabled",kAnalyticsCCalReminderPressed:"contentCal:reminderPressed",kAnalyticsEventAccountDeletionStart:"accountDeletePressed",kAnalyticsEventAccountDeletionSucess:"accountDeleted",kAnalyticsEventAccountDeletionCancel:"accountDeleteDismissed",kAnalyticsEventAccountDeletionError:"accountDeleteError",kAnalyticsSegmentationEventModalViewed:"personalization:modalViewed",kAnalyticsSegmentationDataModalNameSelectExperiencePurpose:"modalName:selectExperiencePurpose",kAnalyticsSegmentationEventContinuePressed:"personalization:continuePressed",kAnalyticsSegmentationEventModalDismissed:"personalization:modalDismissed",kAnalyticsSegmentationDataCardsSelected:"cardsSelected",kAnalyticsSegmentationDataPrevCardsSelected:"prevCardsSelected",kAnalyticsSegmentationDataSmallBiz:"promoteYourSmallBusinessOrSideProject",kAnalyticsSegmentationDataMarketingLargeCompany:"marketingForALargeCompany",kAnalyticsSegmentationDataWorkPresentations:"presentationsForWork",kAnalyticsSegmentationDataPersonal:"personalProjects",kAnalyticsSegmentationDataSchool:"schoolProjects",kAnalyticsSegmentationDataSocial:"growAndMonetizeYourSocialFollowing",kAnalyticsSegmentationDataPersonalizationSkill:"personalizationSkill",kAnalyticsSegmentationDataPrevPersonalizationSkill:"prevPersonalizationSkill",kAnalyticsSegmentationDataNone:"none",kAnalyticsSegmentationDataSome:"some",kAnalyticsSegmentationDataALot:"aLot",kAnalyticsSegmentationDatacreativePro:"creativePro",kAnalyticsSegmentationEventUserPreferencesPressed:"userPreferencesPressed",kAnalyticsEventAllPagesPressed:"editor:viewAllPagesPressed",kAnalyticsEventAddPagePressed:"editor:addPagePressed",kAnalyticsEventDeletePagePressed:"editor:deletePagePressed",kAnalyticsEventDuplicatePagePressed:"editor:duplicatePagePressed",kAnalyticsEventResizeApplied:"editor:resizeApplied",kAnalyticsEventColorThemeSelected:"editor:colorThemeSelected",kAnalyticsEventBrandifyPressed:"editor:brandifyPressed",kAnalyticsEventAllPageModeExited:"editor:viewAllPagesModeExited",kAnalyticsDataPageActionLocationEditor:"singlePageMode",kAnalyticsDataPageActionLocationAllPagesMode:"allPagesMode",kAnalyticsDataPageActionMethodButton:"button",kAnalyticsDataPageActionMethodKeyboard:"keyboardShortcut",kAnalyticsDataPageSizeSameAsSelected:"sameAsSelected",kAnalyticsDataPrefixPageActionLocation:"location",kAnalyticsDataPrefixPageActionMethod:"method",kAnalyticsDataPrefixPageSizeId:"sizeSelected",kAnalyticsDataPrefixPageSize:"pageSize",kAnalyticsDataPrefixNumPagesResized:"numPagesResized",kAnalyticsDataPrefixResizedTo:"resizedTo",kAnalyticsDataPrefixNumPagesChanged:"numPagesChanged",kAnalyticsDataPrefixNumPagesBrandified:"numPagesBrandified",kAnalyticsDataPrefixNumPagesExported:"numPagesExported",kAnalyticsDataPrefixNumPagesInProject:"numPagesInProject",kAnalyticsAllPagesExitedPagesRearranged:"pagesRearranged",kAnalyticsAllPagesExitedPagesSelected:"pagesSelected",kAnalyticsAllPagesExitedPagesSelectedThumbnail:"thumbnail",kAnalyticsAllPagesExitedPagesTopNav:"topNav",kAnalyticsAllPagesExitedPagesBottomNav:"bottomNav",kAnalyticsAllPagesExitedPagesDoubleClick:"doubleClick",kAnalyticsSegmentationCategoryName:"categoryName",kAnalyticsSegmentationForYouCollection:"forYouCollection",kAnalyticsTemplateSpecialCollection:"templateSpecialCollection",kAnalyticsSegmentationRecommended:"recommended",kAnalyticsSegmentationChangeInterestsPressed:"changeInterestsPressed",kAnalyticsSegmentationForYouTemplatesHomeViewed:"forYouTemplatesHomeViewed",kAnalyticsEventPaste:"editor:pasteObjectPressed",kAnalyticDataPasteSource:"source",kAnalyticDataPasteObjectType:"objectType",kAnalyticDataPasteStatus:"status",kAnalyticsEventKillScreenDisplayed:"killScreenDisplayed",kAnalyticsEventKillScreenUpdatePressed:"killScreen:updateAppPressed",kAnalyticsEventSpeedDialCameraPressed:"cameraPressed",kAnalyticsEventSpeedDialGalleryPressed:"galleryPressed",kAnalyticsEventSpeedDialSolidColorPressed:"solidColorPressed",kAnalyticsEventSpeedDialMoreImagesPressed:"moreImagesPressed",kAnalyticsEventStockPhotosPressed:"stockPressed",kAnalyticsEventSpeedDialBackgroundsPressed:"backgroundsPressed",kAnalyticsEventStorageAlmostFullToastShown:"storage:storageAlmostFullToastShown",kAnalyticsEventStorageUpgradeStorageFull:"storageFull",kAnalyticsEventStorageLearnMorePressed:"storage:learnMoreClicked",kAnalyticsEventStorageFullModalDisplayed:"storage:storageFullModalDisplayed",kAnalyticsEventStorageManageProjectsPressed:"storage:manageProjectsClicked",kAnalyticsEventStorageDocMgmtToastShown:"storage:docMgmtToastShown"}}),r)},"13MC":function(e,t,n){var r,o,a,i,s,l,u,c,d=t,h=n("oAGj"),p=n("N5RB"),f=n("fVJ2"),m=n("dJuF"),g=n("SmK9"),y=n("fNpk");d.IDBObjectState=h.defineProtocol("IDBObjectState",{id:"String",className:"String",properties:"Dictionary<String>",allProperties:"Dictionary<String>",object:"IDBObject",checkpoint:"() -> IDBObjectState",getProperty:"(String) -> DBProperty",needsApplyHint:"() -> Boolean",apply:"(Array<IDBObjectState>) -> Void",diff:"(IDBObjectState) -> Dictionary<String>",depth:"Integer",forEachProperty:"(Boolean, (String, DBProperty) -> Void) -> Void"}),d.IDBObjectAncestorState=h.defineProtocol("IDBObjectAncestorState",{isAncestorOf:"(IDBObjectDerivedState) -> Boolean"}),d.IDBObjectDerivedState=h.defineProtocol("IDBObjectDerivedState",{basedOn:"IDBObjectAncestorState"}),d.IDBObjectMutableState=h.defineProtocol("IDBObjectMutableState",{setProperty:"(String, DBProperty) -> Void",updateProperty:"(String, Any, DBPropertyCodec) -> Boolean",removeProperty:"(String) -> Void",clear:"() -> Void",assign:"(IDBObject) -> IDBObjectState",commit:"() -> IDBObjectState"}),d.IDBObjectMutableAncestorState=h.defineProtocol("IDBObjectMutableAncestorState",{flattenFrom:"(IDBObjectDerivedState) -> Void"}),d.IDBObjectMutableDerivedState=h.defineProtocol("IDBObjectMutableDerivedState",{}),d.IDBState=h.defineProtocol("IDBState",{guid:"String",branch:"String",basedOn:"IDBState",database:"IDatabase",objectStates:"Dictionary<String>",allObjectStates:"Dictionary<String>",transaction:"ITransaction",mutableState:"IDBMutableState",beginTransaction:"(String) -> ITransaction",getDerivedState:"(String) -> IDBState",apply:"() -> Void",getObjectStateByID:"(String) -> IDBObjectState",getObjectState:"(DBObject) -> IDBObjectState",forEachObjectState:"(Boolean, (String, IDBObjectState) -> Void) -> Void",validate:"() -> IDBValidationResult",encode:"(IExportDataObject, Integer) -> Void"}),d.IDBMutableState=h.defineProtocol("IDBMutableState",{parentTransaction:"ITransaction",makeObjectMutable:"(DBObject) -> Void",newObjectState:"(DBObject) -> IDBObjectMutableState",setObjectState:"(DBObject, IDBObjectState) -> Void",addNewObject:"(DBObject, IDBObjectState) -> Void",removeObject:"(String) -> Void",commit:"() -> IDBState",abandon:"() -> Void",flattenFrom:"(IDBState) -> Void"}),d.DBObjectBaseState=(r=function(){},h.defineClass({name:"DBObjectBaseState",ctor:r,props:{basedOn:{get:function(){return null}},isAncestorOf:function(e){for(var t=e.basedOn;null!=t;){if(t===this)return!0;t=h.opt(h.as(t,d.IDBObjectDerivedState),(function(e){return e.basedOn}))}return!1},properties:{get:function(){return{}}},id:{get:function(){return h.opt(this.properties.id,(function(e){return e.stringValue}))}},depth:{get:function(){return 0}},allProperties:{get:function(){var e=h.clone(this.properties);if(null!=this.basedOn)for(var t=h.iter(h.opt(this.basedOn,(function(e){return e.allProperties})));!t.done;t.next()){var n=t.key,r=t.value;null==e[n]&&(e[n]=r)}for(var o=h.keys(e).filter((function(t){return e[t]instanceof m.DBDeletedProperty}),this),a=h.iter(o);!a.done;a.next()){var i=a.value;h.removeKey(e,i)}return e}},getProperty:function(e){return this.properties[e]||h.opt(this.basedOn,(function(t){return t.getProperty(e)}))},diff:function(e){var t=this,n={};if(e!==this)if(null!=this.basedOn&&h.as(e,d.IDBObjectAncestorState)===this.basedOn)this.forEachProperty(!1,(function(t,r){var o;(o=e.getProperty(t))?o.isEqual(r)||(n[t]=[r,o]):n[t]=[r,null]}));else if(h.opt(h.as(e,d.IDBObjectDerivedState),(function(e){return e.basedOn===t})))e.forEachProperty(!1,(function(e,r){var o;(o=t.getProperty(e))?o.isEqual(r)||(n[e]=[o,r]):n[e]=[null,r]}));else{var r=h.clone(this.allProperties);e.forEachProperty(!0,(function(e,t){var o;(o=h.removeKey(r,e))?o.isEqual(t)||(n[e]=[o,t]):n[e]=[null,t]})),h.each(r,(function(e,t){n[e]=[t,null]}))}return n},forEachProperty:function(e,t){var n,r={};h.each(this.properties,(function(e,n){t(e,n),r[e]=!0})),e&&(n=this.basedOn)&&n.forEachProperty(!0,(function(e,n){null==r[e]&&(t(e,n),r[e]=!0)}))},notifyParentChange:function(e,t,n){if(null!=t&&0==!t.length)for(var r=h.iter(t);!r.done;r.next()){var o,a=r.value;if(o=h.as(a,d.DBChildObjectState)){for(var i=o.propertyPath,s=h.as(h.opt(o.parentObject,(function(e){return e.state})),d.DBChildObjectState);null!=s;)i=s.propertyPath.appendPath(i),s=h.as(h.opt(h.opt(s,(function(e){return e.parentObject})),(function(e){return e.state})),d.DBChildObjectState);n(o,o.deltaForPropertyPath(e,i))}}},notifyParentWillChange:function(e,t){this.notifyParentChange(e,t,(function(e,t){return e.parentWillChangeState(t)}))},notifyParentDidChange:function(e,t){this.notifyParentChange(e,t,(function(e,t){return e.parentDidChangeState(t)}))}}}),r),d.DBObjectDeletedState=(o=function(e){this.obj_=e},h.defineClass({name:"DBObjectDeletedState",ctor:o,statics:{_implements:function(e){return"IDBObjectState"==e}},props:{id:{get:function(){return null}},className:{get:function(){return""}},properties:{get:function(){return{}}},allProperties:{get:function(){return{}}},object:{get:function(){return this.obj_}},checkpoint:function(){return new o(this.object)},depth:{get:function(){return 0}},getProperty:function(e){return null},needsApplyHint:function(){return!1},apply:function(e){},diff:function(e){var t={};if(e!==this)for(var n=h.clone(e.allProperties),r=h.iter(h.keys(n));!r.done;r.next()){var o=r.value;t[o]=[null,n[o]]}return t},forEachProperty:function(e,t){}}}),o),d.DBObjectState=(a=function(){},h.defineClass({name:"DBObjectState",ctor:a,superName:"DBObjectBaseState",statics:{_implements:function(e){return"IDBObjectDerivedState"==e||"IDBObjectState"==e||"IDBObjectAncestorState"==e}},props:{init_be8f:function(e){this.basedOn_=null,this.properties_={},this.obj_=e,this.className_=e.className,d.DBObjectBaseState.call(this)},init_2a9a:function(e,t){this.basedOn_=null,this.properties_=h.clone(t),this.obj_=e,this.className_=e.className,d.DBObjectBaseState.call(this)},init_9f95:function(e,t){this.basedOn_=e,this.properties_=h.clone(t),this.obj_=e.obj_,this.className_=e.className_,y.LegacyCoreAssert.isTrue(null!=this.obj_,"Created a new state on an object that has been destroyed.",void 0,"DBObjectState.init","DBState.swift",454),d.DBObjectBaseState.call(this)},basedOn:{get:function(){return this.basedOn_}},className:{get:function(){return this.className_}},properties:{get:function(){return this.properties_}},getProperty:function(e){return this.properties_[e]||h.opt(this.basedOn_,(function(t){return t.getProperty(e)}))},object:{get:function(){return this.obj_}},checkpoint:function(){return a.init_2a9a(this.object,this.allProperties)},needsApplyHint:function(){return this.obj_.state!==this},apply:function(e){if(this.obj_.state!==this){var t=h.clone(this.diff(this.obj_.state));h.count(t)>0&&this.notifyParentWillChange(t,e),this.obj_.state=this,h.count(t)>0&&this.notifyParentDidChange(t,e)}}}}),a),d.DBObjectMutableState=(i=function(){this.mutableProperties_={}},h.defineClass({name:"DBObjectMutableState",ctor:i,superName:"DBObjectBaseState",statics:{_implements:function(e){return"IDBObjectDerivedState"==e||"IDBObjectState"==e||"IDBObjectMutableAncestorState"==e||"IDBObjectAncestorState"==e||"IDBObjectMutableState"==e||"IDBObjectMutableDerivedState"==e}},props:{init_6f66:function(e){this.className_=e,d.DBObjectBaseState.call(this)},init_226b:function(e){this.obj_=e.object,this.basedOn_=e,this.className_=e.className,d.DBObjectBaseState.call(this)},init_be8f:function(e){this.obj_=e,this.className_=e.className,d.DBObjectBaseState.call(this)},init_6271:function(e,t){this.mutableProperties_=h.clone(t),this.className_=e,d.DBObjectBaseState.call(this)},init_2a9a:function(e,t){this.obj_=e,this.mutableProperties_=h.clone(t),this.className_=e.className,d.DBObjectBaseState.call(this)},init_9f95:function(e,t){this.obj_=e.object,this.basedOn_=e,this.mutableProperties_=h.clone(t),this.className_=e.className,d.DBObjectBaseState.call(this)},basedOn:{get:function(){return this.basedOn_}},className:{get:function(){return this.className_}},properties:{get:function(){return this.mutableProperties_}},getProperty:function(e){return this.mutableProperties_[e]||h.opt(this.basedOn_,(function(t){return t.getProperty(e)}))},object:{get:function(){var e=null!=this.obj_?this.obj_:h.opt(this.basedOn,(function(e){return e.object}));return y.LegacyCoreAssert.isTrue(null!=e,"Mutable state not yet committed to an object",void 0,"DBObjectMutableState","DBState.swift",560),e}},checkpoint:function(){return i.init_2a9a(this.object,this.allProperties)},setProperty:function(e,t){y.LegacyCoreAssert.isTrue(e==t.name,"Setting property but value name does not match field name",{valueName:t.name,name:e},"DBObjectMutableState.setProperty","DBState.swift",569),this.mutableProperties_[e]=t},updateProperty:function(e,t,n){var r,o;if((r=this.mutableProperties_[e])&&null!=(o=n.update)&&!(r instanceof m.DBDeletedProperty)){var a=o(r,t);return a!==r&&this.setProperty(e,a),!0}return!1},removeProperty:function(e){this.mutableProperties_[e]=m.DBProperty.deleted(m.DBNamePath.init_b14a(e))},clear:function(){for(var e=h.iter(h.keys(this.allProperties));!e.done;e.next()){var t=e.value;this.removeProperty(t)}},needsApplyHint:function(){return null!=this.obj_||h.opt(this.basedOn,(function(e){return null!=e.object}))},apply:function(e){var t;if(t=null!=this.obj_?this.obj_:h.opt(this.basedOn,(function(e){return e.object}))){var n=h.clone(this.diff(t.state));this.notifyParentWillChange(n,e),t.state=this,this.notifyParentDidChange(n,e)}},assign:function(e){var t=null;this.basedOn_ instanceof d.DBObjectState?t=this.basedOn_:this.basedOn_ instanceof i&&(t=this.basedOn_.assign(e));var n=h.as(e,f.DBObject);h.opt(n,(function(e){return e.willCommitState()}));var r=null!=t?d.DBObjectState.init_9f95(t,this.mutableProperties_):d.DBObjectState.init_2a9a(e,this.mutableProperties_);return e.state=r,this.obj_=e,h.opt(n,(function(e){return e.didCommitState()})),r},commit:function(){return this.assign(this.object)},flattenFrom:function(e){for(var t=[],n=e;n!==this&&null!=n;)t.splice(0,0,n),n=h.as(n.basedOn,d.IDBObjectDerivedState);for(var r=h.iter(t);!r.done;r.next())for(var o=r.value,a=h.clone(this.diff(o)),i=h.iter(a);!i.done;i.next()){var s=i.key,l=i.value;null!=l[1]?this.mutableProperties_[s]=l[1]:h.removeKey(this.mutableProperties_,s)}}}}),i),d.DBChildObjectState=(s=function(){},h.defineClass({name:"DBChildObjectState",ctor:s,statics:{_implements:function(e){return"IDBObjectState"==e||"IDBObjectMutableState"==e}},props:{pendingProperties:{get:function(){return this.pendingProperties_}},init_7008:function(e,t,n){this.obj_=e,this.parentObject_=t,this.propertyPath_=n},init_94ed:function(e,t){this.obj_=null,this.parentObject_=e,this.propertyPath_=t},id:{get:function(){return h.opt(this.properties.id,(function(e){return e.stringValue}))}},className:{get:function(){return this.obj_.className}},parentObject:{get:function(){return this.parentObject_}},propertyPath:{get:function(){return this.propertyPath_}},parentProperty:{get:function(){var e,t=null;return(e=h.opt(this.parentObject_,(function(e){return e.state})))&&this.propertyPath_.forEach((function(n){var r,o;null==t?t=e.getProperty(n.name):null!=(r=h.toInt(n.name))&&(o=h.opt(t,(function(e){return e.arrayValue})))?r<o.length&&(t=o[r]):null!=t&&t.isDictionary&&(t=t.getDictionaryProperty(n.name))})),t}},properties:{get:function(){return null!=this.pendingProperties_?this.pendingProperties_:h.opt(this.parentProperty,(function(e){return e.dictionaryValue}))||{}}},depth:{get:function(){var e;return((e=h.opt(h.as(h.opt(this.parentObject_,(function(e){return e.state})),d.IDBObjectMutableState),(function(e){return e.depth})))||null!=e?e:0)+1}},allProperties:{get:function(){return this.properties}},object:{get:function(){return this.obj_},set:function(e){this.obj_!==e&&(y.LegacyCoreAssert.isTrue(null==this.obj_,"This state already has an object assigned",void 0,"DBChildObjectState","DBState.swift",735),this.obj_=e)}},checkpoint:function(){return this},getProperty:function(e){return null!=this.pendingProperties_?this.pendingProperties_[e]:h.opt(this.parentProperty,(function(t){return t.getDictionaryProperty(e)}))},deltaFromParentDelta:function(e){return this.deltaForPropertyPath(e,this.propertyPath)},parentWillChangeState:function(e){var t;(t=h.as(this.obj_,f.DBObject))&&h.count(e)>0&&t.willChangeState(e)},parentDidChangeState:function(e){var t;(t=h.as(this.obj_,f.DBObject))&&h.count(e)>0&&(t.clearCache(),t.didChangeState(e))},savePropertyDict:function(e){var t,n;if((t=h.as(this.parentObject_,f.DBObject))&&(n=h.as(this.object,f.DBObject))){if(null==t.childObjects.find((function(e){return e.id==n.id}),this))return;for(var r=h.clone(g.DBSchema.getCodecChain(this.propertyPath_.path,this.parentObject_)),o=this.propertyPath_,a=h.last(r)[0].encode(o,this.obj_,null);0==!r.length;){r.pop();var i=o.name;if(o=o.parent,0==r.length)t.setProperty(i,a);else{var s,l,u=null;if(null!=(s=h.last(r))&&(u=s[1]),u instanceof m.DBDeletedProperty)a=u;else if(null!=(l=h.toInt(i))){for(var c=h.clone(u.arrayValue);l>=c.length;)c.push(m.DBProperty.deleted(o.append(h.toString(c.length))));c[l]=a,a=m.DBProperty.arrayProperty(o,c)}else{var d=h.clone(u.dictionaryValue);d[i]=a,a=m.DBProperty.dictProperty(o,d)}}}}},savePendingProperties:function(){null!=this.pendingProperties_&&(this.savePropertyDict(this.pendingProperties_),this.pendingProperties_=null)},abandonPendingProperties:function(){this.pendingProperties_=null},setProperty:function(e,t){if(null==this.pendingProperties_){for(var n={},r=h.iter(this.properties);!r.done;r.next()){var o=r.key,a=r.value;o!=e&&(n[o]=a.copy())}this.pendingProperties_=h.clone(n)}t.reroot(m.DBNamePath.init_b14a(e)),this.pendingProperties_[e]=t,this.savePropertyDict(this.pendingProperties_)},canUpdate:{get:function(){var e;return(e=h.opt(h.as(h.opt(this.parentObject_,(function(e){return e.state})),s),(function(e){return e.canUpdate})))||null!=e?e:h.is(h.opt(this.parentObject_,(function(e){return e.state})),d.IDBObjectMutableState)}},updateProperty:function(e,t,n){var r,o;if(null!=this.pendingProperties_&&(r=this.properties[e])&&null!=(o=n.update)&&!(r instanceof m.DBDeletedProperty)&&this.canUpdate){var a=o(r,t);return a!==r&&this.setProperty(e,a),!0}return!1},removeProperty:function(e){this.setProperty(e,new m.DBDeletedProperty(m.DBNamePath.init_b14a(e)))},setProperties:function(e){if(null==this.pendingProperties_){for(var t={},n=h.iter(this.properties);!n.done;n.next()){var r=n.key,o=n.value;null==e[r]&&(t[r]=o.copy())}for(var a=h.iter(e);!a.done;a.next())r=a.key,(o=a.value).reroot(m.DBNamePath.init_b14a(r)),t[r]=o;this.pendingProperties_=h.clone(t),this.savePropertyDict(this.pendingProperties_)}},clear:function(){if(null==this.pendingProperties_){for(var e=h.clone(this.properties),t=h.iter(h.keys(this.properties));!t.done;t.next()){var n=t.value;e[n]=new m.DBDeletedProperty(m.DBNamePath.init_b14a(n))}this.pendingProperties_=h.clone(e),this.savePropertyDict(this.pendingProperties_)}},deltaForPropertyPath:function(e,t){var n,r,o,a={},i=h.clone(t.path);if(null!=(o=e[i.shift()])){for(var s=o[0],l=o[1];0==!i.length&&(null!=s||null!=l);){var u,c=i.shift();if(null!=(u=h.toInt(c))){var d=(n=h.opt(h.opt(s,(function(e){return e.arrayValue})),(function(e){return e.length})))||null!=n?n:0,p=(r=h.opt(h.opt(l,(function(e){return e.arrayValue})),(function(e){return e.length})))||null!=r?r:0;s=u<d?h.opt(h.opt(s,(function(e){return e.arrayValue})),(function(e){return e[u]})):null,l=u<p?h.opt(h.opt(l,(function(e){return e.arrayValue})),(function(e){return e[u]})):null}else s=h.opt(s,(function(e){return e.getDictionaryProperty(c)})),l=h.opt(l,(function(e){return e.getDictionaryProperty(c)}))}null!=s&&s.isDictionary?(s.forEachDictionaryProperty((function(e,t){a[e]=[t,h.opt(l,(function(t){return t.getDictionaryProperty(e)}))]})),null!=l&&l.isDictionary&&l.forEachDictionaryProperty((function(e,t){h.keys(a).includes(e)||(a[e]=[null,t])}))):null!=l&&l.isDictionary&&l.forEachDictionaryProperty((function(e,t){a[e]=[null,t]}))}return a},diff:function(e){var t={};if(e!==this){for(var n=h.clone(this.properties),r=h.clone(e.properties),o=h.iter(h.keys(n));!o.done;o.next()){var a,i=n[c=o.value];(a=e.getProperty(c))?i.isEqual(a)||(t[c]=[i,e.getProperty(c)]):t[c]=[i,null]}for(var s=h.keys(r),l=h.keys(n),u=h.iter(s);!u.done;u.next()){var c=u.value;l.includes(c)||(t[c]=[null,r[c]])}}return t},forEachProperty:function(e,t){h.each(this.properties,(function(e,n){return t(e,n)}))},needsApplyHint:function(){return h.opt(this.parentObject_,(function(e){return 1==e.state.needsApplyHint()}))},apply:function(e){h.opt(this.parentObject_,(function(e){return e.state.apply(null)}))},assign:function(e){return s.init_7008(e,this.parentObject_,this.propertyPath_)},commit:function(){return this}}}),s),d.DBStateTransaction=(l=function e(t,n,r,o){var a;this.finished_=!1,void 0===o&&(o=null);var i,s=r.database.newState((a=o)||null!=a?a:p.PostDB.undoBranchID,r);this.basedOnState_=r,this.name=n,this.parent=t,this.state=s.state,(i=h.as(t,e))&&(y.LegacyCoreAssert.isTrue(null==i.child_,"DBStateTransaction already has a child",{parentStateTransactionName:i.name},"DBStateTransaction.init","DBState.swift",1027),i.child_=this),null!=r.transaction_&&y.LegacyCoreAssert.fail("State already has a transaction",{basedOnStateTransactionName:r.transaction_.name,creating:n},"DBStateTransaction.init","DBState.swift",1033)},h.defineClass({name:"DBStateTransaction",ctor:l,statics:{_implements:function(e){return"ITransaction"==e}},props:{child:{get:function(){return this.child_}},depth:{get:function(){return null==this.parent?1:this.parent.depth+1}},description:{get:function(){return null==this.parent?this.name:this.parent.description+", "+this.name}},finish:function(){var e;this.basedOnState_.database.endTransaction(this),this.basedOnState_.endTransaction(this),(e=h.as(this.parent,l))&&(y.LegacyCoreAssert.isTrue(e.child_===this,"Parent transaction mismatch",void 0,"DBStateTransaction.finish","DBState.swift",1051),e.child_=null),this.finished_=!0},end:function(){y.LegacyCoreAssert.isFalse(this.finished_,"Transaction already finished",{name:this.name},"DBStateTransaction.end","DBState.swift",1058),this.basedOnState_.database.commitState(this.state),this.finish()},mergeWithPrevious:function(){y.LegacyCoreAssert.isFalse(this.finished_,"Transaction already finished",{name:this.name},"DBStateTransaction.mergeWithPrevious","DBState.swift",1064),this.basedOnState_.database.commitAndMergeState(this.state),this.finish()},rollback:function(){y.LegacyCoreAssert.isFalse(this.finished_,"Transaction already finished",{name:this.name},"DBStateTransaction.rollback","DBState.swift",1070),this.basedOnState_.database.abandonState(this.state),this.finish()}}}),l),d.DBState=(u=function(){this.derivedStateIDs={}},h.defineClass({name:"DBState",ctor:u,statics:{_implements:function(e){return"IDBState"==e}},props:{database:{get:function(){return this.db_}},objectStates:{get:function(){return this.objectStates_}},allObjectStates:{get:function(){var e=h.dict([this.guid,this]),t=h.clone(this.objectStates),n=this.basedOn;for(y.LegacyCoreAssert.isTrue(this.generation_<200,"Depth of database states unusually high",void 0,"DBState","DBState.swift",1095);null!=n&&(y.LegacyCoreAssert.isTrue(null==e[n.guid],"Found a state cycle",void 0,"DBState","DBState.swift",1098),null==e[n.guid]);){e[n.guid]=n;for(var r=h.iter(n.objectStates);!r.done;r.next()){var o=r.key,a=r.value;null==t[o]&&(t[o]=a)}n=n.basedOn}return t}},transaction:{get:function(){return this.transaction_}},mutableState:{get:function(){var e;return(e=h.as(this.transaction_,d.DBStateTransaction))?e.state.mutableState||e.state:null}},init_40bf:function(e,t,n,r){this.db_=e,this.basedOn=null,this.generation_=0,this.objectStates_=h.clone(r),this.branch=t,this.guid=n},init_62ed:function(e,t,n,r){this.db_=e.database,this.basedOn=e,this.generation_=e.generation_+1,this.objectStates_=h.clone(r),this.branch=t,this.guid=n,e.derivedStateIDs[t]=n},checkpoint:function(){var e={};return this.forEachObjectState(!0,(function(t,n){e[t]=n.checkpoint()})),u.init_40bf(this.db_,this.branch,this.guid,e)},descendsFrom:function(e){return this===e||this.basedOn instanceof u&&this.basedOn.descendsFrom(e)},getDerivedState:function(e){return null!=this.derivedStateIDs[e]?this.db_.getState(this.derivedStateIDs[e]):null},apply:function(){this.applyInternal(!0)},applyInternal:function(e){var t=[];this.forEachObjectState(!0,(function(e,n){n.needsApplyHint()&&t.push([e,n])}));for(var n=h.iter(t);!n.done;n.next()){var r=n.value,o=r[0],a=r[1],i=this.db_.getObject(o);a.apply(h.opt(i,(function(e){return e.descendantObjectsStates})))}e&&this.db_.stateChanged(this)},getObjectStateByID:function(e){return null!=e?this.objectStates_[e]||h.opt(this.basedOn,(function(t){return t.getObjectStateByID(e)})):null},getObjectState:function(e){return this.getObjectStateByID(e.id)},forEachObjectState:function(e,t){var n,r={};h.each(this.objectStates_,(function(e,n){t(e,n),r[e]=!0})),e&&(n=this.basedOn)&&n.forEachObjectState(!0,(function(e,n){null==r[e]&&(t(e,n),r[e]=!0)}))},validate:function(){var e,t,n=h.clone(this.allObjectStates);return(e=h.as(this.database.host,f.DBObject))&&(t=n[e.id])?g.DBSchema.getValidator(e.className)(t):new g.DBValidationErrorNoHost},encode:function(e,t){var n;if(g.DBSchema.currentSchema=g.DBSchema.init_2af7(t),n=h.as(this.database.host,f.DBObject)){var r=g.DBSchema.getDataObjectWriter(e,n.id,this,this.database);g.DBSchema.getSerializer(n.className)(this.getObjectState(n),r)}},beginTransaction:function(e){return y.LegacyCoreAssert.isTrue(null==this.transaction_,"beginTransaction: State already has an open transaction",void 0,"DBState.beginTransaction","DBState.swift",1270),this.transaction_=new d.DBStateTransaction(h.opt(this.basedOn,(function(e){return e.transaction})),e,this,this.branch),this.transaction_},endTransaction:function(e){y.LegacyCoreAssert.isTrue(e===this.transaction_,"endTransaction transaction mismatch",void 0,"DBState.endTransaction","DBState.swift",1276),this.transaction_=null}}}),u),d.DBMutableState=(c=function(){this.objectMutableStates_={},this.newObjectIDs_=[]},h.defineClass({name:"DBMutableState",ctor:c,superName:"DBState",statics:{_implements:function(e){return"IDBMutableState"==e||"IDBState"==e}},props:{parentTransaction:{get:function(){return this.basedOn.transaction}},objectStates:{get:function(){return this.objectMutableStates_}},mutableState:{get:function(){var e;return(e=d.DBState._getters.mutableState.call(this))||null!=e?e:this}},init_4be2:function(e,t,n){h.super_init(this,d.DBState,d.DBState.prototype.init_40bf,e,t,n,{})},init_1198:function(e,t,n){var r;if(h.super_init(this,d.DBState,d.DBState.prototype.init_62ed,e,t,n,{}),r=h.as(e,c))for(var o=h.iter(r.objectMutableStates_);!o.done;o.next()){var a,i=o.key,s=o.value;(a=h.as(s,d.IDBObjectAncestorState))&&(this.objectMutableStates_[i]=d.DBObjectMutableState.init_226b(a))}},init_40bf:function(e,t,n,r){h.super_init(this,d.DBState,d.DBState.prototype.init_40bf,e,t,n,r);for(var o=h.iter(this.objectStates_);!o.done;o.next()){var a,i=o.key,s=o.value;(a=h.as(s,d.IDBObjectAncestorState))&&(this.objectMutableStates_[i]=d.DBObjectMutableState.init_226b(a))}},init_62ed:function(e,t,n,r){h.super_init(this,d.DBState,d.DBState.prototype.init_62ed,e,t,n,r);for(var o=h.iter(this.objectStates_);!o.done;o.next()){var a,i=o.key,s=o.value;(a=h.as(s,d.IDBObjectAncestorState))&&(this.objectMutableStates_[i]=d.DBObjectMutableState.init_226b(a))}},getObjectStateByID:function(e){return null!=e?this.objectMutableStates_[e]||d.DBState.prototype.getObjectStateByID.call(this,e):null},forEachObjectState:function(e,t){var n,r={};h.each(this.objectMutableStates_,(function(e,n){t(e,n),r[e]=!0})),e&&(n=this.basedOn)&&n.forEachObjectState(!0,(function(e,n){null==r[e]&&(t(e,n),r[e]=!0)}))},stateToMutableState:function(e){var t,n,r;return(t=h.as(e,d.IDBObjectMutableState))?t:(n=h.as(e,d.IDBObjectDerivedState))&&(r=n.basedOn)?d.DBObjectMutableState.init_9f95(r,e.properties):d.DBObjectMutableState.init_2a9a(e.object,e.properties)},makeObjectMutable:function(e){null==this.objectMutableStates_[e.id]&&this.newObjectState(e)},newObjectState:function(e){if(e.isChildObject)return this.objectMutableStates_[e.id]=e.state,e.state;var t=this.basedOn,n=h.as(h.opt(t,(function(t){return t.getObjectState(e)})),d.DBObjectState);y.LegacyCoreAssert.isTrue(null!=n||!(e.initialized&&e.persisted),"Object is initialized, but could not find an existing state",{objID:e.id},"DBMutableState.newObjectState","DBState.swift",1384);var r=null!=n?d.DBObjectMutableState.init_226b(n):d.DBObjectMutableState.init_be8f(e),o=e.id;return y.LegacyCoreAssert.isTrue(null==this.objectMutableStates_[o],"Object already has a state",{objID:o},"DBMutableState.newObjectState","DBState.swift",1391),this.objectMutableStates_[e.id]=r,e.state=r,r},setObjectState:function(e,t){var n=this.stateToMutableState(t),r=e.id;y.LegacyCoreAssert.isTrue(t instanceof d.DBChildObjectState||null==this.objectMutableStates_[r],"Object already has a state",{objID:r},"DBMutableState.setObjectState","DBState.swift",1402),this.objectMutableStates_[e.id]=n,e.state=n},addNewObject:function(e,t){this.newObjectIDs_.push(e.id),this.setObjectState(e,t)},removeObject:function(e){this.newObjectIDs_.includes(e)?(h.remove(this.newObjectIDs_,e),h.removeKey(this.objectMutableStates_,e),this.db_.removeObject(e)):null!=this.objectMutableStates_[e]&&(this.objectMutableStates_[e]=this.db_.deletedObject.state)},forEachInCommitList:function(e){for(var t=[],n={},r=0;r<h.count(this.objectMutableStates_);)for(var o=h.keys(this.objectMutableStates_),a=h.iter(o);!a.done;a.next()){var i;if(null==n[u=a.value])(i=this.database.getObject(u))&&(i.willCommitState(),(l=h.as(i.state,d.DBChildObjectState))&&l.savePendingProperties()),n[u]=!0,r+=1}for(var s=h.iter(this.objectMutableStates_);!s.done;s.next()){var l,u=s.key;(p=s.value)instanceof d.DBObjectDeletedState||(y.LegacyCoreAssert.isTrue(h.is(p,d.IDBObjectMutableState),"Immutable state in mutable states dictionary",void 0,"DBMutableState.forEachInCommitList","DBState.swift",1446),(l=h.as(h.opt(this.database.getObject(u),(function(e){return e.state})),d.DBChildObjectState))?t.push([u,l]):t.push([u,p]))}h.sortInPlace(t,(function(e,t){return t[1].depth<e[1].depth}));for(var c=h.iter(t);!c.done;c.next()){var p,f=c.value;e(u=f[0],p=f[1]),h.opt(this.database.getObject(u),(function(e){return e.didCommitState()}))}},commit:function(){var e,t=this,n={};if(this.forEachInCommitList((function(e,r){var o,a,i;(o=h.as(r,d.DBObjectMutableState))?null==o.basedOn?(i=t.database.getObject(e))&&(n[e]=o.assign(i)):n[e]=o.commit():(a=h.as(r,d.DBChildObjectState))?n[e]=a:(y.LegacyCoreAssert.isTrue(r instanceof d.DBObjectDeletedState,"The only immutable object state in a mutable DB state should be the deleted object state",void 0,"DBMutableState.commit","DBState.swift",1482),n[e]=t.db_.deletedObject.state)})),e=h.as(this.basedOn,d.DBState)){var r=d.DBState.init_62ed(e,this.branch,this.guid,n);return e.generation_>25?r.checkpoint():r}return d.DBState.init_40bf(this.db_,this.branch,this.guid,n)},abandon:function(){var e=h.clone(this.newObjectIDs_);this.newObjectIDs_.splice(0);for(var t=h.clone(this.objectMutableStates_),n=h.iter(t);!n.done;n.next()){var r,o,a=n.key,i=n.value;(r=h.as(i,d.DBChildObjectState))&&r.abandonPendingProperties(),(o=this.database.getObject(a))&&o.abandonChanges()}for(var s=h.iter(e);!s.done;s.next())a=s.value,h.removeKey(this.objectMutableStates_,a),this.db_.removeObject(a)},flattenFrom:function(e){for(var t=this,n=[],r=e;r!==this&&null!=r;)n.splice(0,0,r),r=r.basedOn;for(var o=h.iter(n);!o.done;o.next()){var a,i=o.value;if(a=h.as(i,c))a.forEachInCommitList((function(e,n){var r;if(n instanceof d.DBObjectDeletedState)t.objectMutableStates_[e]=t.db_.deletedObject.state;else if(null==t.objectMutableStates_[e])t.objectMutableStates_[e]=t.stateToMutableState(n);else if(r=h.as(t.objectMutableStates_[e],d.DBObjectMutableState))for(var o=h.iter(n.properties);!o.done;o.next()){var a=o.key,i=o.value;r.setProperty(a,i)}}));else for(var s=h.iter(i.objectStates);!s.done;s.next()){var l,u=s.key;if((r=s.value)instanceof d.DBObjectDeletedState)this.objectMutableStates_[u]=this.db_.deletedObject.state;else if(null==this.objectMutableStates_[u])this.objectMutableStates_[u]=this.stateToMutableState(r);else if(l=h.as(this.objectMutableStates_[u],d.DBObjectMutableState))for(var p=h.iter(r.properties);!p.done;p.next()){var f=p.key,m=p.value;l.setProperty(f,m)}}}}}}),c)},"2ALn":function(e,t,n){var r,o=t,a=n("oAGj"),i=n("ascj"),s=n("QbzR"),l=n("Zifs");o.RootStyle=(r=function(){this.deprecatedPrimaryColor=null},a.defineClass({name:"RootStyle",ctor:r,superName:"FormaStyle",statics:{SCHEMA_CLASS_NAME:{get:function(){return"RootStyle"}},KIND:{get:function(){return"RootStyle"}},PROPERTY_COLOR_DEPRECATED:"color",factory:{get:function(){return function(e,t,n,o){return r.init_866e(n,e)}}},createDefault:function(){return r.init_70dd(l.SolidColor.WHITE)},_implements:function(e){return"IDBObject"==e||"TheoMessagePublisher"==e||"ColorTableOwner"==e}},props:{init_866e:function(e,t){var n;a.super_init(this,s.FormaStyle,s.FormaStyle.prototype.init_866e,e,t),(n=a.as(this.get(r.PROPERTY_COLOR_DEPRECATED),["Array",l.SolidColor]))&&n.length>=1&&(this.deprecatedPrimaryColor=n[0])},init_70dd:function(e){a.super_init(this,s.FormaStyle,s.FormaStyle.prototype.init_5afe,r.KIND,s.FormaStyle.OPACITY_DEFAULT,i.ColorTable.createDefault())},className:{get:function(){return r.SCHEMA_CLASS_NAME}},colorTableSupportsRole:function(e){return e==i.ColorRole.FieldPrimary},willCommitState:function(){null!=this.deprecatedPrimaryColor&&(this.colors.fieldPrimary=this.deprecatedPrimaryColor,this.deprecatedPrimaryColor=null,this.removeProperty(r.PROPERTY_COLOR_DEPRECATED)),s.FormaStyle.prototype.willCommitState.call(this)}}}),r)},"2bF5":function(e,t,n){var r,o=t,a=n("oAGj"),i=n("gXiO");o.MoaConstants=(r=function(){i.CoreObject.call(this)},a.defineClass({name:"MoaConstants",ctor:r,superName:"CoreObject",statics:{kMoaColorMapSizeRGB:256,kSatVibranceSumMax:150}}),r)},"3/rh":function(e,t,n){var r,o=t,a=n("oAGj"),i=n("4/a+");o.MotionEntryFadeIn=(r=function(){this.srcId="MotionSrcFadeIn",this.logic=new i.MotionLogicDur,this.args={st:.1,dur:.9}},a.defineClass({name:"MotionEntryFadeIn",ctor:r,statics:{_implements:function(e){return"MotionEntry"==e}}}),r)},"358a":function(e,t,n){var r,o=t,a=n("oAGj"),i=n("SpAV"),s=n("yhkb"),l=n("gXiO"),u=n("yGNn"),c=n("ascj"),d=n("FNB+"),h=n("fWxZ"),p=n("G1DZ"),f=n("pnSN"),m=n("cEBg"),g=n("uxH+"),y=n("K0Rh"),_=n("Zifs"),T=n("6Tzw"),C=n("umUn");o.PagesFacade=(r=function(){l.CoreObject.call(this)},a.defineClass({name:"PagesFacade",ctor:r,superName:"CoreObject",statics:{MAX_PAGES:30,canAddPages:function(e,t){return void 0===t&&(t=1),e.getPageCount()+t<=r.MAX_PAGES},canDeletePages:function(e,t){return void 0===t&&(t=1),e.getPageCount()-t>0},canActivateNextPage:function(e){return e.getPageIndex(r.getActivePage(e))<e.getPageCount()-1},canActivatePreviousPage:function(e){return e.getPageIndex(r.getActivePage(e))>0},addNewPage:function(e,t,n){var o;void 0===t&&(t=null),void 0===n&&(n=null);var a=e.getPageCount(),s=(o=t)||null!=o?o:a;i.CoreAssertDebugOnly.isTrue(r.canAddPages(e),"Requested add page when canAddPages is false",{at:s,count:a},"PagesFacade.addNewPage","PagesFacade.swift",33),i.CoreAssert.isTrue(s>=0&&s<=a,"Requested add page at invalid index",{at:s,count:a},"PagesFacade.addNewPage","PagesFacade.swift",35);var l=0==s?e.firstPage:e.getPageAtIndex(s-1),u=r.createNewPage(e,l,!1,n);return e.addPage(u,s),u},deletePage:function(e){var t;(t=e.document)&&(i.CoreAssertDebugOnly.isTrue(r.canDeletePages(t),"Requested delete page when canDeletePages is false",{count:t.getPageCount()},"PagesFacade.deletePage","PagesFacade.swift",49),e===r.getActivePage(t)&&(e===t.lastPage?r.activatePreviousPage(t):r.activateNextPage(t)),t.deletePage(e))},duplicatePage:function(e,t,n){var o,s;if(void 0===t&&(t=null),s=n||e.document){i.CoreAssertDebugOnly.isTrue(r.canAddPages(s),"Requested duplicate page when canAddPages is false",{count:s.getPageCount()},"PagesFacade.duplicatePage","PagesFacade.swift",64);var l=r.createNewPage(s,e);l.themeID=e.themeID;var c=[],d=r.getCopyPromises(e.root,l,c);return u.CorePromise.all(c).then((function(n){var r,i,u,c;if(d&&(i=a.opt(a.as(l.root.controller,g.RootController),(function(e){return e.getGridController()})))&&i.updateGridAssignments(),(r=a.opt(a.as(e.root.controller,g.RootController),(function(e){return e.getGridController()})))&&(i=a.opt(a.as(l.root.controller,g.RootController),(function(e){return e.getGridController()})))&&i.match(r),(u=e.animationController.animationStyle)&&(c=a.as(l.root,y.RootForma))){var h=u.clone();l.animationLibrary.setRootAnimationStyle(h,c)}var p=(o=t)||null!=o?o:s.getPageIndex(e);return s.addPage(l,p+1),l}))}return u.CorePromise.reject("not a valid document")},duplicatePages:function(e,t,n){var o,i;if((o=a.last(e))&&null!=(i=n!=m.DuplicatePagesAction.invalidIndex?n:a.opt(o.document,(function(e){return e.getPageIndex(o)})))){var s=a.toSequence(e).map((function(e){return r.duplicatePage(e.element,i+e.offset,t)}),this);return u.CorePromise.all(s)}return u.CorePromise.resolve(null)},movePages:function(e,t){var n,r;(n=a.first(e))&&(r=n.document)&&r.movePages(e,t)},getActivePage:function(e){return a.opt(e.controller,(function(e){return e.model.activePage.get()}))||e.firstPage},setActivePage:function(e){var t;if(t=e.document){var n=r.getActivePage(t);n!=e&&(T.SelectionFacade.deselectAllOnPage(n),a.opt(t.controller,(function(t){return t.designController.activePage.set(e)})))}},activateNextPage:function(e){var t,n=r.getActivePage(e),o=e.getPageIndex(n);return!!(o<e.getPageCount()-1&&(t=e.getPageAtIndex(o+1)))&&(r.setActivePage(t),!0)},activatePreviousPage:function(e){var t,n=r.getActivePage(e),o=e.getPageIndex(n);return!!(o>0&&(t=e.getPageAtIndex(o-1)))&&(r.setActivePage(t),!0)},visitPages:function(e,t){for(var n=e.getPageCount(),r=a.iter(a.range(0,n,!1));!r.done;r.next()){var o,i=r.value;if((o=e.getPageAtIndex(i))&&!t(o))break}},visitPagesReversed:function(e,t){for(var n=e.getPageCount(),r=a.iter(a.stride(n-1,0,-1));!r.done;r.next()){var o,i=r.value;if((o=e.getPageAtIndex(i))&&!t(o))break}},createNewPage:function(e,t,n,r){void 0===n&&(n=!0),void 0===r&&(r=null);var o,i=h.FormaPage.init_d0e4(e);a.opt(a.as(i.root.controller,g.RootController),(function(e){return e.createGridControllerIfNone()})),(o=r)?i.setPageSizeFromDesignSize(o):(i.sizeID=t.sizeID,i.customSizeFormat=t.customSizeFormat,i.customSizePPI=t.customSizePPI,i.setPageSize(t.pageSize,t.exportData)),i.originalSizeID=i.sizeID,i.colorLibrary.matchProperties(t.colorLibrary.state.allProperties);var l=a.opt(a.as(i.root.controller,g.RootController),(function(e){return e.getGridController()}));if(n){var u;i.root.style.match(t.root.style),(u=a.opt(a.as(t.root.controller,g.RootController),(function(e){return e.getGridController()})))&&a.opt(l,(function(e){return e.match(u)}))}else{a.eq(_._equality_SolidColor_SolidColor,a.opt(i.colorLibrary.color(s.ColorLibraryController.WHITE_KEY),(function(e){return e.rgbColor})),_.SolidColor.WHITE)||i.colorLibrary.setColor(s.ColorLibraryController.WHITE_KEY,C.TheoColor.init_5344(_.SolidColor.WHITE,null,null));var d,p=s.ColorLibraryController.WHITE_KEY;i.root.style.colors.setColorId(c.ColorRole.FieldPrimary,p),(d=a.first(a.opt(l,(function(e){return e.getBackgroundShapes()}))))&&d.style.colors.setColorId(c.ColorRole.FieldPrimary,p)}return i},getCopyPromises:function(e,t,n){var o,i=!1;if(o=e.controller){var s,l=e.isBackgroundImage();if(i=i||l,o.duplicatable||l){var u=o.copyTo(t,!1,null,!1).then((function(t){var n;return(n=a.as(t,d.Forma))&&p.FormaSourceUtils.isDesignVariation(e.source)&&(n.source=e.source),t}));n.push(u)}else if((s=a.as(e,f.GroupForma))&&a.opt(s.controller,(function(e){return 0==e.userGroup})))for(var c=a.iter(a.range(0,s.childCount,!1));!c.done;c.next()){var h=c.value;r.getCopyPromises(s.childAt(h),t,n)}}return i},getPagesSizeID:function(e){for(var t,n=a.opt(a.first(e),(function(e){return e.sizeID})),r=a.iter(e);!r.done;r.next())if(r.value.sizeID!=n)return"";return(t=n)||null!=t?t:""},getPagesExportData:function(e){for(var t=a.opt(a.first(e),(function(e){return e.exportData})),n=a.iter(e);!n.done;n.next()){var r=n.value;if(a.opt(r.exportData,(function(e){return 1!=e.isEqual(t)})))return null}return t},getPagesPaletteID:function(e){for(var t,n=a.opt(a.first(e),(function(e){return e.colorLibrary.paletteID})),r=a.iter(e);!r.done;r.next())if(r.value.colorLibrary.paletteID!=n)return"";return(t=n)||null!=t?t:""},getScopeIdentifier:function(e){for(var t,n="",r=a.iter(e);!r.done;r.next()){var o=r.value,i=(t=a.opt(o.document,(function(e){return e.getPageIndex(o)})))||null!=t?t:0;n+=a.toString(i)+","}return n},clearPageFormaCaches:function(e){r.visitPages(e,(function(e){return e.clearFormaCache(),!0}))},getAnimatingPages:function(e){var t=[];return r.visitPages(e,(function(e){return e.animationController.playing&&t.push(e),!0})),t}}}),r)},"37nf":function(e,t,n){var r,o=t,a=n("oAGj"),i=n("FNB+"),s=n("6ZWm"),l=n("lmwz"),u=n("fNpk"),c=n("tGKA"),d=n("djAF"),h=n("oKlP"),p=n("sIWg"),f=n("LGJg"),m=n("mxdD");o.ImageUtils=(r=function(){},a.defineClass({name:"ImageUtils",ctor:r,statics:{suggestCrop:function(e,t,n,o,a){var i,l=n.size,d=Math.max(l.width/e.width,l.height/e.height);if((d>1||a==s.CropType.FitBorder)&&(l=l.multiply(1/d)),a==s.CropType.FillFocus){var f=new p.TheoRect(0,0,e.width,e.height),m=t.insetRel(-.25,-.25,-.25,-.25),g=t.insetXY(f.width/10,f.height/10),y=(m.area>g.area?m:g).insetRel(-.25,-.25,-.25,-.25).intersectionWith(f);i=r.getCropOfFocusRegion(y,n.size)}else if(a==s.CropType.ExtremeCloseup)i=r.getCropOfFocusRegion(t.insetRel(.25,.25,.25,.25),n.size);else if(a==s.CropType.AbstractCloseup)i=p.TheoRect.fromXYWH(t.center.x,t.center.y,5,5);else if(a==s.CropType.PreserveFocus&&null!=o){var _=o.center,T=t.center,C=new h.TheoPoint((T.x-_.x)/o.width,(T.y-_.y)/o.height);i=p.TheoRect.fromSize(l);var v=new h.TheoPoint(_.x-i.center.x,_.y-i.center.y);i=i.transform(c.Matrix2D.translation(v));var P=new h.TheoPoint((T.x-i.center.x)/i.width,(T.y-i.center.y)/i.height),S=new h.TheoPoint((P.x-C.x)*i.width,(P.y-C.y)*i.height);(i=i.transform(c.Matrix2D.translation(S))).minX<0&&(i=i.transform(c.Matrix2D.translation(new h.TheoPoint(-i.minX,0)))),i.maxX>=e.width&&(i=i.transform(c.Matrix2D.translation(new h.TheoPoint(e.width-i.maxX,0)))),i.minY<0&&(i=i.transform(c.Matrix2D.translation(new h.TheoPoint(0,-i.minY)))),i.maxY>=e.height&&(i=i.transform(c.Matrix2D.translation(new h.TheoPoint(0,e.height-i.maxY))))}else if(a==s.CropType.FitBorder){var A=e.width-l.width,D=e.height-l.height,E=A<1?0:Math.min(Math.max(0,t.center.x-l.width/2),A),R=D<1?0:Math.min(Math.max(0,t.center.y-l.height/2),D);i=p.TheoRect.fromXYWH(E,R,l.width,l.height)}else u.LegacyCoreAssert.fail("no valid crop type",void 0,"ImageUtils.suggestCrop","ImageUtils.swift",85);return null!=i&&i.area>0?i:null},getCropOfFocusRegion:function(e,t){var n=t.aspectRatio;if(n>e.aspectRatio){var r=e.width/n;return p.TheoRect.fromXYWH(e.minX,e.minY+(e.height-r)/2,e.width,r)}var o=e.height*n;return p.TheoRect.fromXYWH(e.minX+(e.width-o)/2,e.minY,o,e.height)},getMediaMetadataForForma:function(e){var t,n,r=null;if(t=m.VideoFacade.getVideoFormaForForma(e))r=a.opt(t.videoContentNode,(function(e){return e.mediaMetadata}));else if(n=l.ImageFacade.getImageFormaForForma(e))r=a.opt(n.contentNode,(function(e){return e.mediaMetadata}));else if(e.hasIntent(i.Forma.INTENT_ICON)){var o,s;(o=a.as(e,d.ShapeForma))&&(s=a.as(o.contentNode,f.VectorContentNode))&&(r=s.mediaMetadata)}return r}}}),r)},"3DEm":function(e,t,n){var r,o,a=t,i=n("oAGj"),s=n("fNpk"),l=n("tGKA"),u=n("oKlP");a.CircleCircleData=(r=function(e,t,n,r){this.leftCenter=e,this.rightCenter=t,this.sine=n,this.cosine=r},i.defineClass({name:"CircleCircleData",ctor:r}),r),a.MathUtils=(o=function(){},i.defineClass({name:"MathUtils",ctor:o,statics:{nearestMultiple:function(e,t){return s.LegacyCoreAssert.isTrue(!isNaN(e),"Can't find nearest multiple for NaN",void 0,"MathUtils.nearestMultiple","MathUtils.swift",40),s.LegacyCoreAssert.isTrue(!isNaN(t),"Can't find nearest multiple when factor is NaN",void 0,"MathUtils.nearestMultiple","MathUtils.swift",41),Math.round(e/t)*t},absDouble:function(e){return e>=0?e:-e},absInt:function(e){return e>=0?e:-e},minInt:function(e,t){return t<e?t:e},maxInt:function(e,t){return t>e?t:e},minDouble:function(e,t){var n,r,o,a;return(r=null!=(a=t)?a:0)<(n=null!=(o=e)?o:0)?r:n},maxDouble:function(e,t){var n,r,o,a;return(r=null!=(a=t)?a:0)>(n=null!=(o=e)?o:0)?r:n},VectorDot:function(e,t){return e.x*t.x+e.y*t.y},VectorCross:function(e,t){return e.x==t.x?e.x*(t.y-e.y):e.y==t.y?e.y*(e.x-t.x):e.x*t.y-t.x*e.y},VectorNorm:function(e){return 0==e.x?o.absDouble(e.y):0==e.y?o.absDouble(e.x):Math.sqrt(o.VectorDot(e,e))},UnitTriangleToTriangleMatrix:function(e,t,n){return new l.Matrix2D(u._minus_TheoPoint_TheoPoint(t,e).x,u._minus_TheoPoint_TheoPoint(t,e).y,u._minus_TheoPoint_TheoPoint(n,e).x,u._minus_TheoPoint_TheoPoint(n,e).y,e.x,e.y)},TriangleToUnitTriangleMatrix:function(e,t,n,r){return new l.Matrix2D(u._minus_TheoPoint_TheoPoint(r,t).y/e,u._minus_TheoPoint_TheoPoint(t,n).y/e,u._minus_TheoPoint_TheoPoint(t,r).x/e,u._minus_TheoPoint_TheoPoint(n,t).x/e,o.VectorCross(r,t)/e,o.VectorCross(t,n)/e)},MoveRectangleMatrix:function(e,t){var n=new u.TheoPoint(0,0),r=new u.TheoPoint(1,0),a=new u.TheoPoint(0,1);return o.MoveTriangleMatrix(e.eval(n),e.eval(r),e.eval(a),t.eval(n),t.eval(r),t.eval(a))},TriangleDiscriminant:function(e,t,n){return o.VectorCross(u._minus_TheoPoint_TheoPoint(t,e),u._minus_TheoPoint_TheoPoint(n,e))},MoveTriangleMatrix:function(e,t,n,r,a,i){var s=o.TriangleDiscriminant(e,t,n),l=o.TriangleToUnitTriangleMatrix(s,e,t,n);return l=l.concat(o.UnitTriangleToTriangleMatrix(r,a,i))},CircleCircleIntersection:function(e,t,n,r){var i=u._minus_TheoPoint_TheoPoint(n,e),s=o.VectorNorm(i),l=o.VectorDot(i,i),c=u.TheoPoint.ZERO,d=u.TheoPoint.ZERO,h=(l+t*t-r*r)/2/s/t;if(h>1||h<-1)return c=u.TheoPoint.INVALID,d=u.TheoPoint.INVALID,new a.CircleCircleData(c,d,NaN,NaN);var p=Math.sqrt(1-h*h),f=s*t*h,m=s*t*p,g=new u.TheoPoint(m,f),y=new u.TheoPoint(o.VectorCross(i,g),o.VectorDot(i,g)).divide(l);c=u._plus_TheoPoint_TheoPoint(e,y);var _=new u.TheoPoint(f,m),T=new u.TheoPoint(o.VectorDot(_,i),o.VectorCross(_,i)).divide(l);return d=u._plus_TheoPoint_TheoPoint(e,T),new a.CircleCircleData(c,d,p,h)},ArcToBezier3:function(e,t,n){if(isNaN(e)||!isFinite(e))return s.LegacyCoreAssert.fail("bad start value",void 0,"MathUtils.ArcToBezier3","MathUtils.swift",267),[];if(isNaN(t)||!isFinite(t))return s.LegacyCoreAssert.fail("bad end value",void 0,"MathUtils.ArcToBezier3","MathUtils.swift",273),[];if(n<1)return s.LegacyCoreAssert.fail("bad patch count",void 0,"MathUtils.ArcToBezier3","MathUtils.swift",279),[];for(var r=[],a=(t-e)/i.toDouble(n),l=e,u=i.iter(i.range(0,n-1,!0));!u.done;u.next()){var c=u.value+1<n?l+a:t,d=i.clone(o.arc2bezier2_(l,c));r.length>0&&r.splice(r.length-1,1),r=r.concat(d),l=c}return r},arc2bezier2_:function(e,t){var n=t-e,r=i.clone(o.arc2bezier_(n)),a=e+n/2,s=Math.cos(a),u=Math.sin(a);1==s||-1==s?u=0:1==u||-1==u?s=0:0==s?u=u>0?1:-1:0==u&&(s=s>0?1:-1);var c=l.Matrix2D.rotation(s,u);return r[0]=c.transformPoint(r[0]),r[1]=c.transformPoint(r[1]),r[2]=c.transformPoint(r[2]),r[3]=c.transformPoint(r[3]),r},arc2bezier_:function(e){var t=new u.TheoPoint(Math.cos(e/2),-Math.sin(e/2)),n=new u.TheoPoint(t.x,-t.y),r=new u.TheoPoint((4-t.x)/3,(1-t.x)*(3-t.x)/(3*t.y));return[t,r,new u.TheoPoint(r.x,-r.y),n]},saturate_range:function(e,t,n){var r=e,o=t;if(s.LegacyCoreAssert.isTrue(r<o||o<r||r==o,"range high or low is not a number",void 0,"MathUtils.saturate_range","MathUtils.swift",357),o<r){var a=r;r=o,o=a}return n<r?r:n>o?o:(s.LegacyCoreAssert.isTrue(n==n,"value to clip is not a number",void 0,"MathUtils.saturate_range","MathUtils.swift",372),n)},Reflect:function(e,t){return new u.TheoPoint(-e.x+2*t.x,-e.y+2*t.y)},sign:function(e){return 0==e?0:e<0?-1:1},getMean:function(e){var t=null,n=i.toDouble(e.length);if(n>0){for(var r=0,o=i.iter(e);!o.done;o.next())r+=o.value;t=r/n}return t},getGeometricMean:function(e){var t=null,n=i.toDouble(e.length);if(n>0){for(var r=1,o=i.iter(e);!o.done;o.next())r*=o.value;t=Math.pow(r,1/n)}return t},roundDoubleToString:function(e,t){var n=t;return e%1==0&&(n=0),i.toString("%."+i.toString(n)+"f",e)}}}),o)},"3HaQ":function(e,t,n){var r,o,a=t,i=n("oAGj"),s=n("6ZWm"),l=n("7Pku"),u=n("w/+j"),c=n("9Lk3"),d=n("iCxV"),h=n("fNpk"),p=n("tGKA"),f=n("Ird5"),m=n("jLWG"),g=n("jfma"),y=n("yjxF"),_=n("euLT"),T=n("Aj79"),C=n("Ucb9"),v=n("g6aL"),P=n("Zifs"),S=n("djAF"),A=n("fiuZ"),D=n("byfQ"),E=n("hgLm"),R=n("oKlP");a.ShapeFormaToPGMMapper=(r=function e(){l.FormaToPGMMapper.call(this,e.FORMA_KIND)},o={},i.defineClass({name:"ShapeFormaToPGMMapper",ctor:r,superName:"FormaToPGMMapper",statics:{FORMA_KIND:{get:function(){return void 0===o.FORMA_KIND&&(o.FORMA_KIND=S.ShapeForma.KIND),o.FORMA_KIND}},instance:{get:function(){return void 0===o.instance&&(o.instance=new r),o.instance}},createMapper:function(e){return r.instance},applyAnimations:function(e,t,n,r,o){var a,s=n;if(e.asDynamic&&(a=t.animation)){var l=i.clone(u.FormaToPGMUtils.convertAnimation(n,a,r,o));if(l.length>0){var c=f.PGMAnimationList.fromArray(l);s=n.withAnimations(n.animations.merge(c))}}return s},DUMMY_REF:{get:function(){return void 0===o.DUMMY_REF&&(o.DUMMY_REF=new T.PGMReference(new _.PGMNullNode("dummy"))),o.DUMMY_REF}},makePGMRefForArtwork:function(e,t,n,o,a,s,l){var u,c,d,p,_=f.PGMAnimationList.EMPTY;if(c=o.bounds)if(d=i.as(o,D.TheoArtworkShape))u=new T.PGMReference(new C.PGMShape(n,new y.PGMNodeMetadata(n,"shape"),_,c,d.paths,s,l,t.legacyRender),a);else if(p=i.as(o,D.TheoArtworkGroup)){var P,S=[],A=1;p.forEachChild((function(o){var a;if(a=r.makePGMRefForArtwork(e,t,n+"-"+A,o,g.PGMCompositingParams.DEFAULT,s,l)){var i=r.applyAnimations(e,t,a,!1,!0);S.push(i)}A+=1})),u=(P=i.as(p,D.TheoArtworkClipGroup))?new T.PGMReference(new m.PGMClip(n,new y.PGMNodeMetadata(n,"clip"),f.PGMAnimationList.EMPTY,S,[P.path]),a):1==S.length?S[0].withCompositing(a):new T.PGMReference(new v.PGMSimpleGroup(n,new y.PGMNodeMetadata(n,"group"),f.PGMAnimationList.EMPTY,S),a)}else h.LegacyCoreAssert.fail("unable to create PGM for artwork: not a shape or a group",void 0,"ShapeFormaToPGMMapper.makePGMRefForArtwork","ShapeFormaToPGMMapper.swift",163),u=null;else h.LegacyCoreAssert.fail("unable to create PGM for artwork: no bounds",void 0,"ShapeFormaToPGMMapper.makePGMRefForArtwork","ShapeFormaToPGMMapper.swift",167),u=null;return u},makePGMRefForShape:function(e,t,n){var o=r.DUMMY_REF,a=t.style.colors.fieldPrimary;null==a&&i.opt(d.Host.logging,(function(e){return e.warning("shape forma has no primary color; will not render")}));var u,m,C=a||P.SolidColor.ZERO,S=t.style.colors.fieldSecondary||null,D=c.GridController.isBackgroundColoredCell(t)?e.backgroundOpacityOverride:1,E=C.withAlphaOf(C.alpha*D),F=l.FormaToPGMMapper.mapBlendMode(t),I=A.ShapeFacade.canSetStrokeWeightMultiplier([t]);if(null!=t.sliceBox||I)(b=r.makePGMRefForArtwork(e,t,n,t.sizedArtwork,new g.PGMCompositingParams(t.placement,t.style.opacity,F),E,S))?o=b:(h.LegacyCoreAssert.fail("unexpected artwork configuration",void 0,"ShapeFormaToPGMMapper.makePGMRefForShape","ShapeFormaToPGMMapper.swift",258),o=new T.PGMReference(new _.PGMNullNode(n+"-shape-error-3")));else if((u=t.canonicalArtwork.bounds)&&(m=t.bounds)){var b,O=p.Matrix2D.calculateResizeTransform(u,m,R.TheoPoint.ZERO,s.FitType.Stretch);if(b=r.makePGMRefForArtwork(e,t,n,t.canonicalArtwork,new g.PGMCompositingParams(O,t.style.opacity,F),E,S)){var k=r.applyAnimations(e,t,b,!1,!0);o=new T.PGMReference(new v.PGMSimpleGroup(n+"-shape-container",new y.PGMNodeMetadata(n,"shape-container"),f.PGMAnimationList.EMPTY,[k]),new g.PGMCompositingParams(t.placement))}else h.LegacyCoreAssert.fail("unexpected artwork configuration",void 0,"ShapeFormaToPGMMapper.makePGMRefForShape","ShapeFormaToPGMMapper.swift",238),o=new T.PGMReference(new _.PGMNullNode(n+"-shape-error-1"))}else h.LegacyCoreAssert.fail("couldn't get artwork or forma bounds for shape",void 0,"ShapeFormaToPGMMapper.makePGMRefForShape","ShapeFormaToPGMMapper.swift",242),o=new T.PGMReference(new _.PGMNullNode(n+"-shape-error-2"));return o},applyPathAsClip:function(e,t,n,o,a){var l,u,c,d,C=r.DUMMY_REF,P=f.PGMAnimationList.EMPTY,S=i.clone(o),F=A.ShapeFacade.canSetStrokeWeightMultiplier([t]);if(null!=t.sliceBox||F)if((d=i.as(t.sizedArtwork,D.TheoArtworkShape))&&(u=n.bounds)){for(var I=(k=i.clone(d.paths))[0].bounds,b=i.iter(i.range(1,k.length,!1));!b.done;b.next()){var O=b.value;I=I.unionWith(k[O].bounds)}(L=(N=p.Matrix2D.calculateResizeTransform(I,u,R.TheoPoint.ZERO,s.FitType.Stretch).concat(t.placement)).inverse)&&(C=new T.PGMReference(new m.PGMClip(a,new y.PGMNodeMetadata(a,"shape"),P,[new T.PGMReference(new v.PGMSimpleGroup(a+"-clip-wrapper",new y.PGMNodeMetadata(a,"clipped-node-wrapper"),P,S),new g.PGMCompositingParams(L))],k),new g.PGMCompositingParams(N)))}else if((c=i.as(t.sizedArtwork,D.TheoArtworkClipGroup))&&(d=i.as(c.childAt(0),D.TheoArtworkShape))&&(u=n.bounds)){I=(k=i.clone(d.paths))[0].bounds;for(var k,M=i.iter(i.range(1,k.length,!1));!M.done;M.next())O=M.value,I=I.unionWith(k[O].bounds);var N,L;if(L=(N=p.Matrix2D.calculateResizeTransform(I,u,R.TheoPoint.ZERO,s.FitType.Stretch).concat(t.placement)).inverse){var x,B=!0;c.path instanceof E.TheoEmptyPath?B=!1:(x=i.as(c.path,E.TheoRectanglePath))&&(B=x.rect.contains(I));var w=new T.PGMReference(new m.PGMClip(a,new y.PGMNodeMetadata(a,"shape"),P,[new T.PGMReference(new v.PGMSimpleGroup(a+"-clip-wrapper",new y.PGMNodeMetadata(a,"clipped-node-wrapper"),P,S),new g.PGMCompositingParams(L))],k),new g.PGMCompositingParams(B?p.Matrix2D.Identity:N));C=B?new T.PGMReference(new m.PGMClip(a+"-clip",new y.PGMNodeMetadata(a,"clip"),f.PGMAnimationList.EMPTY,[w],[c.path]),new g.PGMCompositingParams(N)):w}}else h.LegacyCoreAssert.fail("unexpected artwork configuration",void 0,"ShapeFormaToPGMMapper.applyPathAsClip","ShapeFormaToPGMMapper.swift",454),C=new T.PGMReference(new _.PGMNullNode(a));else(l=t.canonicalArtwork.bounds)&&(u=n.bounds)?((L=(N=p.Matrix2D.calculateResizeTransform(l,u,R.TheoPoint.ZERO,s.FitType.Stretch).concat(t.placement)).inverse)&&(S=[new T.PGMReference(new v.PGMSimpleGroup(a,new y.PGMNodeMetadata(a,"clipped-node-wrapper"),P,S),new g.PGMCompositingParams(L))]),(d=i.as(t.canonicalArtwork,D.TheoArtworkShape))?C=new T.PGMReference(new m.PGMClip(a+"-clip",new y.PGMNodeMetadata(a,"shape-clip"),P,S,d.paths),new g.PGMCompositingParams(N)):(c=i.as(t.canonicalArtwork,D.TheoArtworkClipGroup))&&(d=i.as(c.childAt(0),D.TheoArtworkShape))?C=new T.PGMReference(new m.PGMClip(a+"-clip",new y.PGMNodeMetadata(a,"outer-shape-clip"),f.PGMAnimationList.EMPTY,[new T.PGMReference(new m.PGMClip(a+"-inner-clip",new y.PGMNodeMetadata(a,"inner-shape-clip"),P,S,d.paths))],[c.path]),new g.PGMCompositingParams(N)):(h.LegacyCoreAssert.fail("unexpected artwork configuration",void 0,"ShapeFormaToPGMMapper.applyPathAsClip","ShapeFormaToPGMMapper.swift",340),C=new T.PGMReference(new _.PGMNullNode(a)))):(h.LegacyCoreAssert.fail("no shape and/or primary color?",void 0,"ShapeFormaToPGMMapper.applyPathAsClip","ShapeFormaToPGMMapper.swift",344),C=new T.PGMReference(new _.PGMNullNode(a)));return C}},props:{makePGMRef:function(e,t,n,o){var a;return(a=i.as(e,S.ShapeForma))?0==t.backgroundOpacityOverride&&c.GridController.isBackgroundColoredCell(e)?new T.PGMReference(new _.PGMNullNode(a.formaID)):u.FormaToPGMUtils.applyAnimations(t,e,r.makePGMRefForShape(t,a,a.formaID)):(h.LegacyCoreAssert.fail("ShapeFormaToPGMMapper: not a shape forma",void 0,"ShapeFormaToPGMMapper.makePGMRef","ShapeFormaToPGMMapper.swift",50),null)}}}),r)},"3OP7":function(e,t,n){var r,o=t,a=n("oAGj"),i=n("gXiO"),s=n("aS4X"),l=n("uMFj"),u=n("iCxV"),c=n("8vXU"),d=n("muPB"),h=n("C4JV"),p=n("rxGp");o.DocumentPersistenceFactory=(r=function(){i.CoreObject.call(this)},a.defineClass({name:"DocumentPersistenceFactory",ctor:r,superName:"CoreObject",statics:{THEO_PROPERTY_NAMESPACE:"theo#",namespacedPropertyName:function(e){return e.includes("#")?e:r.THEO_PROPERTY_NAMESPACE+e},usesJsonDocumentEncoding:function(e){return!!e.getComponentWithAbsolutePath(h.JSON_CONTENT_PATH_DCX2D)},encoderFor:function(e){return u.Host.persistUtils.useJsonDocumentEncoding()?(u.Host.logging.logForCategory(p.LogCategories.kDocPersistenceFactory,"Using JSONDocumentEncoder",c.LogLevelEnum.INFO_LEVEL),new h.JSONDocumentEncoder(e)):(u.Host.logging.logForCategory(p.LogCategories.kDocPersistenceFactory,"Using DCXDocumentEncoder",c.LogLevelEnum.INFO_LEVEL),new l.DCXDocumentEncoder(e))},decoderFor:function(e){return r.usesJsonDocumentEncoding(e)?(u.Host.logging.logForCategory(p.LogCategories.kDocPersistenceFactory,"Using JSONDocumentDecoder",c.LogLevelEnum.INFO_LEVEL),new d.JSONDocumentDecoder(e)):(u.Host.logging.logForCategory(p.LogCategories.kDocPersistenceFactory,"Using DCXDocumentDecoder",c.LogLevelEnum.INFO_LEVEL),new s.DCXDocumentDecoder(e))}}}),r)},"3hwA":function(e,t,n){var r=t,o=n("oAGj");r.IImportDataObject=o.defineProtocol("IImportDataObject",{id:"String",type:"String",name:"String",path:"String",optionalStringProperty:"(String) -> String",stringProperty:"(String, String) -> String",numberProperty:"(String, Double) -> Double",intProperty:"(String, Integer) -> Integer",booleanProperty:"(String, Boolean) -> Boolean",optionalBooleanProperty:"(String) -> Boolean",property:"(String) -> AnyObject",forEachChild:"((IImportDataObject, Integer) -> Void) -> Void",forEachComponent:"((IImportDataComponent, Integer) -> Void) -> Void"}),r.IMissingFontHelper=o.defineProtocol("IMissingFontHelper",{recordMissingFont:"(String) -> Void"}),r.IImportDataComponent=o.defineProtocol("IImportDataComponent",{id:"String",name:"String",path:"String",mimeType:"String",etag:"String",url:"String"})},"4/a+":function(e,t,n){var r,o=t,a=n("oAGj"),i=n("URxh"),s=n("iCxV"),l=n("RkYL");o.MotionLogicDur=(r=function(){},a.defineClass({name:"MotionLogicDur",ctor:r,statics:{_implements:function(e){return"MotionLogic"==e}},props:{apply:function(e,t,n){var r,o,u,c,d=(r=a.as(n.st,"Double"))||null!=r?r:0,h=d+((o=a.as(n.dur,"Double"))||null!=o?o:1),p=[];if(h>0&&t.length>0){p=[];var f=t[0],m=t[t.length-1];d!=f.time.seconds&&p.push(f),p.push(new i.KeyFrame(l.TheoTime.fromSeconds(d),f.timingFunction,f.placement,f.bounds,f.style)),p.push(new i.KeyFrame(l.TheoTime.fromSeconds(h),m.timingFunction,m.placement,m.bounds,m.style))}(u=e.animation)?u.keyFrames=p.concat():a.opt(s.Host.logging,(function(e){return e.warning("Missing animation key-frame array")})),(c=a.opt(e.animation,(function(e){return e.endTime})))&&c.seconds<h&&(e.animation.endTime=l.TheoTime.fromSeconds(h))}}}),r)},"44Iz":function(e,t,n){var r,o,a,i=t,s=n("oAGj");i.PGMExportSettings=(r=function(e,t){void 0===t&&(t=1),this.asDynamic=e,this.backgroundOpacityOverride=t},o={},s.defineClass({name:"PGMExportSettings",ctor:r,superName:"CoreObject",statics:{STATIC:{get:function(){return void 0===o.STATIC&&(o.STATIC=new r(!1)),o.STATIC}},DYNAMIC:{get:function(){return void 0===o.DYNAMIC&&(o.DYNAMIC=new r(!0)),o.DYNAMIC}}},props:{asString:{get:function(){return(this.asDynamic?"dynamic":"static")+(1==this.backgroundOpacityOverride?"":"bgop="+this.backgroundOpacityOverride)}}}}),r),i.PGMSource=(a=function(){},s.defineClass({name:"PGMSource",ctor:a,props:{getGraph:function(e){return null},getGraphForForma:function(e,t){return null}}}),a)},"4mVB":function(e,t,n){var r,o=t,a=n("oAGj"),i=n("ascj"),s=n("FNB+"),l=n("6ZWm"),u=n("cmoc"),c=n("QbzR"),d=n("9Lk3"),h=n("tQF8"),p=n("iCxV"),f=n("fNpk"),m=n("oKlP"),g=n("sIWg");o.GridStyle=(r=function(){this.gridCells_=null,this.formaMapping_=null,this.forma_=null},a.defineClass({name:"GridStyle",ctor:r,superName:"FormaStyle",statics:{SCHEMA_CLASS_NAME:{get:function(){return"GridStyle"}},KIND:{get:function(){return"GridStyle"}},DEFAULT_NAME:"None",DEFAULT_CATEGORY:"Grid",CUSTOM_LAYOUT_NAME:"Custom",SINGLE_LAYOUT_NAME:"Single",BALANCED_LAYOUT_NAME:"Balanced-Layout",PROPERTY_NAME:"name",PROPERTY_CATEGORY:"category",PROPERTY_GRID_CELLS:"grid-cells",PROPERTY_FORMA_MAPPING:"forma-mapping",PROPERTY_SPACING:"spacing",PROPERTY_CROP_TYPE:"crop-type",factory:{get:function(){return function(e,t,n,o){return r.init_866e(n,e)}}},createDefault:function(){return r.init_bf40(r.DEFAULT_NAME,r.DEFAULT_CATEGORY,[new h.GridCell(g.TheoRect.ONE_BY_ONE)],null,0,!1,l.CropType.PreserveFocus)},_implements:function(e){return"IDBObject"==e||"TheoMessagePublisher"==e||"ColorTableOwner"==e}},props:{init_866e:function(e,t){this.moveableShift_=!1,a.super_init(this,c.FormaStyle,c.FormaStyle.prototype.init_866e,e,t)},init_bf40:function(e,t,n,o,s,u,d){void 0===e&&(e="None"),void 0===t&&(t="Grid"),void 0===o&&(o=null),void 0===s&&(s=0),void 0===u&&(u=!0),void 0===d&&(d=l.CropType.PreserveFocus);var h={name:e,category:t,"grid-cells":n,spacing:s,"crop-type":d};if(null!=o){for(var p=[],f=a.iter(o);!f.done;f.next()){var m=f.key,g=f.value;p.push([m,g])}h[r.PROPERTY_FORMA_MAPPING]=a.clone(p)}this.moveableShift_=u,a.super_init(this,c.FormaStyle,c.FormaStyle.prototype.init_5afe,r.KIND,c.FormaStyle.OPACITY_DEFAULT,i.ColorTable.createDefault(),null,null,h)},className:{get:function(){return r.SCHEMA_CLASS_NAME}},didChangeState:function(e){null!=e[r.PROPERTY_FORMA_MAPPING]&&(this.formaMapping_=null),null!=e[r.PROPERTY_GRID_CELLS]&&(this.gridCells_=null),c.FormaStyle.prototype.didChangeState.call(this,e)},name:{get:function(){var e;return(e=a.as(this.get(r.PROPERTY_NAME),"String"))||null!=e?e:r.DEFAULT_NAME},set:function(e){this.set(r.PROPERTY_NAME,e)}},category:{get:function(){return a.as(this.get(r.PROPERTY_CATEGORY),"String")},set:function(e){this.set(r.PROPERTY_CATEGORY,e)}},ensureGridCells:function(){var e;if(null==this.gridCells_&&(this.gridCells_=[],(e=a.as(this.get(r.PROPERTY_GRID_CELLS),["Array","Any"]))&&e.length>0&&e[0]instanceof h.GridCell))for(var t=a.clone(e),n=a.iter(t);!n.done;n.next()){var o=n.value;a.opt(this.gridCells_,(function(e){return e.push(o)}))}},commitGridCells:function(){this.set(r.PROPERTY_GRID_CELLS,this.gridCells_)},gridCells:{get:function(){return this.ensureGridCells(),this.gridCells_}},setGridCells:function(e){this.gridCells_=a.clone(e),this.commitGridCells()},cellIndex:function(e){return a.opt(this.indexedCell(e,this.gridCells),(function(e){return e[0]}))},ensureFormaMapping:function(){var e;if(null==this.formaMapping_&&(this.formaMapping_={},(e=a.as(this.get(r.PROPERTY_FORMA_MAPPING),["Array","Any"]))&&e.length>0&&a.is(e[0],["Array","Any"])))for(var t=a.clone(e),n=a.iter(t);!n.done;n.next()){var o=n.value,i=a.as(o[0],"String"),s=a.as(o[1],h.GridCell);null!=i&&null!=s&&(this.formaMapping_[i]=s)}},commitFormaMapping:function(){for(var e=[],t=a.iter(this.formaMapping_);!t.done;t.next()){var n=t.key,o=t.value;e.push([n,o])}this.set(r.PROPERTY_FORMA_MAPPING,e)},formaMapping:{get:function(){return this.ensureFormaMapping(),this.formaMapping_}},setFormaMapping:function(e){this.formaMapping_=a.clone(e),this.commitFormaMapping()},indexedCell:function(e,t){for(var n=a.iter(a.toSequence(t));!n.done;n.next()){var r=n.value,o=r.offset,i=r.element;if(a.eq(h._equality_GridCell_GridCell,i,e))return[o,e]}return null},updateCell:function(e,t,n,r){var o;return void 0===t&&(t=null),void 0===n&&(n=null),void 0===r&&(r=null),null!=(o=this.indexedCell(e,this.gridCells))?this.updateCellByIndex(o[0],t,n,r):null},updateCellByIndex:function(e,t,n,r){void 0===t&&(t=null),void 0===n&&(n=null),void 0===r&&(r=null);var o=this.gridCells[e],i=this.gridCells[e].copyTo(t,n,r);if(!a.eq(h._equality_GridCell_GridCell,o,i)){for(var s=[],l=a.iter(this.formaMapping);!l.done;l.next()){var u=l.key,c=l.value;a.eq(h._equality_GridCell_GridCell,c,o)&&s.push(u)}this.ensureGridCells(),this.gridCells_[e]=i,this.commitGridCells(),this.ensureFormaMapping();for(var d=a.iter(s);!d.done;d.next())u=d.value,this.formaMapping_[u]=i;return this.commitFormaMapping(),i}return o},insertCell:function(e,t){this.ensureGridCells(),this.gridCells_.splice(t,0,e),this.commitGridCells()},removeCell:function(e){this.ensureGridCells();for(var t,n=[],r=a.iter(this.formaMapping);!r.done;r.next()){var o=r.key,i=r.value;a.eq(h._equality_GridCell_GridCell,e,i)&&n.push(o)}null!=(t=this.indexedCell(e,this.gridCells_))&&a.opt(this.gridCells_,(function(e){return e.splice(t[0],1)}));for(var s=a.iter(n);!s.done;s.next())o=s.value,a.removeKey(this.formaMapping_,o);this.commitFormaMapping(),this.commitGridCells()},mergeCell:function(e,t){var n;if(null!=(n=this.indexedCell(e,this.gridCells))){for(var r=[],o=a.iter(this.formaMapping);!o.done;o.next()){var i=o.key,s=o.value;a.eq(h._equality_GridCell_GridCell,e,s)&&r.push(i)}this.ensureGridCells(),this.gridCells_[n[0]]=n[1].mergeWith(t),this.commitGridCells(),this.ensureFormaMapping();for(var l=a.iter(r);!l.done;l.next())i=l.value,this.formaMapping_[i]=this.gridCells_[n[0]];return this.commitFormaMapping(),this.gridCells[n[0]]}return null},mapCellToForma:function(e,t){this.mapCellToFormaID(e.formaID,t)},mapCellToFormaID:function(e,t){this.ensureFormaMapping(),this.formaMapping_[e]=t,this.commitFormaMapping()},removeMappingToForma:function(e){this.removeMappingToFormaID(e.formaID)},removeMappingToFormaID:function(e){this.ensureFormaMapping(),a.removeKey(this.formaMapping_,e),this.commitFormaMapping()},replaceMappedForma:function(e,t){this.ensureFormaMapping();var n=a.removeKey(this.formaMapping_,e.formaID);this.formaMapping_[t.formaID]=n,this.commitFormaMapping()},cellForForma:function(e){var t;if(t=this.formaMapping[e.formaID])for(var n=a.iter(a.toSequence(this.gridCells));!n.done;n.next()){var r=n.value,o=r.offset,i=r.element;if(a.eq(h._equality_GridCell_GridCell,t,i))return[o,t]}return null},forma:{get:function(){return this.forma_},set:function(e){this.forma_=e}},colorTableSupportsRole:function(e){return e==i.ColorRole.FieldPrimary},cropType:{get:function(){var e;return l.CropType.toCaseValue((e=a.as(this.get(r.PROPERTY_CROP_TYPE),"Int"))||null!=e?e:l.CropType.PreserveFocus)},set:function(e){this.set(r.PROPERTY_CROP_TYPE,e)}},gridCellArray:{get:function(){return this.gridCells}},drawnGridCell:function(e,t){return t.evalRect(e.bounds).insetXY(this.spacing/2,this.spacing/2).rounded()},spacing:{get:function(){var e;return(e=a.as(this.get(r.PROPERTY_SPACING),"Double"))||null!=e?e:0},set:function(e){this.set(r.PROPERTY_SPACING,e)}},moveableShift:{get:function(){return this.moveableShift_},set:function(e){this.moveableShift_=e}},numCells:{get:function(){return this.gridCells.length}},numBackgroundCells:{get:function(){return this.nonOverlappingCells().length}},flipRegion:function(){for(var e=[],t=a.iter(this.gridCells);!t.done;t.next()){var n=t.value;e.push(n.flip())}var o=this.name.includes("-flip")?a.replaceAll(this.name,"-flip",""):this.name+"-flip",i=null!=this.category?this.category:r.DEFAULT_CATEGORY;return r.init_bf40(o,i,e)},removeFormaMapping:function(){this.formaMapping_={},this.commitFormaMapping()},anyOverlap:{get:function(){return this.overlappingCells().length>0}},overlappingIndices:function(){if(0==this.gridCells.length)return[];for(var e=[],t=a.iter(a.range(0,this.gridCells.length-1,!0));!t.done;t.next())for(var n=t.value,r=a.iter(a.range(n,this.gridCells.length-1,!0));!r.done;r.next()){var o=r.value;if(o>n){var i,s=this.gridCells[o];(i=this.gridCells[n].bounds.intersectionWith(s.bounds))&&i.area>.01&&!e.includes(o)&&e.push(o)}}return e},overlappingCells:function(){var e=this;return this.overlappingIndices().map((function(t){return e.gridCells[t]}),this)},nonOverlappingCells:function(){return this.enumeratedNonOverlappingCells().map((function(e){return e[1]}),this)},enumeratedNonOverlappingCells:function(){for(var e=a.clone(this.overlappingIndices()),t=[],n=a.iter(a.toSequence(this.gridCells));!n.done;n.next()){var r=n.value,o=r.offset,i=r.element;e.includes(o)||t.push([o,i])}return t},fork:function(e){return c.FormaStyle.prototype.fork.call(this,e)},match:function(e){var t;if(t=a.as(e,r)){if(null==this.forma||null==t.forma||null==this.forma.root)return void f.LegacyCoreAssert.fail("Serious error in grid style. Not pointing to correct forma",void 0,"GridStyle.match","GridStyle.swift",419);if(this.forma.controller.kind!=d.GridController.KIND||t.forma.controller.kind!=d.GridController.KIND)return void f.LegacyCoreAssert.fail("Error: Not matching grids.",void 0,"GridStyle.match","GridStyle.swift",424);a.keys(this.formaMapping).length>0&&f.LegacyCoreAssert.isTrue(null!=this.forma,"missing forma",void 0,"GridStyle.match","GridStyle.swift",429),a.keys(t.formaMapping).length>0&&f.LegacyCoreAssert.isTrue(null!=t.forma,"missing forma",void 0,"GridStyle.match","GridStyle.swift",432),this.name=t.name,this.spacing=t.spacing,this.moveableShift=t.moveableShift,this.cropType=t.cropType,this.category=t.category;for(var n=[],o={},i=a.iter(t.gridCells);!i.done;i.next()){var l=i.value;n.push(l)}if(null!=this.forma){for(var c,m=[],y=[],_=a.iter(a.keys(this.formaMapping));!_.done;_.next()){var T=_.value;l=this.formaMapping[T],null!=(v=a.opt(this.forma,(function(e){return e.page.formaByID(T)})))&&v.isBackgroundImage()&&m.push(l)}for(var C=a.iter(a.keys(t.formaMapping));!C.done;C.next()){var v;T=C.value,l=t.formaMapping[T],null!=(v=a.opt(t.forma,(function(e){return e.page.formaByID(T)})))&&v.isBackgroundImage()&&y.push(l)}if(null!=this.forma&&(c=a.as(t.forma.controller,d.GridController))){var P=a.clone(c.gridStyle.gridCells),S=a.clone(t.forma.filterByKind(u.FrameForma.KIND));if(m.length>1&&1==P.length&&S.length<=1&&P[0].bounds.equalWithAccuracy(g.TheoRect.ONE_BY_ONE,h.GridCell.BOUNDS_ACCURACY))return}for(var A=function(e,t){return e.bounds.minY<t.bounds.minY||!(e.bounds.minY>t.bounds.minY)&&e.bounds.minX<t.bounds.minX},D=a.sort(m,A),E=a.sort(y,A),R=a.clone(t.overlappingCells()),F=a.clone(t.nonOverlappingCells()),I=a.iter(this.forma.visitAsArray(s.FormaTraversal.JustChildren));!I.done;I.next()){var b=I.value;if(T=b.formaID,b.isBackgroundImage()){if(D.length>0)for(var O=a.iter(a.range(0,D.length-1,!0));!O.done;O.next()){var k=O.value,M=D[k];a.eq(h._equality_GridCell_GridCell,this.formaMapping[T],M)&&E.length>0&&(o[T]=E[Math.min(k,E.length-1)])}if(null==o[T]&&(M=this.formaMapping[T]))for(var N=0,L=a.iter(F);!L.done;L.next()){var x;(x=(l=L.value).bounds.intersectionWith(M.bounds))&&x.area>N&&(N=x.area,o[b.formaID]=l)}}else if(b.isTypeLockup()&&R.length>0)o[T]=R[0];else{var B,w,G;null!=(B=b.contentID)&&(w=a.opt(a.opt(t.forma,(function(e){return e.root})),(function(e){return e.formaByContentID(B)})))&&(G=t.formaMapping[w.formaID])&&(o[b.formaID]=G)}}}for(var Y=[],U=a.iter(a.keys(t.formaMapping));!U.done;U.next()){var V;if(T=U.value,l=t.formaMapping[T],null!=this.forma&&a.opt(this.forma,(function(e){return null!=e.root}))){if(V=a.opt(this.forma,(function(e){return e.page.formaByID(T)}))){var j,H=!0;(j=a.as(a.opt(this.forma,(function(e){return e.controller})),d.GridController))&&(H=!j.isGridCell(V)||!V.isShape()),H&&(o[T]=l)}}else o[T]=l;null==this.indexedCell(l,Y)&&Y.push(l)}this.setGridCells(n.concat()),this.removeFormaMapping();var W={};a.each(o,(function(e,t){W[e]=t})),this.gridCells.length<Y.length&&p.Host.logging.info("cells "+this.gridCells.length+" mapped "+Y);for(var K=a.iter(a.keys(W));!K.done;K.next())T=K.value,l=W[T],null==this.forma.page.formaByID(T)?(f.LegacyCoreAssert.fail("shouldn't point to a forma which isn't a child",void 0,"GridStyle.match","GridStyle.swift",595),a.opt(this.forma,(function(e){return null==e.page.formaByID(T)}))&&f.LegacyCoreAssert.fail("we're really borked. pointing a forma which isn't in the forma tree",void 0,"GridStyle.match","GridStyle.swift",598),a.removeKey(W,T)):null==this.indexedCell(l,this.gridCells)&&(f.LegacyCoreAssert.fail("shouldn't point to a cell which isn't part of the grid.",void 0,"GridStyle.match","GridStyle.swift",605),a.removeKey(W,T));this.formaMapping_=a.clone(W),this.commitFormaMapping()}},postCloneMatch:function(e){if(null!=this.forma&&null!=e.forma&&null!=this.forma.root)for(var t=a.clone(e.forma.visitAsArray(s.FormaTraversal.JustChildren)),n=a.keys(e.formaMapping),r=a.iter(n);!r.done;r.next()){var o,i=r.value,l=e.formaMapping[i];if(o=a.opt(this.forma,(function(e){return e.page.formaByID(i)}))){e.ensureFormaMapping();for(var u=a.iter(t);!u.done;u.next()){var c=u.value;o.frame.equalWithAccuracy(c.frame,.01)&&(e.formaMapping_[c.formaID]=l,a.removeKey(e.formaMapping_,i))}e.commitFormaMapping()}}else f.LegacyCoreAssert.fail("Serious error in grid style. Not pointing to correct forma",void 0,"GridStyle.postCloneMatch","GridStyle.swift",620)},equals:function(e){return this.name==e.name&&this.geometricEquals(e)},geometricEquals:function(e){if(this.gridCells.length!=e.gridCells.length)return!1;for(var t=a.sort(this.gridCells,(function(e,t){return e.bounds.center.distanceTo(m.TheoPoint.ZERO)<t.bounds.center.distanceTo(m.TheoPoint.ZERO)})),n=a.sort(e.gridCells,(function(e,t){return e.bounds.center.distanceTo(m.TheoPoint.ZERO)<t.bounds.center.distanceTo(m.TheoPoint.ZERO)})),r=a.iter(a.range(0,t.length-1,!0));!r.done;r.next()){var o,i=r.value;if(!(o=t[i].bounds.intersectionWith(n[i].bounds)))return!1;if(Math.abs((o.area-t[i].bounds.area)/o.area)>.02)return!1}return!0},similarity:function(e){if(this.numCells!=e.numCells)return 1;for(var t=a.sort(this.gridCells,(function(e,t){return e.bounds.center.distanceTo(m.TheoPoint.ZERO)<t.bounds.center.distanceTo(m.TheoPoint.ZERO)})),n=a.sort(e.gridCells,(function(e,t){return e.bounds.center.distanceTo(m.TheoPoint.ZERO)<t.bounds.center.distanceTo(m.TheoPoint.ZERO)})),r=[],o=a.iter(a.range(0,t.length-1,!0));!o.done;o.next()){var i=o.value;r.push(t[i].bounds.similarity(n[i].bounds))}return r.reduce((function(e,t){return e+t}),0)/a.toDouble(r.length)},insetBackgroundCells:function(e){for(var t=a.iter(this.enumeratedNonOverlappingCells());!t.done;t.next()){var n,r=t.value;(n=r[1].bounds.intersectionWith(e))&&this.updateCellByIndex(r[0],n)}},setCellBounds:function(e,t){null!=this.gridCells_&&a.containsEq(this.gridCells_,e,h._equality_GridCell_GridCell)&&(e.bounds=t,this.commitGridCells())},asString:{get:function(){return this.name}}}}),r)},"5XIA":function(e,t,n){var r,o,a=t,i=n("oAGj"),s=n("9oQN"),l=n("T6jX"),u=n("9BFu");a.PageResizeScore=(r=function e(t){this.rejectThreshold=-1,this.overlapInitial_={},this.outOfBoundsInitial_={},this.alignmentInitial_={},this.root_=t,this.floating_=i.clone(this.root_.filterWithCallback((function(e){return null!=e.controller&&e.controller.floating}))),this.floating_.length>2*l.TheoDocumentUtils.DESIGN_COMPLEXITY_HEURISTIC_THRESHOLD&&(this.floating_=this.floating_.slice(0,2*l.TheoDocumentUtils.DESIGN_COMPLEXITY_HEURISTIC_THRESHOLD)),u.WeightedScore.call(this,e.Features.NUM_FEAT),this.initFeatures()},o={},i.defineClass({name:"PageResizeScore",ctor:r,superName:"WeightedScore",statics:{Features:{get:function(){return void 0===o.Features&&(o.Features=i.defineEnum("Features",{TEXT_OVERLAP:1,FLOATING_ELEMENT_OVERLAP:2,TEXT_FLOATING_OVERLAP:3,OUT_OF_BOUNDS:4,INCORRECT_TEXT_ALIGNMENT:5,NUM_FEAT:6})),o.Features}},_implements:function(e){return"DocumentEvaluationScore"==e}},props:{initFeatures:function(){this.setFeatureName(r.Features.TEXT_OVERLAP,"Text Overlap"),this.setFeatureName(r.Features.FLOATING_ELEMENT_OVERLAP,"Floating Elements Overlap"),this.setFeatureName(r.Features.TEXT_FLOATING_OVERLAP,"Text Forma Overlapping floating"),this.setFeatureName(r.Features.OUT_OF_BOUNDS,"Out of bounds"),this.setFeatureName(r.Features.INCORRECT_TEXT_ALIGNMENT,"Broken Text Alignments"),this.setWeight(r.Features.TEXT_OVERLAP,-20),this.setWeight(r.Features.FLOATING_ELEMENT_OVERLAP,-10),this.setWeight(r.Features.TEXT_FLOATING_OVERLAP,-10),this.setWeight(r.Features.OUT_OF_BOUNDS,-10),this.setWeight(r.Features.INCORRECT_TEXT_ALIGNMENT,-1),this.setFeature(r.Features.TEXT_OVERLAP,0),this.setFeature(r.Features.FLOATING_ELEMENT_OVERLAP,0),this.setFeature(r.Features.TEXT_FLOATING_OVERLAP,0),this.setFeature(r.Features.OUT_OF_BOUNDS,0),this.setFeature(r.Features.INCORRECT_TEXT_ALIGNMENT,0),this.overlapInitial_=i.clone(s.EvaluationUtils.getFormaOverlap(this.floating_)),this.outOfBoundsInitial_=i.clone(s.EvaluationUtils.getFormaOutOfBounds(this.floating_)),this.alignmentInitial_=i.clone(s.EvaluationUtils.getFormaAlignment(this.floating_))},evaluateDocument:function(){var e=s.EvaluationUtils.evaluateOutOfBounds(this.floating_,this.outOfBoundsInitial_,s.EvaluationUtils.getFormaOutOfBounds(this.floating_)),t=s.EvaluationUtils.evaluateAlignment(this.floating_,this.alignmentInitial_,s.EvaluationUtils.getFormaAlignment(this.floating_)),n=s.EvaluationUtils.evaluateOverlap(this.floating_,this.overlapInitial_,s.EvaluationUtils.getFormaOverlap(this.floating_)),o=n.textOverlap,a=n.graphicOverlap,i=n.graphicTextOverlap;this.setFeature(r.Features.OUT_OF_BOUNDS,e),this.setFeature(r.Features.INCORRECT_TEXT_ALIGNMENT,t),this.setFeature(r.Features.TEXT_OVERLAP,o),this.setFeature(r.Features.FLOATING_ELEMENT_OVERLAP,a),this.setFeature(r.Features.TEXT_FLOATING_OVERLAP,i)},print:function(){return this.asString},reject:function(){return this.score<this.rejectThreshold},evalScore:function(){return this.score}}}),r)},"5ex8":function(e,t,n){var r,o,a=t,i=n("oAGj"),s=n("6ZWm"),l=n("cmoc"),u=n("7Pku"),c=n("w/+j"),d=n("fdtz"),h=n("lmwz"),p=n("fNpk"),f=n("tGKA"),m=n("Ird5"),g=n("jLWG"),y=n("jfma"),_=n("dmHI"),T=n("vTQu"),C=n("yjxF"),v=n("Aj79"),P=n("Ucb9"),S=n("g6aL"),A=n("Zifs"),D=n("djAF"),E=n("3HaQ"),R=n("hgLm"),F=n("oKlP");a.FrameFormaToPGMMapper=(r=function e(){u.FormaToPGMMapper.call(this,e.FORMA_KIND)},o={},i.defineClass({name:"FrameFormaToPGMMapper",ctor:r,superName:"FormaToPGMMapper",statics:{FORMA_KIND:{get:function(){return void 0===o.FORMA_KIND&&(o.FORMA_KIND=l.FrameForma.KIND),o.FORMA_KIND}},instance:{get:function(){return void 0===o.instance&&(o.instance=new r),o.instance}},createMapper:function(e){return r.instance}},props:{frameHasFillColor:function(e){var t,n;return!(!(t=i.as(e,l.FrameForma))||!(n=i.as(t.controller,s.FrameController)))&&n.hasCutout},makePGMRef:function(e,t,n,r){var o,a,I;if((o=i.as(e,l.FrameForma))&&(a=n.childReferences(o))&&(I=o.bounds)){var b,O,k=null,M=o.formaID,N=new C.PGMNodeMetadata(o.formaID,"frame"),L=m.PGMAnimationList.EMPTY,x=this.frameHasFillColor(e),B=o.style.opacity,w=y.PGMBlendModeEnum.Normal;if(x){var G,Y=o.style.colors.fieldPrimary||A.SolidColor.ZERO,U=new R.TheoRectanglePath(I);(G=h.ImageFacade.getImageFormaForForma(o))&&(B=G.style.opacity),k=new v.PGMReference(new P.PGMShape(o.formaID+"-background",new C.PGMNodeMetadata(o.formaID,"background"),m.PGMAnimationList.EMPTY,I,[U],Y)),a.splice(0,0,k)}if(w=u.FormaToPGMMapper.mapBlendMode(o),O=h.ImageFacade.getMaskFormaForForma(o)){var V,j;if(V=i.as(O,D.ShapeForma))b=new S.PGMSimpleGroup(M,N,L,[E.ShapeFormaToPGMMapper.applyPathAsClip(t,V,e,a,V.formaID)]);else{if(!(j=i.as(O,d.ImageForma)))return p.LegacyCoreAssert.fail("child reference generation failed for frame: unknown mask type",void 0,"FrameFormaToPGMMapper.makePGMRef","FrameFormaToPGMMapper.swift",150),null;var H,W;if(!(H=n.referenceForForma(j)))return p.LegacyCoreAssert.fail("child reference generation failed for frame: no image?",void 0,"FrameFormaToPGMMapper.makePGMRef","FrameFormaToPGMMapper.swift",145),null;W=1==a.length?a[0]:new v.PGMReference(new S.PGMSimpleGroup(M+"-children-group",N,L,a));var K,X=f.Matrix2D.calculateResizeTransform(j.bounds,o.bounds,F.TheoPoint.ZERO,s.FitType.Stretch),z=H.withPlacement(X);b=new _.PGMFilter(M,N,L,[W,z],new T.PGMMaskFilterSpec),(K=k)&&(b=new S.PGMSimpleGroup(M,N,L,[K,new v.PGMReference(b)]))}}else{var q,Z=!1,J=new R.TheoRectanglePath(o.bounds);(q=i.as(o.controller,s.FrameController))&&(Z=q.clip),b=Z?new g.PGMClip(M,N,L,a,[J]):new S.PGMSimpleGroup(M,N,L,a)}return c.FormaToPGMUtils.applyAnimations(t,e,new v.PGMReference(b,new y.PGMCompositingParams(o.placement,B,w)))}return p.LegacyCoreAssert.fail("frame forma child reference generation failed",void 0,"FrameFormaToPGMMapper.makePGMRef","FrameFormaToPGMMapper.swift",185),null}}}),r)},"6Rk9":function(e,t,n){var r,o=t,a=n("oAGj"),i=n("gXiO"),s=n("tGKA"),l=n("MnRR"),u=n("8t9B"),c=n("oKlP"),d=n("sIWg");o.GeometryFacade=(r=function(){i.CoreObject.call(this)},a.defineClass({name:"GeometryFacade",ctor:r,superName:"CoreObject",statics:{getFormaeBounds:function(e,t){void 0===t&&(t=!1);var n=d.TheoRect.Zero;if(e.length>0)if(t){var r=e.map((function(e){return e.controller.getUserPerceivedFrame()}),this);n=r.reduce((function(e,t){return e.unionWith(t)}),r[0])}else{var o=e[0];n=e.reduce((function(e,t){return e.unionWith(t.finalFrame)}),o.finalFrame)}return n},unionFrame:function(e,t){if(void 0===t&&(t=null),0==e.length)return null;for(var n=t||e[0].parent,r=null,o=a.iter(e);!o.done;o.next()){for(var i=o.value,s=i.placement,l=i.parent;null!=l&&l!=n;)s=s.concat(l.placement),l=a.opt(l,(function(e){return e.parent}));var u=i.boundsInCoordSpace(s);r=null==r?u:r.unionWith(u)}return r},polyFromFormaBounds:function(e){var t=e.bounds||d.TheoRect.Zero,n=[t.evalXY(0,0),t.evalXY(1,0),t.evalXY(1,1),t.evalXY(0,1)];return e.totalPlacement.transformPoints(n)},formaBoundsIntersect:function(e,t){var n=a.clone(r.polyFromFormaBounds(e)),o=a.clone(r.polyFromFormaBounds(t)),i=[];i.push(n),i.push(o);for(var s=a.iter(i);!s.done;s.next())for(var l=s.value,u=a.iter(a.toSequence(l));!u.done;u.next()){for(var d=u.value,h=d.offset,p=d.element,f=l[(h+1)%l.length],m=new c.TheoPoint(f.y-p.y,p.x-f.x),g=null,y=null,_=a.iter(n);!_.done;_.next()){var T=_.value,C=m.x*T.x+m.y*T.y;(null==g||C<g)&&(g=C),(null==y||C>y)&&(y=C)}for(var v=null,P=null,S=a.iter(o);!S.done;S.next()){var A=S.value,D=m.x*A.x+m.y*A.y;(null==v||D<v)&&(v=D),(null==P||D>P)&&(P=D)}if(null!=y&&null!=v&&y<v)return!1;if(null!=P&&null!=g&&P<g)return!1}return!0},getIntersectionPolygon:function(e,t,n,o){var a=[];return r.getEdgeIntersections(e,t,n,o,a),r.getCornersInsideOtherRect(e,t,n,o,a),r.getCornersInsideOtherRect(t,e,o,n,a),a},getEdgeIntersections:function(e,t,n,o,i){for(var s=[e.horizontalLine(0).transform(n),e.horizontalLine(1).transform(n),e.verticalLine(0).transform(n),e.verticalLine(1).transform(n)],l=[t.horizontalLine(0).transform(o),t.horizontalLine(1).transform(o),t.verticalLine(0).transform(o),t.verticalLine(1).transform(o)],u=a.iter(s);!u.done;u.next())for(var c=u.value,d=a.iter(l);!d.done;d.next()){var h,p=d.value;if(h=c.intersection(p)){var f=c.locate(h),m=p.locate(h);f>=-.001&&f<=1.001&&m>=-.001&&m<=1.001&&r.appendPoint(h,i)}}},getCornersInsideOtherRect:function(e,t,n,o,i){for(var l=s._asterisk_Matrix2D_Matrix2D(o,n.inverse),u=a.clone(t.points),c=a.iter(u);!c.done;c.next()){var d=c.value;e.containsPoint(l.transformPoint(d))&&r.appendPoint(o.transformPoint(d),i)}},appendPoint:function(e,t){for(var n=a.iter(t);!n.done;n.next())if(n.value.distanceTo(e)<.01)return;t.push(e)},areaOfConvexPolygon:function(e){if(e.length<3)return 0;for(var t=a.clone(r.sortConvexPolygonVertices(e)),n=0,o=0,i=a.iter(a.toSequence(t));!i.done;i.next()){var s=i.value,l=s.offset,u=s.element,c=t[(l+1)%t.length].y;n+=u.x*c;var d=t[(l+1)%t.length].x;o+=u.y*d}return(n-o)/2},centerOfPolygon:function(e){return 0==e.length?c.TheoPoint.ZERO:e.reduce((function(e,t){return c._plus_TheoPoint_TheoPoint(e,t)}),c.TheoPoint.ZERO).divide(a.toDouble(e.length))},sortConvexPolygonVertices:function(e){if(0==e.length)return e;var t=r.centerOfPolygon(e),n=new l.TheoLine(t,c._plus_TheoPoint_TheoPoint(t,new c.TheoPoint(100,0)));return a.sort(e,(function(e,r){return new l.TheoLine(t,e).angleWith(n)>new l.TheoLine(t,r).angleWith(n)}))},getClosestPin:function(e,t){for(var n,r=[[.5,.5],[.5,0],[.5,1],[0,.5],[1,.5],[0,0],[0,1],[1,0],[1,1]],o=null,i=1/0,s=a.iter(r);!s.done;s.next()){var l=s.value,u=e.evalXY(l[0],l[1]),d=t.evalXY(l[0],l[1]),h=u.distanceTo(d);h<i&&(i=h,o=l)}var p=(n=o)||null!=n?n:r[0];return new c.TheoPoint(p[0],p[1])},getScaleToFit:function(e,t,n){if(e.outsetXY(1,1).containsPoint(n)&&t.outsetXY(1,1).containsPoint(n)){var o,a,i,s,l=1/0;return null!=(o=r.getScaleToFitOneDim(e.minX,t.minX,n.x))&&(l=Math.min(l,o)),null!=(a=r.getScaleToFitOneDim(e.maxX,t.maxX,n.x))&&(l=Math.min(l,a)),null!=(i=r.getScaleToFitOneDim(e.minY,t.minY,n.y))&&(l=Math.min(l,i)),null!=(s=r.getScaleToFitOneDim(e.maxY,t.maxY,n.y))&&(l=Math.min(l,s)),l}return null},getScaleToFitOneDim:function(e,t,n){var r=Math.abs(e-n);return r<.1?null:Math.abs(t-n)/r},NEEDS_FITTING_MAX_INITIAL_RATIO:1.1,NEEDS_FITTING_MIN_NEW_RATIO:1.5,FIT_IN_PAGE_MARGIN:10,fitInPage:function(e,t,n,o,i,s){var l,h,p,f,m;if(void 0===t&&(t=null),void 0===n&&(n=c.TheoPoint.ZERO),void 0===o&&(o=r.FIT_IN_PAGE_MARGIN),void 0===i&&(i=r.NEEDS_FITTING_MAX_INITIAL_RATIO),void 0===s&&(s=r.NEEDS_FITTING_MIN_NEW_RATIO),(p=e.root)&&(f=e.controller)&&(m=e.finalFrame)){var g=d.TheoRect.fromSize(e.page.pageSize).insetXY(o,o),y=g.width,_=g.height,T=((l=a.opt(t,(function(e){return e.width})))||null!=l?l:0)<y*i,C=((h=a.opt(t,(function(e){return e.height})))||null!=h?h:0)<_*i;if(T&&m.width>y*s||C&&m.height>_*s){var v=Math.min(y/m.width,1),P=Math.min(_/m.height,1);f.maintainAspectRatio&&(v=Math.min(v,P),P=v),e.bounds=a.opt(e.bounds,(function(e){return e.scaleXY(v,P,n)})),a.opt(a.as(f,u.TypeLockupController),(function(e){return e.snapSizeToBounds()}))}f.preventOutofBounds(p,g)}}}}),r)},"6Tzw":function(e,t,n){var r,o=t,a=n("oAGj"),i=n("0wFF"),s=n("gXiO"),l=n("FNB+"),u=n("9Lk3"),c=n("iCxV"),d=n("sIWg");o.MultiSelectUIMode=a.defineEnum("MultiSelectUIMode",{ModeWithAutoDismissAfterOneTap:0,ModeRequiresExplicitDismiss:1}),o.SelectionFacade=(r=function(){s.CoreObject.call(this)},a.defineClass({name:"SelectionFacade",ctor:r,superName:"CoreObject",statics:{isMultiSelect:function(e){var t;return!(!((t=e)&&t.selectedCount>1)||t.inCharStyleMode)},isGroupSelect:function(e){var t,n;return!(!(n=e)||1!=n.selectedCount||!(t=a.opt(a.opt(n.formaAt(0),(function(e){return e.controller})),(function(e){return e.userGroupMember})))&&null==t||!t)},isCharStyleSelection:function(e){var t,n,r;return!!((t=e)&&t.selectedCount>1&&(n=t.formaAt(0))&&(r=t.formaAt(1)))&&(n.isTypeLockup()&&r.isText())},getMultiSelectUIMode:function(){return o.MultiSelectUIMode.ModeRequiresExplicitDismiss},enableAdditionalMultiSelectGestures:function(){return!1},selectFormae:function(e){var t;if(e.length>0&&(t=a.opt(a.opt(a.opt(a.first(e),(function(e){return e.page.document})),(function(e){return e.controller})),(function(e){return e.selection})))){var n=t.selectedCount;t.selectFormae(e);for(var r=a.iter(t.asFormaArray());!r.done;r.next()){var o,s=r.value;(o=a.opt(s.controller,(function(e){return e.userGroupRoot})))&&(t.deselectForma(s),t.selectForma(o))}var l=t.selectedCount;if(l>1){for(var u=a.iter(t.asFormaArray());!u.done;u.next())s=u.value,a.opt(s.controller,(function(e){return 0==e.canMultiSelect}))&&t.deselectForma(s);a.opt(c.Host.logging,(function(e){return e.logToAnalytics(i.AnalyticsConstants.kAnalyticsDataSelectionMultiple,{contextualData1:"oldSelectedCount:"+n,contextualData2:"newSelectedCount:"+l})}))}}},replaceSelectionWithFormae:function(e){var t;if(e.length>0&&(t=a.opt(a.opt(a.opt(a.first(e),(function(e){return e.page.document})),(function(e){return e.controller})),(function(e){return e.selection})))){var n=e.filter((function(e){return a.opt(e.controller,(function(e){return 1==e.canMultiSelect}))}),this);t.replaceSelectionWithFormae(n)}},deselectFormae:function(e){var t;if(e.length>0&&(t=a.opt(a.opt(a.opt(a.first(e),(function(e){return e.page.document})),(function(e){return e.controller})),(function(e){return e.selection})))){t.deselectFormae(e);for(var n=a.iter(e);!n.done;n.next()){var r,o=n.value;(r=a.opt(o.controller,(function(e){return e.userGroupRoot})))&&t.deselectForma(r)}}},canSelectParent:function(e){var t;return!!((t=a.opt(a.opt(e.document,(function(e){return e.controller})),(function(e){return e.selection})))&&t.selectedCount>=1&&t.formaAt(0))},selectParent:function(e){var t;if(t=a.opt(a.opt(e.document,(function(e){return e.controller})),(function(e){return e.selection}))){var n,o,i;if(1==t.selectedCount&&(n=t.formaAt(0))&&(o=n.parent)&&(i=o.controller)&&i.kind!=u.GridController.KIND&&i.selectable)return void t.replaceSelection(i.forma);r.deselectAllOnPage(e)}},canSelectChild:function(e){var t,n,r;if((n=a.opt(a.opt(e.document,(function(e){return e.controller})),(function(e){return e.selection})))&&1==n.selectedCount&&(r=n.formaAt(0))&&r.controller)for(var o=a.iter(r.visitAsArray(l.FormaTraversal.JustChildren));!o.done;o.next()){var i=o.value;if(((t=a.opt(i.controller,(function(e){return e.selectable})))||null!=t)&&t&&a.opt(i.controller,(function(e){return e.kind!=u.GridController.KIND})))return!0}return!1},selectChild:function(e){var t,n,r;if((n=a.opt(a.opt(e.document,(function(e){return e.controller})),(function(e){return e.selection})))&&1==n.selectedCount&&(r=n.formaAt(0))&&r.controller)for(var o=a.iter(r.visitAsArray(l.FormaTraversal.JustChildren));!o.done;o.next()){var i=o.value;((t=a.opt(i.controller,(function(e){return e.selectable})))||null!=t)&&t&&n.replaceSelection(i)}},canSelectSibling:function(e){var t,n,r,o,i=this;return!!((t=a.opt(a.opt(e.document,(function(e){return e.controller})),(function(e){return e.selection})))&&1==t.selectedCount&&(n=t.formaAt(0))&&(r=n.controller)&&(o=a.opt(r.getSiblingFormae(),(function(e){return e.filter((function(e){return a.opt(e.controller,(function(e){return 1==e.selectable}))}),i)}))))&&o.length>1},selectSibling:function(e,t){void 0===t&&(t=!0);var n,r,o,i,s,u=this;if((n=a.opt(a.opt(e.document,(function(e){return e.controller})),(function(e){return e.selection})))&&1==n.selectedCount&&(r=n.formaAt(0))&&(o=r.controller)&&(i=a.opt(o.getSiblingFormae(),(function(e){return e.filter((function(e){return a.opt(e.controller,(function(e){return 1==e.selectable}))}),u)})))&&null!=(s=a.indexOfEq(i,r,l._equality_Forma_Forma))){var c=(s+(t?1:-1))%i.length;c<0&&(c=i.length-1);var d=i[c];n.replaceSelection(d)}},marqueeSelectFormae:function(e,t){var n;if(e.length>0&&(n=a.opt(a.opt(a.opt(a.first(e),(function(e){return e.page.document})),(function(e){return e.controller})),(function(e){return e.selection})))){for(var o=!0,i=a.iter(e);!i.done;i.next()){var s=i.value;if(!n.isSelected(s)&&!n.isGroupSelected(s)){o=!1;break}}o&&(t||c.Host.platform.isMobile)?r.deselectFormae(e):t||c.Host.platform.isMobile?r.selectFormae(e):r.replaceSelectionWithFormae(e)}},deselectAllOnPage:function(e){var t;(t=a.opt(a.opt(e.document,(function(e){return e.controller})),(function(e){return e.selection})))&&t.clearSelection(!0)},selectAllOnPage:function(e){var t;if(t=a.opt(a.opt(e.document,(function(e){return e.controller})),(function(e){return e.selection}))){var n=t.selectedCount;t.clearSelectionNoUpdate();var o=a.clone(e.selectableFormaeIntersectingRect(d.TheoRect.Huge));r.selectFormae(o);var s=t.selectedCount;a.opt(c.Host.logging,(function(e){return e.logToAnalytics(i.AnalyticsConstants.kAnalyticsDataSelectionSelectAll,{contextualData1:"oldSelectedCount:"+n,contextualData2:"newSelectedCount:"+s})}))}},getSelectionBounds:function(e){var t,n=d.TheoRect.Zero;return(t=a.opt(a.opt(e.document,(function(e){return e.controller})),(function(e){return e.selection})))&&(n=t.getSelectionBounds()),n}}}),r)},"6azk":function(e,t,n){var r,o,a,i=t,s=n("oAGj"),l=n("gXiO"),u=n("WF+G"),c=n("ZhwN"),d=n("fNpk");i.MiniDocumentBranch=(r=function(e){this.root_=new i.MiniDocumentNode(e,null)},s.defineClass({name:"MiniDocumentBranch",ctor:r,superName:"CoreObject",statics:{_implements:function(e){return"HostDocumentBranch"==e}},props:{root:{get:function(){return this.root_}},id:{get:function(){return this.root.nodeId}},allComponents:{get:function(){var e=[];return this.root_.findComponent((function(t){return e.push(t),!1})),e}},getValue:function(e){return this.root_.getValue(e)},setValue:function(e,t){this.root.setValue(e,t)},appendNode:function(e,t,n){return(n||this.root_).appendNode(e,t)},removeNode:function(e){this.root_.removeNode(e)},getNodeWithAbsolutePath:function(e){return this.root_.find((function(t){return t.getAbsolutePath().asString==e}))},getChildrenOfNode:function(e){return e.children},getComponentsOfNode:function(e){return e.components},getComponentWithId:function(e){return this.root_.findComponent((function(t){return t.componentId==e}))},getPathForComponent:function(e){return e.sourceFile},getComponentWithAbsolutePath:function(e){return this.root_.findComponent((function(t){return t.absolutePath.asString==e}))},addComponent:function(e,t,n,r,o,a,i,s,l){return a.addComponent(e,t,n,r,o,i)},moveComponent:function(e,t){return t.moveComponent(e)},updateComponent:function(e,t,n){var r;return(r=s.as(e,i.MiniDocumentComponent))?(null!=t&&(r.sourceFile=t),r):(d.LegacyCoreAssert.fail("Not a Core component",void 0,"MiniDocumentBranch.updateComponent","MiniDocumentBranch.swift",97),null)},transferEncodingTo:function(e){this.root_.transferEncodingTo(e);for(var t=s.iter(this.root_.components);!t.done;t.next()){var n=t.value;e.appendComponent(n.componentId,n.sourceFile,n.type)}}}}),r),i.MiniDocumentNode=(o=function(e,t){var n;this.parent_=null,this.props_={},this.children_=[],this.components_=[],l.CoreObject.call(this),this.setValue("id",s.as((n=e)||null!=n?n:c.GUIDUtils.makeGUID(),"AnyObject")),this.path=t},s.defineClass({name:"MiniDocumentNode",ctor:o,superName:"CoreObject",statics:{_implements:function(e){return"HostDocumentNode"==e}},props:{path:{get:function(){return s.as(this.props_.path,"String")},set:function(e){null==e?s.removeKey(this.props_,"path"):this.props_.path=s.as(e,"AnyObject")}},nodeId:{get:function(){var e;return(e=s.as(this.props_.id,"String"))||null!=e?e:""}},getValue:function(e){return this.props_[e]},setValue:function(e,t){null==t?s.removeKey(this.props_,e):this.props_[e]=t},removeValue:function(e){s.removeKey(this.props_,e)},appendNode:function(e,t){var n=new o(e,t);return this.children_.push(n),n.parent_=this,n},removeNode:function(e){var t;(t=s.as(e,o))?t.parent_!==this?d.LegacyCoreAssert.fail("Can't remove a non-child node",void 0,"MiniDocumentNode.removeNode","MiniDocumentBranch.swift",167):(s.remove(this.children_,t),t.parent_=null):d.LegacyCoreAssert.fail("Not a Core node",void 0,"MiniDocumentNode.removeNode","MiniDocumentBranch.swift",173)},children:{get:function(){return this.children_}},components:{get:function(){return this.components_}},addComponent:function(e,t,n,r,o,a){var s=new i.MiniDocumentComponent(e,t,n,r,o,a);return s.node=this,this.components_.push(s),s},moveComponent:function(e){var t,n;return(t=s.as(e,i.MiniDocumentComponent))?((n=t.node)&&s.remove(n.components_,t),this.components_.push(t),t.node=this,t):(d.LegacyCoreAssert.fail("Not a Core component",void 0,"MiniDocumentNode.moveComponent","MiniDocumentBranch.swift",206),null)},getAbsolutePath:function(){var e=s.opt(this.parent_,(function(e){return e.getAbsolutePath()}))||u.CorePath.ROOT;return null==this.path?e:e.appendPart(this.path)},find:function(e){if(e(this))return this;for(var t=s.iter(this.children);!t.done;t.next()){var n;if(n=t.value.find(e))return n}return null},findComponent:function(e){for(var t=s.iter(this.components);!t.done;t.next()){var n=t.value;if(e(n))return n}for(var r=s.iter(this.children);!r.done;r.next()){var o;if(o=r.value.findComponent(e))return o}return null},transferEncodingTo:function(e){for(var t=s.iter(this.props_);!t.done;t.next()){var n=t.key,r=t.value;e.setManifestProperty(n,r,!1)}for(var o=s.iter(this.children);!o.done;o.next()){var a=o.value,i=e.findChild(a.path)||e.appendChild(a.nodeId);a.transferEncodingTo(i)}}}}),o),i.MiniDocumentComponent=(a=function(e,t,n,r,o,a){var i;this.node=null,this.componentId="",this.name=null,this.etag=null,this.relationship=null,this.name=e,this.componentId=(i=t)||null!=i?i:c.GUIDUtils.makeGUID(),this.type=n,this.relationship=r,this.path=o,this.sourceFile=a,l.CoreObject.call(this)},s.defineClass({name:"MiniDocumentComponent",ctor:a,superName:"CoreObject",statics:{_implements:function(e){return"HostDocumentComponent"==e}},props:{absolutePath:{get:function(){var e=s.opt(this.node,(function(e){return e.getAbsolutePath()}))||u.CorePath.ROOT;return null!=this.path&&(e=e.appendPart(this.path)),e}},mutableCopy:{get:function(){return this}},setValue:function(e,t){}}}),a)},"6h7+":function(e,t,n){var r,o=t,a=n("oAGj"),i=n("Tq01"),s=n("0wFF"),l=n("dHJt"),u=n("CWW7"),c=n("yGNn"),d=n("FNB+"),h=n("6ZWm"),p=n("G1DZ"),f=n("P83h"),m=n("ZK0l"),g=n("pnSN"),y=n("X0GW"),_=n("iCxV"),T=n("c+uM"),C=n("tGKA"),v=n("jcfx"),P=n("djAF"),S=n("8t9B"),A=n("sIWg");o.BadgeType=a.defineEnum("BadgeType",{Lockup:"lockup"}),o.BadgeFacade=(r=function(){},a.defineClass({name:"BadgeFacade",ctor:r,statics:{addBadge:function(e,t,n,o,s){void 0===o&&(o=null),void 0===s&&(s=null);var d=[];if(r.getFormaeToCopy(e.firstPage.root,d),0==d.length)return c.CorePromise.reject("Badge is empty");var h=r.areFormaeGrayscale(d),p=new f.FormaStyleChangedEvent(n.root);return n.beginUpdate(p),u.CreationFacade.copyItems(d,n,void 0,h,!1,s).then((function(e){var u=a.clone(e);return r.recordSources(t,d,u),new l.BadgeLayoutController(u).update(s),r.handleReplace(o,u),r.stopColorChangeLoggingForID[t]=!0,r.onBadgeFormaePlaced(u,n,h),a.removeKey(r.stopColorChangeLoggingForID,t),n.endUpdate(p),new i.FormaActionResult(u)})).fail((function(e){return n.endUpdate(p),c.CorePromise.reject("Forma copy failed")}))},getDesignIngredientIDAndType:function(e){return{id:p.FormaSourceUtils.stripNamespace(e),type:o.BadgeType.Lockup}},stopColorChangeLoggingForID:{},logColorChange:function(e){var t;if(null!=(t=e)&&p.FormaSourceUtils.isDesignIngredient(t)){var n=r.getDesignIngredientIDAndType(t),o=n.id,i=n.type;null==r.stopColorChangeLoggingForID[o]&&(a.opt(_.Host.logging,(function(e){return e.logToAnalytics(s.AnalyticsConstants.kDesignIngredientColorChanged,{contextualData1:"designIngredientId:"+o,contextualData2:"designIngredientType:"+i})})),r.stopColorChangeLoggingForID[o]=!0)}},logFontChange:function(e,t){var n;if(null!=(n=e)&&p.FormaSourceUtils.isDesignIngredient(n)){var o=r.getDesignIngredientIDAndType(n),i=o.id,l=o.type;a.opt(_.Host.logging,(function(e){return e.logToAnalytics(s.AnalyticsConstants.kDesignIngredientFontChanged,{contextualData1:"designIngredientId:"+i,contextualData2:"designIngredientType:"+l,contextualData10:"fontName:"+t})}))}},logBackingShapeChange:function(e,t){var n;if(null!=(n=e)&&p.FormaSourceUtils.isDesignIngredient(n)){var o=r.getDesignIngredientIDAndType(n),i=o.id,l=o.type;a.opt(_.Host.logging,(function(e){return e.logToAnalytics(s.AnalyticsConstants.kDesignIngredientBackingShapeChanged,{contextualData1:"designIngredientId:"+i,contextualData2:"designIngredientType:"+l,contextualData12:"shapeName:"+t})}))}},getFormaeToCopy:function(e,t){var n;if(r.checkEligibility(e,r.isBadgeAtom))t.push(e);else if((n=a.as(e,g.GroupForma))&&a.opt(n.controller,(function(e){return 0==e.userGroup})))for(var o=a.iter(a.range(0,n.childCount,!1));!o.done;o.next()){var i=o.value;r.getFormaeToCopy(n.childAt(i),t)}},isBadgeAtom:function(e,t){return!(e.kind!=P.ShapeForma.KIND||!e.hasIntent(d.Forma.INTENT_ICON))||t.kind==S.TypeLockupController.KIND||t.kind==h.FrameController.KIND&&t.duplicatable},handleReplace:function(e,t){var n,r,o,i,s,l,u,c,d=!1;if(a.opt(e,(function(e){return 1==e.isBackgroundImage()}))){if(t.length>1||a.opt(a.opt(a.first(t),(function(e){return e.controller})),(function(e){return 1==e.userGroup})))return;d=!0}if((r=e)&&(o=r.parent)&&null!=(i=o.indexOfChild(r))&&(s=r.controller)&&(l=r.frame)&&(u=1==t.length?a.first(t):y.GroupFacade.createGroupFromFormae(t))&&(c=u.controller)){if(o.insertChildAt(u,i),d)u.allowUserMove=!1,c.fit(l);else{var h=r.rotationInRadians();s.rotate(-h),u.placement=C.Matrix2D.Identity,u.bounds=A.TheoRect.fromSize(l.fitAspectRatioWithin((n=a.opt(u.bounds,(function(e){return e.aspectRatio})))||null!=n?n:1)),u.moveCenterToPoint(l.center),c.rotate(h)}r.removeFromParent(),t.length>1&&y.GroupFacade.ungroupItems(t)}},onBadgeFormaePlaced:function(e,t,n){for(var o=!!n&&null,i=a.iter(e);!i.done;i.next()){var s=i.value;r.forEachBadgeAtom(s,(function(e,t){var n;(n=a.as(t,S.TypeLockupController))&&n.updateScoring()})),null!=o||r.checkContrast(s)||(o=!0)}if(1==o){(new v.ProfilingColorMap).updateCurrentColorIndices();for(var l=a.iter(e);!l.done;l.next())s=l.value,r.forEachBadgeAtom(s,(function(e,t){return t.shuffleColorAssignment()}))}for(var u=a.iter(e);!u.done;u.next())s=u.value,r.forEachUserGroup(s,(function(e,t){t.resizeLayoutController_=null}))},areFormaeGrayscale:function(e){for(var t=a.iter(e);!t.done;t.next()){var n=t.value;if(!r.checkEligibility(n,r.isFormaGrayscale))return!1}return!0},isFormaGrayscale:function(e,t){if(t.kind==h.FrameController.KIND)return!1;var n,o,i,s=e.style;return!(!r.isStyleGrayscale(s)||(n=a.as(s,T.LockupStyle))&&(o=n.characterStyles[S.TypeLockupController.HIGHLIGHT_STYLE])&&(i=a.opt(a.as(t,S.TypeLockupController),(function(e){return e.charStyleRanges})))&&0==!i.length&&!r.isStyleGrayscale(o))},isStyleGrayscale:function(e){var t,n,r,o;return(o=e.colorLibrary)&&e.colors.forEachColor((function(e,n,i){if(null==r){var s=null==i?a.opt(o.color((t=n)||null!=t?t:""),(function(e){return e.rgbColor})):i;a.opt(s,(function(e){return 0==e.isGrayscale()}))&&(r=!1)}})),!(n=r)&&null==n||n},checkContrast:function(e){return r.checkEligibility(e,(function(e,t){return t.doesContrast()}))},recordSources:function(e,t,n){for(var o=n.length>1,i=a.iter(a.toSequence(n));!i.done;i.next()){var s=i.value,l=s.offset;s.element.source=r.makeSourceDescriptor(e,o?t[l].formaID:null)}},makeSourceDescriptor:function(e,t){var n;return null!=(n=t)?p.FormaSourceNamespace.DesignIngredient+e+":"+n:p.FormaSourceNamespace.DesignIngredient+e},checkEligibility:function(e,t){var n;if(n=e.controller){if(!n.userGroup)return t(e,n);var o;if(o=a.as(e,g.GroupForma)){for(var i=a.iter(a.range(0,o.childCount,!1));!i.done;i.next()){var s=i.value;if(!r.checkEligibility(o.childAt(s),t))return!1}return!0}}return!1},forEachBadgeAtom:function(e,t){var n,o;if(n=e.controller)if(n.userGroup){if(o=a.as(e,g.GroupForma))for(var i=a.iter(a.range(0,o.childCount,!1));!i.done;i.next()){var s=i.value;r.forEachBadgeAtom(o.childAt(s),t)}}else t(e,n)},forEachUserGroup:function(e,t){var n,o;if((n=a.as(e,g.GroupForma))&&(o=a.as(e.controller,m.GroupController))){o.userGroup&&t(n,o);for(var i=a.iter(a.range(0,n.childCount,!1));!i.done;i.next()){var s=i.value;r.forEachUserGroup(n.childAt(s),t)}}}}}),r)},"7EVG":function(e,t,n){var r,o=t,a=n("oAGj"),i=n("gXiO");o.WatermarkFacade=(r=function(){i.CoreObject.call(this)},a.defineClass({name:"WatermarkFacade",ctor:r,superName:"CoreObject",statics:{setWatermark:function(e,t){t.watermarkEnabled=e},getWatermark:function(e){return e.watermarkEnabled}}}),r)},"7Pku":function(e,t,n){var r,o=t,a=n("oAGj"),i=n("SpAV"),s=n("QbzR"),l=n("fNpk"),u=n("T8w7"),c=n("jfma");o.FormaToPGMFactory=a.defineProtocol("FormaToPGMFactory",{childReferences:"(GroupForma) -> Array<PGMReference>",referenceForForma:"(Forma) -> PGMReference"}),o.FormaToPGMMapper=(r=function(e){this.formaKind=e},a.defineClass({name:"FormaToPGMMapper",ctor:r,statics:{mapBlendMode:function(e){var t=u.OpacityFacade.formaCanHaveBlendMode(e)?e.style.blendMode:s.FormaBlendMode.Normal;return t==s.FormaBlendMode.Multiply?c.PGMBlendModeEnum.Multiply:t==s.FormaBlendMode.Screen?c.PGMBlendModeEnum.Screen:(i.CoreAssertDebugOnly.isTrue(t==s.FormaBlendMode.Normal,"Only normal, multiply, and screen blend modes are supported in PGM",void 0,"FormaToPGMMapper.mapBlendMode","FormaToPGMMapper.swift",79),c.PGMBlendModeEnum.Normal)}},props:{makePGMRef:function(e,t,n,r){return l.LegacyCoreAssert.fail("PGMMapperForForma isn't overriding makePGMRef",{kind:this.formaKind},"FormaToPGMMapper.makePGMRef","FormaToPGMMapper.swift",52),null},canDoSimpleTransformUpdate:function(e){return!u.OpacityFacade.formaHasNonNormalBlendMode(e.forma)}}}),r)},"8Quq":function(e,t,n){var r,o,a=t,i=n("oAGj"),s=n("7Pku"),l=n("w/+j"),u=n("fNpk"),c=n("c+uM"),d=n("Ird5"),h=n("jfma"),p=n("djwB"),f=n("yjxF"),m=n("Aj79"),g=n("W6ub"),y=n("bAjp"),_=n("bJhu"),T=n("enh0"),C=n("sIWg");a.TextFormaToPGMMapper=(r=function e(){s.FormaToPGMMapper.call(this,e.FORMA_KIND)},o={},i.defineClass({name:"TextFormaToPGMMapper",ctor:r,superName:"FormaToPGMMapper",statics:{FORMA_KIND:{get:function(){return void 0===o.FORMA_KIND&&(o.FORMA_KIND=T.TextForma.KIND),o.FORMA_KIND}},instance:{get:function(){return void 0===o.instance&&(o.instance=new r),o.instance}},createMapper:function(e){return r.instance},getPGMNodeForTextForma:function(e,t,n,r){var o;void 0===r&&(r=null);var a=d.PGMAnimationList.EMPTY,s=t.fontColor,l=t.fontDescriptor,h=t.textLook,m=t.fontStrokeColor,T=t.fontStrokeWidth;h==c.LockupTextLook.KnockoutAndOutline&&n.includes("-txt-ko#")&&(T=0);var v=t.tracking,P=t.fontSize,S=r||s;null==r&&T>0&&(h==c.LockupTextLook.KnockoutAndOutline||h==c.LockupTextLook.OutlineOnly||h==c.LockupTextLook.KnockoutAndShadow)&&(S=null),u.LegacyCoreAssert.isFalse(null==t.bounds,"nil text forma bounds encountered when getting PGM node",void 0,"TextFormaToPGMMapper.getPGMNodeForTextForma","TextFormaToPGMMapper.swift",95);var A=((o=i.opt(t.bounds,(function(e){return e.width})))||null!=o?o:i.toDouble(t.text.length)*P)-T,D=C.TheoRect.fromXYWH(0,P*(l.capRatio-l.ascentRatio),A,P*(l.ascentRatio+l.descentRatio));return new y.PGMText(n,new f.PGMNodeMetadata(t.formaID,"text"),a,D,t.text,_.PGMTextStyle.createCacheable(p.PGMFont.fromDescriptor(l),S,m,T,v),g.PGMRenderRuns.init_378c(t.renderRuns))}},props:{makePGMRef:function(e,t,n,o){var a;return(a=i.as(e,T.TextForma))?l.FormaToPGMUtils.applyAnimations(t,a,new m.PGMReference(r.getPGMNodeForTextForma(t,a,a.formaID,null),new h.PGMCompositingParams(a.placement,a.style.opacity))):(u.LegacyCoreAssert.fail("TextFormaToPGMMapper: not a text forma",void 0,"TextFormaToPGMMapper.makePGMRef","TextFormaToPGMMapper.swift",52),null)}}}),r)},"95jH":function(e,t,n){var r,o=t,a=n("oAGj"),i=n("ascj"),s=n("URxh"),l=n("iCxV"),u=n("K17h"),c=n("RkYL");o.MotionLogicStacked=(r=function(){},a.defineClass({name:"MotionLogicStacked",ctor:r,statics:{_implements:function(e){return"MotionLogic"==e}},props:{updateColorTable:function(e,t){var n=t.style.colors.clone();a.opt(e.style,(function(e){return e.colors.setColor(i.ColorRole.FieldPrimary,n.fieldPrimary)})),a.opt(e.style,(function(e){return e.colors.setColor(i.ColorRole.FieldSecondary,n.fieldSecondary)}))},updateFormaAnim:function(e,t,n,r,o){var i,l=[],u=c.TheoTime.fromSeconds(t),d=c.TheoTime.fromSeconds(n);if(o.length>0){var h=o[0];this.updateColorTable(h,e),u.value>0&&l.push(new s.KeyFrame(c.TheoTime.Zero,h.timingFunction,h.placement,h.bounds,a.opt(h.style,(function(e){return e.clone()})))),l.push(new s.KeyFrame(u,h.timingFunction,h.placement,h.bounds,a.opt(h.style,(function(e){return e.clone()}))))}o.length>1&&(h=o[1],this.updateColorTable(h,e),l.push(new s.KeyFrame(d,h.timingFunction,h.placement,h.bounds,a.opt(h.style,(function(e){return e.clone()}))))),(i=e.animation)&&(i.startTime=c.TheoTime.Zero,i.endTime=d,i.keyFrames=l.concat())},apply:function(e,t,n){var r,o,i=(r=a.as(n.lineDur,"Double"))||null!=r?r:1,s=(o=a.as(n.endPadDur,"Double"))||null!=o?o:0,d=a.clone(u.MotionUtils.findTextLines(e)),h=d.length,p=a.toDouble(h)*i+s;if(t.length<8)a.opt(l.Host.logging,(function(e){return e.warning("Less than required key-frames for Motion-Logic-Stacked")}));else{var f=t;if(h>0){var m=0,g=a.clone(d.shift()),y=null;d.length>0&&(y=a.clone(d.pop()));for(var _=f.slice(0,2),T=a.iter(g);!T.done;T.next()){var C=T.value;this.updateFormaAnim(C,m,m+i,p,_)}m+=i;for(var v=a.iter(a.toSequence(d));!v.done;v.next()){var P=v.value,S=P.offset,A=P.element;if(0==S%2)for(var D=f.slice(2,4),E=a.iter(A);!E.done;E.next())C=E.value,this.updateFormaAnim(C,m,m+i,p,D);else for(var R=f.slice(4,6),F=a.iter(A);!F.done;F.next())C=F.value,this.updateFormaAnim(C,m,m+i,p,R);m+=i}if(null!=y)for(var I=f.slice(6,8),b=a.iter(y);!b.done;b.next())C=b.value,this.updateFormaAnim(C,m,m+i,p,I);m+=i}}a.opt(e.animation,(function(e){return e.endTime=c.TheoTime.fromSeconds(p)}))}}}),r)},"9WSY":function(e,t,n){var r,o,a,i=t,s=n("oAGj"),l=n("dJuF"),u=n("fNpk"),c=n("Quhx"),d=n("umUn"),h=n("90dd");i.ColorLibrary=(r=function(){this.changedIDs_=null},o={},s.defineClass({name:"ColorLibrary",ctor:r,superName:"PostPublishingObject",statics:{SCHEMA_CLASS_NAME:"ColorLibrary",codec:{get:function(){return void 0===o.codec&&(o.codec=l.DBPropertyCodec.registerCodec(r.SCHEMA_CLASS_NAME,l.DBPropertyCodec.directObjectCodec(r.SCHEMA_CLASS_NAME))),o.codec}},factory:{get:function(){return void 0===o.factory&&(o.factory=function(e,t,n,o){return r.init_866e(n,e)}),o.factory},set:function(e){o.factory=e}},PROPERTY_ENTRIES:"entries",PROPERTY_ENTRY_COLORID:"id",PROPERTY_ENTRY_COLOR:"color",PROPERTY_PALETTE_ID:"palette:id",_implements:function(e){return"IDBObject"==e||"TheoMessagePublisher"==e}},props:{init_fcb1:function(e){s.super_init(this,c.PostPublishingObject,c.PostPublishingObject.prototype.init_dd5d,s.opt(e,(function(e){return e.state.allProperties}))||{},{})},init_d41d:function(){s.super_init(this,c.PostPublishingObject,c.PostPublishingObject.prototype.init_dd5d,{},{})},init_866e:function(e,t){s.super_init(this,c.PostPublishingObject,c.PostPublishingObject.prototype.init_866e,e,t)},className:{get:function(){return r.SCHEMA_CLASS_NAME}},paletteID_:{get:function(){return s.as(this.get(r.PROPERTY_PALETTE_ID),"String")},set:function(e){this.set(r.PROPERTY_PALETTE_ID,e)}},entries:{get:function(){return s.as(this.get(r.PROPERTY_ENTRIES),["Array",["Dictionary","String","Any"]])}},lookupFromEntries:function(e){var t={};if(null!=e)for(var n=s.iter(e);!n.done;n.next()){var o,a,i=n.value;null!=(o=s.as(i[r.PROPERTY_ENTRY_COLORID],"String"))&&(a=s.as(i[r.PROPERTY_ENTRY_COLOR],d.TheoColor))&&(t[o]=a)}return t},lookup_:{get:function(){return this.lookupFromEntries(this.entries)}},flushColors:function(e){for(var t=[],n=s.iter(e);!n.done;n.next()){var o={id:n.key,color:n.value};t.push(o)}this.set(r.PROPERTY_ENTRIES,t)},hasEntries:function(e){for(var t=!0,n=s.keys(this.lookup_),r=s.iter(e);!r.done;r.next()){var o=r.value;if(!n.includes(o)){t=!1;break}}return t},getIdForEntry:function(e){for(var t,n=s.iter(this.lookup_);!n.done;n.next()){var r=n.key,o=n.value;if(s.eq(d._equality_TheoColor_TheoColor,e,o)){t=r;break}}return t},color:function(e){return this.lookup_[e]},paletteID:{get:function(){return this.paletteID_},set:function(e){this.paletteID_=e}},setColor:function(e,t){this.setColors(s.dict([e,t]))},setColors:function(e){for(var t=!1,n=s.keys(e),r=s.clone(this.lookup_),o=s.iter(e);!o.done;o.next()){var a=o.key,l=o.value,u=this.lookup_[a];null==l&&null!=u?(t||(this.makeMutable(),this.publish(new i.ColorLibraryChangedMessage(this,!0,n)),t=!0),s.removeKey(r,a)):null==l||null!=u&&s.eq(d._equality_TheoColor_TheoColor,l,u)||(t||(this.makeMutable(),this.publish(new i.ColorLibraryChangedMessage(this,!0,n)),t=!0),r[a]=l)}if(t){var c=this.database.beginTransaction("flushColors",null);this.flushColors(r),c.mergeWithPrevious(),this.publish(new i.ColorLibraryChangedMessage(this,!1,n))}},colorCount:{get:function(){return s.count(this.lookup_)}},forEachColor:function(e){for(var t=s.iter(this.lookup_);!t.done;t.next())e(t.key,t.value)},recordUndoState:function(){return s.as(this.state.allProperties,["Dictionary","String","Any"])},restoreUndoState:function(e){null!=e&&this.matchProperties(e)},matchProperties:function(e){var t=s.keys(this.lookup_).map((function(e){return e}),this);this.publish(new i.ColorLibraryChangedMessage(this,!0,t)),this.makeMutable(),c.PostPublishingObject.prototype.matchProperties.call(this,e),this.publish(new i.ColorLibraryChangedMessage(this,!1,t))},asString:{get:function(){var e;return"ID:"+this.id.substr(0,8)+" paletteID:"+((e=this.paletteID)||null!=e?e:"<none>")+" themeColors:"+this.themeColorsAsString}},themeColorsAsString:{get:function(){for(var e,t=this,n=["themeColor0","themeColor1","themeColor2","themeColor3","themeColor4","themeColor5"],r=n.map((function(n){return(e=s.opt(t.color(n),(function(e){return e.rgbColor.asString})))||null!=e?e:"<none>"}),this),o="themeColors: ",a=s.iter(s.range(0,n.length,!1));!a.done;a.next()){var i=a.value;o+=n[i]+":("+r[i]+") "}return o}},willChangeState:function(e){var t;if(null!=(t=e[r.PROPERTY_ENTRIES])){u.LegacyCoreAssert.isTrue(null==this.changedIDs_,"Got a second will-change without an intervening did-change",void 0,"ColorLibrary.willChangeState","ColorLibrary.swift",276),this.changedIDs_=[];var n=this.getCodec(r.PROPERTY_ENTRIES);u.LegacyCoreAssert.isTrue(null!=n,"Got a state change before the entries codec got registered. How?",void 0,"ColorLibrary.willChangeState","ColorLibrary.swift",280);for(var o=s.clone(s.as(n.decode(t[0],this),["Array",["Dictionary","String","Any"]])),a=s.clone(s.as(n.decode(t[1],this),["Array",["Dictionary","String","Any"]])),l=s.clone(this.lookupFromEntries(o)),d=s.clone(this.lookupFromEntries(a)),h=s.keys(l),p=s.iter(s.keys(d));!p.done;p.next()){var f=p.value;h.includes(f)||h.push(f)}for(var m=s.iter(h);!m.done;m.next()){var g=l[f=m.value],y=d[f];null==g||null==y?this.changedIDs_.push(f):g.isEqual(y)||this.changedIDs_.push(f)}this.changedIDs_.length>0&&this.publish(new i.ColorLibraryChangedMessage(this,!0,this.changedIDs_))}c.PostPublishingObject.prototype.willChangeState.call(this,e)},didChangeState:function(e){c.PostPublishingObject.prototype.didChangeState.call(this,e),null!=e[r.PROPERTY_ENTRIES]&&(u.LegacyCoreAssert.isTrue(null!=this.changedIDs_,"Got a did-change without a matching will-change",void 0,"ColorLibrary.didChangeState","ColorLibrary.swift",320),this.publish(new i.ColorLibraryChangedMessage(this,!1,this.changedIDs_)),this.changedIDs_=null)}}}),r),i.ColorLibraryChangedMessage=(a=function e(t,n,r){this.isBefore=n,this.isAfter=!n,this.affectedColorIDs=s.clone(r),h.TheoMessage.call(this,e.TYPE,t)},s.defineClass({name:"ColorLibraryChangedMessage",ctor:a,superName:"TheoMessage",statics:{TYPE:"ColorLibraryChangedMessage"}}),a)},"9YN4":function(e,t,n){var r,o,a,i,s,l,u=t,c=n("oAGj"),d=n("VQVe"),h=n("ytEx"),p=n("qsM9"),f=n("SpAV"),m=n("9a+Y"),g=n("9WSY"),y=n("yGNn"),_=n("ascj"),T=n("Vvcj"),C=n("fVJ2"),v=n("13MC"),P=n("quOg"),S=n("LcYy"),A=n("3OP7"),D=n("BbDD"),E=n("FNB+"),R=n("URxh"),F=n("H9Ol"),I=n("cmoc"),b=n("fWxZ"),O=n("QbzR"),k=n("JEzR"),M=n("P83h"),N=n("A6KL"),L=n("pnSN"),x=n("h67N"),B=n("4mVB"),w=n("iCxV"),G=n("8vXU"),Y=n("q5zr"),U=n("9eTw"),V=n("fdtz"),j=n("SDdr"),H=n("uWOl"),W=n("C4JV"),K=n("Puiz"),X=n("rxGp"),z=n("fNpk"),q=n("c+uM"),Z=n("DP9v"),J=n("0PPJ"),Q=n("358a"),$=n("mCIK"),ee=n("AxS/"),te=n("K0Rh"),ne=n("2ALn"),re=n("djAF"),oe=n("kSRw"),ae=n("aN2p"),ie=n("u2iI"),se=n("QBb7"),le=n("a9ow"),ue=n("MO6F"),ce=n("lJxM"),de=n("Qb69"),he=n("T6jX"),pe=n("enh0"),fe=n("voyk"),me=n("90dd"),ge=n("x4Gy"),ye=n("LCGV"),_e=n("Kkml"),Te=n("LGJg"),Ce=n("sW6f"),ve=n("WWR6"),Pe=n("zjod"),Se=n("QTen");u.TheoDocumentVersion=c.defineEnum("TheoDocumentVersion",{Invalid:0,BeginningOfStoringVersion:1,BackingShapePaddingEnabled:2,FormaController:1e3,ColorBackgroundAndPreviewEncoding:2e3,Knockouts:3e3,GridLayouts:4e3,CharacterStyles:5e3,GridsWithAlphaImages:6e3,OmitShapeLibraryPathData:7e3,Icons:8e3,TextEffects:9e3,LetterSpacing:1e4,AdobeFonts:11e3,ImageAdjustments:12e3,PremiumTemplates:13e3,Giphys:14e3,NewTextAnimations:15e3,FontSourcesMetadata:15100,NewTextLayouts:16e3,JSONDocumentEncoding:17e3,VideoSupport:18e3,FloatingImages:19e3,Grouping:2e4,Deepcut:21e3,FourColorsAndOpacities:22e3,BlendModes:23e3,LimitedUseStockLicenses:24e3,BasicShapes:25e3,MultiplePages:26e3}),u.TheoDocumentUserAction=(r=function(e,t){this.doc=e,this.action=t,c.opt(e.controller,(function(e){return e.undoRedoMgr.beginUserAction(t,(function(){}))}))},c.defineClass({name:"TheoDocumentUserAction",ctor:r,superName:"CoreObject",props:{end:function(){var e=this;null!=this.action&&c.opt(this.doc.controller,(function(t){return t.undoRedoMgr.endUserAction((function(){e.action=null}))}))},rollback:function(){var e=this;null!=this.action&&c.opt(this.doc.controller,(function(t){return t.undoRedoMgr.cancelUserAction((function(){e.action=null}))}))}}}),r),u.TheoDocument=(o=function(){this.modifiedSinceShare_=!1,this.missingFontsDuringOpen_=[],this.allowPrune_=!0,this.pages_=[],this.pageIdToIndex_={},this.docInited_=!0,this.maskSubstitutionController_=new J.MaskSubstitutionController,this.pageThumbnailCache_=new $.PageThumbnailCache,this.initNewDocumentTransaction=null,this.pendingAuthoringContextID_=null,this.forkID_=null,this.atomicChangeEvent_=null,this.blockedControllers_=[],this.pagesForUpdate_=[]},a={},c.defineClass({name:"TheoDocument",ctor:o,superName:"DBHostObject",statics:{SCHEMA_CLASS_NAME:"TheoDocument",CURRENT_VERSION:{get:function(){return void 0===a.CURRENT_VERSION&&(a.CURRENT_VERSION=u.TheoDocumentVersion.MultiplePages),a.CURRENT_VERSION},set:function(e){a.CURRENT_VERSION=e}},MIME_TYPE:"application/vnd.adobe.theo.document+dcx",PROPERTY_VERSION:"format-version",PROPERTY_WATERMARK_ENABLED:"watermark-enabled",PROPERTY_SHARED:"shared",PROPERTY_MODIFIED_SINCE_SHARE:"modified-since-share",PROPERTY_FONT_SOURCES:"font-sources",PROPERTY_FONT_USAGE:"font-usage",PROPERTY_CP_CONTENT_MODIFIED:"cp#contentModified",PROPERTY_CP_PROJECT_ID:"cp#projectId",PROPERTY_CP_ALIAS:"cp#shortId",PROPERTY_CP_ASSET_ID:"cp#assetId",PROPERTY_CP_PUBLISHED_ETAG:"cp#publishedEtag",PROPERTY_CP_IS_EXPORTED:"cp#isExported",PROPERTY_THEME_CATEGORY_NAME:"colorThemeCategoryName",PROPERTY_TEMPLATE_SPECIAL_COLLECTION:"templateSpecialCollection",PROPERTY_REMIX_ANCESTORS_CP_ASSET_IDS:"remix-ancestors",PROPERTY_STOCK_IMAGES:"stockImages",PROPERTY_UNLICENSED:"unlicensed",PROPERTY_STANDARD:"standard",PROPERTY_EXTENDED:"extended",PROPERTY_LIMITED:"limited",PROPERTY_NAME:"name",PROPERTY_TYPE:"type",PROPERTY_CHILDREN:"children",ALL_CP_PROPERTIES:{get:function(){return void 0===a.ALL_CP_PROPERTIES&&(a.ALL_CP_PROPERTIES=[o.PROPERTY_CP_PROJECT_ID,o.PROPERTY_CP_ALIAS,o.PROPERTY_CP_ASSET_ID,o.PROPERTY_CP_PUBLISHED_ETAG,o.PROPERTY_CP_IS_EXPORTED]),a.ALL_CP_PROPERTIES}},PROPERTY_DOCUMENT_DATA:"doc#data",PROPERTY_AUTHORING_CONTEXT_ID:"authctx#ctxid",PROPERTY_AUTHORING_CONTEXT_NAME:"authctx#ctxname",PROPERTY_AUTHORING_CONTEXT_URN:"authctx#ctxurn",PROPERTY_AUTHORING_CONTEXT_THEME_ID:"authctx#themeid",PROPERTY_USES_BRANDED_ELEMENTS:"authctx#uses-branded-elements",PROPERTY_PAGE_COUNT:"page-count",PROPERTY_FIRST_PAGE_SIZE:"first-page-size",DEFAULT_NAME:"My project",PREVIEW_FONT_DOC_NAME:"Preview_6b7db89c-5608-4307-bd76-73ae47c44883",PROPERTY_CONSTRAINED_IMAGES:"constrainedImages",ERR_NEWER_FORMAT_VERSION:"newer-format-version",ERR_COULD_NOT_READ_JSON:"json-read-failed",COMPONENT_PATH_CONTENT:"content.json",COMPONENT_NAME_DOM:"dom",COMPONENT_RELATIONSHIP_DOM:"dom",COMPONENT_MIME_TYPE_DOCUMENT_JSON:"application/json",COMPONENT_RELATIONSHIP_METADATA:"metadata",COMPONENT_RELATIONSHIP_RENDITION:"rendition",classCodecs_:[],classFactories_:[],registerCodecs:function(){0==o.classCodecs_.length&&(o.classCodecs_.push(de.TheoDocumentData.codec),o.classCodecs_.push(F.ControllerMetadata.codec),o.classCodecs_.push(O.FormaStyle.codec),o.classCodecs_.push(ge.TextModel.codec),o.classCodecs_.push(ge.ContentTextModel.codec),o.classCodecs_.push(le.UTF16Attribute.codec),o.classCodecs_.push(le.FontDescriptorAttribute.codec),o.classCodecs_.push(le.FontSizeAttribute.codec),o.classCodecs_.push(le.FontColorAttribute.codec),o.classCodecs_.push(le.FontStrokeColorAttribute.codec),o.classCodecs_.push(le.FontStrokeWidthAttribute.codec),o.classCodecs_.push(le.TextLookAttribute.codec),o.classCodecs_.push(le.TrackingAttribute.codec),o.classCodecs_.push(g.ColorLibrary.codec),o.classCodecs_.push(_.ColorTable.codec),o.classCodecs_.push(R.FormaAnimation.codec),o.classCodecs_.push(d.AnimationStyle.codec),o.classCodecs_.push(j.ImageFilter.codec),o.classCodecs_.push(p.Codecs.theoTimeCodec),o.classCodecs_.push(p.Codecs.theoSizeCodec),o.classCodecs_.push(p.Codecs.solidColorCodec),o.classCodecs_.push(p.Codecs.theoColorCodec),o.classCodecs_.push(p.Codecs.paletteIDCodec),o.classCodecs_.push(p.Codecs.theoPointCodec),o.classCodecs_.push(p.Codecs.theoRectCodec),o.classCodecs_.push(p.Codecs.matrix2DCodec),o.classCodecs_.push(p.Codecs.colorRoleCodec),o.classCodecs_.push(p.Codecs.textRangeCodec),o.classCodecs_.push(p.Codecs.gridCellCodec),o.classCodecs_.push(p.Codecs.fontDescriptorCodec),o.classCodecs_.push(p.Codecs.fontCodec),o.classCodecs_.push(p.Codecs.mediaMetadataCodec),o.classCodecs_.push(p.Codecs.imageColorDataCodec),o.classCodecs_.push(p.Codecs.emptyPathCodec),o.classCodecs_.push(p.Codecs.rectanglePathCodec),o.classCodecs_.push(p.Codecs.ellipsePathCodec),o.classCodecs_.push(p.Codecs.arbitraryPathCodec),o.classCodecs_.push(p.Codecs.pathCodec),o.classCodecs_.push(p.Codecs.artworkShapeCodec),o.classCodecs_.push(p.Codecs.artworkGroupCodec),o.classCodecs_.push(p.Codecs.artworkClipGroupCodec),o.classCodecs_.push(p.Codecs.artworkNodeCodec),o.classCodecs_.push(p.Codecs.pageExportDataCodec),o.classCodecs_.push(p.Codecs.keyFrameCodec),o.classCodecs_.push(p.Codecs.imageAdjustmentsCodec),o.classCodecs_.push(p.Codecs.textPathCodec),o.classCodecs_.push(p.Codecs.textPathSegmentCodec))},registerFactories:function(){0==o.classFactories_.length&&(o.classFactories_.push(C.DBHostObject.registerFactory(de.TheoDocumentData.SCHEMA_CLASS_NAME,de.TheoDocumentData.factory)),o.classFactories_.push(C.DBHostObject.registerFactory(ge.TextModel.SCHEMA_CLASS_NAME,ge.TextModel.factory)),o.classFactories_.push(C.DBHostObject.registerFactory(ge.ContentTextModel.SCHEMA_CLASS_NAME,ge.ContentTextModel.factory)),o.classFactories_.push(C.DBHostObject.registerFactory(b.FormaPage.SCHEMA_CLASS_NAME,b.FormaPage.factory)),o.classFactories_.push(C.DBHostObject.registerFactory(m.ContentDocument.SCHEMA_CLASS_NAME,m.ContentDocument.factory)),o.classFactories_.push(C.DBHostObject.registerFactory(T.ColorThemeDocument.SCHEMA_CLASS_NAME,T.ColorThemeDocument.factory)),o.classFactories_.push(C.DBHostObject.registerFactory(S.DocumentHistory.SCHEMA_CLASS_NAME,S.DocumentHistory.factory)),o.classFactories_.push(C.DBHostObject.registerFactory(g.ColorLibrary.SCHEMA_CLASS_NAME,g.ColorLibrary.factory)),o.classFactories_.push(C.DBHostObject.registerFactory(ae.SimpleSwatch.SCHEMA_CLASS_NAME,ae.SimpleSwatch.factory)),o.classFactories_.push(C.DBHostObject.registerFactory(_.ColorTable.SCHEMA_CLASS_NAME,_.ColorTable.factory)),o.classFactories_.push(C.DBHostObject.registerFactory(N.GroupContentNode.SCHEMA_CLASS_NAME,N.GroupContentNode.factory)),o.classFactories_.push(C.DBHostObject.registerFactory(te.RootForma.SCHEMA_CLASS_NAME,te.RootForma.factory)),o.classFactories_.push(C.DBHostObject.registerFactory(L.GroupForma.SCHEMA_CLASS_NAME,L.GroupForma.factory)),o.classFactories_.push(C.DBHostObject.registerFactory(oe.SmartGroupForma.SCHEMA_CLASS_NAME,oe.SmartGroupForma.factory)),o.classFactories_.push(C.DBHostObject.registerFactory(I.FrameForma.SCHEMA_CLASS_NAME,I.FrameForma.factory)),o.classFactories_.push(C.DBHostObject.registerFactory(V.ImageForma.SCHEMA_CLASS_NAME,V.ImageForma.factory)),o.classFactories_.push(C.DBHostObject.registerFactory(re.ShapeForma.SCHEMA_CLASS_NAME,re.ShapeForma.factory)),o.classFactories_.push(C.DBHostObject.registerFactory(pe.TextForma.SCHEMA_CLASS_NAME,pe.TextForma.factory)),o.classFactories_.push(C.DBHostObject.registerFactory(ve.VectorForma.SCHEMA_CLASS_NAME,ve.VectorForma.factory)),o.classFactories_.push(C.DBHostObject.registerFactory(Pe.VideoForma.SCHEMA_CLASS_NAME,Pe.VideoForma.factory)),o.classFactories_.push(C.DBHostObject.registerFactory(F.ControllerMetadata.SCHEMA_CLASS_NAME,F.ControllerMetadata.factory)),o.classFactories_.push(C.DBHostObject.registerFactory(R.FormaAnimation.SCHEMA_CLASS_NAME,R.FormaAnimation.factory)),o.classFactories_.push(C.DBHostObject.registerFactory(O.FormaStyle.SCHEMA_CLASS_NAME,O.FormaStyle.factory)),o.classFactories_.push(C.DBHostObject.registerFactory(ne.RootStyle.SCHEMA_CLASS_NAME,ne.RootStyle.factory)),o.classFactories_.push(C.DBHostObject.registerFactory(d.AnimationStyle.SCHEMA_CLASS_NAME,d.AnimationStyle.factory)),o.classFactories_.push(C.DBHostObject.registerFactory(H.ImageStyle.SCHEMA_CLASS_NAME,H.ImageStyle.factory)),o.classFactories_.push(C.DBHostObject.registerFactory(ye.TextStyle.SCHEMA_CLASS_NAME,ye.TextStyle.factory)),o.classFactories_.push(C.DBHostObject.registerFactory(ie.ShapeStyle.SCHEMA_CLASS_NAME,ie.ShapeStyle.factory)),o.classFactories_.push(C.DBHostObject.registerFactory(Se.VideoStyle.SCHEMA_CLASS_NAME,Se.VideoStyle.factory)),o.classFactories_.push(C.DBHostObject.registerFactory(B.GridStyle.SCHEMA_CLASS_NAME,B.GridStyle.factory)),o.classFactories_.push(C.DBHostObject.registerFactory(k.FrameStyle.SCHEMA_CLASS_NAME,k.FrameStyle.factory)),o.classFactories_.push(C.DBHostObject.registerFactory(q.LockupStyle.SCHEMA_CLASS_NAME,q.LockupStyle.factory)),o.classFactories_.push(C.DBHostObject.registerFactory(j.AlphaBlendFilter.SCHEMA_CLASS_NAME,j.AlphaBlendFilter.factory)),o.classFactories_.push(C.DBHostObject.registerFactory(j.CompositeFilter.SCHEMA_CLASS_NAME,j.CompositeFilter.factory)),o.classFactories_.push(C.DBHostObject.registerFactory(N.GroupContentNode.SCHEMA_CLASS_NAME,N.GroupContentNode.factory)),o.classFactories_.push(C.DBHostObject.registerFactory(ee.RootContentNode.SCHEMA_CLASS_NAME,ee.RootContentNode.factory)),o.classFactories_.push(C.DBHostObject.registerFactory(Y.ImageContentNode.SCHEMA_CLASS_NAME,Y.ImageContentNode.factory)),o.classFactories_.push(C.DBHostObject.registerFactory(ce.TextContentNode.SCHEMA_CLASS_NAME,ce.TextContentNode.factory)),o.classFactories_.push(C.DBHostObject.registerFactory(Ce.VideoContentNode.SCHEMA_CLASS_NAME,Ce.VideoContentNode.factory)),o.classFactories_.push(C.DBHostObject.registerFactory(Te.VectorContentNode.SCHEMA_CLASS_NAME,Te.VectorContentNode.factory)))},decodeDocument:function(e,t){var n=[],r=A.DocumentPersistenceFactory.decoderFor(e.current),a=A.DocumentPersistenceFactory.namespacedPropertyName(o.PROPERTY_VERSION),i=u.VersionInfo.fromProperty(c.as(e.current.getValue(a),"AnyObject")),s=new u.VersionInfo(o.CURRENT_VERSION);i.major>s.major&&n.push(o.ERR_NEWER_FORMAT_VERSION);var l=o.init_209f(r,(function(e){return n.push(e)}));0==!n.length&&(n.splice(0,0,"Error opening document version "+i.rawValue),t(n));var d=l.beginTransaction("post_history_entry");return l.history.postEntry("open,was-vers="+c.toString(i.rawValue)),d.mergeWithPrevious(),l},decodeTemplate:function(e,t,n){var r,a=[];if(r=c.as(c.opt(w.Host.persistUtils,(function(e){return e.readJsonContentFromFile(t)})),["Dictionary","String","Any"])){var i=e.current,s=new K.JSONNodeDecoder(i,r),l=o.init_209f(s,(function(e){return a.push(e)}));0==!a.length&&n(a);var u=l.beginTransaction("set_authoring_context_ID");return l.authoringContextID=i.getValue(h.PROPERTY_KEY_ID),u.mergeWithPrevious(),l}return a.push(o.ERR_COULD_NOT_READ_JSON),0==!a.length&&n(a),null},newDocumentFromDataObject:function(e,t){return o.init_209f(e,t)},createDefault:function(e){return void 0===e&&(e=null),o.init_b80b(e)},INIT_DOC_TRANSACTION_NAME:"init_new_document",_implements:function(e){return"IDBObject"==e||"TheoMessagePublisher"==e||"IDatabaseListener"==e}},props:{init_209f:function(e,t){o.registerCodecs(),o.registerFactories(),this.publishing_=new ue.TheoBasePublishing,this.controller_=new P.DocumentController;var n=null,r=u.TheoDocumentVersion.Invalid,a=e.intProperty(o.PROPERTY_VERSION,r);a==r&&(a=c.toInt(e.numberProperty(o.PROPERTY_VERSION,c.toDouble(r)))),c.super_init(this,C.DBHostObject,C.DBHostObject.prototype.init_1be9,a,e,(function(e){n=e,null!=t&&t(e)}));var i=this.database.beginTransaction("init",null);if(this.gridLibrary_=new x.GridLibrary,this.hostDB_.addListener(this),this.publishing_.owner=this,D.DocumentSingletonTracker.creatingDocumentSingleton(this),null==n?(this.controller_.attach(this),this.postDecode(),this.modifiedSinceShare_=this.get(o.PROPERTY_MODIFIED_SINCE_SHARE),null==e.property(o.PROPERTY_DOCUMENT_DATA)&&this.set(o.PROPERTY_DOCUMENT_DATA,de.TheoDocumentData.init_d41d())):(this.createDefaultChildren(),this.set(o.PROPERTY_DOCUMENT_DATA,de.TheoDocumentData.init_d41d()),this.set(o.PROPERTY_VERSION,o.CURRENT_VERSION),this.set(o.PROPERTY_MODIFIED_SINCE_SHARE,this.modifiedSinceShare_),this.set(o.PROPERTY_SHARED,!1),this.documentName=o.DEFAULT_NAME,this.controller_.attach(this)),this.instantiateDescendants(),a!=o.CURRENT_VERSION&&this.set(o.PROPERTY_VERSION,o.CURRENT_VERSION),!c.isEmpty(this.authoringContextID)&&(c.isEmpty(this.authoringContextName)||c.isEmpty(this.authoringContextURN))){var s=Z.MultiBrandFacade.authoringContext(this.authoringContextID);null!=s&&(this.authoringContextName=s.name,this.authoringContextURN=s.urn)}he.TheoDocumentUtils.pruneOrphanedContent(this),this.allowPrune_=!1,this.finishInitDocument(i)},init_b80b:function(e){void 0===e&&(e=null),this.allowPrune_=!1,o.registerCodecs(),o.registerFactories(),this.publishing_=new ue.TheoBasePublishing,this.controller_=new P.DocumentController,c.super_init(this,C.DBHostObject,C.DBHostObject.prototype.init_7341,o.CURRENT_VERSION,e);var t=this.database.beginTransaction("init",null);this.gridLibrary_=new x.GridLibrary,this.hostDB_.addListener(this),this.publishing_.owner=this,D.DocumentSingletonTracker.creatingDocumentSingleton(this),this.createDefaultChildren(),this.set(o.PROPERTY_DOCUMENT_DATA,de.TheoDocumentData.init_d41d()),this.set(o.PROPERTY_VERSION,o.CURRENT_VERSION),this.set(o.PROPERTY_MODIFIED_SINCE_SHARE,this.modifiedSinceShare_),this.set(o.PROPERTY_SHARED,!1),this.documentName=o.DEFAULT_NAME,this.controller_.attach(this),this.rawVersion!=o.CURRENT_VERSION&&this.set(o.PROPERTY_VERSION,o.CURRENT_VERSION),this.finishInitDocument(t)},postDecode:function(){Q.PagesFacade.visitPages(this,(function(e){return e.postDecode(),!0})),this.content.postDecode()},finishInitDocument:function(e){var t=this;e.mergeWithPrevious(),this.controller_.undoRedoMgr.reset(),z.LegacyCoreAssert.isTrue(null==this.database.mutableState,"Database already has an outstanding transaction",void 0,"TheoDocument.finishInitDocument","TheoDocument.swift",563),z.LegacyCoreAssert.isTrue(null!=this.database.immutableState,"Database missing immutable state",void 0,"TheoDocument.finishInitDocument","TheoDocument.swift",564),z.LegacyCoreAssert.isTrue(c.opt(this.database.appliedState,(function(e){return e.guid==c.opt(t.database.immutableState,(function(e){return e.guid}))})),"Database applied state is not latest immutable state",void 0,"TheoDocument.finishInitDocument","TheoDocument.swift",565),this.lastFullSaveStateID_=c.opt(this.database.immutableState,(function(e){return e.guid})),this.lastMiniSaveStateID_=c.opt(this.database.immutableState,(function(e){return e.guid})),this.controller_.saveMgr.enable(this.lastFullSaveStateID_),this.maskSubstitutionController_.attach(this),this.pageThumbnailCache_.attach(this),this.docInited_=!0},initNewDocument:function(){this.docInited_=!1,z.LegacyCoreAssert.isTrue(null==this.initNewDocumentTransaction,"Already have an init transaction",void 0,"TheoDocument.initNewDocument","TheoDocument.swift",581),z.LegacyCoreAssert.isTrue(null==this.database.mutableState,"Database already has an outstanding transaction",void 0,"TheoDocument.initNewDocument","TheoDocument.swift",582),this.initNewDocumentTransaction=this.beginTransaction(o.INIT_DOC_TRANSACTION_NAME)},finishInitNewDocument:function(){z.LegacyCoreAssert.isTrue(null!=this.initNewDocumentTransaction,"New document init transaction not open",void 0,"TheoDocument.finishInitNewDocument","TheoDocument.swift",587),this.finishInitDocument(this.initNewDocumentTransaction)},documentInited:{get:function(){return this.docInited_}},disableAutosave:function(){this.controller_.saveMgr.disable()},description:{get:function(){return"Doc Name: "+this.documentName+", uuid: "+this.uuid+", versionDecoded: "+this.versionDecoded.description}},documentName:{get:function(){return this.get(o.PROPERTY_NAME)},set:function(e){this.set(o.PROPERTY_NAME,e)}},pendingAuthoringContextID:{get:function(){return this.pendingAuthoringContextID_},set:function(e){var t=this.pendingAuthoringContextID_;this.pendingAuthoringContextID_=e,null!=t&&null==e?(w.Host.logging.logForCategory(X.LogCategories.kTheoDocument,"Finishing the pending brand change for a document to:"+t,G.LogLevelEnum.INFO_LEVEL),z.LegacyCoreAssert.isTrue(this.authoringContextID==t,"pendingAuthoringContextID cleared before change was committed",void 0,"TheoDocument","TheoDocument.swift",641)):null==t&&null!=e?w.Host.logging.logForCategory(X.LogCategories.kTheoDocument,"Applying a pending brand change for a document from:"+this.authoringContextID+" to:"+e,G.LogLevelEnum.INFO_LEVEL):null!=t&&null!=e&&z.LegacyCoreAssert.fail("overlapping calls to set the pendingAuthoringContextID",{was:t,new:e},"TheoDocument","TheoDocument.swift",645),null==this.pendingAuthoringContextID_||c.isEmpty(this.pendingAuthoringContextID_)||w.Host.brandkitManager.activateBrand(this.pendingAuthoringContextID_)}},setAuthoringContext:function(e){var t,n,r;this.authoringContextID=(t=c.opt(e,(function(e){return e.id})))||null!=t?t:"",this.authoringContextName=(n=c.opt(e,(function(e){return e.name})))||null!=n?n:"",this.authoringContextURN=(r=c.opt(e,(function(e){return e.urn})))||null!=r?r:""},authoringContextID:{get:function(){var e,t,n;return null!=(n=this.pendingAuthoringContextID)?(w.Host.logging.logForCategory(X.LogCategories.kTheoDocument,"authoringContextID returning pendingAuthoringContextID: "+((e=this.pendingAuthoringContextID)||null!=e?e:"none"),G.LogLevelEnum.INFO_LEVEL),n):(t=c.as(this.get(o.PROPERTY_AUTHORING_CONTEXT_ID),"String"))||null!=t?t:""},set:function(e){z.LegacyCoreAssert.isTrue(null==this.pendingAuthoringContextID_,"Found unexpected pending value",{newValue:e},"TheoDocument","TheoDocument.swift",675),this.set(o.PROPERTY_AUTHORING_CONTEXT_ID,e),this.set(o.PROPERTY_USES_BRANDED_ELEMENTS,e.length>0)}},authoringContextName:{get:function(){var e;return(e=c.as(this.get(o.PROPERTY_AUTHORING_CONTEXT_NAME),"String"))||null!=e?e:""},set:function(e){this.set(o.PROPERTY_AUTHORING_CONTEXT_NAME,e)}},authoringContextURN:{get:function(){var e;return(e=c.as(this.get(o.PROPERTY_AUTHORING_CONTEXT_URN),"String"))||null!=e?e:""},set:function(e){this.set(o.PROPERTY_AUTHORING_CONTEXT_URN,e)}},authoringContextThemeID:{get:function(){var e;return(e=c.as(this.get(o.PROPERTY_AUTHORING_CONTEXT_THEME_ID),"String"))||null!=e?e:""},set:function(e){this.set(o.PROPERTY_AUTHORING_CONTEXT_THEME_ID,e)}},uuid:{get:function(){var e;return(e=this.forkID_)||null!=e?e:this.id}},forkDocument:function(e){this.forkID_=e},rawVersion:{get:function(){var e;return(e=c.as(this.get(o.PROPERTY_VERSION),"Int"))||null!=e?e:0}},versionDecoded:{get:function(){return new u.VersionInfo(this.rawVersion)}},communityPlatformAssetID:{get:function(){return c.as(this.get(o.PROPERTY_CP_ASSET_ID),"String")},set:function(e){this.set(o.PROPERTY_CP_ASSET_ID,e)}},communityPlatformAlias:{get:function(){return c.as(this.get(o.PROPERTY_CP_ALIAS),"String")},set:function(e){this.set(o.PROPERTY_CP_ALIAS,e)}},publishedEtag:{get:function(){return c.as(this.get(o.PROPERTY_CP_PUBLISHED_ETAG),"String")},set:function(e){this.set(o.PROPERTY_CP_PUBLISHED_ETAG,e)}},publishedResourcePath:{get:function(){return c.as(this.get(o.PROPERTY_CP_PROJECT_ID),"String")},set:function(e){this.set(o.PROPERTY_CP_PROJECT_ID,e)}},documentData:{get:function(){return c.as(this.get(o.PROPERTY_DOCUMENT_DATA),de.TheoDocumentData)}},shared:{get:function(){return this.get(o.PROPERTY_SHARED)},set:function(e){var t=this.persisted?this.database.beginTransaction("share",null):null;this.set(o.PROPERTY_SHARED,e),this.set(o.PROPERTY_MODIFIED_SINCE_SHARE,!1),c.opt(t,(function(e){return e.end()}))}},isExported:{get:function(){var e;return!(!(e=c.as(this.get(o.PROPERTY_CP_IS_EXPORTED),"Bool"))&&null==e)&&e},set:function(e){var t=this.persisted?this.database.beginTransaction("export",null):null;this.set(o.PROPERTY_CP_IS_EXPORTED,e),c.opt(t,(function(e){return e.end()}))}},colorThemeCategoryName:{get:function(){return c.as(this.get(o.PROPERTY_THEME_CATEGORY_NAME),"String")},set:function(e){var t=this.persisted?this.database.beginTransaction(o.PROPERTY_THEME_CATEGORY_NAME,null):null;this.set(o.PROPERTY_THEME_CATEGORY_NAME,e),c.opt(t,(function(e){return e.mergeWithPrevious()}))}},templateSpecialCollection:{get:function(){return c.as(this.get(o.PROPERTY_TEMPLATE_SPECIAL_COLLECTION),"String")},set:function(e){var t=this.persisted?this.database.beginTransaction(o.PROPERTY_TEMPLATE_SPECIAL_COLLECTION,null):null;this.set(o.PROPERTY_TEMPLATE_SPECIAL_COLLECTION,e),c.opt(t,(function(e){return e.mergeWithPrevious()}))}},recordModification:function(){this.modifiedSinceShare_=!0},modifiedSinceShare:{get:function(){return this.modifiedSinceShare_}},modifiedSinceSave:{get:function(){return this.documentInited&&(this.lastFullSaveStateID_!=c.opt(this.appliedState,(function(e){return e.guid}))||this.lastMiniSaveStateID_!=c.opt(this.appliedState,(function(e){return e.guid})))}},allowPrune:{get:function(){return this.allowPrune_},set:function(e){this.allowPrune_=e}},willCloseDocument:function(){this.disableAutosave()},createDefaultChildren:function(){var e=b.FormaPage.init_d0e4(this);this.pages_.push(e),this.content_=m.ContentDocument.init_26a9(this,null),this.colorTheme_=T.ColorThemeDocument.init_d0e4(this),this.history_=S.DocumentHistory.init_d0e4(this),this.saveChildren()},firstPage:{get:function(){return 0==this.pages_.length&&this.cacheChildren(),c.first(this.pages_)}},vettedFirstPage:{get:function(){return this.firstPage}},lastPage:{get:function(){return 0==this.pages_.length&&this.cacheChildren(),c.last(this.pages_)}},content:{get:function(){return null==this.content_&&this.cacheChildren(),this.content_}},colorTheme:{get:function(){return null==this.colorTheme_&&this.cacheChildren(),this.colorTheme_}},history:{get:function(){return null==this.history_&&this.cacheChildren(),this.history_}},watermarkEnabled:{get:function(){return!1},set:function(e){this.set(o.PROPERTY_WATERMARK_ENABLED,e)}},constrainedImages:{get:function(){var e;return(e=c.as(this.get(o.PROPERTY_CONSTRAINED_IMAGES),["Dictionary","String",["Dictionary","String",["Array","String"]]]))?e:{stockImages:{unlicensed:[],standard:[],extended:[],limited:[]}}}},setConstrainedImages:function(e){this.set(o.PROPERTY_CONSTRAINED_IMAGES,e)},controller:{get:function(){return this.controller_}},gridLibrary:{get:function(){return this.gridLibrary_}},maskSubstitutionController:{get:function(){return this.maskSubstitutionController_}},pageThumbnailCache:{get:function(){return this.pageThumbnailCache_}},recordMissingFont:function(e){this.missingFontsDuringOpen_.includes(e)||this.missingFontsDuringOpen_.push(e)},hadMissingFontsWhenOpened:{get:function(){return this.missingFontsDuringOpen_.length>0}},missingFontList:{get:function(){return this.missingFontsDuringOpen_}},getSynthesizedTitle:function(){return he.TheoDocumentUtils.synthesizeTitle(this)},getSynthesizedDescription:function(){return he.TheoDocumentUtils.synthesizeDescription(this)},setRemixParentCpId:function(e){var t=c.clone(c.as(this.get(o.PROPERTY_REMIX_ANCESTORS_CP_ASSET_IDS),["Array","String"]));null==t&&(t=[]),t.push(e),this.set(o.PROPERTY_REMIX_ANCESTORS_CP_ASSET_IDS,t)},getRemixAncestorsCpMachineTags:function(){var e=[],t=c.clone(c.as(this.get(o.PROPERTY_REMIX_ANCESTORS_CP_ASSET_IDS),["Array","String"]));if(null!=t&&t.length>0){e.push("_REMIX_"),e.push("_REMIX_PROGENITOR_"+t[0]);for(var n=t.length-1,r=c.iter(t);!r.done;r.next()){var a=r.value;e.push("_REMIX_FROM_"+a),e.push("_REMIX_FROM_"+a+"_"+n),n-=1}}return e},className:{get:function(){return o.SCHEMA_CLASS_NAME}},beginTransaction:function(e){return this.hostDB_.beginTransaction(e,this.hostDB_.mutableState)},beginUserAction:function(e){return new u.TheoDocumentUserAction(this,new _e.UserAction(e,_e.CollapseBehavior.NEVER,!0,null))},subscribeWithCallback:function(e,t){return this.publishing_.subscribeWithCallback(e,t)},subscribe:function(e,t){return this.publishing_.subscribe(e,t)},unsubscribe:function(e){return this.publishing_.unsubscribe(e)},onBeginTransaction:function(e,t){this.publishing_.publish(new se.TransactionBegunMessage(t,this))},onEndTransaction:function(e,t){this.publishing_.publish(new se.TransactionEndedMessage(t,this))},onStateChanged:function(e,t){},onObjectStateChanged:function(e,t){},didChangeState:function(e){C.DBHostObject.prototype.didChangeState.call(this,e),null!=e[o.PROPERTY_AUTHORING_CONTEXT_ID]&&(w.Host.logging.logForCategory(X.LogCategories.kTheoDocument,"DocumentDidChangeState: brandID to "+this.authoringContextID,G.LogLevelEnum.INFO_LEVEL),this.pendingAuthoringContextID=null),null!=e[o.PROPERTY_CHILDREN]&&(this.pages_=[],this.cacheChildren(!1))},willCommitState:function(){var e;if(this.initialized&&(!(!(e=c.as(this.get(o.PROPERTY_MODIFIED_SINCE_SHARE),"Bool"))&&null==e)&&e)!=this.modifiedSinceShare_){var t=this.database.beginTransaction("recordModification",null);this.set(o.PROPERTY_MODIFIED_SINCE_SHARE,this.modifiedSinceShare_),t.end()}C.DBHostObject.prototype.willCommitState.call(this)},willApplyDatabaseState:function(e){var t,n,r,a=this;z.LegacyCoreAssert.isTrue(null==this.atomicChangeEvent_,"found atomic change event in willApplyDatabaseState",void 0,"TheoDocument.willApplyDatabaseState","TheoDocument.swift",1030),z.LegacyCoreAssert.isTrue(null==this.pendingAuthoringContextID_,"found pending auth context in willApplyDatabaseState",void 0,"TheoDocument.willApplyDatabaseState","TheoDocument.swift",1031),this.atomicChangeEvent_=new M.FormaNullChangedEvent(Q.PagesFacade.getActivePage(this).root),this.pagesForUpdate_=c.clone(this.pages_);for(var i=c.iter(this.pages_);!i.done;i.next()){var s=i.value;s.beginUpdate(this.atomicChangeEvent_),s.root.visitAll(E.FormaTraversal.PreOrder,(function(e){var t;(t=e.controller)&&(t.beginBlockedUpdate(),a.blockedControllers_.push(t))}))}if((n=e.getObjectStateByID(this.id))&&(w.Host.logging.logForCategory(X.LogCategories.kTheoDocument,"willApplyDatabaseState: document brand is:"+this.authoringContextID,G.LogLevelEnum.INFO_LEVEL),null!=(r=c.opt(n.getProperty(o.PROPERTY_AUTHORING_CONTEXT_ID),(function(e){return e.stringValue}))))){var l=(t=c.opt(this.state.getProperty(o.PROPERTY_AUTHORING_CONTEXT_ID),(function(e){return e.stringValue})))||null!=t?t:"";r!=l&&(w.Host.logging.logForCategory(X.LogCategories.kTheoDocument,"willApplyDatabaseState: detected pending brand change for a document from:"+l+" to:"+r,G.LogLevelEnum.INFO_LEVEL),this.pendingAuthoringContextID=r)}},didApplyDatabaseState:function(e){for(var t=c.iter(this.pages_);!t.done;t.next())t.value.root.setParent(null,!0);if(z.LegacyCoreAssert.isTrue(null==this.pendingAuthoringContextID_,"found pending auth context in didApplyDatabaseState",void 0,"TheoDocument.didApplyDatabaseState","TheoDocument.swift",1067),this.blockedControllers_.forEach((function(e){return e.endBlockedUpdate()})),this.blockedControllers_.splice(0),this.recordModification(),z.LegacyCoreAssert.isTrue(null!=this.atomicChangeEvent_,"missing atomic change event in didApplyDatabaseState",void 0,"TheoDocument.didApplyDatabaseState","TheoDocument.swift",1071),null!=this.atomicChangeEvent_){for(var n=c.iter(this.pagesForUpdate_);!n.done;n.next())n.value.endUpdate(this.atomicChangeEvent_);this.atomicChangeEvent_=null}this.pagesForUpdate_=[]},inUndoRedo:{get:function(){return null!=this.atomicChangeEvent_}},appliedState:{get:function(){return this.database.appliedState||this.database.immutableState}},isFullSave:function(e){return!0},encodeDocument:function(e,t){if(void 0===t&&(t=null),this.isFullSave(t)){var n=this.beginTransaction("post_history_entry");this.history.postEntry("save"),n.mergeWithPrevious()}var r=A.DocumentPersistenceFactory.encoderFor(e.current);this.retrieveEncodedDocument(t,r)||this.encodeStateByID(t,r),r.finish()},retrieveEncodedDocument:function(e,t){var n,r,o=this;if(c.opt(w.Host.logging,(function(t){return t.info("retrieveEncodedDocument for "+o.uuid+" at "+c.toString(e))})),n=this.controller_.saveMgr.branchForState(e))if(r=n.getComponentWithAbsolutePath(W.JSON_CONTENT_PATH_DCX2D)){var a;if(a=c.as(t,W.JSONDocumentEncoder))return n.transferEncodingTo(t),a.jsonFile=n.getPathForComponent(r),w.Host.logging.logForCategory(X.LogCategories.kTheoDocument,"retrieveEncodedDocument: success",G.LogLevelEnum.INFO_LEVEL),this.lastMiniSaveStateID_=e,this.lastMiniSaveStateID_!=this.lastFullSaveStateID_&&(a.isMiniSave=!0),!0;w.Host.logging.logForCategory(X.LogCategories.kTheoDocument,"retrieveEncodedDocument: encoder is not a JSONDocumentEncoder",G.LogLevelEnum.WARN_LEVEL)}else w.Host.logging.logForCategory(X.LogCategories.kTheoDocument,"retrieveEncodedDocument could not find json dom component in cached branch",G.LogLevelEnum.WARN_LEVEL);else null!=e&&w.Host.logging.logForCategory(X.LogCategories.kTheoDocument,"retrieveEncodedDocument could not find branch for stateID",G.LogLevelEnum.WARN_LEVEL);return!1},encode:function(e){null!=this.hostDB_.mutableState&&z.LegacyCoreAssert.fail("Saving a document with mutable state",{transactions:this.hostDB_.transactionStackDescription},"TheoDocument.encode","TheoDocument.swift",1141),this.encodeStateToDataObject(this.database.immutableState,e)},encodeStateByID:function(e,t){var n=null!=e?this.database.getState(e):this.database.immutableState;z.LegacyCoreAssert.isTrue(null!=n,"State not found",{stateID:c.toString(e)},"TheoDocument.encodeStateByID","TheoDocument.swift",1149),z.LegacyCoreAssert.isFalse(n instanceof v.DBMutableState,"Encoding a mutable state",{stateID:c.toString(e)},"TheoDocument.encodeStateByID","TheoDocument.swift",1150),w.Host.logging.logForCategory(X.LogCategories.kTheoDocument,"TheoDocument.encodeStateByID: save "+this.uuid+" at "+n.guid,G.LogLevelEnum.INFO_LEVEL),this.isFullSave(e)&&(this.lastFullSaveStateID_=c.opt(n,(function(e){return e.guid})),this.lastMiniSaveStateID_=c.opt(n,(function(e){return e.guid}))),null!=n&&this.encodeStateToDataObject(n,t)},encodeToJSON:function(){var e=new fe.TheoJSONEncoder;return this.encodeStateToDataObject(this.appliedState,e),e.json()},encodeStateToDataObject:function(e,t){var n=c.clone(he.TheoDocumentUtils.getFontSourceUsage(this));t.setCompositeID(this.uuid),t.setType(o.MIME_TYPE),t.setDocumentSize(this.firstPage.pageSize,U.DocumentUnitsEnum.PIXEL),t.setProperty(o.PROPERTY_FONT_SOURCES,c.as(n,"AnyObject")),e.encode(t,o.CURRENT_VERSION)},formaByID:function(e){var t=Q.PagesFacade.getActivePage(this),n=t.formaByID(e);if(null!=n)return n;for(var r=c.iter(this.pages_);!r.done;r.next()){var o=r.value;if(o!=t&&null!=(n=o.formaByID(e)))return n}return null},getPageCount:function(){return this.pages_.length},getPageAtIndex:function(e){return e>=0&&e<this.pages_.length?this.pages_[e]:(f.CoreAssertDebugOnly.fail("Requested page at invalid index",{at:e,count:this.pages_.length},"TheoDocument.getPageAtIndex","TheoDocument.swift",1223),null)},getPagesAtIndices:function(e){for(var t=[],n=c.iter(e);!n.done;n.next()){var r,o=n.value;if(!(r=this.getPageAtIndex(o)))return null;t.push(r)}return t},getPageIndex:function(e){var t;return null!=(t=this.pageIdToIndex_[e.id])?t:null!=(t=c.indexOf(this.pages_,e))?(f.CoreAssertDebugOnly.fail("Page is in pages_, but not in pageIdToIndex_",{pageCount:this.pages_.length,dictCount:c.count(this.pageIdToIndex_),inUndoRedo:this.inUndoRedo},"TheoDocument.getPageIndex","TheoDocument.swift",1245),this.populatePageIdToIndexMap(),t):(f.CoreAssertDebugOnly.fail("Requested unkown page",{inUndoRedo:this.inUndoRedo},"TheoDocument.getPageIndex","TheoDocument.swift",1252),-1)},getPageById:function(e){var t;return null!=(t=this.pageIdToIndex_[e])?this.getPageAtIndex(t):null},addPage:function(e,t){f.CoreAssertDebugOnly.isTrue(null==c.indexOf(this.pages_,e),"page already in pages_",void 0,"TheoDocument.addPage","TheoDocument.swift",1264),f.CoreAssert.isTrue(t>=0&&t<this.pages_.length+1,"Requested page at invalid index",{at:t,count:this.pages_.length},"TheoDocument.addPage","TheoDocument.swift",1265),this.pages_.splice(t,0,e),this.saveChildren()},deletePage:function(e){var t;null!=(t=c.indexOf(this.pages_,e))?(this.pages_.splice(t,1),this.saveChildren()):f.CoreAssertDebugOnly.fail("Asked to delete a page that doesn't exist in pages array",void 0,"TheoDocument.deletePage","TheoDocument.swift",1277)},movePages:function(e,t){var n=this,r={};e.forEach((function(e){f.CoreAssertDebugOnly.isTrue(null==r[e.id],"duplicates in list of pages to move",void 0,"TheoDocument.movePages","TheoDocument.swift",1284),r[e.id]=!0}));for(var o=[],a=t,i=c.iter(c.toSequence(this.pages_));!i.done;i.next()){var s=i.value,l=s.offset,u=s.element;1==r[u.id]&&(o.splice(0,0,l),l<t&&(a-=1))}o.forEach((function(e){return n.pages_.splice(e,1)})),e.forEach((function(e){n.pages_.splice(a,0,e),a+=1})),this.saveChildren()},visitAll:function(e,t){for(var n=c.iter(this.pages_);!n.done;n.next())n.value.root.visitAll(e,(function(e){return t(e)}))},filterWithCallback:function(e,t){void 0===t&&(t=E.FormaTraversal.PreOrder);for(var n=[],r=c.iter(this.pages_);!r.done;r.next())r.value.root.visitAll(t,(function(t){e(t)&&n.push(t)}));return n},populatePageIdToIndexMap:function(){this.pageIdToIndex_={};for(var e=c.iter(c.toSequence(this.pages_));!e.done;e.next()){var t=e.value,n=t.offset,r=t.element;f.CoreAssertDebugOnly.isTrue(null==this.pageIdToIndex_[r.id],"duplicates in list of pages",void 0,"TheoDocument.populatePageIdToIndexMap","TheoDocument.swift",1330),this.pageIdToIndex_[r.id]=n}},saveChildren:function(){if(0==!this.pages_.length&&null!=this.content_&&null!=this.colorTheme_&&null!=this.history_){var e=c.clone(this.pages_);e=e.concat([this.content_,this.colorTheme_,this.history_]),this.set(o.PROPERTY_CHILDREN,e),this.set(o.PROPERTY_PAGE_COUNT,this.pages_.length),this.set(o.PROPERTY_FIRST_PAGE_SIZE,this.firstPage.pageSize)}this.populatePageIdToIndexMap()},cacheChildren:function(e){var t,n,r,a;if(void 0===e&&(e=!0),a=c.as(this.get(o.PROPERTY_CHILDREN),["Array",C.DBObject]))for(var i=c.iter(a);!i.done;i.next()){var s,l=i.value;(s=c.as(l,b.FormaPage))&&(f.CoreAssertDebugOnly.isTrue(null==c.indexOf(this.pages_,s),"page already in pages_",void 0,"TheoDocument.cacheChildren","TheoDocument.swift",1355),this.pages_.push(s)),this.content_=(t=c.as(l,m.ContentDocument))||null!=t?t:this.content_,this.colorTheme_=(n=c.as(l,T.ColorThemeDocument))||null!=n?n:this.colorTheme_,this.history_=(r=c.as(l,S.DocumentHistory))||null!=r?r:this.history_}var u=!1;if(e){var d=0==this.pages_.length||null==this.content_||null==this.colorTheme_||null==this.history_;if(0==this.pages_.length){var h=b.FormaPage.init_d0e4(this);this.pages_.push(h)}null==this.content_&&(this.content_=m.ContentDocument.init_26a9(this,null)),null==this.colorTheme_&&(this.colorTheme_=T.ColorThemeDocument.init_d0e4(this)),null==this.history_&&(this.history_=S.DocumentHistory.init_d0e4(this)),d&&(this.saveChildren(),u=!0)}u||this.populatePageIdToIndexMap()},requestSaveDocumentAt:function(e){var t,n;return(t=w.Host.asyncPersist)&&null!=(n=e)?t.saveStateAsync(n):(this.publishing_.publish(new u.TheoDocumentRequestsSaveMessage(this,e)),y.CorePromise.resolve(null))}}}),o),u.DummyExport=(i=function(e){var t;void 0===e&&(e=null),this.prefix=(t=e)||null!=t?t:""},c.defineClass({name:"DummyExport",ctor:i,statics:{_implements:function(e){return"IExportDataObject"==e}},props:{setPath:function(e){c.info(this.prefix+"setPath path: "+e)},setName:function(e){c.info(this.prefix+"setName name: "+e)},setType:function(e){c.info(this.prefix+"setType type: "+e)},setProperty:function(e,t){c.info(this.prefix+"setProperty","name:",e,"value:",t||"nil")},setOptionalStringProperty:function(e,t){var n;c.info(this.prefix+"setOptionalStringProperty","name:",e,"value:",(n=t)||null!=n?n:"nil")},setStringProperty:function(e,t){c.info(this.prefix+"setStringProperty","name:",e,"value:",t)},setNumberProperty:function(e,t){c.info(this.prefix+"setNumberProperty","name:",e,"value:",t)},setIntProperty:function(e,t){c.info(this.prefix+"setIntProperty","name:",e,"value:",t)},setBooleanProperty:function(e,t){c.info(this.prefix+"setBooleanProperty","name:",e,"value:",t)},setOptionalBooleanProperty:function(e,t){var n;c.info(this.prefix+"setOptionalBooleanProperty","name:",e,"value:",(n=t)||null!=n?n:"nil")},findChild:function(e){return null},appendChild:function(e){return c.info(this.prefix+"appendChild id: "+e),new i("child "+e+" ")},appendComponent:function(e,t,n){c.info(this.prefix+"appendComponent","id:",e,"url:",t,"mimeType:",n)},setCompositeID:function(e){c.info(this.prefix+"setCompositeID","uuid:",e)},setManifestProperty:function(e,t,n){c.info(this.prefix+"setManifestProperty","name:",e,"value:",t||"nil","prependNamespace:",n)},setDocumentSize:function(e,t){c.info(this.prefix+"setDocumentSize","size:",e,"units:",t)}}}),i),u.VersionInfo=function(){var e=function(e){var t;this.vers=(t=u.TheoDocumentVersion.toCaseValue(e))||null!=t?t:u.TheoDocumentVersion.Invalid,this.minor=e%1e3,this.major=e-this.minor},t={};return c.defineClass({name:"VersionInfo",ctor:e,superName:"CoreObject",statics:{UNKNOWN:{get:function(){return void 0===t.UNKNOWN&&(t.UNKNOWN=new e(0)),t.UNKNOWN}},fromProperty:function(t){var n;return null!=(n=c.as(t,"Int"))?new e(n):e.UNKNOWN}},props:{description:{get:function(){return"Version Major: "+c.toString(this.major)+", minor: "+c.toString(this.minor)}},rawValue:{get:function(){return this.major+this.minor}}}}),e}(),u.TheoDocumentMessage=(s=function(e,t){me.TheoMessage.call(this,e,t)},c.defineClass({name:"TheoDocumentMessage",ctor:s,superName:"TheoMessage",props:{document:{get:function(){return c.as(this.publisher,u.TheoDocument)}}}}),s),u.TheoDocumentRequestsSaveMessage=(l=function e(t,n){this.stateID=n,u.TheoDocumentMessage.call(this,e.TYPE,t)},c.defineClass({name:"TheoDocumentRequestsSaveMessage",ctor:l,superName:"TheoDocumentMessage",statics:{TYPE:"TheoDocumentRequestsSaveMessage"}}),l)},"9a+Y":function(e,t,n){var r,o,a=t,i=n("oAGj"),s=n("HRWw"),l=n("A6KL"),u=n("iCxV"),c=n("q5zr"),d=n("fNpk"),h=n("Quhx"),p=n("AxS/"),f=n("lJxM"),m=n("9YN4"),g=n("LGJg"),y=n("sW6f");a.ContentDocument=(r=function(){this.factory_={}},o={},i.defineClass({name:"ContentDocument",ctor:r,superName:"PostDCXObject",statics:{SCHEMA_CLASS_NAME:"ContentDocument",factory:{get:function(){return void 0===o.factory&&(o.factory=function(e,t,n,o){var a=i.as(i.opt(i.opt(o,(function(e){return e.backLink})),(function(e){return e.dereference()})),m.TheoDocument);return d.LegacyCoreAssert.isTrue(null!=a,"ContentDocument needs a parent document",void 0,"ContentDocument","ContentDocument.swift",15),r.init_3144(e,t,n,a)}),o.factory},set:function(e){o.factory=e}},PROPERTY_CHILDREN:"children",DCXTYPE:{get:function(){return"application/vnd.adobe.theo.content+dcx"}},PATH:{get:function(){return"content"}},_implements:function(e){return"IDBObject"==e||"TheoMessagePublisher"==e}},props:{initFactories:function(){this.factory_[p.RootContentNode.KIND]=function(e,t,n){return p.RootContentNode.init_5972(e,n)},this.factory_[l.GroupContentNode.KIND]=function(e,t,n){return l.GroupContentNode.init_5972(e,n)},this.factory_[c.ImageContentNode.KIND]=function(e,t,n){return c.ImageContentNode.init_5972(e,n)},this.factory_[g.VectorContentNode.KIND]=function(e,t,n){return g.VectorContentNode.init_5972(e,n)},this.factory_[f.TextContentNode.KIND]=function(e,t,n){return f.TextContentNode.init_5972(e,n)},this.factory_[y.VideoContentNode.KIND]=function(e,t,n){return y.VideoContentNode.init_5972(e,n)}},init_3144:function(e,t,n,r){this.parent_=r,i.super_init(this,h.PostDCXObject,h.PostDCXObject.prototype.init_3181,t,n,e),this.initFactories()},init_26a9:function(e,t){this.parent_=e,i.super_init(this,h.PostDCXObject,h.PostDCXObject.prototype.init_11e0,e.database),this.set(h.PostDCXObject.PROPERTY_PATH,r.PATH),this.set(h.PostDCXObject.PROPERTY_TYPE,r.DCXTYPE),this.initFactories(),this.root_=p.RootContentNode.init_5972(this,t)},className:{get:function(){return r.SCHEMA_CLASS_NAME}},parent:{get:function(){return this.parent_}},root_:{get:function(){var e;return(e=i.as(this.get(r.PROPERTY_CHILDREN),["Array",s.ContentNode]))?i.as(i.first(e),p.RootContentNode):null},set:function(e){if(null!=e){var t=i.clone(i.as(this.get(r.PROPERTY_CHILDREN),["Array",s.ContentNode]));null!=t&&t.length>0?t[0]=e:t=[i.as(e,s.ContentNode)],this.set(r.PROPERTY_CHILDREN,t)}}},root:{get:function(){return this.root_}},nodeByID:function(e){return this.root.nodeByID(e)},nodeWithTag:function(e,t){return this.root.nodeWithTag(e,t)},createNode:function(e,t){var n=this.factory_[e];return null==n?(i.opt(u.Host.logging,(function(t){return t.warning("Could not instantiate a contentnode of kind "+e+": no factory")})),null):n(this,e,t)},publishForChild:function(e){this.publish(e)},postDecode:function(){this.root.postDecode()}}}),r)},"9eTw":function(e,t,n){var r=t,o=n("oAGj");r.DocumentUnitsEnum=o.defineEnum("DocumentUnitsEnum",{PIXEL:"pixel",POINT:"point",INCH:"inch",MM:"mm",CM:"cm"}),r.IExportDataObject=o.defineProtocol("IExportDataObject",{setPath:"(String) -> Void",setName:"(String) -> Void",setType:"(String) -> Void",setProperty:"(String, AnyObject) -> Void",setOptionalStringProperty:"(String, String) -> Void",setStringProperty:"(String, String) -> Void",setNumberProperty:"(String, Double) -> Void",setIntProperty:"(String, Integer) -> Void",setBooleanProperty:"(String, Boolean) -> Void",setOptionalBooleanProperty:"(String, Boolean) -> Void",findChild:"(String) -> IExportDataObject",appendChild:"(String) -> IExportDataObject",appendComponent:"(String, String, String) -> Void",setCompositeID:"(String) -> Void",setManifestProperty:"(String, AnyObject, Boolean) -> Void",setDocumentSize:"(TheoSize, String) -> Void"})},"9oQN":function(e,t,n){var r,o=t,a=n("oAGj"),i=n("cZuM"),s=n("Z25M"),l=n("FNB+"),u=n("6ZWm"),c=n("JO5d"),d=n("8t9B");o.EvaluationUtils=(r=function(){},a.defineClass({name:"EvaluationUtils",ctor:r,statics:{getFormaOutOfBounds:function(e){for(var t,n={},r=a.iter(e);!r.done;r.next()){var o,i,s=r.value;if((o=s.finalFrame)&&(i=a.opt(s.root,(function(e){return e.finalFrame})))){var l=(t=a.opt(o.intersectionWith(i),(function(e){return e.area})))||null!=t?t:0;n[s.formaID]=1-l/o.area}}return n},evaluateOutOfBounds:function(e,t,n){for(var r,o,i=[],s=a.iter(a.keys(n));!s.done;s.next()){var l=s.value,u=(r=t[l])||null!=r?r:0,c=(o=n[l])||null!=o?o:0;if(u<.01||c>.99){var d=Math.abs(u-c);d>.001&&i.push(d)}}return i.reduce((function(e,t){return e+t}),0)},getFormaOverlap:function(e){var t,n={};if(e.length>1)for(var r=a.iter(a.range(0,e.length-1,!1));!r.done;r.next())for(var o=r.value,i=a.iter(a.range(o+1,e.length,!1));!i.done;i.next()){var s,l,u=i.value,c=e[o],d=e[u];if((s=c.finalFrame)&&(l=d.finalFrame)){var h=(t=a.opt(s.intersectionWith(l),(function(e){return e.area})))||null!=t?t:0;h>0&&(n[c.formaID+d.formaID]=h/s.area,n[d.formaID+c.formaID]=h/l.area)}}return n},evaluateOverlap:function(e,t,n){for(var r,o,i=[],s=[],u=[],c=a.iter(e);!c.done;c.next())for(var d=c.value,h=a.iter(e);!h.done;h.next()){var p=h.value;if(!a.eq(l._equality_Forma_Forma,d,p)){var f=(r=t[d.formaID+p.formaID])||null!=r?r:0,m=(o=n[d.formaID+p.formaID])||null!=o?o:0;if(f<=.01){var g=Math.abs(m-f);g>.01&&(d.isText()&&p.isText()?i.push(g):d.isGraphic()&&p.isGraphic()?s.push(g):u.push(g))}}}return{textOverlap:i.reduce((function(e,t){return e+t}),0),graphicOverlap:s.reduce((function(e,t){return e+t}),0),graphicTextOverlap:u.reduce((function(e,t){return e+t}),0)}},getFormaAlignment:function(e){for(var t=e.filter((function(e){return e.isTypeLockup()}),this),n=t.filter((function(e){return Math.acos(e.totalPlacement.transformValues.rotCosine)<.01}),this),r={},o=a.iter(n);!o.done;o.next())for(var l=o.value,u=a.clone(l.controller.alignmentDetector.detectFormaAlignments(i.AlignmentDetector.DISTANCE_THRESHOLD)),c=a.iter(s.DesignFeatureUtils.getSetDiff(t,u));!c.done;c.next()){var d=c.value;r[l.formaID+d.formaID]=1,r[d.formaID+l.formaID]=1}return r},evaluateAlignment:function(e,t,n){for(var r,o,i=0,s=0,u=a.iter(e);!u.done;u.next())for(var c=u.value,d=a.iter(e);!d.done;d.next()){var h=d.value;if(!a.eq(l._equality_Forma_Forma,c,h)){var p=(r=t[c.formaID+h.formaID])||null!=r?r:0,f=(o=n[c.formaID+h.formaID])||null!=o?o:0;1==p&&(s+=1,i+=Math.abs(p-f))}}return i/(s+.001)},getFormaSizes:function(e){for(var t={},n=a.iter(e);!n.done;n.next()){var r,o=n.value;(r=a.as(o.controller,d.TypeLockupController))?t[o.formaID]=r.getCurrentFontSize():t[o.formaID]=o.finalFrame.area}return t},evaluateSizeDifferences:function(e,t,n){for(var r=[],o=[],i=a.iter(e);!i.done;i.next()){var s,l,u=i.value;if(null!=(s=t[u.formaID])&&null!=(l=n[u.formaID]))if(u.isTypeLockup())s>d.TypeLockupController.MIN_LINE_HEIGHT&&l<.5*d.TypeLockupController.MIN_LINE_HEIGHT?r.push(s-l):r.push(0);else{var c=u.root.finalFrame.area/50;s>c&&l<.25*c?o.push(Math.abs(s-l)/Math.max(s,l)):o.push(0)}}return{textDiff:r.reduce((function(e,t){return e+t}),0),graphicDiff:o.reduce((function(e,t){return e+t}),0)}},getEmptySpace:function(e){for(var t,n=a.opt(e.finalFrame,(function(e){return e.insetRel(.15,.15,.15,.15)})),r=null,o=a.iter(e.visitAsArray(l.FormaTraversal.PreOrder));!o.done;o.next()){var i,s=o.value;if((i=s.controller)&&(i.kind==u.FrameController.KIND||i.kind==d.TypeLockupController.KIND||i.kind==c.ShapeController.KIND)){if(s.isShape()&&!s.hasIntent(l.Forma.INTENT_ICON))continue;var h,p;(h=n)&&(p=a.opt(s.finalFrame,(function(e){return e.intersectionWith(h)})))&&(r=null==r?p:a.opt(r,(function(e){return e.unionWith(p)})))}}return(t=r)&&(h=n)?1-Math.min(t.area/h.area,1):0}}}),r)},A6KL:function(e,t,n){var r,o=t,a=n("oAGj"),i=n("dNOY"),s=n("HRWw"),l=n("fNpk");o.GroupContentNode=(r=function(){},a.defineClass({name:"GroupContentNode",ctor:r,superName:"ContentNode",statics:{KIND:{get:function(){return"group"}},SCHEMA_CLASS_NAME:{get:function(){return"GroupContentNode"}},factory:{get:function(){return function(e,t,n,o){var i=a.as(a.opt(a.opt(o,(function(e){return e.backLink})),(function(e){return e.dereference()})),r);return l.LegacyCoreAssert.isTrue(null!=i,"Non-root group content nodes need a parent",void 0,"GroupContentNode","GroupContentNode.swift",16),r.init_3144(e,t,n,i)}}},PROPERTY_CHILDREN:"children",_implements:function(e){return"IDBObject"==e||"TheoMessagePublisher"==e}},props:{init_3144:function(e,t,n,r){a.super_init(this,s.ContentNode,s.ContentNode.prototype.init_3144,e,t,n,r)},init_5e75:function(e,t,n,r){a.super_init(this,s.ContentNode,s.ContentNode.prototype.init_5e75,e,t,n,r)},init_8b5c:function(e,t,n){a.super_init(this,s.ContentNode,s.ContentNode.prototype.init_8b5c,e,t,n)},init_5972:function(e,t){a.super_init(this,s.ContentNode,s.ContentNode.prototype.init_8b5c,e,"group",t)},init_26a9:function(e,t){a.super_init(this,s.ContentNode,s.ContentNode.prototype.init_c3fa,e,"group",t)},className:{get:function(){return r.SCHEMA_CLASS_NAME}},children_:{get:function(){var e;return(e=a.as(this.get(r.PROPERTY_CHILDREN),["Array",s.ContentNode]))||null!=e?e:[]}},nodeByID:function(e){if(e==this.id)return this;for(var t=a.iter(this.children_);!t.done;t.next()){var n=t.value;if(null!=n.nodeByID(e))return n}return null},nodeWithTag:function(e,t){if(this.getTag(e)==t)return this;for(var n=a.iter(this.children_);!n.done;n.next()){var r=n.value;if(null!=r.nodeWithTag(e,t))return r}return null},insertChildrenAt:function(e,t){for(var n=e,o=a.iter(t);!o.done;o.next())null!=(c=o.value).parent&&(l.LegacyCoreAssert.isTrue(c.parent!=this,"attempting to insert a child that is already a child",void 0,"GroupContentNode.insertChildrenAt","GroupContentNode.swift",81),c.parent.removeChild(c));for(var s=a.clone(this.children_),u=a.iter(t);!u.done;u.next()){var c;(c=u.value).parent=this,s.splice(n,0,c)}this.set(r.PROPERTY_CHILDREN,s),this.publish(new i.InsertedContentChildrenMessage(this,e,t))},removeChildrenAt:function(e,t){if(e<0||t<0||e+t>this.children_.length)l.LegacyCoreAssert.fail("removeChildrenAt: invalid index and/or count",void 0,"GroupContentNode.removeChildrenAt","GroupContentNode.swift",98);else{var n=a.clone(this.children_),o=n.splice(e,t);this.set(r.PROPERTY_CHILDREN,n);for(var s=a.iter(o);!s.done;s.next())s.value.parent=null;this.publish(new i.RemovedContentChildrenMessage(this,e,o))}},appendChild:function(e){this.insertChildrenAt(this.children_.length,[e])},insertChild:function(e,t){this.insertChildrenAt(e,[t])},removeChild:function(e){var t;l.LegacyCoreAssert.isTrue(e.parent==this,"can't remove child that doesn't belong to me",void 0,"GroupContentNode.removeChild","GroupContentNode.swift",121),e.parent==this&&null!=(t=a.indexOf(this.children_,e))&&this.removeChildrenAt(t,1)},removeChildAt:function(e){l.LegacyCoreAssert.isTrue(e>=0&&e<this.children_.length,"index out of range",void 0,"GroupContentNode.removeChildAt","GroupContentNode.swift",130),this.removeChildrenAt(e,1)},removeAllChildren:function(){this.removeChildrenAt(0,this.children_.length)},childAt:function(e){return l.LegacyCoreAssert.isTrue(e>=0&&e<this.children_.length,"index out of range",void 0,"GroupContentNode.childAt","GroupContentNode.swift",139),this.children_[e]},childCount:{get:function(){return this.children_.length}},forEachChild:function(e){for(var t=a.iter(this.children_);!t.done;t.next())e(t.value)},visit:function(e){if(e(this))return this;for(var t=a.iter(this.children_);!t.done;t.next()){var n=t.value;if(e(n))return n}return null},didChangeState:function(e){var t;if(null!=(t=e[r.PROPERTY_CHILDREN])){var n=this.getCodec(r.PROPERTY_CHILDREN);l.LegacyCoreAssert.isTrue(null!=n,"State changed before codecs registered.",void 0,"GroupContentNode.didChangeState","GroupContentNode.swift",170);var o,u,c=a.clone(a.as(n.decode(t[0],this),["Array",s.ContentNode])),d=a.clone(a.as(n.decode(t[1],this),["Array",s.ContentNode]));if((o=c)&&this.publish(new i.RemovedContentChildrenMessage(this,0,o)),u=d){for(var h=a.iter(u);!h.done;h.next()){var p=h.value;l.LegacyCoreAssert.isTrue(null==p.parent||p.parent===this,"Changing this group's state shouldn't rip a child from its old parent",void 0,"GroupContentNode.didChangeState","GroupContentNode.swift",182),null==p.parent&&(p.parent=this)}this.publish(new i.InsertedContentChildrenMessage(this,0,u))}}s.ContentNode.prototype.didChangeState.call(this,e)}}}),r)},"AxS/":function(e,t,n){var r,o=t,a=n("oAGj"),i=n("9a+Y"),s=n("A6KL"),l=n("fNpk");o.RootContentNode=(r=function(){},a.defineClass({name:"RootContentNode",ctor:r,superName:"GroupContentNode",statics:{KIND:{get:function(){return"root"}},SCHEMA_CLASS_NAME:{get:function(){return"RootContentNode"}},factory:{get:function(){return function(e,t,n,o){var s=a.as(a.opt(a.opt(o,(function(e){return e.backLink})),(function(e){return e.dereference()})),i.ContentDocument);return l.LegacyCoreAssert.isTrue(null!=s,"Root content node needs a content document parent",void 0,"RootContentNode","RootContentNode.swift",18),r.init_5e75(e,t,n,s)}}},DOCUMENT_SOURCE_ID_TAG:"document:source:id",DOCUMENT_SOURCE_TYPE_TAG:"document:source:type",THEME_ID_TAG:"theme:id",PALETTE_ID_TAG:"palette:id",SUMMIT_LOGO_TAG:"SummitLogo",_implements:function(e){return"IDBObject"==e||"TheoMessagePublisher"==e}},props:{init_5e75:function(e,t,n,r){a.super_init(this,s.GroupContentNode,s.GroupContentNode.prototype.init_5e75,e,t,n,r)},init_5972:function(e,t){a.super_init(this,s.GroupContentNode,s.GroupContentNode.prototype.init_8b5c,e,"root",t)},className:{get:function(){return r.SCHEMA_CLASS_NAME}}}}),r)},B8ge:function(e,t,n){var r,o,a,i,s,l,u=t,c=n("oAGj"),d=n("gXiO"),h=n("iCxV"),p=n("fNpk"),f=n("tGKA"),m=n("3DEm"),g=n("oTAR"),y=n("hgLm"),_=n("oKlP"),T=n("sIWg");u.svg_item=(r=function(){},c.defineClass({name:"svg_item",ctor:r,props:{visit:function(e,t){return p.LegacyCoreAssert.fail("subclass must implement",void 0,"svg_item.visit","SVGParser.swift",15),[]}}}),r),u.svg_path=(o=function(){this.path_transform=f.Matrix2D.Identity,this.path_outline=null,u.svg_item.call(this)},c.defineClass({name:"svg_path",ctor:o,superName:"svg_item",props:{visit:function(e,t){if(!this.path_outline.isOnlyMoves()){var n=this.path_transform.concat(t),r=y.TheoArbitraryPath.ArbitraryPathFromPath(this.path_outline,n);if(null==e)return[r];var o=r.bounds;if(0==o.area&&(o=T.TheoRect.fromXYWH(o.minX,o.minY,o.width+.1,o.height+.1)),e.intersects(o))return[r]}return[]}}}),o),u.svg_group=(a=function(){this.items=[],this.group_attributes={},u.svg_item.call(this)},c.defineClass({name:"svg_group",ctor:a,superName:"svg_item",props:{addItem:function(e){this.items.push(e)},addAttribute:function(e,t){this.group_attributes[e]=t},visit:function(e,t){var n=[];if("none"!=this.group_attributes.display)for(var r=this.group_attributes.transform,o=g.SVGParserUtils.parseSVGTransform(r).concat(t),a=c.iter(this.items);!a.done;a.next()){var i=a.value;n=n.concat(i.visit(e,o))}return n}}}),a),u.svg_dom=(i=function(){this.root_item=null,this.view_box=T.TheoRect.Zero,this.slice_box=T.TheoRect.Zero,this.content_region=T.TheoRect.Zero,this.custom_attributes={"stroke-base-weight":0,"stroke-multiplier-initial":1,"stroke-multiplier-min":1,"stroke-multiplier-max":1,"prescale-base":1,"prescale-min":1,"prescale-max":1},d.CoreObject.call(this)},c.defineClass({name:"svg_dom",ctor:i,superName:"CoreObject"}),i),u.SVGPathData=(s=function(e,t,n,r,o,a,i){this.paths=c.clone(e),this.viewBox=t,this.sliceBox=n,this.contentBox=r,this.hasNoPaths=o,this.usedTags=c.clone(a),this.customAttributes=c.clone(i),this.shapeType=g.SVGParserUtils.shapeTypeFromPaths(e)},c.defineClass({name:"SVGPathData",ctor:s,superName:"CoreObject"}),s),u.k_radians_per_degree=.017453292519943295,u.SVGParser=(l=function(){this._currentElementValue=null,this._dom=new u.svg_dom,this._stack=[],this._ignoringUnknownTag=null,this._usedTags=[],this._styleClasses={},this._elementAttrDict={},this._currentGroupAttrDict={},d.CoreObject.call(this)},c.defineClass({name:"SVGParser",ctor:l,superName:"CoreObject",statics:{collectTagDataForTest:!1},props:{createTheoPathFromParsedDom:function(){var e=null;this._dom.view_box.width>0&&this._dom.view_box.height>0&&(e=this._dom.view_box);var t=!1,n=c.clone(c.opt(this._dom.root_item,(function(t){return t.visit(e,f.Matrix2D.Identity)}))||[]);if(0==n.length&&null!=e){t=!0,c.info("SVGParser:failed to get any paths for parsed SVG. drawing an X so there's something to see");var r=(e.width+e.height)/15,o=Math.round(r/2),a=y.TheoPathBuilder.init_31cf(y.TheoPath.PATHFILL_NONE,y.TheoPath.PATHEND_ROUND,y.TheoPath.PATHJOIN_BEVEL,o,o),i=e.insetXY(r,r);a.rectangle(e.minX,e.minY,e.maxX,e.maxY),a.moveTo(i.minX,i.minY),a.lineTo(i.maxX,i.maxY),a.moveTo(i.maxX,i.minY),a.lineTo(i.minX,i.maxY),n.push(a.path)}return new u.SVGPathData(n,this._dom.view_box,this._dom.slice_box,this._dom.content_region,t,this._usedTags,this._dom.custom_attributes)},handleStringValue:function(e){null==this._currentElementValue?this._currentElementValue=e.trim():this._currentElementValue=this._currentElementValue+e},parseStyleClassDefinitions:function(e){for(var t=c.clone(h.Host.pathUtils.matchesForRegexInString("\\.[\\w-]+[,\\.[\\w-]+]*\\s*\\{[^\\}]*\\}",e)),n=c.iter(t);!n.done;n.next()){var r,o,a=n.value;if(null!=(r=c.indexOf(a,"{"))&&null!=(o=c.indexOf(a,"}")))for(var i=a.substr(0,r),s=a.substr(r+1,o-r-1),l=i.split(","),u=c.iter(l);!u.done;u.next()){var d=u.value,p=h.Host.pathUtils.firstMatchForRegexInString("[\\w-]+",d).trim(),f=c.clone(g.SVGParserUtils.parseStyleStringToAttrDict(s)),m=c.clone(this._styleClasses[p]);if(null!=m){for(var y=c.iter(f);!y.done;y.next()){var _=y.key,T=y.value;m[_]=T}this._styleClasses[p]=c.clone(m)}else this._styleClasses[p]=c.clone(f)}}},mergeIntoAttrDict:function(e,t){for(var n=c.iter(e);!n.done;n.next()){var r=n.key,o=n.value;t&&"transform"==r||null==this._elementAttrDict[r]&&(this._elementAttrDict[r]=o)}},mergeStyleClassAttributes:function(e){for(var t=e.split(" "),n=c.iter(this._styleClasses);!n.done;n.next())for(var r=n.key,o=n.value,a=c.iter(t);!a.done;a.next())r==a.value&&this.mergeIntoAttrDict(o,!1)},getSVGFillType:function(e){var t=y.TheoPath.PATHFILL_NONZERO;return"none"==e.fill?t=y.TheoPath.PATHFILL_NONE:"evenodd"==e["fill-rule"]&&(t=y.TheoPath.PATHFILL_EVENODD),t},beginElement:function(e,t){if(l.collectTagDataForTest&&!this._usedTags.includes(e)&&(null!=this._ignoringUnknownTag?this._usedTags.push(this._ignoringUnknownTag+"/"+e):this._usedTags.push(e)),null==this._ignoringUnknownTag){this._elementAttrDict=c.clone(t);var n=this._elementAttrDict.style;if(null!=n){var r=c.clone(g.SVGParserUtils.parseStyleStringToAttrDict(n));this.mergeIntoAttrDict(r,!1)}null!=(n=this._elementAttrDict.class)&&this.mergeStyleClassAttributes(this._elementAttrDict.class);for(var o=c.iter(c.reverse(this._stack));!o.done;o.next()){var a=o.value;this.mergeIntoAttrDict(a.group_attributes,!0)}n=this._elementAttrDict.transform;var i=f.Matrix2D.Identity;null!=n&&(i=g.SVGParserUtils.parseSVGTransform(n));var s=this.getSVGFillType(this._elementAttrDict),d=g.SVGParserUtils.getSVGEndcapType(this._elementAttrDict),C=g.SVGParserUtils.getSVGPathJoin(this._elementAttrDict),v=g.SVGParserUtils.getSVGSMiterLimit(this._elementAttrDict),P=g.SVGParserUtils.getSVGStrokeWt(this._elementAttrDict),S=this._elementAttrDict.display;if(P>0){var A=i.calculateTransformValuesSKRT(),D=m.MathUtils.getMean([A.xscale,A.yscale]);D>0&&1!=D&&(P*=D)}if("svg:svg"==e||"svg"==e){p.LegacyCoreAssert.isTrue(null==this._dom.root_item,"nil root item",void 0,"SVGParser.beginElement","SVGParser.swift",401);var E=new u.svg_group;this._dom.root_item=E,this._stack.push(E),this._dom.view_box=g.SVGParserUtils.parseSVGBox(this._elementAttrDict.viewBox);var R=g.SVGParserUtils.parseSVGBox(this._elementAttrDict.sliceBox);R.minX>=this._dom.view_box.minX&&R.maxX<=this._dom.view_box.maxX&&R.minY>=this._dom.view_box.minY&&R.maxY<=this._dom.view_box.maxY&&(this._dom.slice_box=R),this._dom.content_region=g.SVGParserUtils.parseSVGBox(this._elementAttrDict.contentRegion),this._dom.custom_attributes={"stroke-base-weight":g.SVGParserUtils.getSVGStrokeBaseWeight(this._elementAttrDict),"stroke-multiplier-initial":g.SVGParserUtils.getSVGStrokeMultiplierInitial(this._elementAttrDict),"stroke-multiplier-min":g.SVGParserUtils.getSVGStrokeMultiplierMin(this._elementAttrDict),"stroke-multiplier-max":g.SVGParserUtils.getSVGStrokeMultiplierMax(this._elementAttrDict),"prescale-base":g.SVGParserUtils.getSVGPrescaleBase(this._elementAttrDict),"prescale-min":g.SVGParserUtils.getSVGPrescaleMin(this._elementAttrDict),"prescale-max":g.SVGParserUtils.getSVGPrescaleMax(this._elementAttrDict)};for(var F=c.iter(this._elementAttrDict);!F.done;F.next()){var I=F.key,b=F.value;E.addAttribute(I,b)}if(l.collectTagDataForTest){var O="Creating App: ";null!=this._elementAttrDict["xmlns:inkscape"]?O+=this._elementAttrDict["xmlns:inkscape"]:null!=this._elementAttrDict["xmlns:sketch"]?O+=this._elementAttrDict["xmlns:sketch"]:null!=this._elementAttrDict["xmlns:serif"]?O+=this._elementAttrDict["xmlns:serif"]:null!=this._elementAttrDict["xmlns:i"]?O+=this._elementAttrDict["xmlns:i"]:O+="unknown",this._usedTags.push(O)}}else if("svg:g"==e||"g"==e){E=new u.svg_group,c.last(this._stack).addItem(E),this._stack.push(E);for(var k=c.iter(this._elementAttrDict);!k.done;k.next())I=k.key,b=k.value,E.addAttribute(I,b)}else if("svg:circle"==e||"circle"==e||"svg:ellipse"==e||"ellipse"==e){if("none"==S)return;var M=g.SVGParserUtils.getAttrDoubleForKey(this._elementAttrDict,"r",0),N=g.SVGParserUtils.getAttrDoubleForKey(this._elementAttrDict,"rx",-1),L=g.SVGParserUtils.getAttrDoubleForKey(this._elementAttrDict,"ry",-1);if(-1==N&&-1!=L?N=L:-1==L&&-1!=N?L=N:-1==N&&-1==L&&(N=M,L=M),0==N||0==L)return;p.LegacyCoreAssert.isTrue(N>=0&&L>=0,"circle with negative radius?",void 0,"SVGParser.beginElement","SVGParser.swift",495);var x=g.SVGParserUtils.getAttrDoubleForKey(this._elementAttrDict,"cx",0),B=g.SVGParserUtils.getAttrDoubleForKey(this._elementAttrDict,"cy",0),w=new u.svg_path;c.last(this._stack).addItem(w),w.path_transform=i;var G=T.TheoRect.fromXYWH(x-N,B-L,2*N,2*L);(Z=y.TheoPathBuilder.init_31cf(s,d,C,P,v)).ellipse(G.minX,G.minY,G.maxX,G.maxY),w.path_outline=Z.path}else if("svg:line"==e||"line"==e){if("none"==S)return;var Y=g.SVGParserUtils.getAttrDoubleForKey(this._elementAttrDict,"x1",0),U=g.SVGParserUtils.getAttrDoubleForKey(this._elementAttrDict,"y1",0),V=g.SVGParserUtils.getAttrDoubleForKey(this._elementAttrDict,"x2",0),j=g.SVGParserUtils.getAttrDoubleForKey(this._elementAttrDict,"y2",0);w=new u.svg_path,c.last(this._stack).addItem(w),w.path_transform=i,(Z=y.TheoPathBuilder.init_31cf(y.TheoPath.PATHFILL_NONE,d,C,P,v)).moveTo(Y,U),Z.lineTo(V,j),w.path_outline=Z.path}else if("svg:polyline"==e||"polyline"==e||"svg:polygon"==e||"polygon"==e){if("none"==S)return;if(n=this._elementAttrDict.points,0==(ae=(Q=c.clone(g.SVGParserUtils.scanCoordinateData(n))).length)||ae%2!=0)return;for(var H=[],W=0;W<ae;){var K=h.Host.pathUtils.parseStringToDouble(Q[W]),X=h.Host.pathUtils.parseStringToDouble(Q[W+1]);W+=2,H.push(new _.TheoPoint(K,X))}w=new u.svg_path,c.last(this._stack).addItem(w),w.path_transform=i,(Z=y.TheoPathBuilder.init_31cf(s,d,C,P,v)).addLines(H),"svg:polygon"!=e&&"polygon"!=e||Z.closePath(),w.path_outline=Z.path}else if("svg:rect"==e||"rect"==e){if("none"==S)return;var z=g.SVGParserUtils.getAttrDoubleForKey(this._elementAttrDict,"width",0),q=g.SVGParserUtils.getAttrDoubleForKey(this._elementAttrDict,"height",0);if(0==q||0==z)return;K=g.SVGParserUtils.getAttrDoubleForKey(this._elementAttrDict,"x",0),X=g.SVGParserUtils.getAttrDoubleForKey(this._elementAttrDict,"y",0),N=g.SVGParserUtils.getAttrDoubleForKey(this._elementAttrDict,"rx",-1),L=g.SVGParserUtils.getAttrDoubleForKey(this._elementAttrDict,"ry",-1),-1==N&&-1!=L?N=L:-1==L&&-1!=N&&(L=N),N=m.MathUtils.saturate_range(0,z/2,N),L=m.MathUtils.saturate_range(0,q/2,L),w=new u.svg_path,c.last(this._stack).addItem(w),w.path_transform=i;var Z=y.TheoPathBuilder.init_31cf(s,d,C,P,v);if(0==N||0==L){var J=T.TheoRect.fromXYWH(K,X,z,q);Z.rectangle(J.minX,J.minY,J.maxX,J.maxY)}else J=T.TheoRect.fromXYWH(K,X,z,q),Z.roundedRectangle(J.minX,J.minY,J.maxX,J.maxY,N,L);w.path_outline=Z.path}else if("svg:path"==e||"path"==e){if("none"==S)return;if(null==(n=this._elementAttrDict.d))return;w=new u.svg_path,c.last(this._stack).addItem(w),w.path_transform=i;var Q,$,ee,te,ne,re,oe,ae=(Q=c.clone(g.SVGParserUtils.scanPathData(n))).length;if(Z=y.TheoPathBuilder.init_31cf(s,d,C,P,v),K=0,X=0,re=0,oe=0,$=0,ee=0,te=0,ne=0,W=0,0==ae)Z.moveTo(0,0),Z.closePath();else{function ie(){K=h.Host.pathUtils.parseStringToDouble(Q[W]),X=h.Host.pathUtils.parseStringToDouble(Q[W+1]),W+=2,Z.lineTo(K,X),$=K,te=K,ee=X,ne=X}function se(){K+=h.Host.pathUtils.parseStringToDouble(Q[W]),X+=h.Host.pathUtils.parseStringToDouble(Q[W+1]),W+=2,Z.lineTo(K,X),$=K,te=K,ee=X,ne=X}for(;W<ae;){var le=Q[W];if(W+=1,"M"==le)K=h.Host.pathUtils.parseStringToDouble(Q[W]),X=h.Host.pathUtils.parseStringToDouble(Q[W+1]),W+=2,Z.moveTo(K,X),re=K,oe=X,$=K,te=K,ee=X,ne=X;else if("m"==le)K+=h.Host.pathUtils.parseStringToDouble(Q[W]),X+=h.Host.pathUtils.parseStringToDouble(Q[W+1]),W+=2,Z.moveTo(K,X),$=K,te=K,ee=X,ne=X,re=K,oe=X;else if("L"==le)ie();else if("l"==le)se();else if("H"==le)K=h.Host.pathUtils.parseStringToDouble(Q[W]),W+=1,Z.lineTo(K,X),$=K,te=K,ee=X,ne=X;else if("h"==le)K+=h.Host.pathUtils.parseStringToDouble(Q[W]),W+=1,Z.lineTo(K,X),$=K,te=K,ee=X,ne=X;else if("V"==le)X=h.Host.pathUtils.parseStringToDouble(Q[W]),W+=1,Z.lineTo(K,X),$=K,te=K,ee=X,ne=X;else if("v"==le)X+=h.Host.pathUtils.parseStringToDouble(Q[W]),W+=1,Z.lineTo(K,X),$=K,te=K,ee=X,ne=X;else if("C"==le)$=h.Host.pathUtils.parseStringToDouble(Q[W]),ee=h.Host.pathUtils.parseStringToDouble(Q[W+1]),te=h.Host.pathUtils.parseStringToDouble(Q[W+2]),ne=h.Host.pathUtils.parseStringToDouble(Q[W+3]),K=h.Host.pathUtils.parseStringToDouble(Q[W+4]),X=h.Host.pathUtils.parseStringToDouble(Q[W+5]),W+=6,Z.cubicBezier($,ee,te,ne,K,X),$=K,ee=X;else if("c"==le)$=K+h.Host.pathUtils.parseStringToDouble(Q[W]),ee=X+h.Host.pathUtils.parseStringToDouble(Q[W+1]),te=K+h.Host.pathUtils.parseStringToDouble(Q[W+2]),ne=X+h.Host.pathUtils.parseStringToDouble(Q[W+3]),K+=h.Host.pathUtils.parseStringToDouble(Q[W+4]),X+=h.Host.pathUtils.parseStringToDouble(Q[W+5]),W+=6,Z.cubicBezier($,ee,te,ne,K,X),$=K,ee=X;else if("S"==le){var ue=m.MathUtils.Reflect(new _.TheoPoint(te,ne),new _.TheoPoint(K,X));$=ue.x,ee=ue.y,te=h.Host.pathUtils.parseStringToDouble(Q[W]),ne=h.Host.pathUtils.parseStringToDouble(Q[W+1]),K=h.Host.pathUtils.parseStringToDouble(Q[W+2]),X=h.Host.pathUtils.parseStringToDouble(Q[W+3]),W+=4,Z.cubicBezier($,ee,te,ne,K,X),$=K,ee=X}else if("s"==le)ue=m.MathUtils.Reflect(new _.TheoPoint(te,ne),new _.TheoPoint(K,X)),$=ue.x,ee=ue.y,te=K+h.Host.pathUtils.parseStringToDouble(Q[W]),ne=X+h.Host.pathUtils.parseStringToDouble(Q[W+1]),K+=h.Host.pathUtils.parseStringToDouble(Q[W+2]),X+=h.Host.pathUtils.parseStringToDouble(Q[W+3]),W+=4,Z.cubicBezier($,ee,te,ne,K,X),$=K,ee=X;else if("Q"==le)$=h.Host.pathUtils.parseStringToDouble(Q[W]),ee=h.Host.pathUtils.parseStringToDouble(Q[W+1]),K=h.Host.pathUtils.parseStringToDouble(Q[W+2]),X=h.Host.pathUtils.parseStringToDouble(Q[W+3]),W+=4,Z.quadraticBezier($,ee,K,X),te=K,ne=X;else if("q"==le)$=K+h.Host.pathUtils.parseStringToDouble(Q[W]),ee=X+h.Host.pathUtils.parseStringToDouble(Q[W+1]),K+=h.Host.pathUtils.parseStringToDouble(Q[W+2]),X+=h.Host.pathUtils.parseStringToDouble(Q[W+3]),W+=4,Z.quadraticBezier($,ee,K,X),te=K,ne=X;else if("T"==le)ue=m.MathUtils.Reflect(new _.TheoPoint($,ee),new _.TheoPoint(K,X)),$=ue.x,ee=ue.y,K=h.Host.pathUtils.parseStringToDouble(Q[W]),X=h.Host.pathUtils.parseStringToDouble(Q[W+1]),W+=2,Z.quadraticBezier($,ee,K,X),te=K,ne=X;else if("t"==le)ue=m.MathUtils.Reflect(new _.TheoPoint($,ee),new _.TheoPoint(K,X)),$=ue.x,ee=ue.y,K+=h.Host.pathUtils.parseStringToDouble(Q[W]),X+=h.Host.pathUtils.parseStringToDouble(Q[W+1]),W+=2,Z.quadraticBezier($,ee,K,X),te=K,ne=X;else if("A"==le||"a"==le){N=m.MathUtils.absDouble(h.Host.pathUtils.parseStringToDouble(Q[W])),L=m.MathUtils.absDouble(h.Host.pathUtils.parseStringToDouble(Q[W+1]));var ce=h.Host.pathUtils.parseStringToDouble(Q[W+2])*u.k_radians_per_degree,de=0!=h.Host.pathUtils.parseStringToDouble(Q[W+3]),he=0!=h.Host.pathUtils.parseStringToDouble(Q[W+4]);W+=5;var pe=new _.TheoPoint(K,X);if("A"==le){if(0==N||0==L){ie();continue}K=h.Host.pathUtils.parseStringToDouble(Q[W]),X=h.Host.pathUtils.parseStringToDouble(Q[W+1]),W+=2}else{if(0==N||0==L){se();continue}K+=h.Host.pathUtils.parseStringToDouble(Q[W]),X+=h.Host.pathUtils.parseStringToDouble(Q[W+1]),W+=2}var fe=new _.TheoPoint(K,X);if(pe.equal(fe))continue;g.SVGParserUtils.svgArcToPath(pe,N,L,ce,de,he,fe,Z),$=K,te=K,ee=X,ne=X}else"Z"==le||"z"==le?(Z.closePath(),K=re,$=re,te=re,X=oe,ee=oe,ne=oe):p.LegacyCoreAssert.fail("unimplemented svg path opcode",{opcode:le},"SVGParser.beginElement","SVGParser.swift",897)}}p.LegacyCoreAssert.isTrue(W==ae,"i should equal count",void 0,"SVGParser.beginElement","SVGParser.swift",901),w.path_outline=Z.path}else"svg:switch"==e||"switch"==e||(this._ignoringUnknownTag=e)}},endElement:function(e){null!=this._ignoringUnknownTag?this._ignoringUnknownTag==e&&(this._ignoringUnknownTag=null):"svg:svg"==e||"svg"==e?this._stack.pop():"svg:desc"==e||"desc"==e||"svg:g"!=e&&"g"!=e||this._stack.pop(),null!=this._ignoringUnknownTag&&"defs"!=this._ignoringUnknownTag||"svg:style"!=e&&"style"!=e||null!=this._currentElementValue&&this.parseStyleClassDefinitions(this._currentElementValue),this._currentElementValue=null,this._elementAttrDict={}}}}),l)},BAdM:function(e,t,n){var r,o=t,a=n("oAGj"),i=n("ytEx"),s=n("gXiO"),l=n("iCxV");o.JSONComponentDecoder=(r=function(){},a.defineClass({name:"JSONComponentDecoder",ctor:r,superName:"CoreObject",statics:{_implements:function(e){return"IImportDataComponent"==e}},props:{init_466d:function(e){this.json_=a.clone(e),s.CoreObject.call(this)},init_f390:function(e,t,n,r,o,s){var u={};null!=e&&(u[i.PROPERTY_KEY_ID]=e),null!=t&&(u[i.PROPERTY_KEY_NAME]=t),null!=n&&(u[i.PROPERTY_KEY_PATH]=n),null!=r&&(u[i.PROPERTY_KEY_MIMETYPE]=r),null!=o&&(u[i.PROPERTY_KEY_ETAG]=o),null!=s&&(u[i.PROPERTY_KEY_URL]=s),this.init_466d(u),a.opt(l.Host.logging,(function(o){return o.info("init "+a.toString(e)+" "+a.toString(t)+" "+a.toString(r)+" "+a.toString(n)+" "+a.toString(s))}))},id:{get:function(){return a.as(this.json_[i.PROPERTY_KEY_ID],"String")}},name:{get:function(){return a.as(this.json_[i.PROPERTY_KEY_NAME],"String")}},path:{get:function(){return a.as(this.json_[i.PROPERTY_KEY_PATH],"String")}},mimeType:{get:function(){return a.as(this.json_[i.PROPERTY_KEY_MIMETYPE],"String")}},etag:{get:function(){return a.as(this.json_[i.PROPERTY_KEY_ETAG],"String")}},url:{get:function(){return a.as(this.json_[i.PROPERTY_KEY_URL],"String")}}}}),r)},BQMb:function(e,t,n){var r=t,o=n("oAGj");r.MotionEntry=o.defineProtocol("MotionEntry",{srcId:"String",logic:"MotionLogic",args:"Dictionary<String>"})},BbDD:function(e,t,n){var r,o=t,a=n("oAGj"),i=n("gXiO");o.DocumentSingletonTracker=(r=function(){i.CoreObject.call(this)},a.defineClass({name:"DocumentSingletonTracker",ctor:r,superName:"CoreObject",statics:{creatingDocumentSingleton:function(e,t){void 0===t&&(t=!1)},destroyingDocumentSingleton:function(e){},noDocumentSingletonsShouldExist:function(){}}}),r)},Bcdx:function(e,t,n){var r,o,a=t,i=n("oAGj"),s=n("5ex8"),l=n("Bqrn"),u=n("dX/e"),c=n("pR+7"),d=n("3HaQ"),h=n("8Quq"),p=n("zW/s"),f=n("s3ad");a.FormaToPGMMapperFactory=(r=function(){},o={},i.defineClass({name:"FormaToPGMMapperFactory",ctor:r,statics:{instance:{get:function(){return void 0===o.instance&&(o.instance=new r),o.instance}},FORMA_KIND_TO_FN:{get:function(){return void 0===o.FORMA_KIND_TO_FN&&(o.FORMA_KIND_TO_FN={Root:function(e){return c.RootFormaToPGMMapper.createMapper(e)},Frame:function(e){return s.FrameFormaToPGMMapper.createMapper(e)},Text:function(e){return h.TextFormaToPGMMapper.createMapper(e)},Shape:function(e){return d.ShapeFormaToPGMMapper.createMapper(e)},Image:function(e){return u.ImageFormaToPGMMapper.createMapper(e)},Video:function(e){return f.VideoFormaToPGMMapper.createMapper(e)},Vector:function(e){return p.VectorFormaToPGMMapper.createMapper(e)},group:function(e){return l.GroupFormaToPGMMapper.createMapper(e)},"smart-group":function(e){return l.GroupFormaToPGMMapper.createMapper(e)}}),o.FORMA_KIND_TO_FN}}},props:{getMapper:function(e){return i.opt(r.FORMA_KIND_TO_FN[e.kind],(function(t){return t(e)}))}}}),r)},BgH2:function(e,t,n){var r,o,a=t,i=n("oAGj"),s=n("iCxV"),l=n("fNpk"),u=n("oKlP"),c=n("sIWg");a.TextPathSegment=(r=function(e,t,n,r){this._cachedTolerance=0,this._p0=e,this._p1=t,this._p2=n,this._p3=r},i.defineClass({name:"TextPathSegment",ctor:r,superName:"CoreObject",statics:{decodeFromJson:function(e){var t;if(t=e){var n=r.decodePoint(t[r.PROPERTY_P0]),o=r.decodePoint(t[r.PROPERTY_P1]),a=r.decodePoint(t[r.PROPERTY_P2]),i=r.decodePoint(t[r.PROPERTY_P3]);if(null!=n&&null!=o&&null!=a&&null!=i)return new r(n,o,a,i)}return null},encodePoint:function(e){return[e.x,e.y]},decodePoint:function(e){return u.TheoPoint.decodeJson(i.as(e,"AnyObject"))},PROPERTY_P0:"p0",PROPERTY_P1:"p1",PROPERTY_P2:"p2",PROPERTY_P3:"p3"},props:{p0:{get:function(){return this._p0}},p1:{get:function(){return this._p1}},p2:{get:function(){return this._p2}},p3:{get:function(){return this._p3}},clone:function(){return new r(this.p0,this.p1,this.p2,this.p3)},pointAt:function(e){if(!this.checkT(e))return u.TheoPoint.INVALID;var t=1-e,n=t*t*t*this.p0.x+3*e*t*t*this.p1.x+3*e*e*t*this.p2.x+e*e*e*this.p3.x,r=t*t*t*this.p0.y+3*e*t*t*this.p1.y+3*e*e*t*this.p2.y+e*e*e*this.p3.y;return new u.TheoPoint(n,r)},tangentUnitVectorAt:function(e){if(!this.checkT(e))return u.TheoPoint.INVALID;var t=e;t<.01?t=.01:t>.99&&(t=.99);var n=i.clone(this.calculateMidpoints(t)),r=u._minus_TheoPoint_TheoPoint(n[4],n[3]);return r.divide(r.length())},getBounds:function(){var e=this.getBoundsOneDim(this.p0.x,this.p1.x,this.p2.x,this.p3.x,(function(e){return e.x})),t=e.min,n=e.max,r=this.getBoundsOneDim(this.p0.y,this.p1.y,this.p2.y,this.p3.y,(function(e){return e.y})),o=r.min,a=r.max,i=new c.TheoRect(t,o,n,a),s=c.TheoRect.boundsOfPoints([this.p0,this.p1,this.p2,this.p3]);return s.equal(i)||s.contains(i)||l.LegacyCoreAssert.fail("Text path segment bounds incorrect",void 0,"TextPathSegment.getBounds","TextPath.swift",99),i},getBoundsOneDim:function(e,t,n,r,o){var a,i,s=3*r-9*n+9*t-3*e,l=6*e-12*t+6*n,u=3*(-e+t);if(Math.abs(s)<1e-6)i=a=-u/l;else{var c=Math.sqrt(l*l-4*s*u);a=(-l+c)/(2*s),i=(-l-c)/(2*s)}var d=this.checkT(a)?o(this.pointAt(a)):e,h=this.checkT(i)?o(this.pointAt(i)):r;return{min:Math.min(d,h,e,r),max:Math.max(d,h,e,r)}},multiply:function(e){return new r(this._p0.multiplyPoint(e),this._p1.multiplyPoint(e),this._p2.multiplyPoint(e),this._p3.multiplyPoint(e))},offset:function(e){return new r(u._plus_TheoPoint_TheoPoint(this._p0,e),u._plus_TheoPoint_TheoPoint(this._p1,e),u._plus_TheoPoint_TheoPoint(this._p2,e),u._plus_TheoPoint_TheoPoint(this._p3,e))},truncate:function(e){var t=i.clone(this.calculateMidpoints(e)),n=t[3].interpolate(t[4],e);return{prefix:new r(this.p0,t[0],t[3],n),suffix:new r(n,t[4],t[2],this._p3)}},getLength:function(e){if(null!=this._cachedLen&&this._cachedTolerance<=e)return this._cachedLen;for(var t=0,n=0,r=e,o=this.clone();!(o.getPolylineLength()-(t=o.getChordLength())<=e);){r/=2;var a=o.truncate(.5),i=a.prefix,s=a.suffix;n+=i.getLength(r),o=s}return this._cachedLen=n+t,this._cachedTolerance=r,this._cachedLen},getCorrectedLength:function(e,t,n){var r=this.getLength(n),o=u._minus_TheoPoint_TheoPoint(this.p3,this.p2),a=Math.atan2(o.y,o.x);return o=u._minus_TheoPoint_TheoPoint(this.p1,this.p0),(a-=Math.atan2(o.y,o.x))<-Math.PI&&(a+=2*Math.PI),a>Math.PI&&(a-=2*Math.PI),r+(a*=a>0?e:t)},findTValueByCorrectedPrefixLength:function(e,t,n,r){for(var o=r/2,a=0,l=1,u=0,c=0;c<1e3;){u=(a+l)/2;var d=this.truncate(u).prefix.getCorrectedLength(e,t,o);if(Math.abs(n-d)<=o)return u;n<d?l=u:a=u,c+=1}return i.opt(s.Host.logging,(function(e){return e.warning("findTValueByCorrectedPrefixLength did not converge")})),u},encodeJson:function(){var e={};return e[r.PROPERTY_P0]=r.encodePoint(this.p0),e[r.PROPERTY_P1]=r.encodePoint(this.p1),e[r.PROPERTY_P2]=r.encodePoint(this.p2),e[r.PROPERTY_P3]=r.encodePoint(this.p3),e},isEqual:function(e){return this.isEqualWithAccuracy(e,1e-6)},isEqualWithAccuracy:function(e,t){var n;return!!(n=i.as(e,r))&&this.p0.equalWithAccuracy(n.p0,t)&&this.p1.equalWithAccuracy(n.p1,t)&&this.p2.equalWithAccuracy(n.p2,t)&&this.p3.equalWithAccuracy(n.p3,t)},getPolylineLength:function(){return this.p0.distanceTo(this.p1)+this.p1.distanceTo(this.p2)+this.p2.distanceTo(this.p3)},getChordLength:function(){return this.p0.distanceTo(this.p3)},calculateMidpoints:function(e){var t=this.p0.interpolate(this.p1,e),n=this.p1.interpolate(this.p2,e),r=this.p2.interpolate(this.p3,e),o=t.interpolate(n,e),a=n.interpolate(r,e);return[t,n,r,o,a]},checkT:function(e){return e>=0&&e<=1}}}),r),a.TextPath=(o=function(e,t){void 0===e&&(e=[]),void 0===t&&(t=1),this._segments=i.clone(e),this._flex=t},i.defineClass({name:"TextPath",ctor:o,superName:"CoreObject",statics:{decodeFromJson:function(e){var t,n;if(n=e){var r,s=(t=i.as(n[o.PROPERTY_FLEX],"Double"))||null!=t?t:1,l=[];if(r=i.as(n[o.PROPERTY_SEGMENTS],["Array","Any"]))for(var u=i.iter(r);!u.done;u.next()){var c=u.value,d=a.TextPathSegment.decodeFromJson(i.as(c,["Dictionary","String","Any"]));if(null==d)return null;l.push(d)}return new o(l,s)}return null},areSegmentsContiguous:function(e){for(var t=i.iter(i.toSequence(e));!t.done;t.next()){var n=t.value,r=n.offset,o=n.element;if(r<e.length-1){var a=e[r+1];if(!o.p3.equal(a.p0))return!1}}return!0},PROPERTY_FLEX:"flex",PROPERTY_SEGMENTS:"segment"},props:{segments:{get:function(){return this._segments}},numSegments:{get:function(){return this._segments.length}},flex:{get:function(){return this._flex}},isClosed:function(){return!(this.numSegments<2)&&o.areSegmentsContiguous(this._segments)&&i.first(this._segments).p0.equal(i.last(this._segments).p3)},clone:function(){var e=this._segments.map((function(e){return e.clone()}),this);return new o(e,this._flex)},pointAt:function(e){var t;return null!=(t=this.getSegementIndex(e))?this._segments[t].pointAt(e-i.toDouble(t)):u.TheoPoint.INVALID},tangentUnitVectorAt:function(e){var t;return null!=(t=this.getSegementIndex(e))?this._segments[t].tangentUnitVectorAt(e-i.toDouble(t)):u.TheoPoint.INVALID},getBounds:function(){for(var e,t=i.iter(this._segments);!t.done;t.next()){var n=t.value.getBounds();e=null==e?n:e.unionWith(n)}return e||c.TheoRect.Zero},multiply:function(e){var t=this._segments.map((function(t){return t.multiply(new u.TheoPoint(e.width,e.height))}),this);return new o(t,this._flex)},offset:function(e){var t=this._segments.map((function(t){return t.offset(e)}),this);return new o(t,this._flex)},truncate:function(e){if(e>=0&&e<i.toDouble(this.numSegments)){var t=i.toInt(Math.floor(e)),n=i.clone(this._segments),r=n.splice(0,t),a=e-i.toDouble(t);if(a>0){var s=n[0].truncate(a),l=s.prefix,u=s.suffix,c=l;n[0]=u,r.push(c)}return{prefix:new o(r),suffix:new o(n,this._flex)}}return{prefix:new o,suffix:this.clone()}},getLength:function(e){if(0==this.numSegments)return 0;for(var t=e/i.toDouble(this.numSegments),n=0,r=i.iter(this._segments);!r.done;r.next())n+=r.value.getLength(t);return n},getCorrectedLength:function(e,t,n){for(var r=n/i.toDouble(this.numSegments),o=0,a=i.iter(this._segments);!a.done;a.next())o+=a.value.getCorrectedLength(e,t,r);return o},findTValueByCorrectedPrefixLength:function(e,t,n,r){for(var o=r/i.toDouble(this.numSegments),a=n,s=0;s<this.numSegments&&a>0;){var l=this._segments[s].getCorrectedLength(e,t,o);if(a<=l-o){var u=this._segments[s].findTValueByCorrectedPrefixLength(e,t,a,o);return i.toDouble(s)+u}a-=l,s+=1}return i.toDouble(s)},encodeJson:function(){var e={};e[o.PROPERTY_FLEX]=this.flex;for(var t=[],n=i.iter(this.segments);!n.done;n.next()){var r=n.value;t.push(r.encodeJson())}return e[o.PROPERTY_SEGMENTS]=t,e},isEqual:function(e){return this.isEqualWithAccuracy(e,1e-6)},isEqualWithAccuracy:function(e,t){var n;if(n=i.as(e,o)){if(this.numSegments!=n.numSegments||Math.abs(this.flex-n.flex)>t)return!1;for(var r=i.iter(i.toSequence(this.segments));!r.done;r.next()){var a=r.value,s=a.offset;if(!a.element.isEqualWithAccuracy(n.segments[s],t))return!1}return!0}return!1},getSegementIndex:function(e){return e<0||e>i.toDouble(this.numSegments)?null:Math.min(i.toInt(Math.floor(e)),this.numSegments-1)}}}),o)},Bqrm:function(e,t,n){var r,o=t,a=n("oAGj"),i=n("cZuM"),s=n("Z25M"),l=n("FNB+"),u=n("wc1n"),c=n("pnSN"),d=n("fdtz"),h=n("c+uM"),p=n("JO5d"),f=n("8t9B"),m=n("oKlP");o.DesignConstraintFeatureExtractor=(r=function(e,t){void 0===t&&(t=[]),this.root_=e,this.forFeatures_=a.clone(t),this.featureEvals_=[],u.FeatureExtractor.call(this),this.initFeatures(),this.evaluateFeatures()},a.defineClass({name:"DesignConstraintFeatureExtractor",ctor:r,superName:"FeatureExtractor",statics:{_implements:function(e){return"FeatureExtractorProtocol"==e}},props:{initFeatures:function(){this.featureEvals_=[["Maxzoomlevel",[this.evaluateMaxZoomLevel,u.FeatureType.Numerical]],["textareanotcontrasting",[this.evaluateForUnreadableText,u.FeatureType.Numerical]],["shapesareanotcontrasting",[this.evaluateForUnreadableShapes,u.FeatureType.Numerical]],["lockupareaoutofbounds",[this.evaluateForOutOfBoundsElements,u.FeatureType.Numerical]],["minfontsize",[this.evaluateMinimumFont,u.FeatureType.Numerical]],["maxfontsize",[this.evaluateMaximumFont,u.FeatureType.Numerical]],["mintextarea",[this.evaluateMinimumText,u.FeatureType.Numerical]],["maxtextarea",[this.evaluateMaximumText,u.FeatureType.Numerical]],["minshapesize",[this.evaluateMinimumShape,u.FeatureType.Numerical]],["maxshapesize",[this.evaluateMaximumShape,u.FeatureType.Numerical]],["lockupareaoverlapping",[this.evaluatePercentageOverlapping,u.FeatureType.Numerical]],["Maxemptyspace",[this.evaluateEmptySpace,u.FeatureType.Numerical]],["textincorrectalign",[this.evaluateIncorrectlyAligned,u.FeatureType.Numerical]],["emptygridsquares",[this.evaluateEmptyGridPercent,u.FeatureType.Numerical]],["overlappingmultiplegridcells",[this.evaluateOverlappingMultipleGridCells,u.FeatureType.Numerical]],["maxaspectratio",[this.evaluateMaxAspectRatio,u.FeatureType.Numerical]],["breakingflowX",[this.evaluateBreakFlowX,u.FeatureType.Numerical]],["breakingflowY",[this.evaluateBreakFlowY,u.FeatureType.Numerical]],["BreakingHorisontalSymmetryinsidevisualparent",[this.evaluateHorisontalSymmetry,u.FeatureType.Numerical]],["marginsaretoosmall",[this.evaluateMargins,u.FeatureType.Numerical]],["balanceofvisualparentX",[this.evaluateBalanceX,u.FeatureType.Numerical]],["balanceofvisualparentY",[this.evaluateBalanceY,u.FeatureType.Numerical]],["totalalignmentlines",[this.evaluateTotalAlignmentLines,u.FeatureType.Numerical]]]},evaluateFeatures:function(){for(var e=0==this.forFeatures_.length,t=a.iter(this.featureEvals_);!t.done;t.next()){var n=t.value;if(e||!e&&this.forFeatures_.includes(n[0])){var r=n[1],o=(0,r[0])(this);this.setFeature(n[0],o,r[1])}}},evaluateMaxZoomLevel:function(e){for(var t=a.clone(e.root_.filterByKind(d.ImageForma.KIND)),n=m.TheoPoint.ZERO,r=a.iter(t);!r.done;r.next()){var o=r.value.placement.extractedScale.scale;o.length()>n.length()&&(n=o)}return n.length()},evaluateForUnreadableText:function(e){return e.TestUnreadableController(f.TypeLockupController.KIND)},evaluateForUnreadableShapes:function(e){return e.TestUnreadableController(p.ShapeController.KIND)},evaluateForOutOfBoundsElements:function(e){for(var t=a.clone(e.root_.filterWithCallback((function(e){return null!=e.controller&&e.controller.floating}))),n=e.root_.finalFrame,r=0,o=0,i=a.iter(t);!i.done;i.next()){var s,l;(s=i.value.finalFrame)&&(o+=s.area,(l=n.intersectionWith(s))&&(r+=l.area))}return(o-r)/Math.max(1e-5,o)},evaluateMinimumFont:function(e){for(var t,n=a.clone(e.root_.filterWithCallback((function(e){return null!=e.controller&&e.controller.floating&&e.controller.kind==f.TypeLockupController.KIND}))),r=null,o=a.iter(n);!o.done;o.next()){var i=o.value.controller.averageLineHeight;0!=i&&(null==r||i<r)&&(r=i)}return(t=r)||null!=t?t:0},evaluateMaximumFont:function(e){for(var t=a.clone(e.root_.filterWithCallback((function(e){return null!=e.controller&&e.controller.floating&&e.controller.kind==f.TypeLockupController.KIND}))),n=0,r=a.iter(t);!r.done;r.next()){var o=r.value.controller.averageLineHeight;o>n&&(n=o)}return n},evaluateMinimumText:function(e){return e.getMinControllerArea(f.TypeLockupController.KIND)},evaluateMaximumText:function(e){return e.getMaxControllerArea(f.TypeLockupController.KIND)},evaluateMinimumShape:function(e){return e.getMinControllerArea(p.ShapeController.KIND)},evaluateMaximumShape:function(e){return e.getMaxControllerArea(p.ShapeController.KIND)},evaluatePercentageOverlapping:function(e){for(var t=a.clone(e.root_.filterWithCallback((function(e){return null!=e.controller&&e.controller.floating&&e.isTypeLockup()}))),n=[],r=a.iter(t);!r.done;r.next()){var o=r.value;n.push(o.finalFrame)}for(var i=0,s=0,l=0,u=a.iter(n);!u.done;u.next()){var c=u.value;s+=c.area;for(var d=a.iter(a.range(0,l,!1));!d.done;d.next()){var h=d.value,p=c.intersectionWith(n[h]);null!=p&&(i+=p.area)}l+=1}return 2*i/s},evaluateEmptySpace:function(e){return s.DesignFeatureUtils.evaluateRootEmptySpace(e.root_)},evaluateIncorrectlyAligned:function(e){var t=a.clone(e.root_.filterWithCallback((function(e){return null!=e.controller&&e.controller.floating&&e.isTypeLockup()}))),n=t.filter((function(e){return Math.acos(e.totalPlacement.transformValues.rotCosine)<1e-4}),this);if(n.length<=1)return 0;for(var r=0,o=a.iter(n);!o.done;o.next()){var l=o.value,u=a.clone(l.controller.alignmentDetector.detectFormaAlignments(i.AlignmentDetector.DISTANCE_THRESHOLD)),c=a.clone(s.DesignFeatureUtils.getLockupsWithin(l,n,300));a.clone(s.DesignFeatureUtils.getSetDiff(c,u)).length>0&&(r+=1)}return r/a.toDouble(t.length)},evaluateEmptyGridPercent:function(e){for(var t=a.clone(e.root_.filterWithCallback((function(e){return e.isGridCell()}))),n=0,r=a.iter(t);!r.done;r.next()){var o=r.value,i=a.clone(e.root_.filterWithCallback((function(e){return null!=e.finalFrame&&null!=e.controller&&(e.finalFrame.intersects(o.finalFrame)||e.finalFrame.contains(o.finalFrame))&&e.controller.floating})));o.isShape()&&0==i.length&&(n+=1)}return n/a.toDouble(t.length)},evaluateOverlappingMultipleGridCells:function(e){for(var t=a.clone(e.root_.filterWithCallback((function(e){return null!=e.controller&&e.controller.floating}))),n=a.clone(e.root_.filterWithCallback((function(e){return null!=e.controller&&(e.isGridCell()||e.isShape())}))),r=0,o=a.iter(t);!o.done;o.next()){var i=o.value;i.kind==c.GroupForma.KIND?r+=e.groupOverlapHelper(i,n):r+=e.overlapHelper(i,n)}return r},evaluateMaxAspectRatio:function(e){for(var t=a.clone(e.root_.filterWithCallback((function(e){return e.isGridCell()}))),n=0,r=a.iter(t);!r.done;r.next()){var o=r.value.finalFrame;if(o.area>0){var i=(o.width>o.height?o.width:o.height)/(o.width>o.height?o.height:o.width);i>n&&(n=i)}}return n},evaluateBreakFlowX:function(e){return e.breakFlowHelper(!0)},evaluateBreakFlowY:function(e){return e.breakFlowHelper(!1)},evaluateHorisontalSymmetry:function(e){var t=a.clone(e.root_.filterWithCallback((function(e){return null!=e.controller&&e.controller.floating})));if(0==t.length)return 0;for(var n=0,r=a.iter(t);!r.done;r.next()){var o=r.value,s=o.finalFrame.center.x,l=o.controller.visualParent.finalFrame.center.x,u=i.AlignmentDetector.DISTANCE_THRESHOLD;Math.abs(s-l)>u&&(n+=Math.exp(2*u-Math.abs(s-l)))}return n},evaluateMargins:function(e){for(var t=a.clone(e.root_.filterWithCallback((function(e){return null!=e.controller&&e.controller.floating}))),n=0,r=a.iter(t);!r.done;r.next()){var o=r.value,i=e.getMinMarginHelper(o);n+=Math.exp(9-i)}return n>9999999?9999999:n},evaluateBalanceX:function(e){return e.balanceHelper(!0)},evaluateBalanceY:function(e){return e.balanceHelper(!1)},evaluateTotalAlignmentLines:function(e){var t=a.clone(e.root_.filterWithCallback((function(e){return null!=e.controller&&e.controller.floating&&e.isTypeLockup()}))).filter((function(e){return Math.acos(e.totalPlacement.transformValues.rotCosine)<1e-4}),this);if(t.length<=1)return 0;for(var n=0,r=[],o=a.iter(t);!o.done;o.next()){var s=o.value,u=a.clone(s.controller.alignmentDetector.detectFormaAlignments(i.AlignmentDetector.DISTANCE_THRESHOLD));if(u.length>0){for(var c=[],d=a.iter(u);!d.done;d.next()){var h=d.value;if(null!=h.forma){var p=h.forma;null!=p.controller&&p.controller.floating&&(p.isTypeLockup()||p.isShape())&&c.push(h.forma)}}for(var f=a.iter(c);!f.done;f.next()){var m=f.value;if(!a.containsEq(r,m,l._equality_Forma_Forma)){for(var g=a.iter(c);!g.done;g.next()){var y=g.value;a.containsEq(r,y,l._equality_Forma_Forma)||r.push(y)}a.containsEq(r,s,l._equality_Forma_Forma)||r.push(s),n+=1;break}}}}return n},TestUnreadableController:function(e,t,n){void 0===t&&(t=5),void 0===n&&(n=.05);var r=a.clone(this.root_.filterWithCallback((function(t){return null!=t.controller&&t.controller.floating&&t.controller.kind==e})));if(0==r.length)return 0;for(var o=0,i=0,s=a.iter(r);!s.done;s.next()){for(var l=s.value,u=[],c=l.finalFrame,d=!!l.isTypeLockup()&&l.style.textLook==h.LockupTextLook.Shadow,p=a.clone(c.split(t,!0)),f=a.iter(p);!f.done;f.next()){var m=f.value,g=a.clone(m.split(t,!1));a.append(u,g)}for(var y=0,_=a.iter(u);!_.done;_.next()){var T=_.value,C=l.controller.getBackgroundColor(T),v=l.style.colors.fieldPrimary,P=l.style.colors.fieldSecondary;null!=v&&null!=C&&(C.contrasts(v,!1)||null!=P&&!d&&C.contrasts(P,!1)||(y+=1))}y/a.toDouble(t*t)>n&&(o+=c.area),i+=c.area}return o/i},getMaxControllerArea:function(e){for(var t=a.clone(this.root_.filterWithCallback((function(t){return null!=t.controller&&t.controller.floating&&t.controller.kind==e}))),n=0,r=a.iter(t);!r.done;r.next()){var o=r.value.finalFrame.area;o>n&&(n=o)}return n},getMinControllerArea:function(e){for(var t=a.clone(this.root_.filterWithCallback((function(t){return null!=t.controller&&t.controller.floating&&t.controller.kind==e}))),n=null,r=a.iter(t);!r.done;r.next()){var o=r.value.finalFrame.area;0!=o&&(null==n||o<n)&&(n=o)}return null==n?0:n},overlapHelper:function(e,t){for(var n=0,r=e.finalFrame,o=a.iter(t);!o.done;o.next()){var i=o.value,s=i.finalFrame;if(!s.contains(r)&&e.controller.visualParent.formaID==i.controller.visualParent.formaID||e.controller.visualParent.formaID==this.root_.formaID){var l=s.intersectionWith(r);null!=l&&l.area/r.area<.5&&(n+=.5-l.area/r.area)}}return n},groupOverlapHelper:function(e,t){for(var n=0,r=e.childrenFinalFrame,o=a.iter(t);!o.done;o.next()){var i=o.value,s=i.finalFrame;if(!s.contains(r)&&e.controller.groupVisualParent.formaID==i.controller.visualParent.formaID||e.controller.groupVisualParent.formaID==this.root_.formaID){var l=s.intersectionWith(r);null!=l&&l.area/r.area<.5&&(n+=.5-l.area/r.area)}}return n},balanceHelper:function(e){for(var t=a.clone(this.root_.filterWithCallback((function(e){return null!=e.controller&&e.controller.floating}))),n={},r={},o=a.iter(t);!o.done;o.next()){var i=o.value;null==n[(c=i.controller.visualParent).formaID]?(n[c.formaID]=[i],r[c.formaID]=c.finalFrame):n[c.formaID].push(i)}for(var s=0,l=0,u=a.iter(n);!u.done;u.next()){for(var c=u.key,d=u.value,h=e?r[c].center.x:r[c].center.y,p=0,f=0,m=a.iter(d);!m.done;m.next()){var g=m.value.finalFrame,y=e?g.center.x:g.center.y,_=e?g.width:g.height,T=y-_/2;if(h>y+_/2)p+=g.area;else if(h<T)f+=g.area;else{var C=(h-T)/_;p+=g.area*C,f+=g.area*(1-C)}}s+=Math.abs(p-f),l+=p+f}return s/l},breakFlowHelper:function(e){var t=a.clone(this.root_.filterWithCallback((function(e){return null!=e.controller&&e.controller.floating&&e.isTypeLockup()})));if(0==t.length)return 0;for(var n=0,r=a.iter(t);!r.done;r.next())for(var o=r.value,i=o.controller.averageLineHeight,s=e?o.finalFrame.center.x:o.finalFrame.center.y,u=e?o.finalFrame.minX:o.finalFrame.minY,c=a.iter(t);!c.done;c.next()){var d=c.value;if(a.eq(l._equality_Forma_Forma,o,d))break;var h=d.controller.averageLineHeight,p=e?d.finalFrame.center.x:d.finalFrame.center.y,f=e?d.finalFrame.minX:d.finalFrame.minY;if(h>i){var m=p-s,g=f-u;if((g<m?g:m)>0){n+=1;break}}}return 2*n/a.toDouble(t.length)},getMinMarginHelper:function(e){var t,n;e.kind==c.GroupForma.KIND?(t=e.childrenFinalFrame,n=e.controller.groupVisualParent.finalFrame):(t=e.finalFrame,n=e.controller.visualParent.finalFrame);var r=n.maxY-t.maxY;return t.minX-n.minX<r&&(r=t.minX-n.minX),t.minY-n.minY<r&&(r=t.minY-n.minY),n.maxX-t.maxX<r&&(r=n.maxX-t.maxX),r}}}),r)},Bqrn:function(e,t,n){var r,o,a=t,i=n("oAGj"),s=n("7Pku"),l=n("w/+j"),u=n("9Lk3"),c=n("pnSN"),d=n("RBTN"),h=n("fNpk"),p=n("Ird5"),f=n("jfma"),m=n("yjxF"),g=n("Aj79"),y=n("g6aL"),_=n("8t9B"),T=n("QgdZ");i.gvar(a,"_groupSingleton",(function(){return new a.GroupFormaToPGMMapper})),i.gvar(a,"_typeLockupSingleton",(function(){return new T.TypeLockupToPGMMapper})),i.gvar(a,"_gridSingleton",(function(){return new d.GridToPGMMapper})),a.GroupFormaToPGMMapper=(r=function e(){s.FormaToPGMMapper.call(this,e.FORMA_KIND)},o={},i.defineClass({name:"GroupFormaToPGMMapper",ctor:r,superName:"FormaToPGMMapper",statics:{FORMA_KIND:{get:function(){return void 0===o.FORMA_KIND&&(o.FORMA_KIND=c.GroupForma.KIND),o.FORMA_KIND}},createMapper:function(e){var t;if(t=e.controller){if(t instanceof _.TypeLockupController)return a._typeLockupSingleton;if(t instanceof u.GridController)return a._gridSingleton}return a._groupSingleton}},props:{makePGMRef:function(e,t,n,r){var o,a;if((o=i.as(e,c.GroupForma))&&(a=n.childReferences(o))){var u=s.FormaToPGMMapper.mapBlendMode(e);return l.FormaToPGMUtils.applyAnimations(t,e,new g.PGMReference(new y.PGMSimpleGroup(o.formaID,new m.PGMNodeMetadata(o.formaID,"group"),p.PGMAnimationList.EMPTY,a),new f.PGMCompositingParams(o.placement,o.style.opacity,u)))}return h.LegacyCoreAssert.fail("group forma child reference generation failed",void 0,"GroupFormaToPGMMapper.makePGMRef","GroupFormaToPGMMapper.swift",66),null}}}),r)},C42b:function(e,t){var n,r=(n={rng:void 0,getRng:function(){return void 0===this.rng&&(this.rng={w:32,n:624,m:397,r:31,f:1812433253,a:-1727483681,stdCDefaultSeed:5489,u:11,d:-1,s:7,b:-1658038656,t:15,c:-272236544,l:18,state:[],index:625,lowerMask:2147483647,upperMask:-2147483648,randMax:2147483647,twist:function(){for(var e=0;e<this.n;e++){var t=(this.state[e]&this.upperMask)+(this.state[(e+1)%this.n]&this.lowerMask),n=t>>1;t%2!=0&&(n^=this.a),this.state[e]=this.state[(e+this.m)%this.n]^n}this.index=0},mulDiscardOverflow:function(e,t){var n=65535&e,r=65535&t;return(((-65536&e)>>16&65535)*r+n*((-65536&t)>>16&65535)<<16&this.randMax)+n*r&this.randMax},seed:function(e){this.state=new Array(this.n).fill(0),this.index=this.n,this.state[0]=e;for(var t=1;t<this.n;t++){var n=this.state[t-1];this.state[t]=this.mulDiscardOverflow(this.f,n^n>>this.w-2)+t}},nextInt:function(){this.index>=this.n&&(this.index>this.n&&this.seed(this.stdCDefaultSeed),this.twist());var e=this.state[this.index];return e^=e>>this.u&this.d,e^=e<<this.s&this.b,e^=e<<this.t&this.c,e^=e>>this.l,this.index+=1,e&this.randMax},nextIntUniform:function(e){var t=this.nextInt(),n=this.randMax%e+1;if(n!=e)for(var r=this.randMax-n;t>r;)t=this.nextInt();return t%e}}),this.rng},seedRandom:function(e){this.getRng().seed(e)},nextIntUniform:function(e){return this.getRng().nextIntUniform(e)}},Object.defineProperty(n,"nextInt",{get:function(){return n.getRng().nextInt()}}),Object.defineProperty(n,"randMax",{get:function(){return n.getRng().randMax}}),n.seedRandom((new Date).getTime()),n);e.exports={CoreRandom:r}},C4JV:function(e,t,n){var r,o=t,a=n("oAGj"),i=n("ytEx"),s=n("3OP7"),l=n("iCxV"),u=n("CqFS"),c=n("fNpk"),d=n("9YN4");o.PROPERTY_VALUE_CANVASES="canvases",o.PROPERTY_VALUE_CANVAS="canvas",o.PROPERTY_VALUE_CANVAS1_NAME="page-1",o.PROPERTY_VALUE_ARTBOARD="artboard",o.PROPERTY_VALUE_ARTBOARD1_NAME="artboard-1",a.gvar(o,"CANVASES_PATH",(function(){return"/"+o.PROPERTY_VALUE_CANVASES})),a.gvar(o,"CANVAS1_PATH",(function(){return o.CANVASES_PATH+"/"+o.PROPERTY_VALUE_CANVAS1_NAME})),a.gvar(o,"ARTBOARD1_PATH",(function(){return o.CANVAS1_PATH+"/"+o.PROPERTY_VALUE_ARTBOARD1_NAME})),a.gvar(o,"JSON_CONTENT_PATH_DCX2D",(function(){return o.ARTBOARD1_PATH+"/"+d.TheoDocument.COMPONENT_PATH_CONTENT})),o.PROPERTY_KEY_UNITS="units",o.PROPERTY_KEY_WIDTH="width",o.PROPERTY_KEY_HEIGHT="height",o.PROPERTY_KEY_X="x",o.PROPERTY_KEY_Y="y",a.gvar(o,"PROPERTY_KEY_MINISAVE",(function(){return s.DocumentPersistenceFactory.namespacedPropertyName("minisave")})),o.JSONDocumentEncoder=(r=function(e){this.isMiniSave=!1,this.previouslyUsedJSONDocumentEncoding=s.DocumentPersistenceFactory.usesJsonDocumentEncoding(e),u.JSONNodeEncoder.call(this,e,{},null);var t=[d.TheoDocument.COMPONENT_RELATIONSHIP_DOM,d.TheoDocument.COMPONENT_RELATIONSHIP_METADATA,d.TheoDocument.COMPONENT_RELATIONSHIP_RENDITION,o.PROPERTY_VALUE_CANVASES];this.prepareCompositeForSave(t)},a.defineClass({name:"JSONDocumentEncoder",ctor:r,superName:"JSONNodeEncoder",statics:{_implements:function(e){return"IExportDataObject"==e}},props:{getOrCreateArtboardNode:function(){var e=this.branch_.getNodeWithAbsolutePath(o.ARTBOARD1_PATH);if(null==e){var t=this.branch_.appendNode(null,o.PROPERTY_VALUE_CANVASES,null);a.opt(t,(function(e){return e.setValue(i.PROPERTY_KEY_RELATIONSHIP,a.as(o.PROPERTY_VALUE_CANVASES,"AnyObject"))}));var n=this.branch_.appendNode(null,o.PROPERTY_VALUE_CANVAS1_NAME,t);a.opt(n,(function(e){return e.setValue(i.PROPERTY_KEY_RELATIONSHIP,a.as(o.PROPERTY_VALUE_CANVAS,"AnyObject"))})),e=this.branch_.appendNode(null,o.PROPERTY_VALUE_ARTBOARD1_NAME,n),a.opt(e,(function(e){return e.setValue(i.PROPERTY_KEY_RELATIONSHIP,a.as(o.PROPERTY_VALUE_ARTBOARD,"AnyObject"))})),a.opt(e,(function(e){return e.setValue(i.PROPERTY_KEY_NAME,a.as(o.PROPERTY_VALUE_ARTBOARD1_NAME,"AnyObject"))}))}return e},getPropertyOnNode:function(e){return e==i.PROPERTY_KEY_ID||e==i.PROPERTY_KEY_NAME?a.as(this.branch_.getValue(e),"AnyObject"):u.JSONNodeEncoder.prototype.getPropertyOnNode.call(this,e)},setPropertyOnNode:function(e,t){if(e==i.PROPERTY_KEY_NAME)return this.branch_.setValue(e,t);if(u.JSONNodeEncoder.prototype.setPropertyOnNode.call(this,e,t),!this.previouslyUsedJSONDocumentEncoding)switch(e){case"name":case"type":case"children":break;default:this.branch_.root.removeValue(e)}},setDocumentSize:function(e,t){var n,r=this.getOrCreateArtboardNode();r.setValue(o.PROPERTY_KEY_X,a.as(0,"AnyObject")),r.setValue(o.PROPERTY_KEY_Y,a.as(0,"AnyObject")),r.setValue(o.PROPERTY_KEY_WIDTH,a.as(e.width,"AnyObject")),r.setValue(o.PROPERTY_KEY_HEIGHT,a.as(e.height,"AnyObject")),(n=this.branch_.getNodeWithAbsolutePath(o.CANVAS1_PATH))?n.setValue(o.PROPERTY_KEY_UNITS,a.as(t,"AnyObject")):c.LegacyCoreAssert.fail("expected to find a canvas node",void 0,"JSONDocumentEncoder.setDocumentSize","JSONDocumentEncoder.swift",120)},finish:function(){var e,t=this;u.JSONNodeEncoder.prototype.finish.call(this),this.discardStashedComponents(),this.jsonFile=(e=this.jsonFile)||null!=e?e:a.opt(l.Host.persistUtils,(function(e){return e.writeJsonContentToTempFile(a.as(t.jsonNode_,"AnyObject"))}));var n=this.branch_.getComponentWithAbsolutePath(o.JSON_CONTENT_PATH_DCX2D);if(null!=n)n=this.branch_.updateComponent(n,this.jsonFile,!1);else{var r=this.getOrCreateArtboardNode();n=this.branch_.addComponent(d.TheoDocument.COMPONENT_NAME_DOM,null,d.TheoDocument.COMPONENT_MIME_TYPE_DOCUMENT_JSON,d.TheoDocument.COMPONENT_RELATIONSHIP_DOM,d.TheoDocument.COMPONENT_PATH_CONTENT,r,this.jsonFile,!1,null)}if(null!=n){var i=n.mutableCopy;i.setValue(o.PROPERTY_KEY_MINISAVE,a.as(this.isMiniSave,"AnyObject")),this.branch_.updateComponent(i,null,!1)}}}}),r)},C654:function(e,t,n){var r,o=t,a=n("oAGj"),i=n("FNB+"),s=n("3/rh"),l=n("Pn67"),u=n("nQ+V"),c=n("pmb0"),d=n("nUE5"),h=n("K17h"),p=n("RkYL"),f=n("zjod"),m=n("mxdD");o.ANIMATE_ICON=!1,o.MotionLogicStackedRoot=(r=function(){},a.defineClass({name:"MotionLogicStackedRoot",ctor:r,statics:{_implements:function(e){return"MotionLogic"==e}},props:{apply:function(e,t,n){var r,g,y,_,T=(r=a.as(n.lineDur,"Double"))||null!=r?r:1,C=(g=a.as(n.delay,"Double"))||null!=g?g:0,v=(y=a.as(n.fadeInDur,"Double"))||null!=y?y:1,P=(_=a.as(n.endPadDur,"Double"))||null!=_?_:0,S=0,A=[],D=[],E=[],R=new l.MotionEntryNone,F=new s.MotionEntryFadeIn,I=new u.MotionEntryStacked;e.visitAll(i.FormaTraversal.PreOrder,(function(e){var t;if(c.MotionFacade.applyEntryToForma(e,R),e.isTypeLockup())A.push(e);else if(t=a.as(e,f.VideoForma)){var n;t.isSticker()?(D.push(t),(n=h.MotionUtils.getGifDur(t)-v)>P&&(P=n)):(n=m.VideoFacade.getDurationInSecondsForVideo(t))>S&&(S=n)}else o.ANIMATE_ICON&&e.hasIntent(i.Forma.INTENT_ICON)&&E.push(e)}));var b=0,O=A.length>1||E.length>0;if(0==D.length&&(P=2),A.length>0){for(var k=a.clone(h.MotionUtils.getTitleLockups(A)),M=a.clone(k.shift()),N=a.clone(k.shift()),L=b,x=a.iter(M);!x.done;x.next()){var B,w=x.value,G=d.MotionSource.getSourceAnimation(I.srcId,w);I.logic.apply(w,G,{lineDur:T,endPadDur:O?C:0}),null!=(B=a.opt(w.animation,(function(e){return e.endTime.seconds})))&&B>L&&(L=B)}b=L;for(var Y=a.iter(N);!Y.done;Y.next()){var U=Y.value;G=d.MotionSource.getSourceAnimation(F.srcId,U),F.logic.apply(U,G,{st:b,dur:v})}}if(o.ANIMATE_ICON)for(var V=a.iter(E);!V.done;V.next()){var j=V.value;G=d.MotionSource.getSourceAnimation(F.srcId,e),F.logic.apply(j,G,{st:b,dur:v})}O&&(b+=v);var H=b+P;if(S>0&&(H=Math.ceil(H/S)*S,0==!D.length&&(H-=v)),D.length>0){H+=v;for(var W=a.iter(D);!W.done;W.next()){var K=W.value;G=d.MotionSource.getSourceAnimation(F.srcId,K),F.logic.apply(K,G,{st:b,dur:v}),a.opt(K.animation,(function(e){return e.endTime=p.TheoTime.fromSeconds(H)}))}}a.opt(e.animation,(function(e){return e.animationStyle.endTime=p.TheoTime.fromSeconds(H)}))}}}),r)},CWW7:function(e,t,n){var r,o,a,i=t,s=n("oAGj"),l=n("Tq01"),u=n("KSe6"),c=n("kYI4"),d=n("SpAV"),h=n("yvDn"),p=n("vYM0"),f=n("gXiO"),m=n("yGNn"),g=n("T9pj"),y=n("FNB+"),_=n("QgZx"),T=n("cmoc"),C=n("V3yt"),v=n("ZK0l"),P=n("pnSN"),S=n("X0GW"),A=n("iCxV"),D=n("2rlr"),E=n("8vXU"),R=n("U010"),F=n("q5zr"),I=n("fdtz"),b=n("lmwz"),O=n("fNpk"),k=n("MYNe"),M=n("c+uM"),N=n("tGKA"),L=n("VkKB"),x=n("K17h"),B=n("uxH+"),w=n("K0Rh"),G=n("JO5d"),Y=n("djAF"),U=n("35Q0"),V=n("lJxM"),j=n("T6jX"),H=n("8t9B"),W=n("1NAc"),K=n("LGJg"),X=n("sW6f"),z=n("WWR6"),q=n("zjod"),Z=n("QTen");i.FloatingImageStrategy=s.defineEnum("FloatingImageStrategy",{IfHasAlphaOrIsLogo:0,Always:1,Never:2}),i.AddFormaParentingHint=s.defineEnum("AddFormaParentingHint",{defaultHandling:0,addToRoot:1,doNotAddFormaForContentToTree:2}),i.AddFormaParams=(r=function(e,t,n,r,o,a,s){void 0===e&&(e=l.ControllerSettingsBehaviorEnum.IgnoreControllerSettings),void 0===t&&(t=!0),void 0===n&&(n=null),void 0===r&&(r=i.FloatingImageStrategy.IfHasAlphaOrIsLogo),void 0===o&&(o=i.AddFormaParentingHint.defaultHandling),void 0===a&&(a=null),void 0===s&&(s=!1),this.behavior=e,this.suggestPlacement=t,this.formaToReplace=n,this.floatingImageStrategy=r,this.parentingHint=o,this.atPagePoint=a,this.crossPageCopy=s},o={},s.defineClass({name:"AddFormaParams",ctor:r,superName:"CoreObject",statics:{DEFAULTS:{get:function(){return void 0===o.DEFAULTS&&(o.DEFAULTS=new r),o.DEFAULTS}},makeWithFormaToReplace:function(e){return new r(void 0,void 0,e)},makeWithFormaToReplace:function(e,t){return new r(void 0,void 0,e,void 0,t)}}}),r),i.CreationFacade=function(){var e=function(){f.CoreObject.call(this)},t={};return s.defineClass({name:"CreationFacade",ctor:e,superName:"CoreObject",statics:{addImage:function(t,n,r,o,a,l,u,c,d,h){var p,f,g,y,_;if(void 0===o&&(o=null),void 0===a&&(a=null),void 0===l&&(l=null),void 0===u&&(u=!1),void 0===c&&(c=i.AddFormaParams.DEFAULTS),void 0===d&&(d=null),void 0===h&&(h=null),(y=t.document)&&(_=s.as(y.content.createNode(F.ImageContentNode.KIND,null),F.ImageContentNode))){var T;if(null==_.componentID&&null!=h&&(_.componentID=h),_.url=n,_.mimeType=r,T=d)for(var C=s.iter(T);!C.done;C.next()){var v=C.key,P=C.value;_.setTag(v,P)}return _.whenLoaded().then((function(n){var r;return(r=s.as(n,D.HostImage))&&(u&&_.createImageFeatures(),_.hasAlpha=(p=l)||null!=p?p:r.hasAlpha(),_.pixelWidth=(f=o)||null!=f?f:r.getWidth(),_.pixelHeight=(g=a)||null!=g?g:r.getHeight()),e.addImageForContentNode(t,_,c)}))}return m.CorePromise.reject("document has no controller or imageCN was nil")},addImageForContentNode:function(t,n,r){return e.addContent(t,n,null,!1,r).then((function(e){var n;return(n=s.as(e,y.Forma))?(n.isImage()&&j.TheoDocumentUtils.updateConstrainedImageInfo(t.document),n):(O.LegacyCoreAssert.fail("expected a forma result from CreationFacade.addContent",void 0,"CreationFacade.addImageForContentNode","CreationFacade.swift",171),null)}))},addLibraryShape:function(e,t,n,r){var o;return(o=s.as(e.createFormaWithController(Y.ShapeForma.KIND,G.ShapeController.KIND),Y.ShapeForma))?(e.root.appendChild(o),o.intent=y.Forma.INTENT_ICON,U.ShapeLibrary.applyToShapeForma(o,t),o.style.colors.fieldPrimary=r,o.controller.fit(n),m.CorePromise.resolve(o)):m.CorePromise.reject("could not create shape forma")},addText:function(t,n,r,o){return void 0===o&&(o=i.AddFormaParams.DEFAULTS),A.Host.textModelUtils.defaultFont().availability!=_.FontAvailability.LOADED?(s.opt(A.Host.logging,(function(e){return e.logToNewRelic(E.RemoteLoggingEvent.ADD_TEXT_FONT_UNAVAILABLE_ERROR,{})})),m.CorePromise.reject(new h.CoreStringError(g.ErrorMessageConstants.kAddTextMissingFontError,!0))):(a=t.document)?m.CorePromise.resolve(null).then((function(i){var l;return(l=s.as(a.content.createNode(V.TextContentNode.KIND,null),V.TextContentNode))?(l.text=n,e.addContent(t,l,void 0,void 0,o).then((function(e){var t;return(t=s.as(e,y.Forma))?t:(O.LegacyCoreAssert.fail("Unexpected result from AddContentAction, expected a Forma",void 0,"CreationFacade.addText","CreationFacade.swift",232),null)})).then((function(e){return r?(t=s.as(e,y.Forma))&&(n=s.as(t.controller,H.TypeLockupController))&&(o=s.as(t.style,M.LockupStyle))&&(a=o.font)?C.FontFacade.ensureFontLoaded(a.fontData).then((function(e){return n.updateGroup(),t})):m.CorePromise.reject("unable to inspect created lockup for style and font"):e;var t,n,o,a}))):m.CorePromise.reject("textCN is nil")})):m.CorePromise.reject("document has no controller");var a},duplicateItems:function(t,n,r,o){var a,i;void 0===o&&(o=!1);var l=s.clone(k.LayerFacade.sortInZOrder(t));return e.copyItems(l,null).then((function(e){var t=s.clone(e);if(0==!t.length){if(n&&t.forEach((function(e){return e.move(N.Matrix2D.translationXY(25,25))})),r)t[0].page.document.controller.selection.replaceSelectionWithFormae(t);if(t.length==l.length)for(var u=s.iter(s.toSequence(l));!u.done;u.next()){var c=u.value,d=c.offset,h=c.element,p=t[d],f=k.LayerFacade.getZOrder(h),m=k.LayerFacade.getReorderableLayerCount(p)+k.LayerFacade.getMinLayerIndex(p)-1,g=Math.min(f+1,m);1==o?(k.LayerFacade.setZOrder(f,p),k.LayerFacade.setZOrder(g,h)):k.LayerFacade.setZOrder(g,p)}else s.opt(A.Host.logging,(function(e){return e.info("copyItems failed to copy all items")}));if(((a=s.opt(s.opt(t[0].page.document,(function(e){return e.controller})),(function(e){return e.enableMoveableChildren})))||null!=a)&&a&&l.length==t.length)for(var y=s.iter(s.range(0,l.length,!1));!y.done;y.next()){var _=y.value;((i=s.opt(l[_].controller,(function(e){return e.userGroupChild})))||null!=i)&&i&&s.opt(l[_].parent,(function(e){return e.appendChild(t[_])}))}}return t}))},fixUpColorReferences:function(e,t,n,r,o,a){t?p.ColorLibraryMap.remapColors(e,n,r,a):p.ColorLibraryMap.detachFromLibrary(e,n,o)},remapReferences:function(t,n,r,o){if(!s.opt(t.controller,(function(e){return 1==e.userGroup}))){if(t.page!=n.page){var a,i,l,u,c=t.style,d=n.style;if((a=c.colorLibrary)&&(i=d.colorLibrary))e.fixUpColorReferences(d.colors,o,a,i,n.page.colorLibraryController,r),(l=s.as(d,M.LockupStyle))&&(u=l.characterStyles[H.TypeLockupController.HIGHLIGHT_STYLE])&&e.fixUpColorReferences(u.colors,o,a,i,n.page.colorLibraryController,r)}var h,p,f,m;(h=s.as(t,T.FrameForma))&&(p=s.as(n,T.FrameForma))&&(f=h.image)&&(m=p.image)&&e.remapReferences(f,m,r,o)}},copyItemsState:{get:function(){return void 0===t.copyItemsState&&(t.copyItemsState=new i.CopyItemsState),t.copyItemsState},set:function(e){t.copyItemsState=e}},copyItems:function(t,n,r,o,a,i){if(void 0===n&&(n=null),void 0===r&&(r=!0),void 0===o&&(o=!0),void 0===a&&(a=null),void 0===i&&(i=null),0==t.length)return m.CorePromise.resolve([]);var l;if(l=t[0].page.document){var u=t.filter((function(e){return s.opt(e.controller,(function(e){return 1==e.duplicatable}))}),this);if(0==u.length)return m.CorePromise.resolve([]);e.copyItemsState.onStart(o);var c=[],d=!1,h=m.CorePromise.resolve(null);return u.forEach((function(t){h=h.then((function(o){return t.controller.copyTo(n,a,i,r).then((function(n){var o;return(o=s.as(n,y.Forma))?(o.isImage()&&(d=!0),r&&e.remapReferences(t,o,e.copyItemsState.mappingCache,e.copyItemsState.mapColorsToTheme),c.push(o),o):null}))}))})),h.then((function(t){return d&&j.TheoDocumentUtils.updateConstrainedImageInfo(s.opt(n,(function(e){return e.document}))||l),e.copyItemsState.onEnd(),c}))}return m.CorePromise.reject("copyItems: no document?")},deleteFormae:function(e,t){var n,r;if(e.length>0&&(r=e[0].page.document)){for(var o=!1,a=!1,i=!1,l=[],d=s.iter(e);!d.done;d.next()){var h,p,f=d.value;if(h=s.as(f.page.root.controller,B.RootController))(p=h.getGridController())&&p.onFormaeDeleted([f]);if(l.includes(f.page)||l.push(f.page),!(f instanceof w.RootForma)){var m;if(f.isImage()&&(a=!0),f.isLogo()?c.BrandingFacade.isImageBrandedLogo(f)&&(o=!0):f.isTypeLockup()&&c.BrandingFacade.doesLockupUseBrandedFonts(f)&&(o=!0),f.isVideo()&&(i=!0),r.controller.selection.isSelected(f)&&r.controller.selection.deselectForma(f),m=f.parent){var g=f.parent;for(s.opt(s.as(m.controller,v.GroupController),(function(e){return e.removeFormaFromGroup(f)}));((n=s.opt(s.opt(g,(function(e){return e.controller})),(function(e){return e.userGroup})))||null!=n)&&n;){var y=g.parent;g.childCount<=1?S.GroupFacade.ungroupItems([g]):S.GroupFacade.updateUserGroupBounds(g),g=y}}var _=f.controller.settings;null!=_&&_==f.page.document.controller.controllerSettingsState.settings&&(f.page.document.controller.controllerSettingsState.settings=null)}}for(var T=s.iter(l);!T.done;T.next()){var C=T.value;u.AnimationLibrary.updateCurrentStyle(C,i)}o&&c.BrandingFacade.unBrandDocumentIfNoBrandedElements(r),a&&j.TheoDocumentUtils.updateConstrainedImageInfo(r)}s.opt(t,(function(e){return e()}))},addContentNodeToDocument:function(e,t){var n;(n=e)&&null==n.parent&&t.content.root.appendChild(n)},removeContentNodeFromDocument:function(e,t){var n;(n=e)&&t.content.root.removeChild(n)},addContent:function(t,n,r,o,a){var l;if(void 0===r&&(r=null),void 0===o&&(o=!1),void 0===a&&(a=i.AddFormaParams.DEFAULTS),l=t.document){var c;if(e.addContentNodeToDocument(n,l),e.addContentNodeToDocument(r,l),x.MotionUtils.invalidateAnimation(t),c=e.createFormaFromContent(t,n,r)){var d,h;if((d=a.formaToReplace)&&(h=s.as(s.opt(d.parent,(function(e){return e.controller})),v.GroupController))){var p=b.ImageFacade.getCutoutModeForForma(d);return(p==R.CutoutMode.Off?m.CorePromise.resolve(null):b.ImageFacade.createAndLoadCutoutMaskForReplacementImage(c,p)).then((function(e){var n,r,a,i=d.finalFrame;return h.replaceChildWithForma(d,c,o),u.AnimationLibrary.updateCurrentStyle(t,c.isVideo()),(n=s.as(e,I.ImageForma))&&(r=s.as(c,T.FrameForma))&&(a=s.as(d,T.FrameForma))&&b.ImageFacade.finalizeCutoutAfterMaskLoad(r,n,p,a,i),c}))}return a.parentingHint==i.AddFormaParentingHint.doNotAddFormaForContentToTree?m.CorePromise.resolve(c):e.addForma(t,c,a).thenReturn(c)}return m.CorePromise.reject("Could not create forma from content")}return m.CorePromise.reject("No related document, or controller")},addForma:function(e,t,n){var r;return void 0===n&&(n=i.AddFormaParams.DEFAULTS),(r=t.controller)?r.addForma(e,t,n).then((function(r){return t.isImage()&&j.TheoDocumentUtils.updateConstrainedImageInfo(e.document),u.AnimationLibrary.updateCurrentStyle(e,t.isVideo()),n.behavior==l.ControllerSettingsBehaviorEnum.SetControllerSettings&&s.opt(s.opt(e.document,(function(e){return e.controller})),(function(e){return e.controllerSettingsState.settings=s.opt(t.controller,(function(e){return e.settings}))})),null})):m.CorePromise.resolve(null)},createFormaFromContent:function(e,t,n){var r,o,a,i,l,u,d;if((o=e.document)&&(a=o.controller))if(i=s.as(t,F.ImageContentNode)){var h=e.createForma(I.ImageForma.KIND);if(h.contentID=t.id,t.getTag(F.ImageContentNode.IMAGE_MASK_ROLE_TAG)==F.ImageContentNode.ROLE_MASK)r=h;else{switch(s.opt(i.mediaMetadata,(function(e){return e.designIntent}))){case"logo":null!=i.sparkElementID&&""!=i.sparkElementID&&c.BrandingFacade.brandDocumentForElement(o,i.sparkElementID,c.AUTHORING_CONTEXT_TYPE_LOGO),h.intent=y.Forma.INTENT_LOGO;break;case"pattern":h.intent=y.Forma.INTENT_PATTERN;break;case"icon":h.intent=y.Forma.INTENT_ICON;break;case"floating-image":h.intent=y.Forma.INTENT_FLOATING_IMAGE}(f=e.createForma(T.FrameForma.KIND)).appendChild(h),r=f}}else if(l=s.as(t,X.VideoContentNode)){var p,f,m=e.createForma(q.VideoForma.KIND);m.videoContentNode=l,(p=s.as(m.style,Z.VideoStyle))&&(p.duration=l.duration),null!=n&&(m.contentID=n.id),(f=e.createForma(T.FrameForma.KIND)).appendChild(m),r=f,s.opt(s.opt(m.contentNode,(function(e){return e.mediaMetadata})),(function(e){return e.designIntent==L.MediaMetadata.DESIGNINTENT_STICKER}))&&(m.intent=y.Forma.INTENT_STICKER)}else if(u=s.as(t,K.VectorContentNode)){O.LegacyCoreAssert.isFalse(s.opt(u.mediaMetadata,(function(e){return e.designIntent==L.MediaMetadata.DESIGNINTENT_ICON})),"can't create icon from VectorContentNode",void 0,"CreationFacade.createFormaFromContent","CreationFacade.swift",774);var g=e.createForma(z.VectorForma.KIND);g.contentID=u.id,r=g}else if(d=s.as(t,V.TextContentNode)){var _=e.createForma(P.GroupForma.KIND),C=a.controllerFactory.createController(H.TypeLockupController.KIND,_);_.controller=C,C.contentNode=d,C.size=new W.TheoSize(400,300),r=_}return r}}}),e}(),i.CopyItemsState=(a=function(){this.mappingCache=null,this.mapColorsToTheme=!1,this.depth=0},s.defineClass({name:"CopyItemsState",ctor:a,props:{onStart:function(e){0==this.depth&&(this.mappingCache={},this.mapColorsToTheme=e),this.depth+=1},onEnd:function(){0!=this.depth?(this.depth-=1,0==this.depth&&(this.mappingCache=null,this.mapColorsToTheme=!1)):d.CoreAssertDebugOnly.fail("CopyItemsState mismatched onStart/onEnd",void 0,"CopyItemsState.onEnd","CreationFacade.swift",821)}}}),a)},CqFS:function(e,t,n){var r,o,a=t,i=n("oAGj"),s=n("ytEx"),l=n("x0BK"),u=n("3OP7"),c=n("FNB+"),d=n("fNpk");a.PREFIX_COMPONENT="component:",a.PROPERTY_KEY_CHILDREN="children",a.PROPERTY_KEY_EXTERNAL_URL="external-url",a.JSONNodeEncoder=(r=function(e,t,n){this.manifestEncoder_=null,this.jsonNode_=t,this.parentEncoder_=n,s.BaseNodeEncoder.call(this,e,e.root)},o={},i.defineClass({name:"JSONNodeEncoder",ctor:r,superName:"BaseNodeEncoder",statics:{PROPERTY_KIND_NAMESPACED:{get:function(){return void 0===o.PROPERTY_KIND_NAMESPACED&&(o.PROPERTY_KIND_NAMESPACED=u.DocumentPersistenceFactory.namespacedPropertyName(c.Forma.PROPERTY_KIND)),o.PROPERTY_KIND_NAMESPACED}},_implements:function(e){return"IExportDataObject"==e}},props:{getPropertyOnNode:function(e){return this.jsonNode_[e]},setPropertyOnNode:function(e,t){var n,o;null!=t?(this.jsonNode_[e]=t,(n=this.manifestEncoder_)&&null!=(o=i.as(t,"String"))&&(e==s.PROPERTY_KEY_PATH?n.setPath(o):e==s.PROPERTY_KEY_TYPE?n.setType(o):e==r.PROPERTY_KIND_NAMESPACED&&n.setStringProperty(c.Forma.PROPERTY_KIND,o))):i.removeKey(this.jsonNode_,e)},createChildEncoder:function(e){var t={};t[s.PROPERTY_KEY_ID]=i.as(e,"AnyObject");var n=i.as(this.getPropertyOnNode(a.PROPERTY_KEY_CHILDREN),["Array","AnyObject"]);null==n&&(n=[]),n.push(t),this.setPropertyOnNode(a.PROPERTY_KEY_CHILDREN,n),d.LegacyCoreAssert.isTrue(this.getPropertyOnNode(a.PROPERTY_KEY_CHILDREN)===n,"children getter should return same object reference as just set",void 0,"JSONNodeEncoder.createChildEncoder","JSONNodeEncoder.swift",64);var o=new r(this.branch_,t,this);return d.LegacyCoreAssert.isTrue(i.as(o.jsonNode_,"AnyObject")===i.as(t,"AnyObject"),"JSON encoder should same json node reference as it was just constructed with",void 0,"JSONNodeEncoder.createChildEncoder","JSONNodeEncoder.swift",67),o},findChild:function(e){return null==e?null:(t=this.getManifestEncoder().findChild(e))?t:s.BaseNodeEncoder.prototype.findChild.call(this,e);var t},appendComponent:function(e,t,n){s.BaseNodeEncoder.prototype.appendComponent.call(this,e,t,n);var r=this.branch_.getValue(s.PROPERTY_KEY_ID),o=a.PREFIX_COMPONENT+r+"/"+e+"/"+i.replaceAll(n,"/","+");this.setProperty(a.PROPERTY_KEY_EXTERNAL_URL,i.as(o,"AnyObject"))},getManifestEncoder:function(){var e,t,n;return null==this.manifestEncoder_&&(null==this.parentEncoder_?this.manifestEncoder_=new l.DCXNodeEncoder(this.branch_,this.branch_.root):this.manifestEncoder_=this.parentEncoder_.getManifestEncoder().createChildEncoder(this.id),null!=(e=i.as(this.getPropertyOnNode(s.PROPERTY_KEY_PATH),"String"))&&i.opt(this.manifestEncoder_,(function(t){return t.setPath(e)})),null!=(t=i.as(this.getPropertyOnNode(s.PROPERTY_KEY_TYPE),"String"))&&i.opt(this.manifestEncoder_,(function(e){return e.setType(t)})),null!=(n=this.getPropertyOnNode(r.PROPERTY_KIND_NAMESPACED))&&i.opt(this.manifestEncoder_,(function(e){return e.setProperty(c.Forma.PROPERTY_KIND,n)}))),this.manifestEncoder_},finish:function(){s.BaseNodeEncoder.prototype.finish.call(this),this.parentEncoder_=null,this.manifestEncoder_=null}}}),r)},DP9v:function(e,t,n){var r,o,a=t,i=n("oAGj"),s=n("0wFF"),l=n("gXiO"),u=n("iCxV"),c=n("8vXU"),d=n("rxGp"),h=n("fNpk"),p=n("Kkml"),f=n("rrhp");a.MultiBrandFeatureSet=i.defineEnum("MultiBrandFeatureSet",{MULTIBRAND_OWNED_ONLY:0,MULTIBRAND_COMPATIBILITY_MODE_OWNED_ONLY:1,SHARED_BRANDS:2}),a.MultiBrandFacade=(r=function(){l.CoreObject.call(this)},o={},i.defineClass({name:"MultiBrandFacade",ctor:r,superName:"CoreObject",statics:{_sparkACManager:{get:function(){return void 0===o._sparkACManager&&(o._sparkACManager=u.Host.brandkitManager.authoringContextManager),o._sparkACManager},set:function(e){o._sparkACManager=e}},acManager:{get:function(){var e;return(e=r._acManager)?e:r._sparkACManager}},_usingMockedACManager:!1,usingMockedACManager:{get:function(){return r._usingMockedACManager}},useMockACManager:function(e){r._acManager=e,r._usingMockedACManager=!0,r._defaultBrandkitID=null,r._activeBrandkitID=null},useDefaultACHelper:function(){r._acManager=r._sparkACManager,r._usingMockedACManager=!1,r._defaultBrandkitID=null,r._activeBrandkitID=null,r.determineDefaultBrand()},_defaultBrandkitID:null,defaultBrandkitID:{get:function(){return h.LegacyCoreAssert.isTrue(null==r._defaultBrandkitID||!i.isEmpty(r._defaultBrandkitID),"default brand kit id should be nil or non-empty",void 0,"MultiBrandFacade","MultiBrandFacade.swift",74),r._defaultBrandkitID}},defaultBrand:{get:function(){var e;return(e=r.authoringContext(r.defaultBrandkitID))?e.isMinimal?null:e:null}},_activeBrandkitID:null,activeBrandkitID:{get:function(){return h.LegacyCoreAssert.isTrue(null==r._activeBrandkitID||!i.isEmpty(r._activeBrandkitID),"active brand kit id should be nil or non-empty",void 0,"MultiBrandFacade","MultiBrandFacade.swift",103),r._activeBrandkitID}},setActiveBrandkitID:function(e){var t=r.activeBrandkitID;r._activeBrandkitID=null!=e&&i.isEmpty(e)?null:e,t!=r.activeBrandkitID&&(u.Host.logging.logForCategory(d.LogCategories.kMultibrand,"MultiBrandFacade.setActiveBrand: changing from "+r.brandInfo(t)+" to "+r.brandInfo(r.activeBrandkitID),c.LogLevelEnum.INFO_LEVEL),i.opt(u.Host.brandkitManager,(function(e){return e.sendActiveBrandChangedNotification(r.activeBrandkitID)})))},activeBrand:{get:function(){var e,t;return null==r.activeBrandkitID&&null!=r.defaultBrandkitID&&(r.usingMockedACManager||u.Host.logging.logForCategory(d.LogCategories.kMultibrand,"MultiBrandFacade.activeBrand: activeBrandkitID is nil, falling back to defaultBrandkit: "+((e=r.defaultBrandkitID)||null!=e?e:"none"),c.LogLevelEnum.INFO_LEVEL)),r.authoringContext((t=r.activeBrandkitID)||null!=t?t:r.defaultBrandkitID)}},getBrand:function(e){return i.isEmpty(e.authoringContextID)?null:r.authoringContext(e.authoringContextID)},setActiveBrand:function(e){null==e?r.setActiveBrandkitID(null):i.isEmpty(e.authoringContextID)?r.setActiveBrandkitID(r.defaultBrandkitID):r.setActiveBrandkitID(e.authoringContextID)},isBrandOwnedByCurrentUser:function(e){return i.clone(r.acManager.getOwnedAuthoringContextIDs()).filter((function(t){return t==e.id}),this).length>0},authoringContext:function(e){return null==e||i.isEmpty(e)?null:r.acManager.authoringContext(e)},authoringContexts:{get:function(){return r.acManager.authoringContexts}},ownedAuthoringContexts:{get:function(){var e=[],t=i.clone(r.acManager.getOwnedAuthoringContextIDs());if(t.length>0)for(var n=i.iter(t);!n.done;n.next()){var o,a=n.value;(o=r.acManager.authoringContext(a))&&e.push(o)}return e}},ownedBrandCount:{get:function(){return r.ownedAuthoringContexts.length}},sharedWithMeAuthoringContexts:{get:function(){var e=i.clone(r.acManager.getOwnedAuthoringContextIDs());return r.authoringContexts.filter((function(t){return!e.includes(t.id)}),this)}},sharedWithMeBrandCount:{get:function(){return r.sharedWithMeAuthoringContexts.length}},partialAuthoringContexts:{get:function(){return r.authoringContexts.filter((function(e){return!e.activated}),this)}},partialBrandCount:{get:function(){return r.partialAuthoringContexts.length}},usableAuthoringContexts:{get:function(){var e,t,n,o=[];if(e=r.featureSet==a.MultiBrandFeatureSet.SHARED_BRANDS?r.authoringContexts.filter((function(e){return e.activated}),this).map((function(e){return e.id}),this):r.ownedAuthoringContexts.filter((function(e){return e.activated}),this).map((function(e){return e.id}),this),null!=(t=r.defaultBrandkitID)&&(n=r.acManager.authoringContext(t))&&(o.push(n),e=e.filter((function(e){return e!=t}),this)),e.length>0)for(var s=i.iter(e);!s.done;s.next()){var l,u=s.value;(l=r.acManager.authoringContext(u))&&o.push(l)}return o}},usableBrandCount:{get:function(){return r.usableAuthoringContexts.length}},handleUndoRedoMessage:function(e){var t,n,r,o,a;if((o=i.as(e.changeAction,p.ChangeBrandingUserAction))&&null!=(a=e.changeDirection)){var s=(t=o.fromDocBrandID)||null!=t?t:"",l=(n=o.toBrandID)||null!=n?n:"";i.isEmpty(s)&&(a==f.UndoRedoChangeDirection.Undo?(u.Host.logging.logForCategory(d.LogCategories.kMultibrand,"MultiBrandManager.handleUndoRedoMessage: for Undo from "+l+" to none, resetting active brand to previous value "+((r=o.fromActiveBrandID)||null!=r?r:"none"),c.LogLevelEnum.INFO_LEVEL),i.opt(u.Host.brandkitManager,(function(e){return e.activateBrand(o.fromActiveBrandID)}))):(u.Host.logging.logForCategory(d.LogCategories.kMultibrand,"MultiBrandManager.handleUndoRedoMessage: for Redo from none to "+l+", resetting active brand to new brand",c.LogLevelEnum.INFO_LEVEL),i.opt(u.Host.brandkitManager,(function(e){return e.activateBrand(l)}))))}},featureSet:{get:function(){return void 0===o.featureSet&&(o.featureSet=a.MultiBrandFeatureSet.MULTIBRAND_OWNED_ONLY),o.featureSet},set:function(e){o.featureSet=e}},determineDefaultBrand:function(){var e=r.acManager.getDefaultBrandIdFromServer();switch(r.featureSet){case a.MultiBrandFeatureSet.MULTIBRAND_OWNED_ONLY:r.determineDefaultBrand_forMultiBrand();break;case a.MultiBrandFeatureSet.MULTIBRAND_COMPATIBILITY_MODE_OWNED_ONLY:r.determineDefaultBrand_CompatibilityMode(e);break;case a.MultiBrandFeatureSet.SHARED_BRANDS:r.determineDefaultBrand(e)}},determineDefaultBrand_forMultiBrand:function(){var e,t,n=null,o=null,a=(e=i.opt(u.Host.brandkitManager,(function(e){return e.adobeID})))||null!=e?e:"";if(u.Host.logging.logForCategory(d.LogCategories.kMultibrand,"MultiBrandFacade.determineDefaultBrand: "+r.authoringContexts.length+" authoringContexts",c.LogLevelEnum.INFO_LEVEL),(!i.isEmpty(a)&&u.Host.brandkitManager.isBrandkitEnabled||r.usingMockedACManager)&&r.authoringContexts.length>0){var s=i.clone(r.ownedAuthoringContexts);switch(u.Host.logging.logForCategory(d.LogCategories.kMultibrand,"MultiBrandFacade.determineDefaultBrand: "+s.length+" ownedBrands",c.LogLevelEnum.INFO_LEVEL),s.length){case 0:n=null;break;case 1:s[0].isDefault&&(n=(o=s[0]).id,o.activated||u.Host.logging.logForCategory(d.LogCategories.kMultibrand,"MultiBrandFacade.determineDefaultBrand: default brand "+r.brandInfo(o.id)+" is a partial brand",c.LogLevelEnum.INFO_LEVEL));break;default:for(var l=i.iter(s);!l.done;l.next()){var h=l.value;if(h.isDefault){n=(o=h).id,h.activated||u.Host.logging.logForCategory(d.LogCategories.kMultibrand,"MultiBrandFacade.determineDefaultBrand: default brand "+r.brandInfo(h.id)+" is a partial brand",c.LogLevelEnum.INFO_LEVEL);break}}}}null!=o&&o.isMinimal&&u.Host.logging.logForCategory(d.LogCategories.kMultibrand,"MultiBrandFacade.determineDefaultBrand: default brand is in minimal sync state!",c.LogLevelEnum.INFO_LEVEL),r.defaultBrandkitID!=n?(u.Host.logging.logForCategory(d.LogCategories.kMultibrand,"MultiBrandFacade.determineDefaultBrand: changing from "+r.brandInfo(r.defaultBrandkitID)+" to "+r.brandInfo(n),c.LogLevelEnum.INFO_LEVEL),r._defaultBrandkitID=n,r.usingMockedACManager||u.Host.brandkitManager.sendDefaultBrandChangedNotification(r.defaultBrandkitID)):u.Host.logging.logForCategory(d.LogCategories.kMultibrand,"MultiBrandFacade.determineDefaultBrand: no change, still using "+((t=r.defaultBrandkitID)||null!=t?t:"none"),c.LogLevelEnum.INFO_LEVEL)},determineDefaultBrand_CompatibilityMode:function(e){var t,n=null;if(u.Host.brandkitManager.isBrandkitEnabled||r.usingMockedACManager){var o,a=!1;if((o=r.authoringContext(e))&&o.ownedByCurrentUser&&o.activated&&(u.Host.logging.logForCategory(d.LogCategories.kMultibrand,"determineDefaultBrand: using valueFromSpark "+o.name,c.LogLevelEnum.INFO_LEVEL),a=!0),a)n=e;else{var s,l,h,p=i.clone(r.ownedAuthoringContexts);(s=i.first(p.filter((function(e){return e.isDefault}),this).filter((function(e){return e.activated}),this)))?(n=s.id,u.Host.logging.logForCategory(d.LogCategories.kMultibrand,"determineDefaultBrand: fallback using preSharingLogic_DefaultBrand "+s.name,c.LogLevelEnum.INFO_LEVEL)):(l=i.first(i.sort(p.filter((function(e){return e.activated}),this),(function(e,t){return e.name<t.name}))))?(n=l.id,u.Host.logging.logForCategory(d.LogCategories.kMultibrand,"determineDefaultBrand: fallback using firstOwnedActivatedAlphabeticBrand "+l.name,c.LogLevelEnum.INFO_LEVEL)):(h=i.first(i.sort(p.filter((function(e){return!e.activated}),this),(function(e,t){return e.name<t.name}))))?(n=h.id,u.Host.logging.logForCategory(d.LogCategories.kMultibrand,"determineDefaultBrand: fallback using firstOwnedUnActivatedAlphabeticBrand: "+h.name,c.LogLevelEnum.INFO_LEVEL)):u.Host.logging.logForCategory(d.LogCategories.kMultibrand,"determineDefaultBrand: no fallback default brand",c.LogLevelEnum.INFO_LEVEL)}}var f=r.authoringContext(n);null!=f&&f.isMinimal&&u.Host.logging.logForCategory(d.LogCategories.kMultibrand,"MultiBrandFacade.determineDefaultBrand: default brand is in minimal sync state!",c.LogLevelEnum.INFO_LEVEL),r.defaultBrandkitID!=n?(u.Host.logging.logForCategory(d.LogCategories.kMultibrand,"MultiBrandFacade.determineDefaultBrand: changing from "+r.brandInfo(r.defaultBrandkitID)+" to "+r.brandInfo(n),c.LogLevelEnum.INFO_LEVEL),r._defaultBrandkitID=n,r.usingMockedACManager||u.Host.brandkitManager.sendDefaultBrandChangedNotification(r.defaultBrandkitID)):u.Host.logging.logForCategory(d.LogCategories.kMultibrand,"MultiBrandFacade.determineDefaultBrand: no change, still using "+((t=r.defaultBrandkitID)||null!=t?t:"none"),c.LogLevelEnum.INFO_LEVEL)},determineDefaultBrand:function(e){var t,n=null;if(u.Host.brandkitManager.isBrandkitEnabled||r.usingMockedACManager){var o,a=!1;if((o=r.authoringContext(e))&&o.activated&&(u.Host.logging.logForCategory(d.LogCategories.kMultibrand,"determineDefaultBrand: using valueFromSpark "+o.name,c.LogLevelEnum.INFO_LEVEL),a=!0),a)n=e;else{var s,l,h,p,f=i.clone(r.ownedAuthoringContexts);(s=i.first(f.filter((function(e){return e.isDefault}),this).filter((function(e){return e.activated}),this)))?(n=s.id,u.Host.logging.logForCategory(d.LogCategories.kMultibrand,"determineDefaultBrand: fallback using preSharingLogic_DefaultBrand "+s.name,c.LogLevelEnum.INFO_LEVEL)):(l=i.first(i.sort(f.filter((function(e){return e.activated}),this),(function(e,t){return e.name<t.name}))))?(n=l.id,u.Host.logging.logForCategory(d.LogCategories.kMultibrand,"determineDefaultBrand: fallback using firstOwnedActivatedAlphabeticBrand "+l.name,c.LogLevelEnum.INFO_LEVEL)):(h=i.first(i.sort(r.sharedWithMeAuthoringContexts.filter((function(e){return e.activated}),this),(function(e,t){return e.name<t.name}))))?(n=h.id,u.Host.logging.logForCategory(d.LogCategories.kMultibrand,"determineDefaultBrand: fallback using firstSharedActivatedAlphabeticBrand: "+h.name,c.LogLevelEnum.INFO_LEVEL)):(p=i.first(i.sort(f.filter((function(e){return!e.activated}),this),(function(e,t){return e.name<t.name}))))?(n=p.id,u.Host.logging.logForCategory(d.LogCategories.kMultibrand,"determineDefaultBrand: fallback using firstOwnedUnActivatedAlphabeticBrand: "+p.name,c.LogLevelEnum.INFO_LEVEL)):u.Host.logging.logForCategory(d.LogCategories.kMultibrand,"determineDefaultBrand: no fallback default brand",c.LogLevelEnum.INFO_LEVEL)}}var m=r.authoringContext(n);null!=m&&m.isMinimal&&u.Host.logging.logForCategory(d.LogCategories.kMultibrand,"MultiBrandFacade.determineDefaultBrand: default brand is in minimal sync state!",c.LogLevelEnum.INFO_LEVEL),r.defaultBrandkitID!=n?(u.Host.logging.logForCategory(d.LogCategories.kMultibrand,"MultiBrandFacade.determineDefaultBrand: changing from "+r.brandInfo(r.defaultBrandkitID)+" to "+r.brandInfo(n),c.LogLevelEnum.INFO_LEVEL),r._defaultBrandkitID=n,r.usingMockedACManager||u.Host.brandkitManager.sendDefaultBrandChangedNotification(r.defaultBrandkitID)):u.Host.logging.logForCategory(d.LogCategories.kMultibrand,"MultiBrandFacade.determineDefaultBrand: no change, still using "+((t=r.defaultBrandkitID)||null!=t?t:"none"),c.LogLevelEnum.INFO_LEVEL)},brandWasDeleted:function(e){r.determineDefaultBrand(),r.activeBrandkitID==e&&(u.Host.logging.logForCategory(d.LogCategories.kMultibrand,"MultiBrandFacade.onAuthoringContextDeleted:  Active Brand was deleted!",c.LogLevelEnum.INFO_LEVEL),r.setActiveBrandkitID(r.defaultBrandkitID))},brandInfo:function(e){var t,n="none";return(t=r.authoringContext(e))&&(n=t.name+":"+t.id),n},addBrandkit:function(e){var t;return 0!=r.ownedBrandCount&&h.LegacyCoreAssert.fail("addBrandkit called when user already owns at least one Brandkit",{},"MultiBrandFacade.addBrandkit","MultiBrandFacade.swift",535),(t=r.acManager.createAuthoringContext(e,!0))?(u.Host.platform.isIOS?i.opt(u.Host.logging,(function(e){return e.logToAnalytics(s.AnalyticsConstants.kAnalyticsDataBrandkitCreatediOS,{})})):u.Host.platform.isAndroid&&i.opt(u.Host.logging,(function(e){return e.logToAnalytics(s.AnalyticsConstants.kAnalyticsDataBrandkitCreatedAndroid,{})})),t):null}}}),r)},DaVl:function(e,t,n){var r,o=t,a=n("oAGj"),i=n("BAdM");o.TheoJSONDecoder=(r=function(e,t){this.namespace_="",void 0===t&&(t=""),this.json=a.clone(e),this.namespace_=t},a.defineClass({name:"TheoJSONDecoder",ctor:r,statics:{_implements:function(e){return"IImportDataObject"==e}},props:{id:{get:function(){return a.as(this.json.id,"String")}},type:{get:function(){return a.as(this.json.type,"String")}},name:{get:function(){return a.as(this.json.name,"String")}},path:{get:function(){return a.as(this.json.path,"String")}},optionalStringProperty:function(e){return a.as(this.json[this.namespace_+e],"String")},stringProperty:function(e,t){var n;return(n=a.as(this.json[this.namespace_+e],"String"))||null!=n?n:t},numberProperty:function(e,t){var n;return(n=a.as(this.json[this.namespace_+e],"Double"))||null!=n?n:t},intProperty:function(e,t){var n;return(n=a.as(this.json[this.namespace_+e],"Int"))||null!=n?n:t},booleanProperty:function(e,t){var n;return(n=a.as(this.json[this.namespace_+e],"Bool"))||null!=n?n:t},optionalBooleanProperty:function(e){return a.as(this.json[this.namespace_+e],"Bool")},property:function(e){return a.as(this.json[this.namespace_+e],"AnyObject")},forEachChild:function(e){var t;if(t=a.as(this.json.children,["Array",["Dictionary","String","Any"]]))for(var n=0,o=a.iter(t);!o.done;o.next()){var i=o.value;e(new r(i,this.namespace_),n),n+=1}},forEachComponent:function(e){var t;if(t=a.as(this.json.components,["Array",["Dictionary","String","Any"]]))for(var n=0,r=a.iter(t);!r.done;r.next()){var o=r.value;e(i.JSONComponentDecoder.init_466d(o),n),n+=1}}}}),r)},"FNB+":function(e,t,n){var r,o=t,a=n("oAGj"),i=n("HRWw"),s=n("ascj"),l=n("dJuF"),u=n("SmK9"),c=n("URxh"),d=n("H9Ol"),h=n("6ZWm"),p=n("G1DZ"),f=n("QbzR"),m=n("P83h"),g=n("9Lk3"),y=n("pnSN"),_=n("4mVB"),T=n("ZhwN"),C=n("iCxV"),v=n("fNpk"),P=n("tGKA"),S=n("Quhx"),A=n("K0Rh"),D=n("8t9B"),E=n("zjod");o.FormaPlatformView=a.defineProtocol("FormaPlatformView",{beginUpdate:"(FormaUpdateEvent) -> Void",endUpdate:"(FormaUpdateEvent) -> Void",formaDeleted:"() -> Void"}),o.FormaTraversal=a.defineEnum("FormaTraversal",{PreOrder:1,PostOrder:2,NearestAncestor:4,FurthestAncestor:5,JustChildren:6,PreOrderWithAuxiliaries:7,PostOrderWithAuxiliaries:8,JustAuxiliaries:9,JustChildrenAndAuxiliaries:10}),o.Forma=(r=function(){this.isFullCanvas=!1,this.stateChangeEvents=null,this.isModel_=!1},a.defineClass({name:"Forma",ctor:r,superName:"PostDCXObject",statics:{SCHEMA_CLASS_NAME:{get:function(){return"Forma"}},KIND:{get:function(){return""}},PROPERTY_KIND:"kind",PROPERTY_PLACEMENT:"placement",PROPERTY_STYLE:"style",PROPERTY_ANIMATION:"animation",PROPERTY_MOVEABLE:"moveable",PROPERTY_INTENT:"intent",PROPERTY_ORIGINAL_ID:"original-id",PROPERTY_SOURCE:"source",PROPERTY_TAGS:"tags",PROPERTY_CONTROLLER_KIND:"controller-kind",PROPERTY_CONTROLLER_METADATA:"controller-metadata",INTENT_LOGO:"logo",INTENT_PATTERN:"pattern",INTENT_ICON:"icon",INTENT_FLOATING_SHAPE:"floating-shape",INTENT_GRID_CELL:"grid-cell",INTENT_INFERRED_TEMP_GROUP:"inferred-temp-group",INTENT_STICKER:"sticker",INTENT_FLOATING_IMAGE:"floating-image",INTENT_TEMP_IMAGE_CROP:"temp-image-crop",INTENT_TEMP_IMAGE_REFINE_CUTOUT:"temp-image-refine-cutout",INTENT_IMAGE_MASK:"image-mask",INTENT_CUTOUT_MASK:"cutout-mask",INTENT_USER_GROUP:"user-group",TAG_IS_AUXILIARY:"is-auxiliary",TAG_CREATED_FROM_REMIX:"created-from-remix",TAG_RECOMMENDATION_SOURCE:"recommendation-source",TAG_RECOMMENDATION_TYPE:"recommendation-type",ancestorsNearest:function(e,t,n){return null==e?null:n(e,t,0)?e:r.ancestorsNearest(e.parent,t-1,n)},ancestorsFurthest:function(e,t,n){if(null==e)return null;var o=r.ancestorsFurthest(e.parent,t-1,n);return null!=o?o:n(e,t,0)?e:null},_implements:function(e){return"IDBObject"==e||"TheoMessageSubscriber"==e||"TheoMessagePublisher"==e}},props:{init_3144:function(e,t,n,o){var i,s,l=this;if(this.parent_=o,this.page_=o.page,a.super_init(this,S.PostDCXObject,S.PostDCXObject.prototype.init_3181,t,n,e),null==a.as(this.get(r.PROPERTY_STYLE),f.FormaStyle)&&this.set(r.PROPERTY_STYLE,f.FormaStyle.createDefault()),(i=a.as(this.get(r.PROPERTY_STYLE),f.FormaStyle))&&(i.owner=this,i.colorLibrary=a.opt(this.page_,(function(e){return e.colorLibrary}))),s=this.animation)for(var u=a.iter(s.keyFrames);!u.done;u.next()){var c=u.value;a.opt(c.style,(function(e){return e.colorLibrary=a.opt(l.page_,(function(e){return e.colorLibrary}))}))}this.decodeController()},init_7dbd:function(e,t,n,o){var i,s,l=this;if(this.page_=o,a.super_init(this,S.PostDCXObject,S.PostDCXObject.prototype.init_3181,t,n,e),null==a.as(this.get(r.PROPERTY_STYLE),f.FormaStyle)&&this.set(r.PROPERTY_STYLE,f.FormaStyle.createDefault()),(i=a.as(this.get(r.PROPERTY_STYLE),f.FormaStyle))&&(i.owner=this,i.colorLibrary=this.page_.colorLibrary),s=this.animation)for(var u=a.iter(s.keyFrames);!u.done;u.next()){var c=u.value;a.opt(c.style,(function(e){return e.colorLibrary=l.page_.colorLibrary}))}this.decodeController()},init_812f:function(e,t){for(var n,o=e.database,i={path:function(){return T.GUIDUtils.makeGUID()},kind:function(){return r.KIND},"controller-kind":function(){return""},placement:function(){return P.Matrix2D.Identity},"controller-metadata":function(){return d.ControllerMetadata.init_d41d()},style:function(){return f.FormaStyle.createDefault()}},s=a.clone(t),l=a.iter(i);!l.done;l.next()){var u=l.key,c=l.value;null==t[u]&&(s[u]=c())}this.page_=e,a.super_init(this,S.PostDCXObject,S.PostDCXObject.prototype.init_5079,o,{},s,""),(n=a.as(this.get(r.PROPERTY_STYLE),f.FormaStyle))&&(n.owner=this,n.colorLibrary=this.page_.colorLibrary),this.initializeDefaultState(),this.decodeController()},init_d1c9:function(e,t){var n;this.parent_=null,this.page_=null,a.super_init(this,S.PostDCXObject,S.PostDCXObject.prototype.init_866e,t,e),null==a.as(this.get(r.PROPERTY_STYLE),f.FormaStyle)&&this.set(r.PROPERTY_STYLE,f.FormaStyle.createDefault()),(n=a.as(this.get(r.PROPERTY_STYLE),f.FormaStyle))&&(n.owner=this)},initializeDefaultState:function(){var e;(e=a.as(this.get(r.PROPERTY_STYLE),f.FormaStyle))&&(this.cachedStyle_=e,this.cachedStyle_.colorLibrary=this.page.colorLibrary,this.subscribeToStyle(this.cachedStyle_))},willChangeState:function(e){var t=this;S.PostDCXObject.prototype.willChangeState.call(this,e),v.LegacyCoreAssert.isTrue(null==this.stateChangeEvents,"About to change states when a pending state change still has queued events",void 0,"Forma.willChangeState","Forma.swift",181),this.stateChangeEvents={},a.keys(e).forEach((function(e){var n;(n=t.updateEventForProperty(e))&&(t.stateChangeEvents[e]=n)}));for(var n=a.iter(this.stateChangeEvents);!n.done;n.next()){var r=n.value;this.beginUpdate(r)}a.opt(this.controller,(function(n){return n.formaWillChangeState(t,e)}))},didChangeState:function(e){var t=this;S.PostDCXObject.prototype.didChangeState.call(this,e),v.LegacyCoreAssert.isTrue(null!=this.stateChangeEvents,"Changed states without prior will-change notification",void 0,"Forma.didChangeState","Forma.swift",200);for(var n=a.iter(this.stateChangeEvents);!n.done;n.next()){var r=n.value;this.endUpdate(r)}this.stateChangeEvents=null,a.opt(this.controller,(function(n){return n.formaDidChangeState(t,e)}))},willCommitState:function(){var e=this;S.PostDCXObject.prototype.willCommitState.call(this),a.opt(this.controller,(function(t){return t.formaWillCommitState(e)}))},didCommitState:function(){var e=this;S.PostDCXObject.prototype.didCommitState.call(this),a.opt(this.controller,(function(t){return t.formaDidCommitState(e)}))},updateEventForProperty:function(e){var t=null;return e==r.PROPERTY_PLACEMENT?t=new m.FormaTransformChangedEvent(this):e==r.PROPERTY_STYLE&&(t=new m.FormaStyleChangedEvent(this)),t},initializeToDefaults:function(){},decodeController:function(){var e=this;if(0!=this.controllerKind.length){var t=a.opt(a.opt(this.page.document,(function(e){return e.controller})),(function(e){return e.controllerFactory}));null!=t?(this.controller=t.createController(this.controllerKind,this),null!=this.controller?null==this.controllerMetadata&&(a.opt(C.Host.logging,(function(e){return e.warning("Forma: No controller metadata found?")})),this.set(r.PROPERTY_CONTROLLER_METADATA,d.ControllerMetadata.init_d41d()),a.opt(this.controller,(function(t){return t.controllerMetadata=e.controllerMetadata}))):a.opt(C.Host.logging,(function(t){return t.warning("Forma: Factory did not create a controller for "+e.controllerKind+"!")}))):a.opt(C.Host.logging,(function(t){return t.warning("Forma: No constructor for controller kind "+e.controllerKind+"!")}))}},postDecode:function(){this.style.colorLibrary=a.opt(this.page_,(function(e){return e.colorLibrary})),a.opt(this.styleSubscription_,(function(e){return e.unsubscribe()})),this.subscribeToStyle(this.style),a.opt(this.controller,(function(e){return e.postDecode()}))},destroy:function(){this.style.dispose(),a.opt(this.styleSubscription_,(function(e){return e.unsubscribe()})),this.styleSubscription_=null},controllerKind:{get:function(){var e;return(e=a.as(this.get(r.PROPERTY_CONTROLLER_KIND),"String"))||null!=e?e:""}},controllerMetadata:{get:function(){return a.as(this.get(r.PROPERTY_CONTROLLER_METADATA),d.ControllerMetadata)}},className:{get:function(){return r.SCHEMA_CLASS_NAME}},controller:{get:function(){return this.controller_},set:function(e){var t;null==e&&a.opt(C.Host.logging,(function(e){return e.warning("setting a nil controller")})),this.controller_=e,null!=this.controller_&&(this.set(r.PROPERTY_CONTROLLER_KIND,a.opt(this.controller_,(function(e){return e.kind}))),(t=this.controllerMetadata)&&(this.controller_.controllerMetadata=t))}},animation:{get:function(){return a.as(this.get(r.PROPERTY_ANIMATION),c.FormaAnimation)},set:function(e){var t,n,o=this,i=new m.FormaAnimationChangedEvent(this);if(this.beginUpdate(i),t=a.as(this.get(r.PROPERTY_ANIMATION),c.FormaAnimation))for(var s=a.iter(t.keyFrames);!s.done;s.next()){var l=s.value;a.opt(l.style,(function(e){return e.clearColorLibrarySub()}))}if(this.set(r.PROPERTY_ANIMATION,e),n=e)for(var u=a.iter(n.keyFrames);!u.done;u.next())l=u.value,a.opt(l.style,(function(e){return e.colorLibrary=a.opt(o.page_,(function(e){return e.colorLibrary}))}));this.endUpdate(i)}},formaID:{get:function(){return this.path}},contentID:{get:function(){return null!=this.controller?this.controller.contentID:null}},originalID_:{get:function(){return a.as(this.get(r.PROPERTY_ORIGINAL_ID),"String")},set:function(e){this.set(r.PROPERTY_ORIGINAL_ID,e)}},originalID:{get:function(){var e;return(e=this.originalID_)||null!=e?e:this.formaID}},source:{get:function(){var e;return(e=a.opt(a.opt(this.controller,(function(e){return e.userGroupRoot})),(function(e){return e.source})))||null!=e?e:a.as(this.get(r.PROPERTY_SOURCE),"String")},set:function(e){v.LegacyCoreAssert.isTrue(p.FormaSourceUtils.isValid(e),"invalid forma source",void 0,"Forma","Forma.swift",345),this.set(r.PROPERTY_SOURCE,e)}},kind:{get:function(){return this.get(r.PROPERTY_KIND)}},isEqual:function(e){var t;return!!(t=a.as(e,r))&&this.formaID==t.formaID},parent:{get:function(){return this.parent_}},removeFromParent:function(){null!=this.parent_&&this.parent_.removeChild(this)},setParent:function(e,t){void 0===t&&(t=!1);var n=this,r=this.parent_;null!=this.parent_&&null==e&&a.opt(this.styleSubscription_,(function(e){return e.unsubscribe()})),this.parent_=e,null==r&&null!=e&&(this.styleSubscription_=a.opt(this.style_,(function(e){return e.subscribe(n,f.FormaStyleChangedMessage.TYPE)})))},subscribeToStyle:function(e){var t=this;null!=this.parent_?this.styleSubscription_=a.opt(e,(function(e){return e.subscribe(t,f.FormaStyleChangedMessage.TYPE)})):this.styleSubscription_=null},root:{get:function(){return null==this.parent_?a.as(this,y.GroupForma):this.parent_.root}},isDescendent:function(e){for(var t=this.parent;null!=t;){if(t==e)return!0;t=a.opt(t,(function(e){return e.parent}))}return!1},visit:function(e,t){switch(e){case 4:return r.ancestorsNearest(this,0,t);case 5:return r.ancestorsFurthest(this,0,t);case 6:return null;default:if(t(this,0,0))return this}return null},visitPlaced:function(e,t){var n=[];return this.visit(o.FormaTraversal.PreOrder,(function(r,o,i){return 0==o?n=[e]:(n=n.slice(0,o)).push(r.placement.concat(a.last(n))),t(r,a.last(n),o,i)}))},visitAll:function(e,t){this.visit(e,(function(e,n,r){return t(e),!1}))},visitAsArray:function(e){var t=[];return this.visitAll(e,(function(e){t.push(e)})),t},visitChildren:function(e){return this.visit(o.FormaTraversal.JustChildren,(function(t,n,r){return e(t,r)}))},filterByKind:function(e,t){void 0===t&&(t=o.FormaTraversal.PreOrder);var n=[];return this.visitAll(t,(function(t){t.kind==e&&n.push(t)})),n},filterByControllerKind:function(e,t){void 0===t&&(t=o.FormaTraversal.PreOrder);var n=[];return this.visitAll(t,(function(t){a.opt(t.controller,(function(t){return t.kind==e}))&&n.push(t)})),n},filterWithCallback:function(e,t){void 0===t&&(t=o.FormaTraversal.PreOrder);var n=[];return this.visitAll(t,(function(t){e(t)&&n.push(t)})),n},successor:function(){return null==this.parent_?null:null!=(e=this.parent_.indexOfChild(this))?this.parent_.childAt(e+1):null;var e},predecessor:function(){return null==this.parent_?null:null!=(e=this.parent_.indexOfChild(this))?this.parent_.childAt(e-1):null;var e},formaByID:function(e){return this.visit(o.FormaTraversal.PreOrder,(function(t,n,r){return t.formaID==e}))},formaByContentID:function(e){return this.visit(o.FormaTraversal.PreOrder,(function(t,n,r){var o;return!(!(o=a.as(t,E.VideoForma))||o.videoContentID!=e)||t.contentID==e}))},allowUserMove:{get:function(){return a.as(this.get(r.PROPERTY_MOVEABLE),"Bool")},set:function(e){this.set(r.PROPERTY_MOVEABLE,e)}},page:{get:function(){return this.page_},set:function(e){this.page_=e}},bounds:{get:function(){return this.boundsInCoordSpace(P.Matrix2D.Identity)},set:function(e){v.LegacyCoreAssert.fail("Forma does not support setting it's bounds",void 0,"Forma","Forma.swift",577)}},boundsInCoordSpace:function(e){return null},frame:{get:function(){return this.boundsInCoordSpace(this.placement)}},finalFrame:{get:function(){return this.boundsInCoordSpace(this.totalPlacement)}},placement:{get:function(){var e;return(e=a.as(this.get(r.PROPERTY_PLACEMENT),P.Matrix2D))||null!=e?e:P.Matrix2D.Identity},set:function(e){if(!this.placement.equal(e)){v.LegacyCoreAssert.isTrue(e.finite&&0!=e.determinant,"Placement is not finite",void 0,"Forma","Forma.swift",599);var t=new m.FormaTransformChangedEvent(this);this.beginUpdate(t),this.set(r.PROPERTY_PLACEMENT,e),this.endUpdate(t)}}},totalPlacement:{get:function(){var e=P.Matrix2D.Identity;return this.visitAll(o.FormaTraversal.FurthestAncestor,(function(t){e=t.placement.concat(e)})),e}},placementFromAncestor:function(e){for(var t=P.Matrix2D.Identity,n=a.iter(this.visitAsArray(o.FormaTraversal.NearestAncestor));!n.done;n.next()){var r=n.value;if(a.eq(o._equality_Forma_Forma,r,e))break;t=t.precat(r.placement)}return t},move:function(e){this.placement=this.placement.concat(e)},moveOriginToPoint:function(e){var t;(t=this.frame)?this.move(P.Matrix2D.translation(t.evalXY(0,0).multiply(-1)).translate(e)):a.opt(C.Host.logging,(function(e){return e.warning("moveOriginToPoint not possible because could not obtain frame")}))},moveCenterToPoint:function(e){var t;(t=this.frame)?this.move(P.Matrix2D.translation(t.evalXY(.5,.5).multiply(-1)).translate(e)):a.opt(C.Host.logging,(function(e){return e.warning("moveCenterToPoint not possible because could not obtain frame")}))},movePinToPoint:function(e,t){var n;(n=this.frame)?this.move(P.Matrix2D.translation(n.eval(e).multiply(-1)).translate(t)):a.opt(C.Host.logging,(function(e){return e.warning("moveCenterToPoint not possible because could not obtain frame")}))},rotation:function(){return 180*this.rotationInRadians()/Math.PI},rotationInRadians:function(){var e=this.placement.transformValues;return Math.atan2(e.rotSine,e.rotCosine)},containsPoint:function(e,t){if(void 0===t&&(t=0),null!=this.controller_)return this.controller.containsPoint(e,t);var n=this.bounds;return null!=n&&(0!=t&&(n=n.outsetXY(t,t)),n.containsPoint(e))},style_:{get:function(){return null==this.cachedStyle_&&(this.cachedStyle_=a.as(this.get(r.PROPERTY_STYLE),f.FormaStyle)),this.cachedStyle_},set:function(e){null!=e&&this.internalSetStyle(e,!0,!0)}},style:{get:function(){return this.style_}},canApplyStyle:function(e){return null!=e},internalSetStyle:function(e,t,n){var o;if(void 0===t&&(t=!1),void 0===n&&(n=!0),o=e){var i=new m.FormaStyleChangedEvent(this);this.beginUpdate(i),a.opt(a.as(this.get(r.PROPERTY_STYLE),f.FormaStyle),(function(e){return e.dispose()})),this.cachedStyle_=null,a.opt(this.styleSubscription_,(function(e){return e.unsubscribe()})),this.set(r.PROPERTY_STYLE,o),this.cachedStyle_=o,this.cachedStyle_.colorLibrary=this.page_.colorLibrary,t&&(v.LegacyCoreAssert.isTrue(null==this.cachedStyle_.owner,"Setting a forma style that is already owned.",void 0,"Forma.internalSetStyle","Forma.swift",743),this.cachedStyle_.owner=this),this.subscribeToStyle(this.cachedStyle_),n&&a.opt(this.controller,(function(e){return e.styleChanged()})),this.endUpdate(i)}},applyStyle:function(e){null!=e&&e!==this.style_&&(this.style_=e.clone()),a.opt(this.controller,(function(e){return e.styleChanged()}))},protectedSetStyle:function(e){this.style_=e},onMessage:function(e){var t;(t=a.as(e,f.FormaStyleChangedMessage))&&(t.isBefore?(v.LegacyCoreAssert.isTrue(null==this.styleUpdateEvent_,"nested FormaStyleChangedMessage not allowed right now",void 0,"Forma.onMessage","Forma.swift",794),this.styleUpdateEvent_=new m.FormaStyleChangedEvent(this),this.beginUpdate(this.styleUpdateEvent_)):(a.opt(this.controller,(function(e){return e.styleChanged()})),this.endUpdate(this.styleUpdateEvent_),this.styleUpdateEvent_=null),t.isAfter&&a.opt(this.controller,(function(e){return e.styleChanged()})))},matchColors:function(e){var t,n;null!=(t=e.style.colors.colorID(s.ColorRole.FieldPrimary))&&this.style.colors.setColorId(s.ColorRole.FieldPrimary,t),null!=(n=e.style.colors.colorID(s.ColorRole.FieldSecondary))&&this.style.colors.setColorId(s.ColorRole.FieldSecondary,n)},match:function(e){var t;this.placement=e.placement,this.style.kind==e.style.kind?this.style.kind==_.GridStyle.KIND?this.style.match(e.style):(t=e.style.cloneToDatabase(this.database))?this.protectedSetStyle(t):v.LegacyCoreAssert.fail("Forma.match: could not clone style",void 0,"Forma.match","Forma.swift",838):this.matchColors(e),this.allowUserMove=e.allowUserMove,null!=this.controller&&null!=e.controller&&this.controller.match(e.controller)},siblingForma:function(){var e,t=[];if(e=this.parent)for(var n=a.clone(e.visitAsArray(o.FormaTraversal.JustChildren)),r=a.iter(n);!r.done;r.next()){var i=r.value;a.eq(o._equality_Forma_Forma,i,this)||t.push(i)}return t},postMatch:function(e){null!=this.controller&&null!=e.controller&&this.controller.postMatch(e.controller)},getGraph:function(e){var t;return(t=this.page_)?t.pgm.getGraphForForma(this,e):(v.LegacyCoreAssert.fail("Forma.getGraph: unexpectedly couldn't get a graph representation",void 0,"Forma.getGraph","Forma.swift",879),null)},isText:function(){return!1},isImage:function(){return!1},isShape:function(){return!1},isLine:function(){return!1},isVideo:function(){return!1},isSticker:function(){return!1},isGraphic:function(){return this.isImage()||this.isShape()},isTypeLockup:function(){return null!=this.controller&&a.opt(this.controller,(function(e){return e.kind==D.TypeLockupController.KIND}))},isLogo:function(){return this.hasIntent(r.INTENT_LOGO)},isGridCell:function(){var e;return!!(e=a.as(a.opt(this.parent,(function(e){return e.controller})),g.GridController))&&e.isGridCell(this)},isBackgroundImage:function(){var e;return!!(e=a.as(this.controller,h.FrameController))&&!e.floating&&!e.userGroupMember},hasIntent:function(e){var t;return null!=(t=this.intent)&&t==e},intent:{get:function(){return a.as(this.get(r.PROPERTY_INTENT),"String")},set:function(e){this.set(r.PROPERTY_INTENT,e)}},isModel:{get:function(){return this.isModel_},set:function(e){this.isModel_=e}},tags_:{get:function(){var e,t={};if(e=a.opt(this.getProperty(r.PROPERTY_TAGS),(function(e){return e.dictionaryValue})))for(var n=a.iter(e);!n.done;n.next()){var o,i=n.key;null!=(o=n.value.stringValue)&&(t[i]=o)}return t},set:function(e){for(var t={},n=a.iter(e);!n.done;n.next()){var r=n.key,o=n.value;t[r]=l.DBProperty.stringProperty(l.DBNamePath.init_b14a(i.ContentNode.PROPERTY_TAGS).append(r),o)}this.setProperty(i.ContentNode.PROPERTY_TAGS,l.DBProperty.dictProperty(l.DBNamePath.init_b14a(i.ContentNode.PROPERTY_TAGS),t))}},tags:{get:function(){for(var e=[],t=a.iter(this.tags_);!t.done;t.next()){var n=t.key;e.push(n)}return e}},hasTag:function(e){return null!=this.tags_[e]},clearTags:function(){this.tags_={}},getTag:function(e){return this.tags_[e]},setTag:function(e,t){void 0===t&&(t="");var n=a.clone(this.tags_);n[e]=t,this.tags_=a.clone(n)},removeTag:function(e){a.removeKey(this.tags_,e)},asString:{get:function(){var e,t,n,r,o=(e=a.opt(this.contentID,(function(e){return e.substr(0,8)})))||null!=e?e:"nil",i=this.formaID.substr(0,8),s=(t=a.opt(this.controller,(function(e){return e.kind})))||null!=t?t:"";s==D.TypeLockupController.KIND&&"nil"==o&&this.contentID;var l=(n=a.opt(this.style.colors.library,(function(e){return e.asString})))||null!=n?n:"<none>",u=(r=a.opt(this.finalFrame,(function(e){return e.asString})))||null!=r?r:"(nil finalFrame)";return this.kind==A.RootForma.KIND?this.kind+": "+s+" "+i+" colorLibrary:("+l+") "+o+" "+this.style.opacity+" "+(null!=this.animation?"A":"NA")+" "+u:this.kind+": "+s+" "+i+" "+o+" "+this.style.opacity+" "+(null!=this.animation?"A":"NA")+" "+u}},print:function(){var e="";return this.visit(o.FormaTraversal.PreOrder,(function(t,n,r){for(var o="",i=a.iter(a.range(0,n,!0));!i.done;i.next())o+="    ";return null!=t.controller&&(e+=o+t.asString+"\n"),!1})),e},beginUpdate:function(e){this.isModel||a.opt(this.page_,(function(t){return t.beginUpdate(e)}))},endUpdate:function(e){this.isModel||a.opt(this.page_,(function(t){return t.endUpdate(e)}))},forkToDatabase:function(e,t,n,r){var o,a=S.PostDCXObject.prototype.forkToDatabase.call(this,e,t,n,r);return(o=a)&&(o.setProperty(S.PostDCXObject.PROPERTY_PATH,l.DBProperty.stringProperty(l.DBNamePath.init_b14a(S.PostDCXObject.PROPERTY_PATH),T.GUIDUtils.makeGUID())),null!=o.getProperty(u.DBSchema.PROPERTY_ID)&&o.setProperty(u.DBSchema.PROPERTY_ID,l.DBProperty.stringProperty(l.DBNamePath.init_b14a(u.DBSchema.PROPERTY_ID),e))),a}}}),r),o._equality_Forma_Forma=function(e,t){return e.isEqual(t)}},G1DZ:function(e,t,n){var r,o,a=t,i=n("oAGj");a.FormaSourceNamespace=i.defineEnum("FormaSourceNamespace",{DesignIngredient:"di:",DesignVariation:"dv:"}),a.FormaSourceUtils=(r=function(){},o={},i.defineClass({name:"FormaSourceUtils",ctor:r,statics:{allNamespaces:{get:function(){return void 0===o.allNamespaces&&(o.allNamespaces=[a.FormaSourceNamespace.DesignIngredient,a.FormaSourceNamespace.DesignVariation]),o.allNamespaces}},isValid:function(e){if(null==e)return!0;for(var t=i.iter(r.allNamespaces);!t.done;t.next()){var n=t.value;if(r.checkMatch(e,n))return!0}return!1},isDesignIngredient:function(e){return r.checkMatch(e,a.FormaSourceNamespace.DesignIngredient)},isDesignVariation:function(e){return r.checkMatch(e,a.FormaSourceNamespace.DesignVariation)},stripNamespace:function(e){for(var t=i.iter(r.allNamespaces);!t.done;t.next()){var n=t.value;if(e.startsWith(n))return e.substr(i.toString(n).length)}return e},checkMatch:function(e,t){var n;return!(!(n=i.opt(e,(function(e){return e.startsWith(t)})))&&null==n)&&n}}}),r)},HRWw:function(e,t,n){var r,o=t,a=n("oAGj"),i=n("dJuF"),s=n("ZhwN"),l=n("Quhx");o.ContentNode=(r=function(){},a.defineClass({name:"ContentNode",ctor:r,superName:"PostDCXObject",statics:{KIND:{get:function(){return""}},SCHEMA_CLASS_NAME:{get:function(){return"GroupContentNode"}},CONTENT_NODE_CHILD_TYPES_NAME:"NonRootContentNodeTypes",PROPERTY_KIND:"kind",PROPERTY_TAGS:"tags",_implements:function(e){return"IDBObject"==e||"TheoMessagePublisher"==e}},props:{init_3144:function(e,t,n,r){var o=n.getProperty(l.PostDCXObject.PROPERTY_PATH).stringValue;this.parent_=r,this.doc_=r.document,a.super_init(this,l.PostDCXObject,l.PostDCXObject.prototype.init_3181,t,n,o)},init_5e75:function(e,t,n,r){var o=n.getProperty(l.PostDCXObject.PROPERTY_PATH).stringValue;this.doc_=r,a.super_init(this,l.PostDCXObject,l.PostDCXObject.prototype.init_3181,t,n,o)},init_8b5c:function(e,t,n){var o;void 0===n&&(n=null);var u=(o=n)||null!=o?o:s.GUIDUtils.makeGUID();this.doc_=e,a.super_init(this,l.PostDCXObject,l.PostDCXObject.prototype.init_5079,e.database,{path:i.DBProperty.stringProperty(i.DBNamePath.init_b14a(l.PostDCXObject.PROPERTY_PATH),u),kind:i.DBProperty.stringProperty(i.DBNamePath.init_b14a(r.PROPERTY_KIND),t)},{},u)},init_c3fa:function(e,t,n){var o;void 0===n&&(n=null);var u=(o=n)||null!=o?o:s.GUIDUtils.makeGUID();this.parent_=e,this.doc_=e.document,a.super_init(this,l.PostDCXObject,l.PostDCXObject.prototype.init_5079,e.database,{path:i.DBProperty.stringProperty(i.DBNamePath.init_b14a(l.PostDCXObject.PROPERTY_PATH),u),kind:i.DBProperty.stringProperty(i.DBNamePath.init_b14a(r.PROPERTY_KIND),t)},{},u)},className:{get:function(){return r.SCHEMA_CLASS_NAME}},document:{get:function(){return this.doc_}},parent:{get:function(){return this.parent_},set:function(e){this.parent_=e}},kind:{get:function(){return this.get(r.PROPERTY_KIND)}},contentID:{get:function(){return this.path}},tags_:{get:function(){var e,t={};if(e=a.opt(this.getProperty(r.PROPERTY_TAGS),(function(e){return e.dictionaryValue})))for(var n=a.iter(e);!n.done;n.next()){var o,i=n.key;null!=(o=n.value.stringValue)&&(t[i]=o)}return t},set:function(e){for(var t={},n=a.iter(e);!n.done;n.next()){var o=n.key,s=n.value;t[o]=i.DBProperty.stringProperty(i.DBNamePath.init_b14a(r.PROPERTY_TAGS).append(o),s)}this.setProperty(r.PROPERTY_TAGS,i.DBProperty.dictProperty(i.DBNamePath.init_b14a(r.PROPERTY_TAGS),t))}},tags:{get:function(){for(var e=[],t=a.iter(this.tags_);!t.done;t.next()){var n=t.key;e.push(n)}return e}},nodeByID:function(e){return e==this.contentID?this:null},nodeWithTag:function(e,t){return this.tags_[e]==t?this:null},clearTags:function(){this.tags_={}},getTag:function(e){return this.tags_[e]},setTag:function(e,t){var n=a.clone(this.tags_);n[e]=t,this.tags_=a.clone(n)},removeTag:function(e){var t=a.clone(this.tags_);a.removeKey(t,e),this.tags_=a.clone(t)},removeFromParent:function(){null!=this.parent_&&this.parent.removeChild(this)},match:function(e,t){void 0===t&&(t=null);var n,r=a.clone(e.state.allProperties);if(r[l.PostDCXObject.PROPERTY_PATH]=this.getProperty(l.PostDCXObject.PROPERTY_PATH),n=t)for(var o=a.iter(n);!o.done;o.next()){var i=o.value;a.removeKey(r,i)}this.matchProperties(r)},visit:function(e){return e(this)?this:null},visitAll:function(e){this.visit((function(t){return e(t),!1}))},releaseResources:function(){},publish:function(e){l.PostDCXObject.prototype.publish.call(this,e),a.opt(this.doc_,(function(t){return t.publishForChild(e)}))},postDecode:function(){}}}),r)},JEzR:function(e,t,n){var r,o,a=t,i=n("oAGj"),s=n("ascj"),l=n("QbzR"),u=n("U010");a.FrameStyle=(r=function(){},o={},i.defineClass({name:"FrameStyle",ctor:r,superName:"FormaStyle",statics:{SCHEMA_CLASS_NAME:{get:function(){return"FrameStyle"}},KIND:{get:function(){return"FrameStyle"}},PROPERTY_CUTOUT_MODE:"cutout-mode",initialProps:{get:function(){return void 0===o.initialProps&&(o.initialProps={"cutout-mode":u.CutoutMode.Off}),o.initialProps}},factory:{get:function(){return function(e,t,n,o){return r.init_866e(n,e)}}},createDefault:function(){return r.init_d41d()},_implements:function(e){return"IDBObject"==e||"TheoMessagePublisher"==e||"ColorTableOwner"==e}},props:{init_866e:function(e,t){i.super_init(this,l.FormaStyle,l.FormaStyle.prototype.init_866e,e,t)},init_dd5d:function(e,t){for(var n=i.clone(t),o=i.iter(r.initialProps);!o.done;o.next()){var a=o.key,s=o.value;null==e[a]&&null==t[a]&&(n[a]=s)}i.super_init(this,l.FormaStyle,l.FormaStyle.prototype.init_dd5d,e,n)},init_d41d:function(){var e=s.ColorTable.init_25f6([{key:s.ColorRole.FieldPrimary,value:null}]);i.super_init(this,l.FormaStyle,l.FormaStyle.prototype.init_5afe,r.KIND,1,e,void 0,void 0,r.initialProps)},init_6c45:function(e,t){i.super_init(this,l.FormaStyle,l.FormaStyle.prototype.init_5afe,r.KIND,e,t,void 0,void 0,r.initialProps)},cutoutMode:{get:function(){var e,t;return null!=(e=i.as(this.get(r.PROPERTY_CUTOUT_MODE),"Int"))&&null!=(t=u.CutoutMode.toCaseValue(e))?t:u.CutoutMode.Off},set:function(e){this.notifyBefore(),this.set(r.PROPERTY_CUTOUT_MODE,e),this.notifyAfter()}},willCommitState:function(){l.FormaStyle.prototype.willCommitState.call(this)},className:{get:function(){return r.SCHEMA_CLASS_NAME}}}}),r)},K0Rh:function(e,t,n){var r,o=t,a=n("oAGj"),i=n("FNB+"),s=n("fWxZ"),l=n("QbzR"),u=n("P83h"),c=n("pnSN"),d=n("lmwz"),h=n("fNpk"),p=n("uxH+"),f=n("2ALn"),m=n("Zifs"),g=n("sIWg");o.RootForma=(r=function(){},a.defineClass({name:"RootForma",ctor:r,superName:"GroupForma",statics:{KIND:{get:function(){return"Root"}},PROPERTY_FILLCOLOR_DEPRECATED:"fill-color",PROPERTY_ROOT_STYLE_DEPRECATED:"root-style",SCHEMA_CLASS_NAME:{get:function(){return"RootForma"}},factory:{get:function(){return function(e,t,n,o){if(null!=t){var i=a.as(a.opt(a.opt(o,(function(e){return e.backLink})),(function(e){return e.dereference()})),s.FormaPage);return h.LegacyCoreAssert.isTrue(null!=i,"RootForma needs a parent page",void 0,"RootForma","RootForma.swift",25),r.init_7dbd(e,t,n,i)}return r.init_d1c9(e,n)}}},_implements:function(e){return"IDBObject"==e||"TheoMessageSubscriber"==e||"TheoMessagePublisher"==e}},props:{init_7dbd:function(e,t,n,r){a.super_init(this,c.GroupForma,c.GroupForma.prototype.init_7dbd,e,t,n,r)},init_812f:function(e,t){for(var n={kind:function(){return r.KIND},style:function(){return f.RootStyle.createDefault()}},o=a.clone(t),i=a.iter(n);!i.done;i.next()){var s=i.key,l=i.value;null==t[s]&&(o[s]=l())}a.super_init(this,c.GroupForma,c.GroupForma.prototype.init_812f,e,o)},init_7186:function(e){var t={kind:r.KIND,style:f.RootStyle.createDefault()};this.init_812f(e,t)},init_d1c9:function(e,t){a.super_init(this,c.GroupForma,c.GroupForma.prototype.init_d1c9,e,t)},initializeDefaultState:function(){null!=this.rootStyleDeprecated_&&this.protectedSetStyle(this.rootStyleDeprecated_),null!=this.fillColorDeprecated_&&(this.style.colors.fieldPrimary=this.fillColorDeprecated_),c.GroupForma.prototype.initializeDefaultState.call(this)},initializeToDefaults:function(){var e;(e=a.opt(this.page.document,(function(e){return e.controller})))&&(this.controller=e.controllerFactory.createController(p.RootController.KIND,this)),this.bounds=g.TheoRect.fromSize(this.page.pageSize),c.GroupForma.prototype.initializeToDefaults.call(this)},page:{get:function(){return this.page_},set:function(e){var t=this,n=this.page_;this.page_=e,null==n&&(this.styleSubscription_=a.opt(this.style_,(function(e){return e.subscribe(t,l.FormaStyleChangedMessage.TYPE)})))}},subscribeToStyle:function(e){var t=this;null!=this.page_?this.styleSubscription_=a.opt(e,(function(e){return e.subscribe(t,l.FormaStyleChangedMessage.TYPE)})):this.styleSubscription_=null},postDecode:function(){var e,t=this;c.GroupForma.prototype.postDecode.call(this),a.opt(this.controller,(function(e){return e.kind!=p.RootController.KIND}))&&(this.controller=a.opt(a.opt(this.page.document,(function(e){return e.controller})),(function(e){return e.controllerFactory.createController(p.RootController.KIND,t)}))),(e=a.as(this.controller,p.RootController))&&e.createGridControllerIfNone(),null==this.animation&&this.visit(i.FormaTraversal.PreOrder,(function(e,n,o){return!(e instanceof r||!a.opt(e.animation,(function(e){return null!=e.animationStyle}))||(t.page.animationLibrary.setStillAnimation(t,e.animation.animationStyle),0))})),d.ImageFacade.exitCropMode(this)},className:{get:function(){return r.SCHEMA_CLASS_NAME}},bounds:{get:function(){return null!=this.setBounds?this.setBounds:g.TheoRect.fromSize(this.page.pageSize)},set:function(e){h.LegacyCoreAssert.isTrue(null!=e,"Can't set a nil root bounds",void 0,"RootForma","RootForma.swift",137),h.LegacyCoreAssert.isTrue(g.TheoRect.fromSize(this.page.pageSize).equal(e),"Root bounds doesn't match the FormaPage pageSize.",void 0,"RootForma","RootForma.swift",138),c.GroupForma._setters.bounds.call(this,e)}},placement:{get:function(){return c.GroupForma._getters.placement.call(this)},set:function(e){h.LegacyCoreAssert.isTrue(e.isIdentity,"RootForma: Someone's trying to set the root forma placement to something other than identity!",void 0,"RootForma","RootForma.swift",146),c.GroupForma._setters.placement.call(this,e)}},contentID:{get:function(){return"root"}},isImage:function(){return!1},isGraphic:function(){return!1},isText:function(){return!1},isShape:function(){return!1},isLogo:function(){return!1},hackGenerateArtificialUpdateEvent:function(){var e=new u.FormaInsertedChildrenEvent(this,[],0);this.beginUpdate(e),this.endUpdate(e)},boundsInCoordSpace:function(e){return this.bounds.transform(e)},visible:{get:function(){var e;if(e=this.finalFrame){var t=!1,n=g.TheoRect.Zero;return this.visitAll(i.FormaTraversal.PreOrder,(function(e){var o;e instanceof r||((o=e.finalFrame)&&(n=n.unionWith(o)),e.isImage()&&(t=!0))})),!t||!n.contains(e)}return!1}},rootStyleDeprecated_:{get:function(){return a.as(this.get(r.PROPERTY_ROOT_STYLE_DEPRECATED),l.FormaStyle)}},fillColorDeprecated_:{get:function(){return a.as(this.get(r.PROPERTY_FILLCOLOR_DEPRECATED),m.SolidColor)}}}}),r)},K17h:function(e,t,n){var r,o,a=t,i=n("oAGj"),s=n("VQVe"),l=n("gXiO"),u=n("FNB+"),c=n("cmoc"),d=n("ZK0l"),h=n("iCxV"),p=n("c+uM"),f=n("7Ta2"),m=n("enh0"),g=n("Vm85"),y=n("8t9B"),_=n("sIWg"),T=n("RkYL"),C=n("zjod");a.TextLine=(r=function(){this.words=[],this.shadows=[],this.bounds=_.TheoRect.Zero,this.isKnockout=!1},i.defineClass({name:"TextLine",ctor:r}),r),a.MotionUtils=(o=function(){l.CoreObject.call(this)},i.defineClass({name:"MotionUtils",ctor:o,superName:"CoreObject",statics:{SAME_LINE_THRESHOLD:20,sortTextLines:function(e){var t=i.clone(e);return i.sortInPlace(t,(function(e,t){return e.bounds.minY<t.bounds.minY})),t},findTextLines2:function(e){var t=g.TextFacade.getTextLook(e),n=[];if(p.LockupStyle.isKnockoutLook(t)&&!h.Host.textModelUtils.usePGMRenderer()){var r=e.boundsInCoordSpace(e.totalPlacement),s=new a.TextLine;s.words.push(e),s.isKnockout=!0,s.bounds=r||_.TheoRect.Zero,n.push(s)}else{var l={};e.visitAll(u.FormaTraversal.PreOrder,(function(e){var t;if(t=i.as(e,m.TextForma)){for(var n=!1,r=Math.floor(t.baselineBoundsInCoordSpace(t.placement).maxY),s=i.iter(l,!0);!s.done;s.next()){var u=s.key;if(Math.abs(u-r)<o.SAME_LINE_THRESHOLD){n=!0,r=u;break}}var c=t.boundsInCoordSpace(t.totalPlacement);if(n)l[r].bounds=l[r].bounds.unionWith(c),l[r].words.push(t);else{var d=new a.TextLine;d.words.push(t),d.bounds=c||_.TheoRect.Zero,l[r]=d}}}));for(var c=i.sort(i.keys(l,"numeric")),d=i.iter(c);!d.done;d.next()){var f=d.value;n.push(l[f])}}return n},findTextLines:function(e){var t=g.TextFacade.getTextLook(e),n=[];if(p.LockupStyle.isKnockoutLook(t)&&t!=p.LockupTextLook.KnockoutOnly&&!h.Host.textModelUtils.usePGMRenderer()){var r=[];r.push(e),n.push(r)}else{var o={};e.visitAll(u.FormaTraversal.PreOrder,(function(e){var t;(t=i.as(e,m.TextForma))&&(null==o[t.rowIndex]?o[t.rowIndex]=[i.as(e,u.Forma)]:o[t.rowIndex].push(e))}));for(var a=i.sort(i.keys(o,"numeric")),s=i.iter(a);!s.done;s.next()){var l=s.value;n.push(o[l])}}return n},getTitleLockups:function(e){if(0==e.length)return[];for(var t=i.clone(e),n={},r=i.iter(t);!r.done;r.next()){var o=r.value,a=(new f.RoleSuggester).getRole(o).role;n[o.formaID]=a}i.sortInPlace(t,(function(e,t){return e.controller.currentHeightScale>t.controller.currentHeightScale}));var s,l=t.shift(),u=[l],c=[];if(s=i.as(l.controller,y.TypeLockupController))for(var d=i.iter(t);!d.done;d.next()){var h;if(o=d.value,h=i.as(o.controller,y.TypeLockupController)){var p=h.getCurrentFontSize(),m=s.getCurrentFontSize();Math.abs(p-m)/Math.min(p,m)<.05?u.push(o):c.push(o)}}return[u,c]},getGifDur:function(e){var t,n,r=0;return e.isSticker()&&(n=i.as(e,C.VideoForma))&&(r=(t=i.opt(n.videoContentNode,(function(e){return e.duration.seconds})))||null!=t?t:0),r},determineLoopDur:function(e,t){var n=o.getGifDur(e);if(n>0){var r=t/n;n*=Math.ceil(r)}return n},createOpacityStyle:function(e,t){var n;if(!(e instanceof C.VideoForma||e instanceof c.FrameForma)&&(n=e.controller)){var r=i.as(n,d.GroupController);i.opt(r,(function(e){return e.beginBlockedUpdate()}));var o=e.style.clone();n.applyOpacity(t);var a,s=e.style.clone();return(a=i.as(s,p.LockupStyle))&&(a.textOpacity=t,a.backingOpacity=t),e.applyStyle(o),i.opt(r,(function(e){return e.endBlockedUpdate()})),s}var l=e.style.clone();return l.opacity=t,l},getCurrentAnimationStyle:function(e){return i.opt(e.root.animation,(function(e){return e.animationStyle}))},invalidateAnimation:function(e){i.opt(e.root.animation,(function(e){return e.invalidate()}))},isCurrentAnimationValid:function(e){var t;return!!(t=i.opt(e,(function(e){return e.root.animation})))&&t.valid&&!t.animationStyle.modifiesFormaTree},determineTotalDuration:function(e){return i.opt(e.root.animation,(function(e){return e.animationStyle.endTime}))||T.TheoTime.Zero},getFrameTimes:function(e){var t,n=[],r=0,o=1,a=s.AnimationStyle.DEFAULT_TIMESCALE;(t=e.animationController.animationStyle)?(r=t.endTime.value,a=t.endTime.timescale,o=i.toInt(t.endTime.timescale/s.AnimationStyle.DEFAULT_TIMESCALE)):e.root.visitAll(u.FormaTraversal.PreOrder,(function(e){var t,n;(t=i.as(e,C.VideoForma))&&null!=(n=i.opt(t.videoContentNode,(function(e){return e.duration.value})))&&n>r&&(r=n)}));for(var l=i.iter(i.stride(0,r,o));!l.done;l.next()){var c=l.value;n.push(new T.TheoTime(c,a))}return n}}}),o)},K9Oa:function(e,t,n){var r,o=t,a=n("oAGj"),i=n("gXiO"),s=n("ylxa"),l=n("iCxV"),u=n("3DEm"),c=n("sIWg");o.PageFacade=(r=function(){i.CoreObject.call(this)},a.defineClass({name:"PageFacade",ctor:r,superName:"CoreObject",statics:{kMinPageDimension:50,kMaxPageDimension:6e3,getMinPageDimensionForUnits:function(e,t){var n=r.getNumDecimalPlacesForUnits(e),o=r.unitsToPixelsFactor(e,t),i=r.kMinPageDimension/o;if(0!=n){var s=1/Math.pow(10,a.toDouble(n)),l=.5/Math.pow(10,a.toDouble(n));i=u.MathUtils.nearestMultiple(i+l,s)}return i},getMaxPageDimensionForUnits:function(e,t){var n=r.getNumDecimalPlacesForUnits(e),o=r.unitsToPixelsFactor(e,t),i=r.kMaxPageDimension/o;if(0!=n){var s=1/Math.pow(10,a.toDouble(n)),l=.5/Math.pow(10,a.toDouble(n));i=u.MathUtils.nearestMultiple(i-l,s)}return i},pageDimensionIsInRange:function(e,t,n){return!r.pageDimensionIsTooSmall(e,t,n)&&!r.pageDimensionIsTooLarge(e,t,n)},pageDimensionIsTooSmall:function(e,t,n){var o=r.convertStringToPixelsValue(e,t,n),a=r.getMinPageDimensionForUnits(t,n);return o<r.unitsToPixelsFactor(t,n)*a},pageDimensionIsTooLarge:function(e,t,n){var o=r.convertStringToPixelsValue(e,t,n),a=r.getMaxPageDimensionForUnits(t,n);return o>r.unitsToPixelsFactor(t,n)*a},setPageDesignSize:function(e,t){e.setPageSizeFromDesignSize(t)},getNumDecimalPlacesForUnits:function(e){var t=0;return e==s.PageExportFormat.INCHES?t=2:e==s.PageExportFormat.MILLIMETERS&&(t=1),t},unitsToPixelsFactor:function(e,t){return e==s.PageExportFormat.MILLIMETERS?s.FormaPageExportData.MM_TO_INCHES*t:e==s.PageExportFormat.INCHES?t:1},convertStringToPixelsValue:function(e,t,n){var o;return((o=a.opt(l.Host.locale,(function(t){return t.convertStringToNumber(e)})))||null!=o?o:a.toDouble(e))*r.unitsToPixelsFactor(t,n)},convertPixelsToUnitsString:function(e,t,n){var o,i=e/r.unitsToPixelsFactor(t,n),s=r.getNumDecimalPlacesForUnits(t);if(null!=l.Host.locale)return o=l.Host.locale.formatNumber(i,s);if((o=a.toString("%."+s+"f",i)).includes("."))for(;o.endsWith("0");)o=o.substr(0,o.length-1);return o.endsWith(".")&&(o=o.substr(0,o.length-1)),o},aspectRatioIsVeryTallOrWide:function(e){var t=c.TheoRect.fromSize(e);return t.aspectRatio>=5||t.aspectRatio<=.2}}}),r)},KkVW:function(e,t,n){var r,o=t,a=n("oAGj"),i=n("4/a+");o.MotionEntryDropIn=(r=function(){this.srcId="MotionSrcDropIn",this.logic=new i.MotionLogicDur,this.args={st:0,dur:1.5}},a.defineClass({name:"MotionEntryDropIn",ctor:r,statics:{_implements:function(e){return"MotionEntry"==e}}}),r)},KsJe:function(e,t,n){var r,o=t,a=n("oAGj"),i=n("cZuM"),s=n("Z25M"),l=n("wc1n"),u=n("dNmX"),c=n("c+uM"),d=n("TkOd"),h=n("K0Rh"),p=n("7Ta2"),f=n("djAF"),m=n("8t9B");o.LockupStyleFeatureExtractor=(r=function(e,t){void 0===t&&(t=[]),this.root_=e.root,this.forma_=e,this.lockupController_=a.as(this.forma_.controller,m.TypeLockupController),this.forFeatures_=a.clone(t),this.featureEvals_=[],this.lockupAttributes=d.lockupStyleToLockupStyleAttributes(this.forma_.style,e.page.document),l.FeatureExtractor.call(this),null!=this.lockupController_&&(this.initFeatures(),this.evaluateFeatures())},a.defineClass({name:"LockupStyleFeatureExtractor",ctor:r,superName:"FeatureExtractor",statics:{_implements:function(e){return"FeatureExtractorProtocol"==e}},props:{initFeatures:function(){this.featureEvals_=[["Role",[this.evaluateRole,l.FeatureType.Categorical]],["BoundingBox",[this.evaluateBoundingBox,l.FeatureType.Complex]],["BackgroundColors",[this.evaluateBackgroundColors,l.FeatureType.Complex]],["ImageCount",[this.evaluateImageCount,l.FeatureType.Numerical]],["ShapeCount",[this.evaluateShapeCount,l.FeatureType.Numerical]],["TextCount",[this.evaluateTextCount,l.FeatureType.Numerical]],["TextHeight",[this.evaluateTextHeight,l.FeatureType.Numerical]],["TextWidth",[this.evaluateTextWidth,l.FeatureType.Numerical]],["PageHeight",[this.evaluatePageHeight,l.FeatureType.Numerical]],["PageWidth",[this.evaluatePageWidth,l.FeatureType.Numerical]],["AspectRatio",[this.evaluateAspectRatio,l.FeatureType.Numerical]],["BackgroundType",[this.evaluateBackgroundType,l.FeatureType.Categorical]],["AverageHue",[this.evaluateAverageHue,l.FeatureType.Numerical]],["AverageLightness",[this.evaluateLightness,l.FeatureType.Numerical]],["LightnessSpread",[this.evaluateLightnessSpread,l.FeatureType.Numerical]],["PercentageArea",[this.evaluatePercentageArea,l.FeatureType.Numerical]],["PercentageAreaAllLockups",[this.evaluateAllLockPercentageArea,l.FeatureType.Numerical]],["LockupSymmetryX",[this.evaluateXSymmetry,l.FeatureType.Numerical]],["LockupSymmetryY",[this.evaluateYSymmetry,l.FeatureType.Numerical]],["DistanceXFromCenter",[this.evaluateXDistanceFromCenter,l.FeatureType.Numerical]],["TextString",[this.evaluateTextString,l.FeatureType.Categorical]],["CenterX",[this.evaluateCenterX,l.FeatureType.Numerical]],["CenterY",[this.evaluateCenterY,l.FeatureType.Numerical]],["CharacterCount",[this.evaluateCharacterCount,l.FeatureType.Numerical]],["LineHeight",[this.evaluateLineHeight,l.FeatureType.Numerical]],["WordCount",[this.evaluateWordCount,l.FeatureType.Numerical]],["Font",[this.evaluateStyleFont,l.FeatureType.Categorical]],["BackingShape",[this.evaluateStyleBackingShape,l.FeatureType.Categorical]],["TextLook",[this.evaluateStyleTextLook,l.FeatureType.Categorical]],["Layout",[this.evaluateStyleLayout,l.FeatureType.Categorical]],["PrimaryColor",[this.evaluateStylePrimaryColor,l.FeatureType.Categorical]],["SecondaryColor",[this.evaluateStyleSecondaryColor,l.FeatureType.Categorical]],["ShapeFilled",[this.evaluateStyleShapeFilled,l.FeatureType.Numerical]],["TextOpacity",[this.evaluateStyleTextOpacity,l.FeatureType.Numerical]],["BackingOpacity",[this.evaluateStyleBackingOpacity,l.FeatureType.Numerical]],["Padding",[this.evaluateStylePadding,l.FeatureType.Numerical]],["ShadowAngle",[this.evaluateStyleShadowAngle,l.FeatureType.Numerical]],["ShadowOffsetY",[this.evaluateStyleShadowOffsetY,l.FeatureType.Numerical]],["Spacing",[this.evaluateStyleSpacing,l.FeatureType.Numerical]],["StrokeWeight",[this.evaluateStyleStokeWeight,l.FeatureType.Numerical]],["Tracking",[this.evaluateStyleTracking,l.FeatureType.Numerical]],["HasMSL",[this.evaluateHasMSL,l.FeatureType.Numerical]],["CollisionPercentage",[this.evaluatePercentageOverlappingWithOtherLockupsAndShapes,l.FeatureType.Numerical]],["SurroundingAlignment",[this.evaluateSurroundingAlignment,l.FeatureType.Complex]]]},evaluateFeatures:function(){for(var e=0==this.forFeatures_.length,t=a.iter(this.featureEvals_);!t.done;t.next()){var n=t.value;if(e||!e&&this.forFeatures_.includes(n[0])){var r=n[1],o=(0,r[0])(this);this.setFeature(n[0],o,r[1])}}},evaluateWordCount:function(e){return a.toDouble(e.lockupController_.wordCount())},evaluateLineHeight:function(e){var t=e.lockupController_.averageLineHeight;return null!=t?t:0},evaluateCharacterCount:function(e){return a.toDouble(e.lockupController_.text.length)},evaluateRole:function(e){return(new p.RoleSuggester).getRole(e.forma_).role},evaluateBoundingBox:function(e){return s.DesignFeatureUtils.getFormaBoundingBox(e.forma_)},evaluateBackgroundColors:function(e){return this.setColorsBehindLockup(e),e.colorsBehindLockup.map((function(e){return e.hex}),this)},evaluateImageCount:function(e){return s.DesignFeatureUtils.getImageCount(e.root_)},evaluateShapeCount:function(e){return s.DesignFeatureUtils.getShapeCount(e.root_)},evaluateTextCount:function(e){return s.DesignFeatureUtils.getTextCount(e.root_)},evaluateTextHeight:function(e){return s.DesignFeatureUtils.getFormaHeight(e.forma_)},evaluateTextWidth:function(e){return s.DesignFeatureUtils.getFormaWidth(e.forma_)},evaluateBackgroundType:function(e){for(var t="root",n=a.clone(e.root_.filterWithCallback((function(e){return(e.isBackgroundImage()||e.kind==f.ShapeForma.KIND||e.kind==h.RootForma.KIND)&&null!=e.controller&&!e.controller.moveable}))),r=a.iter(n);!r.done;r.next()){var o=r.value;o.isBackgroundImage()&&o.finalFrame.outsetXY(20,20).contains(e.forma_.finalFrame)?t="image":o.kind==f.ShapeForma.KIND&&(t="shape")}return t},evaluateAverageHue:function(e){var t=0,n=0,r=0,o=0;this.setColorsBehindLockup(e);for(var i=a.iter(e.colorsBehindLockup);!i.done;i.next()){var s=i.value.asLAB;t+=s.l*s.l,n+=s.a*s.a,r+=s.b*s.b,o+=s.alpha*s.alpha}var l=a.toDouble(e.colorsBehindLockup.length);return t=Math.sqrt(t/l),n=Math.sqrt(n/l),r=Math.sqrt(r/l),o=Math.sqrt(o/l),new u.LABColor(t,n,r,o).hue},evaluateAspectRatio:function(e){var t=s.DesignFeatureUtils.getFormaHeight(e.forma_),n=s.DesignFeatureUtils.getFormaWidth(e.forma_);return a.toDouble(n/t)},evaluateLightness:function(e){var t=0,n=0,r=0,o=0;this.setColorsBehindLockup(e);for(var i=a.iter(e.colorsBehindLockup);!i.done;i.next()){var s=i.value.asLAB;t+=s.l*s.l,n+=s.a*s.a,r+=s.b*s.b,o+=s.alpha*s.alpha}var l=a.toDouble(e.colorsBehindLockup.length);return t=Math.sqrt(t/l),n=Math.sqrt(n/l),r=Math.sqrt(r/l),o=Math.sqrt(o/l),new u.LABColor(t,n,r,o).asRGB.lightness},evaluateLightnessSpread:function(e){return this.setColorsBehindLockup(e),e.lockupController_.getBackgroundLightnessSpread(e.colorsBehindLockup)},evaluatePercentageArea:function(e){return s.DesignFeatureUtils.formaPercentageArea(e.forma_)},evaluateAllLockPercentageArea:function(e){for(var t=0,n=a.clone(e.forma_.page.root.filterWithCallback((function(e){return e.isTypeLockup()}))),r=a.iter(n);!r.done;r.next()){var o=r.value;t+=s.DesignFeatureUtils.formaPercentageArea(o)}return t},evaluateXSymmetry:function(e){return s.DesignFeatureUtils.getSymmAsymm([e.forma_.finalFrame],!0)},evaluateYSymmetry:function(e){return s.DesignFeatureUtils.getSymmAsymm([e.forma_.finalFrame],!1)},evaluateXDistanceFromCenter:function(e){var t,n,r=-1;return(t=e.forma_.finalFrame)&&(n=e.root_.finalFrame)&&(r=t.center.distanceTo(n.center)),r},evaluateTextString:function(e){return e.lockupController_.text},evaluateCenterX:function(e){return s.DesignFeatureUtils.getFormaCenterX(e.forma_)},evaluateCenterY:function(e){return s.DesignFeatureUtils.getFormaCenterY(e.forma_)},evaluatePageWidth:function(e){return s.DesignFeatureUtils.getPageWidth(e.root_)},evaluatePageHeight:function(e){return s.DesignFeatureUtils.getPageHeight(e.root_)},evaluateStyleShapeFilled:function(e){return e.forma_.style.textBacked?1:0},evaluateStyleTextOpacity:function(e){return e.lockupAttributes.textOpacity},evaluateStyleBackingOpacity:function(e){return e.lockupAttributes.backingOpacity},evaluateStylePadding:function(e){return e.lockupAttributes.padding},evaluateStyleShadowAngle:function(e){return e.lockupAttributes.shadowAngle},evaluateStyleShadowOffsetY:function(e){return e.lockupAttributes.shadowOffset},evaluateStyleSpacing:function(e){return e.lockupAttributes.spacing},evaluateStyleStokeWeight:function(e){return e.lockupAttributes.strokeWeight},evaluateStyleTracking:function(e){return e.lockupAttributes.tracking},evaluateHasMSL:function(e){var t=a.clone(e.forma_.style.characterStyles);return 0!=a.count(t)?1:0},evaluateStyleFont:function(e){return a.toString(e.lockupAttributes.font)},evaluateStyleBackingShape:function(e){return e.lockupAttributes.backing},evaluateStyleTextLook:function(e){return e.lockupAttributes.textLook},evaluateStyleLayout:function(e){return e.lockupAttributes.layout},evaluateStylePrimaryColor:function(e){return e.lockupAttributes.primaryColor},evaluateStyleSecondaryColor:function(e){return e.lockupAttributes.secondaryColor},setColorsBehindLockup:function(e){null==e.colorsBehindLockup&&(e.colorsBehindLockup=a.clone(e.lockupController_.getBackgroundColors()))},evaluatePercentageOverlappingWithOtherLockupsAndShapes:function(e){for(var t=a.clone(e.root_.filterWithCallback((function(e){return null!=e.controller&&e.isTypeLockup()||e.kind==f.ShapeForma.KIND&&!e.isGridCell()}))),n=1,r=null,o=[],i=a.iter(t);!i.done;i.next()){var l=i.value;l.kind==f.ShapeForma.KIND&&e.forma_.formaID==s.DesignFeatureUtils.getTypeLockupParentFormaIDofShape(l.parent)?l.finalFrame.area>n&&(n=(r=l.finalFrame).area):l.formaID!=e.forma_.formaID&&o.push(l.finalFrame)}null==r&&(n=(r=e.forma_.finalFrame).area);for(var u=0,c=a.iter(o);!c.done;c.next()){var d=c.value.intersectionWith(r);null!=d&&(u+=d.area)}return u/n},evaluateSurroundingAlignment:function(e){var t=c.LockupAlignment.UNSET,n=a.clone(e.root_.filterWithCallback((function(e){return null!=e.controller&&e.controller.floating&&e.isTypeLockup()}))).filter((function(e){return Math.acos(e.totalPlacement.transformValues.rotCosine)<1e-4}),this);if(n.length>1){var r=a.clone(e.forma_.controller.alignmentDetector.detectFormaAlignments(i.AlignmentDetector.DISTANCE_THRESHOLD)),o=a.clone(s.DesignFeatureUtils.getLockupsWithin(e.forma_,n,800)),l=a.clone(s.DesignFeatureUtils.getSetSimm(o,r)),u=a.clone(s.DesignFeatureUtils.getAlignmentConcensus(l));if(u[a.first(a.keys(u))]>.5){var d=a.first(a.keys(u));d==i.describeAlignmentType(i.AlignmentType.Left)?t=c.LockupAlignment.Left:d==i.describeAlignmentType(i.AlignmentType.Right)?t=c.LockupAlignment.Right:d==i.describeAlignmentType(i.AlignmentType.CenterX)&&(t=c.LockupAlignment.Center)}}return t}}}),r)},L19Y:function(e,t,n){var r,o=t,a=n("oAGj"),i=n("kYI4");o.TheoBrandkitUtils=(r=function(){i.BrandingFacade.call(this)},a.defineClass({name:"TheoBrandkitUtils",ctor:r,superName:"BrandingFacade",statics:{isDocumentBranded:function(e,t){return i.BrandingFacade.isDocumentBranded(e,t)}}}),r)},LCGV:function(e,t,n){var r,o=t,a=n("oAGj"),i=n("ascj"),s=n("QbzR"),l=n("Zifs");o.TextStyle=(r=function(){},a.defineClass({name:"TextStyle",ctor:r,superName:"FormaStyle",statics:{SCHEMA_CLASS_NAME:{get:function(){return"TextStyle"}},KIND:{get:function(){return"TextStyle"}},factory:{get:function(){return function(e,t,n,o){return r.init_866e(n,e)}}},createDefault:function(){return r.init_70dd(l.SolidColor.WHITE)},_implements:function(e){return"IDBObject"==e||"TheoMessagePublisher"==e||"ColorTableOwner"==e}},props:{init_866e:function(e,t){a.super_init(this,s.FormaStyle,s.FormaStyle.prototype.init_866e,e,t)},init_70dd:function(e){a.super_init(this,s.FormaStyle,s.FormaStyle.prototype.init_5afe,r.KIND,s.FormaStyle.OPACITY_DEFAULT,i.ColorTable.createWithOneSolidColor(e))},className:{get:function(){return r.SCHEMA_CLASS_NAME}},colorLibrary:{get:function(){return s.FormaStyle._getters.colorLibrary.call(this)},set:function(e){this.setColorLibraryWithoutSubscribing(e)}},colorTableSupportsRole:function(e){return e==i.ColorRole.FieldPrimary||e==i.ColorRole.FieldSecondary||e==i.ColorRole.Border||e==i.ColorRole.Shadow}}}),r)},LGJg:function(e,t,n){var r,o=t,a=n("oAGj"),i=n("A6KL"),s=n("fNpk"),l=n("VkKB"),u=n("1NAc"),c=n("qSCS");o.VectorContentNode=(r=function(){},a.defineClass({name:"VectorContentNode",ctor:r,superName:"URLBasedContentNode",statics:{KIND:{get:function(){return"vector"}},SCHEMA_CLASS_NAME:{get:function(){return"VectorContentNode"}},factory:{get:function(){return function(e,t,n,o){var l=a.as(a.opt(a.opt(o,(function(e){return e.backLink})),(function(e){return e.dereference()})),i.GroupContentNode);return s.LegacyCoreAssert.isTrue(null!=l,"Content nodes need a parent",void 0,"VectorContentNode","VectorContentNode.swift",16),r.init_3144(e,t,n,l)}}},USAGE_TAG:"usage_reported",PROPERTY_SIZE:"size",_implements:function(e){return"IDBObject"==e||"TheoMessagePublisher"==e}},props:{init_3144:function(e,t,n,r){a.super_init(this,c.URLBasedContentNode,c.URLBasedContentNode.prototype.init_3144,e,t,n,r)},init_26a9:function(e,t){a.super_init(this,c.URLBasedContentNode,c.URLBasedContentNode.prototype.init_c3fa,e,"vector",t),this.set(r.PROPERTY_SIZE,u.TheoSize.Zero)},init_5972:function(e,t){a.super_init(this,c.URLBasedContentNode,c.URLBasedContentNode.prototype.init_8b5c,e,"vector",t),this.set(r.PROPERTY_SIZE,u.TheoSize.Zero)},className:{get:function(){return r.SCHEMA_CLASS_NAME}},size:{get:function(){return this.get(r.PROPERTY_SIZE)},set:function(e){this.set(r.PROPERTY_SIZE,e)}},shouldReportUsage:function(){return a.opt(this.mediaMetadata,(function(e){return e.sourceName==l.MediaMetadata.kMediaNounProjectSourceName}))},isUsageReported:function(){var e=this.getTag(r.USAGE_TAG);return null!=e&&"true"==e},setUsageReported:function(e){this.setTag(r.USAGE_TAG,e?"true":"false")},getUsageID:function(){return a.opt(this.mediaMetadata,(function(e){return e.assetID}))}}}),r)},"LP+A":function(e,t,n){var r,o=t,a=n("oAGj"),i=n("gXiO"),s=n("iSwi"),l=n("LqGn");o.RetargetLayoutOption=a.defineEnum("RetargetLayoutOption",{UNSET:-1,DisableLayout:0,EnableLayout:1}),o.DesignSuggestionFacade=(r=function(){i.CoreObject.call(this)},a.defineClass({name:"DesignSuggestionFacade",ctor:r,superName:"CoreObject",statics:{createSuggestionsFromTemplate:function(e,t,n,r,i,u){void 0===i&&(i=10),void 0===u&&(u=o.RetargetLayoutOption.UNSET);var c=new s.RetargetSuggester(t,n,e,r),d=a.clone(c.createSuggestions()).filter((function(e){return e instanceof l.RetargetSuggestion}),this).map((function(e){return e}),this);return u!=o.RetargetLayoutOption.UNSET?d=d.filter((function(e){return e.layoutUpdate==(u==o.RetargetLayoutOption.EnableLayout)}),this):s.RetargetSuggester.shouldAttemptLayoutSuggestion(t)||(d=d.filter((function(e){return 0==e.layoutUpdate}),this)),d.slice(0,Math.min(d.length,i))}}}),r)},LcYy:function(e,t,n){var r,o,a=t,i=n("oAGj"),s=n("iCxV"),l=n("fNpk"),u=n("Quhx"),c=n("9YN4");a.DocumentHistory=(r=function(){},o={},i.defineClass({name:"DocumentHistory",ctor:r,superName:"PostDCXObject",statics:{SCHEMA_CLASS_NAME:"DocumentHistory",factory:{get:function(){return void 0===o.factory&&(o.factory=function(e,t,n,o){var a=i.as(i.opt(i.opt(o,(function(e){return e.backLink})),(function(e){return e.dereference()})),c.TheoDocument);return l.LegacyCoreAssert.isTrue(null!=a,"DocumentHistory needs a parent document",void 0,"DocumentHistory","DocumentHistory.swift",15),r.init_7e49(e,n,a)}),o.factory},set:function(e){o.factory=e}},PROPERTY_ENTRIES:"entries",PATH:"document-history",MAX_HISTORY_SIZE:100,_implements:function(e){return"IDBObject"==e||"TheoMessagePublisher"==e}},props:{init_7e49:function(e,t,n){this.parent_=n,i.super_init(this,u.PostDCXObject,u.PostDCXObject.prototype.init_3181,n.database,t,e)},init_d0e4:function(e){this.parent_=e,i.super_init(this,u.PostDCXObject,u.PostDCXObject.prototype.init_11e0,e.database),this.set(u.PostDCXObject.PROPERTY_PATH,r.PATH),this.postEntry("initialized")},className:{get:function(){return r.SCHEMA_CLASS_NAME}},parent:{get:function(){return this.parent_}},entries:{get:function(){var e;return(e=i.as(this.get(r.PROPERTY_ENTRIES),["Array","String"]))||null!=e?e:[]}},postEntry:function(e){var t,n,o,a=this.database.beginTransaction("updateHistory",null),l=i.clone(this.entries);l.length>=r.MAX_HISTORY_SIZE&&l.shift();var u="when:'"+((t=i.opt(s.Host.logging,(function(e){return e.timeStamp()})))||null!=t?t:"?")+"';platform:'"+((n=i.opt(s.Host.logging,(function(e){return e.platformID()})))||null!=n?n:"?")+" ("+((o=i.opt(s.Host.logging,(function(e){return e.additionalPlatformInfo()})))||null!=o?o:"?")+")';format#:"+i.toString(c.TheoDocument.CURRENT_VERSION)+";operation:'"+e+"'";l.push(u),this.set(r.PROPERTY_ENTRIES,l),a.mergeWithPrevious()},entryCount:{get:function(){return this.entries.length}},entryAt:function(e){return e<0||e>=this.entries.length?(i.opt(s.Host.logging,(function(e){return e.warning("entryAt: Invalid index requested, returning empty string")})),""):this.entries[e]},forEachEntry:function(e){for(var t=i.iter(this.entries);!t.done;t.next())e(t.value)},clear:function(){this.set(r.PROPERTY_ENTRIES,[])}}}),r)},ML5t:function(e,t,n){var r,o=t,a=n("oAGj"),i=n("hndY"),s=n("fNpk");o.FormaPagePGMSource=(r=function(e){this.caches_={},this.page=e},a.defineClass({name:"FormaPagePGMSource",ctor:r,superName:"PGMSource",props:{getCache:function(e){var t,n,r=e.asString,o=e.backgroundOpacityOverride<1;if(t=this.caches_[r])return t;if(n=this.page){var a=new i.FormaPGMCache(n,e,o);return o||(this.caches_[r]=a),a}return s.LegacyCoreAssert.fail("FormaPagePGMSource.getGraph: page is out of scope",void 0,"FormaPagePGMSource.getCache","FormaPagePGMSource.swift",46),null},getGraph:function(e){var t;if(t=this.getCache(e)){var n=t.getGraph();return t.adhoc&&t.destroy(),n}return null},getGraphForForma:function(e,t){var n;if(n=this.getCache(t)){var r=n.getGraphForForma(e);return n.adhoc&&n.destroy(),r}return null}}}),r)},MWx2:function(e,t,n){var r,o=t,a=n("oAGj");o.HandleFacade=(r=function(){},a.defineClass({name:"HandleFacade",ctor:r}),r)},MYNe:function(e,t,n){var r,o=t,a=n("oAGj"),i=n("gXiO");o.LayerFacade=(r=function(){i.CoreObject.call(this)},a.defineClass({name:"LayerFacade",ctor:r,superName:"CoreObject",statics:{sortInZOrder:function(e){var t=a.clone(e);return a.sortInPlace(t,(function(e,t){return r.getZOrder(e)<r.getZOrder(t)})),t},getZOrder:function(e){var t;return(t=e.controller)?t.getZOrder():0},setZOrder:function(e,t){a.opt(t.controller,(function(t){return t.setZOrder(e)}))},getMinLayerIndex:function(e){var t;return(t=e.controller)?t.getMinLayerIndex():0},getReorderableLayerCount:function(e){var t;return(t=e.controller)?t.getReorderableLayerCount():0},checkForContiguousChunk:function(e,t){var n=a.clone(r.sortInZOrder(t)),o=r.getMinLayerIndex(t[0]),i=r.getReorderableLayerCount(t[0])+o-1,s=0,l=0;if("backward"==e||"back"==e){if(r.getZOrder(n[0])==o)for(var u=a.iter(a.range(1,n.length-1,!0));!u.done;u.next()){var c=n[f=u.value],d=n[f-1];if(r.getZOrder(c)-r.getZOrder(d)!=1)break;s+=1}if(0!=s)return a.dropFirst(n,s+1)}else if("forward"==e||"front"==e){var h=a.last(n);if(r.getZOrder(h)==i)for(var p=a.iter(a.range(1,n.length-1,!0).reversed());!p.done;p.next()){var f;if(c=n[f=p.value],d=n[f-1],r.getZOrder(c)-r.getZOrder(d)!=1)break;l+=1}if(0!=l)return a.dropLast(n,l+1)}return n}}}),r),o.ZOrderEnum=a.defineEnum("ZOrderEnum",{Forward:"forward",Backward:"backward",Front:"front",Back:"back"})},N5RB:function(e,t,n){var r,o,a,i,s,l=t,u=n("oAGj"),c=n("SpAV"),d=n("fVJ2"),h=n("13MC"),p=n("ZhwN"),f=n("iCxV"),m=n("8vXU"),g=n("rxGp"),y=n("fNpk");l.IDatabase=u.defineProtocol("IDatabase",{host:"IDBObject",deletedObject:"IDBObject",transactionDepth:"Integer",beginTransaction:"(String, IDBState) -> ITransaction",endTransaction:"(ITransaction) -> Void",addListener:"(IDatabaseListener) -> Void",removeListener:"(IDatabaseListener) -> Void",appliedState:"IDBState",mutableState:"IDBMutableState",immutableState:"IDBState",beginBranch:"(String, IDBState, Boolean) -> IDBState",applyBranch:"(String) -> Void",branch:"String",getState:"(String) -> IDBState",newState:"(String, IDBState) -> (String, IDBMutableState)",commitState:"(IDBMutableState) -> Void",commitAndMergeState:"(IDBMutableState) -> Void",abandonState:"(IDBMutableState) -> Void",stateChanged:"(IDBState) -> Void",objectStateChanged:"(IDBObjectState) -> Void",getBranch:"(String, IDBState) -> Array<IDBState>",getBranchHead:"(String) -> IDBState",getObject:"(String) -> DBObject",createObject:"(String, IDBLink) -> DBObject",addObject:"(String, DBObject) -> Void",stageObjectState:"(String, String, IDBObjectState) -> Void",removeObject:"(String) -> Void"}),l.IDatabaseListener=u.defineProtocol("IDatabaseListener",{onBeginTransaction:"(IDatabase, ITransaction) -> Void",onEndTransaction:"(IDatabase, ITransaction) -> Void",onStateChanged:"(IDatabase, IDBState) -> Void",onObjectStateChanged:"(IDatabase, IDBObjectState) -> Void"}),l.PostDBInitialTransaction=(r=function(e,t,n){var r;void 0===n&&(n=null);var o=e.newState((r=n)||null!=r?r:l.PostDB.undoBranchID,null);this.name=t,this.parentDB_=e,this.state=o.state},u.defineClass({name:"PostDBInitialTransaction",ctor:r,statics:{_implements:function(e){return"ITransaction"==e}},props:{parent:{get:function(){return null}},child:{get:function(){return null}},depth:{get:function(){return null==this.parent?1:this.parent.depth+1}},description:{get:function(){return null==this.parent?this.name:this.parent.description+", "+this.name}},end:function(){this.parentDB_.commitState(this.state),this.parentDB_.endTransaction(this)},mergeWithPrevious:function(){this.parentDB_.commitAndMergeState(this.state),this.parentDB_.endTransaction(this)},rollback:function(){this.parentDB_.abandonState(this.state),this.parentDB_.endTransaction(this)}}}),r),l.WeakListener=(o=function(){},u.defineClass({name:"WeakListener",ctor:o,props:{init_cbb0:function(e,t){this.listener_=e,this.db_=t},onBeginTransaction:function(e){var t=this;null!=this.db_&&u.opt(this.listener_,(function(n){return n.onBeginTransaction(t.db_,e)}))},onEndTransaction:function(e){var t=this;null!=this.db_&&u.opt(this.listener_,(function(n){return n.onEndTransaction(t.db_,e)}))},onStateChanged:function(e){var t=this;null!=this.db_&&u.opt(this.listener_,(function(n){return n.onStateChanged(t.db_,e)}))},onObjectStateChanged:function(e){var t=this;null!=this.db_&&u.opt(this.listener_,(function(n){return n.onObjectStateChanged(t.db_,e)}))},init_implicit:function(e,t){this.listener_=e,this.db_=t},clone:function(){return o.init_implicit(this.listener_,this.db_)}}}),o),l.WeakState=(a=function(){},u.defineClass({name:"WeakState",ctor:a,props:{init_9ed3:function(e){this.state=e},init_implicit:function(e){this.state=e},clone:function(){return a.init_implicit(this.state)}}}),a),l.PostDocumentState=(i=function(e){this.state_=e},u.defineClass({name:"PostDocumentState",ctor:i,statics:{_implements:function(e){return"IDocumentState"==e}},props:{state:{get:function(){return this.state_}},stateGUID:{get:function(){return this.state.guid}},updateStateFromDatabase:function(e){var t;(t=e.getState(this.stateGUID))&&(this.state_=t)}}}),i),l.PostDB=(s=function(){this.initialTransaction_=null,this.initialized_=!1,this.listeners_=[],this.states_={},this.branches_={},this.appliedState_=null,this.hostObjectID_=null,this.objects_={},this.objectInitialStates_={},this.objectTypes_={},this.deletedObject_=null,this.rootState=null,this.currentState=null,this.stateManagerTransactions=[]},u.defineClass({name:"PostDB",ctor:s,statics:{undoBranchID:"undo",_implements:function(e){return"IDatabase"==e||"IDocumentStateManager"==e}},props:{deletedObject:{get:function(){return null==this.deletedObject_&&(this.deletedObject_=new d.DBDeletedObject(this)),this.deletedObject_}},transaction:{get:function(){return this.initialized_?u.opt(this.mutableState,(function(e){return e.parentTransaction})):this.initialTransaction_}},transactionDepth:{get:function(){var e;return(e=u.opt(this.transaction,(function(e){return e.depth})))||null!=e?e:0}},transactionStackDescription:{get:function(){var e;return(e=u.opt(this.transaction,(function(e){return e.description})))||null!=e?e:""}},defaultTransactionState:{get:function(){return this.appliedState_||this.stateFromDocumentState(this.currentState)||this.branches_[this.branch]}},beginTransaction:function(e,t){var n;if(n=t||this.mutableState||this.defaultTransactionState){var r="["+(null!=n.transaction?n.transaction.description+", ":"")+"+"+e+"]";return f.Host.logging.logForCategory(g.LogCategories.kTransaction,"transaction: begin "+r,m.LogLevelEnum.INFO_LEVEL),n.beginTransaction(e)}return y.LegacyCoreAssert.isTrue(0==u.count(this.branches_),"If we can't find a transaction state, our branches should be empty",void 0,"PostDB.beginTransaction","Database.swift",263),y.LegacyCoreAssert.isTrue(null==this.initialTransaction_&&0==this.initialized_,"Database already initialized. Why couldn't we find a transaction state?",void 0,"PostDB.beginTransaction","Database.swift",264),this.initialTransaction_=new l.PostDBInitialTransaction(this,e),this.initialTransaction_},beginBranch:function(e,t,n){y.LegacyCoreAssert.isTrue(t instanceof h.DBState||null==t&&this.immutableState instanceof h.DBState,"The database may only be branched from an immutable state.",void 0,"PostDB.beginBranch","Database.swift",270);var r=p.GUIDUtils.makeGUID(),o=t||this.immutableState,a=h.DBState.init_62ed(o,e,r,{});return n&&(a.apply(),this.appliedState_=a),this.branches_[e]=a,a},applyBranch:function(e){var t;(t=this.getBranchHead(e))&&(t.apply(),this.appliedState_=t)},branch:{get:function(){var e;return(e=u.opt(this.appliedState_,(function(e){return e.branch})))||null!=e?e:s.undoBranchID}},endTransaction:function(e){f.Host.logging.logForCategory(g.LogCategories.kTransaction,"transaction: end   "+e.description,m.LogLevelEnum.INFO_LEVEL);for(var t=u.iter(this.listeners_);!t.done;t.next())t.value.onEndTransaction(e);e===this.initialTransaction_&&(this.initialTransaction_=null,this.initialized_=!0)},addListener:function(e){this.removeListener(e),this.listeners_.push(l.WeakListener.init_cbb0(e,this))},removeListener:function(e){this.listeners_=this.listeners_.filter((function(t){return null!=t.listener_&&t.listener_!==e}),this)},appliedState:{get:function(){return this.appliedState_}},mutableState:{get:function(){return this.initialized_?u.opt(this.appliedState_,(function(e){return e.mutableState})):u.opt(this.initialTransaction_,(function(e){return e.state}))}},immutableState:{get:function(){for(var e=this.defaultTransactionState;u.is(e,h.IDBMutableState);)e=u.opt(e,(function(e){return e.basedOn}));return e}},getState:function(e){return u.opt(this.states_[e],(function(e){return e.state}))},newState:function(e,t){var n=p.GUIDUtils.makeGUID(),r=t||this.defaultTransactionState,o=null==t||this.appliedState_===t&&u.opt(this.appliedState_,(function(t){return t.branch==e})),a=null!=r?h.DBMutableState.init_1198(r,e,n):h.DBMutableState.init_4be2(this,e,n);if(o)for(var i=u.iter(a.objectStates);!i.done;i.next())i.value.apply(null);return this.states_[n]=u.clone(l.WeakState.init_9ed3(a)),o&&(this.branches_[e]=a,this.appliedState_=a),{guid:n,state:a}},commitState:function(e){this.initialized_&&y.LegacyCoreAssert.isTrue(u.opt(e.basedOn,(function(e){return null!=e.transaction})),"commitState transaction stack underflow",void 0,"PostDB.commitState","Database.swift",361);var t,n,r=e,o=r.guid,a=r.branch,i=r.basedOn,s=e===this.appliedState_;if(0==u.count(r.objectStates)&&null!=i)this.branches_[a]=i,u.removeKey(this.states_,o);else if(t=u.as(i,h.IDBMutableState))t.flattenFrom(e),this.branches_[a]=t,u.removeKey(this.states_,o);else{var d=e.commit();this.branches_[a]=d,this.states_[o]=u.clone(l.WeakState.init_9ed3(d))}s&&((n=this.branches_[a])?(u.opt(this.host_,(function(e){return e.willApplyDatabaseState(n)})),u.opt(u.as(n,h.DBState),(function(e){return e.applyInternal(!1)})),this.appliedState_=n,u.opt(this.host_,(function(e){return e.didApplyDatabaseState(n)}))):(this.appliedState_=null,c.CoreAssert.fail("Database: no state to apply?",void 0,"PostDB.commitState","Database.swift",397)))},commitAndMergeState:function(e){var t=this;if(this.initialized_&&y.LegacyCoreAssert.isTrue(u.opt(e.basedOn,(function(e){return null!=e.transaction})),"commitAndMergeState transaction stack underflow",void 0,"PostDB.commitAndMergeState","Database.swift",404),s=u.as(e,h.DBMutableState)){var n,r=s.branch,o=e===this.appliedState_,a=s.guid;if(n=u.as(s.basedOn,h.IDBMutableState)){if(n.flattenFrom(e),this.branches_[r]=n,o){for(var i=u.iter(n.objectStates);!i.done;i.next()){var s;(s=i.value).apply(null)}this.appliedState_=n}u.removeKey(this.states_,s.guid)}else{var c,d,p,f={};if(c=s.basedOn){for(var m=u.iter(c.objectStates);!m.done;m.next()){var g=m.key,_=m.value;g!=this.hostObjectID_&&null==this.objects_[g]||(y.LegacyCoreAssert.isFalse(_ instanceof h.DBObjectMutableState,"Immutable database states should not contain mutable object state",void 0,"PostDB.commitAndMergeState","Database.swift",431),f[g]=_)}u.removeKey(this.states_,c.guid),a=c.guid}if(s.forEachInCommitList((function(e,n){var r,o;if(r=t.getObject(e))if(o=f[e]){var a,i;if(n!==o&&((a=u.as(o,h.IDBObjectAncestorState))&&(i=u.as(n,h.IDBObjectDerivedState))?y.LegacyCoreAssert.isTrue(a.isAncestorOf(i),"Merging descendant database states shouldn't merge non-descendant object states",void 0,"PostDB.commitAndMergeState","Database.swift",446):y.LegacyCoreAssert.fail("Expected to merge a derived state into an ancestor state",void 0,"PostDB.commitAndMergeState","Database.swift",449)),T=u.as(o,h.DBChildObjectState))for(var s=u.clone(T.diff(n)),l=u.iter(s);!l.done;l.next()){var c,d=l.key;(c=l.value[1])?T.setProperty(d,c):T.removeProperty(d)}else{var p,m={},g=[];u.append(g,u.keys(o.properties)),u.keys(n.properties).forEach((function(e){g.includes(e)||g.push(e)})),g.forEach((function(e){m[e]=n.getProperty(e)})),(p=u.as(u.opt(u.as(o,h.IDBObjectDerivedState),(function(e){return e.basedOn})),h.DBObjectState))?(f[e]=h.DBObjectState.init_9f95(p,m),r.state=f[e]):(f[e]=h.DBObjectState.init_2a9a(r,m),r.state=f[e])}}else{var _,T,C;(_=u.as(n,h.DBObjectMutableState))?f[e]=_.assign(r):(T=u.as(n,h.DBChildObjectState))?f[e]=T:(C=u.as(n,h.DBObjectState))&&(f[e]=C)}})),u.removeKey(this.states_,s.guid),d=u.as(u.opt(s.basedOn,(function(e){return e.basedOn})),h.DBMutableState)){var T=h.DBMutableState.init_62ed(d,r,a,f);this.branches_[r]=T}else(p=u.as(u.opt(s.basedOn,(function(e){return e.basedOn})),h.DBState))?this.branches_[r]=h.DBState.init_62ed(p,r,a,f):this.branches_[r]=h.DBState.init_40bf(this,r,a,f);if(this.states_[a]=u.clone(l.WeakState.init_9ed3(this.branches_[r])),u.opt(this.currentState,(function(e){return e.updateStateFromDatabase(t)})),o){for(var C=u.iter(this.branches_[r].objectStates);!C.done;C.next())(_=C.value).apply(null);this.appliedState_=this.branches_[r]}}}},abandonState:function(e){var t,n=e,r=e===this.appliedState_,o=n.branch,a=n.basedOn;e.abandon(),this.branches_[o]=a,r&&(t=this.branches_[o])&&(u.opt(this.host_,(function(e){return e.willApplyDatabaseState(t)})),t.apply(),this.appliedState_=t,u.opt(this.host_,(function(e){return e.didApplyDatabaseState(t)})))},stateChanged:function(e){for(var t=u.iter(this.listeners_);!t.done;t.next())t.value.onStateChanged(e)},objectStateChanged:function(e){for(var t=u.iter(this.listeners_);!t.done;t.next())t.value.onObjectStateChanged(e)},getBranch:function(e,t){var n,r=[];if(n=this.branches_[e]){var o=u.opt(t,(function(e){return e.guid}));r.splice(0,0,n);for(var a=r[0].basedOn;null!=a&&(r.splice(0,0,a),a.guid!=o);)a=r[0].basedOn}return r},getBranchHead:function(e){return this.branches_[e]},getObject:function(e){return e==this.hostObjectID_?this.host_:this.objects_[e]},createObject:function(e,t){var n=this.getObject(e);return null==n&&(this.instantiateObject(e,t),n=this.objects_[e]),n},setAddedObjectState:function(e,t){var n;(n=u.as(t,h.IDBObjectAncestorState))?u.opt(this.mutableState,(function(t){return t.addNewObject(e,h.DBObjectMutableState.init_226b(n))})):u.opt(this.mutableState,(function(n){return n.addNewObject(e,t)}))},addObject:function(e,t){var n,r,o;if(t instanceof d.DBHostObject?(y.LegacyCoreAssert.isTrue(null==this.hostObjectID_,"Host object already added",void 0,"PostDB.addObject","Database.swift",599),this.hostObjectID_=e):this.objects_[e]=t,n=this.objectInitialStates_[e])if(u.removeKey(this.objectInitialStates_,e),u.removeKey(this.objectTypes_,e),o=u.as(n,h.DBObjectMutableState)){var a=o.assign(t);this.setAddedObjectState(t,a)}else this.setAddedObjectState(t,n);else if(r=u.as(t.state,h.DBChildObjectState)){var i;if(t.persisted||t.persistToDatabase(this,e),null!=(i=u.opt(this.mutableState,(function(e){return e.branch}))))for(var s=u.iter(this.getBranch(i,null));!s.done;s.next()){var l,c=s.value;(l=u.as(c,h.DBMutableState))&&l.addNewObject(t,r)}}else y.LegacyCoreAssert.isTrue(null!=this.mutableState,"Adding an object without a staged state to an immutable database",void 0,"PostDB.addObject","Database.swift",628),t.initialized||(t.state=t.emptyState),this.setAddedObjectState(t,t.initialState)},stageObjectState:function(e,t,n){this.objectInitialStates_[e]=n,this.objectTypes_[e]=t},removeObject:function(e){u.removeKey(this.objects_,e),u.removeKey(this.objectInitialStates_,e),u.removeKey(this.objectTypes_,e),null!=this.mutableState&&this.mutableState.removeObject(e)},host:{get:function(){return this.host_},set:function(e){y.LegacyCoreAssert.isTrue(null==this.host_,"Host already set",void 0,"PostDB","Database.swift",654),this.host_=e}},instantiateObject:function(e,t){var n,r,o,a;(n=this.objectInitialStates_[e])&&null!=(r=this.objectTypes_[e])&&null!=(o=d.DBHostObject.factory(r))&&(u.removeKey(this.objectInitialStates_,e),u.removeKey(this.objectTypes_,e),(a=u.as(o(e,this,n,t),d.DBObject))&&(a instanceof d.DBHostObject?(y.LegacyCoreAssert.isTrue(null==this.hostObjectID_,"Host object already added",void 0,"PostDB.instantiateObject","Database.swift",669),this.hostObjectID_=e):null==this.objects_[e]&&(this.objects_[e]=a)))},stateFromDocumentState:function(e){var t=this;return y.LegacyCoreAssert.isTrue(null==e||null!=this.states_[e.stateGUID],"Document state removed from the database",void 0,"PostDB.stateFromDocumentState","Database.swift",686),u.opt(e,(function(e){return e.updateStateFromDatabase(t)})),u.opt(e,(function(e){return e.state}))},resetStates:function(){var e;(e=this.branches_[s.undoBranchID])&&(this.rootState=new l.PostDocumentState(e),this.currentState=this.rootState)},getRootState:function(){return this.rootState},beginNewState:function(e){this.stateManagerTransactions.push(this.beginTransaction(e,this.mutableState||this.appliedState_||this.stateFromDocumentState(this.currentState)))},endNewState:function(){var e,t=this.stateManagerTransactions.pop(),n=t.name,r=(e=u.opt(u.opt(u.opt(this.mutableState,(function(e){return e.basedOn})),(function(e){return e.transaction})),(function(e){return e.name})))||null!=e?e:"nil";return y.LegacyCoreAssert.isTrue(t===u.opt(u.opt(this.mutableState,(function(e){return e.basedOn})),(function(e){return e.transaction})),"endNewState ending state manager transaction ["+n+"] that isn't the active transaction ["+r+"]",void 0,"PostDB.endNewState","Database.swift",709),t.end(),null==this.mutableState&&(y.LegacyCoreAssert.isTrue(this.appliedState_===this.branches_[s.undoBranchID],"Current state is not the branch head after a transaction",void 0,"PostDB.endNewState","Database.swift",713),this.currentState=new l.PostDocumentState(this.branches_[s.undoBranchID])),this.currentState},setCurrentState:function(e){var t,n;(t=u.as(e,l.PostDocumentState))&&u.opt(this.currentState,(function(e){return e.stateGUID!=t.stateGUID}))&&(n=this.stateFromDocumentState(t))&&(u.opt(this.host_,(function(e){return e.willApplyDatabaseState(n)})),this.currentState=t,n.apply(),this.appliedState_=n,u.opt(this.host_,(function(e){return e.didApplyDatabaseState(n)})))},getNewStateNestingDepth:function(){return this.stateManagerTransactions.length}}}),s)},NxMp:function(e,t,n){var r,o=t,a=n("oAGj"),i=n("gXiO"),s=n("cmoc"),l=n("pnSN"),u=n("iCxV"),c=n("fdtz"),d=n("K0Rh"),h=n("djAF"),p=n("kSRw"),f=n("enh0"),m=n("WWR6"),g=n("zjod");o.FormaFactory=a.defineProtocol("FormaFactory",{createForma:"(FormaPage, String) -> Forma"}),o.DefaultFormaFactory=(r=function(){this.constructors_={},this.constructors_[d.RootForma.KIND]=function(e,t){return d.RootForma.init_7186(e)},this.constructors_[f.TextForma.KIND]=function(e,t){return f.TextForma.init_7186(e)},this.constructors_[c.ImageForma.KIND]=function(e,t){return c.ImageForma.init_7186(e)},this.constructors_[m.VectorForma.KIND]=function(e,t){return m.VectorForma.init_7186(e)},this.constructors_[l.GroupForma.KIND]=function(e,t){return l.GroupForma.init_7fcf(e,t)},this.constructors_[p.SmartGroupForma.KIND]=function(e,t){return l.GroupForma.init_7fcf(e,l.GroupForma.KIND)},this.constructors_[s.FrameForma.KIND]=function(e,t){return s.FrameForma.init_7186(e)},this.constructors_[h.ShapeForma.KIND]=function(e,t){return h.ShapeForma.init_7186(e)},this.constructors_[g.VideoForma.KIND]=function(e,t){return g.VideoForma.init_7186(e)},i.CoreObject.call(this)},a.defineClass({name:"DefaultFormaFactory",ctor:r,superName:"CoreObject",statics:{_implements:function(e){return"FormaFactory"==e}},props:{createForma:function(e,t){var n=this.constructors_[t];return null==n?(a.opt(u.Host.logging,(function(e){return e.warning("createForma: No constructor for kind "+t+" available.")})),null):n(e,t)}}}),r)},O60Y:function(e,t,n){var r,o=t,a=n("oAGj");o.IDBLink=a.defineProtocol("IDBLink",{database:"IDatabase",referenceID:"String",backLink:"IDBLink",dereference:"() -> DBObject"}),o.DBLink=(r=function(){this.keepAlive_=null},a.defineClass({name:"DBLink",ctor:r,statics:{_implements:function(e){return"IDBLink"==e}},props:{init_8408:function(e,t,n){this.objID_=e,this.db_=t,this.backLinkID_=n},init_14fa:function(e,t){this.objID_=e.id,this.db_=e.persisted?e.database:null,this.backLinkID_=t,this.keepAlive_=e},database:{get:function(){return this.db_}},referenceID:{get:function(){return this.objID_}},backLink:{get:function(){return null!=this.backLinkID_?r.init_8408(this.backLinkID_,this.db_,this.objID_):null}},dereference:function(){var e;return(e=this.keepAlive_)?e:(this.keepAlive_=this.db_.createObject(this.objID_,this),this.keepAlive_)}}}),r)},O8XL:function(e,t,n){var r,o,a=t,i=n("oAGj"),s=n("0wFF"),l=n("cZuM"),u=n("gXiO"),c=n("wNKJ"),d=n("FNB+"),h=n("iCxV"),p=n("fNpk"),f=n("tGKA"),m=n("3DEm");a.DistributeType=i.defineEnum("DistributeType",{HorizontalSpace:0,LeftEdge:1,CenterX:2,RightEdge:3,VerticalSpace:4,TopEdge:5,CenterY:6,BottomEdge:7,Row:8,Column:9}),a.describeDistributeType=function(e){switch(e){case 0:return"HorizontalSpace";case 1:return"LeftEdge";case 2:return"CenterX";case 3:return"RightEdge";case 4:return"VerticalSpace";case 5:return"TopEdge";case 6:return"CenterY";case 7:return"BottomEdge";case 8:return"Row";case 9:return"Column"}},a.FormaGeometryInfo=(r=function(){this.minEdge=99999999.9,this.maxEdge=-99999999.9,this.totalObjectSpan=0,this.interiorFormaeSortedByPosition=[]},i.defineClass({name:"FormaGeometryInfo",ctor:r,props:{getNumFormae:function(){return i.eq(d._equality_Forma_Forma,this.firstForma,this.lastForma)?this.interiorFormaeSortedByPosition.length+1:this.interiorFormaeSortedByPosition.length+2}}}),r),a.AlignmentFacade=(o=function(){u.CoreObject.call(this)},i.defineClass({name:"AlignmentFacade",ctor:o,superName:"CoreObject",statics:{arrangeFormae:function(e,t){i.opt(h.Host.logging,(function(n){return n.logToAnalytics(s.AnalyticsConstants.kAnalyticsFormaeArranged,{contextualData1:"horizontal: "+e,contextualData2:"formae count: "+t.length})})),o.distributeOrArrangeFormae(e?a.DistributeType.Row:a.DistributeType.Column,t),o.rescueFormae(t)},distributeFormae:function(e,t){i.opt(h.Host.logging,(function(n){return n.logToAnalytics(s.AnalyticsConstants.kAnalyticsFormaeDistributed,{contextualData1:"type: "+a.describeDistributeType(e),contextualData2:"formae count: "+t.length})})),p.LegacyCoreAssert.isTrue(t.length>2,"not enough formae to distribute",void 0,"AlignmentFacade.distributeFormae","AlignmentFacade.swift",79),p.LegacyCoreAssert.isTrue(e!=a.DistributeType.Row&&e!=a.DistributeType.Column,"Use arrangeFormae to do row/column layout",void 0,"AlignmentFacade.distributeFormae","AlignmentFacade.swift",80),o.distributeOrArrangeFormae(e,t),o.rescueFormae(t)},alignFormae:function(e,t){e==l.AlignmentType.CenterX||e==l.AlignmentType.CenterY?o.alignCenters(e,t):o.alignEdges(e,t),o.rescueFormae(t)},rescueFormae:function(e){for(var t=i.iter(e);!t.done;t.next()){var n=t.value;c.DragFacade.rescueFormaToPageBounds(n)}},calculateFormaGeometryInfo:function(e,t){p.LegacyCoreAssert.isTrue(t.length>=2,"Not enough forma to distribute",void 0,"AlignmentFacade.calculateFormaGeometryInfo","AlignmentFacade.swift",105);for(var n=new a.FormaGeometryInfo,r=i.iter(t);!r.done;r.next()){var s=r.value.controller.getUserPerceivedFrame();if(null!=s)switch(e){case 0:case 1:case 2:case 3:case 8:n.minEdge=m.MathUtils.minDouble(n.minEdge,s.minX),n.maxEdge=m.MathUtils.maxDouble(n.maxEdge,s.maxX),n.totalObjectSpan+=s.maxX-s.minX;break;case 4:case 5:case 6:case 7:case 9:n.minEdge=m.MathUtils.minDouble(n.minEdge,s.minY),n.maxEdge=m.MathUtils.maxDouble(n.maxEdge,s.maxY),n.totalObjectSpan+=s.maxY-s.minY}}var l=i.sort(t,(function(t,n){var r=t.controller.getUserPerceivedFrame(),o=n.controller.getUserPerceivedFrame();if(null!=r&&null!=o)switch(e){case 0:case 1:case 2:case 3:case 8:return r.minX<o.minX;case 4:case 5:case 6:case 7:case 9:return r.minY<o.minY}return!1}));n.firstForma=i.first(l),n.lastForma=i.last(l);for(var u=i.iter(l);!u.done;u.next()){var c=u.value,h=c.controller.getUserPerceivedFrame(),f=n.firstForma.controller.getUserPerceivedFrame(),g=n.lastForma.controller.getUserPerceivedFrame();switch(e){case 0:case 1:case 2:case 3:case 8:o.isVeryClose(f.minX,h.minX)&&h.width>f.width&&(n.firstForma=c),(h.maxX>g.maxX||o.isVeryClose(h.maxX,g.maxX)&&h.width>g.width)&&(n.lastForma=c);break;case 4:case 5:case 6:case 7:case 9:o.isVeryClose(f.minY,h.minY)&&h.height>f.height&&(n.firstForma=c),(h.maxY>g.maxY||o.isVeryClose(h.maxY,g.maxY)&&h.height>g.height)&&(n.lastForma=c)}}return i.remove(l,n.firstForma),i.eq(d._equality_Forma_Forma,n.firstForma,n.lastForma)||i.remove(l,n.lastForma),n.interiorFormaeSortedByPosition=i.clone(l),n},distributeOrArrangeFormae:function(e,t){var n=o.calculateFormaGeometryInfo(e,t);p.LegacyCoreAssert.isTrue(null!=n.firstForma,"expected to have a firstForma computed",void 0,"AlignmentFacade.distributeOrArrangeFormae","AlignmentFacade.swift",189),p.LegacyCoreAssert.isTrue(null!=n.lastForma,"expected to have a lastForma computed",void 0,"AlignmentFacade.distributeOrArrangeFormae","AlignmentFacade.swift",190),p.LegacyCoreAssert.isTrue(n.getNumFormae()==t.length,"expected sorted formae to match formae list",void 0,"AlignmentFacade.distributeOrArrangeFormae","AlignmentFacade.swift",191),e==a.DistributeType.Row||e==a.DistributeType.Column||e==a.DistributeType.VerticalSpace||e==a.DistributeType.HorizontalSpace?o.distributeSpaceOrMakeRowColumn(n,e):o.distributeEdges(n,e)},distributeEdges:function(e,t){p.LegacyCoreAssert.isTrue(e.getNumFormae()>=3,"expected at least 3 items to distribute",void 0,"AlignmentFacade.distributeEdges","AlignmentFacade.swift",201),p.LegacyCoreAssert.isTrue(t==a.DistributeType.LeftEdge||t==a.DistributeType.CenterX||t==a.DistributeType.RightEdge||t==a.DistributeType.TopEdge||t==a.DistributeType.CenterY||t==a.DistributeType.BottomEdge,"unexpected distribute type",void 0,"AlignmentFacade.distributeEdges","AlignmentFacade.swift",202);var n=0,r=0,o=e.firstForma.controller.getUserPerceivedFrame(),s=e.lastForma.controller.getUserPerceivedFrame();switch(p.LegacyCoreAssert.isTrue(null!=o&&null!=s,"expecting formae to have frames",void 0,"AlignmentFacade.distributeEdges","AlignmentFacade.swift",209),t){case 1:n=o.minX,r=s.minX;break;case 5:n=o.minY,r=s.minY;break;case 3:n=o.maxX,r=s.maxX;break;case 7:n=o.maxY,r=s.maxY;break;case 2:n=(o.maxX+o.minX)/2,r=(s.maxX+s.minX)/2;break;case 6:n=(o.maxY+o.minY)/2,r=(s.maxY+s.minY)/2;break;default:p.LegacyCoreAssert.fail("unexpected distribute type",void 0,"AlignmentFacade.distributeEdges","AlignmentFacade.swift",230)}for(var l=(r-n)/i.toDouble(e.getNumFormae()-1),u=n+l,c=i.iter(e.interiorFormaeSortedByPosition);!c.done;c.next()){var d=c.value,h=d.controller.getUserPerceivedFrame();if(null!=h){var m=0,g=0;switch(t){case 1:m=u-h.minX,u=h.minX+m+l;break;case 3:m=u-h.maxX,u=h.maxX+m+l;break;case 5:g=u-h.minY,u=h.minY+g+l;break;case 7:g=u-h.maxY,u=h.maxY+g+l;break;case 2:var y=(h.maxX+h.minX)/2;u=y+(m=u-y)+l;break;case 6:var _=(h.maxY+h.minY)/2;u=_+(g=u-_)+l;break;default:p.LegacyCoreAssert.fail("unexpected distribute type",void 0,"AlignmentFacade.distributeEdges","AlignmentFacade.swift",270)}if(0!=m||0!=g){var T=new f.Matrix2D(1,0,0,1,m,g);i.opt(d.controller,(function(e){return e.move(T)}))}}}},isVeryClose:function(e,t){return m.MathUtils.absDouble(e-t)<1e-4},getRequiredShiftAmount:function(e,t,n){var r=0;if(n==a.DistributeType.Row||n==a.DistributeType.Column){var o,s,l=e.totalObjectSpan+t*i.toDouble(e.getNumFormae()-1),u=e.firstForma.controller.getUserPerceivedFrame();n==a.DistributeType.Row?(o=u.minX+l,s=e.firstForma.page.pageSize.width):(o=u.minY+l,s=e.firstForma.page.pageSize.height),o>s&&(r=l>s?n==a.DistributeType.Row?-1*u.minX:-1*u.minY:s-o)}return r},getFormaSpacingForRowCol:function(e,t){var n=e.totalObjectSpan/(10*i.toDouble(e.getNumFormae())),r=e.totalObjectSpan/(5*i.toDouble(e.getNumFormae())),a=e.totalObjectSpan/(2*i.toDouble(e.getNumFormae()));return t<0?0:o.isVeryClose(t,n)?r:o.isVeryClose(t,r)?a:o.isVeryClose(t,a)?0:n},distributeSpaceOrMakeRowColumn:function(e,t){var n,r;p.LegacyCoreAssert.isTrue(t==a.DistributeType.Row||t==a.DistributeType.Column||t==a.DistributeType.VerticalSpace||t==a.DistributeType.HorizontalSpace,"wrong distribute type",void 0,"AlignmentFacade.distributeSpaceOrMakeRowColumn","AlignmentFacade.swift",353);var s,l=(e.maxEdge-e.minEdge-e.totalObjectSpan)/i.toDouble(e.getNumFormae()-1),u=e.interiorFormaeSortedByPosition.concat();t!=a.DistributeType.Row&&t!=a.DistributeType.Column||(u.push(e.lastForma),l=o.getFormaSpacingForRowCol(e,l)),s=t==a.DistributeType.Row||t==a.DistributeType.HorizontalSpace?((n=i.opt(e.firstForma.controller.getUserPerceivedFrame(),(function(e){return e.maxX})))||null!=n?n:0)+l:((r=i.opt(e.firstForma.controller.getUserPerceivedFrame(),(function(e){return e.maxY})))||null!=r?r:0)+l;var c=o.getRequiredShiftAmount(e,l,t);0!=c&&u.splice(0,0,e.firstForma);for(var h=i.iter(u);!h.done;h.next()){var m=h.value,g=m.controller.getUserPerceivedFrame();if(null!=g){var y=0,_=0;if(i.eq(d._equality_Forma_Forma,m,e.firstForma)&&!i.eq(d._equality_Forma_Forma,m,e.lastForma)?(p.LegacyCoreAssert.isTrue(0!=c,"shouldn't be moving first element",void 0,"AlignmentFacade.distributeSpaceOrMakeRowColumn","AlignmentFacade.swift",394),t==a.DistributeType.Row?(y=c,s=g.maxX+y+l):(p.LegacyCoreAssert.isTrue(t==a.DistributeType.Column,"Shouldn't have a shift unless we're doing Row or Column layout",void 0,"AlignmentFacade.distributeSpaceOrMakeRowColumn","AlignmentFacade.swift",400),_=c,s=g.maxY+_+l)):t==a.DistributeType.Row||t==a.DistributeType.HorizontalSpace?(y=s-g.minX,s=g.maxX+y+l):(_=s-g.minY,s=g.maxY+_+l),0!=y||0!=_){var T=new f.Matrix2D(1,0,0,1,y,_);i.opt(m.controller,(function(e){return e.move(T)}))}}}},alignCenters:function(e,t){p.LegacyCoreAssert.isTrue(e==l.AlignmentType.CenterX||e==l.AlignmentType.CenterY,"alignCenters called with non-center alignment type",void 0,"AlignmentFacade.alignCenters","AlignmentFacade.swift",430);for(var n=99999999.9,r=-99999999.9,o=i.iter(t);!o.done;o.next())null!=(c=(u=o.value).controller.getUserPerceivedFrame())&&(e==l.AlignmentType.CenterX?(n=m.MathUtils.minDouble(n,c.minX),r=m.MathUtils.maxDouble(r,c.maxX)):(n=m.MathUtils.minDouble(n,c.minY),r=m.MathUtils.maxDouble(r,c.maxY)));for(var a=(n+r)/2,s=i.iter(t);!s.done;s.next()){var u,c;if(null!=(c=(u=s.value).controller.getUserPerceivedFrame())){var d=0,h=0;if(e==l.AlignmentType.CenterX?d=a-(c.minX+c.maxX)/2:h=a-(c.minY+c.maxY)/2,0!=d||0!=h){var g=new f.Matrix2D(1,0,0,1,d,h);i.opt(u.controller,(function(e){return e.move(g)}))}}}},alignEdges:function(e,t){var n=99999999.9;e!=l.AlignmentType.Right&&e!=l.AlignmentType.Bottom||(n*=-1);for(var r=i.iter(t);!r.done;r.next())null!=(s=(a=r.value).controller.getUserPerceivedFrame())&&(e==l.AlignmentType.Left?n=m.MathUtils.minDouble(n,s.minX):e==l.AlignmentType.Right?n=m.MathUtils.maxDouble(n,s.maxX):e==l.AlignmentType.Top?n=m.MathUtils.minDouble(n,s.minY):e==l.AlignmentType.Bottom?n=m.MathUtils.maxDouble(n,s.maxY):p.LegacyCoreAssert.fail("align to type not yet implemented",{type:e},"AlignmentFacade.alignEdges","AlignmentFacade.swift",493));for(var o=i.iter(t);!o.done;o.next()){var a,s;if(null!=(s=(a=o.value).controller.getUserPerceivedFrame())){var u=0,c=0;if(e==l.AlignmentType.Left?u=n-s.minX:e==l.AlignmentType.Right?u=n-s.maxX:e==l.AlignmentType.Top?c=n-s.minY:e==l.AlignmentType.Bottom&&(c=n-s.maxY),0!=u||0!=c){var d=new f.Matrix2D(1,0,0,1,u,c);i.opt(a.controller,(function(e){return e.move(d)}))}}}}}}),o)},ODYV:function(e,t,n){var r,o,a=t,i=n("oAGj"),s=n("9oQN"),l=n("9BFu");a.RelayoutEvaluationScore=(r=function e(t){this.rejectThreshold=-1,this.scoreLog="",this.overlapInitial_={},this.outOfBoundsInitial_={},this.orderInitial_={},this.sizesInitial_={},this.initialEmptySpace_=0,this.root_=t,this.floating_=i.clone(t.filterWithCallback((function(e){return null!=e.controller&&e.controller.floating}))),l.WeightedScore.call(this,e.Features.NUM_FEAT),this.initFeatures()},o={},i.defineClass({name:"RelayoutEvaluationScore",ctor:r,superName:"WeightedScore",statics:{Features:{get:function(){return void 0===o.Features&&(o.Features=i.defineEnum("Features",{TEXT_MIN_SIZE:1,GRAPHIC_MIN_SIZE:2,EMPTY_SPACE_DIFF:3,NUM_FEAT:4})),o.Features}},_implements:function(e){return"DocumentEvaluationScore"==e}},props:{initFeatures:function(){this.setFeatureName(r.Features.TEXT_MIN_SIZE,"Text Min Size"),this.setFeatureName(r.Features.GRAPHIC_MIN_SIZE,"Graphic Min Size"),this.setFeatureName(r.Features.EMPTY_SPACE_DIFF,"Empty Size"),this.setWeight(r.Features.TEXT_MIN_SIZE,-1e3),this.setWeight(r.Features.GRAPHIC_MIN_SIZE,-100),this.setWeight(r.Features.EMPTY_SPACE_DIFF,-3),this.setFeature(r.Features.TEXT_MIN_SIZE,0),this.setFeature(r.Features.GRAPHIC_MIN_SIZE,0),this.setFeature(r.Features.EMPTY_SPACE_DIFF,0),this.sizesInitial_=i.clone(s.EvaluationUtils.getFormaSizes(this.floating_)),this.initialEmptySpace_=s.EvaluationUtils.getEmptySpace(this.root_)},evaluateDocument:function(){this.floating_=this.floating_.filter((function(e){return null!=e.root}),this);var e=s.EvaluationUtils.evaluateSizeDifferences(this.floating_,this.sizesInitial_,s.EvaluationUtils.getFormaSizes(this.floating_)),t=e.textDiff,n=e.graphicDiff;this.setFeature(r.Features.TEXT_MIN_SIZE,t),this.setFeature(r.Features.GRAPHIC_MIN_SIZE,n);var o=s.EvaluationUtils.getEmptySpace(this.root_);this.setFeature(r.Features.EMPTY_SPACE_DIFF,Math.max(o-this.initialEmptySpace_,0))},print:function(){return this.asString},reject:function(){return this.score<this.rejectThreshold},evalScore:function(){return this.score}}}),r)},OdB2:function(e,t,n){var r,o,a,i,s,l,u,c,d=t,h=n("oAGj"),p=n("90dd");d.FormaPageView=h.defineProtocol("FormaPageView",{beginViewUpdate:"(FormaUpdateEvent) -> AnyObject",endViewUpdate:"(AnyObject) -> Void",getViewportTransform:"() -> Matrix2D",beginUserResize:"() -> Void",endUserResize:"() -> Void"}),d.FormaBeginUpdateMessage=(r=function e(t,n){this.event=n,p.TheoMessage.call(this,e.TYPE,t)},h.defineClass({name:"FormaBeginUpdateMessage",ctor:r,superName:"TheoMessage",statics:{TYPE:{get:function(){return"FormaBeginUpdateMessage"}}}}),r),d.FormaEndUpdateMessage=(o=function e(t,n){this.event=n,p.TheoMessage.call(this,e.TYPE,t)},h.defineClass({name:"FormaEndUpdateMessage",ctor:o,superName:"TheoMessage",statics:{TYPE:{get:function(){return"FormaEndUpdateMessage"}}}}),o),d.PageSizeUpdateMessage=(a=function e(t,n){this.newSize=n,p.TheoMessage.call(this,e.TYPE,t)},h.defineClass({name:"PageSizeUpdateMessage",ctor:a,superName:"TheoMessage",statics:{TYPE:{get:function(){return"PageSizeUpdateMessage"}}}}),a),d.BeginFormaDragMessage=(i=function e(t){p.TheoMessage.call(this,e.TYPE,t)},h.defineClass({name:"BeginFormaDragMessage",ctor:i,superName:"TheoMessage",statics:{TYPE:{get:function(){return"BeginFormaDragMessage"}}}}),i),d.FormaDragMessage=(s=function e(t){p.TheoMessage.call(this,e.TYPE,t)},h.defineClass({name:"FormaDragMessage",ctor:s,superName:"TheoMessage",statics:{TYPE:{get:function(){return"FormaDragMessage"}}}}),s),d.EndFormaDragMessage=(l=function e(t){p.TheoMessage.call(this,e.TYPE,t)},h.defineClass({name:"EndFormaDragMessage",ctor:l,superName:"TheoMessage",statics:{TYPE:{get:function(){return"EndFormaDragMessage"}}}}),l),d.BeginFormaResizeMessage=(u=function e(t){p.TheoMessage.call(this,e.TYPE,t)},h.defineClass({name:"BeginFormaResizeMessage",ctor:u,superName:"TheoMessage",statics:{TYPE:{get:function(){return"BeginFormaResizeMessage"}}}}),u),d.EndFormaResizeMessage=(c=function e(t){p.TheoMessage.call(this,e.TYPE,t)},h.defineClass({name:"EndFormaResizeMessage",ctor:c,superName:"TheoMessage",statics:{TYPE:{get:function(){return"EndFormaResizeMessage"}}}}),c)},P83h:function(e,t,n){var r,o,a,i,s,l,u,c,d,h,p,f,m,g,y,_,T,C,v,P,S,A,D,E,R,F,I,b,O,k,M,N,L=t,x=n("oAGj");L.FormaUpdateEvent=(r=function(e,t){this.duration=0,this.type=e,this.forma=t},x.defineClass({name:"FormaUpdateEvent",ctor:r,superName:"CoreObject"}),r),L.TextPlacementEvent=(o=function e(t){L.FormaUpdateEvent.call(this,e.TYPE,t)},x.defineClass({name:"TextPlacementEvent",ctor:o,superName:"FormaUpdateEvent",statics:{TYPE:{get:function(){return"TextPlacementEvent"}}}}),o),L.FormaTransformChangedEvent=(a=function e(t){L.FormaUpdateEvent.call(this,e.TYPE,t)},x.defineClass({name:"FormaTransformChangedEvent",ctor:a,superName:"FormaUpdateEvent",statics:{TYPE:{get:function(){return"FormaTransformChangedEvent"}}}}),a),L.FormaCreatedEvent=(i=function e(t){L.FormaUpdateEvent.call(this,e.TYPE,t)},x.defineClass({name:"FormaCreatedEvent",ctor:i,superName:"FormaUpdateEvent",statics:{TYPE:{get:function(){return"FormaCreatedEvent"}}}}),i),L.FormaNullChangedEvent=(s=function e(t){L.FormaUpdateEvent.call(this,e.TYPE,t)},x.defineClass({name:"FormaNullChangedEvent",ctor:s,superName:"FormaUpdateEvent",statics:{TYPE:{get:function(){return"FormaNullChangedEvent"}}}}),s),L.FormaAnimationTransactionEvent=(l=function e(t){L.FormaUpdateEvent.call(this,e.TYPE,t)},x.defineClass({name:"FormaAnimationTransactionEvent",ctor:l,superName:"FormaUpdateEvent",statics:{TYPE:{get:function(){return"FormaAnimationTransactionEvent"}}}}),l),L.FormaHierarchyChangedEvent=(u=function e(t){L.FormaUpdateEvent.call(this,e.TYPE,t)},x.defineClass({name:"FormaHierarchyChangedEvent",ctor:u,superName:"FormaUpdateEvent",statics:{TYPE:{get:function(){return"FormaHierarchyChangedEvent"}}}}),u),L.FormaChildrenEvent=(c=function(e,t,n,r){this._children=n,this.index=r,L.FormaUpdateEvent.call(this,L.FormaInsertedChildrenEvent.TYPE,t)},x.defineClass({name:"FormaChildrenEvent",ctor:c,superName:"FormaUpdateEvent",props:{children:{get:function(){return this._children.concat()}},forEachChild:function(e){this._children.forEach(e)}}}),c),L.FormaInsertedChildrenEvent=(d=function e(t,n,r){L.FormaChildrenEvent.call(this,e.TYPE,t,n,r)},x.defineClass({name:"FormaInsertedChildrenEvent",ctor:d,superName:"FormaChildrenEvent",statics:{TYPE:{get:function(){return"FormaInsertedChildrenEvent"}}}}),d),L.FormaInsertedAuxiliariesEvent=(h=function e(t,n,r){this.auxiliaries=n,this.index=r,L.FormaUpdateEvent.call(this,e.TYPE,t)},x.defineClass({name:"FormaInsertedAuxiliariesEvent",ctor:h,superName:"FormaUpdateEvent",statics:{TYPE:{get:function(){return"FormaInsertedAuxiliariesEvent"}}}}),h),L.FormaRemovedChildrenEvent=(p=function e(t,n,r){L.FormaChildrenEvent.call(this,e.TYPE,t,n,r)},x.defineClass({name:"FormaRemovedChildrenEvent",ctor:p,superName:"FormaChildrenEvent",statics:{TYPE:{get:function(){return"FormaRemovedChildrenEvent"}}}}),p),L.FormaRemovedAuxiliariesEvent=(f=function e(t,n,r){this.auxiliaries=n,this.index=r,L.FormaUpdateEvent.call(this,e.TYPE,t)},x.defineClass({name:"FormaRemovedAuxiliariesEvent",ctor:f,superName:"FormaUpdateEvent",statics:{TYPE:{get:function(){return"FormaRemovedAuxiliariesEvent"}}}}),f),L.FormaGeometryChangedEvent=(m=function e(t){L.FormaUpdateEvent.call(this,e.TYPE,t)},x.defineClass({name:"FormaGeometryChangedEvent",ctor:m,superName:"FormaUpdateEvent",statics:{TYPE:{get:function(){return"FormaGeometryChangedEvent"}}}}),m),L.FormaBoundsInvalidatedEvent=(g=function e(t){L.FormaUpdateEvent.call(this,e.TYPE,t)},x.defineClass({name:"FormaBoundsInvalidatedEvent",ctor:g,superName:"FormaUpdateEvent",statics:{TYPE:{get:function(){return"FormaBoundsInvalidatedEvent"}}}}),g),L.FormaPathChangedEvent=(y=function e(t){L.FormaUpdateEvent.call(this,e.TYPE,t)},x.defineClass({name:"FormaPathChangedEvent",ctor:y,superName:"FormaUpdateEvent",statics:{TYPE:{get:function(){return"FormaPathChangedEvent"}}}}),y),L.FormaColorChangedEvent=(_=function e(t){L.FormaUpdateEvent.call(this,e.TYPE,t)},x.defineClass({name:"FormaColorChangedEvent",ctor:_,superName:"FormaUpdateEvent",statics:{TYPE:{get:function(){return"FormaColorChangedEvent"}}}}),_),L.FormaStrokeChangedEvent=(T=function e(t){L.FormaUpdateEvent.call(this,e.TYPE,t)},x.defineClass({name:"FormaStrokeChangedEvent",ctor:T,superName:"FormaUpdateEvent",statics:{TYPE:{get:function(){return"FormaStrokeChangedEvent"}}}}),T),L.FormaFillRuleChangedEvent=(C=function e(t){L.FormaUpdateEvent.call(this,e.TYPE,t)},x.defineClass({name:"FormaFillRuleChangedEvent",ctor:C,superName:"FormaUpdateEvent",statics:{TYPE:{get:function(){return"FormaFillRuleChangedEvent"}}}}),C),L.FormaContentChangedEvent=(v=function e(t){L.FormaUpdateEvent.call(this,e.TYPE,t)},x.defineClass({name:"FormaContentChangedEvent",ctor:v,superName:"FormaUpdateEvent",statics:{TYPE:{get:function(){return"FormaContentChangedEvent"}}}}),v),L.FormaCutoutChangedEvent=(P=function e(t){L.FormaUpdateEvent.call(this,e.TYPE,t)},x.defineClass({name:"FormaCutoutChangedEvent",ctor:P,superName:"FormaUpdateEvent",statics:{TYPE:{get:function(){return"FormaCutoutChangedEvent"}}}}),P),L.FormaStyleChangedEvent=(S=function e(t){L.FormaUpdateEvent.call(this,e.TYPE,t)},x.defineClass({name:"FormaStyleChangedEvent",ctor:S,superName:"FormaUpdateEvent",statics:{TYPE:{get:function(){return"FormaStyleChangedEvent"}}}}),S),L.AnimationStyleChangedEvent=(A=function e(t){L.FormaUpdateEvent.call(this,e.TYPE,t)},x.defineClass({name:"AnimationStyleChangedEvent",ctor:A,superName:"FormaUpdateEvent",statics:{TYPE:{get:function(){return"AnimationStyleChangedEvent"}}}}),A),L.AnimationTimeChangedEvent=(D=function e(t,n){this.time=n,L.FormaUpdateEvent.call(this,e.TYPE,t)},x.defineClass({name:"AnimationTimeChangedEvent",ctor:D,superName:"FormaUpdateEvent",statics:{TYPE:{get:function(){return"AnimationTimeChangedEvent"}}}}),D),L.AnimationStateChangedEvent=(E=function e(t,n){this.state=n,L.FormaUpdateEvent.call(this,e.TYPE,t)},x.defineClass({name:"AnimationStateChangedEvent",ctor:E,superName:"FormaUpdateEvent",statics:{TYPE:{get:function(){return"AnimationStateChangedEvent"}}}}),E),L.FormaAnimationChangedEvent=(R=function e(t){L.FormaUpdateEvent.call(this,e.TYPE,t)},x.defineClass({name:"FormaAnimationChangedEvent",ctor:R,superName:"FormaUpdateEvent",statics:{TYPE:{get:function(){return"FormaAnimationChangedEvent"}}}}),R),L.FormaAlignmentChangedEvent=(F=function e(t,n,r){this.activeSnaplines=x.clone(n),this.nearbySnaplines=x.clone(r),L.FormaUpdateEvent.call(this,e.TYPE,t)},x.defineClass({name:"FormaAlignmentChangedEvent",ctor:F,superName:"FormaUpdateEvent",statics:{TYPE:{get:function(){return"FormaAlignmentChangedEvent"}}}}),F),L.FormaApplyMaskEvent=(I=function e(t){L.FormaUpdateEvent.call(this,e.TYPE,t)},x.defineClass({name:"FormaApplyMaskEvent",ctor:I,superName:"FormaUpdateEvent",statics:{TYPE:{get:function(){return"FormaApplyMaskEvent"}}}}),I),L.FormaVideoStateChangedEvent=(b=function e(t){L.FormaUpdateEvent.call(this,e.TYPE,t)},x.defineClass({name:"FormaVideoStateChangedEvent",ctor:b,superName:"FormaUpdateEvent",statics:{TYPE:{get:function(){return"FormaVideoStateChangedEvent"}}}}),b),L.FormaVideoTimeChangedEvent=(O=function e(t){L.FormaUpdateEvent.call(this,e.TYPE,t)},x.defineClass({name:"FormaVideoTimeChangedEvent",ctor:O,superName:"FormaUpdateEvent",statics:{TYPE:{get:function(){return"FormaVideoTimeChangedEvent"}}}}),O),L.FormaGroupEvent=(k=function e(t){L.FormaUpdateEvent.call(this,e.TYPE,t)},x.defineClass({name:"FormaGroupEvent",ctor:k,superName:"FormaUpdateEvent",statics:{TYPE:{get:function(){return"FormaGroupEvent"}}}}),k),L.FormaUngroupEvent=(M=function e(t){L.FormaUpdateEvent.call(this,e.TYPE,t)},x.defineClass({name:"FormaUngroupEvent",ctor:M,superName:"FormaUpdateEvent",statics:{TYPE:{get:function(){return"FormaUngroupEvent"}}}}),M),L.FormaForceRerenderPseudoChangeEvent=(N=function e(t){L.FormaUpdateEvent.call(this,e.TYPE,t)},x.defineClass({name:"FormaForceRerenderPseudoChangeEvent",ctor:N,superName:"FormaUpdateEvent",statics:{TYPE:{get:function(){return"FormaForceRerenderPseudoChangeEvent"}}}}),N)},Pn67:function(e,t,n){var r,o=t,a=n("oAGj"),i=n("YeWL");o.MotionEntryNone=(r=function(){this.srcId="",this.logic=new i.MotionLogicClear,this.args={st:0,dur:1}},a.defineClass({name:"MotionEntryNone",ctor:r,statics:{_implements:function(e){return"MotionEntry"==e}}}),r)},Puiz:function(e,t,n){var r,o=t,a=n("oAGj"),i=n("RO7T"),s=n("lWlM"),l=n("iCxV"),u=n("BAdM"),c=n("CqFS");o.PREFIX_CP="cp:",o.PREFIX_AC="ac:",o.JSONNodeDecoder=(r=function(e,t){this.node_=t,i.BaseNodeDecoder.call(this,e)},a.defineClass({name:"JSONNodeDecoder",ctor:r,superName:"BaseNodeDecoder",statics:{_implements:function(e){return"IImportDataObject"==e}},props:{getPropertyOnNode:function(e){return a.as(this.node_[e],"AnyObject")},forEachChild:function(e){var t,n=0;if(t=a.as(this.node_[c.PROPERTY_KEY_CHILDREN],["Array","Any"]))for(var o=a.iter(t);!o.done;o.next()){var i,s=o.value;(i=a.as(s,["Dictionary","String","Any"]))&&(e(new r(this.branch_,i),n),n+=1)}},forEachComponent:function(e){var t,n=0;if(null!=(t=a.as(this.property(c.PROPERTY_KEY_EXTERNAL_URL),"String"))){var r,i,d,h=null;if(t.startsWith(o.PREFIX_CP))null!=(r=a.opt(l.Host.brandkitManager,(function(e){return e.getFilePathForEncodedURL(t)})))?null!=(i=a.opt(l.Host.persistUtils,(function(e){return e.mimeTypeForFileAtPath(r)})))&&null!=(d=a.opt(l.Host.persistUtils,(function(e){return e.fileUrlForPath(r)})))?h=u.JSONComponentDecoder.init_f390(a.opt(l.Host.resourceUtils,(function(e){return e.makeGUID()})),null,this.id,i,null,d):a.opt(l.Host.logging,(function(e){return e.warning("Could not open downloaded file at "+r+"!")})):a.opt(l.Host.logging,(function(e){return e.warning("Do not have a CP file for "+t+"!")}));else if(t.startsWith(o.PREFIX_AC)){var p=t.substr(o.PREFIX_AC.length).split("/")[1];(f=this.branch_.getComponentWithId(p))?h=new s.DCXComponentDecoder(this.branch_,f):a.opt(l.Host.logging,(function(e){return e.warning("No component with id "+p+"!")}))}else if(t.startsWith(c.PREFIX_COMPONENT)){var f;p=t.substr(c.PREFIX_COMPONENT.length).split("/")[1],(f=this.branch_.getComponentWithId(p))?h=new s.DCXComponentDecoder(this.branch_,f):a.opt(l.Host.logging,(function(e){return e.warning("No component with id "+p+"!")}))}else a.opt(l.Host.logging,(function(e){return e.warning("Unrecognized external URL format: "+t+"!")}));null!=h?(e(h,n),n+=1):a.opt(l.Host.logging,(function(e){return e.warning("No component found for "+t)}))}}}}),r)},Q1H8:function(e,t,n){var r,o=t,a=n("oAGj"),i=n("Bqrm"),s=n("pnSN"),l=n("cbNz"),u=n("jC54"),c=n("9BFu");o.DesignScore=(r=function(e){this.versionNumber=1,this.rejectThreshold=-10,this.dataset="DefaultDesignScore",this.root_=e;for(var t,n,r={},o=a.clone(new i.DesignConstraintFeatureExtractor(this.root_).numericalFeatures),u=a.iter(a.keys(o));!u.done;u.next())r[p=u.value]=o[p];if((t=this.root_.controller.getGridController())&&(n=a.as(t.forma,s.GroupForma)))for(var d=a.clone(new l.GridStyleFeatureExtractor(n).numericalFeatures),h=a.iter(a.keys(d));!h.done;h.next()){var p;r[p=h.value]=d[p]}c.WeightedScore.call(this,a.count(r)),this.writeDoubleFeatureDict(this.dataset,r)},a.defineClass({name:"DesignScore",ctor:r,superName:"WeightedScore",props:{writeDoubleFeatureDict:function(e,t){var n=this,r=0;a.each(t,(function(t,o){var a=u.ModelWeightLibrary.getData(e,t);n.setFeatureName(r,t),n.setMean(r,a.mean),n.setStd(r,a.std),n.setWeight(r,a.weight),n.setFeature(r,o),r+=1}))},reject:function(){return this.score<this.rejectThreshold}}}),r)},QBb7:function(e,t,n){var r,o,a,i=t,s=n("oAGj"),l=n("90dd");i.ITransaction=s.defineProtocol("ITransaction",{name:"String",description:"String",parent:"ITransaction",child:"ITransaction",depth:"Integer",end:"() -> Void",mergeWithPrevious:"() -> Void",rollback:"() -> Void"}),i.TransactionMessage=(r=function(e,t,n){this.transaction=e,l.TheoMessage.call(this,t,n)},s.defineClass({name:"TransactionMessage",ctor:r,superName:"TheoMessage"}),r),i.TransactionBegunMessage=(o=function e(t,n){i.TransactionMessage.call(this,t,e.TYPE,n)},s.defineClass({name:"TransactionBegunMessage",ctor:o,superName:"TransactionMessage",statics:{TYPE:"DatabaseTransactionBegunMessage"}}),o),i.TransactionEndedMessage=(a=function e(t,n){i.TransactionMessage.call(this,t,e.TYPE,n)},s.defineClass({name:"TransactionEndedMessage",ctor:a,superName:"TransactionMessage",statics:{TYPE:"DatabaseTransactionEndedMessage"}}),a)},QTen:function(e,t,n){var r,o,a=t,i=n("oAGj"),s=n("ascj"),l=n("uWOl"),u=n("fNpk"),c=n("RkYL");a.VideoStyle=(r=function(){},o={},i.defineClass({name:"VideoStyle",ctor:r,superName:"ImageStyle",statics:{SCHEMA_CLASS_NAME:{get:function(){return"VideoStyle"}},KIND:{get:function(){return"VideoStyle"}},PROPERTY_VOLUME:"volume",PROPERTY_STARTTIME:"start-time",PROPERTY_DURATION:"duration",volumeOff:0,volumeLow:.3,volumeFull:1,kMaxDuration:{get:function(){return void 0===o.kMaxDuration&&(o.kMaxDuration=c.TheoTime.fromSecondsAsMs(15)),o.kMaxDuration}},kTrimPadding:{get:function(){return void 0===o.kTrimPadding&&(o.kTrimPadding=c.TheoTime.fromSecondsAsMs(3)),o.kTrimPadding}},initialProps:{get:function(){return void 0===o.initialProps&&(o.initialProps={volume:r.volumeFull,"start-time":c.TheoTime.Zero,duration:c.TheoTime.Zero}),o.initialProps}},factory:{get:function(){return function(e,t,n,o){return r.init_866e(n,e)}}},createDefault:function(){return r.init_d41d()},_implements:function(e){return"IDBObject"==e||"TheoMessagePublisher"==e||"ColorTableOwner"==e}},props:{init_866e:function(e,t){i.super_init(this,l.ImageStyle,l.ImageStyle.prototype.init_866e,e,t)},init_dd5d:function(e,t){for(var n=i.clone(t),o=i.iter(r.initialProps);!o.done;o.next()){var a=o.key,s=o.value;null==e[a]&&null==t[a]&&(n[a]=s)}i.super_init(this,l.ImageStyle,l.ImageStyle.prototype.init_dd5d,e,n)},init_d41d:function(){i.super_init(this,l.ImageStyle,l.ImageStyle.prototype.init_a6fe,r.KIND,l.ImageStyle.DEFAULT_NAME,s.ColorTable.createDefault(),r.initialProps)},volumeLevel:{get:function(){var e;return(e=i.as(this.get(r.PROPERTY_VOLUME),"Double"))||null!=e?e:r.volumeFull},set:function(e){this.notifyBefore(),this.set(r.PROPERTY_VOLUME,e),this.notifyAfter()}},startTime:{get:function(){var e,t;return(t=this._transientStartTime)?t:(e=i.as(this.get(r.PROPERTY_STARTTIME),c.TheoTime))||null!=e?e:c.TheoTime.fromSecondsAsMs(0)},set:function(e){u.LegacyCoreAssert.isTrue(null==this._transientStartTime,"Can't set startTime while using transient time",void 0,"VideoStyle","VideoStyle.swift",93),this.notifyBefore(),this.set(r.PROPERTY_STARTTIME,e),this.notifyAfter()}},endTime:{get:function(){return this.startTime.add(this.duration)},set:function(e){this.duration=e.subtract(this.startTime)}},duration:{get:function(){var e,t;return(t=this._transientDuration)?t:(e=i.as(this.get(r.PROPERTY_DURATION),c.TheoTime))||null!=e?e:c.TheoTime.fromSecondsAsMs(0)},set:function(e){u.LegacyCoreAssert.isTrue(null==this._transientDuration,"Can't set startTime while using transient time",void 0,"VideoStyle","VideoStyle.swift",119),this.notifyBefore(),e.seconds>r.kMaxDuration.seconds?this.set(r.PROPERTY_DURATION,r.kMaxDuration):this.set(r.PROPERTY_DURATION,e),this.notifyAfter()}},setTransientTime:function(e,t){var n,r,o=t.safeSubtract(e);(!(n=this._transientStartTime)||!(r=this._transientDuration)||!n.equals(e)||!r.equals(o))&&(this.notifyBefore(),this._transientStartTime=e,this._transientDuration=o,this.notifyAfter())},resetTransientTime:function(){null==this._transientStartTime&&null==this._transientDuration||(this.notifyBefore(),this._transientStartTime=null,this._transientDuration=null,this.notifyAfter())},className:{get:function(){return r.SCHEMA_CLASS_NAME}},match:function(e){var t=this.startTime,n=this.duration;l.ImageStyle.prototype.match.call(this,e),this.startTime=t,this.duration=n},mergeWithImageStyle:function(e){var t,n,o=this,a=null;if(t=e)if(n=i.as(t,r))a=i.as(n.clone(),r),i.opt(a,(function(e){return e.startTime=o.startTime})),i.opt(a,(function(e){return e.duration=o.duration}));else{var s=i.clone(t.state.allProperties),l={volume:this.volumeLevel,"start-time":this.startTime,duration:this.duration,kind:r.KIND};(a=r.init_dd5d(s,l)).colorLibrary=t.colorLibrary}return a},downgradeToImageStyle:function(){var e={kind:l.ImageStyle.KIND};return l.ImageStyle.init_dd5d(this.state.allProperties,e)}}}),r)},Qb69:function(e,t,n){var r,o,a=t,i=n("oAGj"),s=n("fVJ2"),l=n("dJuF");a.TheoDocumentData=(r=function(){},o={},i.defineClass({name:"TheoDocumentData",ctor:r,superName:"DBObject",statics:{SCHEMA_CLASS_NAME:"TheoDocumentData",codec:{get:function(){return void 0===o.codec&&(o.codec=l.DBPropertyCodec.registerCodec(r.SCHEMA_CLASS_NAME,l.DBPropertyCodec.directObjectCodec(r.SCHEMA_CLASS_NAME))),o.codec}},factory:{get:function(){return function(e,t,n,o){return r.init_866e(n,e)}}},PROPERTY_SHARE_DATA:"shareData",PROPERTY_SCOPE:"scope",_implements:function(e){return"IDBObject"==e}},props:{init_866e:function(e,t){i.super_init(this,s.DBObject,s.DBObject.prototype.init_866e,e,t)},init_d41d:function(){i.super_init(this,s.DBObject,s.DBObject.prototype.init_dd5d,{},{})},className:{get:function(){return r.SCHEMA_CLASS_NAME}},hasBeenPublished:{get:function(){return null!=this.shareData}},listed:{get:function(){return"public"==this.scope},set:function(e){var t=null;this.persisted&&(t=this.database.beginTransaction("scope",null)),this.scope=e?"public":"private",i.opt(t,(function(e){return e.mergeWithPrevious()}))}},shareData:{get:function(){return i.as(this.get(r.PROPERTY_SHARE_DATA),["Dictionary","String","String"])}},scope:{get:function(){var e;return(e=i.opt(this.shareData,(function(e){return e[r.PROPERTY_SCOPE]})))||null!=e?e:""},set:function(e){var t={};null!=this.shareData&&(t=i.clone(this.shareData)),t[r.PROPERTY_SCOPE]=e,this.set(r.PROPERTY_SHARE_DATA,t)}}}}),r)},QbzR:function(e,t,n){var r,o,a,i=t,s=n("oAGj"),l=n("ascj"),u=n("dJuF"),c=n("cmoc"),d=n("4mVB"),h=n("ZhwN"),p=n("Qlvz"),f=n("SDdr"),m=n("fNpk"),g=n("Quhx"),y=n("Zifs"),_=n("djAF"),T=n("90dd");i.FormaBlendMode=s.defineEnum("FormaBlendMode",{Normal:0,Screen:1,Multiply:2,Overlay:3,SoftLight:4,HardLight:5,ColorDodge:6,ColorBurn:7,Darken:8,Lighten:9,Difference:10,Exclusion:11,Hue:12,Saturation:13,Color:14,Luminosity:15}),i.FormaStyle=(r=function(){this.notifyDepth_=0},o={},s.defineClass({name:"FormaStyle",ctor:r,superName:"PostPublishingObject",statics:{SCHEMA_CLASS_NAME:{get:function(){return"FormaStyle"}},SCHEMA_ALL_TYPES_NAME:"FormaStyleTypes",codec:{get:function(){return void 0===o.codec&&(o.codec=u.DBPropertyCodec.registerCodec(r.SCHEMA_ALL_TYPES_NAME,u.DBPropertyCodec.directObjectCodec(r.SCHEMA_CLASS_NAME))),o.codec}},OPACITY_DEFAULT:1,OPACITY_UNSET:-1,PROPERTY_KIND:"kind",PROPERTY_OPACITY:"opacity",PROPERTY_COLORS:"color-table",PROPERTY_FILTER:"filter",PROPERTY_ADJUSTMENTS:"adjustments",PROPERTY_BLENDMODE:"blend-mode",BLEND_MODE_NORMAL:"normal",BLEND_MODE_SCREEN:"screen",BLEND_MODE_MULTIPLY:"multiply",BLEND_MODE_OVERLAY:"overlay",BLEND_MODE_SOFTLIGHT:"softlight",BLEND_MODE_HARDLIGHT:"hardlight",BLEND_MODE_COLORDODGE:"colordodge",BLEND_MODE_COLORBURN:"colorburn",BLEND_MODE_DARKEN:"darken",BLEND_MODE_LIGHTEN:"lighten",BLEND_MODE_DIFFERENCE:"difference",BLEND_MODE_EXCLUSION:"exclusion",BLEND_MODE_HUE:"hue",BLEND_MODE_SATURATION:"saturation",BLEND_MODE_COLOR:"color",BLEND_MODE_LUMINOSITY:"luminosity",PROPERTY_COLORS_DEPRECATED:"colors",KIND:{get:function(){return"FormaStyle"}},factory:{get:function(){return function(e,t,n,o){return r.init_866e(n,e)}}},createDefault:function(){return r.init_5afe(r.KIND,r.OPACITY_DEFAULT,l.ColorTable.createWithOneSolidColor(y.SolidColor.ZERO))},_implements:function(e){return"IDBObject"==e||"TheoMessagePublisher"==e||"ColorTableOwner"==e}},props:{init_5afe:function(e,t,n,o,a,u){void 0===o&&(o=null),void 0===a&&(a=null),void 0===u&&(u=null);var c={kind:e,opacity:t,"color-table":n||l.ColorTable.createDefault(),adjustments:a||p.ImageAdjustments.createDefault()};if(null!=o&&(c[r.PROPERTY_FILTER]=o),null!=u)for(var d=s.iter(u);!d.done;d.next()){var h=d.key,f=d.value;c[h]=f}s.super_init(this,g.PostPublishingObject,g.PostPublishingObject.prototype.init_dd5d,{},c),null!=o&&(o.style=this),this.beforeMsg_=new i.FormaStyleChangedMessage(this,!1),this.afterMsg_=new i.FormaStyleChangedMessage(this,!0),this.colors.owner=this},init_866e:function(e,t){var n;s.super_init(this,g.PostPublishingObject,g.PostPublishingObject.prototype.init_866e,e,t),(n=s.as(this.get(r.PROPERTY_FILTER),f.ImageFilter))&&(n.style=this),null==s.as(this.get(r.PROPERTY_COLORS),l.ColorTable)&&this.set(r.PROPERTY_COLORS,l.ColorTable.createDefault()),null==s.as(this.get(r.PROPERTY_ADJUSTMENTS),p.ImageAdjustments)&&this.set(r.PROPERTY_ADJUSTMENTS,p.ImageAdjustments.createDefault()),this.beforeMsg_=new i.FormaStyleChangedMessage(this,!1),this.afterMsg_=new i.FormaStyleChangedMessage(this,!0),this.colors.owner=this},init_dd5d:function(e,t){var n,o=s.clone(t);null==e[r.PROPERTY_COLORS]&&null==t[r.PROPERTY_COLORS]&&(o[r.PROPERTY_COLORS]=l.ColorTable.createDefault()),null==e[r.PROPERTY_ADJUSTMENTS]&&null==t[r.PROPERTY_ADJUSTMENTS]&&(o[r.PROPERTY_ADJUSTMENTS]=p.ImageAdjustments.createDefault()),s.super_init(this,g.PostPublishingObject,g.PostPublishingObject.prototype.init_dd5d,e,o),(n=s.as(this.get(r.PROPERTY_FILTER),f.ImageFilter))&&(n.style=this),this.beforeMsg_=new i.FormaStyleChangedMessage(this,!1),this.afterMsg_=new i.FormaStyleChangedMessage(this,!0),this.colors.owner=this},didChangeState:function(e){var t=this;g.PostPublishingObject.prototype.didChangeState.call(this,e),s.opt(this.filter,(function(e){return e.style=t}))},className:{get:function(){return r.SCHEMA_CLASS_NAME}},kind:{get:function(){return this.get(r.PROPERTY_KIND)}},filter:{get:function(){return s.as(this.get(r.PROPERTY_FILTER),f.ImageFilter)},set:function(e){this.notifyBefore(),this.set(r.PROPERTY_FILTER,e),this.notifyAfter()}},adjustments:{get:function(){return s.as(this.get(r.PROPERTY_ADJUSTMENTS),p.ImageAdjustments)},set:function(e){this.notifyBefore(),this.set(r.PROPERTY_ADJUSTMENTS,e),this.notifyAfter()}},opacity:{get:function(){var e;return(e=s.as(this.get(r.PROPERTY_OPACITY),"Double"))||null!=e?e:r.OPACITY_DEFAULT},set:function(e){e!=this.opacity&&(this.notifyBefore(),this.set(r.PROPERTY_OPACITY,e),this.notifyAfter())}},blendMode:{get:function(){var e;switch((e=s.as(this.get(r.PROPERTY_BLENDMODE),"String"))||null!=e?e:r.BLEND_MODE_NORMAL){case"screen":return i.FormaBlendMode.Screen;case"multiply":return i.FormaBlendMode.Multiply;case"overlay":return i.FormaBlendMode.Overlay;case"softlight":return i.FormaBlendMode.SoftLight;case"hardlight":return i.FormaBlendMode.HardLight;case"colordodge":return i.FormaBlendMode.ColorDodge;case"colorburn":return i.FormaBlendMode.ColorBurn;case"darken":return i.FormaBlendMode.Darken;case"lighten":return i.FormaBlendMode.Lighten;case"difference":return i.FormaBlendMode.Difference;case"exclusion":return i.FormaBlendMode.Exclusion;case"hue":return i.FormaBlendMode.Hue;case"saturation":return i.FormaBlendMode.Saturation;case"color":return i.FormaBlendMode.Color;case"luminosity":return i.FormaBlendMode.Luminosity;default:return i.FormaBlendMode.Normal}},set:function(e){if(e!=this.blendMode){switch(this.notifyBefore(),e){case 1:this.set(r.PROPERTY_BLENDMODE,r.BLEND_MODE_SCREEN);break;case 2:this.set(r.PROPERTY_BLENDMODE,r.BLEND_MODE_MULTIPLY);break;case 3:this.set(r.PROPERTY_BLENDMODE,r.BLEND_MODE_OVERLAY);break;case 4:this.set(r.PROPERTY_BLENDMODE,r.BLEND_MODE_SOFTLIGHT);break;case 5:this.set(r.PROPERTY_BLENDMODE,r.BLEND_MODE_HARDLIGHT);break;case 6:this.set(r.PROPERTY_BLENDMODE,r.BLEND_MODE_COLORDODGE);break;case 7:this.set(r.PROPERTY_BLENDMODE,r.BLEND_MODE_COLORBURN);break;case 8:this.set(r.PROPERTY_BLENDMODE,r.BLEND_MODE_DARKEN);break;case 9:this.set(r.PROPERTY_BLENDMODE,r.BLEND_MODE_LIGHTEN);break;case 10:this.set(r.PROPERTY_BLENDMODE,r.BLEND_MODE_DIFFERENCE);break;case 11:this.set(r.PROPERTY_BLENDMODE,r.BLEND_MODE_EXCLUSION);break;case 12:this.set(r.PROPERTY_BLENDMODE,r.BLEND_MODE_HUE);break;case 13:this.set(r.PROPERTY_BLENDMODE,r.BLEND_MODE_SATURATION);break;case 14:this.set(r.PROPERTY_BLENDMODE,r.BLEND_MODE_COLOR);break;case 15:this.set(r.PROPERTY_BLENDMODE,r.BLEND_MODE_LUMINOSITY);break;default:this.set(r.PROPERTY_BLENDMODE,r.BLEND_MODE_NORMAL)}this.notifyAfter()}}},colorLibrary:{get:function(){return this.colorLibrary_},set:function(e){this.colorLibrary_=e,s.opt(this.colors_,(function(t){return t.library=e}))}},clearColorLibrarySub:function(){s.opt(this.colors_,(function(e){return e.library=null})),this.colorLibrary_=null},setColorLibraryWithoutSubscribing:function(e){this.colorLibrary_=e,this.colors.setColorLibraryWithoutSubscribing(e)},colors_:{get:function(){return s.as(this.get(r.PROPERTY_COLORS),l.ColorTable)},set:function(e){this.set(r.PROPERTY_COLORS,e)}},colors:{get:function(){var e,t;return(e=this.colors_)?e:((t=this.owner_)?m.LegacyCoreAssert.fail("Getting a nil color table from forma style",{kind:t.kind,id:t.id},"FormaStyle","FormaStyle.swift",325):m.LegacyCoreAssert.fail("Getting a nil color table from style with nil forma",void 0,"FormaStyle","FormaStyle.swift",327),l.ColorTable.createDefault())}},dispose:function(){this.colorLibrary=null},owner:{get:function(){return this.owner_},set:function(e){this.owner_=e}},clone:function(){var e,t,n=s.as(this.fork(h.GUIDUtils.makeGUID()),r);return(e=n)&&(e.set(r.PROPERTY_COLORS,s.opt(this.colors_,(function(e){return e.clone()}))||l.ColorTable.createDefault()),e.colors.owner=n,e.colorLibrary=this.colorLibrary),(t=s.as(n,d.GridStyle))&&(t.moveableShift=s.as(this,d.GridStyle).moveableShift),n},cloneToDatabase:function(e){var t=this,n=s.as(this.forkToDatabase(h.GUIDUtils.makeGUID(),!1,e,null),r);return null!=n&&this.persisted&&this.database===e&&(n.colorLibrary=this.colorLibrary),s.opt(n,(function(e){return e.set(r.PROPERTY_COLORS,s.opt(t.colors_,(function(e){return e.clone()}))||l.ColorTable.createDefault())})),s.opt(n,(function(e){return e.colors.owner=n})),s.opt(n,(function(e){return e.colors.library=s.opt(n,(function(e){return e.colorLibrary}))})),n},detachFromDatabase:function(){return this.cloneToDatabase(null)},match:function(e){var t=s.clone(e.state.allProperties);this.notifyBefore(),this.matchProperties(t),this.notifyAfter()},asString:{get:function(){return""}},notifyBefore:function(){this.notifyDepth_+=1,1==this.notifyDepth_&&this.publish(this.beforeMsg_)},notifyAfter:function(){m.LegacyCoreAssert.isTrue(this.notifyDepth_>0,"notifyAfter called but notify depth is not positive",void 0,"FormaStyle.notifyAfter","FormaStyle.swift",425),1==this.notifyDepth_&&this.publish(this.afterMsg_),this.notifyDepth_-=1},colorTableBeforeChanged:function(){this.notifyBefore()},colorTableAfterChanged:function(){this.notifyAfter()},colorTableSupportsRole:function(e){return e==l.ColorRole.FieldPrimary},canColorEntriesBeEmpty:function(){var e;return!(e=this.owner_)||e.kind==c.FrameForma.KIND||e.kind==_.ShapeForma.KIND}}}),r),i.FormaStyleChangedMessage=(a=function e(t,n){this.isBefore=!n,this.isAfter=n,T.TheoMessage.call(this,e.TYPE,t)},s.defineClass({name:"FormaStyleChangedMessage",ctor:a,superName:"TheoMessage",statics:{TYPE:{get:function(){return"FormaStyleChangedMessage"}}}}),a)},QgZx:function(e,t,n){var r,o=t,a=n("oAGj"),i=n("SpAV"),s=n("gXiO"),l=n("iCxV"),u=n("fNpk"),c=n("9YN4");o.FontOrigin=a.defineEnum("FontOrigin",{UNKNOWN_ORIGIN:0,USER_CHOSEN:1,STARTUP:2,ACTIVATE_MISSING:3,ACTIVATE_FOR_PREVIEW:4}),o.describeFontOrigin=function(e){switch(e){case 0:return"unknown";case 1:return"user-chosen";case 2:return"startup";case 3:return"activate-missing";case 4:return"activate-for-preview"}},o.FontSource=a.defineEnum("FontSource",{UNKNOWN_SOURCE:0,WEB_FONT:1,EMBEDDED:2,SPARK_PROVIDED:3,USER_UPLOAD:4,TYPEKIT_FREE:5,TYPEKIT_PREMIUM:6}),o.describeFontSource=function(e){switch(e){case 0:return"unknown";case 1:return"web";case 2:return"embedded";case 3:return"spark";case 4:return"user-upload";case 5:return"typekit-free";case 6:return"typekit-premium"}},o.FontAvailability=a.defineEnum("FontAvailability",{UNKNOWN:0,LOADABLE:1,LOADED:2,NOT_LOADABLE:3}),o.FontEmbeddability=a.defineEnum("FontEmbeddability",{INSTALLABLE:0,RESTRICTED:2,PREVIEW_AND_PRINT:4,EDITABLE:8,NO_SUBSETTING:256,BITMAP_ONLY:512}),a.gvar(o,"fontDescriptorStrings",(function(){return{familyName:function(e,t){e.familyName=t},displaySample:function(e,t){e.displaySample=t},label:function(e,t){e.label=t},postScriptName:function(e,t){e.postScriptName=t},macPostScriptName:function(e,t){e.macPostScriptName=t},filename:function(e,t){e.filename=t},family:function(e,t){e.family=t},original_family:function(e,t){e.original_family=t},faceName:function(e,t){e.faceName=t},category:function(e,t){e.category=t},subfamilyName:function(e,t){e.subfamilyName=t},preferredFamilyName:function(e,t){e.preferredFamilyName=t},preferredSubfamilyName:function(e,t){e.preferredSubfamilyName=t},cssName:function(e,t){e.cssName=t},tkSyncId:function(e,t){e.tkSyncId=t},tkWebId:function(e,t){e.tkWebId=t},style:function(e,t){e.style=t}}})),a.gvar(o,"fontDescriptorDoubles",(function(){return{capAccentRatio:function(e,t){e.capAccentRatio=t},capRatio:function(e,t){e.capRatio=t},meanAccentRatio:function(e,t){e.meanAccentRatio=t},meanRatio:function(e,t){e.meanRatio=t},ascentRatio:function(e,t){e.ascentRatio=t},dAscentRatio:function(e,t){e.dAscentRatio=t},baselineOffsetRatio:function(e,t){e.baselineOffsetRatio=t},tailRatio:function(e,t){e.tailRatio=t},descentRatio:function(e,t){e.descentRatio=t},italicAngle:function(e,t){e.italicAngle=t},popularity:function(e,t){e.popularity=t}}})),a.gvar(o,"fontDescriptorInts",(function(){return{weight:function(e,t){e.weight=t},source:function(e,t){var n;e.source=(n=o.FontSource.toCaseValue(t))||null!=n?n:o.FontSource.UNKNOWN_SOURCE},formality:function(e,t){e.formality=t},blackness:function(e,t){e.blackness=t},drama:function(e,t){e.drama=t},width:function(e,t){e.width=t},usWidthClass:function(e,t){e.usWidthClass=t},usWeightClass:function(e,t){e.usWeightClass=t},fsType:function(e,t){e.fsType=t}}})),a.gvar(o,"fontDescriptorBools",(function(){return{allCapsAllowed:function(e,t){e.allCapsAllowed=t},displayAllowed:function(e,t){e.displayAllowed=t},bodyAllowed:function(e,t){e.bodyAllowed=t},serif:function(e,t){e.serif=t},slab:function(e,t){e.slab=t},handdrawn:function(e,t){e.handdrawn=t},calligraphic:function(e,t){e.calligraphic=t},decorative:function(e,t){e.decorative=t},square:function(e,t){e.square=t},geometric:function(e,t){e.geometric=t},italic:function(e,t){e.italic=t}}})),o.FontDescriptor=(r=function(e){this.displayFamilyName_="",this.displayFaceName_="",this._source=o.FontSource.UNKNOWN_SOURCE,this.availability=o.FontAvailability.LOADABLE,this._spaceWidthRatio=0,this.capAccentRatio=0,this.capRatio=0,this.meanAccentRatio=0,this.meanRatio=0,this.ascentRatio=0,this.dAscentRatio=0,this.baselineOffsetRatio=0,this.tailRatio=0,this.descentRatio=0,this.italicAngle=0,this.displaySample="",this.upperCaseCharsDict={},this.lowerCaseCharsDict={},this.capAccentCharsDict={},this.capCharsDict={},this.ascentCharsDict={},this.meanAccentCharsDict={},this.meanCharsDict={},this.baseCharsDict={},this.tailCharsDict={},this.descentCharsDict={},this.characterFeatures={},this.label="",this.postScriptName="",this.macPostScriptName="",this.filename="",this.family="",this.original_family="",this.category="",this.familyName="",this.subfamilyName="",this.preferredFamilyName="",this.preferredSubfamilyName="",this.faceName="",this.cssName="",this.tkSyncId="",this.tkWebId="",this.style="",this.popularity=0,this.weight=0,this.formality=0,this.blackness=0,this.drama=0,this.width=0,this.usWidthClass=0,this.usWeightClass=0,this.fsType=0,this.allCapsAllowed=!1,this.displayAllowed=!1,this.bodyAllowed=!1,this.serif=!1,this.slab=!1,this.handdrawn=!1,this.calligraphic=!1,this.decorative=!1,this.square=!1,this.geometric=!1,this.italic=!1,s.CoreObject.call(this);for(var t=a.iter(o.fontDescriptorStrings);!t.done;t.next()){var n=t.key,r=t.value;null!=(f=e[n])&&r(this,f)}for(var l=a.iter(o.fontDescriptorDoubles);!l.done;l.next())n=l.key,r=l.value,null!=(f=e[n])&&r(this,f);for(var u=a.iter(o.fontDescriptorInts);!u.done;u.next())if(n=u.key,r=u.value,null!=(f=e[n]))if("weight"==n&&null!=a.as(f,"String")){var c=f,d=a.isEmpty(c)?0:a.toInt(c);r(this,d>0?d:400)}else if("source"==n){var h=f;this.source=null!=o.FontSource.toCaseValue(h)?o.FontSource.toCaseValue(h):o.FontSource.UNKNOWN_SOURCE}else r(this,f);for(var p=a.iter(o.fontDescriptorBools);!p.done;p.next()){var f;n=p.key,r=p.value,null!=(f=e[n])&&r(this,f)}for(var m=e.uppercaseChars,g=e.lowercaseChars,y=e.capAccentChars,_=e.capChars,T=e.ascentChars,C=e.meanAccentChars,v=e.meanChars,P=e.baseChars,S=e.tailChars,A=e.descentChars,D=a.clone(a.as(e.characterFeatures,["Dictionary","String","Double"])),E=a.iter(a.chars(m));!E.done;E.next()){var R=E.value;this.upperCaseCharsDict[R]=!0}for(var F=a.iter(a.chars(g));!F.done;F.next()){var I=F.value;this.lowerCaseCharsDict[I]=!0}for(var b=a.iter(a.chars(y));!b.done;b.next()){var O=b.value;this.capAccentCharsDict[O]=!0}for(var k=a.iter(a.chars(_));!k.done;k.next()){var M=k.value;this.capCharsDict[M]=!0}for(var N=a.iter(a.chars(T));!N.done;N.next()){var L=N.value;this.ascentCharsDict[L]=!0}for(var x=a.iter(a.chars(C));!x.done;x.next()){var B=x.value;this.meanAccentCharsDict[B]=!0}for(var w=a.iter(a.chars(v));!w.done;w.next()){var G=w.value;this.meanCharsDict[G]=!0}for(var Y=a.iter(a.chars(P));!Y.done;Y.next()){var U=Y.value;this.baseCharsDict[U]=!0}for(var V=a.iter(a.chars(S));!V.done;V.next()){var j=V.value;this.tailCharsDict[j]=!0}for(var H=a.iter(a.chars(A));!H.done;H.next()){var W=H.value;this.descentCharsDict[W]=!0}if(null!=D)for(var K=a.iter(a.keys(D));!K.done;K.next()){var X=K.value;this.characterFeatures[X]=D[X]}0==this.meanRatio&&(i.CoreAssertDebugOnly.fail("FontDescriptor::init - meanRatio is 0 for font "+this.postScriptName+" with variationId "+a.toString(e.variationId),void 0,"FontDescriptor.init","FontDescriptor.swift",437),this.meanRatio=.5,this.capRatio<=0&&(this.capRatio=.75,this.ascentRatio=.75,this.dAscentRatio=.75,this.meanAccentRatio=.75,this.capAccentRatio=.75,this.tailRatio=0,this.baselineOffsetRatio=0)),0==this.dAscentRatio&&(this.dAscentRatio=this.ascentRatio+this.baselineOffsetRatio)},a.defineClass({name:"FontDescriptor",ctor:r,superName:"CoreObject",statics:{PROPERTY_POSTSCRIPT_NAME:"postscript-name",PROPERTY_SOURCE:"source",decodeJson:function(e,t){var n=a.as(e,["Dictionary","String","Any"]);if(null==n)return u.LegacyCoreAssert.fail("FontDescriptorAttribute: Data is missing or not a dictionary",void 0,"FontDescriptor.decodeJson","FontDescriptor.swift",484),null;var i=n[r.PROPERTY_POSTSCRIPT_NAME],s=l.Host.fontProvider.descriptorForPostScriptName(i,a.as(t,c.TheoDocument));return s.postScriptName==i&&s.availability==o.FontAvailability.LOADED||t.recordMissingFont(i),s}},props:{displayFamilyName:{get:function(){return""==this.displayFamilyName_&&(this.displayFamilyName_=this.preferredFamilyName),""==this.displayFamilyName_&&(this.displayFamilyName_=this.familyName),""==this.displayFamilyName_&&(this.displayFamilyName_=this.family),""==this.displayFamilyName_&&(this.displayFamilyName_=this.postScriptName),this.displayFamilyName_},set:function(e){this.displayFamilyName_=e}},displayFaceName:{get:function(){return""==this.displayFaceName_&&(this.displayFaceName_=this.preferredSubfamilyName),""==this.displayFaceName_&&(this.displayFaceName_=this.subfamilyName),""==this.displayFaceName_&&(this.displayFaceName_=this.faceName),""==this.displayFaceName_&&(this.displayFaceName_=this.label),""==this.displayFaceName_&&(this.displayFaceName_=this.postScriptName),this.displayFaceName_},set:function(e){this.displayFaceName_=e}},touaName:{get:function(){return this.displayFamilyName+" "+this.displayFaceName}},source:{get:function(){return this._source},set:function(e){this._source==o.FontSource.EMBEDDED?e!=o.FontSource.EMBEDDED&&a.info("Font "+this.postScriptName+" is already marked as EMBEDDED. Ignoring new font source"):this._source=e}},privateSetFontSource:function(e){this._source=e},spaceWidthRatio:{get:function(){if(0==this._spaceWidthRatio){var e=l.Host.textModelUtils.measureBoundsForLayout(" ",this,100,0);this._spaceWidthRatio=e.width/100}return this._spaceWidthRatio}},resolveFamily:function(){return this.family!=this.cssName||""==this.original_family?this.family:this.original_family},isEqual:function(e){var t=a.as(e,r);return null!=t&&this.postScriptName==t.postScriptName},encodeJson:function(){var e={};return e[r.PROPERTY_POSTSCRIPT_NAME]=this.postScriptName,e[r.PROPERTY_SOURCE]=o.describeFontSource(this.source),e}}}),r),o._equality_FontDescriptor_FontDescriptor=function(e,t){return e.isEqual(t)}},QgdZ:function(e,t,n){var r,o=t,a=n("oAGj"),i=n("7Pku"),s=n("w/+j"),l=n("pnSN"),u=n("Bqrn"),c=n("fNpk"),d=n("c+uM"),h=n("tGKA"),p=n("T8w7"),f=n("Ird5"),m=n("jfma"),g=n("dmHI"),y=n("vTQu"),_=n("yjxF"),T=n("Aj79"),C=n("g6aL"),v=n("Zifs"),P=n("djAF"),S=n("3HaQ"),A=n("enh0"),D=n("8Quq");o.TypeLockupToPGMMapper=(r=function(){u.GroupFormaToPGMMapper.call(this)},a.defineClass({name:"TypeLockupToPGMMapper",ctor:r,superName:"GroupFormaToPGMMapper",statics:{usesPageAnchoredStyle:function(e){var t;if(t=a.as(e.style,d.LockupStyle)){var n=t.backing;return n==d.LockupBacking.BannerHorizontal||n==d.LockupBacking.BannerVertical||n==d.LockupBacking.Banner||n==d.LockupBacking.Knockout}return!1},getPGMForTypeLockup:function(e,t,n){var r=0,o=0,i=function t(i){var u,h,p,g=null,y=null,E=null,R=null;if(u=a.as(i,l.GroupForma)){var F=null,I=null,b=null,O=null;u.childrenAsArray.forEach((function(e){var n=t(e),r=n.shapeRef,o=n.bottomTextRef,a=n.textRef,i=n.knockoutRef;null!=r&&(null==F&&(F=[]),F.push(r)),null!=o&&(null==I&&(I=[]),I.push(o)),null!=a&&(null==b&&(b=[]),b.push(a)),null!=i&&(null==O&&(O=[]),O.push(i))})),null!=F&&(g=s.FormaToPGMUtils.applyAnimations(e,u,new T.PGMReference(new C.PGMSimpleGroup(u.formaID+"-shapes",new _.PGMNodeMetadata(u.formaID,"group"),f.PGMAnimationList.EMPTY,F),m.PGMCompositingParams.smartInit(u.placement)))),null!=I&&(y=s.FormaToPGMUtils.applyAnimations(e,u,new T.PGMReference(new C.PGMSimpleGroup(u.formaID+"-bottomTexts",new _.PGMNodeMetadata(u.formaID,"group"),f.PGMAnimationList.EMPTY,I),m.PGMCompositingParams.smartInit(u.placement)))),null!=b&&(E=s.FormaToPGMUtils.applyAnimations(e,u,new T.PGMReference(new C.PGMSimpleGroup(u.formaID+"-texts",new _.PGMNodeMetadata(u.formaID,"group"),f.PGMAnimationList.EMPTY,b),m.PGMCompositingParams.smartInit(u.placement,u.style.opacity)))),null!=O&&(R=s.FormaToPGMUtils.applyAnimations(e,u,new T.PGMReference(new C.PGMSimpleGroup(u.formaID+"-knockouts",new _.PGMNodeMetadata(u.formaID,"group"),f.PGMAnimationList.EMPTY,O),m.PGMCompositingParams.smartInit(u.placement))))}else if(h=a.as(i,A.TextForma)){r+=1;var k=h.textLook,M=h.fontStrokeWidth,N=new m.PGMCompositingParams(h.placement,h.style.opacity);switch(c.LegacyCoreAssert.isTrue(!d.LockupStyle.isKnockoutLook(k)||k==d.LockupTextLook.KnockoutAndFill||k==d.LockupTextLook.KnockoutAndShadow||a.eq(v._equality_SolidColor_SolidColor,h.fontColor,v.SolidColor.BLACK),"did not set the fill color to black for knockout looks that don't fill",void 0,"TypeLockupToPGMMapper.getPGMForTypeLockup","TypeLockupToPGMMapper.swift",192),k){case 0:var L=D.TextFormaToPGMMapper.getPGMNodeForTextForma(e,h,n+"-txt#"+r);if(E=new T.PGMReference(L,N),e.asDynamic){var x=s.FormaToPGMUtils.createAnimations(E,h);E=E.withAnimations(x)}break;case 1:R=s.FormaToPGMUtils.applyAnimations(e,h,new T.PGMReference(D.TextFormaToPGMMapper.getPGMNodeForTextForma(e,h,n+"-txt#"+r),N));break;case 2:case 6:R=s.FormaToPGMUtils.applyAnimations(e,h,new T.PGMReference(D.TextFormaToPGMMapper.getPGMNodeForTextForma(e,h,n+"-txt-ko#"+r,v.SolidColor.BLACK),N)),E=s.FormaToPGMUtils.applyAnimations(e,h,new T.PGMReference(D.TextFormaToPGMMapper.getPGMNodeForTextForma(e,h,n+"-txt-fg#"+r),N));break;case 9:M>0?y=s.FormaToPGMUtils.applyAnimations(e,h,new T.PGMReference(D.TextFormaToPGMMapper.getPGMNodeForTextForma(e,h,n+"-txt-bg#"+r),N)):R=s.FormaToPGMUtils.applyAnimations(e,h,new T.PGMReference(D.TextFormaToPGMMapper.getPGMNodeForTextForma(e,h,n+"-txt-ko#"+r),N));break;default:E=s.FormaToPGMUtils.applyAnimations(e,h,new T.PGMReference(D.TextFormaToPGMMapper.getPGMNodeForTextForma(e,h,n+"-txt#"+r),N))}}else(p=a.as(i,P.ShapeForma))&&(o+=1,g=s.FormaToPGMUtils.applyAnimations(e,p,S.ShapeFormaToPGMMapper.makePGMRefForShape(e,p,n+"-shp#"+o)));return{shapeRef:g,bottomTextRef:y,textRef:E,knockoutRef:R}}(t),u=i.shapeRef,E=i.bottomTextRef,R=i.textRef,F=i.knockoutRef,I=a.clone(a.opt(a.as(a.opt(u,(function(e){return e.child})),C.PGMSimpleGroup),(function(e){return e.children}))),b=a.clone(a.opt(a.as(a.opt(E,(function(e){return e.child})),C.PGMSimpleGroup),(function(e){return e.children}))),O=a.clone(a.opt(a.as(a.opt(R,(function(e){return e.child})),C.PGMSimpleGroup),(function(e){return e.children}))),k=a.clone(a.opt(a.as(a.opt(F,(function(e){return e.child})),C.PGMSimpleGroup),(function(e){return e.children})));if(null!=k&&null!=I){var M=new C.PGMSimpleGroup(n+"-mask",new _.PGMNodeMetadata(t.formaID,"mask"),f.PGMAnimationList.EMPTY,k),N=new C.PGMSimpleGroup(n+"-art",new _.PGMNodeMetadata(t.formaID,"art"),f.PGMAnimationList.EMPTY,I);if(null!=O||null!=b){var L=[];null!=b&&L.push(new T.PGMReference(new C.PGMSimpleGroup(n+"-bg",new _.PGMNodeMetadata(t.formaID,"text-on-bottom-of-knockout"),f.PGMAnimationList.EMPTY,b))),L.push(new T.PGMReference(new g.PGMFilter(n+"-ko",new _.PGMNodeMetadata(t.formaID,"shape-knocked-out-by-text"),f.PGMAnimationList.EMPTY,[new T.PGMReference(N),new T.PGMReference(M)],new y.PGMMaskFilterSpec(v.SolidColor.WHITE))));var x=[],B=m.PGMCompositingParams.smartInit(h.Matrix2D.Identity,p.OpacityFacade.getShapeOpacityForForma(t));return x.push(new T.PGMReference(new C.PGMSimpleGroup(n+"-ssg",new _.PGMNodeMetadata(t.formaID,"shape-shadow-group-on-knockout"),f.PGMAnimationList.EMPTY,L),B)),null!=O&&x.push(new T.PGMReference(new C.PGMSimpleGroup(n+"-fg",new _.PGMNodeMetadata(t.formaID,"text-on-top-of-knockout"),f.PGMAnimationList.EMPTY,O))),new C.PGMSimpleGroup(n,new _.PGMNodeMetadata(t.formaID,"lockup-sandwich"),f.PGMAnimationList.EMPTY,x)}var w=[];return w.push(new T.PGMReference(new C.PGMSimpleGroup(n+"-sg",new _.PGMNodeMetadata(t.formaID,"simple-shape-group"),f.PGMAnimationList.EMPTY,I),m.PGMCompositingParams.smartInit(h.Matrix2D.Identity,p.OpacityFacade.getShapeOpacityForForma(t)))),N=new C.PGMSimpleGroup(n+"-art",new _.PGMNodeMetadata(t.formaID,"art"),f.PGMAnimationList.EMPTY,w),new g.PGMFilter(n,new _.PGMNodeMetadata(t.formaID,"simple-text-knockout"),f.PGMAnimationList.EMPTY,[new T.PGMReference(N),new T.PGMReference(M)],new y.PGMMaskFilterSpec(v.SolidColor.WHITE))}var G=[];return null!=I&&G.push(new T.PGMReference(new C.PGMSimpleGroup(n+"-sg",new _.PGMNodeMetadata(t.formaID,"simple-shape-group"),f.PGMAnimationList.EMPTY,I),m.PGMCompositingParams.smartInit(h.Matrix2D.Identity,p.OpacityFacade.getShapeOpacityForForma(t)))),null!=O&&(G=G.concat(O)),new C.PGMSimpleGroup(n,new _.PGMNodeMetadata(t.formaID,"simple-lockup"),f.PGMAnimationList.EMPTY,G)}},props:{makePGMRef:function(e,t,n,o){var a=i.FormaToPGMMapper.mapBlendMode(e);return s.FormaToPGMUtils.applyAnimations(t,e,new T.PGMReference(r.getPGMForTypeLockup(t,e,e.formaID),new m.PGMCompositingParams(e.placement,e.style.opacity,a)))},canDoSimpleTransformUpdate:function(e){return!r.usesPageAnchoredStyle(e.forma)}}}),r)},Qlvz:function(e,t,n){var r,o=t,a=n("oAGj"),i=n("fNpk");o.ImageAdjustments=(r=function e(t,n,r,o,a,i,s,l,u,c,d,h){void 0===t&&(t=0),void 0===n&&(n=0),void 0===r&&(r=0),void 0===o&&(o=0),void 0===a&&(a=0),void 0===i&&(i=0),void 0===s&&(s=0),void 0===l&&(l=0),void 0===u&&(u=0),void 0===c&&(c=0),void 0===d&&(d=0),void 0===h&&(h=0),this.name=e.NAME,this.blur_=t,this.sharpness_=n,this.contrast_=l,this.saturation_=a,this.brightness_=i,this.exposure_=s,this.contrast_=l,this.shadows_=r,this.highlights_=o,this.warmth_=u,this.tint_=c,this.fade_=d,this.vibrance_=h},a.defineClass({name:"ImageAdjustments",ctor:r,superName:"CoreObject",statics:{NAME:{get:function(){return"ImageAdjustments"}},PROPERTY_NAME:"name",PROPERTY_BLUR:"blur",PROPERTY_SHARPNESS:"sharpness",PROPERTY_SHADOWS:"shadows",PROPERTY_HIGHLIGHTS:"highlights",PROPERTY_SATURATION:"saturation",PROPERTY_BRIGHTNESS:"brightness",PROPERTY_EXPOSURE:"exposure",PROPERTY_CONTRAST:"contrast",PROPERTY_WARMTH:"warmth",PROPERTY_TINT:"tint",PROPERTY_FADE:"fade",PROPERTY_VIBRANCE:"vibrance",createDefault:function(){return new r(0,0,0,0,0,0,0,0,0,0,0,0)},decodeJson:function(e){if(null==e)return null;var t;if(t=a.as(e,["Dictionary","String","Any"])){var n=r.createDefault();return n.decodeFromJson(t),n}return i.LegacyCoreAssert.fail("ImageFilter.decodeJson: could not create style",void 0,"ImageAdjustments.decodeJson","ImageAdjustments.swift",222),null}},props:{blur:{get:function(){return this.blur_}},scaledBlur:{get:function(){return this.blur_/3}},sharpness:{get:function(){return this.sharpness_}},scaledSharpness:{get:function(){return this.sharpness_/3}},shadows:{get:function(){return this.shadows_}},highlights:{get:function(){return this.highlights_}},saturation:{get:function(){return this.saturation_}},brightness:{get:function(){return this.brightness_}},exposure:{get:function(){return this.exposure_}},contrast:{get:function(){return this.contrast_}},warmth:{get:function(){return this.warmth_}},tint:{get:function(){return this.tint_}},fade:{get:function(){return this.fade_}},vibrance:{get:function(){return this.vibrance_}},copyWithNewValues:function(e,t,n,o,a,i,s,l,u,c,d,h){var p,f,m,g,y,_,T,C,v,P,S,A;return void 0===e&&(e=null),void 0===t&&(t=null),void 0===n&&(n=null),void 0===o&&(o=null),void 0===a&&(a=null),void 0===i&&(i=null),void 0===s&&(s=null),void 0===l&&(l=null),void 0===u&&(u=null),void 0===c&&(c=null),void 0===d&&(d=null),void 0===h&&(h=null),new r((p=e)||null!=p?p:this.blur_,(f=t)||null!=f?f:this.sharpness_,(m=n)||null!=m?m:this.shadows_,(g=o)||null!=g?g:this.highlights_,(y=a)||null!=y?y:this.saturation_,(_=i)||null!=_?_:this.brightness_,(T=s)||null!=T?T:this.exposure_,(C=l)||null!=C?C:this.contrast_,(v=u)||null!=v?v:this.warmth_,(P=c)||null!=P?P:this.tint_,(S=d)||null!=S?S:this.fade_,(A=h)||null!=A?A:this.vibrance_)},copyWithNewValue:function(e,t){switch(t){case"blur":return this.copyWithNewValues(e);case"sharpness":return this.copyWithNewValues(void 0,e);case"shadows":return this.copyWithNewValues(void 0,void 0,e);case"highlights":return this.copyWithNewValues(void 0,void 0,void 0,e);case"saturation":return this.copyWithNewValues(void 0,void 0,void 0,void 0,e);case"brightness":return this.copyWithNewValues(void 0,void 0,void 0,void 0,void 0,e);case"exposure":return this.copyWithNewValues(void 0,void 0,void 0,void 0,void 0,void 0,e);case"contrast":return this.copyWithNewValues(void 0,void 0,void 0,void 0,void 0,void 0,void 0,e);case"warmth":return this.copyWithNewValues(void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,e);case"tint":return this.copyWithNewValues(void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,e);case"fade":return this.copyWithNewValues(void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,e);case"vibrance":return this.copyWithNewValues(void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,e);default:return this.copyWithNewValues()}},encodeJson:function(){var e={};return e[r.PROPERTY_NAME]=this.name,e[r.PROPERTY_BLUR]=this.blur_,e[r.PROPERTY_SHARPNESS]=this.sharpness_,e[r.PROPERTY_SHADOWS]=this.shadows_,e[r.PROPERTY_HIGHLIGHTS]=this.highlights_,e[r.PROPERTY_SATURATION]=this.saturation_,e[r.PROPERTY_BRIGHTNESS]=this.brightness_,e[r.PROPERTY_EXPOSURE]=this.exposure_,e[r.PROPERTY_CONTRAST]=this.contrast_,e[r.PROPERTY_WARMTH]=this.warmth_,e[r.PROPERTY_TINT]=this.tint_,e[r.PROPERTY_FADE]=this.fade_,e[r.PROPERTY_VIBRANCE]=this.vibrance_,e},decodeFromJson:function(e){var t,n,o,i,s,l,u,c,d,h,p,f,m;this.name=(t=a.as(e[r.PROPERTY_NAME],"String"))||null!=t?t:"",this.blur_=(n=a.as(e[r.PROPERTY_BLUR],"Double"))||null!=n?n:0,this.sharpness_=(o=a.as(e[r.PROPERTY_SHARPNESS],"Double"))||null!=o?o:0,this.shadows_=(i=a.as(e[r.PROPERTY_SHADOWS],"Double"))||null!=i?i:0,this.highlights_=(s=a.as(e[r.PROPERTY_HIGHLIGHTS],"Double"))||null!=s?s:0,this.saturation_=(l=a.as(e[r.PROPERTY_SATURATION],"Double"))||null!=l?l:0,this.brightness_=(u=a.as(e[r.PROPERTY_BRIGHTNESS],"Double"))||null!=u?u:0,this.exposure_=(c=a.as(e[r.PROPERTY_EXPOSURE],"Double"))||null!=c?c:0,this.contrast_=(d=a.as(e[r.PROPERTY_CONTRAST],"Double"))||null!=d?d:1,this.warmth_=(h=a.as(e[r.PROPERTY_WARMTH],"Double"))||null!=h?h:0,this.tint_=(p=a.as(e[r.PROPERTY_TINT],"Double"))||null!=p?p:0,this.fade_=(f=a.as(e[r.PROPERTY_FADE],"Double"))||null!=f?f:0,this.vibrance_=(m=a.as(e[r.PROPERTY_VIBRANCE],"Double"))||null!=m?m:0},clone:function(){return r.decodeJson(this.encodeJson())},equals:function(e){return this.blur==a.opt(e,(function(e){return e.blur}))&&this.sharpness==a.opt(e,(function(e){return e.sharpness}))&&this.shadows==a.opt(e,(function(e){return e.shadows}))&&this.highlights==a.opt(e,(function(e){return e.highlights}))&&this.saturation==a.opt(e,(function(e){return e.saturation}))&&this.brightness==a.opt(e,(function(e){return e.brightness}))&&this.exposure==a.opt(e,(function(e){return e.exposure}))&&this.contrast==a.opt(e,(function(e){return e.contrast}))&&this.warmth==a.opt(e,(function(e){return e.warmth}))&&this.tint==a.opt(e,(function(e){return e.tint}))&&this.fade==a.opt(e,(function(e){return e.fade}))&&this.vibrance==a.opt(e,(function(e){return e.vibrance}))},isDefault:function(){return 0==this.blur&&0==this.sharpness&&0==this.shadows&&0==this.highlights&&0==this.saturation&&0==this.brightness&&0==this.exposure&&0==this.contrast&&0==this.warmth&&0==this.tint&&0==this.fade&&0==this.vibrance},setEnabledKeys:function(e){0!=this.blur&&(e[r.PROPERTY_BLUR]=!0),0!=this.sharpness&&(e[r.PROPERTY_SHARPNESS]=!0),0!=this.shadows&&(e[r.PROPERTY_SHADOWS]=!0),0!=this.highlights&&(e[r.PROPERTY_HIGHLIGHTS]=!0),0!=this.saturation&&(e[r.PROPERTY_SATURATION]=!0),0!=this.brightness&&(e[r.PROPERTY_BRIGHTNESS]=!0),0!=this.exposure&&(e[r.PROPERTY_EXPOSURE]=!0),0!=this.contrast&&(e[r.PROPERTY_CONTRAST]=!0),0!=this.warmth&&(e[r.PROPERTY_WARMTH]=!0),0!=this.tint&&(e[r.PROPERTY_TINT]=!0),0!=this.vibrance&&(e[r.PROPERTY_VIBRANCE]=!0)},asString:{get:function(){return r.PROPERTY_BLUR+": "+this.blur+r.PROPERTY_SHARPNESS+": "+this.sharpness+r.PROPERTY_SHADOWS+": "+this.shadows+r.PROPERTY_HIGHLIGHTS+": "+this.highlights+r.PROPERTY_SATURATION+": "+this.saturation+r.PROPERTY_BRIGHTNESS+": "+this.brightness+r.PROPERTY_EXPOSURE+": "+this.exposure+r.PROPERTY_CONTRAST+": "+this.contrast+r.PROPERTY_WARMTH+": "+this.warmth+r.PROPERTY_TINT+": "+this.tint+r.PROPERTY_FADE+": "+this.fade+r.PROPERTY_VIBRANCE+": "+this.vibrance}}}}),r)},Quhx:function(e,t,n){var r,o,a=t,i=n("oAGj"),s=n("fVJ2"),l=n("MO6F");a.PostPublishingObject=(r=function(){this.publishing_=new l.TheoBasePublishing},i.defineClass({name:"PostPublishingObject",ctor:r,superName:"DBObject",statics:{_implements:function(e){return"IDBObject"==e||"TheoMessagePublisher"==e}},props:{init_3f7c:function(e){i.super_init(this,s.DBObject,s.DBObject.prototype.init_3f7c,e),this.publishing_.owner=this},init_866e:function(e,t){i.super_init(this,s.DBObject,s.DBObject.prototype.init_866e,e,t),this.publishing_.owner=this},init_dd5d:function(e,t){i.super_init(this,s.DBObject,s.DBObject.prototype.init_dd5d,e,t),this.publishing_.owner=this},init_11e0:function(e){i.super_init(this,s.DBObject,s.DBObject.prototype.init_11e0,e),this.publishing_.owner=this},init_3181:function(e,t,n){i.super_init(this,s.DBObject,s.DBObject.prototype.init_3181,e,t,n),this.publishing_.owner=this},init_5079:function(e,t,n,r){i.super_init(this,s.DBObject,s.DBObject.prototype.init_5079,e,t,n,r),this.publishing_.owner=this},init_9a09:function(e){i.super_init(this,s.DBObject,s.DBObject.prototype.init_67b3,e),this.publishing_.owner=this},subscribeWithCallback:function(e,t){return this.publishing_.subscribeWithCallback(e,t)},subscribe:function(e,t){return this.publishing_.subscribe(e,t)},unsubscribe:function(e){return this.publishing_.unsubscribe(e)},publish:function(e){this.publishing_.publish(e)}}}),r),a.PostDCXObject=(o=function(){},i.defineClass({name:"PostDCXObject",ctor:o,superName:"PostPublishingObject",statics:{PROPERTY_TYPE:"type",PROPERTY_PATH:"path",_implements:function(e){return"IDBObject"==e||"TheoMessagePublisher"==e}},props:{uuid:{get:function(){return this.id}},type:{get:function(){return i.as(this.get(o.PROPERTY_TYPE),"String")}},path:{get:function(){return i.as(this.get(o.PROPERTY_PATH),"String")}},init_3f7c:function(e){i.super_init(this,a.PostPublishingObject,a.PostPublishingObject.prototype.init_3f7c,e)},init_866e:function(e,t){i.super_init(this,a.PostPublishingObject,a.PostPublishingObject.prototype.init_866e,e,t)},init_dd5d:function(e,t){i.super_init(this,a.PostPublishingObject,a.PostPublishingObject.prototype.init_dd5d,e,t)},init_11e0:function(e){i.super_init(this,a.PostPublishingObject,a.PostPublishingObject.prototype.init_11e0,e)},init_3181:function(e,t,n){i.super_init(this,a.PostPublishingObject,a.PostPublishingObject.prototype.init_3181,e,t,n)},init_5079:function(e,t,n,r){i.super_init(this,a.PostPublishingObject,a.PostPublishingObject.prototype.init_5079,e,t,n,r)},init_9a09:function(e){i.super_init(this,a.PostPublishingObject,a.PostPublishingObject.prototype.init_9a09,e)}}}),o)},"R0Y+":function(e,t,n){var r,o,a,i=t,s=n("oAGj");i.SolidColorWithRole=(r=function(e,t){this.role=e,this.color=t},s.defineClass({name:"SolidColorWithRole",ctor:r}),r),i.TheoColorWithRole=(o=function(e,t){this.role=e,this.color=t},s.defineClass({name:"TheoColorWithRole",ctor:o}),o),i.ThemeColorWithRole=(a=function(e,t){this.role=e,this.color=t},s.defineClass({name:"ThemeColorWithRole",ctor:a}),a)},R19c:function(e,t,n){var r,o=t,a=n("oAGj"),i=n("gXiO"),s=n("s/Zj");o.MoaColorMatrix=(r=function(){i.CoreObject.call(this)},a.defineClass({name:"MoaColorMatrix",ctor:r,superName:"CoreObject",statics:{applyVibranceToColorMatrix:function(e,t){var n=Math.max(-100,Math.min(100,t)),o=n/100;r.MoaColorMatrixAdjustVibrance(e,o=n<0?1-o*o:1+1.8*o*o)},MoaColorMatrixAdjustVibrance:function(e,t){var n=1+.7*(t-1),o=t,i=45*Math.PI/180,l=35.26*Math.PI/180,u=s.MoaTransform.init_d41d();u.preRotateX(i),u.preRotateY(-l),u.preScaleXY(n,o),u.preRotateY(l),u.preRotateX(-i);for(var c=a.repeat(0,12),d=a.iter(a.range(0,11,!0));!d.done;d.next()){var h=d.value;c[h]=u.transformMatrix[h]}r.MoaColorMatrixMultiply(e,c)},applySaturationToColorMatrix:function(e,t){var n=Math.max(-100,Math.min(100,t)),o=n/100;r.MoaColorMatrixAdjSaturation(e,o=n<0?1-o*o:1+1.5*o*o)},MoaColorMatrixAdjSaturation:function(e,t){var n=.213*(1-t),o=.715*(1-t),a=.072*(1-t);r.MoaColorMatrixMultiply(e,[n+t,o,a,0,n,o+t,a,0,n,o,a+t,0])},MoaColorMatrixMultiply:function(e,t){var n=a.repeat(0,12);n[0]=e[0]*t[0]+e[1]*t[4]+e[2]*t[8],n[1]=e[0]*t[1]+e[1]*t[5]+e[2]*t[9],n[2]=e[0]*t[2]+e[1]*t[6]+e[2]*t[10],n[4]=e[4]*t[0]+e[5]*t[4]+e[6]*t[8],n[5]=e[4]*t[1]+e[5]*t[5]+e[6]*t[9],n[6]=e[4]*t[2]+e[5]*t[6]+e[6]*t[10],n[8]=e[8]*t[0]+e[9]*t[4]+e[10]*t[8],n[9]=e[8]*t[1]+e[9]*t[5]+e[10]*t[9],n[10]=e[8]*t[2]+e[9]*t[6]+e[10]*t[10],n[3]=e[0]*t[3]+e[1]*t[7]+e[2]*t[11]+e[3],n[7]=e[4]*t[3]+e[5]*t[7]+e[6]*t[11]+e[7],n[11]=e[8]*t[3]+e[9]*t[7]+e[10]*t[11]+e[11];for(var r=a.iter(a.range(0,11,!0));!r.done;r.next()){var o=r.value;e[o]=n[o]}}}}),r)},RBTN:function(e,t,n){var r,o=t,a=n("oAGj"),i=n("Bqrn");o.GridToPGMMapper=(r=function(){i.GroupFormaToPGMMapper.call(this)},a.defineClass({name:"GridToPGMMapper",ctor:r,superName:"GroupFormaToPGMMapper",props:{makePGMRef:function(e,t,n,r){return i.GroupFormaToPGMMapper.prototype.makePGMRef.call(this,e,t,n,r)}}}),r)},RO7T:function(e,t,n){var r,o=t,a=n("oAGj"),i=n("ytEx"),s=n("gXiO"),l=n("3OP7"),u=n("fNpk");o.BaseNodeDecoder=(r=function(e){this.branch_=e,s.CoreObject.call(this)},a.defineClass({name:"BaseNodeDecoder",ctor:r,superName:"CoreObject",statics:{_implements:function(e){return"IImportDataObject"==e}},props:{id:{get:function(){return a.as(this.getPropertyOnNode(i.PROPERTY_KEY_ID),"String")}},name:{get:function(){return a.as(this.getPropertyOnNode(i.PROPERTY_KEY_NAME),"String")}},type:{get:function(){return a.as(this.getPropertyOnNode(i.PROPERTY_KEY_TYPE),"String")}},path:{get:function(){return a.as(this.getPropertyOnNode(i.PROPERTY_KEY_PATH),"String")}},getPropertyOnNode:function(e){return u.LegacyCoreAssert.fail("must be overridden",void 0,"BaseNodeDecoder.getPropertyOnNode","BaseNodeDecoder.swift",35),null},optionalStringProperty:function(e){return a.as(this.property(e),"String")},stringProperty:function(e,t){var n;return(n=a.as(this.property(e),"String"))||null!=n?n:t},numberProperty:function(e,t){var n;return(n=a.as(this.property(e),"Double"))||null!=n?n:t},intProperty:function(e,t){var n;return(n=a.as(this.property(e),"Int"))||null!=n?n:t},booleanProperty:function(e,t){var n;return(n=a.as(this.property(e),"Bool"))||null!=n?n:t},optionalBooleanProperty:function(e){return a.as(this.property(e),"Bool")},property:function(e){var t=l.DocumentPersistenceFactory.namespacedPropertyName(e);return a.as(this.getPropertyOnNode(t),"AnyObject")},forEachChild:function(e){u.LegacyCoreAssert.fail("must be overridden",void 0,"BaseNodeDecoder.forEachChild","BaseNodeDecoder.swift",69)},forEachComponent:function(e){u.LegacyCoreAssert.fail("must be overridden",void 0,"BaseNodeDecoder.forEachComponent","BaseNodeDecoder.swift",73)}}}),r)},SAU6:function(e,t,n){var r,o=t,a=n("oAGj"),i=n("C654");o.MotionEntryStackedRoot=(r=function(){this.srcId="",this.logic=new i.MotionLogicStackedRoot,this.args={lineDur:.3,delay:.5,fadeInDur:.5,endPadDur:3.5}},a.defineClass({name:"MotionEntryStackedRoot",ctor:r,statics:{_implements:function(e){return"MotionEntry"==e}}}),r)},SDdr:function(e,t,n){var r,o,a=t,i=n("oAGj"),s=n("dJuF"),l=n("ZhwN"),u=n("Quhx");a.ImageFilter=(r=function(){},o={},i.defineClass({name:"ImageFilter",ctor:r,superName:"PostPublishingObject",statics:{SCHEMA_CLASS_NAME:{get:function(){return"ImageFilter"}},SCHEMA_ALL_TYPES_NAME:"ImageFilterTypes",codec:{get:function(){return void 0===o.codec&&(o.codec=s.DBPropertyCodec.registerCodec(r.SCHEMA_ALL_TYPES_NAME,s.DBPropertyCodec.directObjectCodec(r.SCHEMA_CLASS_NAME))),o.codec}},KIND:{get:function(){return"ImageFilter"}},PROPERTY_KIND:"kind",PROPERTY_NAME:"name",createDefault:function(){return r.init_37f0(void 0,r.KIND,{})},_implements:function(e){return"IDBObject"==e||"TheoMessagePublisher"==e}},props:{init_866e:function(e,t){i.super_init(this,u.PostPublishingObject,u.PostPublishingObject.prototype.init_866e,e,t)},init_dd5d:function(e,t){i.super_init(this,u.PostPublishingObject,u.PostPublishingObject.prototype.init_dd5d,e,t)},init_37f0:function(e,t,n){void 0===e&&(e="");var o=i.clone(n);o[r.PROPERTY_KIND]=t,o[r.PROPERTY_NAME]=e,i.super_init(this,u.PostPublishingObject,u.PostPublishingObject.prototype.init_dd5d,{},o)},clone:function(){return i.as(this.fork(l.GUIDUtils.makeGUID()),r)},className:{get:function(){return r.SCHEMA_CLASS_NAME}},kind:{get:function(){return this.get(r.PROPERTY_KIND)}},name:{get:function(){return this.get(r.PROPERTY_NAME)}},style:{get:function(){return this.style_},set:function(e){this.style_=e}},colors:{get:function(){return i.opt(this.style,(function(e){return e.colors}))}},equals:function(e){return this.name==i.opt(e,(function(e){return e.name}))},asString:{get:function(){return"Filter: "+this.name+" "+this.kind}}}}),r),a.AlphaBlendFilter=function(){var e=function(){},t={};return i.defineClass({name:"AlphaBlendFilter",ctor:e,superName:"ImageFilter",statics:{SCHEMA_CLASS_NAME:{get:function(){return"AlphaBlendFilter"}},PROPERTY_MIX:"mix",PROPERTY_FILTER_1:"filter1",PROPERTY_FILTER_2:"filter2",factory:{get:function(){return void 0===t.factory&&(t.factory=function(t,n,r,o){return e.init_866e(r,t)}),t.factory},set:function(e){t.factory=e}},createDefault:function(){return e.init_fa22(void 0,1,null,null)},KIND:{get:function(){return"AlphaBlend"}},_implements:function(e){return"IDBObject"==e||"TheoMessagePublisher"==e}},props:{init_866e:function(e,t){i.super_init(this,a.ImageFilter,a.ImageFilter.prototype.init_866e,e,t)},init_fa22:function(t,n,r,o){void 0===t&&(t="");var s={mix:n};null!=r&&(s[e.PROPERTY_FILTER_1]=r.clone()),null!=o&&(s[e.PROPERTY_FILTER_2]=o.clone()),i.super_init(this,a.ImageFilter,a.ImageFilter.prototype.init_37f0,t,e.KIND,s),null!=r&&i.opt(this.filter1,(function(e){return e.style=r.style})),null!=o&&i.opt(this.filter2,(function(e){return e.style=o.style}))},className:{get:function(){return e.SCHEMA_CLASS_NAME}},mix:{get:function(){var t;return(t=i.as(this.get(e.PROPERTY_MIX),"Double"))||null!=t?t:1},set:function(t){i.opt(this.style,(function(e){return e.notifyBefore()})),this.set(e.PROPERTY_MIX,t),i.opt(this.style,(function(e){return e.notifyAfter()}))}},filter1:{get:function(){return i.as(this.get(e.PROPERTY_FILTER_1),a.ImageFilter)},set:function(t){i.opt(this.style,(function(e){return e.notifyBefore()})),this.set(e.PROPERTY_FILTER_1,t),i.opt(this.style,(function(e){return e.notifyAfter()}))}},filter2:{get:function(){return i.as(this.get(e.PROPERTY_FILTER_2),a.ImageFilter)},set:function(t){i.opt(this.style,(function(e){return e.notifyBefore()})),this.set(e.PROPERTY_FILTER_2,t),i.opt(this.style,(function(e){return e.notifyAfter()}))}},equals:function(t){var n;return!!(n=i.as(t,e))&&(null==n.filter1&&null==this.filter1||null==n.filter2&&null==this.filter2?null!=n.filter1?n.filter1.equals(this.filter1):null==n.filter2||n.filter2.equals(this.filter2):!(null==n.filter1&&null!=this.filter1||null==n.filter2&&null!=this.filter2||null!=n.filter1&&null==this.filter1||null!=n.filter2&&null==this.filter2)&&(this.filter1.equals(n.filter1)&&this.filter2.equals(n.filter2)&&this.mix==n.mix))},asString:{get:function(){return a.ImageFilter._getters.asString.call(this)+" "+this.mix+" 1:["+(null!=this.filter1?this.filter1.asString:"nil")+"] 2:["+(null!=this.filter2?this.filter2.asString:"nil")+"]"}}}}),e}(),a.CompositeFilter=function(){var e=function(){},t={};return i.defineClass({name:"CompositeFilter",ctor:e,superName:"ImageFilter",statics:{SCHEMA_CLASS_NAME:{get:function(){return"CompositeFilter"}},PROPERTY_MIX:"mix",PROPERTY_BLEND:"blend",PROPERTY_GRAYSCALE:"grayscale",PROPERTY_CONTRAST:"contrast",PROPERTY_COLOR_OPERATION:"color-operation",PROPERTY_SATURATION_OFFSET:"saturation-offset",PROPERTY_BRIGHTNESS_OFFSET:"brightness-offset",PROPERTY_BLUR_RADIUS:"blur-radius",PROPERTY_REDUCE_CONTRAST:"reduce-contrast",factory:{get:function(){return void 0===t.factory&&(t.factory=function(t,n,r,o){return e.init_866e(r,t)}),t.factory},set:function(e){t.factory=e}},createDefault:function(){return e.init_514f(void 0,void 0,void 0,"")},KIND:{get:function(){return"CompositeFilter"}},_implements:function(e){return"IDBObject"==e||"TheoMessagePublisher"==e}},props:{init_866e:function(t,n){var r;i.super_init(this,a.ImageFilter,a.ImageFilter.prototype.init_866e,t,n),"duotone"==this.blend&&this.set(e.PROPERTY_BLEND,"normal"),((r=i.as(this.get(e.PROPERTY_REDUCE_CONTRAST),"Bool"))||null!=r)&&r&&this.set(e.PROPERTY_CONTRAST,.5)},init_514f:function(t,n,r,o,s,l,u,c,d,h){void 0===t&&(t=null),void 0===n&&(n=""),void 0===r&&(r=1),void 0===o&&(o="normal"),void 0===s&&(s=!1),void 0===l&&(l=1),void 0===u&&(u=null),void 0===c&&(c=0),void 0===d&&(d=0),void 0===h&&(h=0);var p={mix:r,blend:o,grayscale:s,contrast:l,"saturation-offset":c,"brightness-offset":d,"blur-radius":h};null!=u&&(p[e.PROPERTY_COLOR_OPERATION]=u),i.super_init(this,a.ImageFilter,a.ImageFilter.prototype.init_37f0,n,e.KIND,p),this.style=t},className:{get:function(){return e.SCHEMA_CLASS_NAME}},mix:{get:function(){var t;return(t=i.as(this.get(e.PROPERTY_MIX),"Double"))||null!=t?t:1},set:function(t){i.opt(this.style,(function(e){return e.notifyBefore()})),this.set(e.PROPERTY_MIX,t),i.opt(this.style,(function(e){return e.notifyAfter()}))}},blend:{get:function(){var t;return(t=i.as(this.get(e.PROPERTY_BLEND),"String"))||null!=t?t:"normal"},set:function(t){i.opt(this.style,(function(e){return e.notifyBefore()})),this.set(e.PROPERTY_BLEND,t),i.opt(this.style,(function(e){return e.notifyAfter()}))}},grayscale:{get:function(){var t;return!(!(t=i.as(this.get(e.PROPERTY_GRAYSCALE),"Bool"))&&null==t)&&t},set:function(t){i.opt(this.style,(function(e){return e.notifyBefore()})),this.set(e.PROPERTY_GRAYSCALE,t),i.opt(this.style,(function(e){return e.notifyAfter()}))}},contrast:{get:function(){var t;return(t=i.as(this.get(e.PROPERTY_CONTRAST),"Double"))||null!=t?t:1},set:function(t){i.opt(this.style,(function(e){return e.notifyBefore()})),this.set(e.PROPERTY_CONTRAST,t),i.opt(this.style,(function(e){return e.notifyAfter()}))}},blurRadius:{get:function(){var t;return(t=i.as(this.get(e.PROPERTY_BLUR_RADIUS),"Double"))||null!=t?t:0},set:function(t){i.opt(this.style,(function(e){return e.notifyBefore()})),this.set(e.PROPERTY_BLUR_RADIUS,t),i.opt(this.style,(function(e){return e.notifyAfter()}))}},colorOperation:{get:function(){var t;return(t=i.as(this.get(e.PROPERTY_COLOR_OPERATION),"String"))||null!=t?t:""}},saturation:{get:function(){var t;return i.toString((t=i.as(this.get(e.PROPERTY_SATURATION_OFFSET),"Double"))||null!=t?t:0)}},brightness:{get:function(){var t;return i.toString((t=i.as(this.get(e.PROPERTY_BRIGHTNESS_OFFSET),"Double"))||null!=t?t:0)}},equals:function(t){var n;return!!(n=i.as(t,e))&&(this.name==i.opt(t,(function(e){return e.name}))&&this.mix==n.mix&&this.blurRadius==n.blurRadius)},asString:{get:function(){return a.ImageFilter._getters.asString.call(this)+" "+this.mix+" blend:"+this.blend+" grayscale:"+this.grayscale+" contrast:"+this.contrast+" blurRadius:"+this.blurRadius+" colorOperation:"+this.colorOperation+" saturation:"+this.saturation+" brightness:"+this.brightness}}}}),e}()},SmK9:function(e,t,n){var r,o,a,i,s,l,u,c,d,h,p,f,m,g,y,_,T,C,v,P,S,A,D,E,R=t,F=n("oAGj"),I=n("fVJ2"),b=n("dJuF"),O=n("13MC"),k=n("iCxV"),M=n("3hwA"),N=n("fNpk"),L=n("9YN4");R.DBSchemaType=F.defineEnum("DBSchemaType",{UnknownType:"unknown",BooleanType:"boolean",NumberType:"number",IntegerType:"integer",StringType:"string",ObjectType:"object",ArrayType:"array"}),R.DBSchemaValue=(r=function(){},F.defineClass({name:"DBSchemaValue",ctor:r,statics:{fromBool:function(e){return r.init_4199(R.DBSchemaType.BooleanType,e,null)},fromDouble:function(e){return r.init_4199(R.DBSchemaType.NumberType,e,null)},fromInt:function(e){return r.init_4199(R.DBSchemaType.IntegerType,e,null)},fromString:function(e){return r.init_4199(R.DBSchemaType.StringType,e,null)},fromClass:function(e,t){return r.init_4199(R.DBSchemaType.ObjectType,t,e)},fromArray:function(e){return r.init_4199(R.DBSchemaType.ArrayType,e,null)},fromDict:function(e){return r.init_4199(R.DBSchemaType.ObjectType,e,null)},emptyValue:function(e){return r.init_4199(R.DBSchemaType.UnknownType,null,e)}},props:{init_4199:function(e,t,n){this.schemaType=e,this.value_=t,this.className_=n,this.isDefault_=!1},init_e1d9:function(e,t,n,r){this.schemaType=e,this.value_=t,this.className_=n,this.isDefault_=r},merge:function(e){if(null!=e&&e.schemaType!=R.DBSchemaType.UnknownType)if(N.LegacyCoreAssert.isTrue(this.schemaType==R.DBSchemaType.UnknownType||e.schemaType==this.schemaType,"Mismatched types in merge.",void 0,"DBSchemaValue.merge","DBSchema.swift",54),(this.schemaType==R.DBSchemaType.UnknownType||this.isDefault_)&&(this.isDefault_=e.isDefault_),null==this.className_&&(this.className_=e.className_),this.schemaType==R.DBSchemaType.ArrayType){if(null==this.value_)this.value_=e.value_;else if(null!=e.value_){var t=e.value_.concat(this.value_);this.value_=F.clone(t)}}else if(this.schemaType==R.DBSchemaType.ObjectType){if(null==this.value_)this.value_=e.value_;else if(null!=e.value_){for(var n={},r=F.iter(e.value_);!r.done;r.next()){var o=r.key,a=r.value;n[o]=a}for(var i=F.iter(this.value_);!i.done;i.next())o=i.key,a=i.value,n[o]=a;this.value_=F.clone(n)}}else null!=e.value_&&(this.value_=e.value_),this.schemaType==R.DBSchemaType.UnknownType&&(this.schemaType=e.schemaType)},property:function(e,t,n){var o=null;if(this.schemaType==R.DBSchemaType.ObjectType){for(var a={},i=F.as(F.opt(F.opt(F.as(this.value_,["Dictionary","String",r]),(function(e){return e[R.DBSchema.PROPERTY_ID]})),(function(e){return e.value_})),"String"),s=F.iter(this.value_);!s.done;s.next()){var l=s.key,u=s.value;null!=u.value_&&(a[l]=u.property(l,t,i))}if(null==this.className_||null==a[R.DBSchema.PROPERTY_ID])o=b.DBProperty.dictEncoded(b.DBNamePath.init_b14a(e),a,this.className_);else{for(var c=O.DBObjectMutableState.init_6f66(this.className_),d=a[R.DBSchema.PROPERTY_ID].stringValue,h=F.iter(a);!h.done;h.next()){var p=h.key,f=h.value;c.setProperty(p,f)}t.stageObjectState(d,this.className_,c),o=b.DBProperty.linkProperty(b.DBNamePath.init_b14a(e),d,t,this.className_,n)}}else switch(this.schemaType){case"boolean":o=b.DBProperty.boolEncoded(b.DBNamePath.init_b14a(e),this.value_,this.className_);break;case"integer":o=b.DBProperty.intEncoded(b.DBNamePath.init_b14a(e),this.value_,this.className_);break;case"number":o=b.DBProperty.doubleEncoded(b.DBNamePath.init_b14a(e),this.value_,this.className_);break;case"string":o=b.DBProperty.stringEncoded(b.DBNamePath.init_b14a(e),this.value_,this.className_);break;case"array":var m=F.toSequence(this.value_).map((function(e){return e.element.property(F.toString(e.offset),t,n)}),this);o=b.DBProperty.arrayEncoded(b.DBNamePath.init_b14a(e),m,this.className_);break;default:o=null}return this.isDefault_&&F.opt(o,(function(e){return e.shouldWrite=!1})),o},valuesEqual:function(e){return(this.schemaType==R.DBSchemaType.BooleanType||this.schemaType==R.DBSchemaType.IntegerType||this.schemaType==R.DBSchemaType.NumberType||this.schemaType==R.DBSchemaType.StringType)&&this.value_==e.value_},isEqual:function(e){var t;return!!(t=F.as(e,r))&&t.schemaType==this.schemaType&&t.isDefault_==this.isDefault_&&t.className_==this.className_&&this.valuesEqual(t)}}}),r),R.IDBValidationResult=F.defineProtocol("IDBValidationResult",{value:"DBSchemaValue"}),R.DBValidationResult=(o=function(){},a={},F.defineClass({name:"DBValidationResult",ctor:o,statics:{empty:{get:function(){return void 0===a.empty&&(a.empty=o.init_d41d()),a.empty}},_implements:function(e){return"IDBValidationResult"==e}},props:{init_2063:function(e){this.value=e},init_d41d:function(){this.value=null}}}),o),R.DBValidationError=(i=function(){},F.defineClass({name:"DBValidationError",ctor:i,statics:{_implements:function(e){return"IDBValidationResult"==e}},props:{value:{get:function(){return null}},error:{get:function(){return"Validation failed"}}}}),i),R.DBValidationErrorNotImplemented=(s=function(){R.DBValidationError.call(this)},F.defineClass({name:"DBValidationErrorNotImplemented",ctor:s,superName:"DBValidationError",statics:{_implements:function(e){return"IDBValidationResult"==e}},props:{error:{get:function(){return"Not implemented"}}}}),s),R.DBValidationErrorNoHost=(l=function(){R.DBValidationError.call(this)},F.defineClass({name:"DBValidationErrorNoHost",ctor:l,superName:"DBValidationError",statics:{_implements:function(e){return"IDBValidationResult"==e}},props:{error:{get:function(){return"No host object or host object state"}}}}),l),R.DBValidationErrorType=(u=function(e,t){this.value_=e,this.type_=t},F.defineClass({name:"DBValidationErrorType",ctor:u,superName:"DBValidationError",statics:{_implements:function(e){return"IDBValidationResult"==e}},props:{error:{get:function(){return null!=this.value_?this.value_+" is not of type "+this.type_:"value is nil"}}}}),u),R.DBValidationErrorConstantIntMismatch=(c=function(e,t){this.value_=e,this.constant_=t},F.defineClass({name:"DBValidationErrorConstantIntMismatch",ctor:c,superName:"DBValidationError",statics:{_implements:function(e){return"IDBValidationResult"==e}},props:{error:{get:function(){return this.value_+" != "+this.constant_}}}}),c),R.DBValidationErrorConstantStringMismatch=(d=function(e,t){this.value_=e,this.constant_=t},F.defineClass({name:"DBValidationErrorConstantStringMismatch",ctor:d,superName:"DBValidationError",statics:{_implements:function(e){return"IDBValidationResult"==e}},props:{error:{get:function(){return this.value_+" != "+this.constant_}}}}),d),R.DBValidationErrorIntEnumMismatch=(h=function(e,t){this.value_=e,this.enumeration_=F.clone(t)},F.defineClass({name:"DBValidationErrorIntEnumMismatch",ctor:h,superName:"DBValidationError",statics:{_implements:function(e){return"IDBValidationResult"==e}},props:{error:{get:function(){return this.value_+" not in "+this.enumeration_}}}}),h),R.DBValidationErrorStringEnumMismatch=(p=function(e,t){this.value_=e,this.enumeration_=F.clone(t)},F.defineClass({name:"DBValidationErrorStringEnumMismatch",ctor:p,superName:"DBValidationError",statics:{_implements:function(e){return"IDBValidationResult"==e}},props:{error:{get:function(){return this.value_+" not in "+this.enumeration_}}}}),p),R.DBValidationErrorLimit=(f=function(e,t,n,r){this.value_=e,this.limit_=t,this.less_=n,this.exclusive_=r},F.defineClass({name:"DBValidationErrorLimit",ctor:f,superName:"DBValidationError",statics:{_implements:function(e){return"IDBValidationResult"==e}},props:{comparator:{get:function(){return this.less_?this.exclusive_?"<":"<=":this.exclusive_?">":">="}},error:{get:function(){return this.value_+" "+this.comparator+" "+this.limit_}}}}),f),R.DBValidationErrorMultiple=(m=function(e,t){this.value_=e,this.factor_=t},F.defineClass({name:"DBValidationErrorMultiple",ctor:m,superName:"DBValidationError",statics:{_implements:function(e){return"IDBValidationResult"==e}},props:{error:{get:function(){return this.value_+" is not a multiple of "+this.factor_}}}}),m),R.DBValidationErrorLimitStringLength=(g=function(e,t,n){this.length_=e,this.limit_=t,this.less_=n},F.defineClass({name:"DBValidationErrorLimitStringLength",ctor:g,superName:"DBValidationError",statics:{_implements:function(e){return"IDBValidationResult"==e}},props:{comparator:{get:function(){return this.less_?"<":">"}},error:{get:function(){return"String length "+this.length_+" "+this.comparator+" "+this.limit_}}}}),g),R.DBValidationErrorStringPattern=(y=function(e,t){this.value_=e,this.pattern_=t},F.defineClass({name:"DBValidationErrorStringPattern",ctor:y,superName:"DBValidationError",statics:{_implements:function(e){return"IDBValidationResult"==e}},props:{error:{get:function(){return this.value_+" does not match pattern "+this.pattern_}}}}),y),R.DBValidationErrorLimitItems=(_=function(e,t,n){this.count_=e,this.limit_=t,this.less_=n},F.defineClass({name:"DBValidationErrorLimitItems",ctor:_,superName:"DBValidationError",statics:{_implements:function(e){return"IDBValidationResult"==e}},props:{comparator:{get:function(){return this.less_?"<":">"}},error:{get:function(){return"Item count "+this.count_+" "+this.comparator+" "+this.limit_}}}}),_),R.DBValidationErrorUniqueItems=(T=function(e){this.arrayValue_=F.clone(e)},F.defineClass({name:"DBValidationErrorUniqueItems",ctor:T,superName:"DBValidationError",statics:{_implements:function(e){return"IDBValidationResult"==e}},props:{error:{get:function(){return"Items "+this.arrayValue_+" not unique"}}}}),T),R.DBValidationErrorRequiredItem=(C=function(e){this.arrayValue_=F.clone(e)},F.defineClass({name:"DBValidationErrorRequiredItem",ctor:C,superName:"DBValidationError",statics:{_implements:function(e){return"IDBValidationResult"==e}},props:{error:{get:function(){return"Required item not found in "+this.arrayValue_}}}}),C),R.DBValidationErrorLimitProperties=(v=function(e,t,n){this.count_=e,this.limit_=t,this.less_=n},F.defineClass({name:"DBValidationErrorLimitProperties",ctor:v,superName:"DBValidationError",statics:{_implements:function(e){return"IDBValidationResult"==e}},props:{comparator:{get:function(){return this.less_?"<":">"}},error:{get:function(){return"Property count "+this.count_+" "+this.comparator+" "+this.limit_}}}}),v),R.DBValidationErrorRequiredProperty=(P=function(e,t){this.value_=e,this.propertyName_=t},F.defineClass({name:"DBValidationErrorRequiredProperty",ctor:P,superName:"DBValidationError",statics:{_implements:function(e){return"IDBValidationResult"==e}},props:{error:{get:function(){return"Required property "+this.propertyName_+" not found in "+this.value_}}}}),P),R.DBValidationErrorPropertyError=(S=function(e,t,n){var r;this.propertyError_=e,this.propertyName_=t,this.className_=(r=n)||null!=r?r:""},F.defineClass({name:"DBValidationErrorPropertyError",ctor:S,superName:"DBValidationError",statics:{_implements:function(e){return"IDBValidationResult"==e}},props:{error:{get:function(){return this.className_+"."+this.propertyName_+" does not match schema rule: "+this.propertyError_.error}}}}),S),R.DBValidationErrorCompound=(A=function(e){this.errors_=F.clone(e)},F.defineClass({name:"DBValidationErrorCompound",ctor:A,superName:"DBValidationError",statics:{_implements:function(e){return"IDBValidationResult"==e}},props:{error:{get:function(){return this.errors_.reduce((function(e,t){return e+".."+t.error+"\n"}),"Validation failed:\n")}}}}),A),R.DBValidationErrorMultipleMatches=(D=function(e,t){this.matches_=F.clone(e),this.errors_=F.clone(t)},F.defineClass({name:"DBValidationErrorMultipleMatches",ctor:D,superName:"DBValidationError",statics:{_implements:function(e){return"IDBValidationResult"==e}},props:{error:{get:function(){for(var e=this.matches_.length+" rules match:\n",t=F.iter(this.errors_);!t.done;t.next())e+=".."+t.value+"\n";return e}}}}),D),R.DBValidationErrorNegation=(E=function(){R.DBValidationError.call(this)},F.defineClass({name:"DBValidationErrorNegation",ctor:E,superName:"DBValidationError",statics:{_implements:function(e){return"IDBValidationResult"==e}},props:{error:{get:function(){return"Validation passed (negation failed)"}}}}),E),R.Rule=function(){var e=function e(t,n,r){var o=this;this.rawSchema_=F.clone(t),this.filename_=n,this.pathToObject_=r,this._ref=F.as(this.rawSchema_[e._REF],"String"),this._refsResolved=!1,this._schema=F.as(this.rawSchema_[e._SCHEMA],"String"),this._id=F.as(this.rawSchema_[e._ID],"String"),this._comment=F.as(this.rawSchema_[e._COMMENT],"String"),this.title=F.as(this.rawSchema_[e.TITLE],"String"),this.description=F.as(this.rawSchema_[e.DESCRIPTION],"String"),this.dependencies=e.fromJSON(F.as(this.rawSchema_[e.DEPENDENCIES],["Dictionary","String","Any"]),n,r+"/"+e.DEPENDENCIES),this.definitions=F.clone(e.fromDefinitions(F.as(this.rawSchema_[e.DEFINITIONS],["Dictionary","String",["Dictionary","String","Any"]]),n,r+"/"+e.DEFINITIONS)),this.typeArray=F.clone(e.typesFromSchema(t)),this.defaultValue=this.rawSchema_[e.DEFAULT],this.readOnly=F.as(this.rawSchema_[e.READ_ONLY],"Bool"),this.examples=F.clone(F.as(this.rawSchema_[e.EXAMPLES],["Array","Any"])),this.multipleOf=F.as(this.rawSchema_[e.MULTIPLE_OF],"Double"),this.maximum=F.as(this.rawSchema_[e.MAXIMUM],"Double"),this.exclusiveMaximum=F.as(this.rawSchema_[e.EXCLUSIVE_MAXIMUM],"Double"),this.minimum=F.as(this.rawSchema_[e.MINIMUM],"Double"),this.exclusiveMinimum=F.as(this.rawSchema_[e.EXCLUSIVE_MINIMUM],"Double"),this.maxLength=F.as(this.rawSchema_[e.MAX_LENGTH],"Int"),this.minLength=F.as(this.rawSchema_[e.MIN_LENGTH],"Int"),this.pattern=F.as(this.rawSchema_[e.PATTERN],"String"),this.tupleItems=F.clone(F.opt(F.as(this.rawSchema_[e.ITEMS],["Array",["Dictionary","String","Any"]]),(function(t){return t.map((function(t){return e.fromJSON(t,n,r+"/"+e.ITEMS)}),o)}))),this.items=null==this.tupleItems?e.fromJSON(F.as(this.rawSchema_[e.ITEMS],["Dictionary","String","Any"]),n,r+"/"+e.ITEMS):null,this.additionalItems=e.fromJSON(F.as(this.rawSchema_[e.ADDITIONAL_ITEMS],["Dictionary","String","Any"]),n,r+"/"+e.ADDITIONAL_ITEMS),this.maxItems=F.as(this.rawSchema_[e.MAX_ITEMS],"Int"),this.minItems=F.as(this.rawSchema_[e.MIN_ITEMS],"Int"),this.uniqueItems=F.as(this.rawSchema_[e.UNIQUE_ITEMS],"Bool"),this.contains=e.fromJSON(F.as(this.rawSchema_[e.CONTAINS],["Dictionary","String","Any"]),n,r+"/"+e.CONTAINS),this.properties=F.clone(e.fromDefinitions(F.as(this.rawSchema_[e.PROPERTIES],["Dictionary","String",["Dictionary","String","Any"]]),n,r+"/"+e.PROPERTIES)),this.maxProperties=F.as(this.rawSchema_[e.MAX_PROPERTIES],"Int"),this.minProperties=F.as(this.rawSchema_[e.MIN_PROPERTIES],"Int"),this.requiredProperties=F.clone(F.as(this.rawSchema_[e.REQUIRED],["Array","String"])),this.additionalProperties=e.fromJSON(F.as(this.rawSchema_[e.ADDITIONAL_PROPERTIES],["Dictionary","String","Any"]),n,r+"/"+e.ADDITIONAL_PROPERTIES),this.patternProperties=F.clone(e.fromDefinitions(F.as(this.rawSchema_[e.PATTERN_PROPERTIES],["Dictionary","String",["Dictionary","String","Any"]]),n,r+"/"+e.PATTERN_PROPERTIES)),this.propertyNames=e.fromJSON(F.as(this.rawSchema_[e.PROPERTY_NAMES],["Dictionary","String","Any"]),n,r+"/"+e.PROPERTY_NAMES),this.constant=this.rawSchema_[e.CONST],this.enumeration=F.clone(F.as(this.rawSchema_[e.ENUM],["Array","Any"])),this.format=F.as(this.rawSchema_[e.FORMAT],"String"),this.contentMediaType=F.as(this.rawSchema_[e.CONTENT_MEDIA_TYPE],"String"),this.contentEncoding=F.as(this.rawSchema_[e.CONTENT_ENCODING],"String"),this.ifRule=e.fromJSON(F.as(this.rawSchema_[e.IF],["Dictionary","String","Any"]),n,r+"/"+e.IF),this.thenRule=e.fromJSON(F.as(this.rawSchema_[e.THEN],["Dictionary","String","Any"]),n,r+"/"+e.THEN),this.elseRule=e.fromJSON(F.as(this.rawSchema_[e.ELSE],["Dictionary","String","Any"]),n,r+"/"+e.ELSE),this.allOf=F.clone(F.opt(F.as(this.rawSchema_[e.ALL_OF],["Array",["Dictionary","String","Any"]]),(function(t){return t.map((function(t){return e.fromJSON(t,n,r+"/"+e.ALL_OF)}),o)}))),this.anyOf=F.clone(F.opt(F.as(this.rawSchema_[e.ANY_OF],["Array",["Dictionary","String","Any"]]),(function(t){return t.map((function(t){return e.fromJSON(t,n,r+"/"+e.ANY_OF)}),o)}))),this.oneOf=F.clone(F.opt(F.as(this.rawSchema_[e.ONE_OF],["Array",["Dictionary","String","Any"]]),(function(t){return t.map((function(t){return e.fromJSON(t,n,r+"/"+e.ONE_OF)}),o)}))),this.notRule=e.fromJSON(F.as(this.rawSchema_[e.NOT],["Dictionary","String","Any"]),n,r+"/"+e.NOT),this.className=F.as(this.rawSchema_[e.CLASS_NAME],"String"),this.manifestProperties=F.clone(F.as(this.rawSchema_[e.MANINFEST_PROPERTIES],["Array","String"])),this.readData=F.as(this.rawSchema_[e.READ_DATA],"Bool"),this.reified_=!1,this.simplified_=!1},t={};return F.defineClass({name:"Rule",ctor:e,statics:{_SCHEMA:{get:function(){return void 0===t._SCHEMA&&(t._SCHEMA="$schema"),t._SCHEMA}},_ID:{get:function(){return void 0===t._ID&&(t._ID="$id"),t._ID}},_REF:{get:function(){return void 0===t._REF&&(t._REF="$ref"),t._REF}},_COMMENT:{get:function(){return void 0===t._COMMENT&&(t._COMMENT="$comment"),t._COMMENT}},TITLE:"title",DESCRIPTION:"description",DEFINITIONS:"definitions",DEPENDENCIES:"dependencies",TYPE:"type",DEFAULT:"default",READ_ONLY:"readOnly",EXAMPLES:"examples",MULTIPLE_OF:"multipleOf",MAXIMUM:"maximum",EXCLUSIVE_MAXIMUM:"exclusiveMaximum",MINIMUM:"minimum",EXCLUSIVE_MINIMUM:"exclusiveMinimum",MAX_LENGTH:"maxLength",MIN_LENGTH:"minLength",PATTERN:"pattern",ITEMS:"items",ADDITIONAL_ITEMS:"additionalItems",MAX_ITEMS:"maxItems",MIN_ITEMS:"minItems",UNIQUE_ITEMS:"uniqueItems",CONTAINS:"contains",PROPERTIES:"properties",MAX_PROPERTIES:"maxProperties",MIN_PROPERTIES:"minProperties",REQUIRED:"required",ADDITIONAL_PROPERTIES:"additionalProperties",PATTERN_PROPERTIES:"patternProperties",PROPERTY_NAMES:"propertyNames",CONST:"const",ENUM:"enum",FORMAT:"format",CONTENT_MEDIA_TYPE:"contentMediaType",CONTENT_ENCODING:"contentEncoding",IF:"if",THEN:"then",ELSE:"else",ALL_OF:"allOf",ANY_OF:"anyOf",ONE_OF:"oneOf",NOT:"not",CLASS_NAME:"className",MANINFEST_PROPERTIES:"manifest-properties",READ_DATA:"read-data",rulesFromSchemata:function(t){for(var n={},r=F.iter(t);!r.done;r.next()){var o=r.key,a=r.value;n[o]=new e(a,o,o+"#")}return n},definitionsFromSchemata:function(t){var n=F.clone(e.rulesFromSchemata(t)),r=F.clone(n),o=null,a=null;a=function(t,n){var o;if(o=n.definitions)for(var i=F.iter(o);!i.done;i.next()){var s=i.key,l=i.value,u=t+"/"+s;l.definedName=s,r[u]=l,a(u+"/"+e.DEFINITIONS,l)}};for(var i=F.iter(n);!i.done;i.next()){var s=i.key,l=i.value;a(s+"#/"+e.DEFINITIONS,l)}o=function(e){return null!=e?(F.opt(r[e],(function(e){return e.resolveRefs(o)})),r[e]):null};for(var u=F.iter(r);!u.done;u.next()){(l=u.value).resolveRefs(o)}for(var c=F.iter(r);!c.done;c.next()){(l=c.value).reify()}for(var d=F.iter(r);!d.done;d.next()){(l=d.value).simplify()}return r},fromJSON:function(t,n,r){return null!=t?new e(t,n,r):null},fromDefinitions:function(t,n,r){if(null!=t){for(var o={},a=F.iter(t);!a.done;a.next()){var i=a.key,s=a.value;o[i]=new e(s,n,r+"/"+i)}return o}return null},typesFromSchema:function(t){var n,r,o;if(null!=(r=F.as(t[e.TYPE],"String"))){var a=R.DBSchemaType.toCaseValue(r);return null!=a?[a]:null}return(o=F.as(t[e.TYPE],["Array","String"]))?o.map((function(e){return(n=R.DBSchemaType.toCaseValue(e))||null!=n?n:R.DBSchemaType.UnknownType}),this):null}},props:{getRequiredProperties:function(){return this.requiredProperties},getPropertyRule:function(e){return F.opt(this.properties,(function(t){return t[e]}))},schemaType:{get:function(){var e;return(e=this.type)||null!=e?e:R.DBSchemaType.UnknownType}},schemaTypeName:{get:function(){var e;return(e=this.className)||null!=e?e:this.definedName}},reify:function(){var e=this,t=this.reifiedRule;if(!t.reified_){if(t.reified_=!0,t.dependencies=F.opt(t.dependencies,(function(e){return e.reify()})),t.items=F.opt(t.items,(function(e){return e.reify()})),t.additionalItems=F.opt(t.additionalItems,(function(e){return e.reify()})),t.contains=F.opt(t.contains,(function(e){return e.reify()})),t.additionalProperties=F.opt(t.additionalProperties,(function(e){return e.reify()})),t.propertyNames=F.opt(t.propertyNames,(function(e){return e.reify()})),t.ifRule=F.opt(t.ifRule,(function(e){return e.reify()})),t.thenRule=F.opt(t.thenRule,(function(e){return e.reify()})),t.elseRule=F.opt(t.elseRule,(function(e){return e.reify()})),t.notRule=F.opt(t.notRule,(function(e){return e.reify()})),t.tupleItems=F.clone(F.opt(t.tupleItems,(function(t){return t.map((function(e){return e.reify()}),e)}))),t.allOf=F.clone(F.opt(t.allOf,(function(t){return t.map((function(e){return e.reify()}),e)}))),t.anyOf=F.clone(F.opt(t.anyOf,(function(t){return t.map((function(e){return e.reify()}),e)}))),t.oneOf=F.clone(F.opt(t.oneOf,(function(t){return t.map((function(e){return e.reify()}),e)}))),null!=t.definitions)for(var n=F.iter(t.definitions);!n.done;n.next()){var r=n.key,o=n.value;t.definitions[r]=o.reify()}if(null!=t.properties)for(var a=F.iter(t.properties);!a.done;a.next()){r=a.key,o=a.value;t.properties[r]=o.reify()}if(null!=t.patternProperties)for(var i=F.iter(t.patternProperties);!i.done;i.next()){r=i.key,o=i.value;t.patternProperties[r]=o.reify()}}return t},simplify:function(){if(!this.simplified_){if(this.simplified_=!0,null!=this.allOf){for(;0==!this.allOf.length;)this.merge(this.allOf.pop());this.allOf=null}if(null==this.constant&&null!=this.enumeration&&1==this.enumeration.length&&(this.constant=this.enumeration[0]),null==this.type&&null!=this.typeArray&&1==this.typeArray.length&&(this.type=this.typeArray[0]),this.stringConstant=F.as(this.constant,"String"),this.intConstant=F.as(this.constant,"Int"),this.stringEnumeration=F.clone(F.as(this.enumeration,["Array","String"])),this.intEnumeration=F.clone(F.as(this.enumeration,["Array","Int"])),F.opt(this.dependencies,(function(e){return e.simplify()})),F.opt(this.items,(function(e){return e.simplify()})),F.opt(this.additionalItems,(function(e){return e.simplify()})),F.opt(this.contains,(function(e){return e.simplify()})),F.opt(this.additionalProperties,(function(e){return e.simplify()})),F.opt(this.propertyNames,(function(e){return e.simplify()})),F.opt(this.ifRule,(function(e){return e.simplify()})),F.opt(this.thenRule,(function(e){return e.simplify()})),F.opt(this.elseRule,(function(e){return e.simplify()})),F.opt(this.notRule,(function(e){return e.simplify()})),F.opt(this.tupleItems,(function(e){return e.forEach((function(e){return e.simplify()}))})),F.opt(this.allOf,(function(e){return e.forEach((function(e){return e.simplify()}))})),F.opt(this.anyOf,(function(e){return e.forEach((function(e){return e.simplify()}))})),F.opt(this.oneOf,(function(e){return e.forEach((function(e){return e.simplify()}))})),null!=this.definitions)for(var e=F.iter(this.definitions);!e.done;e.next()){e.value.simplify()}if(null!=this.properties)for(var t=F.iter(this.properties);!t.done;t.next()){t.value.simplify()}if(null!=this.patternProperties)for(var n=F.iter(this.patternProperties);!n.done;n.next()){n.value.simplify()}}},merge:function(t){var n,r,o,a,i,s,l,u,c,d,h,p,f,m,g,y,_,T,C,v,P,S,A;if(this._id=(n=this._id)||null!=n?n:t._id,this._comment=(r=this._comment)||null!=r?r:t._comment,this.title=(o=this.title)||null!=o?o:t.title,this.description=(a=this.description)||null!=a?a:t.description,this.typeArray=F.clone(this.typeArray||t.typeArray),this.defaultValue=(i=this.defaultValue)||null!=i?i:t.defaultValue,this.readOnly=(s=this.readOnly)||null!=s?s:t.readOnly,this.examples=F.clone(this.examples||t.examples),this.multipleOf=(l=this.multipleOf)||null!=l?l:t.multipleOf,this.maximum=(u=this.maximum)||null!=u?u:t.maximum,this.exclusiveMaximum=(c=this.exclusiveMaximum)||null!=c?c:t.exclusiveMaximum,this.minimum=(d=this.minimum)||null!=d?d:t.minimum,this.exclusiveMinimum=(h=this.exclusiveMinimum)||null!=h?h:t.exclusiveMinimum,this.maxLength=(p=this.maxLength)||null!=p?p:t.maxLength,this.minLength=(f=this.minLength)||null!=f?f:t.minLength,this.pattern=(m=this.pattern)||null!=m?m:t.pattern,this.tupleItems=F.clone(this.tupleItems||t.tupleItems),this.maxItems=(g=this.maxItems)||null!=g?g:t.maxItems,this.minItems=(y=this.minItems)||null!=y?y:t.minItems,this.uniqueItems=(_=this.uniqueItems)||null!=_?_:t.uniqueItems,this.contains=this.contains||t.contains,this.maxProperties=(T=this.maxProperties)||null!=T?T:t.maxProperties,this.minProperties=(C=this.minProperties)||null!=C?C:t.minProperties,this.additionalProperties=this.additionalProperties||t.additionalProperties,this.propertyNames=this.propertyNames||t.propertyNames,this.constant=(v=this.constant)||null!=v?v:t.constant,this.enumeration=F.clone(this.enumeration||t.enumeration),this.format=(P=this.format)||null!=P?P:t.format,this.contentMediaType=F.as(this.rawSchema_[e.CONTENT_MEDIA_TYPE],"String"),this.contentEncoding=F.as(this.rawSchema_[e.CONTENT_ENCODING],"String"),this.ifRule=this.ifRule||t.ifRule,this.thenRule=this.thenRule||t.thenRule,this.elseRule=this.elseRule||t.elseRule,this.className=(S=this.className)||null!=S?S:t.className,this.readData=(A=this.readData)||null!=A?A:t.readData,null!=t.dependencies&&(null==this.dependencies?this.dependencies=t.dependencies:F.opt(this.dependencies,(function(e){return e.merge(t.dependencies)}))),null!=t.definitions)if(null==this.definitions)this.definitions=F.clone(t.definitions);else for(var D=F.iter(t.definitions);!D.done;D.next()){var E=D.key,R=D.value;null==this.definitions[E]&&(this.definitions[E]=R)}if(null!=t.items&&(null==this.items?this.items=t.items:F.opt(this.items,(function(e){return e.merge(t.items)}))),null!=t.additionalItems&&(null==this.additionalItems?this.additionalItems=t.additionalItems:F.opt(this.additionalItems,(function(e){return e.merge(t.additionalItems)}))),null!=t.properties)if(null==this.properties)this.properties=F.clone(t.properties);else for(var I=F.iter(t.properties);!I.done;I.next()){var b=I.key,O=I.value;null==this.properties[b]&&(this.properties[b]=O)}if(null!=t.patternProperties)if(null==this.patternProperties)this.patternProperties=F.clone(t.patternProperties);else for(var k=F.iter(t.patternProperties);!k.done;k.next()){var M=k.key;O=k.value;null==this.patternProperties[M]&&(this.patternProperties[M]=O)}null!=t.notRule&&(null==this.notRule?this.notRule=t.notRule:F.opt(this.notRule,(function(e){return e.merge(t.notRule)}))),null!=t.allOf&&(null==this.allOf?this.allOf=F.clone(t.allOf):this.allOf=this.allOf.concat(t.allOf)),null!=t.anyOf&&(null==this.anyOf?this.anyOf=F.clone(t.anyOf):this.anyOf=this.anyOf.concat(t.anyOf)),null!=t.oneOf&&(null==this.oneOf?this.oneOf=F.clone(t.oneOf):this.oneOf=this.oneOf.concat(t.oneOf)),null!=t.manifestProperties&&(null==this.manifestProperties?this.manifestProperties=F.clone(t.manifestProperties):this.manifestProperties=F.clone(F.opt(this.manifestProperties,(function(e){return e.concat(t.manifestProperties)})))),null!=t.requiredProperties&&(null==this.requiredProperties?this.requiredProperties=F.clone(t.requiredProperties):this.requiredProperties=F.clone(F.opt(this.requiredProperties,(function(e){return e.concat(t.requiredProperties)}))))},resolveRefs:function(e){if(!this._refsResolved){if(this._refsResolved=!0,null!=this._ref){var t=this._ref.startsWith("#")?this.filename_+this._ref:this._ref;this._refRule=e(t)}if(F.opt(this.dependencies,(function(t){return t.resolveRefs(e)})),null!=this.definitions)for(var n=F.iter(this.definitions);!n.done;n.next()){n.value.resolveRefs(e)}if(F.opt(this.items,(function(t){return t.resolveRefs(e)})),F.opt(this.tupleItems,(function(t){return t.forEach((function(t){return t.resolveRefs(e)}))})),F.opt(this.additionalItems,(function(t){return t.resolveRefs(e)})),F.opt(this.contains,(function(t){return t.resolveRefs(e)})),null!=this.properties)for(var r=F.iter(this.properties);!r.done;r.next()){r.value.resolveRefs(e)}if(F.opt(this.additionalProperties,(function(t){return t.resolveRefs(e)})),null!=this.patternProperties)for(var o=F.iter(this.patternProperties);!o.done;o.next()){o.value.resolveRefs(e)}F.opt(this.propertyNames,(function(t){return t.resolveRefs(e)})),F.opt(this.ifRule,(function(t){return t.resolveRefs(e)})),F.opt(this.thenRule,(function(t){return t.resolveRefs(e)})),F.opt(this.elseRule,(function(t){return t.resolveRefs(e)})),F.opt(this.allOf,(function(t){return t.forEach((function(t){return t.resolveRefs(e)}))})),F.opt(this.anyOf,(function(t){return t.forEach((function(t){return t.resolveRefs(e)}))})),F.opt(this.oneOf,(function(t){return t.forEach((function(t){return t.resolveRefs(e)}))})),F.opt(this.notRule,(function(t){return t.resolveRefs(e)}))}},reifiedRule:{get:function(){return 1==F.count(this.rawSchema_)&&null!=this.rawSchema_[e._REF]&&this._refRule||this}},isValid:function(e){return null!=this.validate(e).value},validateProperty:function(e){if(e instanceof b.DBDeletedProperty)return R.DBValidationResult.empty;var t;if(t=F.as(e.objValue,I.DBObject)){var n=F.clone(t.state.allProperties);return n[R.DBSchema.PROPERTY_ID]=b.DBProperty.stringProperty(b.DBNamePath.init_b14a(R.DBSchema.PROPERTY_ID),t.id),this.validate(n)}return this.validate(e.value)},validate:function(e){var t,n,r=this;if(n=F.as(e,b.DBProperty))return this.validateProperty(n);if(null!=this._refRule)return this._refRule.validate(e);var o=null;if(null!=this.className&&(null==o?o=this.emptyClass(e).value:F.opt(o,(function(t){return t.merge(r.emptyClass(e).value)}))),null!=this.constant){var a,i=this.validateConstant(e);if(a=F.as(i,R.DBValidationError))return a;null==o?o=i.value:F.opt(o,(function(e){return e.merge(i.value)}))}else if(null!=this.enumeration){var s,l=this.validateEnumeration(e);if(s=F.as(l,R.DBValidationError))return s;null==o?o=l.value:F.opt(o,(function(e){return e.merge(l.value)}))}if(null!=this.type){var u,c,d=null;switch(this.type){case"boolean":d=this.validateBoolean(e);break;case"integer":d=this.validateInteger(e);break;case"number":d=this.validateNumber(e);break;case"string":d=this.validateString(e);break;case"array":d=this.validateArray(e);break;case"object":d=this.validateObject(e);break;case"unknown":return this.fail(e)}if(u=F.as(d,R.DBValidationError))return u;(c=F.opt(d,(function(e){return e.value})))&&(null==o?o=c:F.opt(o,(function(e){return e.merge(c)})))}else if(null!=this.typeArray){var h,p=this.validateTypes(e);if(h=F.as(p,R.DBValidationError))return h;null==o?o=p.value:F.opt(o,(function(e){return e.merge(p.value)}))}if(null!=this.anyOf||null!=this.oneOf||null!=this.ifRule&&null!=this.thenRule||null!=this.notRule){var f,m=this.validateCompounds(e);if(f=F.as(m,R.DBValidationError))return f;null==o?o=m.value:F.opt(o,(function(e){return e.merge(m.value)}))}return null!=this.defaultValue&&(null==o?o=this.validateDefault(e).value:F.opt(o,(function(t){return t.merge(r.validateDefault(e).value)}))),(!(t=this.readData)&&null==t||t)&&null!=o?R.DBValidationResult.init_2063(o):R.DBValidationResult.empty},fail:function(e){return new R.DBValidationError},pass:function(e){return R.DBValidationResult.init_2063(R.DBSchemaValue.init_4199(R.DBSchemaType.UnknownType,e,this.className))},emptyClass:function(e){return R.DBValidationResult.init_2063(R.DBSchemaValue.emptyValue(this.className))},validateDefault:function(e){var t;return null==e?R.DBValidationResult.init_2063(R.DBSchemaValue.init_e1d9((t=this.type)||null!=t?t:R.DBSchemaType.UnknownType,this.defaultValue,this.className,!0)):R.DBValidationResult.init_2063(R.DBSchemaValue.emptyValue(this.className))},validateConstant:function(e){var t,n,r,o;return null!=(t=this.intConstant)?null!=e?null!=(r=F.as(e,"Int"))?r==t?R.DBValidationResult.init_2063(R.DBSchemaValue.fromInt(r)):new R.DBValidationErrorConstantIntMismatch(r,t):new R.DBValidationErrorType(e,R.DBSchemaType.IntegerType):R.DBValidationResult.init_2063(R.DBSchemaValue.init_4199(R.DBSchemaType.IntegerType,null,null)):null!=(n=this.stringConstant)?null!=e?null!=(o=F.as(e,"String"))?o==n?R.DBValidationResult.init_2063(R.DBSchemaValue.fromString(o)):new R.DBValidationErrorConstantStringMismatch(o,n):new R.DBValidationErrorType(e,R.DBSchemaType.StringType):R.DBValidationResult.init_2063(R.DBSchemaValue.init_4199(R.DBSchemaType.StringType,null,null)):new R.DBValidationErrorNotImplemented},validateEnumeration:function(e){var t,n,r,o;return(t=this.intEnumeration)?null!=(r=F.as(e,"Int"))?t.includes(r)?R.DBValidationResult.init_2063(R.DBSchemaValue.fromInt(r)):new R.DBValidationErrorIntEnumMismatch(r,t):new R.DBValidationErrorType(e,R.DBSchemaType.IntegerType):(n=this.stringEnumeration)?null!=e?null!=(o=F.as(e,"String"))?n.includes(o)?R.DBValidationResult.init_2063(R.DBSchemaValue.fromString(o)):new R.DBValidationErrorStringEnumMismatch(o,n):new R.DBValidationErrorType(e,R.DBSchemaType.StringType):R.DBValidationResult.init_2063(R.DBSchemaValue.init_4199(R.DBSchemaType.StringType,null,null)):new R.DBValidationErrorNotImplemented},validateTypes:function(e){for(var t=[],n=F.iter(this.typeArray);!n.done;n.next()){var r,o=null;switch(n.value){case"boolean":o=this.validateBoolean(e);break;case"integer":o=this.validateInteger(e);break;case"number":o=this.validateNumber(e);break;case"string":o=this.validateString(e);break;case"array":o=this.validateArray(e);break;case"object":o=this.validateObject(e);break;case"unknown":t.push(this.fail(e))}if(F.opt(o,(function(e){return null!=e.value})))return o;(r=F.as(o,R.DBValidationError))&&t.push(r)}return new R.DBValidationErrorCompound(t)},validateBoolean:function(e){var t;return null!=e?null!=(t=F.as(e,"Bool"))?R.DBValidationResult.init_2063(R.DBSchemaValue.fromBool(t)):new R.DBValidationErrorType(e,R.DBSchemaType.BooleanType):R.DBValidationResult.init_2063(R.DBSchemaValue.init_4199(R.DBSchemaType.BooleanType,null,null))},validateInteger:function(e){if(null!=e){var t;if(null!=(t=F.as(e,"Int"))){if(null!=this.maximum&&F.toDouble(t)>this.maximum)return new R.DBValidationErrorLimit(t,this.maximum,!1,!1);if(null!=this.exclusiveMaximum&&F.toDouble(t)>=this.exclusiveMaximum)return new R.DBValidationErrorLimit(t,this.maximum,!1,!0);if(null!=this.minimum&&F.toDouble(t)<this.minimum)return new R.DBValidationErrorLimit(t,this.minimum,!0,!1);if(null!=this.exclusiveMinimum&&F.toDouble(t)<=this.exclusiveMinimum)return new R.DBValidationErrorLimit(t,this.minimum,!0,!0);var n;if(null!=(n=this.multipleOf)){var r=F.toDouble(t),o=r/n;if(o!=Math.floor(o))return new R.DBValidationErrorMultiple(r,n)}return R.DBValidationResult.init_2063(R.DBSchemaValue.fromInt(t))}return new R.DBValidationErrorType(e,R.DBSchemaType.IntegerType)}return R.DBValidationResult.init_2063(R.DBSchemaValue.init_4199(R.DBSchemaType.IntegerType,null,null))},validateNumber:function(e){if(null!=e){var t;if(null!=(t=F.as(e,"Double"))){if(null!=this.maximum&&t>this.maximum)return new R.DBValidationErrorLimit(t,this.maximum,!1,!1);if(null!=this.exclusiveMaximum&&t>=this.exclusiveMaximum)return new R.DBValidationErrorLimit(t,this.maximum,!1,!0);if(null!=this.minimum&&t<this.minimum)return new R.DBValidationErrorLimit(t,this.minimum,!0,!1);if(null!=this.exclusiveMinimum&&t<=this.exclusiveMinimum)return new R.DBValidationErrorLimit(t,this.minimum,!0,!0);var n;if(null!=(n=this.multipleOf)){var r=t/n;if(r!=Math.floor(r))return new R.DBValidationErrorMultiple(t,n)}return R.DBValidationResult.init_2063(R.DBSchemaValue.fromDouble(t))}return new R.DBValidationErrorType(e,R.DBSchemaType.NumberType)}return R.DBValidationResult.init_2063(R.DBSchemaValue.init_4199(R.DBSchemaType.NumberType,null,null))},validateString:function(e){var t,n=this;if(null!=e){var r;if(null!=(r=F.as(e,"String"))){if(null!=this.maxLength&&r.length>this.maxLength)return new R.DBValidationErrorLimitStringLength(r.length,this.maxLength,!1);if(null!=this.minLength&&r.length<this.minLength)return new R.DBValidationErrorLimitStringLength(r.length,this.minLength,!0);if(null!=this.pattern)if(!(!(t=F.opt(k.Host.schema,(function(e){return e.matches(r,n.pattern)})))&&null==t||t))return new R.DBValidationErrorStringPattern(r,this.pattern);return R.DBValidationResult.init_2063(R.DBSchemaValue.fromString(r))}return new R.DBValidationErrorType(e,R.DBSchemaType.StringType)}return R.DBValidationResult.init_2063(R.DBSchemaValue.init_4199(R.DBSchemaType.StringType,null,null))},validateArray:function(e){var t;if(null!=e){var n;if(n=F.as(e,["Array","Any"])){var r,o,a,i=[];if(null!=this.maxItems&&n.length>this.maxItems)return new R.DBValidationErrorLimitItems(n.length,this.maxItems,!1);if(null!=this.minItems&&n.length<this.minItems)return new R.DBValidationErrorLimitItems(n.length,this.minItems,!0);if(r=this.tupleItems)for(var s=F.iter(F.range(0,n.length,!1));!s.done;s.next()){var l=s.value;if(l>=r.length){var u;if(!(u=this.additionalItems))return new R.DBValidationErrorLimitItems(n.length,r.length,!1);var c=u.validate(n[l]);if(d=F.as(c,R.DBValidationError))return d;(m=c.value)&&i.push(m)}else{var d,h=r[l].validate(n[l]);if(d=F.as(h,R.DBValidationError))return d;(m=h.value)&&i.push(m)}}else if(o=this.items)for(var p=F.iter(n);!p.done;p.next()){var f,m,g=p.value,y=o.validate(g);if(f=F.as(y,R.DBValidationError))return f;(m=y.value)&&i.push(m)}if(((t=this.uniqueItems)||null!=t)&&t)for(var _=[],T=F.iter(i);!T.done;T.next()){e=T.value;if(_.filter((function(t){return e.isEqual(t)}),this).length>0)return new R.DBValidationErrorUniqueItems(n);_.push(e)}if(a=this.contains){for(var C=!1,v=F.iter(n);!v.done;v.next()){g=v.value;if(a.isValid(g)){C=!0;break}}if(!C)return new R.DBValidationErrorRequiredItem(n)}return R.DBValidationResult.init_2063(R.DBSchemaValue.fromArray(i))}return new R.DBValidationErrorType(e,R.DBSchemaType.ArrayType)}return R.DBValidationResult.init_2063(R.DBSchemaValue.init_4199(R.DBSchemaType.ArrayType,null,null))},validateObject:function(e){var t,n,r,o=this;if(null!=e){var a,i,s,l,u,c={};if(null!=this.maxProperties)if((a=F.as(e,["Dictionary","String","Any"]))&&F.count(a)>this.maxProperties)return new R.DBValidationErrorLimitProperties(F.count(a),this.maxProperties,!1);if(null!=this.minProperties)if((a=F.as(e,["Dictionary","String","Any"]))&&F.count(a)<this.minProperties)return new R.DBValidationErrorLimitProperties(F.count(a),this.minProperties,!0);if(b=this.requiredProperties)if(s=F.as(e,M.IImportDataObject))for(var d=F.iter(b);!d.done;d.next()){if((g=d.value)!=R.DBSchema.PROPERTY_ID&&g!=R.DBSchema.PROPERTY_TYPE&&g!=R.DBSchema.PROPERTY_NAME&&g!=R.DBSchema.PROPERTY_PATH&&null==s.property(g))return new R.DBValidationErrorRequiredProperty(s,g)}else if(F.is(e,M.IImportDataComponent))for(var h=F.iter(b);!h.done;h.next()){if((g=h.value)!=R.DBSchema.PROPERTY_ID&&g!=R.DBSchema.PROPERTY_NAME&&g!=R.DBSchema.PROPERTY_PATH&&g!=R.DBSchema.PROPERTY_MIME_TYPE&&g!=R.DBSchema.PROPERTY_ETAG&&g!=R.DBSchema.PROPERTY_URL)return new R.DBValidationErrorRequiredProperty(e,g)}else if(a=F.as(e,["Dictionary","String","Any"]))for(var p=F.iter(b);!p.done;p.next()){if(null==a[g=p.value])return new R.DBValidationErrorRequiredProperty(a,g)}else if(null!=e)return new R.DBValidationErrorType(e,R.DBSchemaType.ObjectType);if((i=this.propertyNames)&&(u=F.as(e,["Dictionary","String","Any"])))for(var f=F.iter(F.keys(u));!f.done;f.next()){var m,g=f.value,y=i.validate(g);if(m=F.as(y,R.DBValidationError))return m}if(s=F.as(e,M.IImportDataObject)){if(null!=this.properties){var _=[];(b=this.requiredProperties)&&(_=F.clone(b)),F.append(_,F.keys(this.properties).filter((function(e){return!(((t=F.opt(o.requiredProperties,(function(t){return t.includes(e)})))||null!=t)&&t)}),this));for(var T=F.iter(_);!T.done;T.next()){var C=T.value,v=this.properties[C],P=null;if(C==R.DBSchema.PROPERTY_ID)null!=(I=s.id)&&(P=v.validate(I));else if(C==R.DBSchema.PROPERTY_TYPE){null!=(I=s.type)&&(P=v.validate(I))}else if(C==R.DBSchema.PROPERTY_NAME){null!=(I=s.name)&&(P=v.validate(I))}else if(C==R.DBSchema.PROPERTY_PATH){null!=(I=s.path)&&(P=v.validate(I))}else if(C==R.DBSchema.PROPERTY_CHILDREN){var S=[];s.forEachChild((function(e,t){return S.splice(t,0,e)})),P=v.validate(S)}else if(C==R.DBSchema.PROPERTY_COMPONENTS){var A=[];s.forEachComponent((function(e,t){return A.splice(t,0,e)})),P=v.validate(A)}else if(null!=(e=s.property(C)))P=v.validate(e);else if(null!=v.defaultValue){null!=(L=v.validate(null)).value&&(P=L)}if(W=F.as(P,R.DBValidationError))return new R.DBValidationErrorPropertyError(W,C,this.className);(E=F.opt(P,(function(e){return e.value})))&&(c[C]=E)}}}else if(l=F.as(e,M.IImportDataComponent)){if(null!=this.properties){_=[];(b=this.requiredProperties)&&(_=F.clone(b)),F.append(_,F.keys(this.properties).filter((function(e){return!(((n=F.opt(o.requiredProperties,(function(t){return t.includes(e)})))||null!=n)&&n)}),this));for(var D=F.iter(_);!D.done;D.next()){var E;C=D.value,v=this.properties[C],P=null;if(C==R.DBSchema.PROPERTY_ID)null!=(I=l.id)&&(P=v.validate(I));else if(C==R.DBSchema.PROPERTY_NAME){null!=(I=l.name)&&(P=v.validate(I))}else if(C==R.DBSchema.PROPERTY_PATH){null!=(I=l.path)&&(P=v.validate(I))}else if(C==R.DBSchema.PROPERTY_MIME_TYPE){null!=(I=l.mimeType)&&(P=v.validate(I))}else if(C==R.DBSchema.PROPERTY_ETAG){null!=(I=l.etag)&&(P=v.validate(I))}else if(C==R.DBSchema.PROPERTY_URL){var I;null!=(I=l.url)&&(P=v.validate(I))}if(W=F.as(P,R.DBValidationError))return new R.DBValidationErrorPropertyError(W,C,this.className);(E=F.opt(P,(function(e){return e.value})))&&(c[C]=E)}}}else if(u=F.as(e,["Dictionary","String","Any"])){if(null!=this.properties){var b;if(b=this.requiredProperties)for(var O=F.iter(b);!O.done;O.next()){if(null==(e=u[g=O.value]))return new R.DBValidationErrorRequiredProperty(u,g);P=this.properties[g].validate(e);if(W=F.as(P,R.DBValidationError))return new R.DBValidationErrorPropertyError(W,g,this.className);(K=P.value)&&(c[g]=K)}for(var N=F.iter(this.properties);!N.done;N.next()){g=N.key,v=N.value;if(null==c[g])if(null!=(e=u[g])){P=v.validate(e);if(W=F.as(P,R.DBValidationError))return new R.DBValidationErrorPropertyError(W,g,this.className);(K=P.value)&&(c[g]=K)}else if(null!=v.defaultValue){var L,x;(x=(L=v.validate(null)).value)&&(c[g]=x)}}}var B;if(B=this.patternProperties)for(var w=F.iter(B);!w.done;w.next())for(var G=w.key,Y=(v=w.value,F.keys(u).filter((function(e){return null==c[e]&&!(!(r=F.opt(k.Host.schema,(function(t){return t.matches(e,G)})))&&null==r)&&r}),this)),U=F.iter(Y);!U.done;U.next()){C=U.value,P=v.validate(u[C]);if(W=F.as(P,R.DBValidationError))return new R.DBValidationErrorPropertyError(W,C,this.className);(K=P.value)&&(c[C]=K)}var V,j=F.keys(u).filter((function(e){return null==c[e]}),this);if(V=this.additionalProperties)for(var H=F.iter(j);!H.done;H.next()){var W,K;C=H.value,P=V.validate(u[C]);if(W=F.as(P,R.DBValidationError))return new R.DBValidationErrorPropertyError(W,C,this.className);(K=P.value)&&(c[C]=K)}}return R.DBValidationResult.init_2063(R.DBSchemaValue.fromDict(c))}return R.DBValidationResult.init_2063(R.DBSchemaValue.init_4199(R.DBSchemaType.ObjectType,null,null))},validateAnyOf:function(e,t){var n;if(n=t){for(var r=[],o=F.iter(n);!o.done;o.next()){var a,i=o.value.validate(e);if(!(a=F.as(i,R.DBValidationError)))return i;r.push(a)}return new R.DBValidationErrorCompound(r)}return new R.DBValidationError},validateOneOf:function(e,t){var n;if(n=t){for(var r=[],o=[],a=0,i=null,s=F.iter(n);!s.done;s.next()){var l,u=s.value,c=u.validate(e);if((l=F.as(c,R.DBValidationError))?r.push(l):(i=c,a+=1,o.push(u.pathToObject_)),a>1)break}return 1==a?i:new R.DBValidationErrorMultipleMatches(o,r)}return new R.DBValidationError},validateCompounds:function(e){var t,n;if(N.LegacyCoreAssert.isTrue(null==this.allOf,"Rules should be simplified before validation",void 0,"Rule.validateCompounds","DBSchema.swift",1668),t=this.anyOf)return this.validateAnyOf(e,t);if(n=this.oneOf)return this.validateAnyOf(e,n);if(null!=this.notRule){var r=!0;return this.notRule.validate(e)instanceof R.DBValidationError&&(r=!1),r?new R.DBValidationErrorNegation:R.DBValidationResult.init_2063(R.DBSchemaValue.emptyValue(this.className))}if(null!=this.ifRule&&null!=this.thenRule){if(!(this.ifRule.validate(e)instanceof R.DBValidationError))return this.thenRule.validate(e);if(null!=this.elseRule)return this.elseRule.validate(e)}return R.DBValidationResult.init_2063(R.DBSchemaValue.emptyValue(this.className))},codec:{get:function(){var e=null!=this.definedName?b.DBPropertyCodec.typeCodec(this.definedName):null;if(null==e){if(this.schemaType==R.DBSchemaType.BooleanType)e=b.DBPropertyCodec.boolCodec();else if(this.schemaType==R.DBSchemaType.IntegerType||null!=this.intConstant||null!=this.intEnumeration)e=b.DBPropertyCodec.intCodec();else if(this.schemaType==R.DBSchemaType.NumberType)e=b.DBPropertyCodec.doubleCodec();else if(this.schemaType==R.DBSchemaType.StringType||null!=this.stringConstant||null!=this.stringEnumeration)e=b.DBPropertyCodec.stringCodec();else if(this.schemaType==R.DBSchemaType.ArrayType){if(null!=this.tupleItems){var t=this.tupleItems.map((function(e){return e.codec}),this);null!=this.additionalItems&&t.push(this.additionalItems.codec),e=b.DBPropertyCodec.tupleCodec(t)}else if(null!=this.items){var n=this.items.codec;e=b.DBPropertyCodec.arrayCodec(n)}}else if(this.schemaType==R.DBSchemaType.ObjectType)if(null!=this.definedName&&F.opt(this.properties,(function(e){return null!=e.id})))e=b.DBPropertyCodec.objectCodec(this.definedName);else{var r={};if(null!=this.properties)for(var o=F.iter(this.properties);!o.done;o.next()){var a=o.key,i=o.value;r[a]=i.codec}e=b.DBPropertyCodec.dictionaryCodec(r)}N.LegacyCoreAssert.isTrue(null!=e,"Failed to generate a codec.",{rule:this},"Rule","DBSchema.swift",1737)}return e}},propertyCodecs:{get:function(){var e={};if(null!=this.properties)for(var t=F.iter(this.properties);!t.done;t.next()){var n=t.key,r=t.value;n==R.DBSchema.PROPERTY_CHILDREN?e[n]=b.DBPropertyCodec.arrayCodec(b.DBPropertyCodec.objectCodec()):e[n]=r.codec}return e}},propertyRules:{get:function(){return this.properties||{}}},getCodecChain:function(e,t){var n,r=[],o=F.clone(e),a=o.shift(),i=t.getProperty(a);if(a==R.DBSchema.PROPERTY_CHILDREN){var s=b.DBPropertyCodec.arrayCodec(b.DBPropertyCodec.objectCodec());null==i&&(i=b.DBProperty.arrayProperty(b.DBNamePath.init_b14a(a),[])),r.push([s,i]),N.LegacyCoreAssert.isTrue(0==o.length,"Need to figure out property chains for database links; objects with child-states should be direct objects",void 0,"Rule.getCodecChain","DBSchema.swift",1777)}else{var l;if(l=F.opt(this.properties,(function(e){return e[a]}))){var u=l,c=function(e,t,n){var o=e.codec,a=e.schemaType;null==(i=n())&&(i=a==R.DBSchemaType.ArrayType?b.DBProperty.arrayProperty(b.DBNamePath.init_b14a(t),[]):b.DBProperty.dictProperty(b.DBNamePath.init_b14a(t),{})),r.push([o,i]),u=e},d=function(e,t){var n=F.toInt(t);return null!=e&&e.isArray&&n<e.arrayPropertyCount?e.getArrayProperty(n):null};for(c(l,a,(function(){return i}));0==!o.length;){var h,p,f,m,g,y=u.schemaType,_=o.shift(),T=null;if(null!=(h=F.last(r))&&(T=h[1]),y==R.DBSchemaType.ArrayType)if(p=u.tupleItems){if(null!=(m=F.toInt(_)))m<p.length?c(p[m],_,(function(){return d(T,_)})):(g=u.additionalItems)&&c(g,_,(function(){return d(T,_)}))}else(f=u.items)&&c(f,_,(function(){return d(T,_)}));else if(y==R.DBSchemaType.ObjectType){var C,v;if(C=F.opt(u.properties,(function(e){return e[_]})))c(C,_,(function(){return F.opt(T,(function(e){return e.getDictionaryProperty(_)}))}));else if(v=u.patternProperties)for(var P=F.iter(v);!P.done;P.next()){var S=P.key,A=P.value;((n=F.opt(k.Host.schema,(function(e){return e.matches(_,S)})))||null!=n)&&n&&c(A,_,(function(){return F.opt(T,(function(e){return e.getDictionaryProperty(_)}))}))}}else N.LegacyCoreAssert.fail("Childless schema type in codec chain",{schemaType:y},"Rule.getCodecChain","DBSchema.swift",1839)}}}return r}}}),e}(),R.DBSchema=function(){var e=function(){this.propertyCodecs={}},t={};return F.defineClass({name:"DBSchema",ctor:e,statics:{schemaVersion:"http://json-schema.org/draft-04/schema",PROPERTY_ID:"id",PROPERTY_TYPE:"type",PROPERTY_NAME:"name",PROPERTY_PATH:"path",PROPERTY_CHILDREN:"children",PROPERTY_COMPONENTS:"components",PROPERTY_MIME_TYPE:"mimeType",PROPERTY_ETAG:"etag",PROPERTY_URL:"url",PROPERTY_REF:{get:function(){return void 0===t.PROPERTY_REF&&(t.PROPERTY_REF="$ref"),t.PROPERTY_REF}},currentSchema:{get:function(){return void 0===t.currentSchema&&(t.currentSchema=e.init_2af7(L.TheoDocument.CURRENT_VERSION)),t.currentSchema},set:function(e){t.currentSchema=e}},getPropertyRules:function(t){var n;return(n=e.currentSchema.rulesByName[t])?n.propertyRules:{}},getCodecChain:function(t,n){var r,o=[];return(r=e.currentSchema.rulesByName[n.className])&&(o=F.clone(r.getCodecChain(t,n))),o},getManifestProperties:function(t){return F.opt(e.currentSchema.rulesByName[t],(function(e){return e.manifestProperties}))},getValidator:function(t){var n=F.clone(e.getPropertyRules(t));return function(e){for(var t={},r=F.iter(n);!r.done;r.next()){var o,a=r.key,i=r.value;if((o=e.getProperty(a))&&o.shouldWrite){var s,l=i.validateProperty(o);if(s=F.as(l,R.DBValidationError))return s;t[a]=l.value}}return R.DBValidationResult.init_2063(R.DBSchemaValue.fromDict(t))}},getSerializer:function(t){var n=F.clone(e.getPropertyRules(t)),r=F.clone(e.getManifestProperties(t));return function(e,t){for(var o=F.iter(F.keys(n));!o.done;o.next()){var a=o.value;(s=e.getProperty(a))&&s.shouldWrite&&t(a,s,!1)}if(null!=r&&0==!r.length)for(var i=F.iter(r);!i.done;i.next()){var s;a=i.value;(s=e.getProperty(a))&&t(a,s,!0)}}},getArrayWriter:function(t,n,r){return function(o,a,i){var s,l;if(a.shouldWrite)if(null!=(s=a.className)&&(l=n.getObjectStateByID(a.linkID))){var u=e.getDictionaryWriter(m={},n,r);e.getSerializer(s)(l,u),t.push(m)}else switch(a.schemaType){case"boolean":var c;null!=(c=a.boolValue)&&t.push(c);break;case"integer":var d;null!=(d=a.intValue)&&t.push(d);break;case"number":var h;null!=(h=a.doubleValue)&&t.push(h);break;case"string":var p;null!=(p=a.stringValue)&&t.push(p);break;case"array":if(a.isArray){var f=[];u=e.getArrayWriter(f,n,r);a.forEachArrayProperty((function(e,t){return u("",t,!1)})),t.push(f)}break;case"object":if(a.isDictionary){var m;u=e.getDictionaryWriter(m={},n,r);a.forEachDictionaryProperty((function(e,t){return u(e,t,!1)})),t.push(m)}break;case"unknown":N.LegacyCoreAssert.fail("Cannot write a property of unknown type",void 0,"DBSchema.getArrayWriter","DBSchema.swift",2019)}}},getDictionaryWriter:function(t,n,r){return function(o,a,i){var s,l;if(a.shouldWrite)if(null!=(s=a.className)&&(l=n.getObjectStateByID(a.linkID))){var u=e.getDictionaryWriter(d={},n,r);e.getSerializer(s)(l,u),t[o]=d}else switch(a.schemaType){case"boolean":t[o]=a.boolValue;break;case"integer":t[o]=a.intValue;break;case"number":t[o]=a.doubleValue;break;case"string":t[o]=a.stringValue;break;case"array":if(a.isArray){var c=[];u=e.getArrayWriter(c,n,r);a.forEachArrayProperty((function(e,t){return u("",t,!1)})),t[o]=c}break;case"object":if(a.isDictionary){var d;u=e.getDictionaryWriter(d={},n,r);a.forEachDictionaryProperty((function(e,t){return u(e,t,!1)})),t[o]=d}break;case"unknown":N.LegacyCoreAssert.fail("Cannot write a property of unknown type",void 0,"DBSchema.getDictionaryWriter","DBSchema.swift",2071)}}},getDataObjectWriter:function(t,n,r,o){return function(a,i,s){if(i.shouldWrite)if(a==e.PROPERTY_ID){var l=F.opt(F.opt(r.getObjectStateByID(n),(function(t){return t.getProperty(e.PROPERTY_PATH)})),(function(e){return e.stringValue}));N.LegacyCoreAssert.isTrue(i.stringValue==n||n==l,"Saving object with ID",{objID:n,property:i.stringValue},"DBSchema.getDataObjectWriter","DBSchema.swift",2090)}else if(a!=e.PROPERTY_PATH||s)if(a!=e.PROPERTY_NAME||s)if(a!=e.PROPERTY_TYPE||s)if(a!=e.PROPERTY_COMPONENTS||s)if(a!=e.PROPERTY_CHILDREN||s){var u=i.className,c=i.objValue;if(null!=u&&null!=c){var d=e.getDictionaryWriter(m={},r,o);e.getSerializer(u)(r.getObjectStateByID(i.linkID),d),s?t.setManifestProperty(a,m,!0):t.setProperty(a,m)}else switch(i.schemaType){case"boolean":var h;null!=(h=i.boolValue)?s?t.setManifestProperty(a,F.as(h,"AnyObject"),!0):t.setBooleanProperty(a,h):t.setOptionalBooleanProperty(a,null);break;case"integer":s?t.setManifestProperty(a,F.as(i.intValue,"AnyObject"),!0):t.setIntProperty(a,i.intValue);break;case"number":s?t.setManifestProperty(a,F.as(i.doubleValue,"AnyObject"),!0):t.setNumberProperty(a,i.doubleValue);break;case"string":var p;null!=(p=i.stringValue)?s?t.setManifestProperty(a,F.as(p,"AnyObject"),!0):t.setStringProperty(a,p):t.setOptionalStringProperty(a,null);break;case"array":if(i.isArray){var f=[];d=e.getArrayWriter(f,r,o);i.forEachArrayProperty((function(e,t){return d("",t,!1)})),s?t.setManifestProperty(a,f,!0):t.setProperty(a,f)}break;case"object":if(i.isDictionary){var m;d=e.getDictionaryWriter(m={},r,o);i.forEachDictionaryProperty((function(e,t){return d(e,t,!1)})),s?t.setManifestProperty(a,m,!0):t.setProperty(a,m)}break;case"unknown":N.LegacyCoreAssert.fail("Cannot write a property of unknown type",void 0,"DBSchema.getDataObjectWriter","DBSchema.swift",2209)}}else i.isArray&&i.forEachArrayProperty((function(n,a){var i=F.as(a.objValue,I.DBObject);if(null!=i){var s=r.getObjectState(i);e.getSerializer(i.className)(s,e.getDataObjectWriter(t.appendChild(i.id),i.id,r,o))}}));else i.isArray&&i.forEachArrayProperty((function(n,r){if(r.isDictionary){var o=F.opt(r.getDictionaryProperty(e.PROPERTY_ID),(function(e){return e.stringValue})),a=F.opt(r.getDictionaryProperty(e.PROPERTY_URL),(function(e){return e.stringValue})),i=F.opt(r.getDictionaryProperty(e.PROPERTY_MIME_TYPE),(function(e){return e.stringValue}));null!=o&&null!=a&&null!=i&&t.appendComponent(o,a,i)}}));else{var g;null!=(g=i.stringValue)&&t.setType(g)}else{var y;null!=(y=i.stringValue)&&t.setName(y)}else t.setPath(i.stringValue);else s&&t.setManifestProperty(a,null,!0)}}},props:{getPropertyCodec:function(t,n){var r;return(r=e.currentSchema.propertyCodecs[n])&&r[t]||F.opt(this.getPropertyCodecs(n),(function(e){return e[t]}))},getPropertyCodecs:function(e){var t,n=F.clone(this.propertyCodecs[e]);null==n&&((t=this.rulesByName[e])&&(n=F.clone(t.propertyCodecs),this.propertyCodecs[e]=F.clone(n)));return n},init_2af7:function(e){this.init_f987(e,k.Host.schema.getRoot(e),k.Host.schema.rootFile,k.Host.schema.getFiles(e))},init_f987:function(e,t,n,r){for(var o=F.clone(R.Rule.definitionsFromSchemata(r)),a={},i=F.iter(o);!i.done;i.next()){var s,l=i.key,u=i.value;if(l.includes("#"))null!=(s=u.definedName)&&(a[s]=u)}this.rules=F.clone(o),this.rulesByName=F.clone(a),this.rootFile=n,this.formatVersion=e,this.rootSchema=F.clone(t),this.rootSchemaFile=n,this.auxiliarySchemata=F.clone(r),this.description=F.as(this.rootSchema.description,"String")},schemaForReference:function(e){var t,n=e.split("#"),r=n[0],o=null;if(t=F.isEmpty(r)?this.rootSchema:this.auxiliarySchemata[r]){o=F.clone(t);for(var a=n[1].split("/"),i=F.iter(a.filter((function(e){return!F.isEmpty(e)}),this));!i.done;i.next()){var s,l=i.value;o=(s=F.as(F.opt(o,(function(e){return e[l]})),["Dictionary","String","Any"]))?F.clone(s):null}}return o},validateAndRead:function(e,t,n){var r,o,a=this.rules[this.rootFile],i=F.opt(a,(function(t){return t.validate(e)})),s=F.opt(i,(function(e){return e.value}));return(o=F.as(i,R.DBValidationError))&&(F.opt(k.Host.logging,(function(e){return e.warning("Validation encountered errors: "+o.error)})),n([o])),(r=F.opt(F.opt(s,(function(e){return e.property("",t,null)})),(function(e){return e.linkID})))||null!=r?r:""},referenceSchema:function(t,n){return e.init_f987(this.formatVersion,t,n,this.auxiliarySchemata)},type:function(t){var n,r,o,a,i,s=R.DBSchemaType.UnknownType,l=F.as(t.className,"String"),u=null;(null!=(n=F.as(t.type,"String"))&&null!=(r=R.DBSchemaType.toCaseValue(n))&&(s=r,u=this),s==R.DBSchemaType.UnknownType&&null!=t.enum)&&((o=F.as(t.enum,["Array","Any"]))&&(o.length>0&&F.is(o[0],"String")?s=R.DBSchemaType.StringType:o.length>0&&F.is(o[0],"Int")&&(s=R.DBSchemaType.IntegerType)));if(s==R.DBSchemaType.UnknownType||s==R.DBSchemaType.ObjectType&&null==l)if(null!=(a=F.as(t[e.PROPERTY_REF],"String"))){var c,d=R.DBSchemaType.UnknownType,h=null,p=null,f=a.startsWith("#")?this.rootSchemaFile+a:a;if(c=this.schemaForReference(f)){var m=f.split("#")[0],g=f.split("/");if(l=F.last(g),m==this.rootSchemaFile){var y=this.type(c);d=y[0],h=y[1],p=y[2]}else{var _=this.referenceSchema(c,m).type(c);d=_[0],h=_[1],p=_[2]}}s==R.DBSchemaType.UnknownType&&(s=d),null==l&&(l=h),null==u&&(u=p)}else if(i=F.as(t.allOf,["Array",["Dictionary","String","Any"]]))for(var T=F.iter(i);!T.done;T.next()){var C=T.value,v=this.type(C),P=v[0],S=v[1],A=v[2];s==R.DBSchemaType.UnknownType&&(s=P),null==l&&(l=S),null==u&&(u=A)}return[s,l,u]},findValue:function(t,n){var r,o=n[t];if(null==o&&null!=(r=F.as(n[e.PROPERTY_REF],"String"))){var a,i=r.startsWith("#")?this.rootSchemaFile+r:r;(a=this.schemaForReference(i))&&(o=this.findValue(t,a))}return o},allProperties:function(t){N.LegacyCoreAssert.isTrue(null==t.anyOf&&null==t.oneOf,"Specific type should be known by this point or a custom codec is needed.",void 0,"DBSchema.allProperties","DBSchema.swift",2385);var n,r,o,a={};if((n=F.as(t.properties,["Dictionary","String",["Dictionary","String","Any"]]))&&(a=F.clone(n)),r=F.as(t.allOf,["Array",["Dictionary","String","Any"]]))for(var i=F.iter(r);!i.done;i.next())for(var s=i.value,l=F.iter(this.allProperties(s));!l.done;l.next()){var u=l.key,c=l.value;a[u]=F.clone(c)}if(null!=(o=F.as(t[e.PROPERTY_REF],"String"))){var d,h=o.startsWith("#")?this.rootSchemaFile+o:o;if(d=this.schemaForReference(h))for(var p=F.iter(this.allProperties(d));!p.done;p.next()){u=p.key;var f=p.value;null==a[u]&&(a[u]=F.clone(f))}}return a},schemaAttribute:function(t,n){N.LegacyCoreAssert.isTrue(null==n.anyOf&&null==n.oneOf,"Specific type should be known by this point or a custom codec is needed.",void 0,"DBSchema.schemaAttribute","DBSchema.swift",2417);var r,o,a=n[t];if(null==a&&(r=F.as(n.allOf,["Array",["Dictionary","String","Any"]])))for(var i=F.iter(r);!i.done;i.next()){var s,l=i.value;if(null!=(s=this.schemaAttribute(t,l))){a=s;break}}if(null==a&&null!=(o=F.as(n[e.PROPERTY_REF],"String"))){var u,c,d=o.startsWith("#")?this.rootSchemaFile+o:o;if(u=this.schemaForReference(d))null!=(c=this.schemaAttribute(t,u))&&(a=c)}return a}}}),e}()},SpAV:function(e,t,n){var r,o,a,i=t,s=n("oAGj"),l=n("gXiO"),u=n("iCxV");i.CoreAssert=(r=function(){l.CoreObject.call(this)},s.defineClass({name:"CoreAssert",ctor:r,superName:"CoreObject",statics:{disableAssertionFailuresForTestingPurposesOnly:!1,fail:function(e,t,n,r,o){void 0===t&&(t={}),void 0===n&&(n="CoreAssert.fail"),void 0===r&&(r="CoreAssert.swift"),void 0===o&&(o=24),i.CoreAssertHelper.fail(e,t,n,r,o,!1)},isTrue:function(e,t,n,r,o,a){void 0===n&&(n={}),void 0===r&&(r="CoreAssert.isTrue"),void 0===o&&(o="CoreAssert.swift"),void 0===a&&(a=39),i.CoreAssertHelper.isTrue(e,t,n,r,o,a,!1)},isFalse:function(e,t,n,r,o,a){void 0===n&&(n={}),void 0===r&&(r="CoreAssert.isFalse"),void 0===o&&(o="CoreAssert.swift"),void 0===a&&(a=53),i.CoreAssertHelper.isFalse(e,t,n,r,o,a,!1)}}}),r),i.CoreAssertDebugOnly=(o=function(){l.CoreObject.call(this)},s.defineClass({name:"CoreAssertDebugOnly",ctor:o,superName:"CoreObject",statics:{fail:function(e,t,n,r,o){void 0===t&&(t={}),void 0===n&&(n="CoreAssertDebugOnly.fail"),void 0===r&&(r="CoreAssert.swift"),void 0===o&&(o=67),i.CoreAssertHelper.fail(e,t,n,r,o,!0)},isTrue:function(e,t,n,r,o,a){void 0===n&&(n={}),void 0===r&&(r="CoreAssertDebugOnly.isTrue"),void 0===o&&(o="CoreAssert.swift"),void 0===a&&(a=77),i.CoreAssertHelper.isTrue(e,t,n,r,o,a,!0)},isFalse:function(e,t,n,r,o,a){void 0===n&&(n={}),void 0===r&&(r="CoreAssertDebugOnly.isFalse"),void 0===o&&(o="CoreAssert.swift"),void 0===a&&(a=86),i.CoreAssertHelper.isFalse(e,t,n,r,o,a,!0)}}}),o),i.CoreAssertHelper=(a=function(){},s.defineClass({name:"CoreAssertHelper",ctor:a,statics:{SWIFT_FILE_SUFFIX:".swift",fail:function(e,t,n,r,o,l){var c;if(!i.CoreAssert.disableAssertionFailuresForTestingPurposesOnly){var d,h=r.split("/"),p=s.last(h);null!=(d=p)&&d.includes(a.SWIFT_FILE_SUFFIX)&&(p=d.substr(0,d.length-a.SWIFT_FILE_SUFFIX.length));var f="'"+e+"' "+((c=p)||null!=c?c:"")+":"+o+":"+n;s.opt(u.Host.logging,(function(e){return e.logAssertFailure(f,t)})),s.opt(u.Host.lifetime,(function(t){return t.terminate(l,e)}))}},isTrue:function(e,t,n,r,o,i,s){e||a.fail(t,n,r,o,i,s)},isFalse:function(e,t,n,r,o,i,s){e&&a.fail(t,n,r,o,i,s)}}}),a)},T6jX:function(e,t,n){var r,o,a,i,s,l=t,u=n("oAGj"),c=n("0wFF"),d=n("KSe6"),h=n("6h7+"),p=n("gXiO"),f=n("ascj"),m=n("Z25M"),g=n("4JYN"),y=n("FNB+"),_=n("6ZWm"),T=n("QgZx"),C=n("cmoc"),v=n("fWxZ"),P=n("G1DZ"),S=n("QbzR"),A=n("9Lk3"),D=n("ZK0l"),E=n("ZhwN"),R=n("iCxV"),F=n("8vXU"),I=n("Qlvz"),b=n("NkBu"),O=n("U010"),k=n("q5zr"),M=n("fdtz"),N=n("lmwz"),L=n("uWOl"),x=n("rxGp"),B=n("fNpk"),w=n("c+uM"),G=n("tGKA"),Y=n("VkKB"),U=n("K17h"),V=n("3DEm"),j=n("358a"),H=n("uxH+"),W=n("AxS/"),K=n("K0Rh"),X=n("7Ta2"),z=n("Zifs"),q=n("djAF"),Z=n("u2iI"),J=n("EoOi"),Q=n("9YN4"),$=n("enh0"),ee=n("Vm85"),te=n("DaVl"),ne=n("voyk"),re=n("8t9B"),oe=n("3UhB"),ae=n("oKI3"),ie=n("qSCS"),se=n("LGJg"),le=n("WWR6"),ue=n("zjod"),ce=n("mxdD");l.OPACITY_LOG_SCALE=5,l.TheoDocumentUtils=(r=function(){p.CoreObject.call(this)},u.defineClass({name:"TheoDocumentUtils",ctor:r,superName:"CoreObject",statics:{DESIGN_COMPLEXITY_HEURISTIC_THRESHOLD:20,HIGH_DESIGN_COMPLEXITY_HEURISTIC_THRESHOLD:100,getAvgGlyphAreaSortedText:function(e){for(var t=u.clone(e.firstPage.root.filterWithCallback((function(e){return e.isTypeLockup()}))),n=[],r=u.iter(t);!r.done;r.next()){var o,a=r.value;if(o=u.as(a.controller,re.TypeLockupController)){var i=0,s=0;if(a.visit(y.FormaTraversal.PreOrder,(function(e,t,n){var r,o;return(r=u.as(e,$.TextForma))&&(o=r.finalFrame)&&(i+=o.area,s+=r.rangeInLockup.length),!1})),s>0){var l=i/u.toDouble(s),c=u.replaceAll(o.text,"\n"," ").split(" ").filter((function(e){return!u.isEmpty(e)}),this).join(" ");u.isEmpty(c)||n.push({text:c,avgGlyphArea:l})}}}return u.sort(n,(function(e,t){return e.avgGlyphArea>t.avgGlyphArea})).map((function(e){return e.text}),this)},synthesizeTitle:function(e){var t=u.clone(r.getAvgGlyphAreaSortedText(e));return t.length>0?t[0]:Q.TheoDocument.DEFAULT_NAME},synthesizeDescription:function(e){return r.getAvgGlyphAreaSortedText(e).join(" ")},getFrameString:function(e,t){void 0===t&&(t=!1);var n=u.clone(e.totalPlacement.transformPoints(e.bounds.points));e.isTypeLockup()&&t&&(n=u.clone(e.totalPlacement.transformPoints(e.childrenBoundsInCoordSpace(G.Matrix2D.Identity).points)));for(var r=[],o=u.iter(n);!o.done;o.next()){var a=o.value,i=u.toString(u.toInt(Math.round(a.x))),s=u.toString(u.toInt(Math.round(a.y)));r.push(i+","+s)}return r.join(",")},getCellBackgroundShape:function(e){var t;if(t=N.ImageFacade.getFrameForForma(e)){var n,r;if((n=u.as(t.controller,_.FrameController))&&n.hasCutout&&(n.floating||n.hasBackgroundColor))return t;if(r=u.as(u.opt(t.parent,(function(e){return e.controller})),A.GridController)){var o=r.getCellBackgroundShape(t);if(null!=o)return o}}return null},getCellBackgroundImage:function(e){if(e.controller.floating)return null;var t;if(t=u.as(u.opt(e.parent,(function(e){return e.controller})),A.GridController)){var n=t.getCellBackgroundImage(e);if(null!=n)return n}return null},updateConstrainedImageInfo:function(e){var t=[],n=[],r=[],o=[];e.visitAll(y.FormaTraversal.PreOrder,(function(e){var a,i;(a=u.as(e,M.ImageForma))&&(i=u.opt(a.contentNode,(function(e){return e.mediaMetadata})))&&i.sourceName==Y.MediaMetadata.kMediaStockSourceName&&null!=i.assetID&&null!=i.licenseType&&(i.licenseType==Y.MediaMetadata.kMediaStockLicenseTypeNone?t.includes(i.assetID)||t.push(i.assetID):i.licenseType==Y.MediaMetadata.kMediaStockLicenseTypeStandard?n.includes(i.assetID)||n.push(i.assetID):i.licenseType==Y.MediaMetadata.kMediaStockLicenseTypeExtended?r.includes(i.assetID)||r.push(i.assetID):i.licenseType==Y.MediaMetadata.kMediaStockLicenseTypeLimited?o.includes(i.assetID)||o.push(i.assetID):B.LegacyCoreAssert.fail("unknown image license type",void 0,"TheoDocumentUtils.updateConstrainedImageInfo","TheoDocumentUtils.swift",170))}));var a={stockImages:{unlicensed:t,standard:n,extended:r,limited:o}},i=e.beginTransaction("updateConstrainedImageInfo");e.setConstrainedImages(a),i.mergeWithPrevious()},containsLicensedImage:function(e){return 0==!r.licensedStockImageIDs(e).length},licensedStockImageIDs:function(e){var t,n,r,o,a=[];return(t=e.constrainedImages[Q.TheoDocument.PROPERTY_STOCK_IMAGES])&&((n=t[Q.TheoDocument.PROPERTY_STANDARD])&&u.append(a,n),(r=t[Q.TheoDocument.PROPERTY_EXTENDED])&&u.append(a,r),(o=t[Q.TheoDocument.PROPERTY_LIMITED])&&u.append(a,o)),a},limitedLicensedStockImageIDs:function(e){var t=u.clone(e.constrainedImages);return u.clone(u.opt(t[Q.TheoDocument.PROPERTY_STOCK_IMAGES],(function(e){return e[Q.TheoDocument.PROPERTY_LIMITED]})))||[]},unlicensedStockImageIDs:function(e){var t=u.clone(e.constrainedImages);return u.clone(u.opt(t[Q.TheoDocument.PROPERTY_STOCK_IMAGES],(function(e){return e[Q.TheoDocument.PROPERTY_UNLICENSED]})))||[]},allStockImageIDs:function(e){return r.licensedStockImageIDs(e).concat(r.unlicensedStockImageIDs(e))},createImageFeatures:function(e){e.content.root.visitAll((function(e){var t;(t=u.as(e,k.ImageContentNode))&&(t.isMask||t.createImageFeatures())}))},getFontSourceUsage:function(e){for(var t={},n=u.iter(e.filterWithCallback((function(e){return e.isTypeLockup()})));!n.done;n.next()){var o=n.value;r.visitFontSourceForLockup(o,(function(e){var n=T.describeFontSource(e);return t[n]=!0,!0}))}return u.sort(u.keys(t)).map((function(e){return e}),this)},visitFontSourceForLockup:function(e,t){var n;if(n=u.as(e.style,w.LockupStyle)){var r;if((r=n.font)&&!t(r.fontData.source))return;for(var o=u.iter(n.characterStyles);!o.done;o.next()){var a;if((a=o.value.font)&&!t(a.fontData.source))return}}},getFontRecommendationUsage:function(e){for(var t,n,r=[],o=u.iter(e.filterWithCallback((function(e){return e.isTypeLockup()})));!o.done;o.next()){var a,i=o.value;if(a=u.as(i.style,w.LockupStyle)){var s=(t=i.getTag(y.Forma.TAG_RECOMMENDATION_SOURCE))||null!=t?t:"",l=(n=i.getTag(y.Forma.TAG_RECOMMENDATION_TYPE))||null!=n?n:"";if(s.length>0||l.length>0){var c,d=[];(c=a.font)&&d.push(c.fontData.postScriptName);for(var h=u.iter(a.characterStyles);!h.done;h.next()){var p,f=h.value;null!=(p=u.opt(f.font,(function(e){return e.fontData.postScriptName})))&&(d.includes(p)||d.push(p))}var m=d.join(","),g=i.formaID+","+s+","+l+","+m;r.push(g)}}}return r},getFontRecommendationCounts:function(e){for(var t={},n={},o=0,a=u.iter(e.filterWithCallback((function(e){return e.isTypeLockup()})));!a.done;a.next()){var i=a.value;r.addFontRecommendationCountsForLockup(i,t,n)&&(o+=1)}var s=[];s.push(u.toString(o));for(var l=[],c=u.iter(t);!c.done;c.next()){var d=c.key,h=c.value;l.push(d+":"+u.toString(h))}s.push(l.join(","));for(var p=[],f=u.iter(n);!f.done;f.next()){var m=f.key;h=f.value,p.push(m+":"+u.toString(h))}return s.push(p.join(",")),s},addFontRecommendationCountsForLockup:function(e,t,n){var r,o,a,i;return null!=(a=e.getTag(y.Forma.TAG_RECOMMENDATION_SOURCE))&&null!=(i=e.getTag(y.Forma.TAG_RECOMMENDATION_TYPE))&&(t[a]=((r=t[a])||null!=r?r:0)+1,n[i]=((o=n[i])||null!=o?o:0)+1,!0)},getUsedFontNames:function(e){for(var t={},n=u.iter(e.filterWithCallback((function(e){return e.isTypeLockup()})));!n.done;n.next()){var o=n.value;r.addUsedFontNamesForLockup(o,t)}return u.sort(u.keys(t)).map((function(e){return e}),this)},addUsedFontNamesForLockup:function(e,t){var n;if(n=u.as(e.style,w.LockupStyle)){var r;(r=n.font)&&(t[r.fontData.postScriptName]=!0);for(var o=u.iter(n.characterStyles);!o.done;o.next()){var a;(a=o.value.font)&&(t[a.fontData.postScriptName]=!0)}}},getImageTraitsForExportAnalytics:function(e){var t=0,n=0,o=0,a=0,i=0,s=[],l={},d={},h=r.licensedStockImageIDs(e).length;j.PagesFacade.visitPages(e,(function(e){return e.root.visitAll(y.FormaTraversal.PreOrder,(function(c){var h,p;if((h=u.as(c,M.ImageForma))&&(p=u.as(h.style,L.ImageStyle))){var f,m,g=r.getImageStyleDescription(e,p);g==L.ImageStyle.NAME_NONE||s.includes(g)||(g==L.ImageStyle.NAME_NEWDUOTONE?s.splice(0,0,g):s.push(g)),N.ImageFacade.getCutoutModeForForma(h)!=O.CutoutMode.Off&&(o+=1,N.ImageFacade.hasRefinedCutout(h)&&(i+=1)),(f=N.ImageFacade.getMaskForForma(h))&&(l[f.id]=!0),(m=p.adjustments)&&m.setEnabledKeys(d),n+=1}else c.hasIntent(y.Forma.INTENT_ICON)&&(t+=1);u.opt(c.parent,(function(e){return e.parent instanceof K.RootForma}))&&(a+=1)})),!0}));var p="";p=0==s.length?L.ImageStyle.NAME_NONE:"["+s.join(",")+"]";var f=u.sort(u.keys(l)).map((function(e){return e}),this),m=0==f.length?c.AnalyticsConstants.kAnalyticsGenericNone:"["+f.join(", ")+"]",g=1==d[I.ImageAdjustments.PROPERTY_BLUR]?"[blur]":c.AnalyticsConstants.kAnalyticsGenericNone,_=u.sort(u.keys(d)).filter((function(e){return e!=I.ImageAdjustments.PROPERTY_BLUR}),this);return{imageFilterUsages:p,effects:g,enhancements:0==_.length?c.AnalyticsConstants.kAnalyticsGenericNone:"["+_.join(", ")+"]",cropShapeIds:m,numCutout:o,numRefinedCutout:i,numImages:n,numStockImages:h,numIcons:t,layerCount:a}},getImageStyleDescription:function(e,t){var n=t.name;if(n==L.ImageStyle.NAME_NEWDUOTONE){var r=new g.DuotonePreset(t.colors.fieldShadows||z.SolidColor.BLACK,t.colors.fieldHighlights||z.SolidColor.WHITE),o=e.imageFilterLibrary.getDuotonePresetIndex(r);if(-1==o)n+=c.AnalyticsConstants.kAnalyticsDataDuotoneCustom;else{var a=e.imageFilterLibrary.getDuotonePresetAtIndex(o);u.eq(g._equality_DuotonePreset_DuotonePreset,a,r)?n+=c.AnalyticsConstants.kAnalyticsDataDuotonePreset:n+=c.AnalyticsConstants.kAnalyticsDataDuotoneSwap}}return n},getDocumentGroupDescription:function(e){var t,n=u.clone(e.filterWithCallback((function(e){return!(!(t=u.opt(e.controller,(function(e){return e.userGroup})))&&null==t)&&t})));if(0==n.length)return"none";for(var r=0,o=0,a=0,i=u.iter(n);!i.done;i.next()){var s,l=i.value;null==(s=l.getTag(y.Forma.TAG_CREATED_FROM_REMIX))||"true"!=s?P.FormaSourceUtils.isDesignIngredient(l.source)?a+=1:o+=1:r+=1}return r+","+o+","+a},logExportDNAEvent:function(e){},dictToAnalyticsString:function(e,t){void 0===t&&(t="");var n=u.keys(e).filter((function(e){return!u.isEmpty(e)}),this);return t+"["+u.sort(n).map((function(e){return e}),this).join(", ")+"]"},getDesignAnalyticsForPages:function(e){var t,n,o,a={},i="none",s={},c={},h={},p=!1,f=!1,m=!1,g={},_=new l.ContentCounts,P=new l.ExtendedContentCounts,S={},A=!1,D=!1,E=!1,R=1/0,F=-1/0,I={},b={},k={},L=0,x="false",B=e.length,w="unknown",G="unknown";(o=u.opt(u.first(e),(function(e){return e.document})))&&(w=o.getPageCount(),G=(t=o.colorThemeCategoryName)||null!=t?t:"");for(var Y=u.iter(e);!Y.done;Y.next()){var V,j,H,W,K=Y.value,X=K.originalSizeID.toLowerCase(),z=K.sizeID.toLowerCase();a["'original:"+X+", exported:"+z+", hasResized:"+(X==v.FormaPage.DEFAULT_ORIGINAL_SIZE_ID.toLowerCase()?"unknown":X!=z)+"'"]=!0,null!=(V=K.colorLibrary.paletteID)&&(s[V]=!0),null!=(j=r.getAppliedLayoutIdForPage(K))&&(c[j]=!0),null!=(H=K.themeID)&&(S[H]=!0,E=!0),(W=U.MotionUtils.getCurrentAnimationStyle(K))&&(W.isNoStyle()||(m=!0,g[d.AnimationLibrary.determineAnalyticName(W)]=!0)),K.root.visitAll(y.FormaTraversal.PreOrder,(function(e){var t,o;if("none"==i&&(i=(n=r.getFormaDesignIngredientID(e))||null!=n?n:"none"),r.addContentCountsForForma(e,_),r.addExtendedContentCountsForForma(e,P),(t=u.as(e,M.ImageForma))&&N.ImageFacade.getCutoutModeForForma(t)!=O.CutoutMode.Off&&N.ImageFacade.hasRefinedCutout(t)&&(x="true"),e.kind==C.FrameForma.KIND){if(!A&&e.isBackgroundImage()&&(A=!0),!D&&e.isBackgroundImage()){var a=N.ImageFacade.getImageContentForForma(e);D=u.opt(u.opt(a,(function(e){return e.mediaMetadata})),(function(e){return"premium"==e.licenseType}))}}else if(e.isTypeLockup())r.addUsedFontNamesForLockup(e,h),r.addTextLayoutForLockup(e,I),p&&f||r.visitFontSourceForLockup(e,(function(e){return p=p||e==T.FontSource.TYPEKIT_PREMIUM,f=f||e==T.FontSource.USER_UPLOAD,!p||!f})),r.addFontRecommendationCountsForLockup(e,b,k)&&(L+=1);else if(o=u.as(e,$.TextForma)){var s;null!=(s=oe.TypeLockupUtils.userFontSizeForTextForma(o,!0))&&(R=Math.min(R,s),F=Math.max(R,s))}}))}var q="none";R!=1/0&&(q="fontSizeMin:"+Math.round(10*R)/10+"fontSizeMax:"+Math.round(10*F)/10);for(var Z=A?A?"premium":"free":"none",J=[],Q=u.iter(b);!Q.done;Q.next()){var ee=Q.key,te=Q.value;J.push(ee+":"+te)}for(var ne=0==J.length?"[]":"["+J.join(",")+"]",re=[],ae=u.iter(k);!ae.done;ae.next()){var ie=ae.key;te=ae.value,re.push(ie+":"+te)}var se=0==re.length?"[]":"["+re.join(",")+"]";return new l.CoreDesignAnalytics(r.dictToAnalyticsString(a,"size:"),"designIngredientId:"+i,r.dictToAnalyticsString(s,"hasColor:"),r.dictToAnalyticsString(c,"hasLayout:"),r.dictToAnalyticsString(h,"fontsUsedID:"),"includesPaidAdobeFonts:"+p,u.toString(f),"hasAnimation:"+m,r.dictToAnalyticsString(g,"animationStyle:"),"hasAddedElement:"+_.stringify(),"hasAddedElementExt:"+P.stringify(),r.dictToAnalyticsString(S,"hasDesignFilter:"),"backgroundType:"+Z,"hasVariationTemplate:"+E,q,r.dictToAnalyticsString(I,"hasTextLayout:"),"fontRecUsed:"+L,"recommendationSourceCounts:"+ne,"recommendationTypeCounts:"+se,"numPagesExported:"+B,"numPagesInProject:"+w,"colorThemeCategoryName:"+G,"hasCutout:"+x)},getAllDesignIngredientIDsAndTypes:function(e){var t=[];return e.visitAll(y.FormaTraversal.PreOrder,(function(e){var n;null!=(n=e.source)&&P.FormaSourceUtils.isDesignIngredient(n)&&t.push(h.BadgeFacade.getDesignIngredientIDAndType(n))})),t},getFirstDesignIngredientID:function(e){var t,n=null;return e.firstPage.root.visit(y.FormaTraversal.PreOrder,(function(e,t,o){return null!=(n=r.getFormaDesignIngredientID(e))})),(t=n)||null!=t?t:"none"},getFormaDesignIngredientID:function(e){var t;return null!=(t=e.source)&&P.FormaSourceUtils.isDesignIngredient(t)?h.BadgeFacade.getDesignIngredientIDAndType(t).id:null},getBackgroundImageCount:function(e){var t=0;return e.root.visitAll(y.FormaTraversal.PreOrder,(function(e){e.isBackgroundImage()&&(t+=1)})),t},getAppliedVariationTemplateId:function(e){return e.firstPage.themeID},getAppliedLayoutId:function(e){return r.getAppliedLayoutIdForPage(e.firstPage)},getAppliedLayoutIdForPage:function(e){return u.opt(u.opt(u.opt(u.as(e.root.controller,H.RootController),(function(e){return e.getGridController()})),(function(e){return e.gridStyle})),(function(e){return e.name}))},getMetadataEvents:function(e,t,n){var o;void 0===n&&(n=!1);var a=e.firstPage,i=a.sizeID,s="";null!=a.animationController.animationStyle&&(s=a.animationController.animationStyle.asString);var l,c,d=a.colorLibrary.paletteID,h=a.themeID,p=e.content.root.getTag(W.RootContentNode.DOCUMENT_SOURCE_TYPE_TAG),m=e.content.root.getTag(W.RootContentNode.DOCUMENT_SOURCE_ID_TAG),g="default",_=0,T=0,v=u.clone(a.root.filterByControllerKind(A.GridController.KIND));v.length>0&&(l=u.as(v[0].controller,A.GridController))&&(c=l.gridStyle)&&(g=c.name,_=l.spacing,T=l.margin);var S=null!=d?a.colorLibrary.paletteID:"",D=null!=h?h:"",I=null!=m?m:"",b=null!=p?p:"",O=[],k=[],N=0,B=0,w=[],G="",Y=0;e.visitAll(y.FormaTraversal.PreOrder,(function(e){if(null!=e.bounds){var t,a="id:"+e.formaID.substr(0,8),i=n?a:"",s=r.getFrameString(e),l="";(t=e.style.colors.color(f.ColorRole.FieldPrimary))&&(l=t.rgbHex);var c,d,h,p,m,g="";if((c=e.style.colors.color(f.ColorRole.FieldSecondary))&&(g=c.rgbHex),d=u.as(e,M.ImageForma)){var y="",_="",T="",v="",S="",A="";u.opt(d.parent,(function(e){return e.kind==C.FrameForma.KIND}))&&(s=r.getFrameString(e.parent)),(te=u.as(d.style,L.ImageStyle))&&(v=te.name);var D,E,R,F=d.contentNode,I=u.opt(F,(function(e){return e.mediaMetadata}));if(u.opt(d.parent,(function(e){return e.kind==C.FrameForma.KIND}))){var b=u.clone(d.placement.inverse.transformPoints(d.parent.bounds.points)),x=Math.round(d.bounds.width),U=Math.round(d.bounds.height);T=Math.round(1e3*x/U)/1e3+",";for(var V=[],j=u.iter(b);!j.done;j.next()){var H=j.value,W=u.toString(Math.round(1e3*H.x/x)/1e3),X=u.toString(Math.round(1e3*H.y/U)/1e3);V.push(W+","+X)}T+=V.join(",")}null!=(ie=u.opt(I,(function(e){return e.searchTerm})))&&(_=ie,null!=(D=u.opt(I,(function(e){return e.sourceURL})))&&(y=D)),null!=(E=u.opt(I,(function(e){return e.sourceName})))&&(S=E),null!=(R=u.opt(I,(function(e){return e.licenseType})))&&(A=R);var z,Z="img";(z=u.as(e,ue.VideoForma))&&(ce.VideoFacade.formaIsLivePhoto(z)&&(Z="lp"),null!=u.opt(z.videoContentNode,(function(e){return e.isGIF}))&&(Z="gif"),z.isSticker()&&(Y+=1)),y.includes("https://pixabay.com")&&(y=y.substr("https://pixabay.com".length,y.length-"https://pixabay.com".length));var J="",Q=u.clone(u.opt(F,(function(e){return e.imageColorData})));if(null!=Q){u.sortInPlace(Q,(function(e,t){return e.coverage>t.coverage}));for(var $=[],ee=u.iter(Q);!ee.done;ee.next()){var te,ne,oe=ee.value;(te=u.as(d.style,L.ImageStyle))&&(ne=u.opt(u.opt(F,(function(e){return e.image})),(function(e){return e.getFilterColor(oe.rgbColor,te)})))&&($.push(ne.rgbHex),$.push(u.toString(Math.round(1e3*oe.coverage)/1e3)))}J=$.join(",")}var ae=i+"frame:'"+s+"',crop:'"+T+"',filt:'"+v+"',type:'"+Z+"',";_.length>0&&(ae+="search:'"+u.toString(_)+"',"),y.length>0&&(ae+="url:'"+u.toString(y)+"',"),S.length>0&&(ae+="sourceType:'"+u.toString(S)+"',"),A.length>0&&(ae+="licenseType:'"+u.toString(A)+"',"),l.length>0&&(ae+="c1:'"+u.toString(l)+"',"),g.length>0&&(ae+="c2:'"+u.toString(g)+"',"),ae+=J+"'",O.push(ae)}else if(e instanceof K.RootForma)G=i+"frame:'"+s+"', color1:'"+l+"'";else if(h=u.as(e,q.ShapeForma)){if(null!=h.controller){var ie,le,de=i+"frame:'"+s+"', color1:'"+l+"', intent:'"+((o=h.intent)||null!=o?o:"")+"'",he=u.as(h.contentNode,se.VectorContentNode);I=u.opt(he,(function(e){return e.mediaMetadata})),null!=(ie=u.opt(I,(function(e){return e.searchTerm})))&&(de+=" searchTerm:'"+ie+"'"),null!=(le=u.opt(I,(function(e){return e.sourceURL})))&&(de+=" iconURL:'"+le+"'"),k.push(de)}}else(p=u.as(e.controller,re.TypeLockupController))&&null!=e.finalFrame&&(N+=1,p.getCharacterStyleRanges().length>0&&(B+=1));if(null!=(m=e.source)&&P.FormaSourceUtils.isDesignIngredient(e.source)){var pe=a+" src:"+m;w.push(pe)}}}));var U=E.GUIDUtils.makeGUID(),V=[],j=a.colorLibraryController.getCurrentThemeHexString(),H=a.colorLibraryController.getNumThemeColorKeys(),X=t?"1":"0",z="size:"+i+", w:"+u.toString(a.pageSize.width);z+=", h:"+u.toString(a.pageSize.height)+", text:"+u.toString(N),z+=", images:"+u.toString(O.length)+", stickers:"+u.toString(Y)+", layout:'"+g,z+="', marg:"+u.toString(T)+", spac:"+u.toString(_),z+=", DIs:"+w.length,z+=", theme:'"+D+"', anim:'"+s,z+="', source:'"+I+"', type:'"+b,z+="', wm:"+X+",char:"+u.toString(B),z+=", pages:"+u.toString(e.getPageCount());var Z="numColors:"+H+", paletteID:'"+S+"', palette:'"+j+"'";if(V.push([U,u.toString(V.length),"document",z]),V.push([U,u.toString(V.length),"document",Z]),V.push([U,u.toString(V.length),"background",G]),R.Host.logging.isCategoryEnabled(x.LogCategories.kDocMetadata,F.LogLevelEnum.INFO_LEVEL))for(var J=u.iter(V);!J.done;J.next()){var Q=J.value;u.info(Q[0]+" "+Q[1]+" "+Q[2]+" "+Q[3]+", length: "+Q[3].length)}return V},getLockupContextualDataJson:function(e,t,n){var o,a,i,s,l,c,d,h,p,f,m,g,y,_;void 0===t&&(t=!1),void 0===n&&(n=!1);var T,C,v,P={};if((T=u.as(e.controller,re.TypeLockupController))&&(C=T.lockupStyle)&&(v=r.getLockupMetaDataJSON(e))){t||(P[n?"tt":"text"]=T.text);var S=T.rotation();if(t)n?P.rt=V.MathUtils.roundDoubleToString(S,2):P.rotation=S;else{var A=e.totalPlacement.calculateTransformValuesSKRT();P[n?"rc":"rotCosine"]=A.rotCosine,P[n?"rs":"rotSine"]=A.rotSine}P[n?"ft":"font"]=v.font,P[n?"fr":"frameString"]=v.frame,P[n?"c1":"color1"]=v.color1,P[n?"ly":"layout"]=v.layout,P[n?"gp":"lockupGrouped"]=T.userGroupMember,n?(P.fs=V.MathUtils.roundDoubleToString(u.toDouble((o=v.avgFontSize)||null!=o?o:"0"),2),P.sp=V.MathUtils.roundDoubleToString(u.toDouble((a=v.spacing)||null!=a?a:"0"),2),P.pd=V.MathUtils.roundDoubleToString(u.toDouble((i=v.padding)||null!=i?i:"0"),2),P.tk=V.MathUtils.roundDoubleToString(u.toDouble((s=v.tracking)||null!=s?s:"0"),2),P.sw=V.MathUtils.roundDoubleToString(u.toDouble((l=v.strokeWeight)||null!=l?l:"0"),2)):(P.avgFontSize=u.toDouble((c=v.avgFontSize)||null!=c?c:"0"),P.spacing=u.toDouble((d=v.spacing)||null!=d?d:"0"),P.padding=u.toDouble((h=v.padding)||null!=h?h:"0"),P.tracking=u.toDouble((p=v.tracking)||null!=p?p:"0"),P.strokeWeight=u.toDouble((f=v.strokeWeight)||null!=f?f:"0"));var D=u.count(C.characterStyles)>0;P[n?"ms":"hasMSL"]=D;var E=v.backgroundColor;if(P[n?"ic":"intersectColors"]=[E],t&&(P[n?"c2":"color2"]=v.color2,P[n?"bs":"backingShape"]=v.backingShape,P[n?"lk":"look"]=v.look,n?(P.to=V.MathUtils.roundDoubleToString(u.toDouble((m=v.textOpacity)||null!=m?m:"0"),2),P.bo=V.MathUtils.roundDoubleToString(u.toDouble((g=v.backingOpacity)||null!=g?g:"0"),2)):(P.textOpacity=u.toDouble((y=v.textOpacity)||null!=y?y:"0"),P.backingOpacity=u.toDouble((_=v.backingOpacity)||null!=_?_:"0")),D)){var R,F,I,b=u.clone(r.getMSLockupMetaDataJson(e));null!=(R=b.font)&&(P[n?"mf":"mslFont"]=R),null!=(F=b.color1)&&(P[n?"mc1":"mslColor1"]=F),null!=(I=b.color2)&&(P[n?"mc2":"mslColor2"]=I)}}return P},getDocumentContextualDataJson:function(e,t,n){void 0===t&&(t=!1),void 0===n&&(n=!1);var r,o,a={};if((r=u.as(e.firstPage.root,K.RootForma))&&(o=r.frame)){for(var i=u.clone(e.firstPage.root.filterByControllerKind(re.TypeLockupController.KIND)),s={},l=u.iter(i);!l.done;l.next()){var c,d=l.value;if((c=u.as(d.style,w.LockupStyle))&&null!=(p=u.opt(c.font,(function(e){return e.fontData.postScriptName})))){null==s[p]&&(s[p]=0),s[p]=s[p]+1;for(var h=u.iter(c.characterStyles);!h.done;h.next()){var p,f=h.value;null!=(p=u.opt(f.font,(function(e){return e.fontData.postScriptName})))&&(null==s[p]&&(s[p]=0),s[p]=s[p]+1)}}}for(var g=[],_=u.iter(e.firstPage.root.visitAsArray(y.FormaTraversal.PreOrder));!_.done;_.next()){var T,C=_.value;null==C.controller||!C.isTypeLockup()&&C.kind!=q.ShapeForma.KIND||(null!=(T=u.opt(C.style.colors.fieldPrimary,(function(e){return e.rgbHex})))&&(g.includes(T)||g.push(T)),null!=(T=u.opt(C.style.colors.fieldSecondary,(function(e){return e.rgbHex})))&&(g.includes(T)||g.push(T)))}a[n?"w":"width"]=o.width,a[n?"h":"height"]=o.height,a[n?"ni":"numImages"]=m.DesignFeatureUtils.getImageCount(r),a[n?"nt":"numTexts"]=m.DesignFeatureUtils.getTextCount(r),a[n?"ns":"numShapes"]=m.DesignFeatureUtils.getShapeCount(r),a[n?"ft":"fonts"]=u.clone(s),a[n?"cl":"colors"]=u.clone(g)}return a},getDesignDecompositionJson:function(e,t){void 0===t&&(t=null);var n,o,a,i,s,l,c,d,h=this,p=e.firstPage,m=p.sizeID,g=p.colorLibrary.paletteID,T=p.themeID,C=e.content.root.getTag(W.RootContentNode.DOCUMENT_SOURCE_TYPE_TAG),v=e.content.root.getTag(W.RootContentNode.DOCUMENT_SOURCE_ID_TAG),P="default",S=0,E=0,R=u.clone(p.root.filterByControllerKind(A.GridController.KIND));R.length>0&&(c=u.as(R[0].controller,A.GridController))&&(d=c.gridStyle)&&(P=d.name,S=c.spacing,E=c.margin);var F=null!=g?p.colorLibrary.paletteID:"",I=null!=T?T:"",b=null!=v?v:"",k=null!=C?C:"",x=[],B=[],G=[],Y={},U=[];p.root.visitAll(y.FormaTraversal.PreOrder,(function(t){if(null!=t.bounds&&null!=t.controller){var l=t.formaID,c=r.getFrameString(t,!0),d=(n=u.opt(t.parent,(function(e){return e.formaID})))||null!=n?n:"";u.opt(u.opt(t.parent,(function(e){return e.controller})),(function(e){return e.kind==A.GridController.KIND}))&&(d=(o=u.opt(t.root,(function(e){return e.formaID})))||null!=o?o:"root");var p=u.toString((a=u.opt(t.parent,(function(e){return e.indexOfChild(t)})))||null!=a?a:0),m={};if(null!=t.bounds){var g=t.totalPlacement.calculateTransformValuesSKRT();m.xscale=u.toString(g.xscale),m.yscale=u.toString(g.yscale),m.tx=u.toString(g.tx),m.ty=u.toString(g.ty),m.rotCosine=u.toString(g.rotCosine),m.rotSine=u.toString(g.rotSine)}var T={};if(T.id=l,T.bounds=t.bounds.asString,T.transform=u.clone(m),T.frame=c,T.floating=t.controller.floating,T.alpha=t.style.opacity,T.index=p,T.parent=d,T.intent=(i=t.intent)||null!=i?i:"",!(t instanceof K.RootForma)){var C,v=t;t instanceof M.ImageForma&&(v=t.parent),(C=u.opt(u.opt(v,(function(e){return e.controller})),(function(e){return e.getBackgroundColor()})))&&(T.bgColor=C.rgbHex),T.bgColors=u.opt(v,(function(e){return e.controller.getBackgroundColors().map((function(e){return e.rgbHex}),h)}))||""}var P,S="";(P=t.style.colors.color(f.ColorRole.FieldPrimary))&&(S=P.rgbHex,T.color1=u.toString(S));var E,R="";(E=t.style.colors.color(f.ColorRole.FieldSecondary))&&(R=E.rgbHex,T.color2=u.toString(R));var F,I,b,k,V,j,W,X=[];if(t.style.colors.forEachColor((function(e,t,n){var o=t,a=n,i=u.clone(r.createColorRoleDictionary(e,o,a));X.push(i)})),T.colorRoles=u.clone(X),null!=(F=t.contentID)&&(T.contentId=F),I=u.as(t,M.ImageForma)){var z=N.ImageFacade.getFrameForForma(I),J=u.as(u.opt(z,(function(e){return e.controller})),_.FrameController);if(null==J)return T.error="parent isn't a frame. something is wrong with this forma. skipping...",void x.push(T);var Q="",$="",ee="",te="",ne="",oe="",ae=z.formaID;c=r.getFrameString(z),T.frame=c,(Ae=u.as(I.style,L.ImageStyle))&&(te=Ae.name);var ie=I.contentNode,le=u.opt(ie,(function(e){return e.mediaMetadata})),ue=u.clone(I.placement.inverse.transformPoints(I.parent.bounds.points)),ce=Math.round(I.bounds.width),de=Math.round(I.bounds.height);ee=Math.round(1e3*ce/de)/1e3+",";for(var he,pe,fe,me=[],ge=u.iter(ue);!ge.done;ge.next()){var ye=ge.value,_e=u.toString(Math.round(1e3*ye.x/ce)/1e3),Te=u.toString(Math.round(1e3*ye.y/de)/1e3);me.push(_e+","+Te)}ee+=me.join(","),null!=(xe=u.opt(le,(function(e){return e.searchTerm})))&&($=xe,null!=(he=u.opt(le,(function(e){return e.sourceURL})))&&(Q=he)),null!=(pe=u.opt(le,(function(e){return e.sourceName})))&&(ne=pe),null!=(fe=u.opt(le,(function(e){return e.licenseType})))&&(oe=fe);var Ce="",ve=u.clone(u.opt(ie,(function(e){return e.imageColorData})));if(null!=ve){u.sortInPlace(ve,(function(e,t){return e.coverage>t.coverage}));for(var Pe=[],Se=u.iter(ve);!Se.done;Se.next()){var Ae,De,Ee=Se.value;(Ae=u.as(I.style,L.ImageStyle))&&(De=u.opt(u.opt(ie,(function(e){return e.image})),(function(e){return e.getFilterColor(Ee.rgbColor,Ae)})))&&(Pe.push(De.rgbHex),Pe.push(u.toString(Math.round(1e3*Ee.coverage)/1e3)))}(Ce=Pe.join(",")).length>0&&(T.colorData=Ce)}T.crop=ee,T.filter=te,T.hasAlpha=I.hasAlpha(),T.hasBackgroundColor=J.hasBackgroundColor,T.hasCutout=J.hasCutout;var Re,Fe,Ie,be="off";J.cutoutMode==O.CutoutMode.BackgroundRemoval?be="bg":J.cutoutMode==O.CutoutMode.ForegroundRemoval&&(be="fg"),T.cutoutMode=be,T.maskType="none",(Re=N.ImageFacade.getMaskFormaForForma(I))&&(Fe=u.as(Re,q.ShapeForma))&&(T.maskType="shape:"+((s=Fe.shapeLibraryID)||null!=s?s:"?")),(Ie=N.ImageFacade.getCutoutMaskFormaForForma(I))&&null!=N.ImageFacade.getImageFormaForForma(Ie)&&(T.maskType="cutout"),T.cropID=ae,$.length>0&&(T.search=u.toString($)),Q.length>0&&(T.url=u.toString(Q)),ne.length>0&&(T.sourceType=u.toString(ne)),oe.length>0&&(T.licenseType=u.toString(oe));var Oe=u.opt(I.contentNode,(function(e){return e.image})),ke=u.clone(u.opt(Oe,(function(e){return e.getImageColors(5)}))||[]).map((function(e){return e.rgbHex}),h);T.palette=ke.length>0?ke.join(","):"n/a",x.push(T)}else if(t instanceof K.RootForma){var Me,Ne;(Me=u.as(t.controller,H.RootController))&&(Ne=Me.getGridController())&&(T.isBackgroundVisible=Ne.isBackgroundVisible()),Y=u.clone(T)}else if((b=u.as(t,q.ShapeForma))&&(k=u.as(b.style,Z.ShapeStyle))){if(null!=b.controller){var Le,xe,Be,we,Ge,Ye,Ue=u.as(b.contentNode,se.VectorContentNode);le=u.opt(Ue,(function(e){return e.mediaMetadata})),null!=(Le=u.opt(le,(function(e){return e.searchSource})))&&(T.searchSource=Le),null!=(xe=u.opt(le,(function(e){return e.searchTerm})))&&(T.searchTerm=xe),null!=(Be=u.opt(le,(function(e){return e.sourceURL})))&&(T.sourceURL=Be),null!=(we=u.opt(le,(function(e){return e.title})))&&(T.title=we),null!=(Ge=u.opt(le,(function(e){return e.tags})))&&(T.tags=Ge),null!=(Ye=u.opt(le,(function(e){return e.assetID})))&&(T.assetID=Ye),T.isBasicShape=k.isBasicShape(),B.push(T)}}else if((V=u.as(t.controller,re.TypeLockupController))&&(j=V.lockupStyle)){if(null==V.contentNode)return;var Ve=u.clone(r.getLockupMetaDataJSON(t));if(null!=Ve){X=[];for(var je=u.iter(V.getCurrentColorsWithRole(j,!0));!je.done;je.next()){var He=je.value,We=e.firstPage.colorLibraryController.getKeyOfNearColorInTheme(He.color),Ke=u.clone(r.createColorRoleDictionary(He.role,We,He.color));X.push(Ke)}for(var Xe=u.iter(u.keys(Ve));!Xe.done;Xe.next()){var ze=Xe.value;T[ze]=Ve[ze]}if(V.getCharacterStyleRanges().length>0){T.highlightStyle=u.clone(r.getMSLockupMetaDataJson(t));for(var qe=u.iter(j.characterStyles);!qe.done;qe.next()){var Ze=qe.key,Je=qe.value;Je.colors.forEachColor((function(e,t,n){if(!(e==f.ColorRole.FieldSecondary&&!Je.secondaryColorVisible||e==f.ColorRole.Shadow&&!w.LockupStyle.isShadowLook(Je.textLook)||e==f.ColorRole.Border&&!w.LockupStyle.isOutlineLook(Je.textLook))){var o=t,a=n,i=u.clone(r.createColorRoleDictionary(e,o,a,Ze+"-"));X.push(i)}}))}}T.colorRoles=u.clone(X),G.push(T)}}else if((W=u.as(t.controller,D.GroupController))&&W.userGroup){for(var Qe=[],$e=u.iter(t.visitAsArray(y.FormaTraversal.JustChildren));!$e.done;$e.next()){var et=$e.value;Qe.push(et.formaID)}T.children=Qe.join(","),U.push(T)}}}));var V={};return V.id=(l=t)||null!=l?l:e.id,V.sizeID=m,V.width=u.toString(p.pageSize.width),V.height=u.toString(p.pageSize.height),V.layout=P,V.margin=u.toString(E),V.spacing=u.toString(S),V.themeID=I,V.source=b,V.type=k,V.paletteID=F,V.palette=p.colorLibraryController.getCurrentThemeHexString(),x.length>0&&(V.images=u.clone(x)),G.length>0&&(V.text=u.clone(G)),B.length>0&&(V.shapes=u.clone(B)),U.length>0&&(V.groups=u.clone(U)),V.background=u.clone(Y),V},getColorRoleName:function(e){switch(e){case 0:return"none";case 1:return"primary";case 2:return"secondary";case 3:return"border";case 4:return"shadow";default:return"error"}},createColorRoleDictionary:function(e,t,n,o){void 0===t&&(t=null),void 0===n&&(n=null),void 0===o&&(o="");var a,i,s={};return s[o+"role"]=r.getColorRoleName(e),null!=(a=t)&&(s[o+"colorID"]=a),(i=n)&&(s[o+"color"]=i.rgbHex),s},getAnonymizedText:function(e){var t;return(t=u.as(e.controller,re.TypeLockupController))?u.chars(t.text).reduce((function(e,t){return t>="A"&&t<="Z"?e+"A":t>="a"&&t<="z"?e+"a":t>="0"&&t<="9"?e+"0":" \t\n.,!?$#@;()&".includes(t)?e+u.toString(t):e+"_"}),""):""},getLockupMetaDataString:function(e){var t,n="",o=r.getFrameString(e);if(t=u.as(e.controller,re.TypeLockupController)){var a,i=t.text,s="";(a=u.opt(u.opt(t.lockupStyle,(function(e){return e.font})),(function(e){return e.fontData})))&&(s=a.postScriptName);var l,c,d=t.lockupStyle.backingShapeID,h=t.lockupStyle.textLookAsString,p=t.lockupStyle.layoutType,m="",g="";(l=t.lockupStyle.colors.color(f.ColorRole.FieldPrimary))&&(m=l.rgbHex),t.lockupStyle.backing!=w.LockupBacking.None&&(c=t.lockupStyle.colors.color(f.ColorRole.FieldSecondary))&&(g=c.rgbHex);var y=Math.round(1e3*t.lockupStyle.currentTextOpacity)/1e3,_=Math.round(1e3*t.lockupStyle.currentBackingOpacity)/1e3,T=t.lockupStyle.textBacked?"1":"0",C=e.formaID.substr(0,8),v=Math.round(1e3*t.lockupStyle.shadowAngle)/1e3,P=Math.round(1e3*t.lockupStyle.shadowOffset)/1e3,S=Math.round(1e3*t.lockupStyle.spacing)/1e3,A=Math.round(1e3*t.lockupStyle.padding)/1e3,D=Math.round(1e3*t.lockupStyle.tracking)/1e3,E=Math.round(1e3*t.lockupStyle.strokeWeight)/1e3;n="id:'"+C+"', ft:'"+s,n+="', sh:'"+d+"', lk:'"+h,n+="', ly:'"+p+"', ln:"+u.toString(i.length),n+=", lh:"+u.toString(Math.round(t.avgLineHeight))+", fr:'"+o,n+="', ta:"+u.toString(y)+", ba:"+u.toString(_),n+=", c1:'"+m+"', c2:'"+g,n+=", fl:'"+T+"', bc:''";var R=u.clone((new X.RoleSuggester).getRole(e));n+=" r:'"+X.RoleSuggester.getShortLabel(R.role)+"', rc:"+Math.round(1e3*R.confidence)/1e3,n+=" sa:'"+u.toString(v)+"', so:'"+u.toString(P),n+="', sp:'"+u.toString(S)+"', pd:'"+u.toString(A),n+="', tr:'"+u.toString(D)+"', sw:'",n+=u.toString(E)+"'"}return n},getLockupMetaDataJSON:function(e){var t,n;if((t=u.as(e.controller,re.TypeLockupController))&&(n=t.contentNode)){var o,a=r.getFrameString(e,!0),i=n.text,s="";(o=u.opt(u.opt(t.lockupStyle,(function(e){return e.font})),(function(e){return e.fontData})))&&(s=o.postScriptName);var l,c,d=t.lockupStyle.backingShapeID,h=t.lockupStyle.textLookAsString,p=t.lockupStyle.layoutType,m="",g="";(l=t.lockupStyle.colors.color(f.ColorRole.FieldPrimary))&&(m=l.rgbHex),t.lockupStyle.backing!=w.LockupBacking.None&&(c=t.lockupStyle.colors.color(f.ColorRole.FieldSecondary))&&(g=c.rgbHex);var y,_=Math.round(1e3*t.lockupStyle.currentTextOpacity)/1e3,T=Math.round(1e3*t.lockupStyle.currentBackingOpacity)/1e3,C="";(y=t.getBackgroundColor())&&(C=y.rgbHex);var v=Math.round(1e3*t.lockupStyle.shadowAngle)/1e3,P=Math.round(1e3*t.lockupStyle.shadowOffset)/1e3,S=Math.round(1e3*t.lockupStyle.spacing)/1e3,A=Math.round(1e3*t.lockupStyle.padding)/1e3,D=Math.round(1e3*t.lockupStyle.tracking)/1e3,E=Math.round(1e3*t.lockupStyle.strokeWeight)/1e3,R={};return R.id=e.formaID,R.font=s,R.backingShape=d,R.look=h,R.layout=p,R.text=i,R.avgFontSize=u.toString(Math.round(t.getAverageFontSize())),R.frame=a,R.backingOpacity=u.toString(T),R.textOpacity=u.toString(_),R.color1=m,R.color2=g,R.backgroundColor=C,R.shadowAngle=u.toString(v),R.shadowOffset=u.toString(P),R.spacing=u.toString(S),R.padding=u.toString(A),R.tracking=u.toString(D),R.strokeWeight=u.toString(E),R.textBacked=u.toString(t.textBacked),R}return null},getMSLockupMetaDataString:function(e){var t,n="";if(t=u.as(e.controller,re.TypeLockupController)){n="id:'"+e.formaID.substr(0,8)+"'";for(var r=u.iter(t.lockupStyle.characterStyles);!r.done;r.next()){var o,a,i,s=r.key,l=r.value;n+=", chStyle:'"+s+"'",(o=u.opt(l.font,(function(e){return e.fontData})))&&(n+=", chFont:'"+o.postScriptName+"'"),l.backing!=w.LockupBacking.UNSET&&(n+=", chShape:'"+l.backingShapeID+"'"),l.textLook!=w.LockupTextLook.UNSET&&(n+=", chLook:'"+l.textLookAsString+"'"),l.textOpacity!=S.FormaStyle.OPACITY_UNSET&&(n+=", chTextOpacity:'"+l.textOpacity+"'"),l.backingOpacity!=S.FormaStyle.OPACITY_UNSET&&(n+=", chBackOpacity:'"+l.backingOpacity+"'"),(a=l.colors.color(f.ColorRole.FieldPrimary))&&(n+=", chColor1:'"+a.rgbHex+"'"),l.backing!=w.LockupBacking.None&&(i=l.colors.color(f.ColorRole.FieldSecondary))&&(n+=", chColor2:'"+i.rgbHex+"'")}}return n},getMSLockupMetaDataJson:function(e){var t,n={};if(t=u.as(e.controller,re.TypeLockupController))for(var r=u.iter(t.lockupStyle.characterStyles);!r.done;r.next()){var o,a=r.key,i=r.value;n.id=e.formaID,n.styleName=a,(o=u.opt(i.font,(function(e){return e.fontData})))&&(n.font=o.postScriptName),i.backing!=w.LockupBacking.UNSET&&(n.backingShape=i.backingShapeID),i.textLook!=w.LockupTextLook.UNSET&&(n.textLook=i.textLookAsString),i.textOpacity!=S.FormaStyle.OPACITY_UNSET&&(n.textOpacity=u.toString(i.textOpacity)),i.backingOpacity!=S.FormaStyle.OPACITY_UNSET&&(n.backingOpacity=u.toString(i.backingOpacity));var s,l,c="",d="";(s=i.colors.color(f.ColorRole.FieldPrimary))&&(c=s.rgbHex,n.color1=c),i.backing!=w.LockupBacking.None&&(l=i.colors.color(f.ColorRole.FieldSecondary))&&(d=l.rgbHex,n.color2=d);var h=t.getCharacterStyleRanges().map((function(e){return u.toString(e.start)+"-"+u.toString(e.end)}),this);n.ranges=h.join(", ")}return n},sliderToOpacityMapping:function(e){return Math.log(e*(l.OPACITY_LOG_SCALE-1)+1)/Math.log(l.OPACITY_LOG_SCALE)},opacityToSliderMapping:function(e){return(Math.exp(e*Math.log(l.OPACITY_LOG_SCALE))-1)/(l.OPACITY_LOG_SCALE-1)},sliderToSpacingPaddingMapping:function(e){return e},spacingPaddingToSliderMapping:function(e){return e},getKnownContent:function(e){var t={};return e.visitAll(y.FormaTraversal.PreOrderWithAuxiliaries,(function(e){var n,r;null!=(n=e.contentID)&&(t[n]=!0),(r=u.as(e,ue.VideoForma))&&(t[r.videoContentID]=!0)})),t},pruneOrphanedContent:function(e){if(0!=e.allowPrune){var t=e.beginTransaction("prune_orphaned_content"),n=u.clone(r.getKnownContent(e)),o=[];e.content.root.visitAll((function(t){t!=e.content.root&&null==n[t.id]&&o.push(t)}));for(var a=u.iter(o);!a.done;a.next()){var i,s=a.value;(i=s.parent)&&i.removeChild(s),s.releaseResources()}t.mergeWithPrevious()}},getUnreportedUsedIcons:function(e){var t=u.clone(r.getKnownContent(e)),n=[];e.content.root.visitAll((function(e){var r;if((r=u.as(e,se.VectorContentNode))&&r.shouldReportUsage()){var o=r.getUsageID();null!=o&&r.isUsageReported()&&!n.includes(o)&&null!=t[r.contentID]&&n.push(o)}}));var o=[],a=e.beginTransaction("updateIconUsage");return e.content.root.visitAll((function(e){var r;if(r=u.as(e,se.VectorContentNode)){var a=r.getUsageID();null!=a&&!r.isUsageReported()&&r.shouldReportUsage()&&(n.includes(a)?r.setUsageReported(!0):o.includes(a)||null==t[r.contentID]||o.push(a))}})),a.mergeWithPrevious(),o},reportedIconUsage:function(e,t){e.content.root.visitAll((function(e){var n;if(n=u.as(e,se.VectorContentNode)){var r=n.getUsageID();null!=r&&t.includes(r)&&n.setUsageReported(!0)}}))},clearReportedIconUsage:function(e){var t=!1;return e.content.root.visitAll((function(e){var n;(n=u.as(e,se.VectorContentNode))&&null!=n.getUsageID()&&n.isUsageReported()&&(t=!0,n.setUsageReported(!1))})),t},dumpDocumentInfo:function(e,t){var n="";n+="Document '"+e.documentName+"' "+t+".\nDocument history:",e.history.forEachEntry((function(e){return n+=" "+e+"\n"}));var o=e.getPageCount()>1;return j.PagesFacade.visitPages(e,(function(t){o&&(n+="Page Number:"+u.toString(e.getPageIndex(t)+1)+"\n");for(var a=u.clone(t.colorLibraryController.getThemeColorKeys()),i=u.iter(a);!i.done;i.next()){var s=i.value,l=t.colorLibraryController.getSolidColorForKey(s);n+="Theme color:"+s+" value:"+u.toString(u.opt(l,(function(e){return e.asString})))+"\n"}return n+="Page formae:\n",t.root.visitAll(y.FormaTraversal.PreOrder,(function(e){var t=r.getFormaNestingDepthString(e)+"  Forma kind: "+e.kind+" "+u.toString(u.opt(e.controller,(function(e){return e.kind})));null!=e.bounds&&(t+=" size: "+Math.round(e.bounds.width)+" x "+Math.round(e.bounds.height));var o=e.style.colors.colorID(f.ColorRole.FieldPrimary);if(null!=o&&(t+=" primary color:"+o),e.kind==$.TextForma.KIND)t+=" text: '"+e.text;else if(e.kind==q.ShapeForma.KIND)t+=" shapeID: '"+u.toString(e.shapeLibraryID);else if(e.kind==M.ImageForma.KIND){var a=e.contentNode;t+=null!=a?" Image size:"+a.pixelWidth+" x "+a.pixelHeight:"[Failed to find ContentNode for image]"}t+=" id: "+e.formaID+", contentID: "+u.toString(e.contentID)+", parent id: "+u.toString(u.opt(e.parent,(function(e){return e.formaID}))),n+=t+"\n"})),!0})),n+="Document Content:\n",e.content.root.visitAll((function(e){if(null!=u.as(e,ie.URLBasedContentNode)){var t=e;n+="  Node kind:"+t.kind+" id:"+t.id+" url:"+u.toString(t.url)+" source:"+u.toString(u.opt(t.mediaMetadata,(function(e){return e.sourceName})))+" assetID:"+u.toString(u.opt(t.mediaMetadata,(function(e){return e.assetID})))+"\n"}else n+="  Node kind:"+e.kind+" id:"+e.id+"\n"})),n},duplicateDocForSize:function(e,t){if(null!=e){var n=r.duplicateDocument(e);return j.PagesFacade.visitPages(n,(function(e){return e.setPageSizeFromDesignSize(t),!0})),n}return null},duplicateDocsForResizes:function(e,t){var n=[];if(null!=e)for(var o=u.iter(t);!o.done;o.next()){var a=o.value,i=r.duplicateDocument(e),s=i.beginTransaction("setPageSizeFromDesignSize");j.PagesFacade.visitPages(i,(function(e){return e.setPageSizeFromDesignSize(a),!0})),s.end(),n.push(i)}return n},duplicateDocForGrid:function(e,t){if(null!=e){var n=r.duplicateDocument(e);return null!=e.controller&&e.controller.inAutomaticLayoutInteractionMode&&u.opt(n.controller,(function(e){return e.setAutomaticLayoutInteractionMode()})),j.PagesFacade.visitPages(n,(function(e){var n=u.as(e.root.controller,H.RootController);u.opt(n,(function(e){return e.createGridControllerIfNone()}));var r=u.opt(n,(function(e){return e.getGridController()}));return u.opt(r,(function(e){return e.applyStyle(t,0)})),!0})),n}return null},duplicateDocsForGrids:function(e,t){var n=[];if(null!=e)for(var o=u.iter(t);!o.done;o.next()){var a=o.value,i=r.duplicateDocument(e);null!=e.controller&&e.controller.inAutomaticLayoutInteractionMode&&u.opt(i.controller,(function(e){return e.setAutomaticLayoutInteractionMode()})),j.PagesFacade.visitPages(i,(function(e){var t=u.as(e.root.controller,H.RootController);u.opt(t,(function(e){return e.createGridControllerIfNone()}));var n=u.opt(t,(function(e){return e.getGridController()}));return u.opt(n,(function(e){return e.applyStyle(a,0)})),!0})),n.push(i)}return n},getFormaNestingDepthString:function(e){for(var t="",n=e.parent;null!=n;)t+="  ",n=n.parent;return t},duplicateDocument:function(e){R.Host.imageAnalysis.useCache(!0);var t=new ne.TheoJSONEncoder;e.encode(t);var n=new te.TheoJSONDecoder(t.json());return Q.TheoDocument.init_209f(n,null)},mapFontSource:function(e){switch(e){case 0:return"unknown";case 1:case 2:case 3:return"spark-provided";case 4:return"user-uploaded";case 5:case 6:return"tk-synced"}},addFontFromStyle:function(e,t){if(null!=e.font){for(var n=e.font.fontData,o={postScriptName:n.postScriptName,source:r.mapFontSource(n.source)},a=!1,i=u.iter(t);!i.done;i.next()){var s=i.value;if(s.postScriptName==o.postScriptName&&s.source==o.source){a=!0;break}}a||t.push(o)}},getFontsUsed:function(e){for(var t=[],n=u.clone(e.filterWithCallback((function(e){return u.opt(e.controller,(function(e){return e.kind==re.TypeLockupController.KIND}))}))),o=u.iter(n);!o.done;o.next()){var a,i=o.value;if(a=u.as(i.style,w.LockupStyle)){r.addFontFromStyle(a,t);for(var s=u.iter(a.characterStyles);!s.done;s.next()){var l=s.value;r.addFontFromStyle(l,t)}}}return t},getContentCountsString:function(e){var t=new l.ContentCounts;return e.visitAll(y.FormaTraversal.PreOrder,(function(e){return r.addContentCountsForForma(e,t)})),t.stringify()},addContentCountsForForma:function(e,t){var n,r,o,a=!1;if(e.hasIntent(y.Forma.INTENT_LOGO)&&(t.logo+=1,a=!0),!(n=u.opt(e.controller,(function(e){return e.userGroup})))&&null==n||!n||((r=u.opt(e.controller,(function(e){return e.userGroupChild})))||null!=r)&&r||(t.group+=1),e.controller instanceof re.TypeLockupController)t.text+=1;else if(o=u.as(e,ue.VideoForma)){var i=!1;o.isSticker()&&(t.sticker+=1,i=!0),i||(t.video+=1)}else e instanceof M.ImageForma&&!a&&(e.parent.controller.floating?t.floatingImage+=1:t.image+=1)},getExtendedContentCountsString:function(e){var t=new l.ExtendedContentCounts;return e.visitAll(y.FormaTraversal.PreOrder,(function(e){return r.addExtendedContentCountsForForma(e,t)})),t.stringify()},addExtendedContentCountsForForma:function(e,t){var n,r;null!=(n=e.source)&&P.FormaSourceUtils.isDesignIngredient(n)&&(t.oneTap+=1),e instanceof M.ImageForma&&!e.hasIntent(y.Forma.INTENT_LOGO)&&N.ImageFacade.getCutoutModeForForma(e)==O.CutoutMode.BackgroundRemoval&&(t.removeBackground+=1),e.hasIntent(y.Forma.INTENT_ICON)&&(r=u.as(e.style,Z.ShapeStyle))&&(r.isBasicShape()?t.basicShape+=1:t.icon+=1)},getTextLayoutsString:function(e){for(var t={},n=u.clone(e.filterWithCallback((function(e){return u.opt(e.controller,(function(e){return e.kind==re.TypeLockupController.KIND}))}))),o=u.iter(n);!o.done;o.next()){var a=o.value;r.addTextLayoutForLockup(a,t)}return r.dictToAnalyticsString(t)},addTextLayoutForLockup:function(e,t){var n;if(n=u.as(e.style,w.LockupStyle))switch(n.layout){case 5:n.alignment==w.LockupAlignment.Right?t.letterGridRight=!0:n.alignment==w.LockupAlignment.Center?t.letterGridCenter=!0:t.letterGridLeft=!0;break;case 0:t.magic=!0;break;case 6:n.pathID==ae.TextPathID.SemiCircleDown?t.semiCircle=!0:n.pathID==ae.TextPathID.SemiCircleUp?t.invertedSemiCircle=!0:t.circle=!0;break;case 7:var r=ee.TextFacade.getCategoryForAutoAlignment(n.alignment);r==J.TypographyLayoutCategory.DropCap?t.autoDropCap=!0:r==J.TypographyLayoutCategory.Triplet?t.autoTriplet=!0:r==J.TypographyLayoutCategory.Rotate?t.autoRotate=!0:r==J.TypographyLayoutCategory.RotateFit&&(t.autoRotateFit=!0)}},unionFinalFrame:function(e){if(0==e.length)return null;for(var t=e[0].finalFrame,n=u.iter(e);!n.done;n.next()){var r=n.value;t=t.unionWith(r.finalFrame)}return t},validateDoc:function(e,t){void 0===t&&(t="");var n,r,o=this;function a(a,i){var s={};e.content.root.visitAll((function(e){var t,n={kind:e.kind,id:e.id};(t=u.as(e,ie.URLBasedContentNode))&&(n.componentID=t.componentID,n.mimeType=t.mimeType,n.url=t.url),s[e.id]=u.clone(n)}));var l,c=u.clone(e.filterWithCallback((function(e){return e.kind==M.ImageForma.KIND||e.kind==le.VectorForma.KIND||e.kind==q.ShapeForma.KIND}))).map((function(e){return{formaID:e.formaID,kind:e.kind,contentID:e.contentID}}),o),d=u.clone(u.as({errorMsg:a,location:t,docID:e.uuid,forma:i,formaID:i.formaID,contentID:(n=i.contentID)||null!=n?n:"",allContent:s,allFormae:c},["Dictionary","String","Any"]));return(l=u.opt(e.controller,(function(e){return e.undoRedoMgr})))&&(d.undoRedoState={currentState:l.debugDescribeCurrentState(),last5States:l.timeline.states.map((function(e){return(r=u.opt(e.action,(function(e){return e.description})))||null!=r?r:""}),o),nextUndo:l.getUndoDescription(),nextRedo:l.getRedoDescription()}),d}u.opt(R.Host.logging,(function(e){return e.info("validateDoc: validating document...")}));for(var i=u.clone(e.filterWithCallback((function(e){return u.opt(e.controller,(function(e){return e.kind==b.ImageController.KIND}))}))),s=u.iter(i);!s.done;s.next()){var l,c=s.value;if(l=u.as(c,M.ImageForma)){if(null==l.contentID)return a("forma has no contentID",l);var d,h,p=e.content.nodeByID(l.contentID);if(null==p)return a("could not locate content node for image forma",l);if((d=u.as(p,ie.URLBasedContentNode))&&null==d.url)return a("content node has no url",l);if((h=l.contentNode)&&h.id!=l.contentID)return a("cached content node does not match contentID",l)}}return null},debugFormaPath:function(e){for(var t=e,n=[];null!=t;){var r,o;r=(o=t.controller)?"(id="+t.id+",kind="+t.kind+",controller="+o.kind+")":"(id="+t.id+",kind="+t.kind+")",n.splice(0,0,r),t=u.opt(t,(function(e){return e.parent}))}return n.join("/")},enableFastHeuristicsForComplexPage:function(e,t){return void 0===t&&(t=!1),e.root.filterWithCallback((function(e){return null!=e.controller&&e.controller.floating})).length>(t?r.HIGH_DESIGN_COMPLEXITY_HEURISTIC_THRESHOLD:r.DESIGN_COMPLEXITY_HEURISTIC_THRESHOLD)},getIntersectingGraphics:function(e){var t,n;return(t=e.finalFrame)&&(n=e.root)?n.filterWithCallback((function(e){var n,r;return!(!(n=e.finalFrame)||!(r=n.intersectionWith(t)))&&e.isGraphic()&&e.kind!=M.ImageForma.KIND&&e.kind!=K.RootForma.KIND&&r.area/t.area>.01})):[]}}}),r),l.ContentCounts=(o=function(){this.image=0,this.floatingImage=0,this.text=0,this.logo=0,this.video=0,this.sticker=0,this.group=0},u.defineClass({name:"ContentCounts",ctor:o,props:{stringify:function(){return"[text:"+this.text+", image:"+this.image+", floatingImage:"+this.floatingImage+", logo:"+this.logo+", sticker:"+this.sticker+", video:"+this.video+", group:"+this.group+"]"}}}),o),l.ExtendedContentCounts=(a=function(){this.removeBackground=0,this.icon=0,this.basicShape=0,this.oneTap=0},u.defineClass({name:"ExtendedContentCounts",ctor:a,props:{stringify:function(){return"[1TapLockup:"+this.oneTap+", removeBg:"+this.removeBackground+", icon:"+this.icon+", basicShape:"+this.basicShape+"]"}}}),a),l.CoreDesignAnalytics=(i=function(e,t,n,r,o,a,i,s,l,u,c,d,h,p,f,m,g,y,_,T,C,v,P){this.size=e,this.designIngredientId=t,this.hasColor=n,this.hasLayout=r,this.fontsUsedID=o,this.includesPaidAdobeFonts=a,this.includesUploadedFonts=i,this.hasAnimation=s,this.animationStyle=l,this.hasAddedElement=u,this.hasAddedElementExt=c,this.hasDesignFilter=d,this.backgroundType=h,this.hasVariationTemplate=p,this.fontSizeMinMax=f,this.hasTextLayout=m,this.fontRecUsed=g,this.recommendationSourceCounts=y,this.recommendationTypeCounts=_,this.numPagesExported=T,this.numPagesInProject=C,this.colorThemeCategoryName=v,this.hasCustomCutout=P},s={},u.defineClass({name:"CoreDesignAnalytics",ctor:i,superName:"CoreObject",statics:{UNKNOWN_FIELD:"unknown",UNKNOWN_ALL:{get:function(){return void 0===s.UNKNOWN_ALL&&(s.UNKNOWN_ALL=new i("size:'original:"+i.UNKNOWN_FIELD+", exported:"+i.UNKNOWN_FIELD+", hasResized:"+i.UNKNOWN_FIELD+"'","designIngredientId:"+i.UNKNOWN_FIELD,"hasColor:"+i.UNKNOWN_FIELD,"hasLayout:"+i.UNKNOWN_FIELD,"fontsUsedID:"+i.UNKNOWN_FIELD,"includesPaidAdobeFonts:"+i.UNKNOWN_FIELD,i.UNKNOWN_FIELD,"hasAnimation:"+i.UNKNOWN_FIELD,"animationStyle:"+i.UNKNOWN_FIELD,"hasAddedElement:"+i.UNKNOWN_FIELD,"hasAddedElementExt:"+i.UNKNOWN_FIELD,"hasDesignFilter:"+i.UNKNOWN_FIELD,"backgroundType:"+i.UNKNOWN_FIELD,"hasVariationTemplate:"+i.UNKNOWN_FIELD,"fontSizeMin:"+i.UNKNOWN_FIELD+"fontSizeMax:"+i.UNKNOWN_FIELD,"hasTextLayout:"+i.UNKNOWN_FIELD,"fontRecUsed:"+i.UNKNOWN_FIELD,"recommendationSourceCounts:"+i.UNKNOWN_FIELD,"recommendationTypeCounts:"+i.UNKNOWN_FIELD,"numPagesExported:"+i.UNKNOWN_FIELD,"numPagesInProject:"+i.UNKNOWN_FIELD,"colorThemeCategoryName:"+i.UNKNOWN_FIELD,"hasCutout"+i.UNKNOWN_FIELD)),s.UNKNOWN_ALL}}}}),i)},T8w7:function(e,t,n){var r,o=t,a=n("oAGj"),i=n("gXiO"),s=n("FNB+"),l=n("QbzR"),u=n("X0GW"),c=n("lmwz"),d=n("uxH+"),h=n("8t9B");o.OpacityFacade=(r=function(){i.CoreObject.call(this)},a.defineClass({name:"OpacityFacade",ctor:r,superName:"CoreObject",statics:{applyOpacity:function(e,t){for(var n=a.iter(t);!n.done;n.next()){var r=n.value;a.opt(r.controller,(function(t){return t.applyOpacity(e)}))}},getOpacityForForma:function(e){var t;return(t=a.opt(e.controller,(function(e){return e.currentOpacity})))||null!=t?t:1},applyTextOpacity:function(e,t){for(var n=a.iter(t);!n.done;n.next()){var r=n.value;a.opt(a.as(r.controller,h.TypeLockupController),(function(t){return t.applyTextOpacity(e)}))}},applyShapeOpacity:function(e,t){for(var n=a.iter(t);!n.done;n.next()){var r=n.value;a.opt(a.as(r.controller,h.TypeLockupController),(function(t){return t.applyShapeOpacity(e)}))}},getShapeOpacityForForma:function(e){var t;return(t=a.as(e.controller,h.TypeLockupController))?t.currentShapeOpacity:l.FormaStyle.OPACITY_UNSET},applyBackgroundOpacity:function(e,t){var n;(n=a.as(t.root.controller,d.RootController))&&n.setBackgroundTransparency(e)},getBackgroundOpacity:function(e){var t;return(t=a.as(e.root.controller,d.RootController))?t.getBackgroundTransparency():1},applyBlendMode:function(e,t){for(var n=a.iter(t);!n.done;n.next()){var r=n.value;a.opt(r.controller,(function(t){return t.applyBlendMode(e)}))}},getBlendModeForForma:function(e){return e.style.blendMode},formaHasNonNormalBlendMode:function(e){return r.getBlendModeForForma(e)!=l.FormaBlendMode.Normal},formaCanHaveBlendMode:function(e){var t,n,r=!1;return u.GroupFacade.isInsideUserGroup(e)||(e.isImage()?(t=c.ImageFacade.getFrameFormaForForma(e))&&(n=t.controller)&&(r=!e.isVideo()&&!e.isLogo()&&!e.isSticker()&&n.floating):e.isShape()&&(r=!e.isGridCell())),r},getBlendModeUseForAnalytics:function(e){var t=!1,n=!1;return e.visitAll(s.FormaTraversal.PreOrder,(function(e){if(r.formaCanHaveBlendMode(e)){var o=r.getBlendModeForForma(e);o==l.FormaBlendMode.Multiply?t=!0:o==l.FormaBlendMode.Screen&&(n=!0)}})),t&&n?"multiply,screen":t?"multiply":n?"screen":"none"}}}),r)},T9pj:function(e,t,n){var r,o=t,a=n("oAGj"),i=n("gXiO");o.ErrorMessageConstants=(r=function(){i.CoreObject.call(this)},a.defineClass({name:"ErrorMessageConstants",ctor:r,superName:"CoreObject",statics:{kDefaultBadRequestError:"Bad request",kSaveImageToDBError:"Failed to save image component",kAuthError:"Authorization failed",kRequestTimedout:"Request timed out",kServiceNotFound:"Service not found",kServiceUnavailableError:"Service is unavailable",kNoNetworkConnection:"No Internet connection",kBadResponse:"Bad server response",kServiceUnreachableError:"Service unreachable",kUnknownError:"Unexpected error occurred",kAddTextMissingFontError:"kAddTextMissingFontError"}}),r)},TbN7:function(e,t,n){var r,o,a,i=t,s=n("oAGj"),l=n("90dd");i.InsertedSwatchesMessage=(r=function e(t,n,r){this.index=n,this.swatches=s.clone(r),l.TheoMessage.call(this,e.TYPE,t)},s.defineClass({name:"InsertedSwatchesMessage",ctor:r,superName:"TheoMessage",statics:{TYPE:{get:function(){return"InsertedSwatchesMessage"}}}}),r),i.RemovedSwatchesMessage=(o=function e(t,n,r){this.index=n,this.swatches=s.clone(r),l.TheoMessage.call(this,e.TYPE,t)},s.defineClass({name:"RemovedSwatchesMessage",ctor:o,superName:"TheoMessage",statics:{TYPE:{get:function(){return"RemovedSwatchesMessage"}}}}),o),i.ReplacedSwatchesMessage=(a=function e(t,n){this.oldSwatches=s.clone(n),l.TheoMessage.call(this,e.TYPE,t)},s.defineClass({name:"ReplacedSwatchesMessage",ctor:a,superName:"TheoMessage",statics:{TYPE:{get:function(){return"ReplacedSwatchesMessage"}}}}),a)},URxh:function(e,t,n){var r,o,a,i=t,s=n("oAGj"),l=n("VQVe"),u=n("dJuF"),c=n("ZhwN"),d=n("tGKA"),h=n("Quhx"),p=n("x4Gy"),f=n("RkYL"),m=n("xm77");i.KeyFrame=(r=function(e,t,n,r,o,a){this.renderRuns=new p.RenderRuns,void 0===n&&(n=null),void 0===r&&(r=null),void 0===o&&(o=null),void 0===a&&(a=!1),this.time_=e,this.timingFunction_=t,this.placement_=n||d.Matrix2D.Identity,this.bounds_=r,this.style_=s.opt(o,(function(e){return e.clone()})),this.relativePlacement_=a},s.defineClass({name:"KeyFrame",ctor:r,superName:"CoreObject",statics:{makeFromTimeAndStyle:function(e,t){return new r(e,m.TimingFunctionType.Linear,d.Matrix2D.Identity,null,t)}},props:{time:{get:function(){return this.time_}},timingFunction:{get:function(){return this.timingFunction_}},placement:{get:function(){return this.placement_}},style:{get:function(){return this.style_}},bounds:{get:function(){return this.bounds_}},relativePlacement:{get:function(){return this.relativePlacement_}},stillKeyframe:{get:function(){return null==this.style&&this.placement.equal(d.Matrix2D.Identity)&&null==this.bounds}}}}),r),i.FormaAnimation=(o=function(){this.valid_=!0},a={},s.defineClass({name:"FormaAnimation",ctor:o,superName:"PostDCXObject",statics:{KIND:{get:function(){return"FormaAnimation"}},SCHEMA_CLASS_NAME:"FormaAnimation",codec:{get:function(){return void 0===a.codec&&(a.codec=u.DBPropertyCodec.registerCodec(o.SCHEMA_CLASS_NAME,u.DBPropertyCodec.directObjectCodec(o.SCHEMA_CLASS_NAME))),a.codec}},factory:{get:function(){return function(e,t,n,r){return o.init_866e(n,e)}}},PROPERTY_KIND:"kind",PROPERTY_START_TIME:"start-time",PROPERTY_END_TIME:"end-time",PROPERTY_KEY_FRAMES:"key-frames",PROPERTY_ANIMATION_STYLE:"animation-style",createDefault:function(){return o.init_9e82(l.AnimationStyle.init_b946(),f.TheoTime.Zero,f.TheoTime.Zero,[])},_implements:function(e){return"IDBObject"==e||"TheoMessagePublisher"==e}},props:{init_9e82:function(e,t,n,r){this.persistedKeyFrames_=s.clone(r),s.super_init(this,h.PostDCXObject,h.PostDCXObject.prototype.init_dd5d,{},{"start-time":t,"end-time":n,"animation-style":e.clone(),"key-frames":r,kind:o.KIND})},init_866e:function(e,t){s.super_init(this,h.PostDCXObject,h.PostDCXObject.prototype.init_866e,e,t)},init_dd5d:function(e,t){s.super_init(this,h.PostDCXObject,h.PostDCXObject.prototype.init_dd5d,e,t)},didChangeState:function(e){h.PostDCXObject.prototype.didChangeState.call(this,e),null!=e[o.PROPERTY_KEY_FRAMES]&&(this.persistedKeyFrames_=null),this.invalidate()},willCommitState:function(){h.PostDCXObject.prototype.willCommitState.call(this),null!=this.pendingKeyFrames_&&(this.set(o.PROPERTY_KEY_FRAMES,this.pendingKeyFrames_),this.persistedKeyFrames_=s.clone(this.pendingKeyFrames_),this.pendingKeyFrames_=null)},className:{get:function(){return o.SCHEMA_CLASS_NAME}},startTime:{get:function(){var e;return(e=s.as(this.get(o.PROPERTY_START_TIME),f.TheoTime))||null!=e?e:f.TheoTime.Zero},set:function(e){this.set(o.PROPERTY_START_TIME,e)}},endTime:{get:function(){var e;return(e=s.as(this.get(o.PROPERTY_END_TIME),f.TheoTime))||null!=e?e:f.TheoTime.Zero},set:function(e){this.set(o.PROPERTY_END_TIME,e)}},persistedKeyFrames:{get:function(){var e;return null==this.persistedKeyFrames_&&(this.persistedKeyFrames_=s.clone((e=s.as(this.get(o.PROPERTY_KEY_FRAMES),["Array",i.KeyFrame]))||null!=e?e:[])),this.persistedKeyFrames_}},keyFrames:{get:function(){return this.pendingKeyFrames_||this.persistedKeyFrames},set:function(e){this.pendingKeyFrames_=s.clone(e)}},animationStyle:{get:function(){return this.get(o.PROPERTY_ANIMATION_STYLE)}},clone:function(){return this.fork(c.GUIDUtils.makeGUID())},invalidate:function(){this.valid_=!1},valid:{get:function(){return this.valid_}}}}),o)},V3yt:function(e,t,n){var r,o=t,a=n("oAGj"),i=n("yGNn"),s=n("iCxV");o.FontFacade=(r=function(){},a.defineClass({name:"FontFacade",ctor:r,statics:{ensureFontLoaded:function(e){switch(e.availability){case 1:var t;return(t=s.Host.fontProvider)?new i.CorePromise((function(n,r){return t.loadFont(e,(function(){return n(e)}),(function(){return r("could not load font")}))})):i.CorePromise.reject("Host.fontProvider not available; can't load font.");case 2:return i.CorePromise.resolve(e);case 3:return i.CorePromise.reject("font cannot be loaded");case 0:return i.CorePromise.reject("font unknown loadable")}}}}),r)},VJ9E:function(e,t,n){var r,o=t,a=n("oAGj"),i=n("QgZx"),s=n("iCxV"),l=n("3lr5"),u=n("fNpk");o.TheoFont=(r=function(){this.roleOrder=["headline-font","body-font","body-font-italic","body-font-bold","body-font-bold-italic","secondary-font"]},a.defineClass({name:"TheoFont",ctor:r,superName:"CoreObject",statics:{SPARK_FONT_ROLE_HEADLINE:"headline-font",SPARK_FONT_ROLE_BODY:"body-font",SPARK_FONT_ROLE_BODY_ITALIC:"body-font-italic",SPARK_FONT_ROLE_BODY_BOLD:"body-font-bold",SPARK_FONT_ROLE_BODY_BOLD_ITALIC:"body-font-bold-italic",SPARK_FONT_ROLE_SECONDARY:"secondary-font",SPARK_FONT_ROLE_CUSTOM:"custom",decodeJson:function(e,t){if(null==e)return null;var n=a.as(e,["Dictionary","String","Any"]);if(null==n)return u.LegacyCoreAssert.fail("TheoFont.decodeJson: object passed isn't a dictionary",void 0,"TheoFont.decodeJson","TheoFont.swift",106),null;var o,s=a.as(n[i.FontDescriptor.PROPERTY_POSTSCRIPT_NAME],"String");if(o=i.FontDescriptor.decodeJson(e,t)){if(s==o.postScriptName){var l=a.as(n.sparkElementID,"String"),c=a.clone(a.as(n.sparkRoles,["Array","String"]));return r.init_9e5c(o,l,c)}return r.init_9e5c(o)}return null}},props:{init_9e5c:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=null),this.fontData=e,this.sparkElementID=t,this.sparkRoles=a.clone(n)},init_a314:function(e){this.sparkElementID=e.id,this.sparkRoles=a.clone(e.acRoles);var t,n,r=s.Host.fontProvider.getIncludedFonts(l.ANY_DOCUMENT);(t=e.descriptor)?null!=(n=r.indexOf(t))?this.fontData=r.fontAt(n):(a.opt(s.Host.logging,(function(e){return e.warning("Failed to find brandkit font "+t.postScriptName+" in list of available fonts, using 0th")})),this.fontData=r.fontAt(0)):"faux-font"==e.sourceType?(a.opt(s.Host.logging,(function(e){return e.warning("TheoFont: Failed to find synthesized brandkit font in list of available fonts, using 0th font")})),this.fontData=r.fontAt(0)):(a.opt(s.Host.logging,(function(e){return e.warning("TheoFont: Failed to find brandkit font in list of available fonts, using 0th font")})),this.fontData=r.fontAt(0))},isSparkFont:function(){return null!=this.sparkRoles||null!=this.sparkElementID},getSparkFontRole:function(){if(null==this.sparkRoles)return null;for(var e=a.iter(this.roleOrder);!e.done;e.next()){var t=e.value;if(this.sparkRoles.includes(t))return t}return null},hasSparkFontRole:function(e){return null!=this.sparkRoles&&this.sparkRoles.includes(e)},encodeJson:function(){var e=this.fontData.encodeJson();return null!=this.sparkElementID&&(e.sparkElementID=this.sparkElementID),null!=this.sparkRoles&&(e.sparkRoles=a.clone(this.sparkRoles)),e},isEqual:function(e){var t;return!!(t=a.as(e,r))&&t.fontData.isEqual(this.fontData)&&t.sparkElementID==this.sparkElementID&&t.getSparkFontRole()==this.getSparkFontRole()}}}),r),o._equality_TheoFont_TheoFont=function(e,t){return e.isEqual(t)}},VQVe:function(e,t,n){var r,o,a=t,i=n("oAGj"),s=n("dJuF"),l=n("ZhwN"),u=n("Quhx"),c=n("RkYL");a.AnimationStyleCategory=i.defineEnum("AnimationStyleCategory",{None:"none",Text:"text",Image:"image"}),a.AnimationStyle=(r=function(){this.hasDeprecatedProperties=!1},o={},i.defineClass({name:"AnimationStyle",ctor:r,superName:"PostDCXObject",statics:{SCHEMA_CLASS_NAME:"AnimationStyle",codec:{get:function(){return void 0===o.codec&&(o.codec=s.DBPropertyCodec.registerCodec(r.SCHEMA_CLASS_NAME,s.DBPropertyCodec.directObjectCodec(r.SCHEMA_CLASS_NAME))),o.codec}},factory:{get:function(){return function(e,t,n,o){return r.init_866e(n,e)}}},DEFAULT_TIMESCALE:{get:function(){return 30}},DEFAULT_START:{get:function(){return new c.TheoTime(0,r.DEFAULT_TIMESCALE)}},NOOP_DURATION:{get:function(){return new c.TheoTime(0,r.DEFAULT_TIMESCALE)}},DEFAULT_DURATION:{get:function(){return new c.TheoTime(75,r.DEFAULT_TIMESCALE)}},STILL_DURATION:{get:function(){return new c.TheoTime(60,r.DEFAULT_TIMESCALE)}},END_GIF_DURATION:{get:function(){return new c.TheoTime(150,r.DEFAULT_TIMESCALE)}},GIF_DURATION:{get:function(){return new c.TheoTime(150,r.DEFAULT_TIMESCALE)}},FADE_DURATION:{get:function(){return new c.TheoTime(30,r.DEFAULT_TIMESCALE)}},COLOR_SWAP_DURATION:{get:function(){return new c.TheoTime(180,r.DEFAULT_TIMESCALE)}},PROPERTY_NAME:"name",PROPERTY_VARIANT:"variant",PROPERTY_VARIANT_COUNT:"variant-count",PROPERTY_START_TIME:"start-time",PROPERTY_END_TIME:"end-time",PROPERTY_LOOPING:"looping",PROPERTY_CATEGORY:"category",DEPRECATED_PROPERTY_TEXT_STYLE:"text-style",DEPRECATED_PROPERTY_IMAGE_STYLE:"image-style",NAME_NO_STYLE:"None",NAME_TYPE:"Type",LETTER_APPEAR_VARIANT:10,LETTER_RANDOM_FADE_VARIANT:11,LETTER_APPEAR_FADE_VARIANT:12,NAME_FLICKER:"Flicker",NAME_GROW:"Grow",NAME_FADE:"Fade",NAME_DYNAMIC:"Dynamic",WORD_ZOOM_IN_VARIANT:0,WORD_CENTERED_VARIANT:1,WORD_APPEAR_VARIANT:2,NAME_COLORSWAP:"ColorSwap",NAME_SLIDE:"Slide",NAME_ZOOM:"Zoom",NAME_PAN:"Pan",NAME_GRAYSCALE:"Greyscale",NAME_BLUR:"Blur",NAME_COLOR:"Color",NAME_FILL:"Fill",noStyleAsString:function(){return r.NAME_NO_STYLE+"_0"},_implements:function(e){return"IDBObject"==e||"TheoMessagePublisher"==e}},props:{init_866e:function(e,t){i.super_init(this,u.PostDCXObject,u.PostDCXObject.prototype.init_866e,e,t),this.hasDeprecatedProperties=null!=this.initialState.getProperty(r.DEPRECATED_PROPERTY_IMAGE_STYLE)||null!=this.initialState.getProperty(r.DEPRECATED_PROPERTY_TEXT_STYLE)},init_dd5d:function(e,t){i.super_init(this,u.PostDCXObject,u.PostDCXObject.prototype.init_dd5d,e,t)},init_b946:function(e,t){void 0===e&&(e=r.NAME_NO_STYLE),void 0===t&&(t=a.AnimationStyleCategory.None),i.super_init(this,u.PostDCXObject,u.PostDCXObject.prototype.init_dd5d,{},{name:e,variant:0,"variant-count":1,"start-time":new c.TheoTime(0,r.DEFAULT_DURATION.timescale),"end-time":r.DEFAULT_DURATION,looping:!1,category:t})},init_e14f:function(e,t,n,o,s){void 0===o&&(o=a.AnimationStyleCategory.None),void 0===s&&(s=!1),i.super_init(this,u.PostDCXObject,u.PostDCXObject.prototype.init_dd5d,{},{name:e,variant:t,"variant-count":n,"start-time":new c.TheoTime(0,r.DEFAULT_DURATION.timescale),"end-time":r.DEFAULT_DURATION,looping:s,category:o})},init_d915:function(e,t,n,r,o,s,l){void 0===s&&(s=a.AnimationStyleCategory.None),void 0===l&&(l=!1),i.super_init(this,u.PostDCXObject,u.PostDCXObject.prototype.init_dd5d,{},{name:e,variant:t,"variant-count":n,"start-time":r,"end-time":o,looping:l,category:s})},className:{get:function(){return r.SCHEMA_CLASS_NAME}},willCommitState:function(){var e,t;this.hasDeprecatedProperties&&this.persisted&&(null==i.as(this.get(r.PROPERTY_CATEGORY),"String")&&(((e=i.as(this.get(r.DEPRECATED_PROPERTY_TEXT_STYLE),"Bool"))||null!=e)&&e?this.set(r.PROPERTY_CATEGORY,a.AnimationStyleCategory.Text):((t=i.as(this.get(r.DEPRECATED_PROPERTY_IMAGE_STYLE),"Bool"))||null!=t)&&t?this.set(r.PROPERTY_CATEGORY,a.AnimationStyleCategory.Image):this.set(r.PROPERTY_CATEGORY,a.AnimationStyleCategory.None)),this.removeProperty(r.DEPRECATED_PROPERTY_TEXT_STYLE),this.removeProperty(r.DEPRECATED_PROPERTY_IMAGE_STYLE),this.hasDeprecatedProperties=!1),u.PostDCXObject.prototype.willCommitState.call(this)},name:{get:function(){var e;return(e=i.as(this.get(r.PROPERTY_NAME),"String"))||null!=e?e:"None"}},startTime:{get:function(){var e;return(e=i.as(this.get(r.PROPERTY_START_TIME),c.TheoTime))||null!=e?e:new c.TheoTime(0,r.DEFAULT_DURATION.timescale)},set:function(e){this.set(r.PROPERTY_START_TIME,e)}},endTime:{get:function(){var e;return(e=i.as(this.get(r.PROPERTY_END_TIME),c.TheoTime))||null!=e?e:r.DEFAULT_DURATION},set:function(e){this.set(r.PROPERTY_END_TIME,e)}},variant:{get:function(){var e;return(e=i.as(this.get(r.PROPERTY_VARIANT),"Int"))||null!=e?e:0},set:function(e){this.set(r.PROPERTY_VARIANT,e)}},variantCount:{get:function(){var e;return(e=i.as(this.get(r.PROPERTY_VARIANT_COUNT),"Int"))||null!=e?e:1},set:function(e){this.set(r.PROPERTY_VARIANT_COUNT,e)}},textStyle:{get:function(){return this.category==a.AnimationStyleCategory.Text}},imageStyle:{get:function(){return this.category==a.AnimationStyleCategory.Image}},category:{get:function(){var e,t,n,o;return null!=(o=i.as(this.get(r.PROPERTY_CATEGORY),"String"))?(e=a.AnimationStyleCategory.toCaseValue(o))||null!=e?e:a.AnimationStyleCategory.None:((t=i.as(this.get(r.DEPRECATED_PROPERTY_TEXT_STYLE),"Bool"))||null!=t)&&t?a.AnimationStyleCategory.Text:((n=i.as(this.get(r.DEPRECATED_PROPERTY_IMAGE_STYLE),"Bool"))||null!=n)&&n?a.AnimationStyleCategory.Image:a.AnimationStyleCategory.None}},looping:{get:function(){var e;return!(!(e=i.as(this.get(r.PROPERTY_LOOPING),"Bool"))&&null==e)&&e},set:function(e){this.set(r.PROPERTY_LOOPING,e)}},modifiesFormaTree:{get:function(){return this.name==r.NAME_FLICKER||this.name==r.NAME_TYPE||this.name==r.NAME_FADE}},isNewTextAnimation:{get:function(){return this.name==r.NAME_TYPE||this.name==r.NAME_DYNAMIC||this.name==r.NAME_FLICKER||this.name==r.NAME_COLORSWAP}},clone:function(){return this.fork(l.GUIDUtils.makeGUID())},equals:function(e){return e.name==this.name&&e.variant==this.variant},asString:{get:function(){return this.name+"_"+this.variant}},isNoStyle:function(){return this.name==r.NAME_NO_STYLE}}}),r)},Vfmf:function(e,t,n){var r,o=t,a=n("oAGj"),i=n("SpAV"),s=n("gXiO"),l=n("FNB+"),u=n("iCxV"),c=n("8vXU"),d=n("7pIX"),h=n("fdtz"),p=n("rxGp"),f=n("VkKB"),m=n("T6jX");o.PreflightResultCode=a.defineEnum("PreflightResultCode",{success:0,internetConnectionRequired:1,sharedDocumentOnMobile:2,containsPaidItems:3,containsUnlicensableItems:4,downgradedUserNeedsLimitedEntitlement:5,requiresLimitedEntitlement:6,paidImagesNotAllowedInTemplates:7,limitedImagesNotAllowedInTemplates:8,freeImagesNotAllowedInTemplates:9,parameterError:10,metadataError:11,licensingError:12,exceededQuotaError:13}),o.OperationType=a.defineEnum("OperationType",{openOwned:0,openShared:1,duplicateOwned:2,duplicateShared:3,publishPrivateTemplate:4,publishPublicTemplate:5,remixTemplate:6}),o.StockWorkflowUtils=(r=function(){s.CoreObject.call(this)},a.defineClass({name:"StockWorkflowUtils",ctor:r,superName:"CoreObject",statics:{kResultCodeKey:"result_code",kUnlicensedAssetListKey:"unlicensedAssetIDs",kStockMetadataPremiumLevelIDKey:"premium_level_id",kStockMetadataIsLicensedKey:"is_licensed",kLicenseResultLicenseDataKey:"licenseData",kLicenseResultLicenseNameKey:"license",kLicenseNameStandard:"Standard",kLicenseNameLimited:"Limited",kLicenseNameExtended:"Extended",kLicenseResultLicenseErrorKey:"error",kAdobeStockExceededQuotaErrorValue:"202",alwaysRetryLicense:!1,kNoUnlicensedAssets:{Standard:[],Limited:[]},preflightAndLicenseImagesForOperation:function(e,t,n,i,s,l,c){var h,p=u.Host.stockLicense.getUserEntitlement();if(e==o.OperationType.openOwned||e==o.OperationType.duplicateOwned)return 0==a.clone(m.TheoDocumentUtils.limitedLicensedStockImageIDs(t)).length?void l(o.PreflightResultCode.success):p==d.StockUserEntitlement.onlyGlobalFree||p==d.StockUserEntitlement.onlyFree?void c(o.PreflightResultCode.downgradedUserNeedsLimitedEntitlement):void l(o.PreflightResultCode.success);s?c(o.PreflightResultCode.internetConnectionRequired):e!=o.OperationType.publishPrivateTemplate&&e!=o.OperationType.publishPublicTemplate?i&&e==o.OperationType.openShared||e==o.OperationType.duplicateShared?c(o.PreflightResultCode.sharedDocumentOnMobile):(o.OperationType.openShared,u.Host.stockLicense.asyncGetMetadataForAssetIDs(n,(function(n){var s,u=a.clone(r.preflightOnlineDocumentOperation(e,t,n,p,i)),d=(h=a.as(u[r.kResultCodeKey],o.PreflightResultCode))||null!=h?h:o.PreflightResultCode.metadataError;d!=o.PreflightResultCode.success?c(d):(s=a.as(u[r.kUnlicensedAssetListKey],["Dictionary","String",["Array","String"]]))?r.obtainNecessaryLicenses(t,s,n,(function(n,a){e!=o.OperationType.openShared&&r.updateLicensesAndMediaMetadata(t,n,a),l(o.PreflightResultCode.success)}),(function(e){return c(e)})):l(o.PreflightResultCode.success)}),(function(e){return c(o.PreflightResultCode.metadataError)}))):r.preflightPublishTemplateOperation(e,t,n,p,i,l,c)},obtainNecessaryLicenses:function(e,t,n,i,s){u.Host.stockLicense.asyncGetLicensesForAssetIDs(t,(function(e){return i(e,n)}),(function(e,t){var n;if(e=o.PreflightResultCode.licensingError,n=t)for(var i=a.iter(a.values(n));!i.done;i.next()){var l,u,c=i.value;if((l=a.as(c,["Dictionary","String","Any"]))&&null!=(u=a.as(l[r.kLicenseResultLicenseErrorKey],"String"))&&u==r.kAdobeStockExceededQuotaErrorValue){e=o.PreflightResultCode.exceededQuotaError;break}}s(e)}))},getErrorResult:function(e){return{result_code:e,unlicensedAssetIDs:r.kNoUnlicensedAssets}},getSuccessResult:function(e){var t;return void 0===e&&(e=null),(t=e)?{result_code:o.PreflightResultCode.success,unlicensedAssetIDs:t}:{result_code:o.PreflightResultCode.success}},preflightOnlineDocumentOperation:function(e,t,n,i,s){if(0==n.length)return r.getErrorResult(o.PreflightResultCode.parameterError);for(var l,u={Standard:[],Limited:[]},c=r.alwaysRetryLicense||e==o.OperationType.duplicateShared,h=null,p=a.iter(n);!p.done;p.next()){var m,g,y,_=p.value;if(null!=(m=a.as(_.id,"Int"))&&null!=(g=a.as(_[r.kStockMetadataPremiumLevelIDKey],"Int"))&&null!=(y=a.as(_[r.kStockMetadataIsLicensedKey],"String"))){var T=!a.isEmpty(y),C="Limited"==y,v=g==f.MediaMetadata.StockLicensePremiumLevel.Free,P=g==f.MediaMetadata.StockLicensePremiumLevel.Premium,S=!v&&!P;if(T){if(C)if(i==d.StockUserEntitlement.onlyGlobalFree||i==d.StockUserEntitlement.onlyFree){if(!v){h=a.clone(r.getErrorResult(o.PreflightResultCode.downgradedUserNeedsLimitedEntitlement));break}a.opt(u[r.kLicenseNameStandard],(function(e){return e.push(a.toString(m))}))}else c&&a.opt(u[r.kLicenseNameLimited],(function(e){return e.push(a.toString(m))}))}else if(v)a.opt(u[r.kLicenseNameStandard],(function(e){return e.push(a.toString(m))}));else if(P){if(i==d.StockUserEntitlement.onlyGlobalFree||i==d.StockUserEntitlement.onlyFree){h=a.clone(r.getErrorResult(o.PreflightResultCode.requiresLimitedEntitlement));break}a.opt(u[r.kLicenseNameLimited],(function(e){return e.push(a.toString(m))}))}else if(S){h=a.clone(r.getErrorResult(o.PreflightResultCode.containsPaidItems));break}}}return(l=h)?l:r.getSuccessResult(u)},preflightPublishTemplateOperation:function(e,t,n,i,s,l,c){var d,h=this,p=!1;e==o.OperationType.publishPrivateTemplate&&(p=!0),u.Host.stockLicense.asyncGetMetadataForAssetIDs(n,(function(e){for(var t=!1,i=!1,s=a.iter(n);!s.done;s.next()){var u,m,g=s.value;if(!(u=a.clone(e.find((function(e){return g==a.toString((d=a.as(e.id,"Int"))||null!=d?d:0)}),h))))return void c(o.PreflightResultCode.metadataError);if(null!=(m=a.as(u[r.kStockMetadataPremiumLevelIDKey],"Int")))switch(m){case f.MediaMetadata.StockLicensePremiumLevel.Free:break;case f.MediaMetadata.StockLicensePremiumLevel.Premium:t=!0;break;default:i=!0}}var y=o.PreflightResultCode.success;i?y=o.PreflightResultCode.paidImagesNotAllowedInTemplates:t&&!p&&(y=o.PreflightResultCode.limitedImagesNotAllowedInTemplates),y==o.PreflightResultCode.success?l(o.PreflightResultCode.success):c(y)}),(function(e){return c(o.PreflightResultCode.metadataError)}))},updateLicensesAndMediaMetadata:function(e,t,n){for(var o,s,d,g=null,y={},_=a.iter(n);!_.done;_.next()){var T,C=_.value;null!=(T=a.as(C.id,"Int"))&&(y[a.toString(T)]=a.clone(C))}e.visitAll(l.FormaTraversal.PreOrder,(function(n){var s,l;if((s=a.as(n,h.ImageForma))&&(l=a.opt(s.contentNode,(function(e){return e.mediaMetadata})))){var d,m,y,_=s.contentNode;if(l.sourceName==f.MediaMetadata.kMediaStockSourceName&&null!=l.assetID&&null!=l.licenseType&&null!=(d=l.assetID)&&(m=a.as(t[d],["Dictionary","String","Any"])))if(y=a.as(m[r.kLicenseResultLicenseDataKey],["Dictionary","String","Any"])){var T=a.as(y[r.kLicenseResultLicenseNameKey],"String"),C=f.MediaMetadata.kMediaStockLicenseTypeNone;switch(T){case"Limited":C=f.MediaMetadata.kMediaStockLicenseTypeLimited;break;case"Standard":C=f.MediaMetadata.kMediaStockLicenseTypeStandard;break;case"Extended":i.CoreAssertDebugOnly.fail("StockWorkflowUtils.updateLicensesAndMediaMetadata assetID: "+d+" has unexpected license name: "+r.kLicenseNameExtended,void 0,"StockWorkflowUtils.updateLicensesAndMediaMetadata","StockWorkflowUtils.swift",434),C=f.MediaMetadata.kMediaStockLicenseTypeExtended;break;default:i.CoreAssertDebugOnly.fail("StockWorkflowUtils.updateLicensesAndMediaMetadata assetID: "+d+" has unrecognized license name: "+((o=T)||null!=o?o:"<none>"),void 0,"StockWorkflowUtils.updateLicensesAndMediaMetadata","StockWorkflowUtils.swift",437),C=f.MediaMetadata.kMediaStockLicenseTypeNone}if(l.licenseType!=C){var v=l;null==g&&(g=e.beginTransaction("updateStockImageLicenseMetadataTransaction")),v.licenseType=C,_.mediaMetadata=v}}else a.opt(u.Host.logging,(function(e){return e.logForCategory(p.LogCategories.kStockImage,"StockWorkflowUtils.updateLicensesAndMediaMetadata: missing newLicenseData",c.LogLevelEnum.WARN_LEVEL)}))}})),(s=g)&&(a.opt(u.Host.logging,(function(e){return e.logForCategory(p.LogCategories.kStockImage,"markConstrainedImagesAsUnlicensed, metadata change required",c.LogLevelEnum.INFO_LEVEL)})),s.mergeWithPrevious(),m.TheoDocumentUtils.updateConstrainedImageInfo(e)),(d=a.opt(e.controller,(function(e){return e.saveMgr})))?d.requestSave(!0,!0):i.CoreAssert.fail("updateImageLicenseMetadata failed to save, no saveMgr",void 0,"StockWorkflowUtils.updateLicensesAndMediaMetadata","StockWorkflowUtils.swift",482)}}}),r)},VkKB:function(e,t,n){var r,o,a=t,i=n("oAGj"),s=n("gXiO"),l=n("fNpk");a.MediaMetadata=(r=function(){},o={},i.defineClass({name:"MediaMetadata",ctor:r,superName:"CoreObject",statics:{PROPERTY_GROUP_ROOT:"rootProperties",PROPERTY_GROUP_LICENSE:"license",PROPERTY_GROUP_CCL:"ccl",PROPERTY_GROUP_CCLIGHT:"cclight",PROPERTY_GROUP_STOCK:"stock",PROPERTY_SEARCH:"search",PROPERTY_LICENSE_TYPE:"type",PROPERTY_SOURCE_NAME:"source_name",PROPERTY_SOURCE_URL:"source_url",PROPERTY_OWNER:"owner",PROPERTY_SEARCH_PROPS:"search_props",PROPERTY_ASSETID:"asset_id",PROPERTY_CREATOR_USERID:"creator_user_id",PROPERTY_CREATOR_DISPLAYNAME:"creator_display_name",PROPERTY_DESIGN_INTENT:"design_intent",PROPERTY_SOURCE:"source",PROPERTY_TITLE:"photo_name",PROPERTY_TAGS:"tags",PROPERTY_LIBRARY_ID:"library_id",PROPERTY_LIBRARY_NAME:"library_name",PROPERTY_CREATED_DATE:"created_date",PROPERTY_MODIFIED_DATE:"modified_date",kMediaMarketSourceType:"market",kMediaDooploSourceType:"dooplo",kMediaStockSourceType:"adobestock",kMediaGiphySourceType:"giphy",kMediaCCLSourceType:"ccl",kMediaCCLightDesignAssetsSourceType:"cclight",kMediaStockSourceName:"Adobe Stock",kMediaNounProjectSourceName:"The Noun Project",kMediaUnsplashSourceName:"Unsplash",kMediaPixabaySourceName:"pixabay",kMediaBingSourceName:"bing",kMediaGiphySourceName:"GIPHY",kMediaCCLSourceName:"Creative Cloud Libraries",kMediaCCLightDesignAssetsSourceName:"CC Light Design Assets",kMediaStockLicenseTypeNone:"royalty_free",kMediaStockLicenseTypeStandard:"royalty_free_standard",kMediaStockLicenseTypeExtended:"royalty_free_extended",kMediaStockLicenseTypeLimited:"royalty_free_limited",StockLicensePremiumLevel:{get:function(){return void 0===o.StockLicensePremiumLevel&&(o.StockLicensePremiumLevel=i.defineEnum("StockLicensePremiumLevel",{Premium:0,Free:1,PaidLevel2:2,PaidLevel3:3,PaidLevel4:4})),o.StockLicensePremiumLevel}},PROPERTY_STOCK_COLLECTION_TYPE:"stock_collection_type",kMediaStockCollectionTypeFree:"free-stock",kMediaStockCollectionTypeLimited:"limited-stock",DESIGNINTENT_LOGO:"logo",DESIGNINTENT_PATTERN:"pattern",DESIGNINTENT_ICON:"icon",DESIGNINTENT_STICKER:"sticker",DESIGNINTENT_FLOATING_IMAGE:"floating-image",DESIGNINTENT_VIDEO:"video",fromProperties:function(e){var t=i.as(e[r.PROPERTY_SOURCE],"String");return t==r.kMediaMarketSourceType?r.fromMarketProperties(e):t==r.kMediaDooploSourceType?r.fromDooploProperties(e):t==r.kMediaStockSourceType?r.fromStockProperties(e):t==r.kMediaGiphySourceType?r.fromGiphyProperties(e):t==r.kMediaCCLSourceType?r.fromCCLProperties(e):t==r.kMediaCCLightDesignAssetsSourceType?r.fromCCLightDesignAssetsProperties(e):r.init_4d41(void 0,void 0,void 0,void 0,void 0,void 0,t)},fromDooploProperties:function(e){var t=i.as(e[r.PROPERTY_GROUP_ROOT],["Dictionary","String","Any"]),n=i.as(i.opt(t,(function(e){return e[r.PROPERTY_GROUP_LICENSE]})),["Dictionary","String","Any"]);return r.init_4d41(i.as(e[r.PROPERTY_SOURCE],"String"),i.as(e[r.PROPERTY_SEARCH],"String"),i.as(i.opt(n,(function(e){return e[r.PROPERTY_TITLE]})),"String"),i.as(i.opt(n,(function(e){return e[r.PROPERTY_TAGS]})),"String"),i.as(i.opt(n,(function(e){return e[r.PROPERTY_LICENSE_TYPE]})),"String"),i.as(i.opt(n,(function(e){return e[r.PROPERTY_SOURCE_URL]})),"String"),i.as(i.opt(n,(function(e){return e[r.PROPERTY_SOURCE_NAME]})),"String"),i.as(i.opt(n,(function(e){return e[r.PROPERTY_OWNER]})),"String"),i.as(i.opt(n,(function(e){return e[r.PROPERTY_ASSETID]})),"String"))},fromStockProperties:function(e){var t=i.as(e[r.PROPERTY_GROUP_ROOT],["Dictionary","String","Any"]),n=i.as(i.opt(t,(function(e){return e[r.PROPERTY_GROUP_LICENSE]})),["Dictionary","String","Any"]),o=i.as(i.opt(t,(function(e){return e[r.PROPERTY_GROUP_STOCK]})),["Dictionary","String","Any"]);return r.init_4d41(i.as(e[r.PROPERTY_SOURCE],"String"),i.as(e[r.PROPERTY_SEARCH],"String"),i.as(i.opt(n,(function(e){return e[r.PROPERTY_TITLE]})),"String"),i.as(i.opt(n,(function(e){return e[r.PROPERTY_TAGS]})),"String"),i.as(i.opt(n,(function(e){return e[r.PROPERTY_LICENSE_TYPE]})),"String"),i.as(i.opt(n,(function(e){return e[r.PROPERTY_SOURCE_URL]})),"String"),i.as(i.opt(n,(function(e){return e[r.PROPERTY_SOURCE_NAME]})),"String"),i.as(i.opt(n,(function(e){return e[r.PROPERTY_OWNER]})),"String"),i.as(i.opt(n,(function(e){return e[r.PROPERTY_ASSETID]})),"String"),void 0,void 0,void 0,void 0,void 0,void 0,void 0,i.as(i.opt(o,(function(e){return e[r.PROPERTY_SEARCH_PROPS]})),"String"))},fromGiphyProperties:function(e){var t=null!=e[r.PROPERTY_LICENSE_TYPE]?i.as(e[r.PROPERTY_LICENSE_TYPE],"String"):"GIPHY Terms and Service";return r.init_4d41(i.as(e[r.PROPERTY_SOURCE],"String"),i.as(e[r.PROPERTY_SEARCH],"String"),i.as(e[r.PROPERTY_TITLE],"String"),i.as(e[r.PROPERTY_TAGS],"String"),t,i.as(e[r.PROPERTY_SOURCE_URL],"String"),i.as(e[r.PROPERTY_SOURCE_NAME],"String"),i.as(e[r.PROPERTY_OWNER],"String"),i.as(e[r.PROPERTY_ASSETID],"String"),null,null,r.DESIGNINTENT_STICKER)},fromMarketProperties:function(e){var t=i.as(e.tags,["Array","Any"]),n=i.opt(t,(function(e){return e.join(",")}));return r.init_4d41(i.as(e[r.PROPERTY_SOURCE],"String"),null,i.as(e.name,"String"),n,null,null,null,null,i.as(e.assetID,"String"),i.as(e.creator_userID,"String"),i.as(e.creator_displayName,"String"),i.as(e.design_intent,"String"))},fromCCLProperties:function(e){var t=i.as(e[r.PROPERTY_GROUP_ROOT],["Dictionary","String","Any"]),n=i.as(i.opt(t,(function(e){return e[r.PROPERTY_GROUP_LICENSE]})),["Dictionary","String","Any"]),o=i.as(i.opt(t,(function(e){return e[r.PROPERTY_GROUP_CCL]})),["Dictionary","String","Any"]);return r.init_4d41(i.as(e[r.PROPERTY_SOURCE],"String"),i.as(e[r.PROPERTY_SEARCH],"String"),i.as(i.opt(n,(function(e){return e[r.PROPERTY_TITLE]})),"String"),i.as(i.opt(n,(function(e){return e[r.PROPERTY_TAGS]})),"String"),i.as(i.opt(n,(function(e){return e[r.PROPERTY_LICENSE_TYPE]})),"String"),i.as(i.opt(n,(function(e){return e[r.PROPERTY_SOURCE_URL]})),"String"),i.as(i.opt(n,(function(e){return e[r.PROPERTY_SOURCE_NAME]})),"String"),i.as(i.opt(n,(function(e){return e[r.PROPERTY_OWNER]})),"String"),i.as(i.opt(n,(function(e){return e[r.PROPERTY_ASSETID]})),"String"),void 0,void 0,void 0,i.as(i.opt(o,(function(e){return e[r.PROPERTY_LIBRARY_ID]})),"String"),i.as(i.opt(o,(function(e){return e[r.PROPERTY_LIBRARY_NAME]})),"String"),i.as(i.opt(o,(function(e){return e[r.PROPERTY_CREATED_DATE]})),"Double"),i.as(i.opt(o,(function(e){return e[r.PROPERTY_MODIFIED_DATE]})),"Double"))},fromCCLightDesignAssetsProperties:function(e){var t=i.as(e[r.PROPERTY_GROUP_ROOT],["Dictionary","String","Any"]),n=i.as(i.opt(t,(function(e){return e[r.PROPERTY_GROUP_LICENSE]})),["Dictionary","String","Any"]),o=i.as(i.opt(t,(function(e){return e[r.PROPERTY_GROUP_CCLIGHT]})),["Dictionary","String","Any"]);return r.init_4d41(i.as(e[r.PROPERTY_SOURCE],"String"),i.as(e[r.PROPERTY_SEARCH],"String"),i.as(i.opt(n,(function(e){return e[r.PROPERTY_TITLE]})),"String"),i.as(i.opt(n,(function(e){return e[r.PROPERTY_TAGS]})),"String"),i.as(i.opt(n,(function(e){return e[r.PROPERTY_LICENSE_TYPE]})),"String"),i.as(i.opt(n,(function(e){return e[r.PROPERTY_SOURCE_URL]})),"String"),i.as(i.opt(n,(function(e){return e[r.PROPERTY_SOURCE_NAME]})),"String"),i.as(i.opt(n,(function(e){return e[r.PROPERTY_OWNER]})),"String"),i.as(i.opt(n,(function(e){return e[r.PROPERTY_ASSETID]})),"String"),void 0,void 0,i.as(i.opt(o,(function(e){return e[r.PROPERTY_DESIGN_INTENT]})),"String"),void 0,void 0,i.as(i.opt(o,(function(e){return e[r.PROPERTY_CREATED_DATE]})),"Double"),i.as(i.opt(o,(function(e){return e[r.PROPERTY_MODIFIED_DATE]})),"Double"),i.as(i.opt(o,(function(e){return e[r.PROPERTY_SEARCH_PROPS]})),"String"))},decodeJson:function(e){var t;return null==e?null:(t=i.as(e,["Dictionary","String","Any"]))?r.init_4d41(i.as(t[r.PROPERTY_SOURCE],"String"),i.as(t[r.PROPERTY_SEARCH],"String"),i.as(t[r.PROPERTY_TITLE],"String"),i.as(t[r.PROPERTY_TAGS],"String"),i.as(t[r.PROPERTY_LICENSE_TYPE],"String"),i.as(t[r.PROPERTY_SOURCE_URL],"String"),i.as(t[r.PROPERTY_SOURCE_NAME],"String"),i.as(t[r.PROPERTY_OWNER],"String"),i.as(t[r.PROPERTY_ASSETID],"String"),i.as(t[r.PROPERTY_CREATOR_USERID],"String"),i.as(t[r.PROPERTY_CREATOR_DISPLAYNAME],"String"),i.as(t[r.PROPERTY_DESIGN_INTENT],"String"),i.as(t[r.PROPERTY_LIBRARY_ID],"String"),i.as(t[r.PROPERTY_LIBRARY_NAME],"String"),i.as(t[r.PROPERTY_CREATED_DATE],"Double"),i.as(t[r.PROPERTY_MODIFIED_DATE],"Double"),i.as(t[r.PROPERTY_SEARCH_PROPS],"String")):(l.LegacyCoreAssert.fail("Not a dictionary",void 0,"MediaMetadata.decodeJson","MediaMetadata.swift",598),null)}},props:{init_4d41:function(e,t,n,r,o,a,i,l,u,c,d,h,p,f,m,g,y,_){void 0===e&&(e=null),void 0===t&&(t=null),void 0===n&&(n=null),void 0===r&&(r=null),void 0===o&&(o=null),void 0===a&&(a=null),void 0===i&&(i=null),void 0===l&&(l=null),void 0===u&&(u=null),void 0===c&&(c=null),void 0===d&&(d=null),void 0===h&&(h=null),void 0===p&&(p=null),void 0===f&&(f=null),void 0===m&&(m=null),void 0===g&&(g=null),void 0===y&&(y=null),void 0===_&&(_=null),this.searchSource_=e,this.searchTerm_=t,this.title_=n,this.tags_=r,this.licenseType_=o,this.sourceUrl_=a,this.sourceName_=i,this.ownerName_=l,this.assetID_=u,this.creatorUserID_=c,this.creatorDisplayName_=c,this.designIntent_=h,this.libraryID_=p,this.libraryName_=f,this.createdDate_=m,this.modifiedDate_=g,this.searchProps_=y,this.stockCollectionType_=_,s.CoreObject.call(this)},init_a9d7:function(e,t,n,r,o,a,i,l,u,c,d,h,p,f,m,g,y,_,T){var C,v,P,S,A,D,E,R,F,I,b,O,k,M,N,L,x,B;void 0===t&&(t=null),void 0===n&&(n=null),void 0===r&&(r=null),void 0===o&&(o=null),void 0===a&&(a=null),void 0===i&&(i=null),void 0===l&&(l=null),void 0===u&&(u=null),void 0===c&&(c=null),void 0===d&&(d=null),void 0===h&&(h=null),void 0===p&&(p=null),void 0===f&&(f=null),void 0===m&&(m=null),void 0===g&&(g=null),void 0===y&&(y=null),void 0===_&&(_=null),void 0===T&&(T=null),this.searchSource_=(C=t)||null!=C?C:e.searchSource_,this.searchTerm_=(v=n)||null!=v?v:e.searchTerm_,this.title_=(P=r)||null!=P?P:e.title_,this.tags_=(S=o)||null!=S?S:e.tags_,this.licenseType_=(A=a)||null!=A?A:e.licenseType_,this.sourceUrl_=(D=i)||null!=D?D:e.sourceUrl_,this.sourceName_=(E=l)||null!=E?E:e.sourceName_,this.ownerName_=(R=u)||null!=R?R:e.ownerName_,this.assetID_=(F=c)||null!=F?F:e.assetID_,this.creatorUserID_=(I=d)||null!=I?I:e.creatorUserID_,this.creatorDisplayName_=(b=d)||null!=b?b:e.creatorDisplayName_,this.designIntent_=(O=p)||null!=O?O:e.designIntent_,this.libraryID_=(k=f)||null!=k?k:e.libraryID_,this.libraryName_=(M=m)||null!=M?M:e.libraryName_,this.createdDate_=(N=g)||null!=N?N:e.createdDate_,this.modifiedDate_=(L=y)||null!=L?L:e.modifiedDate_,this.searchProps_=(x=_)||null!=x?x:e.searchProps_,this.stockCollectionType_=(B=T)||null!=B?B:e.stockCollectionType_,s.CoreObject.call(this)},getDebugDesc:function(){var e,t,n,r,o,a,i,s,l,u,c,d,h,p,f,m,g,y,_;return"sourceName_: "+((e=this.sourceName_)||null!=e?e:"")+" searchSource_: "+((t=this.searchSource_)||null!=t?t:"")+" searchTerm_: "+((n=this.searchTerm_)||null!=n?n:"")+" designIntent_: "+((r=this.designIntent_)||null!=r?r:"")+" licenseType_: "+((o=this.licenseType_)||null!=o?o:"")+" assetID_: "+((a=this.assetID_)||null!=a?a:"")+" sourceUrl_: "+((i=this.sourceUrl_)||null!=i?i:"")+" sourceName_: "+((s=this.sourceName_)||null!=s?s:"")+" ownerName_: "+((l=this.ownerName_)||null!=l?l:"")+" assetID_: "+((u=this.assetID_)||null!=u?u:"")+" creatorUserID_: "+((c=this.creatorUserID_)||null!=c?c:"")+" creatorDisplayName_: "+((d=this.creatorDisplayName_)||null!=d?d:"")+" designIntent_: "+((h=this.designIntent_)||null!=h?h:"")+" libraryID_: "+((p=this.libraryID_)||null!=p?p:"")+" libraryName_: "+((f=this.libraryName_)||null!=f?f:"")+" createdDate_: "+((m=this.createdDate_)||null!=m?m:0)+" modifiedDate_: "+((g=this.modifiedDate_)||null!=g?g:0)+" searchProps_: "+((y=this.searchProps_)||null!=y?y:"")+" stockCollectionType: "+((_=this.stockCollectionType_)||null!=_?_:"")},isEqualTo:function(e){var t;return!(!(t=i.as(e,r))||this.searchSource!=t.searchSource||this.searchTerm!=t.searchTerm||this.title!=t.title||this.tags!=t.tags||this.licenseType!=t.licenseType||this.sourceURL!=t.sourceURL||this.sourceName!=t.sourceName||this.ownerName!=t.ownerName||this.assetID!=t.assetID||this.creatorUserID!=t.creatorUserID||this.creatorDisplayName!=t.creatorUserID||this.designIntent!=t.designIntent||this.libraryID_!=t.libraryID_||this.libraryName_!=t.libraryName_||this.createdDate_!=t.createdDate_||this.modifiedDate_!=t.modifiedDate_||this.searchProps!=t.searchProps||this.stockCollectionType!=t.stockCollectionType)},copyWithIntent:function(e){return r.init_a9d7(this,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,e)},copyWithSource:function(e){return r.init_a9d7(this,void 0,void 0,void 0,void 0,void 0,void 0,e)},searchSource:{get:function(){return this.searchSource_}},searchTerm:{get:function(){return this.searchTerm_}},title:{get:function(){return this.title_}},tags:{get:function(){return this.tags_}},licenseType:{get:function(){return this.licenseType_},set:function(e){this.licenseType_=e}},stockCollectionType:{get:function(){return this.stockCollectionType_},set:function(e){this.stockCollectionType_=e}},sourceName:{get:function(){return this.sourceName_}},sourceURL:{get:function(){return this.sourceUrl_}},ownerName:{get:function(){return this.ownerName_}},assetID:{get:function(){return this.assetID_}},creatorUserID:{get:function(){return this.creatorUserID_}},creatorDisplayName:{get:function(){return this.creatorDisplayName_}},designIntent:{get:function(){return this.designIntent_}},libraryID:{get:function(){return this.libraryID_}},libraryName:{get:function(){return this.libraryName_}},createdDate:{get:function(){return this.createdDate_}},modifiedDate:{get:function(){return this.modifiedDate_}},searchProps:{get:function(){return this.searchProps_}},encodeJson:function(){var e={};return null!=this.searchSource_&&(e[r.PROPERTY_SOURCE]=this.searchSource_),null!=this.searchTerm_&&(e[r.PROPERTY_SEARCH]=this.searchTerm_),null!=this.title_&&(e[r.PROPERTY_TITLE]=this.title_),null!=this.tags&&(e[r.PROPERTY_TAGS]=this.tags_),null!=this.licenseType_&&(e[r.PROPERTY_LICENSE_TYPE]=this.licenseType_),null!=this.sourceName_&&(e[r.PROPERTY_SOURCE_NAME]=this.sourceName_),null!=this.sourceUrl_&&(e[r.PROPERTY_SOURCE_URL]=this.sourceUrl_),null!=this.ownerName_&&(e[r.PROPERTY_OWNER]=this.ownerName_),null!=this.assetID_&&(e[r.PROPERTY_ASSETID]=this.assetID_),null!=this.creatorUserID_&&(e[r.PROPERTY_CREATOR_USERID]=this.creatorUserID_),null!=this.creatorDisplayName_&&(e[r.PROPERTY_CREATOR_DISPLAYNAME]=this.creatorDisplayName_),null!=this.designIntent_&&(e[r.PROPERTY_DESIGN_INTENT]=this.designIntent_),null!=this.libraryID_&&(e[r.PROPERTY_LIBRARY_ID]=this.libraryID_),null!=this.libraryName_&&(e[r.PROPERTY_LIBRARY_NAME]=this.libraryName_),null!=this.createdDate_&&(e[r.PROPERTY_CREATED_DATE]=this.createdDate_),null!=this.modifiedDate_&&(e[r.PROPERTY_MODIFIED_DATE]=this.modifiedDate_),null!=this.searchProps_&&(e[r.PROPERTY_SEARCH_PROPS]=this.searchProps_),e},sourceHasLicense:function(){return this.sourceName==r.kMediaStockSourceName||this.sourceName==r.kMediaPixabaySourceName||this.sourceName==r.kMediaUnsplashSourceName||this.sourceName==r.kMediaNounProjectSourceName||this.sourceName==r.kMediaGiphySourceName||this.sourceName==r.kMediaBingSourceName||this.sourceName==r.kMediaCCLightDesignAssetsSourceName}}}),r)},Vm85:function(e,t,n){var r,o,a=t,i=n("oAGj"),s=n("SpAV"),l=n("CWW7"),u=n("gXiO"),c=n("FNB+"),d=n("fWxZ"),h=n("ylxa"),p=n("P83h"),f=n("6Rk9"),m=n("iCxV"),g=n("fNpk"),y=n("c+uM"),_=n("EoOi"),T=n("fAXt"),C=n("VJ9E"),v=n("8t9B"),P=n("3UhB"),S=n("oKlP"),A=n("oKI3"),D=n("uUew"),E=n("sIWg");a.SpacingSequence=i.defineEnum("SpacingSequence",{NextLineSpacing:0,NextShapePadding:1,NextShadowAngle:2,NextLetterTracking:3,NextLineSpacingAndPadding:4}),a.describeSpacingSequence=function(e){switch(e){case 0:return"NextLineSpacing";case 1:return"NextShapePadding";case 2:return"NextShadowAngle";case 3:return"NextLetterTracking";case 4:return"NextLineSpacingAndPadding"}},a.ReplaceTextStrategy=i.defineEnum("ReplaceTextStrategy",{Auto:0,PreventOverlap:1,PreserveWidth:2,Balanced:3}),a.ThumbnailConstants=(r=function(){u.CoreObject.call(this)},i.defineClass({name:"ThumbnailConstants",ctor:r,superName:"CoreObject",statics:{kBorder:15,kMinWidth:80,kMaxWidth:300,kMinAspectRatio:.33,kMaxAspectRatio:5}}),r),a.TextFacade=(o=function(){u.CoreObject.call(this)},i.defineClass({name:"TextFacade",ctor:o,superName:"CoreObject",statics:{kPuffyTextThreshold:.12,kEmptyLockupString:"",setText:function(e,t){var n;if(n=i.as(t.controller,v.TypeLockupController)){var r=n.getCurrentFontSize(),o=e;o=P.TypeLockupUtils.fixUpQuotes(o,e),i.opt(n.contentNode,(function(e){return e.replaceText(o)})),n.snapSizeToBounds(),n.snapToClosestExistingSize(r),n.updateGroup()}},setFont:function(e,t,n,r,o){void 0===n&&(n=!1),void 0===r&&(r=null),void 0===o&&(o=null);for(var a=i.iter(t);!a.done;a.next()){var s,l,u,d=a.value;(s=i.as(d.controller,v.TypeLockupController))&&(P.TypeLockupUtils.applyFontToController(e,s),n&&s.selectCharStyleForma(),i.opt(s.lockupStyle,(function(e){return e.layout==y.LockupLayout.Auto}))&&s.snapSizeToBounds(),null!=(l=r)?d.setTag(c.Forma.TAG_RECOMMENDATION_SOURCE,l):d.hasTag(c.Forma.TAG_RECOMMENDATION_SOURCE)&&d.removeTag(c.Forma.TAG_RECOMMENDATION_SOURCE),null!=(u=o)?d.setTag(c.Forma.TAG_RECOMMENDATION_TYPE,u):d.hasTag(c.Forma.TAG_RECOMMENDATION_TYPE)&&d.removeTag(c.Forma.TAG_RECOMMENDATION_TYPE))}},getFontForForma:function(e){var t;return(t=i.as(e.controller,v.TypeLockupController))?t.styleController.targetedFont:null},getSecondaryFontForForma:function(e){var t;return(t=i.as(e.controller,v.TypeLockupController))?i.opt(t.lockupStyle,(function(e){return e.font})):null},replaceMissingFonts:function(e){if(0==!e.missingFontList.length){var t=C.TheoFont.init_9e5c(m.Host.textModelUtils.defaultFont()),n=e.missingFontList.concat([t.fontData.postScriptName]);e.visitAll(c.FormaTraversal.PreOrder,(function(e){var r;(r=i.as(e.controller,v.TypeLockupController))&&r.replaceFonts(n,t)}))}},getThumbnailBoundsForForma:function(e){var t;if(t=i.as(e.controller,v.TypeLockupController)){var n=e.bounds,r=i.clone(f.GeometryFacade.polyFromFormaBounds(e));n=(n=E.TheoRect.boundsOfPoints(r)).outsetXY(a.ThumbnailConstants.kBorder,a.ThumbnailConstants.kBorder);var s=E.TheoRect.fromSize(e.page.pageSize);function l(t,n){var r=S.TheoPoint.UV_CENTER,o=e.totalPlacement.transformValues,a=180*Math.atan2(o.rotSine,o.rotCosine)/Math.PI;return t==y.LockupAlignment.Left||1==n?(r=new S.TheoPoint(0,.5),a<=-85&&a>=-95?r=new S.TheoPoint(.5,1):a<=-175||a>=175?r=new S.TheoPoint(1,.5):a>=85&&a<=95&&(r=new S.TheoPoint(.5,0))):t==y.LockupAlignment.Right&&(r=new S.TheoPoint(1,.5),a<=-85&&a>=-95?r=new S.TheoPoint(.5,0):a<=-175||a>=175?r=new S.TheoPoint(0,.5):a>=85&&a<=95&&(r=new S.TheoPoint(.5,1))),r}var u=(n=n.intersectionWith(s)||n).aspectRatio,c=n.width,d=n.height,h=o.getAlignmentForForma(e),p=t.numLines(),m=S.TheoPoint.UV_CENTER;if(u>a.ThumbnailConstants.kMaxAspectRatio){var g=d*a.ThumbnailConstants.kMaxAspectRatio/c;m=l(h,p),n=n.scaleXY(g,1,m)}else if(u<a.ThumbnailConstants.kMinAspectRatio){var _=c/a.ThumbnailConstants.kMinAspectRatio/d;m=l(h,p),n=n.scaleXY(1,_,m)}return n}return E.TheoRect.Zero},getLayoutForForma:function(e){var t;return(t=i.as(e.controller,v.TypeLockupController))?t.styleController.targetedLockupStyle.layout:y.LockupLayout.UNSET},getAlignmentForForma:function(e){var t;return(t=i.as(e.controller,v.TypeLockupController))?t.styleController.targetedLockupStyle.alignment:y.LockupAlignment.UNSET},getVerticalAlignmentForForma:function(e){var t;return(t=i.as(e.controller,v.TypeLockupController))?t.styleController.targetedLockupStyle.verticalAlignment:y.VerticalLockupAlignment.UNSET},setFitContainerToArea:function(e,t){var n;(n=i.as(e.controller,v.TypeLockupController))&&(n.fitContainerToArea=t)},getNextValidGridAlignment:function(e,t){var n=t;return n=n==y.LockupAlignment.Left?y.LockupAlignment.Center:n==y.LockupAlignment.Center?y.LockupAlignment.Right:y.LockupAlignment.Left},getNextValidPathID:function(e,t){var n=t;return n=n<A.TextPathID.Circle||n>=A.TextPathID.SemiCircleDown?A.TextPathID.Circle:A.TextPathID.toCaseValue(n+1)},getNextValidAutoAlignment:function(e,t){return o.getNextValidAutoAlignmentByCategory(e,t,_.TypographyLayoutCategory.ALL)},getNextValidAutoAlignmentByCategory:function(e,t,n){var r,o;return(r=i.as(e.controller,v.TypeLockupController))&&(o=r.lockupStyle)?_.TypographyComposer.getNextValidLayoutAlignment(r.text,o,t,r.charStyleRanges,n,void 0,!0):t},hasValidAutoAlignmentsForCategory:function(e,t){var n;return void 0===t&&(t=_.TypographyLayoutCategory.ALL),!(!(n=i.as(e.controller,v.TypeLockupController))||!_.TypographyComposer.canHandleText(n.text))&&i.clone(_.TypographyComposer.getApplicableLayouts(n.text,n.charStyleRanges,t)).length>0},getCategoryForAutoAlignment:function(e){return _.TypographyComposer.getCategoryForAlignment(e)},getTextPathIDForForma:function(e){var t;return(t=i.as(e.controller,v.TypeLockupController))?t.styleController.targetedLockupStyle.pathID:A.TextPathID.UNSET},setSessionContainerSizeForForma:function(e){var t;(t=i.as(e.controller,v.TypeLockupController))&&t.styleController.setSessionContainerSize(i.opt(e.frame,(function(e){return e.size})))},setLayoutAndAlignment:function(e,t,n,r,o,a,s){void 0===r&&(r=!1),void 0===o&&(o=A.TextPathID.UNSET),void 0===a&&(a=null),void 0===s&&(s=y.VerticalLockupAlignment.UNSET);for(var l=i.iter(n);!l.done;l.next()){var u,c=l.value;if(u=i.as(c.controller,v.TypeLockupController)){var d,h=u.styleController.targetedLockupStyle.clone();if(u.beginBlockedUpdate(),e!=y.LockupLayout.SKIP&&(u.styleController.targetedLockupStyle.layout=e),t!=y.LockupAlignment.SKIP)e==y.LockupLayout.Auto&&(d=_.TypographyComposer.getWeightingForAlignment(t,u.text,u.charStyleRanges))&&(u.autoTextRanges=i.clone(d)),u.styleController.targetedLockupStyle.alignment=t;null!=s&&s!=y.VerticalLockupAlignment.UNSET&&(u.styleController.targetedLockupStyle.verticalAlignment=s),u.styleController.targetedLockupStyle.pathID=o,u.styleController.targetedLockupStyle.customPath=a,u.styleController.onLayoutChanged(h),u.endBlockedUpdate(),r||u.styleChanged(),r&&(u.styleController.targetedLockupStyle.spacing=i.toDouble(y.LockupLayout.UNSET),u.styleChanged(),u.selectCharStyleForma()),e==y.LockupLayout.Auto&&u.snapSizeToBounds()}}},getLineSpacingForForma:function(e){var t;return(t=i.as(e.controller,v.TypeLockupController))?t.styleController.targetedLockupStyle.spacing:0},setLineSpacing:function(e,t,n){void 0===n&&(n=!1);for(var r=i.iter(t);!r.done;r.next()){var o,a=r.value;(o=i.as(a.controller,v.TypeLockupController))&&(o.styleController.targetedLockupStyle.spacing=e,n&&o.styleChanged(),o.styleController.onSpacingChanged())}},setLeading:function(e,t,n){for(var r=i.iter(n);!r.done;r.next()){var o,a=r.value;(o=i.as(a.controller,v.TypeLockupController))&&(o.setLineSpacingAndBounds(e,t),o.styleController.onSpacingChanged())}},getTrackingForForma:function(e){var t;return(t=i.as(e.controller,v.TypeLockupController))?t.styleController.targetedLockupStyle.tracking:0},setTracking:function(e,t,n){for(var r=i.iter(n);!r.done;r.next()){var o,a=r.value;(o=i.as(a.controller,v.TypeLockupController))&&(o.setLetterSpacingAndBounds(e,t),o.styleController.onTrackingChanged())}},getPaddingForForma:function(e){var t;return(t=i.as(e.controller,v.TypeLockupController))?t.styleController.targetedLockupStyle.padding:0},setPadding:function(e,t){for(var n=i.iter(t);!n.done;n.next()){var r,o=n.value;(r=i.as(o.controller,v.TypeLockupController))&&r.styleController.setPaddingFromSlider(e)}},supportsRelativeFontScale:function(e){var t;return!!(t=i.as(e.controller,v.TypeLockupController))&&t.styleController.supportsRelativeFontScale()},getRelativeFontScaleForForma:function(e){var t;if(t=i.as(e.controller,v.TypeLockupController)){var n=t.styleController.targetedLockupStyle.relativeFontScale;return n==y.LockupStyle.UNSET_RELATIVE_FONT_SCALE?_.TypographyComposer.getDefaultRelativeFontScale(t.styleController.targetedLockupStyle.alignment):n}return 1},setRelativeFontScale:function(e,t){for(var n=i.iter(t);!n.done;n.next()){var r,o=n.value;(r=i.as(o.controller,v.TypeLockupController))&&(null==r.styleController.getSessionContainerSize()&&r.styleController.setSessionContainerSize(r.size),r.styleController.setRelativeFontScale(e))}},matchSizeAndPosition:function(e,t){var n,r;if((n=i.as(e.controller,v.TypeLockupController))&&(r=i.as(t.controller,v.TypeLockupController))){r.size=n.size;var o=e.boundsInCoordSpace(e.totalPlacement),a=t.boundsInCoordSpace(t.totalPlacement),s=o.center.subtract(a.center);T.TransformFacade.translateForma(t,s)}},matchNextSize:function(e,t,n){for(var r=0,o=i.iter(n);!o.done;o.next()){var a,s=o.value;(a=i.as(s.controller,v.TypeLockupController))&&(r=a.matchNextSize(e,t))}return r},matchNearestSize:function(e,t,n,r){for(var o=0,a=i.iter(r);!a.done;a.next()){var s,l=a.value;(s=i.as(l.controller,v.TypeLockupController))&&(o=s.setSizeSliderValue(e,t,n))}return o},getLineBreakForForma:function(e){var t;return!!(t=i.as(e.controller,v.TypeLockupController))&&t.styleController.targetedLockupStyle.lineBreakAtCharacterStyleSizeChange},setLineBreak:function(e,t,n){void 0===n&&(n=!1);for(var r=i.iter(t);!r.done;r.next()){var o,a=r.value;(o=i.as(a.controller,v.TypeLockupController))&&(o.styleController.targetedLockupStyle.lineBreakAtCharacterStyleSizeChange=e,n&&(o.styleChanged(),o.selectCharStyleForma()))}},setNextSpacingSequence:function(e,t){for(var n=i.iter(t);!n.done;n.next()){var r,o=n.value;if(r=i.as(o.controller,v.TypeLockupController))switch(e){case 0:r.styleController.setNextSpacingOption();break;case 1:r.styleController.setNextPaddingOption();break;case 2:r.styleController.setNextShadowAngle();break;case 3:r.styleController.setNextTrackingOption();break;case 4:r.styleController.setNextSpacingAndPaddingOption();break;default:g.LegacyCoreAssert.fail("unhandled spacing sequence",void 0,"TextFacade.setNextSpacingSequence","TextFacade.swift",622)}}},getTextLook:function(e){var t;return(t=i.as(e.controller,v.TypeLockupController))?t.styleController.targetedTextLook:y.LockupTextLook.Fill},getDefaultLockupBacking:function(e){var t,n=y.LockupBacking.None;return(t=i.as(e.style,y.LockupStyle))&&(n=y.LockupStyle.isPath(t.layout)||y.LockupStyle.isLetterGrid(t.layout)||y.LockupStyle.isAutoLayout(t.layout)?y.LockupBacking.SVGBackground:y.LockupBacking.Rows),n},getDefaultArtworkID:function(e){var t,n="none";return(t=i.as(e.style,y.LockupStyle))&&(n=y.LockupStyle.isPath(t.layout)||y.LockupStyle.isAutoLayout(t.layout)?"square_001":y.LockupStyle.isLetterGrid(t.layout)?"circle_001":"slug"),n},getBackingShape:function(e){var t;return(t=i.as(e.controller,v.TypeLockupController))?[t.styleController.targetedLockupStyle.backing,t.styleController.targetedLockupStyle.backingArtworkID]:[y.LockupBacking.None,""]},getOutlineStrokeWeightPercent:function(e){var t;return(t=i.as(e.controller,v.TypeLockupController))?t.styleController.getStrokeWeightPercentForUI():0},getShadowOffsetPercent:function(e){var t;return(t=i.as(e.controller,v.TypeLockupController))?t.styleController.getShadowOffsetPercentForUI():0},setTextLook:function(e,t,n){void 0===n&&(n=!0);for(var r=i.iter(t);!r.done;r.next()){var o,a=r.value;(o=i.as(a.controller,v.TypeLockupController))&&(o.styleController.setTextLook(e,n),o.styleChanged())}},setTextEffectsAttributes:function(e,t,n,r){for(var a=i.iter(r);!a.done;a.next()){var s,l=a.value;if(s=i.as(l.controller,v.TypeLockupController)){if(!isNaN(e)){s.styleController.targetedStrokeWeight=e;var u=o.getTextLook(l);if(u==y.LockupTextLook.FillAndOutline||u==y.LockupTextLook.FillAndOutline2){var c=o.getCorrectOutlineWithFillTextLook(s.styleController);c!=u&&o.setTextLook(c,[l],!1)}}if(isNaN(t)||(s.styleController.targetedShadowOffset=t,s.styleChanged()),!isNaN(n)){var d=n<0?360+n:n;s.styleController.targetedShadowAngle=d}}}},getTextEffectsAttributes:function(e){for(var t=0,n=0,r=0,o=i.iter(e);!o.done;o.next()){var a,s=o.value;(a=i.as(s.controller,v.TypeLockupController))&&(t=a.styleController.targetedStrokeWeight,n=a.styleController.targetedShadowOffset,r=a.styleController.targetedShadowAngle)}return[t,n,r]},REPLACE_TEXT_EXPANSION_RATIO:.95,REPLACE_TEXT_EXPANSION_MARGIN:10,replaceTextForLockup:function(e,t,n,r,u,c){var d,h,m,g;if(void 0===n&&(n=null),void 0===r&&(r=a.ReplaceTextStrategy.Auto),void 0===u&&(u=null),void 0===c&&(c=null),i.isEmpty(t.trim()))return l.CreationFacade.deleteFormae([e],null),null;if((d=i.as(e.controller,v.TypeLockupController))&&(h=e.finalFrame)&&(m=d.contentNode)&&(g=d.lockupStyle)){var T=t,C=d.text;if(T!=C){var S=new p.FormaTransformChangedEvent(e);e.beginUpdate(S);var A,D=null,E=null,R=i.isEmpty(C.trim()),F=r==a.ReplaceTextStrategy.Auto?o.resolveAutoReplaceTextStrategy(e):r;R||F!=a.ReplaceTextStrategy.PreserveWidth&&F!=a.ReplaceTextStrategy.Balanced||(D=d.getCurrentFontSize(),F==a.ReplaceTextStrategy.Balanced&&(A=d.getParentForPin())&&(E=i.opt(d.getExpansionBounds(A,o.REPLACE_TEXT_EXPANSION_RATIO,o.REPLACE_TEXT_EXPANSION_MARGIN),(function(e){return e.size}))));var I,b,O,k=g.layout,M=u;return null==M&&(y.LockupStyle.layoutSupportsAlignments(k)||1==d.numLines()&&k!=y.LockupLayout.Path)&&(M=d.getPin(!0,!0)),(I=n)&&(s.CoreAssertDebugOnly.isFalse(0==d.charStyleRanges.length&&0==!I.length,"Updating character styles ranges when currently empty",void 0,"TextFacade.replaceTextForLockup","TextFacade.swift",843),d.charStyleRanges=i.clone(I)),T=P.TypeLockupUtils.fixUpQuotes(T,C),d.beginBlockedUpdate(),i.opt(d.lockupStyle,(function(e){return e.layout==y.LockupLayout.Auto}))&&(i.isEmpty(C)?(i.opt(d.lockupStyle,(function(e){return e.alignment=y.LockupAlignment.Left})),i.opt(d.lockupStyle,(function(e){return e.layout=y.LockupLayout.Standard}))):(g.alignment=_.TypographyComposer.getNextValidLayoutAlignment(T,g,g.alignment,void 0,void 0,void 0,!1),g.alignment!=y.LockupAlignment.UNSET?(d.autoTextRanges=i.clone(_.TypographyComposer.getWeightingForAlignment(g.alignment,T)),i.opt(d.lockupStyle,(function(e){return e.alignment=g.alignment}))):(i.opt(d.lockupStyle,(function(e){return e.alignment=y.LockupAlignment.Left})),i.opt(d.lockupStyle,(function(e){return e.layout=y.LockupLayout.Standard}))))),m.replaceText(T),d.endBlockedUpdate(),d.updateGroupWithFontSize(D,E),T!=o.kEmptyLockupString&&(b=M)&&(F==a.ReplaceTextStrategy.Balanced?(d.matchPreviousPin(b,void 0,o.REPLACE_TEXT_EXPANSION_RATIO,o.REPLACE_TEXT_EXPANSION_MARGIN),null!=(O=c)?O(e,h,b.pinPoint):f.GeometryFacade.fitInPage(e,h,b.pinPoint,o.REPLACE_TEXT_EXPANSION_MARGIN)):d.matchPreviousPin(b)),d.snapSizeToBounds(),d.styleController.resetSessionContainerSize(),d.styleController.resetSessionContainerCenter(),e.endUpdate(S),M}i.opt(i.opt(e.page.document,(function(e){return e.controller})),(function(e){return e.updateAnnotations()}))}return null},replaceTextAndPreserveFontSize:function(e,t){o.replaceTextForLockup(e,t,null,a.ReplaceTextStrategy.PreserveWidth)},resolveAutoReplaceTextStrategy:function(e){var t,n;return(t=i.as(e.controller,v.TypeLockupController))&&null!=(n=i.opt(t.lockupStyle,(function(e){return e.layout})))&&n==y.LockupLayout.Standard&&!t.userGroupChild?a.ReplaceTextStrategy.Balanced:a.ReplaceTextStrategy.PreventOverlap},setHightlightMethod:function(e,t,n){void 0===n&&(n=!1);for(var r=i.iter(t);!r.done;r.next()){var o,a=r.value;if(o=i.as(a.controller,v.TypeLockupController)){if(n&&e!=v.HighlightMethod.Numbers)if(e==v.HighlightMethod.Manual)o.clearCharStyle(),o.selectCharStyleForma();else if(o.highlightMethod==e&&e!=v.HighlightMethod.Manual){var s=e;o.highlightMethod=v.HighlightMethod.toCaseValue(s+1)}else e!=v.HighlightMethod.Manual?o.highlightMethod==v.HighlightMethod.OddRows?o.highlightMethod=v.HighlightMethod.Bracket:o.highlightMethod==v.HighlightMethod.Bracket?o.highlightMethod=v.HighlightMethod.InsideBracket:o.highlightMethod==v.HighlightMethod.InsideBracket?o.highlightMethod=v.HighlightMethod.EvenRows:o.highlightMethod=e:o.highlightMethod=e;if(e==v.HighlightMethod.Manual&&n)return;if(n){var l=e==v.HighlightMethod.Numbers,u=e!=v.HighlightMethod.Numbers;o.autoApplyCharStyle(!0,l,u)}else o.applyPredefinedCharStyle(e);n&&o.selectCharStyleForma()}}},setCharStyleMode:function(e,t){var n;(n=i.as(e.controller,v.TypeLockupController))&&(t?(i.opt(i.opt(e.page.document,(function(e){return e.controller})),(function(e){return e.selection.inCharStyleMode=!0})),0==n.charStyleRanges.length&&n.styleController.pickVisibleColorsForCharStyle(),n.selectCharStyleForma(),n.autoApplyCharStyle(!1,!1,!1),n.selectCharStyleForma()):i.opt(i.opt(e.page.document,(function(e){return e.controller})),(function(e){return e.selection.inCharStyleMode=!1})))},applyCharStyle:function(e,t,n,r,o){var a;return(a=i.as(i.opt(e.lockupForma,(function(e){return e.controller})),v.TypeLockupController))?a.applyCharStyle(e,t,n,r,o):(g.LegacyCoreAssert.fail("cannot applyCharStyle, not a text forma",void 0,"TextFacade.applyCharStyle","TextFacade.swift",1024),new D.TextRange(0,0))},adjustCharStyleRanges:function(e,t,n,r){var o;return void 0===r&&(r=null),(o=r||i.opt(i.as(e.controller,v.TypeLockupController),(function(e){return e.charStyleRanges})))?P.TypeLockupUtils.adjustRanges(o,t,n):null},applyTextStyleSuggestion:function(e,t,n,r){var o;if(o=i.as(t.controller,v.TypeLockupController)){var a=o.fitContainerToArea;o.fitContainerToArea=!0;var s=o.applyTextStyleSuggestion(e,n,r);return o.fitContainerToArea=a,s}return g.LegacyCoreAssert.fail("cannot apply text style, not a text forma",void 0,"TextFacade.applyTextStyleSuggestion","TextFacade.swift",1058),null},applyNextTextEmphasisSuggestion:function(e,t){var n,r;return(n=i.as(e.controller,v.TypeLockupController))&&(r=t)?n.applyNextTextEmphasisSuggestion(r):(g.LegacyCoreAssert.fail("cannot apply next text emphasis",void 0,"TextFacade.applyNextTextEmphasisSuggestion","TextFacade.swift",1072),null)},standardPPI:72,getStandardPageSize:function(e){var t=e.getPageExportData();return new h.FormaPageExportData(t.dimensions,t.format,o.standardPPI).pixelDimensions},toInternalFontSize:function(e,t){var n=o.getStandardPageSize(t),r=d.FormaPage.DEFAULT_PAGE_SIZE;return Math.max(r.width,r.height)*e/Math.max(n.width,n.height)},toUserFontSize:function(e,t){return e/o.toInternalFontSize(1,t)},setFontSize:function(e,t,n){var r;if(r=i.opt(i.first(t),(function(e){return e.page})))for(var a=o.toInternalFontSize(e,r),s=i.iter(t);!s.done;s.next()){var l,u=s.value;(l=i.as(u.controller,v.TypeLockupController))&&l.setFontSize(a,n)}},getStandardFontSizes:function(){return[18,24,36,48,60,132]},getMinimumFontSize:function(e){return void 0===e&&(e=null),12},getMaximumFontSize:function(e){var t;void 0===e&&(e=null);var n=i.clone(e||[]);return 0==!n.length&&null==n.find((function(e){var n=(t=i.opt(i.as(e.style,y.LockupStyle),(function(e){return e.layout})))||null!=t?t:y.LockupLayout.Standard;return!y.LockupStyle.isPath(n)}),this)?200:500},getCorrectOutlineWithFillTextLook:function(e){return e.targetedStrokeWeight>o.kPuffyTextThreshold?y.LockupTextLook.FillAndOutline2:y.LockupTextLook.FillAndOutline},getNewTextLookForOutlineChange:function(e,t,n){var r=e;switch(e){case-2:case-1:case 0:n||(r=o.getCorrectOutlineWithFillTextLook(t));break;case 1:n||(r=y.LockupTextLook.KnockoutAndOutline);break;case 2:n&&(r=y.LockupTextLook.KnockoutOnly);break;case 3:case 4:case 5:n&&(r=y.LockupTextLook.Fill);break;case 6:n||(r=y.LockupTextLook.KnockoutAndOutline);break;case 7:n||(r=y.LockupTextLook.ShadowAndOutline);break;case 8:n&&(r=y.LockupTextLook.Shadow);break;case 9:n||(r=y.LockupTextLook.KnockoutShadowOutline);break;case 10:n&&(r=y.LockupTextLook.Shadow);break;case 11:n&&(r=y.LockupTextLook.KnockoutAndShadow)}return r},getNewTextLookForShadowChange:function(e,t,n){var r=e;switch(e){case-2:case-1:case 0:n||(r=y.LockupTextLook.Shadow);break;case 1:n||(r=y.LockupTextLook.KnockoutAndShadow);break;case 2:n||(r=y.LockupTextLook.KnockoutShadowOutline);break;case 3:n||(r=y.LockupTextLook.ShadowOutlineTransparentText);break;case 4:case 5:n||(r=y.LockupTextLook.ShadowAndOutline);break;case 6:n||(r=y.LockupTextLook.KnockoutAndShadow);break;case 7:n&&(r=y.LockupTextLook.Fill);break;case 8:n&&(r=o.getCorrectOutlineWithFillTextLook(t));break;case 9:n&&(r=y.LockupTextLook.KnockoutOnly);break;case 10:n&&(r=y.LockupTextLook.OutlineOnly);break;case 11:n&&(r=y.LockupTextLook.KnockoutAndOutline)}return r},getNewTextLookForKnockoutChange:function(e,t,n){var r=e;switch(e){case-2:case-1:case 0:n||(r=y.LockupTextLook.KnockoutOnly);break;case 1:n&&(r=y.LockupTextLook.Fill);break;case 2:n&&(r=o.getCorrectOutlineWithFillTextLook(t));break;case 3:break;case 4:case 5:n||(r=y.LockupTextLook.KnockoutAndOutline);break;case 6:n&&(r=y.LockupTextLook.Fill);break;case 7:n||(r=y.LockupTextLook.KnockoutAndShadow);break;case 8:n||(r=y.LockupTextLook.KnockoutShadowOutline);break;case 9:n&&(r=y.LockupTextLook.Shadow);break;case 10:break;case 11:n&&(r=y.LockupTextLook.ShadowAndOutline)}return r},getNewTextLookForTransparentFillChange:function(e,t,n){var r=e;switch(e){case 2:break;case 3:r=o.getCorrectOutlineWithFillTextLook(t);break;case 4:case 5:r=y.LockupTextLook.OutlineOnly;break;case 8:r=y.LockupTextLook.ShadowOutlineTransparentText;break;case 11:break;case 10:r=y.LockupTextLook.ShadowAndOutline}return r}}}),o)},Vvcj:function(e,t,n){var r,o,a=t,i=n("oAGj"),s=n("TbN7"),l=n("kVgh"),u=n("fNpk"),c=n("Quhx"),d=n("aN2p"),h=n("9YN4");a.ColorThemeDocument=(r=function(){this.swatchFactory_={}},o={},i.defineClass({name:"ColorThemeDocument",ctor:r,superName:"PostDCXObject",statics:{SCHEMA_CLASS_NAME:"ColorThemeDocument",factory:{get:function(){return void 0===o.factory&&(o.factory=function(e,t,n,o){var a=i.as(i.opt(i.opt(o,(function(e){return e.backLink})),(function(e){return e.dereference()})),h.TheoDocument);return u.LegacyCoreAssert.isTrue(null!=a,"ColorThemeDocument needs a parent document",void 0,"ColorThemeDocument","ColorThemeDocument.swift",15),r.init_7e49(e,n,a)}),o.factory},set:function(e){o.factory=e}},PROPERTY_CHILDREN:"children",DCXTYPE:{get:function(){return"application/vnd.adobe.theo.color+dcx"}},PATH:{get:function(){return"colortheme"}},_implements:function(e){return"IDBObject"==e||"TheoMessagePublisher"==e}},props:{swatches_:{get:function(){var e;return(e=i.as(this.get(r.PROPERTY_CHILDREN),["Array",l.ColorSwatch]))||null!=e?e:[]},set:function(e){this.set(r.PROPERTY_CHILDREN,e)}},init_7e49:function(e,t,n){this.parent_=n,this.swatchFactory_[d.SimpleSwatch.KIND]=function(e,t){return d.SimpleSwatch.init_d0e4(e)},i.super_init(this,c.PostDCXObject,c.PostDCXObject.prototype.init_3181,n.database,t,e)},init_d0e4:function(e){this.parent_=e,this.swatchFactory_[d.SimpleSwatch.KIND]=function(e,t){return d.SimpleSwatch.init_d0e4(e)},i.super_init(this,c.PostDCXObject,c.PostDCXObject.prototype.init_11e0,e.database),this.set(c.PostDCXObject.PROPERTY_PATH,r.PATH),this.set(c.PostDCXObject.PROPERTY_TYPE,r.DCXTYPE)},className:{get:function(){return r.SCHEMA_CLASS_NAME}},parent:{get:function(){return this.parent_}},swatchByID:function(e){for(var t=i.iter(this.swatches_);!t.done;t.next()){var n=t.value;if(n.id==e)return n}return null},swatchByTag:function(e,t){for(var n=i.iter(this.swatches_);!n.done;n.next()){var r=n.value;if(r.tag(e)==t)return r}return null},swatchesByTag:function(e){for(var t=[],n=i.iter(this.swatches_);!n.done;n.next()){var r=n.value;null!=r.tag(e)&&t.push(r)}return t},createSwatch:function(e){var t=this.swatchFactory_[e];return null==t?(u.LegacyCoreAssert.fail("ColorThemeDocument: Did not find a constructor",{kind:e},"ColorThemeDocument.createSwatch","ColorThemeDocument.swift",84),null):t(this,e)},insertSwatchesAt:function(e,t){if(e<0||e>this.swatches_.length)return u.LegacyCoreAssert.fail("insertSwatchesAt: index is out of range",{index:e,max:this.swatches_.length},"ColorThemeDocument.insertSwatchesAt","ColorThemeDocument.swift",92),null;for(var n=e,r=i.clone(this.swatches_),o=i.iter(t);!o.done;o.next()){var a=o.value;if(a.parent!=this)return u.LegacyCoreAssert.fail("inserting swatch from different color theme document",void 0,"ColorThemeDocument.insertSwatchesAt","ColorThemeDocument.swift",100),null;r.splice(n,0,a),n+=1}return this.swatches_=i.clone(r),this.publish(new s.InsertedSwatchesMessage(this,e,t)),t},removeSwatchesAt:function(e,t){if(e<0||e+t>this.swatches_.length)return u.LegacyCoreAssert.fail("removeSwatchesAt: index/count out of range",{index:e,count:t,max:this.swatches_.length},"ColorThemeDocument.removeSwatchesAt","ColorThemeDocument.swift",116),null;var n=i.clone(this.swatches_),r=n.splice(e,t);return this.swatches_=i.clone(n),this.publish(new s.RemovedSwatchesMessage(this,e,r)),r},appendSwatch:function(e){return i.opt(this.insertSwatchesAt(this.swatches_.length,[e]),(function(e){return e[0]}))},insertSwatch:function(e,t){return i.opt(this.insertSwatchesAt(e,[t]),(function(e){return e[0]}))},removeSwatch:function(e){var t;return null!=(t=i.indexOf(this.swatches_,e))?i.opt(this.removeSwatchesAt(t,1),(function(e){return e[0]})):null},removeSwatchAt:function(e){return i.opt(this.removeSwatchesAt(e,1),(function(e){return e[0]}))},removeAllSwatches:function(){return this.removeSwatchesAt(0,this.swatches_.length)},replaceAllSwatches:function(e){if(this.swatches_==e)return this.swatches_;var t=i.clone(this.swatches_);return this.swatches_=i.clone(e),this.publish(new s.ReplacedSwatchesMessage(this,e)),t},replaceWithDocument:function(e){for(var t=[],n=i.iter(e.copySwatches());!n.done;n.next()){var r=n.value;this.createSwatch(r.kind).match(r),t.push(r)}this.replaceAllSwatches(t)},copySwatches:function(){return this.swatches_.concat()},swatchAt:function(e){return e<0||e>=this.swatches_.length?null:this.swatches_[e]},swatchCount:{get:function(){return this.swatches_.length}},addColorWithTag:function(e,t,n){var r=this.createSwatch(d.SimpleSwatch.KIND);return r.setTag(t,n),r.color=e,this.appendSwatch(r)},publishForChild:function(e){this.publish(e)}}}),r)},WWR6:function(e,t,n){var r,o=t,a=n("oAGj"),i=n("FNB+"),s=n("fWxZ"),l=n("P83h"),u=n("pnSN"),c=n("fNpk"),d=n("sIWg"),h=n("1NAc"),p=n("LGJg");o.VectorForma=(r=function(){this.cachedBounds_=null},a.defineClass({name:"VectorForma",ctor:r,superName:"Forma",statics:{KIND:{get:function(){return"Vector"}},PROPERTY_COLOR:"color",PROPERTY_CONTENTID:"content-id",PROPERTY_SIZE:"size",SCHEMA_CLASS_NAME:{get:function(){return"VectorForma"}},factory:{get:function(){return function(e,t,n,o){if(null!=t){var i=a.as(a.opt(a.opt(o,(function(e){return e.backLink})),(function(e){return e.dereference()})),u.GroupForma),l=a.as(a.opt(a.opt(o,(function(e){return e.backLink})),(function(e){return e.dereference()})),s.FormaPage);return c.LegacyCoreAssert.isTrue(null!=i||null!=l,"VectorForma needs a parent group or page",void 0,"VectorForma","VectorForma.swift",23),null!=i?r.init_3144(e,t,n,i):r.init_7dbd(e,t,n,l)}return r.init_d1c9(e,n)}}},_implements:function(e){return"IDBObject"==e||"TheoMessageSubscriber"==e||"TheoMessagePublisher"==e}},props:{init_3144:function(e,t,n,r){a.super_init(this,i.Forma,i.Forma.prototype.init_3144,e,t,n,r)},init_7dbd:function(e,t,n,r){a.super_init(this,i.Forma,i.Forma.prototype.init_7dbd,e,t,n,r)},init_812f:function(e,t){for(var n={kind:function(){return r.KIND}},o=a.clone(t),s=a.iter(n);!s.done;s.next()){var l=s.key,u=s.value;null==t[l]&&(o[l]=u())}a.super_init(this,i.Forma,i.Forma.prototype.init_812f,e,o)},init_7186:function(e){var t={kind:r.KIND};this.init_812f(e,t)},init_d1c9:function(e,t){a.super_init(this,i.Forma,i.Forma.prototype.init_d1c9,e,t)},className:{get:function(){return r.SCHEMA_CLASS_NAME}},updateEventForProperty:function(e){return e==r.PROPERTY_CONTENTID?new l.FormaContentChangedEvent(this):i.Forma.prototype.updateEventForProperty.call(this,e)},contentNode:{get:function(){var e=this;return null==this.contentID?null:a.as(a.opt(this.page.document,(function(t){return t.content.nodeByID(e.contentID)})),p.VectorContentNode)},set:function(e){this.contentID=null==e?null:e.id}},color:{get:function(){return this.get(r.PROPERTY_COLOR)},set:function(e){this.set(r.PROPERTY_COLOR,e)}},size:{get:function(){return a.as(this.get(r.PROPERTY_SIZE),h.TheoSize)},set:function(e){this.set(r.PROPERTY_SIZE,e)}},contentID:{get:function(){var e;return(e=a.as(this.get(r.PROPERTY_CONTENTID),"String"))||null!=e?e:""},set:function(e){var t=new l.FormaContentChangedEvent(this);this.beginUpdate(t),this.set(r.PROPERTY_CONTENTID,e),this.cachedBounds_=null,this.endUpdate(t)}},boundsInCoordSpace:function(e){if(null==this.cachedBounds_){var t=this.contentNode;null!=t&&(this.cachedBounds_=d.TheoRect.fromSize(t.size))}return a.opt(this.cachedBounds_,(function(t){return t.transform(e)}))},isGraphic:function(){return!0}}}),r)},X0GW:function(e,t,n){var r,o=t,a=n("oAGj"),i=n("gXiO"),s=n("yGNn"),l=n("FNB+"),u=n("ZK0l"),c=n("pnSN"),d=n("6Rk9"),h=n("iCxV"),p=n("fNpk"),f=n("MYNe"),m=n("tGKA"),g=n("JFv5"),y=n("sIWg");o.GroupFacade=(r=function(){i.CoreObject.call(this)},a.defineClass({name:"GroupFacade",ctor:r,superName:"CoreObject",statics:{groupItems:function(e){return 0==e.length?s.CorePromise.resolve([]):(t=r.createGroupFromFormae(e))?(t.intent=l.Forma.INTENT_USER_GROUP,s.CorePromise.resolve(t)):s.CorePromise.reject("couldn't create a group");var t},updateUserGroupBounds:function(e){p.LegacyCoreAssert.isTrue(e.controller.userGroup,"asked to update user group bounds for a group that's not a user group",void 0,"GroupFacade.updateUserGroupBounds","GroupFacade.swift",33);var t=a.clone(e.childrenAsArray);if(t.length>0){for(var n={},r=d.GeometryFacade.unionFrame(t),o=a.iter(t);!o.done;o.next())n[(c=o.value).formaID]=c.finalFrame,e.root.appendChild(c,!0);var i=e.placement.calculateTransformValuesSKRT(),s=m.Matrix2D.rotation(i.rotCosine,i.rotSine).transformPoint(r.origin);e.bounds=y.TheoRect.fromSize(r.size),e.placement=e.placement.translateXY(s.x,s.y);for(var l=a.iter(t);!l.done;l.next()){var u,c=l.value;e.appendChild(c,!0),(u=c.finalFrame)&&(n[c.formaID].equalWithAccuracy(u,.001)||h.Host.logging.warning("error. a child's position changed in updateUserGroupBounds."))}}},updateUserGroupHierarchy:function(e){for(var t,n=e;((t=a.opt(a.opt(n,(function(e){return e.controller})),(function(e){return e.userGroup})))||null!=t)&&t;)r.updateUserGroupBounds(n),n=a.opt(n,(function(e){return e.parent}))},createGroupFromFormae:function(e){var t;if(0==e.length)return null;var n,r,o=d.GeometryFacade.unionFrame(e),i=e.concat(),s=a.as(a.opt(a.first(e),(function(e){return e.page.createFormaWithController(c.GroupForma.KIND,u.GroupController.KIND)})),c.GroupForma);if((n=s)&&(r=o)){a.opt(a.opt(a.first(e),(function(e){return e.parent})),(function(e){return e.appendChild(n)})),n.intent=l.Forma.INTENT_USER_GROUP,n.placement=m.Matrix2D.translationXY(r.minX,r.minY),n.bounds=y.TheoRect.fromSize(r.size);var h=n.controller;h.preferredResizeType=g.ResizeLayoutType.Proportional,h.preserveResizeController=!0;for(var p=0,_=a.iter(i);!_.done;_.next()){var T=_.value;p=Math.max(p,(t=a.opt(T.parent,(function(e){return e.indexOfChild(T)})))||null!=t?t:0)}a.opt(n.parent,(function(e){return e.insertChildAt(n,p,!0)}));for(var C=a.iter(f.LayerFacade.sortInZOrder(i));!C.done;C.next())T=C.value,n.appendChild(T,!0);return n}return null},removeAllGroups:function(e){for(var t,n=a.clone(e.filterWithCallback((function(e){return!(!(t=a.opt(e.controller,(function(e){return e.userGroup})))&&null==t)&&t}))),o=a.iter(n);!o.done;o.next()){var i=o.value;r.cleanupGroup(i)}},cleanupGroup:function(e){for(var t,n=a.iter(e.childrenAsArray);!n.done;n.next()){var r=n.value,o=(t=a.opt(e.parent,(function(t){return t.indexOfChild(e)})))||null!=t?t:e.childCount;a.opt(e.parent,(function(e){return e.insertChildAt(r,o,!0)}))}e.removeFromParent()},ungroupItems:function(e){var t,n;if(0==e.length)return s.CorePromise.resolve([]);for(var o=[],i=[],l=[],u=!1,c=a.iter(e);!c.done;c.next()){var d,h=c.value;((t=a.opt(h.controller,(function(e){return e.userGroup})))||null!=t)&&t?(a.append(o,h.childrenAsArray),a.append(l,h.childrenAsArray)):(f=h.controller)&&(d=f.userGroupRoot)&&(u=!0,o.push(h),a.append(l,d.childrenAsArray))}for(var p=a.iter(l);!p.done;p.next()){var f,m,g,y;if((f=(h=p.value).controller)&&(m=h.parent)&&(g=a.opt(h.parent,(function(e){return e.parent})))&&null!=(y=g.indexOfChild(m))&&f.userGroupChild)if(g.insertChildAt(h,y,!0),m.childCount<=1){for(var _=a.iter(m.childrenAsArray);!_.done;_.next()){var T=_.value,C=(n=g.indexOfChild(m))||null!=n?n:g.childCount;g.insertChildAt(T,C,!0),u||o.push(T)}m.removeFromParent()}else i.includes(m)||i.push(m)}for(var v=a.iter(i);!v.done;v.next()){var P=v.value;r.updateUserGroupBounds(P)}return s.CorePromise.resolve(o)},getGroupDepth:function(e){var t,n=0;return e.visit(l.FormaTraversal.PreOrder,(function(e,r,o){return((t=a.opt(e.controller,(function(e){return e.userGroupChild})))||null!=t)&&t&&(n=Math.max(n,r)),!1})),n},isUserGroup:function(e){var t;return!(!(t=a.opt(a.opt(e,(function(e){return e.controller})),(function(e){return e.userGroup})))&&null==t)&&t},isInsideUserGroup:function(e){for(var t=e;null!=t&&!r.isUserGroup(t);)t=a.opt(t,(function(e){return e.parent}));return null!=t}}}),r)},YeWL:function(e,t,n){var r,o=t,a=n("oAGj"),i=n("URxh"),s=n("pmb0"),l=n("RkYL");o.MotionLogicClear=(r=function(){},a.defineClass({name:"MotionLogicClear",ctor:r,statics:{_implements:function(e){return"MotionLogic"==e}},props:{apply:function(e,t,n){var r,o,u=(r=a.as(n.st,"Double"))||null!=r?r:0,c=u+((o=a.as(n.dur,"Double"))||null!=o?o:1),d=i.FormaAnimation.init_9e82(s.MotionFacade.getCurrentAnimationStyle(),l.TheoTime.fromSeconds(u),l.TheoTime.fromSeconds(c),t.concat());e.animation=d}}}),r)},Yudi:function(e,t,n){var r,o=t,a=n("oAGj"),i=n("Z25M"),s=n("FNB+"),l=n("wc1n"),u=n("9Lk3"),c=n("fdtz"),d=n("JO5d"),h=n("T6jX"),p=n("3UhB"),f=n("1NAc"),m=n("zjod"),g=n("zjY7");o.RetargetFeatureExtractor=(r=function(e,t,n,r){void 0===n&&(n=[]),void 0===r&&(r=!1),this.root_=e,this.forFeatures_=a.clone(n),this.featureEvals_=[],this.isTemplate_=t,l.FeatureExtractor.call(this),this.initFeatures(r),this.evaluateFeatures()},a.defineClass({name:"RetargetFeatureExtractor",ctor:r,superName:"FeatureExtractor",statics:{_implements:function(e){return"FeatureExtractorProtocol"==e}},props:{initFeatures:function(e){this.featureEvals_=[["Size",[this.evaluateDesignSize,l.FeatureType.Complex]],["EditingResolution",[this.evaluateEditingResolution,l.FeatureType.Numerical]],["PublishResolution",[this.evaluatePublishingResolution,l.FeatureType.Numerical]],["LayoutId",[this.evaluateLayoutId,l.FeatureType.Categorical]],["Edges",[this.evaluateEdges,l.FeatureType.Complex]],["Focus",[this.evaluateFocus,l.FeatureType.Complex]],["NumImages",[this.evaluateImageCount,l.FeatureType.Numerical]],["NumRetargetableFloatingImages",[this.evaluateRetargetableFloatingImageCount,l.FeatureType.Numerical]],["NumRetargetableBackgroundImages",[this.evaluateRetargetableBackgroundImageCount,l.FeatureType.Numerical]],["NumShapes",[this.evaluateShapeCount,l.FeatureType.Numerical]],["NumGridsCells",[this.evaluateGridCellCount,l.FeatureType.Numerical]],["NumMoveable",[this.evaluateNumMoveable,l.FeatureType.Numerical]],["LockupStrings",[this.evaluateLockupStrings,l.FeatureType.Complex]]],e&&this.featureEvals_.push(["VisualGroupInfo",[this.evaluateVisualGroupInfo,l.FeatureType.Numerical]]),a.append(this.featureEvals_,[["TextRoles",[this.evaluateTextRoles,l.FeatureType.Complex]],["ShapeRoles",[this.evaluateShapeRoles,l.FeatureType.Complex]],["SalientCoverage",[this.evaluateSalientCoverage,l.FeatureType.Numerical]],["GifsCount",[this.evaluateGifsCount,l.FeatureType.Numerical]]])},evaluateFeatures:function(){for(var e=0==this.forFeatures_.length,t=a.iter(this.featureEvals_);!t.done;t.next()){var n=t.value;if(e||!e&&this.forFeatures_.includes(n[0])){var r=n[1],o=(0,r[0])(this);this.setFeature(n[0],o,r[1])}}},evaluateDesignSize:function(e){var t=[];return t.push(i.DesignFeatureUtils.getPageWidth(e.root_)),t.push(i.DesignFeatureUtils.getPageHeight(e.root_)),t},evaluateEditingResolution:function(e){return 2},evaluatePublishingResolution:function(e){return 2},evaluateLayoutId:function(e){var t="default",n=a.clone(e.root_.filterByControllerKind(u.GridController.KIND));return n.length>0&&(t=a.as(n[0].controller,u.GridController).gridStyle.name),t},evaluateEdges:function(e){var t=[],n=a.clone(e.root_.filterWithCallback((function(e){return e.isBackgroundImage()})));return n.length>0&&(t=a.clone(n[0].controller.getAverageEdgeGrid(new f.TheoSize(5,5)))),t},evaluateFocus:function(e){var t=a.clone(e.root_.filterWithCallback((function(e){return e.isBackgroundImage()}))),n=[];if(t.length>0){var r,o=t[0];(r=e.getFocusRegion(o))&&(n=a.clone(r.encodeJson()))}return n},getFocusRegion:function(e){var t=null;return e.visitAll(s.FormaTraversal.JustChildren,(function(e){e instanceof c.ImageForma&&null==t&&(t=e.getFocusRegion())})),t},evaluateImageCount:function(e){return i.DesignFeatureUtils.getNonLogoImageCount(e.root_)},evaluateRetargetableFloatingImageCount:function(e){return i.DesignFeatureUtils.getRetargetableFloatingImageCount(e.root_,e.isTemplate_)},evaluateRetargetableBackgroundImageCount:function(e){return i.DesignFeatureUtils.getRetargetableBackgroundImageCount(e.root_,e.isTemplate_)},evaluateNumMoveable:function(e){return a.toDouble(e.root_.filterWithCallback(i.DesignFeatureUtils.isFloating).length)},evaluateLockupStrings:function(e){return p.TypeLockupUtils.getLockupStringsForRoot(e.root_)},evaluateTextRoles:function(e){for(var t=[],n=a.clone(i.DesignFeatureUtils.getLockupsInDesign(e.root_)),r=a.iter(n);!r.done;r.next()){var o=r.value;t.push(i.DesignFeatureUtils.getRoleString(o))}return t},evaluateShapeRoles:function(e){var t=[];if(h.TheoDocumentUtils.enableFastHeuristicsForComplexPage(e.root_.page))return t;for(var n=a.clone(e.root_.filterWithCallback((function(e){return null!=e.controller&&e.controller.kind==d.ShapeController.KIND&&!e.isGridCell()}))),r=a.iter(n);!r.done;r.next()){var o=r.value;t.push(i.DesignFeatureUtils.getRoleString(o))}return t},evaluateShapeCount:function(e){return a.toDouble(e.root_.filterWithCallback((function(e){return null!=e.controller&&e.controller.kind==d.ShapeController.KIND&&!e.isGridCell()})).length)},evaluateSalientCoverage:function(e){for(var t=a.clone(e.root_.filterWithCallback((function(e){return e.isBackgroundImage()}))),n=0,r=a.iter(t);!r.done;r.next()){var o,i,s,l=r.value;(o=e.root_.finalFrame)&&(i=e.getFocusRegion(l))&&(s=i.intersectionWith(o))&&(n+=s.area/o.area)}return n},evaluateVisualGroupInfo:function(e){var t={},n=a.clone(e.root_.filterWithCallback((function(e){var t,n;return!(null==e.controller||!e.controller.floating||e.controller.userGroup||e.isLogo()||e.kind==c.ImageForma.KIND||!(t=a.opt(e.root,(function(e){return e.finalFrame})))||!(n=e.finalFrame))&&t.intersects(n)})));if(n.length>2*h.TheoDocumentUtils.DESIGN_COMPLEXITY_HEURISTIC_THRESHOLD&&(n=n.slice(0,2*h.TheoDocumentUtils.DESIGN_COMPLEXITY_HEURISTIC_THRESHOLD)),n.length>0){var r=new g.VisualStructureDetector(n,e.root_).inferVisualStructure();return a.opt(r,(function(e){return e.encodeToJson()}))||t}return t},evaluateGridCellCount:function(e){return a.toDouble(e.root_.filterWithCallback((function(e){return null!=e.controller&&e.isGridCell()})).length)},evaluateGifsCount:function(e){var t=a.clone(e.root_.filterWithCallback((function(e){return e.kind==m.VideoForma.KIND})));return a.toDouble(t.length)}}}),r)},YxjU:function(e,t,n){var r,o=t,a=n("oAGj"),i=n("URxh"),s=n("tGKA"),l=n("K17h"),u=n("oKlP"),c=n("RkYL"),d=n("xm77");o.MotionSourceFadeInV=(r=function(){},a.defineClass({name:"MotionSourceFadeInV",ctor:r,statics:{getSrcKeyframes:function(e){var t=[],n=c.TheoTime.Zero,r=c.TheoTime.fromSeconds(1),o=s.Matrix2D.translation(new u.TheoPoint(0,-400)),a=s.Matrix2D.Identity,h=l.MotionUtils.createOpacityStyle(e,0),p=e.style.clone();return t.push(new i.KeyFrame(n,d.TimingFunctionType.EaseInOut,o,null,h)),t.push(new i.KeyFrame(r,d.TimingFunctionType.EaseInOut,a,null,p)),t}}}),r)},Z25M:function(e,t,n){var r,o=t,a=n("oAGj"),i=n("cZuM"),s=n("gXiO"),l=n("FNB+"),u=n("6ZWm"),c=n("cmoc"),d=n("G1DZ"),h=n("fdtz"),p=n("lmwz"),f=n("fNpk"),m=n("c+uM"),g=n("tGKA"),y=n("7Ta2"),_=n("JO5d"),T=n("djAF"),C=n("8t9B"),v=n("sIWg");o.DesignFeatureUtils=(r=function(){s.CoreObject.call(this)},a.defineClass({name:"DesignFeatureUtils",ctor:r,superName:"CoreObject",statics:{evaluateRootEmptySpace:function(e){for(var t=a.clone(e.filterWithCallback((function(e){return null!=e.controller&&e.controller.floating}))),n={},r={},o=a.iter(t);!o.done;o.next()){var i=o.value,s=i.controller.visualParent;null==r[s.formaID]&&(r[s.formaID]=s),null==n[s.formaID]&&(n[s.formaID]=[]),n[s.formaID].push(i)}for(var l=[],u=a.iter(n);!u.done;u.next()){for(var c=u.key,d=u.value,h=0,p=a.iter(d);!p.done;p.next())h+=p.value.finalFrame.area;null!=r[c].finalFrame&&h>0&&l.push(h/r[c].finalFrame.area)}return 0==l.length?0:1-a.min(l)},getSymmAsymmForForma:function(e,t,n){void 0===n&&(n=0);for(var o=[],i=a.iter(e);!i.done;i.next()){var s=i.value;o.push(s.finalFrame)}return r.getSymmAsymm(o,t,n)},getSymmAsymm:function(e,t,n){var o;void 0===n&&(n=0);for(var i=0,s=a.iter(e);!s.done;s.next())for(var l=s.value,u=t?new v.TheoRect(l.minX,1-l.maxY,l.maxX,1-l.minY):new v.TheoRect(1-l.maxX,l.minY,1-l.minX,l.maxY),c=a.iter(e);!c.done;c.next()){var d=c.value,h=r.frameIntersection(d,u);i+=(o=a.opt(h,(function(e){return e.area})))||null!=o?o:0}return e.length>0?i:n},frameIntersection:function(e,t){var n=null;return Math.max(e.minX,t.minX)<Math.min(e.maxX,t.maxX)&&Math.max(e.minY,t.minY)<Math.min(e.maxY,t.maxY)&&(n=new v.TheoRect(Math.max(e.minX,t.minX),Math.max(e.minY,t.minY),Math.min(e.maxX,t.maxX),Math.min(e.maxY,t.maxY))),n},getImageCount:function(e){return a.toDouble(e.filterWithCallback((function(e){return e instanceof h.ImageForma})).length)},getNonLogoImageCount:function(e){return a.toDouble(e.filterWithCallback((function(e){var t;return!!(t=a.as(e,c.FrameForma))&&!t.isLogo()})).length)},getPossibleBackgroundImageCount:function(e){return a.toDouble(e.filterWithCallback((function(e){return p.ImageFacade.isPotentialBackgroundImage(e)})).length)},isRetargetableFloatingImage:function(e,t){return void 0===t&&(t=!1),r.isRetargetableImage(e,t)&&p.ImageFacade.isFloatingImage(e)},isRetargetableBackgroundImage:function(e,t){return void 0===t&&(t=!1),r.isRetargetableImage(e,t)&&!p.ImageFacade.isFloatingImage(e)},isRetargetableImageFromUserDesign:function(e){return r.isRetargetableImage(e,!1)},isRetargetableImageFromTemplate:function(e){return r.isRetargetableImage(e,!0)},isRetargetableImage:function(e,t){var n,o,i;if(void 0===t&&(t=!1),i=a.as(e,c.FrameForma)){if(i.isSticker()||i.isLogo())return!1;if(((n=a.opt(i.source,(function(e){return e.includes(d.FormaSourceNamespace.DesignVariation)})))||null!=n)&&n)return!1;if(((o=a.opt(a.opt(e,(function(e){return e.controller})),(function(e){return e.userGroupMember})))||null!=o)&&o)return!1;var s,l,h;if((s=p.ImageFacade.getImageFormaForForma(i))&&(l=s.boundsInCoordSpace(g.Matrix2D.Identity))&&(h=a.as(i.controller,u.FrameController))){if(l.width<50||l.height<50)return!1;if(s.hasAlpha()&&!h.hasCutout)return!1;if(t&&r.isDecorativeTemplateBackground(i))return!1}return!0}return!1},isDecorativeTemplateBackground:function(e){var t;if(t=a.as(e,c.FrameForma)){var n=a.opt(t.finalFrame,(function(e){return e.intersectionWith(t.root.finalFrame)}))||v.TheoRect.Zero;if(t.isBackgroundImage()||n.area/t.root.finalFrame.area>.75)for(var o=a.clone(t.root.filterWithCallback((function(e){var t;return!!(t=e.controller)&&t.floating&&!t.userGroup}))),i=a.iter(o);!i.done;i.next()){var s,l=i.value;if(l!=t&&l.isGraphic()&&(s=l.finalFrame.intersectionWith(t.finalFrame))&&s.area/l.finalFrame.area>.75&&r.isRetargetableFloatingImage(l,!1))return!0}}return!1},getRetargetableFloatingImageCount:function(e,t){return void 0===t&&(t=!1),a.toDouble(e.filterWithCallback((function(e){return r.isRetargetableFloatingImage(e,t)})).length)},getRetargetableBackgroundImageCount:function(e,t){return void 0===t&&(t=!1),a.toDouble(e.filterWithCallback((function(e){return r.isRetargetableBackgroundImage(e,t)})).length)},getTextCount:function(e){return a.toDouble(e.filterWithCallback((function(e){return e.isTypeLockup()})).length)},getShapeCount:function(e){return a.toDouble(e.filterWithCallback((function(e){return null!=e.controller&&e.controller.kind==_.ShapeController.KIND&&!e.isGridCell()})).length)},getFormaBoundingBox:function(e){for(var t=[],n=a.clone(e.totalPlacement.transformPoints(e.bounds.points)),r=a.iter(n);!r.done;r.next()){var o=r.value;t.push(o.x),t.push(o.y)}return t},formaPercentageArea:function(e){var t,n=0;if(t=e.bounds){var r=a.clone(e.totalPlacement.transformPoints(t.points)),o=r[3].x-r[0].x,i=r[3].y-r[0].y,s=e.page.pageSize.height;n=o*i/(e.page.pageSize.width*s)}return n},getFormaCenterX:function(e){var t=a.clone(e.totalPlacement.transformPoints(e.bounds.points));return(t[0].x+t[3].x)/2/e.page.pageSize.width},getFormaCenterY:function(e){var t=a.clone(e.totalPlacement.transformPoints(e.bounds.points));return(t[0].y+t[3].y)/2/e.page.pageSize.height},getPageWidth:function(e){return e.page.pageSize.width},getPageHeight:function(e){return e.page.pageSize.height},getFormaHeight:function(e){var t=a.clone(e.totalPlacement.transformPoints(e.bounds.points)),n=t[1].distanceTo(t[0]);return f.LegacyCoreAssert.isTrue(n>=0,"width is negative",void 0,"DesignFeatureUtils.getFormaHeight","DesignFeatureUtils.swift",297),n},getFormaWidth:function(e){var t=a.clone(e.totalPlacement.transformPoints(e.bounds.points)),n=t[2].distanceTo(t[0]);return f.LegacyCoreAssert.isTrue(n>=0,"height is negative",void 0,"DesignFeatureUtils.getFormaWidth","DesignFeatureUtils.swift",305),n},sumAreaOfForma:function(e,t){var n,r=0;if(n=t.finalFrame){f.LegacyCoreAssert.isTrue(n.area>0,"root area is negative",void 0,"DesignFeatureUtils.sumAreaOfForma","DesignFeatureUtils.swift",312);for(var o=a.iter(e);!o.done;o.next()){var i;(i=o.value.finalFrame.intersectionWith(n))&&(r+=i.area/n.area)}}return Math.max(r,1)},getLockupsInDesign:function(e){return e.filterByControllerKind(C.TypeLockupController.KIND)},getRoleString:function(e){return(new y.RoleSuggester).getRole(e).role},isFloating:function(e){var t;return(!(t=a.opt(e.controller,(function(e){return e.userGroupChild})))&&null==t||!t)&&(!(null==e.controller||!e.controller.userGroup||!e.controller.floating)||e.isTypeLockup()||e.kind==T.ShapeForma.KIND&&e.hasIntent(l.Forma.INTENT_ICON)||e.kind==c.FrameForma.KIND&&e.controller.floating&&!e.isLogo())},getTypeLockupParentFormaIDofShape:function(e){var t;return e.style.kind==m.LockupStyle.KIND?e.formaID:(t=e.parent)?r.getTypeLockupParentFormaIDofShape(t):null},getLockupsWithin:function(e,t,n){for(var r=[],o=a.iter(t);!o.done;o.next()){var i=o.value,s=i.finalFrame.center.distanceTo(e.finalFrame.center);e.formaID!=i.formaID&&s<n&&r.push(i)}return r},getSetDiff:function(e,t){for(var n=[],r=a.iter(e);!r.done;r.next()){for(var o=r.value,i=!1,s=a.iter(t);!s.done;s.next())s.value.forma.formaID==o.formaID&&(i=!0);i||n.push(o)}return n},getSetSimm:function(e,t){for(var n=[],r=a.iter(e);!r.done;r.next())for(var o=r.value,i=a.iter(t);!i.done;i.next()){var s=i.value;if(s.forma.formaID==o.formaID){n.push(s);break}}return n},getAlignmentConcensus:function(e){for(var t={},n=a.iter(e);!n.done;n.next()){var r=n.value,o=i.describeAlignmentType(r.line.type);a.keys(t).includes(o)?t[o]=t[o]+1:t[o]=1}for(var s=0,l=i.describeAlignmentType(i.AlignmentType.None),u=a.iter(a.keys(t));!u.done;u.next())t[o=u.value]>s&&(s=t[o],l=o);var c=0;return e.length>0&&(c=a.toDouble(s)/a.toDouble(e.length)),a.dict([l,c])}}}),r)},ZhwN:function(e,t,n){var r,o=t,a=n("oAGj"),i=n("gXiO"),s=n("iCxV");o.GUIDUtils=(r=function(){i.CoreObject.call(this)},a.defineClass({name:"GUIDUtils",ctor:r,superName:"CoreObject",statics:{makeGUID:function(){var e;return(e=a.opt(s.Host.resourceUtils,(function(e){return e.makeGUID()})))||null!=e?e:""}}}),r)},a9ow:function(e,t,n){var r,o,a,i,s,l,u,c,d,h=t,p=n("oAGj"),f=n("qsM9"),m=n("SpAV"),g=n("dJuF"),y=n("QgZx"),_=n("iCxV"),T=n("fNpk"),C=n("Zifs");h.TextAttribute=(r=function(e){this.value_=e},p.defineClass({name:"TextAttribute",ctor:r,superName:"CoreObject",statics:{PROPERTY_VALUE:"value",PROPERTY_START:"start",PROPERTY_LENGTH:"length"},props:{isEqual:function(e){return m.CoreAssert.fail("unimplemented override of isEqual",void 0,"TextAttribute.isEqual","TextAttribute.swift",23),!1},hash:{get:function(){return m.CoreAssert.fail("unimplemented override of hash",void 0,"TextAttribute","TextAttribute.swift",28),0}},description:{get:function(){return T.LegacyCoreAssert.fail("missing override of description",void 0,"TextAttribute","TextAttribute.swift",33),"TextAttribute"}},clone:function(){return new r(this.value_)}}}),r),h.UTF16Attribute=(o=function(e){h.TextAttribute.call(this,e)},p.defineClass({name:"UTF16Attribute",ctor:o,superName:"TextAttribute",statics:{NAME:{get:function(){return"text"}},codec:{get:function(){var e,t="UTF16Attribute";return g.DBPropertyCodec.typeCodec(t)||g.DBPropertyCodec.registerCodec(t,g.DBPropertyCodec.codec((function(e,n,r){var a,i=g.DBProperty.deleted(e);return(a=p.as(n,o))&&(i=g.DBProperty.dictEncoded(e,{start:g.DBProperty.intProperty(e.append(h.TextAttribute.PROPERTY_START),0),length:g.DBProperty.intProperty(e.append(h.TextAttribute.PROPERTY_LENGTH),0),value:g.DBProperty.stringProperty(e.append(h.TextAttribute.PROPERTY_VALUE),a.value)},t)),i}),(function(t,n){var r;return((e=p.opt(t,(function(e){return e.isDictionary})))||null!=e)&&e&&null!=(r=p.opt(t.getDictionaryProperty(h.TextAttribute.PROPERTY_VALUE),(function(e){return e.stringValue})))?new o(r):null}),t))}}},props:{value:{get:function(){return this.value_}},isEqual:function(e){var t;return!!(t=p.as(e,o))&&t.value==this.value},hash:{get:function(){return p.hashValue(this.value)}},description:{get:function(){return this.value}},clone:function(){return new o(this.value)}}}),o),h.FontDescriptorAttribute=(a=function(e){h.TextAttribute.call(this,e)},p.defineClass({name:"FontDescriptorAttribute",ctor:a,superName:"TextAttribute",statics:{NAME:{get:function(){return"font-name"}},codec:{get:function(){var e,t="FontDescriptorAttribute";return g.DBPropertyCodec.typeCodec(t)||g.DBPropertyCodec.registerCodec(t,g.DBPropertyCodec.codec((function(e,n,r){var o,i=g.DBProperty.deleted(e);return(o=p.as(n,a))&&(i=g.DBProperty.dictEncoded(e,{start:g.DBProperty.intProperty(e.append(h.TextAttribute.PROPERTY_START),0),length:g.DBProperty.intProperty(e.append(h.TextAttribute.PROPERTY_LENGTH),0),value:f.Codecs.fontDescriptorCodec.encode(e.append(h.TextAttribute.PROPERTY_VALUE),o.value_,r)},t)),i}),(function(t,n){var r;return((e=p.opt(t,(function(e){return e.isDictionary})))||null!=e)&&e&&(r=p.as(f.Codecs.fontDescriptorCodec.decode(t.getDictionaryProperty(h.TextAttribute.PROPERTY_VALUE),n),y.FontDescriptor))?new a(r):null}),t))}}},props:{postscriptName:{get:function(){return this.value.postScriptName}},value:{get:function(){var e;return(e=p.as(this.value_,y.FontDescriptor))||null!=e?e:_.Host.textModelUtils.defaultFont()}},isEqual:function(e){var t;return!!(t=p.as(e,a))&&(t.value===this.value||p.eq(y._equality_FontDescriptor_FontDescriptor,t.value,this.value))},hash:{get:function(){return this.value.hash}},description:{get:function(){return this.value.postScriptName}},clone:function(){return new a(this.value)}}}),a),h.FontSizeAttribute=(i=function(e){h.TextAttribute.call(this,e)},p.defineClass({name:"FontSizeAttribute",ctor:i,superName:"TextAttribute",statics:{NAME:{get:function(){return"font-size"}},codec:{get:function(){var e,t="FontSizeAttribute";return g.DBPropertyCodec.typeCodec(t)||g.DBPropertyCodec.registerCodec(t,g.DBPropertyCodec.codec((function(e,n,r){var o,a=g.DBProperty.deleted(e);return(o=p.as(n,i))&&(a=g.DBProperty.dictEncoded(e,{start:g.DBProperty.intProperty(e.append(h.TextAttribute.PROPERTY_START),0),length:g.DBProperty.intProperty(e.append(h.TextAttribute.PROPERTY_LENGTH),0),value:g.DBProperty.doubleProperty(e.append(h.TextAttribute.PROPERTY_VALUE),o.value)},t)),a}),(function(t,n){var r;return((e=p.opt(t,(function(e){return e.isDictionary})))||null!=e)&&e&&null!=(r=p.opt(t.getDictionaryProperty(h.TextAttribute.PROPERTY_VALUE),(function(e){return e.doubleValue})))?new i(r):null}),t))}}},props:{value:{get:function(){return this.value_}},isEqual:function(e){var t;return!!(t=p.as(e,i))&&t.value==this.value},hash:{get:function(){return p.hashValue(this.value)}},description:{get:function(){return this.value}},clone:function(){return new i(this.value)}}}),i),h.FontColorAttribute=(s=function(e){h.TextAttribute.call(this,e)},p.defineClass({name:"FontColorAttribute",ctor:s,superName:"TextAttribute",statics:{NAME:{get:function(){return"font-color"}},codec:{get:function(){var e,t="FontColorAttribute";return g.DBPropertyCodec.typeCodec(t)||g.DBPropertyCodec.registerCodec(t,g.DBPropertyCodec.codec((function(e,n,r){var o,a=g.DBProperty.deleted(e);return(o=p.as(n,s))&&(a=g.DBProperty.dictEncoded(e,{start:g.DBProperty.intProperty(e.append(h.TextAttribute.PROPERTY_START),0),length:g.DBProperty.intProperty(e.append(h.TextAttribute.PROPERTY_LENGTH),0),value:f.Codecs.solidColorCodec.encode(e.append(h.TextAttribute.PROPERTY_VALUE),o.value_,r)},t)),a}),(function(t,n){var r;return((e=p.opt(t,(function(e){return e.isDictionary})))||null!=e)&&e&&(r=p.as(f.Codecs.solidColorCodec.decode(t.getDictionaryProperty(h.TextAttribute.PROPERTY_VALUE),n),C.SolidColor))?new s(r):null}),t))}}},props:{value:{get:function(){return this.value_}},isEqual:function(e){var t;return!!(t=p.as(e,s))&&p.eq(C._equality_SolidColor_SolidColor,t.value,this.value)},hash:{get:function(){return this.value.hash}},description:{get:function(){return this.value.asString}},clone:function(){return new s(this.value)}}}),s),h.FontStrokeColorAttribute=(l=function(e){h.TextAttribute.call(this,e)},p.defineClass({name:"FontStrokeColorAttribute",ctor:l,superName:"TextAttribute",statics:{NAME:{get:function(){return"font-strokecolor"}},codec:{get:function(){var e,t="FontStrokeColorAttribute";return g.DBPropertyCodec.typeCodec(t)||g.DBPropertyCodec.registerCodec(t,g.DBPropertyCodec.codec((function(e,n,r){var o,a=g.DBProperty.deleted(e);return(o=p.as(n,l))&&(a=g.DBProperty.dictEncoded(e,{start:g.DBProperty.intProperty(e.append(h.TextAttribute.PROPERTY_START),0),length:g.DBProperty.intProperty(e.append(h.TextAttribute.PROPERTY_LENGTH),0),value:f.Codecs.solidColorCodec.encode(e.append(h.TextAttribute.PROPERTY_VALUE),o.value_,r)},t)),a}),(function(t,n){var r;return((e=p.opt(t,(function(e){return e.isDictionary})))||null!=e)&&e&&(r=p.as(f.Codecs.solidColorCodec.decode(t.getDictionaryProperty(h.TextAttribute.PROPERTY_VALUE),n),C.SolidColor))?new l(r):null}),t))}}},props:{value:{get:function(){return this.value_}},isEqual:function(e){var t;return!!(t=p.as(e,l))&&p.eq(C._equality_SolidColor_SolidColor,t.value,this.value)},hash:{get:function(){return this.value.hash}},description:{get:function(){return this.value.asString}},clone:function(){return new l(this.value)}}}),l),h.FontStrokeWidthAttribute=(u=function(e){h.TextAttribute.call(this,e)},p.defineClass({name:"FontStrokeWidthAttribute",ctor:u,superName:"TextAttribute",statics:{NAME:{get:function(){return"font-strokewidth"}},codec:{get:function(){var e,t="FontStrokeWidthAttribute";return g.DBPropertyCodec.typeCodec(t)||g.DBPropertyCodec.registerCodec(t,g.DBPropertyCodec.codec((function(e,n,r){var o,a=g.DBProperty.deleted(e);return(o=p.as(n,u))&&(a=g.DBProperty.dictEncoded(e,{start:g.DBProperty.intProperty(e.append(h.TextAttribute.PROPERTY_START),0),length:g.DBProperty.intProperty(e.append(h.TextAttribute.PROPERTY_LENGTH),0),value:g.DBProperty.doubleProperty(e.append(h.TextAttribute.PROPERTY_VALUE),o.value)},t)),a}),(function(t,n){var r;return((e=p.opt(t,(function(e){return e.isDictionary})))||null!=e)&&e&&null!=(r=p.opt(t.getDictionaryProperty(h.TextAttribute.PROPERTY_VALUE),(function(e){return e.doubleValue})))?new u(r):null}),t))}}},props:{value:{get:function(){return this.value_}},isEqual:function(e){var t;return!!(t=p.as(e,u))&&t.value==this.value},hash:{get:function(){return p.hashValue(this.value)}},description:{get:function(){return this.value}},clone:function(){return new u(this.value)}}}),u),h.TextLookAttribute=(c=function(e){h.TextAttribute.call(this,e)},p.defineClass({name:"TextLookAttribute",ctor:c,superName:"TextAttribute",statics:{NAME:{get:function(){return"text-look"}},codec:{get:function(){var e,t="TextLookAttribute";return g.DBPropertyCodec.typeCodec(t)||g.DBPropertyCodec.registerCodec(t,g.DBPropertyCodec.codec((function(e,n,r){var o,a=g.DBProperty.deleted(e);return(o=p.as(n,c))&&(a=g.DBProperty.dictEncoded(e,{start:g.DBProperty.intProperty(e.append(h.TextAttribute.PROPERTY_START),0),length:g.DBProperty.intProperty(e.append(h.TextAttribute.PROPERTY_LENGTH),0),value:g.DBProperty.intProperty(e.append(h.TextAttribute.PROPERTY_VALUE),o.value)},t)),a}),(function(t,n){var r;return((e=p.opt(t,(function(e){return e.isDictionary})))||null!=e)&&e&&null!=(r=p.opt(t.getDictionaryProperty(h.TextAttribute.PROPERTY_VALUE),(function(e){return e.intValue})))?new c(r):null}),t))}}},props:{value:{get:function(){return this.value_}},isEqual:function(e){var t;return!!(t=p.as(e,c))&&t.value==this.value},hash:{get:function(){return p.hashValue(this.value)}},description:{get:function(){return this.value}},clone:function(){return new c(this.value)}}}),c),h.TrackingAttribute=(d=function(e){h.TextAttribute.call(this,e)},p.defineClass({name:"TrackingAttribute",ctor:d,superName:"TextAttribute",statics:{NAME:{get:function(){return"tracking"}},codec:{get:function(){var e,t="TrackingAttribute";return g.DBPropertyCodec.typeCodec(t)||g.DBPropertyCodec.registerCodec(t,g.DBPropertyCodec.codec((function(e,n,r){var o,a=g.DBProperty.deleted(e);return(o=p.as(n,d))&&(a=g.DBProperty.dictEncoded(e,{start:g.DBProperty.intProperty(e.append(h.TextAttribute.PROPERTY_START),0),length:g.DBProperty.intProperty(e.append(h.TextAttribute.PROPERTY_LENGTH),0),value:g.DBProperty.doubleProperty(e.append(h.TextAttribute.PROPERTY_VALUE),o.value)},t)),a}),(function(t,n){var r;return((e=p.opt(t,(function(e){return e.isDictionary})))||null!=e)&&e&&null!=(r=p.opt(t.getDictionaryProperty(h.TextAttribute.PROPERTY_VALUE),(function(e){return e.doubleValue})))?new d(r):null}),t))}}},props:{value:{get:function(){return this.value_}},isEqual:function(e){var t;return!!(t=p.as(e,d))&&t.value==this.value},hash:{get:function(){return p.hashValue(this.value)}},description:{get:function(){return this.value}},clone:function(){return new d(this.value)}}}),d)},aN2p:function(e,t,n){var r,o,a=t,i=n("oAGj"),s=n("kVgh"),l=n("Vvcj"),u=n("fNpk"),c=n("Zifs");a.SimpleSwatch=(r=function(){},o={},i.defineClass({name:"SimpleSwatch",ctor:r,superName:"ColorSwatch",statics:{SCHEMA_CLASS_NAME:"SimpleSwatch",factory:{get:function(){return void 0===o.factory&&(o.factory=function(e,t,n,o){var a=i.as(i.opt(i.opt(o,(function(e){return e.backLink})),(function(e){return e.dereference()})),l.ColorThemeDocument);return u.LegacyCoreAssert.isTrue(null!=a,"SimpleSwatch needs a parent ColorThemeDocument",void 0,"SimpleSwatch","SimpleSwatch.swift",15),r.init_7e49(e,n,a)}),o.factory},set:function(e){o.factory=e}},KIND:"simple",PROPERTY_COLOR:"color",_implements:function(e){return"IDBObject"==e||"TheoMessagePublisher"==e}},props:{className:{get:function(){return r.SCHEMA_CLASS_NAME}},color:{get:function(){return i.as(this.get(r.PROPERTY_COLOR),c.SolidColor)},set:function(e){this.set(r.PROPERTY_COLOR,e)}},match:function(e){var t=i.as(e,r);null!=t&&(this.color=t.color),s.ColorSwatch.prototype.match.call(this,e)},solidRepresentation:{get:function(){return this.color}},kind:{get:function(){return r.KIND}},init_7e49:function(e,t,n){i.super_init(this,s.ColorSwatch,s.ColorSwatch.prototype.init_7e49,e,t,n)},init_d0e4:function(e){i.super_init(this,s.ColorSwatch,s.ColorSwatch.prototype.init_d0e4,e)}}}),r)},aS4X:function(e,t,n){var r,o=t,a=n("oAGj"),i=n("hEh8");o.DCXDocumentDecoder=(r=function(e){i.DCXNodeDecoder.call(this,e,e.root)},a.defineClass({name:"DCXDocumentDecoder",ctor:r,superName:"DCXNodeDecoder",statics:{_implements:function(e){return"IImportDataObject"==e}},props:{getPropertyOnNode:function(e){var t=i.DCXNodeDecoder.prototype.getPropertyOnNode.call(this,e);return null==t&&(t=a.as(this.branch_.getValue(e),"AnyObject")),t}}}),r)},az6C:function(e,t,n){var r,o,a=t,i=n("oAGj"),s=n("gXiO");a.GaussianKernel=(r=function(){this.glKernel=[],this.windowWidth=0},i.defineClass({name:"GaussianKernel",ctor:r,superName:"CoreObject",props:{set:function(e,t){this.glKernel=i.clone(e),this.windowWidth=t}}}),r),a.Sharpen=(o=function(){s.CoreObject.call(this)},i.defineClass({name:"Sharpen",ctor:o,superName:"CoreObject",statics:{computeGaussianKernels:function(e,t,n){var r=new a.GaussianKernel,s=4*e/100*i.toDouble(t+n)/400,l=i.toInt(Math.floor(1.5*s)+1),u=0;l>4&&(u=i.toInt(Math.floor((i.toDouble(l)/i.toDouble(4)-1)/2)+1),l=i.toInt(Math.floor(i.toDouble(l)/i.toDouble(2*u+1))+1));for(var c=2*u+1,d=2*l+1,h=[],p=0,f=i.iter(i.range(0,d,!1));!f.done;f.next()){var m=f.value;p+=i.toDouble(c)*(o.MoaMathNormalCDF(i.toDouble(m)+.5-i.toDouble(l),s/i.toDouble(c))-o.MoaMathNormalCDF(i.toDouble(m)-.5-i.toDouble(l),s/i.toDouble(c)))}for(var g=0,y=i.iter(i.range(0,d,!1));!y.done;y.next())m=y.value,h.push(1/p*i.toDouble(4096)*(o.MoaMathNormalCDF(i.toDouble(m)+.5-i.toDouble(l),s/i.toDouble(c))-o.MoaMathNormalCDF(i.toDouble(m)-.5-i.toDouble(l),s/i.toDouble(c)))),g+=h[m];for(var _=4-i.toInt((d-1)/2),T=4+i.toInt((d-1)/2),C=[],v=i.iter(i.range(0,8,!0));!v.done;v.next())(m=v.value)<_||m>T?C.push(0):C.push(i.toDouble(h[m-_])/g);return r.set(C,c),r},get357FactorsOfClosestFactorableNumber:function(e){for(var t=!1,n=0,r=e,o=[0,0,0];!t;)if(r=e+n,(n*=-1)<=0&&(n-=1),!(r<3)){t=!0;var a=r,i=[3,5,7];o[0]=0,o[1]=0,o[2]=0;for(var s=0;a>1;)if(a%i[s]==0?(o[s]=o[s]+1,a/=i[s]):s+=1,s>=3){t=!1;break}}return o},MoaMathNormalCDF:function(e,t){return(1+o.MoaMathErf(e/1.4142135623730951/t))/2},MoaMathErf:function(e){return e>=0?1-o.MoaMathErfccheb(e):o.MoaMathErfccheb(-e)-1},MoaMathErfccheb:function(e){var t,n=[-1.3026537197817094,.6419697923564902,.019476473204185836,-.00956151478680863,-.000946595344482036,.000366839497852761,42523324806907e-18,-20278578112534e-18,-1624290004647e-18,130365583558e-17,1.5626441722e-8,-8.5238095915e-8,6.529054439e-9,5.059343495e-9,-9.91364156e-10,-2.27365122e-10,96467911e-18,2394038e-18,-6886027e-18,894487e-18,313092e-18,-112708e-18,381e-18,7106e-18,-1523e-18,-94e-18,121e-18,-28e-18];if(e<0)return 0;for(var r=0,o=0,a=2/(2+e),s=4*a-2,l=i.iter(i.range(1,27,!0).reversed());!l.done;l.next())t=r,r=s*r-o+n[l.value],o=t;return a*Math.exp(-e*e+.5*(n[0]+s*r)-o)}}}),o)},"c+uM":function(e,t,n){var r,o,a=t,i=n("oAGj"),s=n("qsM9"),l=n("SpAV"),u=n("ascj"),c=n("fVJ2"),d=n("dJuF"),h=n("13MC"),p=n("QgZx"),f=n("QbzR"),m=n("ZhwN"),g=n("iCxV"),y=n("fNpk"),_=n("3DEm"),T=n("Zifs"),C=n("35Q0"),v=n("9YN4"),P=n("VJ9E"),S=n("BgH2"),A=n("oKI3");a.LockupLayout=i.defineEnum("LockupLayout",{SKIP:-2,UNSET:-1,FitJustified:0,LegacyLeft:1,LegacyRight:2,LegacyCenter:3,Standard:4,LetterGrid:5,Path:6,Auto:7}),a.LockupAlignment=i.defineEnum("LockupAlignment",{SKIP:-2,UNSET:-1,Left:0,Right:1,Center:2,Triplet:120,TripletRotatedMiddleMulti:121,TripletRotatedMiddle:122,TripletRotatedEnds:123,RotateTopStart:140,RotateBottomStart:142,RotateFitStart:143,RotateFullStart:146,RotateBottomEnd:145,RotateTopEnd:141,RotateFitEnd:144,RotateFullEnd:147,DropCapTop:180,DropCapBottom:182,DropCapFit:183,DropCap:184,FitRotateFit:202,RotateAndFit:203}),a.VerticalLockupAlignment=i.defineEnum("VerticalLockupAlignment",{UNSET:-1,Top:0,Bottom:1,VerticalCenter:2}),a.LockupBacking=i.defineEnum("LockupBacking",{UNSET:-1,None:0,Frame:1,Rows:2,Box:3,LegacyShadow:4,Banner:5,LeftRight:6,SVGBackground:7,BannerVertical:8,BannerHorizontal:9,TopBottom:10,Knockout:11}),a.LockupTextLook=i.defineEnum("LockupTextLook",{SKIP:-2,UNSET:-1,Fill:0,KnockoutOnly:1,KnockoutAndOutline:2,OutlineOnly:3,FillAndOutline:4,FillAndOutline2:5,KnockoutAndFill:6,Shadow:7,ShadowAndOutline:8,KnockoutAndShadow:9,ShadowOutlineTransparentText:10,KnockoutShadowOutline:11}),a.LockupStyle=(r=function(){this.cachedCharacterStyles_=null},o={},i.defineClass({name:"LockupStyle",ctor:r,superName:"FormaStyle",statics:{SCHEMA_CLASS_NAME:{get:function(){return"LockupStyle"}},KIND:{get:function(){return"LockupStyle"}},DEFAULT_PADDING:.65,DEFAULT_SPACING:.35,DEFAULT_SHADOWOFFSET:.5,DEFAULT_STROKEWEIGHT:.1,DEFAULT_WHEELUSED:!1,DEFAULT_TRACKING:0,DEFAULT_RELATIVE_FONT_SCALE:-1,DEFAULT_TEXTOPACITY:1,DEFAULT_BACKINGOPACITY:1,DEFAULT_SHADOWANGLE:135,UNSET_FONT:null,UNSET_SPACING:-1,UNSET_RELATIVE_FONT_SCALE:{get:function(){return void 0===o.UNSET_RELATIVE_FONT_SCALE&&(o.UNSET_RELATIVE_FONT_SCALE=r.DEFAULT_RELATIVE_FONT_SCALE),o.UNSET_RELATIVE_FONT_SCALE}},UNSET_TRACKING:-99,UNSET_PADDING:0,UNSET_BACKING:{get:function(){return void 0===o.UNSET_BACKING&&(o.UNSET_BACKING=a.LockupBacking.None),o.UNSET_BACKING}},UNSET_LAYOUT:{get:function(){return void 0===o.UNSET_LAYOUT&&(o.UNSET_LAYOUT=a.LockupLayout.UNSET),o.UNSET_LAYOUT}},UNSET_BACKING_ARTWORK_ID:null,UNSET_SHADOW_ANGLE:-1,UNSET_TEXT_LOOK:{get:function(){return void 0===o.UNSET_TEXT_LOOK&&(o.UNSET_TEXT_LOOK=a.LockupTextLook.UNSET),o.UNSET_TEXT_LOOK}},UNSET_SHADOW_OFFSET:-1,UNSET_STROKE_WEIGHT:-1,PROPERTY_FONTS:"fonts",PROPERTY_SPACING:"spacing",PROPERTY_TRACKING:"tracking",PROPERTY_RELATIVE_FONT_SCALE:"relativeFontScale",PROPERTY_PADDING:"padding",PROPERTY_BACKING:"backing",PROPERTY_LAYOUT:"layout",PROPERTY_ALIGNMENT:"alignment",PROPERTY_VERTICAL_ALIGNMENT:"verticalAlignment",PROPERTY_BACKING_ARTWORK_ID:"backingArtworkID",PROPERTY_SHADOW_ANGLE:"shadowAngle",PROPERTY_TEXT_OPACITY:"text-opacity",PROPERTY_BACKING_OPACITY:"backing-opacity",PROPERTY_KNOCKOUT:"knockout",PROPERTY_CHARSTYLES:"character-styles",PROPERTY_SHADOW_OFFSET:"shadowOffset",PROPERTY_STROKE_WEIGHT:"strokeWeight",PROPERTY_LINEBREAK:"linebreak",PROPERTY_PATH_ID:"pathID",PROPERTY_CUSTOM_PATH:"customPath",PROPERTY_WHEELUSED:"wheel-used",unsetCharacterStyleProperties:{get:function(){return void 0===o.unsetCharacterStyleProperties&&(o.unsetCharacterStyleProperties=i.dict([r.PROPERTY_SPACING,d.DBProperty.doubleProperty(d.DBNamePath.init_b14a(r.PROPERTY_SPACING),r.UNSET_SPACING,!0),r.PROPERTY_TRACKING,d.DBProperty.doubleProperty(d.DBNamePath.init_b14a(r.PROPERTY_TRACKING),r.UNSET_TRACKING,!0),r.PROPERTY_PADDING,d.DBProperty.doubleProperty(d.DBNamePath.init_b14a(r.PROPERTY_PADDING),r.UNSET_PADDING,!0),r.PROPERTY_BACKING,d.DBProperty.intProperty(d.DBNamePath.init_b14a(r.PROPERTY_BACKING),r.UNSET_BACKING,!0),r.PROPERTY_SHADOW_ANGLE,d.DBProperty.doubleProperty(d.DBNamePath.init_b14a(r.PROPERTY_SHADOW_ANGLE),r.UNSET_SHADOW_ANGLE,!0),r.PROPERTY_LAYOUT,d.DBProperty.intProperty(d.DBNamePath.init_b14a(r.PROPERTY_LAYOUT),r.UNSET_LAYOUT,!0),r.PROPERTY_TEXT_OPACITY,d.DBProperty.doubleProperty(d.DBNamePath.init_b14a(r.PROPERTY_TEXT_OPACITY),f.FormaStyle.OPACITY_UNSET,!0),r.PROPERTY_BACKING_OPACITY,d.DBProperty.doubleProperty(d.DBNamePath.init_b14a(r.PROPERTY_BACKING_OPACITY),f.FormaStyle.OPACITY_UNSET,!0),r.PROPERTY_KNOCKOUT,d.DBProperty.intProperty(d.DBNamePath.init_b14a(r.PROPERTY_KNOCKOUT),r.UNSET_TEXT_LOOK,!0),r.PROPERTY_SHADOW_OFFSET,d.DBProperty.doubleProperty(d.DBNamePath.init_b14a(r.PROPERTY_SHADOW_OFFSET),r.UNSET_SHADOW_OFFSET,!0),r.PROPERTY_STROKE_WEIGHT,d.DBProperty.doubleProperty(d.DBNamePath.init_b14a(r.PROPERTY_STROKE_WEIGHT),r.UNSET_STROKE_WEIGHT,!0),r.PROPERTY_RELATIVE_FONT_SCALE,d.DBProperty.doubleProperty(d.DBNamePath.init_b14a(r.PROPERTY_RELATIVE_FONT_SCALE),r.UNSET_RELATIVE_FONT_SCALE,!0)])),o.unsetCharacterStyleProperties}},factory:{get:function(){return function(e,t,n,o){return r.init_866e(n,e)}}},characterStyleSchemaClassName:"CharacterStyle",characterStyleCodec:{get:function(){return void 0===o.characterStyleCodec&&(o.characterStyleCodec=d.DBPropertyCodec.registerCodec(r.characterStyleSchemaClassName,d.DBPropertyCodec.init_a58a((function(e,t,n){var o,a=d.DBProperty.deleted(e);return(o=i.as(t,r))?(a=d.DBProperty.dictEncoded(e,o.state.allProperties,o.className),null==n||o.isChildObject||n.addChildObject(o,e)):y.LegacyCoreAssert.fail("Expected LockupStyle",{actual:t},"LockupStyle","LockupStyle.swift",219),a}),(function(e,t){var n,o=null;if(null!=(n=i.opt(e,(function(e){return e.className})))){var a,s,l,p=m.GUIDUtils.makeGUID();if(a=i.opt(e,(function(e){return e.namePath})))o=(l=i.as(t,c.DBObject))?i.as(l.createChildObject(r.SCHEMA_CLASS_NAME,a),r):r.init_866e(h.DBChildObjectState.init_94ed(t,a),p);else if(s=i.opt(e,(function(e){return e.dictionaryValue}))){var g=i.clone(r.unsetCharacterStyleProperties);y.LegacyCoreAssert.isTrue(n==r.characterStyleSchemaClassName||n==r.SCHEMA_CLASS_NAME,"Unexpected schema description for character style",void 0,"LockupStyle","LockupStyle.swift",237),g[f.FormaStyle.PROPERTY_COLORS]=u.ColorTable.codec.encode(d.DBNamePath.init_b14a(f.FormaStyle.PROPERTY_COLORS),u.ColorTable.init_25f6([{key:u.ColorRole.FieldPrimary,value:"themeColor0"},{key:u.ColorRole.FieldSecondary,value:"themeColor1"},{key:u.ColorRole.Border,value:"themeColor1"},{key:u.ColorRole.Shadow,value:"themeColor1"}]),null),i.each(s,(function(e,t){g[e]=t})),o=r.init_dd5d(g,{})}}return o}),r.characterStyleSchemaClassName))),o.characterStyleCodec}},createDefault:function(){var e=P.TheoFont.init_9e5c(g.Host.textModelUtils.defaultFont()),t=u.ColorTable.init_25f6([{key:u.ColorRole.FieldPrimary,value:"themeColor0"},{key:u.ColorRole.FieldSecondary,value:"themeColor1"},{key:u.ColorRole.Border,value:"themeColor1"},{key:u.ColorRole.Shadow,value:"themeColor1"}]);return r.init_f3fd(r.DEFAULT_TEXTOPACITY,r.DEFAULT_BACKINGOPACITY,t,e,r.DEFAULT_SPACING,r.DEFAULT_TRACKING,r.DEFAULT_PADDING,a.LockupBacking.None,null,r.DEFAULT_SHADOWANGLE,a.LockupLayout.FitJustified,a.LockupAlignment.UNSET,a.LockupTextLook.Fill,r.DEFAULT_SHADOWOFFSET,r.DEFAULT_STROKEWEIGHT,void 0,void 0,r.DEFAULT_WHEELUSED,r.UNSET_RELATIVE_FONT_SCALE,a.VerticalLockupAlignment.UNSET)},createDefaultCharacterStyle:function(e){var t=r.createDefault();return t.colorLibrary=e.colorLibrary,t.setEmptyStyle(),r.isKnockoutLook(e.textLook)?t.textLook=a.LockupTextLook.Fill:e.backing==a.LockupBacking.Rows&&e.padding<.4&&e.spacing>0&&(t.backing=a.LockupBacking.Rows,t.colors.setColorId(u.ColorRole.FieldPrimary,e.colors.colorID(u.ColorRole.FieldSecondary)),t.colors.setColorId(u.ColorRole.FieldSecondary,e.colors.colorID(u.ColorRole.FieldPrimary)),t.colors.setColorId(u.ColorRole.Border,e.colors.colorID(u.ColorRole.Border)),t.colors.setColorId(u.ColorRole.Shadow,e.colors.colorID(u.ColorRole.Shadow))),r.isLetterGrid(e.layout)&&(t.backing=a.LockupBacking.UNSET),t},isKnockoutLook:function(e){return e==a.LockupTextLook.KnockoutOnly||e==a.LockupTextLook.KnockoutAndOutline||e==a.LockupTextLook.KnockoutAndFill||e==a.LockupTextLook.KnockoutAndShadow||e==a.LockupTextLook.KnockoutShadowOutline},isOutlineLook:function(e){return e==a.LockupTextLook.KnockoutAndOutline||e==a.LockupTextLook.OutlineOnly||e==a.LockupTextLook.FillAndOutline||e==a.LockupTextLook.FillAndOutline2||e==a.LockupTextLook.ShadowAndOutline||e==a.LockupTextLook.KnockoutShadowOutline||e==a.LockupTextLook.ShadowOutlineTransparentText},isShadowLook:function(e){return e==a.LockupTextLook.Shadow||e==a.LockupTextLook.ShadowAndOutline||e==a.LockupTextLook.KnockoutAndShadow||e==a.LockupTextLook.KnockoutShadowOutline||e==a.LockupTextLook.ShadowOutlineTransparentText},isOutlineWithTransparentTextLook:function(e){return e==a.LockupTextLook.OutlineOnly||e==a.LockupTextLook.ShadowOutlineTransparentText},isDuplicateFormaLook:function(e){return e==a.LockupTextLook.Shadow||e==a.LockupTextLook.ShadowAndOutline||e==a.LockupTextLook.FillAndOutline2||e==a.LockupTextLook.KnockoutAndShadow},doesLookColorMatchShapeColor:function(e){return e==a.LockupTextLook.Shadow||e==a.LockupTextLook.ShadowAndOutline||e==a.LockupTextLook.FillAndOutline||e==a.LockupTextLook.FillAndOutline2||e==a.LockupTextLook.OutlineOnly},isAutoLayout:function(e){return e==a.LockupLayout.Auto},isLetterGrid:function(e){return e==a.LockupLayout.LetterGrid},isPath:function(e){return e==a.LockupLayout.Path},doesPerLetterLayout:function(e){return r.isLetterGrid(e)||r.isPath(e)},layoutSupportsAlignments:function(e){return e==a.LockupLayout.LetterGrid||e==a.LockupLayout.Standard},_implements:function(e){return"IDBObject"==e||"TheoMessagePublisher"==e||"ColorTableOwner"==e}},props:{description:{get:function(){var e="LockupStyle: ",t=i.clone(i.as(this.get(r.PROPERTY_FONTS),["Array",P.TheoFont])||[]);return e+=r.PROPERTY_FONTS+": "+(1==t.length?t[0].fontData.postScriptName:"<unset>")+" | "}},init_866e:function(e,t){i.super_init(this,f.FormaStyle,f.FormaStyle.prototype.init_866e,e,t),this.fixLegacyProperties()},init_dd5d:function(e,t){i.super_init(this,f.FormaStyle,f.FormaStyle.prototype.init_dd5d,e,t),this.fixLegacyProperties()},init_f3fd:function(e,t,n,o,s,u,c,d,h,p,m,_,T,C,v,P,S,D,E,R){void 0===P&&(P=A.TextPathID.UNSET),void 0===S&&(S=null),void 0===D&&(D=r.DEFAULT_WHEELUSED),void 0===E&&(E=r.DEFAULT_RELATIVE_FONT_SCALE),void 0===R&&(R=a.VerticalLockupAlignment.UNSET),(u<-1||u>1)&&i.opt(g.Host.logging,(function(e){return e.warning("Tracking must be between -1 and 1.")}));var F=Math.max(-1,Math.min(1,u));(c<-.5||c>1)&&i.opt(g.Host.logging,(function(e){return e.warning("Padding must be between 0 and 1.")}));var I=Math.max(-.5,Math.min(1,c));null==h&&d!=a.LockupBacking.SVGBackground||null!=h&&d==a.LockupBacking.SVGBackground||(l.CoreAssertDebugOnly.isFalse(null==h&&d==a.LockupBacking.SVGBackground,"nil backingArtworkID but backing is SVGBackground",void 0,"LockupStyle.init","LockupStyle.swift",293),i.opt(g.Host.logging,(function(e){return e.warning("error backingArtwordID / SVGBackground")}))),y.LegacyCoreAssert.isFalse(m==a.LockupLayout.SKIP||m==a.LockupLayout.LegacyLeft||m==a.LockupLayout.LegacyCenter||m==a.LockupLayout.LegacyRight,"Unexpected LockupLayout value: "+m,void 0,"LockupStyle.init","LockupStyle.swift",297),y.LegacyCoreAssert.isFalse(_==a.LockupAlignment.SKIP,"Unexpected LockupAlignment",{alignment:_},"LockupStyle.init","LockupStyle.swift",299),r.isPath(m)?(P==A.TextPathID.Custom&&null==S||P!=A.TextPathID.Custom&&null!=S)&&i.opt(g.Host.logging,(function(e){return e.warning("pathID/customPath mismatch")})):P==A.TextPathID.UNSET&&null==S||i.opt(g.Host.logging,(function(e){return e.warning("Why are we providing a path or path id with a non-path layout?")}));var b={fonts:[o],spacing:s,tracking:F,padding:I,backing:d,shadowAngle:p,shadowOffset:C,strokeWeight:v,layout:m,alignment:_,verticalAlignment:R,"text-opacity":e,"backing-opacity":t,knockout:T,pathID:P,"wheel-used":D,relativeFontScale:E};null!=h&&(b[r.PROPERTY_BACKING_ARTWORK_ID]=h),null!=S&&(b[r.PROPERTY_CUSTOM_PATH]=S),i.super_init(this,f.FormaStyle,f.FormaStyle.prototype.init_5afe,r.KIND,1,n,null,null,b)},isEqualTo:function(e){var t;if(t=e){if(i.count(this.characterStyles)!=i.count(t.characterStyles))return!1;for(var n=i.iter(this.characterStyles);!n.done;n.next()){var r=n.key,o=n.value;if(null==t.characterStyles[r])return!1;if(!o.isEqualTo(t.characterStyles[r]))return!1}return this.textOpacity==t.textOpacity&&this.backingOpacity==t.backingOpacity&&i.eq(P._equality_TheoFont_TheoFont,this.font,t.font)&&this.spacing==t.spacing&&this.tracking==t.tracking&&this.padding==t.padding&&this.backing==t.backing&&this.shadowAngle==t.shadowAngle&&this.layout==t.layout&&this.alignment==t.alignment&&this.textLook==t.textLook&&this.shadowOffset==t.shadowOffset&&this.strokeWeight==t.strokeWeight&&this.wheelUsed==t.wheelUsed&&this.pathID==t.pathID&&this.customPath==t.customPath&&this.backingArtworkID==t.backingArtworkID&&this.relativeFontScale==t.relativeFontScale&&this.verticalAlignment==t.verticalAlignment&&this.lineBreakAtCharacterStyleSizeChange==t.lineBreakAtCharacterStyleSizeChange}return!1},className:{get:function(){return r.SCHEMA_CLASS_NAME}},willChangeState:function(e){var t;if(f.FormaStyle.prototype.willChangeState.call(this,e),i.keys(e).includes(r.PROPERTY_CHARSTYLES)&&(t=this.cachedCharacterStyles_)){for(var n=i.iter(t);!n.done;n.next())n.value.colorLibrary=null;this.cachedCharacterStyles_=null}},didChangeState:function(e){f.FormaStyle.prototype.didChangeState.call(this,e),i.keys(e).includes(r.PROPERTY_CHARSTYLES)&&i.clone(this.characterStyles)},fixLegacyProperties:function(){var e,t,n,o=i.opt(this.getProperty(f.FormaStyle.PROPERTY_OPACITY),(function(e){return e.doubleValue})),l=null==o?1:o,u=i.opt(this.getProperty(r.PROPERTY_TEXT_OPACITY),(function(e){return e.doubleValue})),c=i.opt(this.getProperty(r.PROPERTY_BACKING_OPACITY),(function(e){return e.doubleValue}));if(null!=u?y.LegacyCoreAssert.isTrue(1==l,"for legacy ",void 0,"LockupStyle.fixLegacyProperties","LockupStyle.swift",472):null!=o&&(this.textOpacity=l),this.set(f.FormaStyle.PROPERTY_OPACITY,1),this.backing==a.LockupBacking.None&&1!=this.backingOpacity&&1==this.textOpacity&&(this.textOpacity=this.backingOpacity),null==u&&this.textOpacity!=f.FormaStyle.OPACITY_UNSET&&o==c&&(this.backingOpacity=l),this.backing==a.LockupBacking.LegacyShadow&&(this.backing=a.LockupBacking.None,this.textLook=a.LockupTextLook.Shadow,this.shadowOffset=this.padding+.48,this.shadowOffset>1&&(this.shadowOffset=1)),(e=i.opt(this.getProperty(f.FormaStyle.PROPERTY_COLORS_DEPRECATED),(function(e){return e.arrayValue})))&&(e.length>=1&&(this.colors.fieldPrimary=i.as(s.Codecs.solidColorCodec.decode(e[0],this),T.SolidColor)),e.length>=2&&(this.colors.fieldSecondary=i.as(s.Codecs.solidColorCodec.decode(e[1],this),T.SolidColor))),null!=(t=i.opt(this.getProperty(r.PROPERTY_LAYOUT),(function(e){return e.intValue})))&&null!=(n=a.LockupLayout.toCaseValue(t)))switch(n){case 3:this.set(r.PROPERTY_LAYOUT,a.LockupLayout.Standard),this.set(r.PROPERTY_ALIGNMENT,a.LockupAlignment.Center);break;case 1:this.set(r.PROPERTY_LAYOUT,a.LockupLayout.Standard),this.set(r.PROPERTY_ALIGNMENT,a.LockupAlignment.Left);break;case 2:this.set(r.PROPERTY_LAYOUT,a.LockupLayout.Standard),this.set(r.PROPERTY_ALIGNMENT,a.LockupAlignment.Right)}},setEmptyStyle:function(){this.font=null,this.spacing=-1,this.tracking=r.UNSET_TRACKING,this.relativeFontScale=r.UNSET_RELATIVE_FONT_SCALE,this.padding=0,this.backing=a.LockupBacking.None,this.backingArtworkID=null,this.shadowAngle=-1,this.layout=a.LockupLayout.UNSET,this.textOpacity=f.FormaStyle.OPACITY_UNSET,this.backingOpacity=f.FormaStyle.OPACITY_UNSET,this.textLook=a.LockupTextLook.UNSET,this.shadowOffset=-1,this.strokeWeight=-1;for(var e=[r.PROPERTY_SPACING,r.PROPERTY_TRACKING,r.PROPERTY_SHADOW_ANGLE,r.PROPERTY_SHADOW_OFFSET,r.PROPERTY_LAYOUT,r.PROPERTY_TEXT_OPACITY,r.PROPERTY_BACKING_OPACITY,r.PROPERTY_KNOCKOUT,r.PROPERTY_STROKE_WEIGHT,r.PROPERTY_RELATIVE_FONT_SCALE],t=i.iter(e);!t.done;t.next()){var n=t.value;i.opt(this.state.getProperty(n),(function(e){return e.shouldWrite=!1}))}},needsLayout:function(e){var t=!1;return t=i.opt(i.opt(this.owner,(function(e){return e.page.document})),(function(e){return e.documentName}))==v.TheoDocument.PREVIEW_FONT_DOC_NAME?e.postscriptNameProperty!=this.postscriptNameProperty:!i.eq(P._equality_TheoFont_TheoFont,e.font,this.font),e.backing!=this.backing||t||e.layout!=this.layout||e.alignment!=this.alignment||e.verticalAlignment!=this.verticalAlignment||e.pathID!=this.pathID||e.customPath!=this.customPath||e.padding!=this.padding||e.spacing!=this.spacing||e.tracking!=this.tracking||e.textLook!=this.textLook||e.strokeWeight!=this.strokeWeight||e.shadowOffset!=this.shadowOffset||e.lineBreakAtCharacterStyleSizeChange!=this.lineBreakAtCharacterStyleSizeChange||e.relativeFontScale!=this.relativeFontScale},sameColors:function(e){if(!(i.eq(T._equality_SolidColor_SolidColor,e.colors.fieldPrimary,this.colors.fieldPrimary)&&i.eq(T._equality_SolidColor_SolidColor,e.colors.fieldSecondary,this.colors.fieldSecondary)&&i.eq(T._equality_SolidColor_SolidColor,e.colors.border,this.colors.border)&&i.eq(T._equality_SolidColor_SolidColor,e.colors.shadow,this.colors.shadow)))return!1;for(var t=i.iter(this.characterStyles);!t.done;t.next()){var n,r=t.key,o=t.value;if(!(n=e.characterStyles[r]))return!1;if(!(i.eq(T._equality_SolidColor_SolidColor,n.colors.fieldPrimary,o.colors.fieldPrimary)&&i.eq(T._equality_SolidColor_SolidColor,n.colors.fieldSecondary,o.colors.fieldSecondary)&&i.eq(T._equality_SolidColor_SolidColor,n.colors.border,o.colors.border)&&i.eq(T._equality_SolidColor_SolidColor,n.colors.shadow,o.colors.shadow)))return!1}return!0},colorLibrary:{get:function(){return f.FormaStyle._getters.colorLibrary.call(this)},set:function(e){f.FormaStyle._setters.colorLibrary.call(this,e);for(var t=i.iter(this.characterStyles);!t.done;t.next())t.value.colorLibrary=e}},ensureCachedCharacterStyles:function(){var e;if(null==this.cachedCharacterStyles_&&(this.cachedCharacterStyles_={},e=i.opt(this.getProperty(r.PROPERTY_CHARSTYLES),(function(e){return e.dictionaryValue}))))for(var t=i.iter(e);!t.done;t.next()){var n,o=t.key,a=t.value;(n=i.as(r.characterStyleCodec.decode(a,this),r))&&(n.colorLibrary=this.colorLibrary,this.cachedCharacterStyles_[o]=n)}},characterStyles:{get:function(){return this.ensureCachedCharacterStyles(),this.cachedCharacterStyles_}},setCharacterStyles:function(e){var t;if(t=this.cachedCharacterStyles_)for(var n=i.iter(t);!n.done;n.next())(s=n.value).colorLibrary=null;this.cachedCharacterStyles_=i.clone(e);for(var o={},a=i.iter(e);!a.done;a.next()){var s,l=a.key;(s=a.value).colorLibrary=this.colorLibrary,o[l]=r.characterStyleCodec.encode(d.DBNamePath.init_b14a(r.PROPERTY_CHARSTYLES).append(l),s,this)}this.setProperty(r.PROPERTY_CHARSTYLES,d.DBProperty.dictProperty(d.DBNamePath.init_b14a(r.PROPERTY_CHARSTYLES),o))},setCharacterStyle:function(e,t){this.ensureCachedCharacterStyles(),this.cachedCharacterStyles_[e]=t,t.colorLibrary=this.colorLibrary;for(var n={},o=i.iter(this.cachedCharacterStyles_);!o.done;o.next()){var a=o.key;t=o.value,n[a]=r.characterStyleCodec.encode(d.DBNamePath.init_b14a(r.PROPERTY_CHARSTYLES).append(a),t,this)}this.setProperty(r.PROPERTY_CHARSTYLES,d.DBProperty.dictProperty(d.DBNamePath.init_b14a(r.PROPERTY_CHARSTYLES),n))},spacing:{get:function(){var e;return(e=i.as(this.get(r.PROPERTY_SPACING),"Double"))||null!=e?e:r.DEFAULT_SPACING},set:function(e){this.notifyBefore(),this.set(r.PROPERTY_SPACING,e),this.notifyAfter()}},tracking:{get:function(){var e;return(e=i.as(this.get(r.PROPERTY_TRACKING),"Double"))||null!=e?e:r.UNSET_TRACKING},set:function(e){this.notifyBefore(),this.set(r.PROPERTY_TRACKING,e),this.notifyAfter()}},relativeFontScale:{get:function(){var e;return(e=i.as(this.get(r.PROPERTY_RELATIVE_FONT_SCALE),"Double"))||null!=e?e:r.UNSET_RELATIVE_FONT_SCALE},set:function(e){this.notifyBefore(),this.set(r.PROPERTY_RELATIVE_FONT_SCALE,e),this.notifyAfter()}},textLook:{get:function(){var e,t;return(e=a.LockupTextLook.toCaseValue((t=i.as(this.get(r.PROPERTY_KNOCKOUT),"Int"))||null!=t?t:a.LockupTextLook.Fill))||null!=e?e:a.LockupTextLook.Fill},set:function(e){this.notifyBefore(),this.set(r.PROPERTY_KNOCKOUT,e),this.notifyAfter()}},padding:{get:function(){var e;return(e=i.as(this.get(r.PROPERTY_PADDING),"Double"))||null!=e?e:r.DEFAULT_PADDING},set:function(e){this.notifyBefore(),this.set(r.PROPERTY_PADDING,e),this.notifyAfter()}},backing:{get:function(){var e,t;return(e=a.LockupBacking.toCaseValue((t=i.as(this.get(r.PROPERTY_BACKING),"Int"))||null!=t?t:a.LockupBacking.None))||null!=e?e:a.LockupBacking.Box},set:function(e){this.notifyBefore(),this.set(r.PROPERTY_BACKING,e),this.notifyAfter()}},opacity:{get:function(){return 1},set:function(e){y.LegacyCoreAssert.fail("opacity being set. use controller's applyOpacity instead",void 0,"LockupStyle","LockupStyle.swift",751)}},textOpacity:{get:function(){var e;return(e=i.as(this.get(r.PROPERTY_TEXT_OPACITY),"Double"))||null!=e?e:f.FormaStyle.OPACITY_UNSET},set:function(e){this.notifyBefore(),this.set(r.PROPERTY_TEXT_OPACITY,e),this.notifyAfter()}},backingOpacity:{get:function(){var e;return(e=i.as(this.get(r.PROPERTY_BACKING_OPACITY),"Double"))||null!=e?e:f.FormaStyle.OPACITY_UNSET},set:function(e){this.notifyBefore(),this.set(r.PROPERTY_BACKING_OPACITY,e),this.notifyAfter()}},layout:{get:function(){var e,t;return(e=a.LockupLayout.toCaseValue((t=i.as(this.get(r.PROPERTY_LAYOUT),"Int"))||null!=t?t:a.LockupLayout.UNSET))||null!=e?e:a.LockupLayout.FitJustified},set:function(e){y.LegacyCoreAssert.isFalse(e==a.LockupLayout.SKIP||e==a.LockupLayout.LegacyLeft||e==a.LockupLayout.LegacyCenter||e==a.LockupLayout.LegacyRight,"Unexpected LockupLayout value: "+e,void 0,"LockupStyle","LockupStyle.swift",776),this.notifyBefore(),this.set(r.PROPERTY_LAYOUT,e),this.notifyAfter()}},alignment:{get:function(){var e,t;return(e=a.LockupAlignment.toCaseValue((t=i.as(this.get(r.PROPERTY_ALIGNMENT),"Int"))||null!=t?t:a.LockupAlignment.UNSET))||null!=e?e:a.LockupAlignment.UNSET},set:function(e){y.LegacyCoreAssert.isFalse(e==a.LockupAlignment.SKIP,"LockupAlignment.SKIP is not a settable value",void 0,"LockupStyle","LockupStyle.swift",790),this.notifyBefore(),this.set(r.PROPERTY_ALIGNMENT,e),this.notifyAfter()}},verticalAlignment:{get:function(){var e,t;return(e=a.VerticalLockupAlignment.toCaseValue((t=i.as(this.get(r.PROPERTY_VERTICAL_ALIGNMENT),"Int"))||null!=t?t:a.VerticalLockupAlignment.UNSET))||null!=e?e:a.VerticalLockupAlignment.UNSET},set:function(e){this.notifyBefore(),this.set(r.PROPERTY_VERTICAL_ALIGNMENT,e),this.notifyAfter()}},pathID:{get:function(){var e,t;return(e=A.TextPathID.toCaseValue((t=i.as(this.get(r.PROPERTY_PATH_ID),"Int"))||null!=t?t:A.TextPathID.UNSET))||null!=e?e:A.TextPathID.UNSET},set:function(e){this.notifyBefore(),this.set(r.PROPERTY_PATH_ID,e),this.notifyAfter()}},customPath:{get:function(){return i.as(this.get(r.PROPERTY_CUSTOM_PATH),S.TextPath)},set:function(e){this.notifyBefore(),this.set(r.PROPERTY_CUSTOM_PATH,e),this.notifyAfter()}},backingArtworkID:{get:function(){return i.as(this.get(r.PROPERTY_BACKING_ARTWORK_ID),"String")},set:function(e){this.notifyBefore(),this.set(r.PROPERTY_BACKING_ARTWORK_ID,e),this.notifyAfter()}},shadowAngle:{get:function(){var e;return(e=i.as(this.get(r.PROPERTY_SHADOW_ANGLE),"Double"))||null!=e?e:r.UNSET_SHADOW_ANGLE},set:function(e){this.notifyBefore(),this.set(r.PROPERTY_SHADOW_ANGLE,e),this.notifyAfter()}},shadowOffset:{get:function(){var e;return(e=i.as(this.get(r.PROPERTY_SHADOW_OFFSET),"Double"))||null!=e?e:r.DEFAULT_SHADOWOFFSET},set:function(e){this.notifyBefore(),this.set(r.PROPERTY_SHADOW_OFFSET,e),this.notifyAfter()}},defaultStrokeWeight:{get:function(){return this.textLook==a.LockupTextLook.KnockoutAndOutline?0:r.DEFAULT_STROKEWEIGHT}},strokeWeight:{get:function(){var e;return(e=i.as(this.get(r.PROPERTY_STROKE_WEIGHT),"Double"))||null!=e?e:this.defaultStrokeWeight},set:function(e){this.notifyBefore(),this.set(r.PROPERTY_STROKE_WEIGHT,e),this.notifyAfter()}},wheelUsed:{get:function(){var e;return(e=i.as(this.get(r.PROPERTY_WHEELUSED),"Bool"))||null!=e?e:r.DEFAULT_WHEELUSED},set:function(e){this.set(r.PROPERTY_WHEELUSED,e)}},font:{get:function(){var e,t=null;return(e=i.as(this.get(r.PROPERTY_FONTS),["Array",P.TheoFont]))&&(y.LegacyCoreAssert.isTrue(e.length<=1,"should only have 1 or 0 fonts",void 0,"LockupStyle","LockupStyle.swift",871),e.forEach((function(e){t=e}))),t},set:function(e){this.notifyBefore(),null!=e?this.set(r.PROPERTY_FONTS,[e]):this.set(r.PROPERTY_FONTS,null),this.notifyAfter()}},lineBreakAtCharacterStyleSizeChange:{get:function(){var e;return!(e=i.as(this.get(r.PROPERTY_LINEBREAK),"Bool"))&&null==e||e},set:function(e){this.set(r.PROPERTY_LINEBREAK,e)}},setBacking:function(e,t){this.notifyBefore(),this.set(r.PROPERTY_BACKING,e),this.set(r.PROPERTY_BACKING_ARTWORK_ID,t),this.notifyAfter()},colorTableSupportsRole:function(e){return e==u.ColorRole.FieldPrimary||e==u.ColorRole.FieldSecondary||e==u.ColorRole.Border||e==u.ColorRole.Shadow},layoutType:{get:function(){if(this.layout==a.LockupLayout.FitJustified)return"justified";if(this.layout==a.LockupLayout.Standard)switch(this.alignment){case 0:return"left";case 2:return"center";case 1:return"right";default:return"error"}return this.layout==a.LockupLayout.Path?"path":this.layout==a.LockupLayout.LetterGrid?"letter-grid":"error"}},backingShapeID:{get:function(){return this.backing==a.LockupBacking.None?"none":this.backing==a.LockupBacking.Rows?"rows":this.backing==a.LockupBacking.BannerHorizontal||this.backing==a.LockupBacking.BannerVertical||this.backing==a.LockupBacking.Banner?"banner":this.backing==a.LockupBacking.SVGBackground?null!=this.backingArtworkID?this.backingArtworkID:"error":this.backing==a.LockupBacking.Knockout?"knockout":"error"}},textLookAsString:{get:function(){var e;switch(this.textLook){case 1:e="knockoutOnly";break;case 2:e="knockoutAndOutline";break;case 3:e="outlineOnly";break;case 4:e="fillAndOutline";break;case 5:e="fillAndOutline2";break;case 7:e="shadow";break;case 8:e="shadowAndOutline";break;case 9:e="knockoutAndShadow";break;case 11:e="knockoutShadowOutline";break;case 10:e="shadowOutlineTransparentText";break;case 0:e="fill";break;case-1:e="unset";break;case-2:e="skip";break;default:e="unknown value"}return e}},currentTextOpacity:{get:function(){return this.textOpacity!=f.FormaStyle.OPACITY_UNSET?this.textOpacity:f.FormaStyle.OPACITY_DEFAULT}},currentBackingOpacity:{get:function(){return this.backingOpacity!=f.FormaStyle.OPACITY_UNSET?this.backingOpacity:f.FormaStyle.OPACITY_DEFAULT}},textBacked:{get:function(){if(this.backing==a.LockupBacking.Box||this.backing==a.LockupBacking.Rows||this.backing==a.LockupBacking.BannerVertical||this.backing==a.LockupBacking.BannerHorizontal||this.textLook==a.LockupTextLook.ShadowAndOutline&&this.strokeWeight>.15)return!0;if(this.backing==a.LockupBacking.SVGBackground){if(null!=this.backingArtworkID&&C.ShapeLibrary.FilledBackingShapes.includes(this.backingArtworkID))return!0;l.CoreAssertDebugOnly.isTrue(null!=this.backingArtworkID,"textBacked has nil backingArtworkID but backing is SVGBackground",void 0,"LockupStyle","LockupStyle.swift",998)}return!1}},shapeSupportsKnockout:{get:function(){if(this.backing==a.LockupBacking.Box||this.backing==a.LockupBacking.Rows||this.backing==a.LockupBacking.BannerVertical||this.backing==a.LockupBacking.BannerHorizontal||this.backing==a.LockupBacking.Knockout)return!0;if(this.backing==a.LockupBacking.SVGBackground){if(null!=this.backingArtworkID&&C.ShapeLibrary.FilledBackingShapes.includes(this.backingArtworkID))return!0;l.CoreAssertDebugOnly.isTrue(null!=this.backingArtworkID,"shapeSupportsKnockout has nil backingArtworkID but backing is SVGBackground",void 0,"LockupStyle","LockupStyle.swift",1016)}return!1}},secondaryColorVisible:{get:function(){return this.backing!=a.LockupBacking.None||r.isOutlineLook(this.textLook)||this.textLook==a.LockupTextLook.Shadow}},postscriptNameProperty:{get:function(){var e,t,n=this.getProperty(r.PROPERTY_FONTS);return(e=i.opt(n,(function(e){return e.arrayValue})))&&null!=(t=i.opt(i.opt(e[0].dictionaryValue,(function(e){return e[p.FontDescriptor.PROPERTY_POSTSCRIPT_NAME]})),(function(e){return e.stringValue})))?t:""}},asString:{get:function(){var e="";return null!=this.font&&(e+="Font: "+this.font.fontData.postScriptName+"\n"),(e+=this.colors.asString)+" Spacing "+this.spacing+" \n Backing  "+this.backing+" \n Layout  "+this.layout+" "}},isEqual:function(e){return!1},getCompressedStringOfFeatures:function(){var e=i.clone(this.state.allProperties);return this.compressDictToString(e,"{")},compressDictToString:function(e,t){for(var n=t,o=[f.FormaStyle.PROPERTY_ADJUSTMENTS,f.FormaStyle.PROPERTY_KIND],a=[r.PROPERTY_FONTS,f.FormaStyle.PROPERTY_COLORS],s=i.iter(i.keys(e));!s.done;s.next()){var l=s.value;if(!o.includes(l)){var u,c=this.getSmallKey(l);if(a.includes(l))n=this.handleSpecialCases(e,l,c,n);else if(u=i.opt(e[l],(function(e){return e.dictionaryValue})))n+=c+"{|",n=this.compressDictToString(u,n);else{if(i.opt(e[l],(function(e){return e.arrayValue})))continue;var d;if(null!=(d=i.opt(e[l],(function(e){return e.doubleValue})))){var h=_.MathUtils.roundDoubleToString(d,4);n+=c+":"+i.toString(h)+"|"}else null!=(h=i.opt(e[l],(function(e){return e.stringValue})))&&(n+=c+":"+h+"|")}}}return n+="}"},handleSpecialCases:function(e,t,n,o){var a,s,l=o;return t==r.PROPERTY_FONTS&&(a=i.as(this.get(r.PROPERTY_FONTS),["Array",P.TheoFont]))&&(l=this.compressFonts(a,n,l)),t==f.FormaStyle.PROPERTY_COLORS&&(s=i.as(this.get(f.FormaStyle.PROPERTY_COLORS),u.ColorTable))&&(l=this.compressColorTable(s,n,l)),l},getSmallKey:function(e){var t=e.length;return t>4?e.substr(0,2)+e.substr(t-2,2):e},compressFonts:function(e,t,n){for(var r=n+t+":",o=i.iter(i.range(0,e.length,!1));!o.done;o.next()){var a=o.value,s=e[a].fontData.postScriptName;a<e.length-1?r+=s+",":r+=s+"|"}return r},compressColorTable:function(e,t,n){var r=this,o=n+t+":",a=!1;return e.forEachColor((function(e,t,n){var s;if(s=n||i.opt(r.colorLibrary.color(t),(function(e){return e.rgbColor}))){var l="";e==u.ColorRole.FieldPrimary?l="prim":e==u.ColorRole.FieldSecondary?l="seco":e==u.ColorRole.Border?l="bord":e==u.ColorRole.Shadow&&(l="shad"),a&&(o+=","),o+=l+"#"+s.rgbHex,a=!0}})),a&&(o+="|"),o}}}),r)},c2hD:function(e,t,n){var r,o=t,a=n("oAGj"),i=n("URxh"),s=n("tGKA"),l=n("K17h"),u=n("oKlP"),c=n("RkYL"),d=n("xm77");o.MotionSourceFadeInH=(r=function(){},a.defineClass({name:"MotionSourceFadeInH",ctor:r,statics:{getSrcKeyframes:function(e){var t=[],n=c.TheoTime.Zero,r=c.TheoTime.fromSeconds(1),o=s.Matrix2D.translation(new u.TheoPoint(400,0)),a=s.Matrix2D.Identity,h=l.MotionUtils.createOpacityStyle(e,0),p=e.style.clone();return t.push(new i.KeyFrame(n,d.TimingFunctionType.EaseInOut,o,null,h)),t.push(new i.KeyFrame(r,d.TimingFunctionType.EaseInOut,a,null,p)),t}}}),r)},c3Vl:function(e,t,n){var r,o=t,a=n("oAGj"),i=n("ascj"),s=n("Z25M"),l=n("6ZWm"),u=n("wc1n"),c=n("9Lk3"),d=n("fdtz"),h=n("c+uM"),p=n("K0Rh"),f=n("djAF"),m=n("8t9B");o.DesignStyleFeatureExtractor=(r=function(e,t){void 0===t&&(t=[]),this.root_=e,this.forFeatures_=a.clone(t),this.featureEvals_=[],u.FeatureExtractor.call(this),this.initFeatures(),this.evaluateFeatures()},a.defineClass({name:"DesignStyleFeatureExtractor",ctor:r,superName:"FeatureExtractor",statics:{_implements:function(e){return"FeatureExtractorProtocol"==e}},props:{initFeatures:function(){this.featureEvals_=[["TextSymmetryX",[this.evaluateTextXSymmetry,u.FeatureType.Numerical]],["TextSymmetryY",[this.evaluateTextYSymmetry,u.FeatureType.Numerical]],["Whitespace",[this.evaluateWhiteSpace,u.FeatureType.Numerical]],["DesignAngle",[this.evaluateDesignAngle,u.FeatureType.Numerical]],["TextDesignCoverage",[this.evaluateTextDesignCoverage,u.FeatureType.Numerical]],["ImageDesignCoverage",[this.evaluateImageDesignCoverage,u.FeatureType.Numerical]],["ShapeDesignCoverage",[this.evaluateShapeDesignCoverage,u.FeatureType.Numerical]],["TextCount",[this.evaluateTextCount,u.FeatureType.Numerical]],["ImageCount",[this.evaluateImageCount,u.FeatureType.Numerical]],["ShapeCount",[this.evaluateShapeCount,u.FeatureType.Numerical]],["LogoCount",[this.evaluateLogoCount,u.FeatureType.Numerical]],["SalientCoverage",[this.evaluateSalientCoverage,u.FeatureType.Numerical]],["MarginSpace",[this.evaluateMarginSpace,u.FeatureType.Numerical]],["TextFonts",[this.evaluateFonts,u.FeatureType.Complex]],["TextShapes",[this.evaluateTextShapes,u.FeatureType.Complex]],["DesignColors",[this.evaluateColors,u.FeatureType.Complex]],["BackgroundTypes",[this.evaluateBackgroundTypes,u.FeatureType.Complex]],["GridCount",[this.evaluateGridCount,u.FeatureType.Numerical]],["PageHeight",[this.evaluatePageHeight,u.FeatureType.Numerical]],["PageWidth",[this.evaluatePageWidth,u.FeatureType.Numerical]],["BackgroundImageCount",[this.evaluateBackgroundImageCount,u.FeatureType.Numerical]],["ForegroundImageCount",[this.evaluateForegroundImageCount,u.FeatureType.Numerical]],["VisualGroupInfo",[this.evaluateVisualGroupInfo,u.FeatureType.Numerical]]]},evaluateFeatures:function(){for(var e=0==this.forFeatures_.length,t=a.iter(this.featureEvals_);!t.done;t.next()){var n=t.value;if(e||!e&&this.forFeatures_.includes(n[0])){var r=n[1],o=(0,r[0])(this);this.setFeature(n[0],o,r[1])}}},evaluateTextXSymmetry:function(e){var t=a.clone(e.root_.filterByControllerKind(m.TypeLockupController.KIND));return s.DesignFeatureUtils.getSymmAsymmForForma(t,!0)},evaluateTextYSymmetry:function(e){var t=a.clone(e.root_.filterByControllerKind(m.TypeLockupController.KIND));return s.DesignFeatureUtils.getSymmAsymmForForma(t,!1)},evaluateWhiteSpace:function(e){return s.DesignFeatureUtils.evaluateRootEmptySpace(e.root_)},evaluateDesignAngle:function(e){return e.root_.page.pageSize.angle},evaluateTextDesignCoverage:function(e){return s.DesignFeatureUtils.sumAreaOfForma(e.root_.filterByControllerKind(m.TypeLockupController.KIND),e.root_)},evaluateImageDesignCoverage:function(e){return s.DesignFeatureUtils.sumAreaOfForma(e.root_.filterByControllerKind(l.FrameController.KIND),e.root_)},evaluateShapeDesignCoverage:function(e){var t=a.clone(e.root_.filterWithCallback((function(e){return e instanceof f.ShapeForma&&null!=e.controller&&e.controller.floating})));return s.DesignFeatureUtils.sumAreaOfForma(t,e.root_)},evaluateTextCount:function(e){return s.DesignFeatureUtils.getTextCount(e.root_)},evaluateImageCount:function(e){return s.DesignFeatureUtils.getImageCount(e.root_)},evaluateShapeCount:function(e){return s.DesignFeatureUtils.getShapeCount(e.root_)},evaluateLogoCount:function(e){var t=a.clone(e.root_.filterWithCallback((function(e){return null!=e.controller&&e.isLogo()})));return a.toDouble(t.length)},evaluateSalientCoverage:function(e){for(var t=a.clone(e.root_.filterByControllerKind(l.FrameController.KIND)),n=0,r=a.iter(t);!r.done;r.next()){var o,i,s,u=r.value;(o=e.root_.finalFrame)&&(i=a.opt(a.as(u,d.ImageForma),(function(e){return e.getFocusRegion()})))&&(s=i.intersectionWith(o))&&(n+=s.area/o.area)}return Math.max(n,1)},evaluateMarginSpace:function(e){var t,n=0,r=a.clone(e.root_.filterByControllerKind(c.GridController.KIND));return r.length>0&&(t=a.as(r[0].controller,c.GridController))&&(n=t.margin),n},evaluateVisualGroupInfo:function(e){return a.toDouble(0)},evaluateFonts:function(e){for(var t=[],n=a.iter(s.DesignFeatureUtils.getLockupsInDesign(e.root_));!n.done;n.next()){var r,o,i=n.value;(r=a.as(i.style,h.LockupStyle))&&(o=r.font)&&t.push(o.fontData.postScriptName)}return t},evaluateTextShapes:function(e){for(var t=[],n=a.iter(s.DesignFeatureUtils.getLockupsInDesign(e.root_));!n.done;n.next()){var r,o=n.value;(r=a.as(o.style,h.LockupStyle))&&t.push(r.backingShapeID)}return t},evaluateColors:function(e){for(var t=[],n=a.clone(e.root_.filterWithCallback((function(e){return e instanceof d.ImageForma}))),r=a.iter(n);!r.done;r.next()){var o,i,l=r.value;(o=a.as(l,d.ImageForma))&&(i=a.opt(o.contentNode,(function(e){return e.image})))&&a.append(t,i.getImageColors(5))}for(var u=a.iter(s.DesignFeatureUtils.getLockupsInDesign(e.root_));!u.done;u.next()){var c,p,f,m,g=u.value;(c=a.as(g.style,h.LockupStyle))&&((f=e.primaryColorForStyle(c))&&t.push(f),(m=e.secondaryColorForStyle(c))&&t.push(m),(p=c.characterStyles.Highlight)&&((f=e.primaryColorForStyle(p))&&t.push(f),(m=e.secondaryColorForStyle(p))&&t.push(m)))}return t.map((function(e){return e.hex}),this)},primaryColorForStyle:function(e){return e.colors.color(i.ColorRole.FieldPrimary)},secondaryColorForStyle:function(e){return e.backing!=h.LockupBacking.None&&e.backing!=h.LockupBacking.UNSET?e.colors.color(i.ColorRole.FieldSecondary):null},evaluateBackgroundTypes:function(e){for(var t=[],n=a.clone(e.root_.filterWithCallback((function(e){return(e.isBackgroundImage()||e.kind==f.ShapeForma.KIND||e.kind==p.RootForma.KIND)&&null!=e.controller&&!e.controller.moveable}))),r=a.iter(n);!r.done;r.next()){var o=r.value;o.isBackgroundImage()?t.push("image"):o.kind==f.ShapeForma.KIND?t.push("shape"):t.push("root")}return t},evaluatePageWidth:function(e){return s.DesignFeatureUtils.getPageWidth(e.root_)},evaluatePageHeight:function(e){return s.DesignFeatureUtils.getPageHeight(e.root_)},evaluateGridCount:function(e){return a.toDouble(e.root_.filterWithCallback((function(e){return null!=e.controller&&e.controller.kind==c.GridController.KIND&&e.isGridCell()})).length)},evaluateBackgroundImageCount:function(e){return a.toDouble(e.root_.filterWithCallback((function(e){return null!=e.controller&&e.controller.kind==l.FrameController.KIND&&e.isGridCell()})).length)},evaluateForegroundImageCount:function(e){return a.toDouble(e.root_.filterWithCallback((function(e){return null!=e.controller&&e.controller.kind==l.FrameController.KIND&&!e.isGridCell()})).length)}}}),r)},cYKp:function(e,t,n){var r,o=t,a=n("oAGj"),i=n("gXiO");o.AnimationFacade=(r=function(){i.CoreObject.call(this)},a.defineClass({name:"AnimationFacade",ctor:r,superName:"CoreObject",statics:{applyAnimationStyle:function(e,t){t.animationLibrary.modifyModelForAnimation(e,t.root)},shuffleAnimationStyle:function(e,t){return t.animationLibrary.getNextAnimationStyleOfSameType(e)}}}),r)},cZuM:function(e,t,n){var r,o,a,i,s,l,u=t,c=n("oAGj"),d=n("gXiO"),h=n("FNB+"),p=n("fdtz"),f=n("lmwz"),m=n("fNpk"),g=n("c+uM"),y=n("tGKA"),_=n("Zifs"),T=n("T6jX"),C=n("MnRR"),v=n("8t9B"),P=n("oKlP");u.AlignmentEdges=c.defineEnum("AlignmentEdges",{None:0,Left:1,Right:2,LeftAndRight:3,Top:4,Bottom:8,CenterX:16,CenterY:32,TopAndBottom:12,LeftAndTopAndBottom:13,Outer:15,All:63}),u.describeAlignmentType=function(e){switch(e){case 0:return"Left";case 1:return"CenterX";case 2:return"Right";case 3:return"Top";case 4:return"CenterY";case 5:return"Bottom";case 6:return"Rotation";case 7:return"None"}},u.AlignmentType=c.defineEnum("AlignmentType",{Left:0,CenterX:1,Right:2,Top:3,CenterY:4,Bottom:5,Rotation:6,None:7}),u.AlignmentLocation=c.defineEnum("AlignmentLocation",{Forma:0,Root:1}),u.LineStyle=c.defineEnum("LineStyle",{Dashed:0,Solid:1}),u.AlignmentLine=(r=function(e,t,n,r,o,a,i){void 0===i&&(i=u.LineStyle.Dashed),this.type=e,this.location=t,this.color=n,this.line=r,this.text=o,this.lineStyle=i,this.coordinateSpace=a},c.defineClass({name:"AlignmentLine",ctor:r,superName:"CoreObject",statics:{DASH_WIDTH:4,DASH_GAP_WIDTH:4,LINE_EXTENSION:24,ROTATION_LINE_EXTENSION:40,LINE_WEIGHT:1}}),r),u.FormaAlignment=(o=function(e,t,n){this.forma=e,this.offset=t,this.line=n},c.defineClass({name:"FormaAlignment",ctor:o,props:{clone:function(){return new o(this.forma,this.offset,this.line)}}}),o),u.FormaAlignmentLines=(a=function(){},c.defineClass({name:"FormaAlignmentLines",ctor:a,props:{init_a036:function(e,t){this.forma=e,this.lines=c.clone(t)},init_implicit:function(e,t){this.forma=e,this.lines=c.clone(t)},clone:function(){return a.init_implicit(this.forma,this.lines)}}}),a),u.FormaAlignmentSlope=(i=function(){},c.defineClass({name:"FormaAlignmentSlope",ctor:i,props:{init_c8bd:function(e,t,n){this.forma=e,this.rise=t,this.run=n},init_implicit:function(e,t,n){this.forma=e,this.rise=t,this.run=n},clone:function(){return i.init_implicit(this.forma,this.rise,this.run)}}}),i),u.AlignmentDetector=(s=function(){this.horizontalAlignments=[u.AlignmentType.CenterY,u.AlignmentType.Top,u.AlignmentType.Bottom],this.verticalAlignments=[u.AlignmentType.CenterX,u.AlignmentType.Left,u.AlignmentType.Right],this.boundaryAlignments=[u.AlignmentType.Left,u.AlignmentType.Right,u.AlignmentType.Top,u.AlignmentType.Bottom],this.otherFormae_=null},l={},c.defineClass({name:"AlignmentDetector",ctor:s,superName:"CoreObject",statics:{DISTANCE_THRESHOLD:20,SNAP_ANGLE_THRESHOLD:{get:function(){return void 0===l.SNAP_ANGLE_THRESHOLD&&(l.SNAP_ANGLE_THRESHOLD=Math.PI/64),l.SNAP_ANGLE_THRESHOLD}},ANGULAR_THRESHOLD:{get:function(){return void 0===l.ANGULAR_THRESHOLD&&(l.ANGULAR_THRESHOLD=2*Math.PI/180),l.ANGULAR_THRESHOLD}},ALIGNMENT_FORMA:{get:function(){return void 0===l.ALIGNMENT_FORMA&&(l.ALIGNMENT_FORMA=new _.SolidColor(0,1,1,1)),l.ALIGNMENT_FORMA}},ALIGNMENT_ROOT:{get:function(){return void 0===l.ALIGNMENT_ROOT&&(l.ALIGNMENT_ROOT=new _.SolidColor(1,0,1,1)),l.ALIGNMENT_ROOT}},ALIGNMENT_ROTATION:{get:function(){return void 0===l.ALIGNMENT_ROTATION&&(l.ALIGNMENT_ROTATION=new _.SolidColor(1,78/255,79/255,1)),l.ALIGNMENT_ROTATION}}},props:{init_a00d:function(e,t){void 0===t&&(t=null),this.forma_=e,this.possibleAlignmentLines_=[],this.possibleAngularAlignments_=[],this.otherFormae_=c.clone(t),d.CoreObject.call(this),this.update(!0)},init_f94b:function(e){this.init_a00d(c.first(e))},possibleAlignmentLines:{get:function(){return this.possibleAlignmentLines_}},isVerticalAlignment:function(e){return this.verticalAlignments.includes(e)},isHorizontalAlignment:function(e){return this.horizontalAlignments.includes(e)},isBoundaryAlignment:function(e){return this.boundaryAlignments.includes(e)},alignmentLineCompatible:function(e,t,n,r,o){if(void 0===o&&(o=!0),e.hasIntent(h.Forma.INTENT_GRID_CELL)&&e.finalFrame.contains(t.finalFrame))return!1;if(!o)for(var a=[e.controller,t.controller],i=c.iter(a);!i.done;i.next()){var l,d=i.value;if((l=c.as(d,v.TypeLockupController))&&(f=l.lockupStyle)&&l.numLines()>1){var p=d==e.controller?n.type:r.type;if(p==u.AlignmentType.Left&&g.LockupStyle.layoutSupportsAlignments(f.layout)&&f.alignment!=g.LockupAlignment.Left)return!1;if(p==u.AlignmentType.Right&&g.LockupStyle.layoutSupportsAlignments(f.layout)&&f.alignment!=g.LockupAlignment.Right)return!1;if(p==u.AlignmentType.CenterX&&g.LockupStyle.layoutSupportsAlignments(f.layout)&&f.alignment!=g.LockupAlignment.Center)return!1}}if(n.type==r.type)return!0;var f,m,y=this.isVerticalAlignment(n.type),T=this.isVerticalAlignment(r.type);if(o&&!c.eq(_._equality_SolidColor_SolidColor,n.color,s.ALIGNMENT_ROOT)&&!c.eq(_._equality_SolidColor_SolidColor,r.color,s.ALIGNMENT_ROOT)&&y==T&&this.isBoundaryAlignment(n.type)&&this.isBoundaryAlignment(r.type))return!0;if((f=c.as(t.style,g.LockupStyle))&&(m=c.as(e.style,g.LockupStyle))&&f.backing!=g.LockupBacking.None&&!g.LockupStyle.isShadowLook(f.textLook)&&m.backing!=g.LockupBacking.None&&!g.LockupStyle.isShadowLook(m.textLook)&&this.boundaryAlignments.includes(n.type)&&this.boundaryAlignments.includes(r.type))return!0;var C=this.horizontalAlignments.includes(n.type),P=this.horizontalAlignments.includes(r.type);return!!(C&&!P||!C&&P)},mergeLines:function(e,t){var n,r;m.LegacyCoreAssert.isTrue(c.eq(h._equality_Forma_Forma,e.coordinateSpace,t.coordinateSpace),"coordinate spaces of alignment lines to merge don't match",{first:(n=c.opt(e.coordinateSpace,(function(e){return e.formaID})))||null!=n?n:"nil",second:(r=c.opt(t.coordinateSpace,(function(e){return e.formaID})))||null!=r?r:"nil"},"AlignmentDetector.mergeLines","AlignmentDetector.swift",244);var o=c.eq(_._equality_SolidColor_SolidColor,e.color,s.ALIGNMENT_ROOT)||c.eq(_._equality_SolidColor_SolidColor,t.color,s.ALIGNMENT_ROOT)?s.ALIGNMENT_ROOT:s.ALIGNMENT_FORMA,a=e.location==u.AlignmentLocation.Root||t.location==u.AlignmentLocation.Root?u.AlignmentLocation.Root:u.AlignmentLocation.Forma;return new u.AlignmentLine(e.type,a,o,t.line.unionWith(e.line),e.text&&t.text,e.coordinateSpace)},update:function(e){void 0===e&&(e=!1);var t,n,r,o=this;if(null!=this.forma_&&!c.opt(this.forma_,(function(e){return null==e.root}))){this.possibleAlignmentLines_=[],this.possibleAngularAlignments_=[u.FormaAlignmentSlope.init_c8bd(null,0,1),u.FormaAlignmentSlope.init_c8bd(null,1,1),u.FormaAlignmentSlope.init_c8bd(null,1,0),u.FormaAlignmentSlope.init_c8bd(null,-1,1)];for(var a,i=c.opt(c.opt(c.opt(this.forma_,(function(e){return e.root})),(function(e){return e.finalFrame})),(function(e){return e.area})),s=c.clone(this.otherFormae_||this.forma_.root.visitAsArray(h.FormaTraversal.PreOrder)),l={},d=c.iter(s);!d.done;d.next()){var f=d.value;if(!(null==f.controller||f.kind==p.ImageForma.KIND||(a=f,null!=a.visit(h.FormaTraversal.NearestAncestor,(function(e,t,n){return c.eq(h._equality_Forma_Forma,e,o.forma_)})))||((t=c.opt(f.finalFrame,(function(e){return e.area})))||null!=t?t:0)/((n=i)||null!=n?n:.001)<.001)){this.possibleAlignmentLines_.push(u.FormaAlignmentLines.init_a036(f,f.controller.getAlignments(e))),l[f.formaID]=(r=c.opt(this.forma_.finalFrame,(function(e){return e.L1Distance(f.finalFrame)})))||null!=r?r:0;var m=f.totalPlacement.transformValues,g=c.clone(u.FormaAlignmentSlope.init_c8bd(f,m.rotSine,m.rotCosine));g.run<0&&(g.rise=-g.rise,g.run=-g.run),0!=g.rise&&0!=g.run&&this.possibleAngularAlignments_.push(g)}}var y=T.TheoDocumentUtils.HIGH_DESIGN_COMPLEXITY_HEURISTIC_THRESHOLD;this.possibleAlignmentLines_.length>y&&(c.sortInPlace(this.possibleAlignmentLines_,(function(e,t){return l[e.forma.formaID]<l[t.forma.formaID]})),this.possibleAlignmentLines_=this.possibleAlignmentLines_.splice(0,y))}},detectFormaAlignments:function(e,t,n,r){void 0===t&&(t=!1),void 0===n&&(n=!0),void 0===r&&(r=!1),r||this.update(t);for(var o=[],a=c.iter(this.forma_.controller.getAlignments());!a.done;a.next())for(var i=a.value,l=c.iter(this.possibleAlignmentLines_);!l.done;l.next())for(var d=l.value,h=c.iter(d.lines);!h.done;h.next()){var p=h.value;if(this.alignmentLineCompatible(this.forma_,d.forma,i,p,n)){var f=p.line.projectionOffset(i.line.p2),m=p.line.projectionOffset(i.line.p1),g=f.add(m).multiply(.5),y=i.line.angleWith(p.line)%Math.PI;if(g.length()<e&&Math.abs(y)<s.ANGULAR_THRESHOLD){var _=this.mergeLines(i,p);o.push(new u.FormaAlignment(d.forma,g,_))}}}return o},formaAlignmentDistances:function(e){for(var t=c.clone(this.detectFormaAlignments(1/0)),n=[],r=c.iter(t);!r.done;r.next()){var o=r.value;o.line.type==e&&n.push(o)}return n},rotationIndicatorForForma:function(e,t,n,r){var o=[];if(null!=e){var a=e.root,i=e.bounds,l=i.eval(t),c=i.eval(P._plus_TheoPoint_TheoPoint(t,new P.TheoPoint(.5,0))),d=new C.TheoLine(l,c).transform(n),h=new C.TheoLine(d.p1,P._plus_TheoPoint_TheoPoint(d.p1,new P.TheoPoint(d.length,0)));o.push(new u.AlignmentLine(u.AlignmentType.Rotation,u.AlignmentLocation.Forma,s.ALIGNMENT_ROTATION,d,!1,a,r)),o.push(new u.AlignmentLine(u.AlignmentType.Rotation,u.AlignmentLocation.Forma,s.ALIGNMENT_ROTATION,h,!1,a,r))}return o},snapped_Placement:function(e,t,n,r){void 0===r&&(r=!1);var o=null,a=c.clone(this.detectFormaAlignments(t,void 0,void 0,r)),i=[];if(f.ImageFacade.inCropMode(this.forma_))return[o,i];if(null!=e){for(var l=this.forma_.totalPlacement.transformValues,d={rise:l.rotSine,run:l.rotCosine},p=Math.atan2(d.rise,d.run),m=Math.atan2(-d.rise,-d.run),g=c.clone(u.FormaAlignmentSlope.init_c8bd(null,0,0)),_=1/0,T=[],C=c.iter(this.possibleAngularAlignments_);!C.done;C.next()){var S=C.value,A=Math.atan2(S.rise,S.run),D=function(e){var t=Math.abs(A-e);(t<_||t<s.SNAP_ANGLE_THRESHOLD)&&(t<_&&(g=c.clone(S),_=t),T.push({forma:S.forma,difference:t}))};D(p),D(m)}if(_<s.SNAP_ANGLE_THRESHOLD){l.rotCosine*g.run+l.rotSine*g.rise<0&&(g.run=-g.run,g.rise=-g.rise);var E=g.run,R=g.rise,F=($=this.forma_.totalPlacement).transformPoint(this.forma_.bounds.eval(e)),I=$.inverse,b=($=($=($=$.translateXY(-F.x,-F.y)).rotateTo(E,R)).translateXY(F.x,F.y)).concat(I);o=this.forma_.placement.inverse.concat(b).concat(this.forma_.placement);for(var O=u.LineStyle.Dashed,k=c.clone(this.rotationIndicatorForForma(this.forma_,e,$,O)),M=c.iter(k);!M.done;M.next()){var N=M.value;i.push(N)}for(var L=c.iter(T);!L.done;L.next()){var x=L.value,B=x.difference,w=x.forma;if(Math.abs(B-_)<.001)for(var G=c.clone(this.rotationIndicatorForForma(w,new P.TheoPoint(.5,.5),c.opt(w,(function(e){return e.totalPlacement})),O)),Y=c.iter(G);!Y.done;Y.next())N=Y.value,i.push(N)}}}else{for(var U=c.iter([this.verticalAlignments,this.horizontalAlignments]);!U.done;U.next()){for(var V=U.value,j=(_=1/0,null),H=[],W=!1,K=c.iter(a);!K.done;K.next()){var X=(J=K.value).line,z=this.isVerticalAlignment(X.type);if(V.includes(J.line.type))if(null==j)j=J.offset,H.push(X),W=X.location==u.AlignmentLocation.Root,_=z?J.offset.x:J.offset.y;else{var q=z?Math.abs(Math.round(j.x)-Math.round(J.offset.x)):Math.abs(Math.round(j.y)-Math.round(J.offset.y));q<.001?(H.push(X),X.location==u.AlignmentLocation.Root&&(W=!0)):q<_&&(H.splice(0),H.push(X),j=J.offset,W=X.location==u.AlignmentLocation.Root,_=q)}}if(W&&(H=H.filter((function(e){return e.location==u.AlignmentLocation.Root}),this)),null!=j){for(var Z=c.iter(H);!Z.done;Z.next()){var J=Z.value;i.push(J)}var Q=y.Matrix2D.translationXY(j.x,j.y);if(null!=o){o=c.opt(o,(function(e){return e.concat(Q)}));break}o=Q}}var $;if(null!=o)I=($=this.forma_.totalPlacement).inverse,b=($=$.concat(o)).concat(I),o=this.forma_.placement.inverse.concat(b).concat(this.forma_.placement)}return n&&(i=[],this.forma_.root.visitAll(h.FormaTraversal.PreOrder,(function(e){var t;if(t=c.as(e.controller,v.TypeLockupController))for(var n=c.iter(t.getAlignments());!n.done;n.next()){var r=n.value;i.push(r)}}))),[o,i]}}}),s)},cbNz:function(e,t,n){var r,o=t,a=n("oAGj"),i=n("FNB+"),s=n("6ZWm"),l=n("wc1n"),u=n("cmoc"),c=n("tQF8"),d=n("4mVB"),h=n("fNpk"),p=n("Dq5S"),f=n("8t9B"),m=n("oKlP"),g=n("sIWg"),y=n("1NAc");o.GridStyleFeatureExtractor=(r=function(e,t,n,r,o,i,s){var u,c,f;if(this.imageCells_=[],this.floatingCells_=[],this.adjacentImageCount_=0,this.cellXSymm_=0,this.cellYSymm_=0,void 0===e&&(e=null),void 0===t&&(t=null),void 0===n&&(n=null),void 0===r&&(r=null),void 0===o&&(o=null),void 0===i&&(i=null),void 0===s&&(s=[]),h.LegacyCoreAssert.isTrue(null!=r||null!=t||null!=a.as(a.opt(e,(function(e){return e.style})),d.GridStyle),"gridStyle or mapping must be provided or forma style must be  a grid style",void 0,"GridStyleFeatureExtractor.init","GridStyleFeatureExtractor.swift",50),(u=t)?this.mapping_=a.clone(u):(this.gridStyle_=r||e.style,this.mapping_=a.clone(this.gridStyle_.formaMapping)),this.gridFrame_=o||e.frame,(c=n)?this.gridCells_=a.clone(c):this.gridCells_=a.clone(this.gridStyle_.gridCellArray),null!=i)this.layoutItems_=a.clone(i);else if(this.layoutItems_=[],f=e)for(var m=a.clone(f.filterWithCallback((function(e){return null!=e.controller&&e.controller.floating||e.isBackgroundImage()}))),g=a.iter(m);!g.done;g.next()){var y=g.value;this.layoutItems_.push(p.LayoutItem.init_b14a(y))}this.currentGrid_=e,this.forFeatures_=a.clone(s),this.featureEvals_=[],l.FeatureExtractor.call(this),this.imageCells_=a.clone(this.getTypeOfCell(p.ItemContentType.Image)),this.floatingCells_=a.clone(this.getTypeOfCell(p.ItemContentType.Floating)),this.adjacentImageCount_=0;for(var _=a.iter(this.imageCells_);!_.done;_.next())for(var T=_.value,C=a.iter(this.imageCells_);!C.done;C.next()){var v=C.value;this.isAdjacent(T,v)&&T!==v&&(this.adjacentImageCount_+=1)}this.cellXSymm_=this.getCellSymmAsymm(!0),this.cellYSymm_=this.getCellSymmAsymm(!1),this.initFeatures(),this.evaluateFeatures()},a.defineClass({name:"GridStyleFeatureExtractor",ctor:r,superName:"FeatureExtractor",statics:{_implements:function(e){return"FeatureExtractorProtocol"==e}},props:{initFeatures:function(){this.featureEvals_=[["CellAspectRatio",[this.evaluateCellAspectRatio,l.FeatureType.Numerical]],["AreaPercentImages",[this.evaluateAreaPercentImages,l.FeatureType.Numerical]],["ImageCellContentFit",[this.evaluateImageCellContentFit,l.FeatureType.Numerical]],["AverageCellSize",[this.evaluateAverageCellSize,l.FeatureType.Numerical]],["AverageImageCellSize",[this.evaluateAverageImageCellSize,l.FeatureType.Numerical]],["AverageTextCellSize",[this.evaluateAverageTextCellSize,l.FeatureType.Numerical]],["ImageCellVariance",[this.evaluateImageCellVariance,l.FeatureType.Numerical]],["TextCellVariance",[this.evaluateTextCellVariance,l.FeatureType.Numerical]],["OverallCellVariance",[this.evaluateOverallCellVariance,l.FeatureType.Numerical]],["TypeSymmetryAcrosstheXAxis",[this.evaluateXAxisTypeSymmetry,l.FeatureType.Numerical]],["TypeSymmetryAcrosstheYAxis",[this.evaluateYAxisTypeSymmetry,l.FeatureType.Numerical]],["TypeAsymmetryAcrosstheXAxis",[this.evaluateXAxisTypeAsymmetry,l.FeatureType.Numerical]],["TypeAsymmetryAcrosstheYAxis",[this.evaluateYAxisTypeAsymmetry,l.FeatureType.Numerical]],["CellSymmetryAcrosstheXAxis",[this.evaluateXAxisCellSymmetry,l.FeatureType.Numerical]],["CellSymmetryAcrosstheYAxis",[this.evaluateYAxisCellAsymmetry,l.FeatureType.Numerical]],["CellAsymmetryAcrosstheXAxis",[this.evaluateXAxisCellSymmetry,l.FeatureType.Numerical]],["CellAsymmetryAcrosstheYAxis",[this.evaluateYAxisCellAsymmetry,l.FeatureType.Numerical]],["AverageImageXVal",[this.evaluateAverageImageXVal,l.FeatureType.Numerical]],["AverageImageYVal",[this.evaluateAverageImageYVal,l.FeatureType.Numerical]],["AverageTextXVal",[this.evaluateAverageTextXVal,l.FeatureType.Numerical]],["AverageTextYVal",[this.evaluateAverageTextYVal,l.FeatureType.Numerical]],["ImageSpreadinXDimension",[this.evaluateImageXSpread,l.FeatureType.Numerical]],["ImageSpreadinYDimension",[this.evaluateImageYSpread,l.FeatureType.Numerical]],["TextSpreadinXDimension",[this.evaluateTextXSpread,l.FeatureType.Numerical]],["TextSpreadinYDimension",[this.evaluateTextYSpread,l.FeatureType.Numerical]],["MaxImageXOffsetFromCenter",[this.evaluateMaxImageXOffsetFromCenter,l.FeatureType.Numerical]],["MaxImageYOffsetFromCenter",[this.evaluateMaxImageYOffsetFromCenter,l.FeatureType.Numerical]],["MaxTextXOffsetFromCenter",[this.evaluateMaxTextXOffsetFromCenter,l.FeatureType.Numerical]],["MaxTextYOffsetFromCenter",[this.evaluateMaxTextYOffsetFromCenter,l.FeatureType.Numerical]],["TextFocused",[this.evaluateTextFocused,l.FeatureType.Numerical]],["TextDispersement",[this.evaluateTextDispersement,l.FeatureType.Numerical]],["AdjacentMatches",[this.evaluateAdjacentMatch,l.FeatureType.Numerical]],["AdjacentMismatches",[this.evaluateAdjacentMismatch,l.FeatureType.Numerical]],["PreviousOrder",[this.evaluatePreviousOrder,l.FeatureType.Numerical]],["PreviousPosition",[this.evaluatePreviousPosition,l.FeatureType.Numerical]],["PreviousPositionFlip",[this.evaluatePreviousPositionFlip,l.FeatureType.Numerical]],["PreviousImageSize",[this.evaluatePreviousImageSize,l.FeatureType.Numerical]]]},evaluateFeatures:function(){for(var e=0==this.forFeatures_.length,t=a.iter(this.featureEvals_);!t.done;t.next()){var n=t.value;if(e||!e&&this.forFeatures_.includes(n[0])){var r=n[1],o=(0,r[0])(this);this.setFeature(n[0],o,r[1])}}},evaluateCellAspectRatio:function(e){for(var t=0,n=a.iter(e.gridCells_);!n.done;n.next()){var r=n.value,o=e.gridFrame_.evalRect(r.bounds),i=Math.max(o.aspectRatio,1/o.aspectRatio);h.LegacyCoreAssert.isTrue(i>0,"cell aspect ratio must be positive",void 0,"GridStyleFeatureExtractor.evaluateCellAspectRatio","GridStyleFeatureExtractor.swift",176),t+=i}return t/a.toDouble(e.gridCells_.length)},evaluateImageCellContentFit:function(e){for(var t=0,n=0,r=a.iter(e.layoutItems_);!r.done;r.next()){var o,i,s,l=r.value;if(l.type==p.ItemContentType.Image&&(o=a.opt(e.mapping_[l.id],(function(e){return e.bounds})))&&null!=(i=l.width)&&null!=(s=l.height)){var u=e.gridFrame_.evalRect(o),c=g.TheoRect.fromSize(new y.TheoSize(a.toDouble(i),a.toDouble(s)));t+=u.similarity(c),n+=1}}return t/(a.toDouble(n)+1e-5)},evaluateAreaPercentImages:function(e){return e.getCellAreaSum(e.getImageCells())/e.gridFrame_.area},evaluateAverageCellSize:function(e){return 1/a.toDouble(e.gridCells_.length)},evaluateAverageImageCellSize:function(e){var t=a.clone(e.getImageCells());return 0!=t.length?e.getCellAreaSum(t)/a.toDouble(t.length)/e.gridFrame_.area:0},evaluateAverageTextCellSize:function(e){var t=a.clone(e.getFloatingCells());return 0!=t.length?e.getCellAreaSum(t)/a.toDouble(t.length)/e.gridFrame_.area:0},evaluateImageCellVariance:function(e){return e.getVariance(e.getImageCells())},evaluateTextCellVariance:function(e){return e.getVariance(e.getFloatingCells())},evaluateOverallCellVariance:function(e){var t=a.clone(e.getFloatingCells()),n=a.clone(e.getImageCells()),r=e.getMaxandMinCellArea(n),o=r[0],i=r[1],s=e.getMaxandMinCellArea(t),l=s[0],u=s[1],c=Math.max(o,l),d=Math.min(i,u);return Math.abs((c-d)/e.gridFrame_.area)},evaluateXAxisTypeSymmetry:function(e){return e.getSymmAsymm(e.getImageCells(),e.getImageCells(),!0,1)},evaluateYAxisTypeSymmetry:function(e){return e.getSymmAsymm(e.getImageCells(),e.getImageCells(),!1,1)},evaluateXAxisTypeAsymmetry:function(e){return 2*e.getSymmAsymm(e.getImageCells(),e.getFloatingCells(),!0,0)},evaluateYAxisTypeAsymmetry:function(e){return 2*e.getSymmAsymm(e.getImageCells(),e.getFloatingCells(),!1,0)},evaluateXAxisCellSymmetry:function(e){return e.cellXSymm_},evaluateYAxisCellSymmetry:function(e){return e.cellYSymm_},evaluateXAxisCellAsymmetry:function(e){return 1-e.cellXSymm_},evaluateYAxisCellAsymmetry:function(e){return 1-e.cellYSymm_},evaluateAverageImageXVal:function(e){return e.getAverageVal(e.getImageCells(),!0)},evaluateAverageImageYVal:function(e){return e.getAverageVal(e.getImageCells(),!1)},evaluateAverageTextXVal:function(e){return e.getAverageVal(e.getFloatingCells(),!0)},evaluateAverageTextYVal:function(e){return e.getAverageVal(e.getFloatingCells(),!1)},evaluateImageXSpread:function(e){return e.getSpread(e.getImageCells(),!0)},evaluateImageYSpread:function(e){return e.getSpread(e.getImageCells(),!1)},evaluateTextXSpread:function(e){return e.getSpread(e.getFloatingCells(),!0)},evaluateTextYSpread:function(e){return e.getSpread(e.getFloatingCells(),!1)},evaluateMaxImageXOffsetFromCenter:function(e){return e.getOffsetFromCenter(e.getImageCells(),!0)},evaluateMaxImageYOffsetFromCenter:function(e){return e.getOffsetFromCenter(e.getImageCells(),!1)},evaluateMaxTextXOffsetFromCenter:function(e){return e.getOffsetFromCenter(e.getFloatingCells(),!0)},evaluateMaxTextYOffsetFromCenter:function(e){return e.getOffsetFromCenter(e.getFloatingCells(),!1)},evaluateTextFocused:function(e){var t=a.clone(e.getFloatingCells());return 1==t.length&&e.gridFrame_.area>0?t[0].bounds.area/e.gridFrame_.area:0},evaluateTextDispersement:function(e){for(var t=a.clone(e.getFloatingCells()),n=0,r=a.iter(e.layoutItems_);!r.done;r.next()){var o=r.value;null!=e.mapping_[o.id]&&o.type==p.ItemContentType.Floating&&(n+=1)}return a.toDouble(t.length)/(n+.001)},evaluateAdjacentMatch:function(e){for(var t=0,n=0,r=a.clone(e.getFloatingCells()),o=a.clone(e.getImageCells()),i=a.iter(r);!i.done;i.next())for(var s=i.value,l=a.iter(r);!l.done;l.next()){for(var u=l.value,c=a.iter(o);!c.done;c.next()){var d=c.value;e.isAdjacent(s,d)&&(n+=1)}e.isAdjacent(s,u)&&s!==u&&(t+=1,n+=1)}return n+=e.adjacentImageCount_,t+=e.adjacentImageCount_,n>0?a.toDouble(t)/a.toDouble(n):0},evaluateAdjacentMismatch:function(e){for(var t=0,n=0,r=a.clone(e.getFloatingCells()),o=a.clone(e.getImageCells()),i=a.iter(r);!i.done;i.next())for(var s=i.value,l=a.iter(r);!l.done;l.next()){for(var u=l.value,c=a.iter(o);!c.done;c.next()){var d=c.value;e.isAdjacent(s,d)&&(n+=1,t+=1)}e.isAdjacent(s,u)&&s!==u&&(n+=1)}return(n+=e.adjacentImageCount_)>0?a.toDouble(t)/a.toDouble(n):0},evaluatePreviousPosition:function(e){return e.getPreviousPos(!1)},evaluatePreviousPositionFlip:function(e){return e.getPreviousPos(!0)},evaluatePreviousImageSize:function(e){var t;if(t=e.currentGrid_){for(var n=t.root,r=0,o={},i=a.iter(a.keys(e.mapping_));!i.done;i.next()){var s=i.value;o[s]=e.mapping_[s]}for(var l=a.iter(o);!l.done;l.next()){var u,c=l.key,d=l.value,h=t.page.formaByID(c);if(null!=h&&(u=h.finalFrame)){var p=n.finalFrame.size,f=a.opt(t.finalFrame,(function(e){return e.evalRect(d.bounds)}));h.isImage()&&null!=f&&(r+=Math.abs(u.area-f.area)/(p.width*p.height))}}return r}return 0},evaluatePreviousOrder:function(e){var t;if(t=e.currentGrid_){t.root;for(var n=[],r=[],o=a.clone(e.getImageCells()),l=a.clone(e.getFloatingCells()),d=[],h=a.iter(a.range(0,e.gridCells_.length,!1));!h.done;h.next())d.push(null);for(var p={},g=a.iter(a.keys(e.mapping_));!g.done;g.next()){var y=g.value;p[y]=e.mapping_[y]}for(var _=a.iter(p);!_.done;_.next()){var T=_.key,C=_.value,v=t.page.formaByID(T);a.opt(a.opt(v,(function(e){return e.controller})),(function(e){return e.kind==s.FrameController.KIND}))&&(a.containsEq(o,C,c._equality_GridCell_GridCell)||o.push(C),n.push({cell:C,forma:v})),a.opt(a.opt(v,(function(e){return e.controller})),(function(e){return e.kind==f.TypeLockupController.KIND}))&&(a.containsEq(l,C,c._equality_GridCell_GridCell)||l.push(C),r.push({cell:C,forma:v}))}var P=a.clone(t.root.filterByKind(u.FrameForma.KIND));a.sortInPlace(P,(function(e,t){return e.frame.center.distanceTo(m.TheoPoint.ZERO)<t.frame.center.distanceTo(m.TheoPoint.ZERO)})),a.sortInPlace(n,(function(e,t){return e.cell.bounds.origin.distanceTo(m.TheoPoint.ZERO)<t.cell.bounds.origin.distanceTo(m.TheoPoint.ZERO)}));var S=a.clone(t.root.filterByControllerKind(f.TypeLockupController.KIND));a.sortInPlace(S,(function(e,t){return e.frame.center.distanceTo(m.TheoPoint.ZERO)<t.frame.center.distanceTo(m.TheoPoint.ZERO)})),a.sortInPlace(l,(function(e,t){return e.bounds.center.distanceTo(m.TheoPoint.ZERO)<t.bounds.center.distanceTo(m.TheoPoint.ZERO)}));for(var A=0,D=a.iter(a.range(0,n.length,!1));!D.done;D.next()){var E=n[N=D.value].forma;null!=(L=a.indexOfEq(P,E,i._equality_Forma_Forma))&&L!=N&&(A+=1)}for(var R=[],F=a.iter(l);!F.done;F.next()){for(var I=F.value,b=[],O=a.iter(r);!O.done;O.next()){var k=O.value;a.eq(c._equality_GridCell_GridCell,k.cell,I)&&b.push(k.forma)}a.sortInPlace(b,(function(e,t){return e.finalFrame.origin.distanceTo(m.TheoPoint.ZERO)<t.finalFrame.origin.distanceTo(m.TheoPoint.ZERO)})),a.append(R,b)}for(var M=a.iter(a.range(0,R.length,!1));!M.done;M.next()){var N,L,x=R[N=M.value];null!=(L=a.indexOfEq(S,x,i._equality_Forma_Forma))&&L!=N&&(A+=1)}return A}return 0},getPreviousPos:function(e){var t;if(t=this.currentGrid_){for(var n=t.root,r=0,o={},i=a.iter(a.keys(this.mapping_));!i.done;i.next()){var s=i.value;o[s]=this.mapping_[s]}for(var l=a.iter(o);!l.done;l.next()){var u,c=l.key,d=l.value,p=t.page.formaByID(c);if(null!=p&&(u=p.finalFrame)){var f=n.finalFrame.size;h.LegacyCoreAssert.isTrue(f.width>0&&f.height>0,"root width and height must be positive",void 0,"GridStyleFeatureExtractor.getPreviousPos","GridStyleFeatureExtractor.swift",597),r+=(e?new m.TheoPoint(u.center.y/f.height,u.center.x/f.width):new m.TheoPoint(u.center.x/f.width,u.center.y/f.height)).distanceTo(d.bounds.center)}}return r}return 0},getSymmAsymm:function(e,t,n,r){var o;void 0===r&&(r=0);var i=0;if(0==t.length||0==e.length)return r;for(var s=a.iter(a.range(0,e.length,!1));!s.done;s.next())for(var l=e[s.value].bounds,u=n?new g.TheoRect(l.minX,1-l.maxY,l.maxX,1-l.minY):new g.TheoRect(1-l.maxX,l.minY,1-l.minX,l.maxY),c=a.iter(a.range(0,t.length,!1));!c.done;c.next()){var d=c.value,h=this.cellIntersection(t[d].bounds,u);i+=(o=a.opt(h,(function(e){return e.area})))||null!=o?o:0}return e.length>0?i:r},getCellSymmAsymm:function(e){for(var t=0,n=a.iter(a.range(0,this.gridCells_.length,!1));!n.done;n.next())for(var r=n.value,o=this.gridCells_[r].bounds,i=o.area,s=e?new g.TheoRect(o.minX,1-o.maxY,o.maxX,1-o.minY):new g.TheoRect(1-o.maxX,o.minY,1-o.minX,o.maxY),l=a.iter(a.range(0,this.gridCells_.length,!1));!l.done;l.next()){var u,c=l.value,d=this.gridCells_[c].bounds;(u=this.cellIntersection(d,s))&&(t+=u.area/Math.max(i,d.area))}return this.gridCells_.length>0?t/a.toDouble(this.gridCells_.length):0},cellIntersection:function(e,t){var n=null;return Math.max(e.minX,t.minX)<Math.min(e.maxX,t.maxX)&&Math.max(e.minY,t.minY)<Math.min(e.maxY,t.maxY)&&(n=new g.TheoRect(Math.max(e.minX,t.minX),Math.max(e.minY,t.minY),Math.min(e.maxX,t.maxX),Math.min(e.maxY,t.maxY))),n},isAdjacent:function(e,t){var n=e.bounds,r=t.bounds;return n.maxX-r.minX>0&&r.maxX-n.minX>0&&n.maxY-r.minY>=0&&r.maxY-n.minY>=0||n.maxX-r.minX>=0&&r.maxX-n.minX>=0&&n.maxY-r.minY>0&&r.maxY-n.minY>0},getOffsetFromCenter:function(e,t){for(var n=0,r=a.iter(e);!r.done;r.next()){var o=r.value,i=Math.abs((t?o.bounds.center.x:o.bounds.center.y)-.5);i>n&&(n=i)}return n},getAverageVal:function(e,t){for(var n=0,r=a.iter(e);!r.done;r.next()){var o=r.value;n+=t?o.bounds.center.x:o.bounds.center.y}return e.length>0?n/a.toDouble(e.length):0},getSpread:function(e,t){for(var n=1,r=0,o=a.iter(e);!o.done;o.next()){var i=o.value;t?(i.bounds.minX<n&&(n=i.bounds.minX),i.bounds.maxX>r&&(r=i.bounds.maxX)):(i.bounds.minY<n&&(n=i.bounds.minY),i.bounds.maxY>r&&(r=i.bounds.maxY))}return Math.max(r-n,0)},getVariance:function(e){var t=this.getMaxandMinCellArea(e),n=t[0],r=t[1];return Math.abs((n-r)/this.gridFrame_.area)},getMaxandMinCellArea:function(e){for(var t=0,n=this.gridFrame_.area,r=a.iter(e);!r.done;r.next()){var o=r.value,i=this.gridFrame_.evalRect(o.bounds).area;i>t&&(t=i),i<n&&(n=i)}return[t,n]},getCellAreaSum:function(e){for(var t=0,n=a.iter(e);!n.done;n.next()){var r=n.value;t+=this.gridFrame_.evalRect(r.bounds).area}return t},getImageCells:function(){return this.imageCells_},getFloatingCells:function(){return this.floatingCells_},getTypeOfCell:function(e){for(var t=[],n=a.iter(this.layoutItems_);!n.done;n.next()){var r,o=n.value;(r=this.mapping_[o.id])&&o.type==e&&(a.containsEq(t,r,c._equality_GridCell_GridCell)||t.push(r))}return t}}}),r)},cmoc:function(e,t,n){var r,o=t,a=n("oAGj"),i=n("CWW7"),s=n("Bpjk"),l=n("FNB+"),u=n("6ZWm"),c=n("fWxZ"),d=n("JEzR"),h=n("P83h"),p=n("pnSN"),f=n("4mVB"),m=n("fdtz"),g=n("lmwz"),y=n("fNpk"),_=n("djAF");o.FrameForma=(r=function(){},a.defineClass({name:"FrameForma",ctor:r,superName:"GroupForma",statics:{KIND:{get:function(){return"Frame"}},PROPERTY_CLIPMODE:"clipmode",PROPERTY_CROP_RATIO_ID:"cropRatioId",SCHEMA_CLASS_NAME:{get:function(){return"FrameForma"}},factory:{get:function(){return function(e,t,n,o){if(null!=t){var i=a.as(a.opt(a.opt(o,(function(e){return e.backLink})),(function(e){return e.dereference()})),p.GroupForma),s=a.as(a.opt(a.opt(o,(function(e){return e.backLink})),(function(e){return e.dereference()})),c.FormaPage);return y.LegacyCoreAssert.isTrue(null!=i||null!=s,"FrameForma needs a parent group or page",void 0,"FrameForma","FrameForma.swift",23),null!=i?r.init_3144(e,t,n,i):r.init_7dbd(e,t,n,s)}return r.init_d1c9(e,n)}}},_implements:function(e){return"IDBObject"==e||"TheoMessageSubscriber"==e||"TheoMessagePublisher"==e}},props:{init_3144:function(e,t,n,r){a.super_init(this,p.GroupForma,p.GroupForma.prototype.init_3144,e,t,n,r)},init_7dbd:function(e,t,n,r){a.super_init(this,p.GroupForma,p.GroupForma.prototype.init_7dbd,e,t,n,r)},init_812f:function(e,t){for(var n={kind:function(){return r.KIND},style:function(){return d.FrameStyle.createDefault()},clipmode:function(){return!0},cropRatioId:function(){return s.CropRatioPresetLibrary.FREEFORM_ID}},o=a.clone(t),i=a.iter(n);!i.done;i.next()){var l=i.key,u=i.value;null==t[l]&&(o[l]=u())}a.super_init(this,p.GroupForma,p.GroupForma.prototype.init_812f,e,o)},init_d1c9:function(e,t){a.super_init(this,p.GroupForma,p.GroupForma.prototype.init_d1c9,e,t)},init_7186:function(e){var t={kind:r.KIND,clipmode:!0,cropRatioId:s.CropRatioPresetLibrary.FREEFORM_ID};this.init_812f(e,t)},decodeController:function(){var e;(e=a.opt(this.page.document,(function(e){return e.controller})))&&(this.controller=e.controllerFactory.createController(u.FrameController.KIND,this)),p.GroupForma.prototype.decodeController.call(this)},className:{get:function(){return r.SCHEMA_CLASS_NAME}},updateEventForProperty:function(e){switch(e){case"style":var t;return(t=g.ImageFacade.getImageFormaForForma(this))?new h.FormaCutoutChangedEvent(t):null;default:return p.GroupForma.prototype.updateEventForProperty.call(this,e)}},bounds:{get:function(){return p.GroupForma._getters.bounds.call(this)},set:function(e){var t,n,r,o=this.bounds;p.GroupForma._setters.bounds.call(this,e),(t=a.as(this.controller,u.FrameController))&&(n=o)&&(r=e)&&t.setChildrenCropping(t.getCurrentCropType(n,r),n)}},cropRatioId:{get:function(){var e;return(e=a.as(this.get(r.PROPERTY_CROP_RATIO_ID),"String"))||null!=e?e:s.CropRatioPresetLibrary.FREEFORM_ID},set:function(e){this.set(r.PROPERTY_CROP_RATIO_ID,e)}},clipMode:{get:function(){return this.get(r.PROPERTY_CLIPMODE)},set:function(e){this.set(r.PROPERTY_CLIPMODE,e)}},hasAlpha:function(){var e,t=!(!(e=a.opt(a.as(this.controller,u.FrameController),(function(e){return e.hasCutout})))&&null==e)&&e&&null==this.style.colors.fieldPrimary;return this.visitAll(l.FormaTraversal.JustChildren,(function(e){var n=a.as(e,m.ImageForma);null!=n&&n.hasAlpha()&&(t=!0)})),t},image:{get:function(){return g.ImageFacade.getImageFormaForForma(this)}},matchColors:function(e){a.opt(a.as(this.controller,u.FrameController),(function(t){return 1==t.hasCutout&&a.opt(a.as(e.controller,u.FrameController),(function(e){return 1==e.hasCutout}))}))&&p.GroupForma.prototype.matchColors.call(this,e)},match:function(e){var t,n=this;if(p.GroupForma.prototype.match.call(this,e),t=a.as(e,r)){var o,s,l,c,d,h,y;if(this.isGridCell()&&!e.isGridCell()&&(o=a.as(a.opt(this.parent,(function(e){return e.style})),f.GridStyle))&&o.formaMapping[this.formaID]&&o.removeMappingToForma(this),this.intent=e.intent,(s=g.ImageFacade.getMaskForForma(t))?g.ImageFacade.applyMaskToForma(this,s,null,!0):(l=g.ImageFacade.getMaskFormaForForma(this))&&(l instanceof _.ShapeForma||l instanceof m.ImageForma)&&g.ImageFacade.removeMaskForForma(this),(c=g.ImageFacade.getCutoutMaskFormaForForma(t))&&(d=c.contentNode)&&(h=this.page.document)){var T,C=new i.AddFormaParams(void 0,void 0,void 0,void 0,i.AddFormaParentingHint.doNotAddFormaForContentToTree);(T=e.page.document==this.page.document?d:d.copyTo(h))&&i.CreationFacade.addImageForContentNode(this.page,T,C).then((function(t){var r;return(r=a.as(t,m.ImageForma))&&(g.ImageFacade.setCutoutForForma(n,r),g.ImageFacade.setCutoutModeForForma(n,g.ImageFacade.getCutoutModeForForma(e)),r.match(c),r.placement=c.placement),null}))}else(y=a.as(this.controller,u.FrameController))&&g.ImageFacade.getCutoutMaskFormaForForma(this)&&y.hasCutout&&g.ImageFacade.removeCutoutForForma(this);this.cropRatioId=t.cropRatioId}}}}),r)},dE3O:function(e,t,n){var r,o,a=t,i=n("oAGj"),s=n("ThKb");a.ImageProcessingUtils=(r=function(){},o={},i.defineClass({name:"ImageProcessingUtils",ctor:r,statics:{sobelX:{get:function(){return void 0===o.sobelX&&(o.sobelX=new s.TheoMatrix([[1,0,-1],[2,0,-2],[1,0,-1]])),o.sobelX}},sobelY:{get:function(){return void 0===o.sobelY&&(o.sobelY=new s.TheoMatrix([[1,2,1],[0,0,0],[-1,-2,-1]])),o.sobelY}},gaussianBlur3x3:{get:function(){return void 0===o.gaussianBlur3x3&&(o.gaussianBlur3x3=new s.TheoMatrix([[1,2,1],[2,4,2],[1,2,1]]).multiplyConstant(1/16)),o.gaussianBlur3x3}},applyConvolution:function(e,t){for(var n=i.toInt(Math.floor(i.toDouble(t.width)/2)),r=i.toInt(Math.floor(i.toDouble(t.height)/2)),o=[],a=i.iter(i.range(0,e.height,!1));!a.done;a.next()){for(var l=a.value,u=[],c=i.iter(i.range(0,e.width,!1));!c.done;c.next()){for(var d=c.value,h=0,p=i.iter(i.range(0,t.height,!1));!p.done;p.next())for(var f=p.value,m=i.iter(i.range(0,t.width,!1));!m.done;m.next()){var g=m.value,y=d+g-n,_=l+f-r;y>=0&&_>=0&&y<e.width&&_<e.height&&(h+=e.value(_,y)*t.value(f,g))}u.push(h)}o.push(u)}return new s.TheoMatrix(o)},getEdgeMagnitudeImage:function(e){if(e.isEmpty())return s.TheoMatrix.empty();var t=r.applyConvolution(e,r.sobelX).squared(),n=r.applyConvolution(e,r.sobelY).squared();return r.removeBorders(t),r.removeBorders(n),t.add(n).squareRoot()},removeBorders:function(e){e.isEmpty()||(e.setColValue(0,0),e.setColValue(e.cols-1,0),e.setRowValue(0,0),e.setRowValue(e.rows-1,0))}}}),r)},dJuF:function(e,t,n){var r,o,a,i,s,l=t,u=n("oAGj"),c=n("O60Y"),d=n("fVJ2"),h=n("SmK9"),p=n("13MC"),f=n("fNpk");l.DBNamePath=(r=function(){},u.defineClass({name:"DBNamePath",ctor:r,props:{init_1346:function(e,t){this.name=e,this.parent=t},init_b14a:function(e){this.name=e,this.parent=null},prepend:function(e){return r.init_b14a(e).appendPath(this)},append:function(e){return r.init_1346(e,this)},appendPath:function(e){var t=this;return e.forEach((function(e){t=t.append(e.name)})),t},forEach:function(e){u.opt(this.parent,(function(t){return t.forEach(e)})),e(this)},path:{get:function(){var e=[];return this.forEach((function(t){return e.push(t.name)})),e}}}}),r),l.DBProperty=(o=function e(t,n,r,o){this.shouldWrite=!0,this.schemaType=t,this.className=o,this.name_=n.name,this.value_=r,this.namePath_=n,t==h.DBSchemaType.ArrayType?this.arrayValue_=u.clone(u.as(r,["Array",e])):this.arrayValue_=null,t==h.DBSchemaType.ObjectType?this.dictionaryValue_=u.clone(u.as(r,["Dictionary","String",e])):this.dictionaryValue_=null,this.reroot(n)},u.defineClass({name:"DBProperty",ctor:o,statics:{deleted:function(e){return new l.DBDeletedProperty(e)},boolEncoded:function(e,t,n){return new o(h.DBSchemaType.BooleanType,e,t,n)},doubleEncoded:function(e,t,n){return new o(h.DBSchemaType.NumberType,e,t,n)},intEncoded:function(e,t,n){return new o(h.DBSchemaType.IntegerType,e,t,n)},stringEncoded:function(e,t,n){return new o(h.DBSchemaType.StringType,e,t,n)},arrayEncoded:function(e,t,n){return new o(h.DBSchemaType.ArrayType,e,t,n)},dictEncoded:function(e,t,n){return new o(h.DBSchemaType.ObjectType,e,t,n)},objProperty:function(e,t,n,r){return new o(h.DBSchemaType.ObjectType,e,c.DBLink.init_14fa(t,r),n)},linkProperty:function(e,t,n,r,a){return new o(h.DBSchemaType.ObjectType,e,c.DBLink.init_8408(t,n,a),r)},boolProperty:function(e,t,n){void 0===n&&(n=!1);var r=new o(h.DBSchemaType.BooleanType,e,t,null);return r.shouldWrite=!n,r},doubleProperty:function(e,t,n){void 0===n&&(n=!1);var r=new o(h.DBSchemaType.NumberType,e,t,null);return r.shouldWrite=!n,r},intProperty:function(e,t,n){void 0===n&&(n=!1);var r=new o(h.DBSchemaType.IntegerType,e,t,null);return r.shouldWrite=!n,r},stringProperty:function(e,t,n){void 0===n&&(n=!1);var r=new o(h.DBSchemaType.StringType,e,t,null);return r.shouldWrite=!n,r},arrayProperty:function(e,t){return new o(h.DBSchemaType.ArrayType,e,t,null)},dictProperty:function(e,t){return new o(h.DBSchemaType.ObjectType,e,t,null)},arraysEqual:function(e,t){var n=e.arrayPropertyCount;if(t.arrayPropertyCount!=n)return!1;for(var r=u.iter(u.range(0,n,!1));!r.done;r.next()){var o=r.value;if(!e.arrayValue_[o].isEqual(t.arrayValue_[o]))return!1}return!0},dictsEqual:function(e,t){if(u.keys(e.dictionaryValue_).length==u.keys(t.dictionaryValue_).length){for(var n=u.iter(u.keys(e.dictionaryValue_));!n.done;n.next()){var r=n.value,o=e.dictionaryValue_[r],a=t.dictionaryValue_[r];if(null==a||!o.isEqual(a))return!1}return!0}return!1}},props:{name:{get:function(){return this.name_}},namePath:{get:function(){return this.namePath_}},index:{get:function(){return u.toInt(this.name_)}},copy:function(){var e,t;if(e=this.arrayValue)return new o(this.schemaType,this.namePath_,e.map((function(e){return e.copy()}),this),this.className);if(t=this.dictionaryValue){for(var n={},r=u.iter(t);!r.done;r.next()){var a=r.key,i=r.value;n[a]=i.copy()}return new o(this.schemaType,this.namePath_,n,this.className)}return new o(this.schemaType,this.namePath_,this.value_,this.className)},reroot:function(e){if(this.namePath_=e,this.isArray)for(var t=u.iter(u.toSequence(this.arrayValue_));!t.done;t.next()){var n=t.value,r=n.offset,o=n.element,a=e.append(u.toString(r));o.reroot(a)}else if(this.isDictionary&&null==this.className)for(var i=u.iter(this.dictionaryValue_);!i.done;i.next()){var s=i.key;o=i.value,a=e.append(s),o.reroot(a)}},prependNameToPath:function(e){this.namePath_=this.namePath_.prepend(e),null==this.className&&this.prependNameToChildPaths(e)},prependNameToChildPaths:function(e){if(null!=this.arrayValue_)for(var t=u.iter(this.arrayValue_);!t.done;t.next())t.value.prependNameToPath(e);else if(null!=this.dictionaryValue_)for(var n=u.iter(this.dictionaryValue_);!n.done;n.next())n.value.prependNameToPath(e)},value:{get:function(){return this.value_}},boolValue:{get:function(){return u.as(this.value_,"Bool")}},doubleValue:{get:function(){return u.as(this.value_,"Double")}},intValue:{get:function(){return u.as(this.value_,"Int")}},stringValue:{get:function(){return u.as(this.value_,"String")}},linkID:{get:function(){var e;return(e=u.as(this.value_,c.IDBLink))?e.referenceID:null}},objValue:{get:function(){var e;return(e=u.as(this.value_,c.IDBLink))?e.dereference():null}},isArray:{get:function(){return this.schemaType==h.DBSchemaType.ArrayType}},getArrayProperty:function(e){return this.arrayValue_[e]},arrayPropertyCount:{get:function(){var e;return(e=u.opt(this.arrayValue_,(function(e){return e.length})))||null!=e?e:0}},forEachArrayProperty:function(e){if(this.isArray)for(var t=u.iter(u.toSequence(this.arrayValue_));!t.done;t.next()){var n=t.value;e(n.offset,n.element)}},arrayValue:{get:function(){return this.isArray?this.arrayValue_:null}},isDictionary:{get:function(){return this.schemaType==h.DBSchemaType.ObjectType&&null!=this.dictionaryValue_}},getDictionaryProperty:function(e){return this.isDictionary?this.dictionaryValue_[e]:null},setDictionaryProperty:function(e,t){this.isDictionary&&(null!=t?this.dictionaryValue_[e]=t:u.removeKey(this.dictionaryValue_,e),this.value_=u.clone(this.dictionaryValue_))},forEachDictionaryProperty:function(e){if(this.isDictionary)for(var t=u.iter(this.dictionaryValue_);!t.done;t.next())e(t.key,t.value)},dictionaryValue:{get:function(){return this.isDictionary?this.dictionaryValue_:null}},isEqual:function(e){var t;if(t=u.as(e,o)){if(t===this)return!0;if(this.schemaType!=t.schemaType)return!1;switch(this.schemaType){case"string":return null!=this.stringValue&&null!=t.stringValue&&this.stringValue==t.stringValue;case"boolean":return null!=this.boolValue&&null!=t.boolValue&&this.boolValue==t.boolValue;case"integer":return null!=this.intValue&&null!=t.intValue&&this.intValue==t.intValue;case"number":return null!=this.doubleValue&&null!=t.doubleValue&&this.doubleValue==t.doubleValue;case"object":if(null!=this.objValue)return this.objValue===t.objValue;if(this.isDictionary&&t.isDictionary)return o.dictsEqual(this,t);break;case"array":return this.isArray&&t.isArray&&o.arraysEqual(this,t);case"unknown":return!1}}return!1}}}),o),l.DBDeletedProperty=(a=function(e){l.DBProperty.call(this,h.DBSchemaType.UnknownType,e,0,null)},u.defineClass({name:"DBDeletedProperty",ctor:a,superName:"DBProperty",props:{shouldWrite:{get:function(){return!1},set:function(e){}},copy:function(){return new a(this.namePath_)},boolValue:{get:function(){return null}},doubleValue:{get:function(){return null}},intValue:{get:function(){return null}},stringValue:{get:function(){return null}},objValue:{get:function(){return null}},arrayValue:{get:function(){return null}},dictionaryValue:{get:function(){return null}},isEqual:function(e){return e instanceof a}}}),a),l.DBPropertyCodec=(i=function(){},s={},u.defineClass({name:"DBPropertyCodec",ctor:i,statics:{registeredCodecs_:{},primitiveUpdater_:{get:function(){return void 0===s.primitiveUpdater_&&(s.primitiveUpdater_=function(e,t){return e.value_=t,e}),s.primitiveUpdater_}},codec:function(e,t,n){return i.init_a58a(e,t,n)},updatingCodec:function(e,t,n,r){return i.init_e208(e,t,n,r)},boolCodec:function(){var e;return i.init_e208((function(e,t,n){return l.DBProperty.boolProperty(e,t)}),(function(t,n){return!(!(e=u.opt(t,(function(e){return e.boolValue})))&&null==e)&&e}),i.primitiveUpdater_,"Bool")},intCodec:function(){var e;return i.init_e208((function(e,t,n){return l.DBProperty.intProperty(e,t)}),(function(t,n){return(e=u.opt(t,(function(e){return e.intValue})))||null!=e?e:0}),i.primitiveUpdater_,"Int")},doubleCodec:function(){var e;return i.init_e208((function(e,t,n){return l.DBProperty.doubleProperty(e,t)}),(function(t,n){return(e=u.opt(t,(function(e){return e.doubleValue})))||null!=e?e:NaN}),i.primitiveUpdater_,"Double")},stringCodec:function(){return i.init_e208((function(e,t,n){return l.DBProperty.stringProperty(e,t)}),(function(e,t){return u.opt(e,(function(e){return e.stringValue}))}),i.primitiveUpdater_,"String")},objectCodec:function(e){return void 0===e&&(e=null),i.init_a58a((function(t,n,r){return l.DBProperty.objProperty(t,n,e,u.opt(r,(function(e){return e.id})))}),(function(e,t){return u.opt(e,(function(e){return e.objValue}))}),"Link")},directObjectCodec:function(e){return i.init_a58a((function(e,t,n){var r,o=l.DBProperty.deleted(e);if(r=u.as(t,d.DBObject)){var a,i,s=u.clone(r.state.allProperties);if((a=h.DBSchema.currentSchema.rulesByName[r.state.className])&&(i=a.getRequiredProperties()))for(var c=u.iter(i);!c.done;c.next()){var m=c.value;f.LegacyCoreAssert.isTrue(u.keys(s).includes(m),"missing property encountered when encoding",{property:m,className:r.state.className},"DBPropertyCodec.directObjectCodec","DBProperty.swift",454)}o=l.DBProperty.dictEncoded(e,s,r.className),null!=n&&(r.isChildObject?f.LegacyCoreAssert.isFalse(r.state instanceof p.DBChildObjectState&&r.state.parentObject!==n,"Cannot reparent child objects. Clone the object before assigning to a new parent",void 0,"DBPropertyCodec.directObjectCodec","DBProperty.swift",466):n.addChildObject(r,e))}else f.LegacyCoreAssert.fail("Expected DBObject",{actual:t},"DBPropertyCodec.directObjectCodec","DBProperty.swift",472);return o}),(function(e,t){var n,r,o,a=null;return null!=(n=u.opt(e,(function(e){return e.className})))&&(r=u.as(t,d.DBObject))&&(o=u.opt(e,(function(e){return e.namePath})))&&(a=r.createChildObject(n,o)),a}),"Direct object")},arrayCodec:function(e){var t=this;return i.init_a58a((function(n,r,o){var a,i=l.DBProperty.deleted(n);if(a=u.as(r,["Array","Any"])){var s=u.toSequence(a).map((function(t){return e.encode(n.append(u.toString(t.offset)),t.element,o)}),t);i=l.DBProperty.arrayProperty(n,s)}else f.LegacyCoreAssert.fail("Expected an array",{actual:r},"DBPropertyCodec.arrayCodec","DBProperty.swift",497);return i}),(function(n,r){var o,a=null;return(o=u.opt(n,(function(e){return e.arrayValue})))&&(a=o.map((function(t){return e.decode(t,r)}),t).filter((function(e){return null!=e}),t).map((function(e){return e}),t)),a}),"Array")},tupleCodec:function(e){return i.init_a58a((function(t,n,r){var o,a=l.DBProperty.deleted(t);if(o=u.as(n,["Array","Any"])){for(var i=[],s=u.iter(u.range(0,o.length,!1));!s.done;s.next()){var c=s.value;c<e.length?i.push(e[c].encode(t.append(u.toString(c)),o[c],r)):i.push(u.last(e).encode(t.append(u.toString(c)),o[c],r))}a=l.DBProperty.arrayProperty(t,i)}else f.LegacyCoreAssert.fail("Expected an array",{actual:n},"DBPropertyCodec.tupleCodec","DBProperty.swift",529);return a}),(function(t,n){var r=null;return null!=t&&t.isArray&&(r=[],t.forEachArrayProperty((function(o,a){var i;o<e.length?null!=(i=e[o].decode(a,n))?r.push(i):f.LegacyCoreAssert.fail("Failed to decode array property",{property:t,index:o},"DBPropertyCodec.tupleCodec","DBProperty.swift",543):null!=(i=u.last(e).decode(a,n))?r.push(i):f.LegacyCoreAssert.fail("Failed to decode array property",{property:t,index:o},"DBPropertyCodec.tupleCodec","DBProperty.swift",549)}))),r}),"Tuple")},dictionaryCodec:function(e){var t=function(e,t,n){var r,o,a,i,s=l.DBProperty.deleted(e);return null!=(r=u.as(t,"Bool"))?s=l.DBProperty.boolProperty(e,r):null!=(o=u.as(t,"Int"))?s=l.DBProperty.intProperty(e,o):null!=(a=u.as(t,"Double"))?s=l.DBProperty.doubleProperty(e,a):null!=(i=u.as(t,"String"))&&(s=l.DBProperty.stringProperty(e,i)),s};return i.init_a58a((function(n,r,o){var a,i=l.DBProperty.deleted(n);if(a=u.as(r,["Dictionary","String","Any"])){for(var s={},c=u.iter(a);!c.done;c.next()){var d,h=c.key,p=c.value;(d=e[h])?s[h]=d.encode(n.append(h),p,o):s[h]=t(n.append(h),p)}i=l.DBProperty.dictProperty(n,s)}else f.LegacyCoreAssert.fail("Expected a dictionary",{actual:r},"DBPropertyCodec.dictionaryCodec","DBProperty.swift",588);return i}),(function(t,n){var r=null;return null!=t&&t.isDictionary&&(r={},t.forEachDictionaryProperty((function(t,o){var a;(a=e[t])?r[t]=a.decode(o,n):r[t]=function(e,t){var n;if(null!=(n=u.opt(e,(function(e){return e.schemaType}))))switch(n){case"boolean":return e.boolValue;case"integer":return e.intValue;case"number":return e.doubleValue;case"string":return e.stringValue;default:return null}return null}(o)}))),r}),"Dictionary")},registerCodec:function(e,t){return f.LegacyCoreAssert.isTrue(null==i.registeredCodecs_[e],"Duplicate codec registered",{typeName:e},"DBPropertyCodec.registerCodec","DBProperty.swift",629),i.registeredCodecs_[e]=t,i.registeredCodecs_[e]},typeCodec:function(e){return i.registeredCodecs_[e]}},props:{init_a58a:function(e,t,n){this.encode=e,this.decode=t,this.update=null,this.tag=n},init_e208:function(e,t,n,r){this.encode=e,this.decode=t,this.update=n,this.tag=r}}}),i)},dNOY:function(e,t,n){var r,o,a=t,i=n("oAGj"),s=n("90dd");a.InsertedContentChildrenMessage=(r=function e(t,n,r){this.index=n,this.children=i.clone(r),s.TheoMessage.call(this,e.TYPE,t)},i.defineClass({name:"InsertedContentChildrenMessage",ctor:r,superName:"TheoMessage",statics:{TYPE:{get:function(){return"InsertedContentChildrenMessage"}}}}),r),a.RemovedContentChildrenMessage=(o=function e(t,n,r){this.index=n,this.removed=i.clone(r),s.TheoMessage.call(this,e.TYPE,t)},i.defineClass({name:"RemovedContentChildrenMessage",ctor:o,superName:"TheoMessage",statics:{TYPE:{get:function(){return"RemovedContentChildrenMessage"}}}}),o)},"dX/e":function(e,t,n){var r,o,a=t,i=n("oAGj"),s=n("VQVe"),l=n("6ZWm"),u=n("7Pku"),c=n("w/+j"),d=n("Qlvz"),h=n("NkBu"),p=n("U010"),f=n("fdtz"),m=n("SDdr"),g=n("lmwz"),y=n("uWOl"),_=n("fNpk"),T=n("Ird5"),C=n("WjWV"),v=n("Iv44"),P=n("GDe9"),S=n("jfma"),A=n("ZTPx"),D=n("+ASD"),E=n("dmHI"),R=n("jfiy"),F=n("bauG"),I=n("jSYS"),b=n("vTQu"),O=n("yjxF"),k=n("dz2e"),M=n("Aj79"),N=n("sJQG"),L=n("44Iz"),x=n("JQ9Y"),B=n("g6aL"),w=n("zW52"),G=n("Zifs");a.ImageFormaToPGMMapper=(r=function e(){u.FormaToPGMMapper.call(this,e.FORMA_KIND)},o={},i.defineClass({name:"ImageFormaToPGMMapper",ctor:r,superName:"FormaToPGMMapper",statics:{FORMA_KIND:{get:function(){return void 0===o.FORMA_KIND&&(o.FORMA_KIND=f.ImageForma.KIND),o.FORMA_KIND}},instance:{get:function(){return void 0===o.instance&&(o.instance=new r),o.instance}},createMapper:function(e){return r.instance}},props:{canDoSimpleTransformUpdate:function(e){var t,n;return!((t=g.ImageFacade.getFrameFormaForForma(e.forma))&&(n=i.as(t.controller,l.FrameController))&&n.hasCutout)&&u.FormaToPGMMapper.prototype.canDoSimpleTransformUpdate.call(this,e)},getCutoutImageRef:function(e){var t,n,r,o,a;if((t=g.ImageFacade.getFrameFormaForForma(e))&&(n=i.as(t.controller,l.FrameController))&&(r=n.cutout)&&(o=r.bounds)&&null!=(a=r.contentID)){_.LegacyCoreAssert.isTrue(n.cutoutMode==p.CutoutMode.BackgroundRemoval,"Only BackgroundRemoval type is supported",void 0,"ImageFormaToPGMMapper.getCutoutImageRef","ImageFormaToPGMMapper.swift",55);var s=new F.PGMImage(r.formaID,new O.PGMNodeMetadata(r.formaID,"image"),T.PGMAnimationList.EMPTY,o,a);return new M.PGMReference(s,new S.PGMCompositingParams(r.placement,1))}return null},makePGMRef:function(e,t,n,r){var o,a,s;if((a=i.as(e,f.ImageForma))&&null!=(s=a.contentID)){var l;if(l=a.bounds){var u,d,h=new F.PGMImage(a.formaID,new O.PGMNodeMetadata(a.formaID,"image"),T.PGMAnimationList.EMPTY,l,s),p=new S.PGMCompositingParams(a.placement,a.style.opacity);if(d=this.getCutoutImageRef(a)){var m=new M.PGMReference(h,p);u=this.applyMask(m,d),p=S.PGMCompositingParams.DEFAULT}else u=h;var g=null,y=0;t==L.PGMExportSettings.DYNAMIC&&null!=a.animation&&(g=i.opt(a.animation,(function(e){return e.animationStyle.name})),y=(o=i.opt(a.animation,(function(e){return e.animationStyle.variant})))||null!=o?o:0);var C=this.applyFilters(g,y,a.style,u,h,a.controller),v=new M.PGMReference(C,p),P=c.FormaToPGMUtils.applyAnimations(t,e,v);return this.applyStillAnimations(e,P)}return _.LegacyCoreAssert.fail("ImageFormaToPGMMapper: image is missing bounds or content ID",void 0,"ImageFormaToPGMMapper.makePGMRef","ImageFormaToPGMMapper.swift",159),null}return _.LegacyCoreAssert.fail("ImageFormaToPGMMapper called for something that's not an ImageForma",void 0,"ImageFormaToPGMMapper.makePGMRef","ImageFormaToPGMMapper.swift",164),null},applyFilters:function(e,t,n,r,o,a){var l,u,c,p=r,m=!0;if((l=i.as(a,h.ImageController))&&(u=i.as(l.forma,f.ImageForma))&&(m=!(l.floating||u.hasAlpha())),c=i.as(n,y.ImageStyle)){var g,_=!1;if(g=c.adjustments){var T=d.ImageAdjustments.createDefault();_=g.blur!=T.blur,g.sharpness!=T.sharpness&&(p=this.applySharpen(g,p,o,m)),p=this.applyColorAdjustments(g,p)}var v=p;if(p=this.applyStyleEffects(c,p,o,m),e==s.AnimationStyle.NAME_GRAYSCALE){var P=c.colors,S=i.opt(i.opt(P.library,(function(e){return e.color("themeDerivedDark")})),(function(e){return e.rgbColor}))||G.SolidColor.BLACK,A=i.opt(i.opt(P.library,(function(e){return e.color("themeDerivedLight")})),(function(e){return e.rgbColor}))||G.SolidColor.WHITE,E=this.wrapInFilter([v],"Greyscale",new D.PGMDuotoneFilterSpec(S,A,1));p=this.wrapInFilter([p,E],"AnimationBlend",new C.PGMBlendFilterSpec([0,1]))}else if(e==s.AnimationStyle.NAME_FILL){var F=G.SolidColor.BLACK;(b=i.as(a,h.ImageController))&&(O=i.as(b.forma,f.ImageForma))&&(M=i.clone(O.page.colorLibraryController.getThemeColorKeys())).length>t&&(F=O.page.colorLibraryController.getSolidColorForKey(i.as(M[t],"String"))||G.SolidColor.BLACK);var I=this.wrapInFilter([v],s.AnimationStyle.NAME_FILL,new R.PGMFillFilterSpec(F));p=this.wrapInFilter([p,I],"AnimationBlend",new C.PGMBlendFilterSpec([0,1]))}else if(e==s.AnimationStyle.NAME_COLOR){var b,O,M,N=G.SolidColor.BLACK;(b=i.as(a,h.ImageController))&&(O=i.as(b.forma,f.ImageForma))&&(M=i.clone(O.page.colorLibraryController.getThemeColorKeys())).length>t&&(N=O.page.colorLibraryController.getSolidColorForKey(i.as(M[t],"String"))||G.SolidColor.BLACK);var L=this.wrapInFilter([v],s.AnimationStyle.NAME_COLOR,new k.PGMOverlayFilterSpec(N));p=this.wrapInFilter([p,L],"AnimationBlend",new C.PGMBlendFilterSpec([1,0]))}_&&(p=this.applyBlur(c.adjustments.scaledBlur,p,o,m)),e==s.AnimationStyle.NAME_BLUR&&(p=this.applyBlur(0,p,o,m))}return p},getRootAnimation:function(e){for(var t=e;null!=t.parent;)t=t.parent;return t.animation},applyStillAnimations:function(e,t){var n;if(n=e.animation){var r,o,a=n.animationStyle;if((a.name==s.AnimationStyle.NAME_ZOOM||a.name==s.AnimationStyle.NAME_PAN)&&(r=this.getRootAnimation(e))&&n.endTime.earlierThan(r.endTime)&&(o=i.as(t.animations.animations.find((function(e){return e instanceof w.PGMTransformAnimation&&e.timeFn.domain.contains(a.endTime.seconds)}),this),w.PGMTransformAnimation))){var l=new N.PGMRange(a.endTime.seconds,r.endTime.seconds),u=new I.PGMLinearFunction(l,new N.PGMRange(1,1)),c=new w.PGMTransformAnimation(u,o.endXBounds,o.endXBounds),d=t.animations.append(c);return t.withAnimations(d)}}return t},applyMask:function(e,t){return this.wrapRefsInFilter([e,t],"CutoutMask",new b.PGMMaskFilterSpec)},applySharpen:function(e,t,n,r){var o=t,a=e.scaledSharpness/4,i=o;return o=this.wrapInFilter([i],"Blur",new v.PGMBlurFilterSpec(r,a,n.entity)),o=this.wrapInFilter([i,o],"Sharpen_mixback",new C.PGMBlendFilterSpec([1.5,-.5]))},applyBlur:function(e,t,n,r){var o=t;return o=this.wrapInFilter([o],"Blur",new v.PGMBlurFilterSpec(r,e,n.entity))},applyColorAdjustments:function(e,t){var n=t,r=d.ImageAdjustments.createDefault(),o=e.copyWithNewValues(r.blur,r.sharpness);return o.equals(r)||(n=this.wrapInFilter([n],"ColorAdjustment",new P.PGMColorAdjustmentFilterSpec(o.shadows,o.highlights,o.saturation,o.brightness,o.exposure,o.contrast,o.warmth,o.tint,o.fade,o.vibrance))),n},applyStyleEffects:function(e,t,n,r){var o,a=t;if(o=i.as(e.filter,m.CompositeFilter)){var s,l;if(1!=o.contrast?a=this.wrapInFilter([a],o.name+"_contrast",A.PGMColorTransformFilterSpec.createContrastTransform(o.contrast)):o.grayscale&&(a=this.wrapInFilter([a],o.name,new D.PGMDuotoneFilterSpec(G.SolidColor.BLACK,G.SolidColor.WHITE,1))),(s=o.colors)&&(l=s.fieldPrimary))switch(o.blend){case"normal":var u;a=(u=s.fieldSecondary)?this.wrapInFilter([a],o.name,new D.PGMDuotoneFilterSpec(l,u,1)):this.wrapInFilter([a],o.name,new R.PGMFillFilterSpec(l));break;case"overlay":a=this.wrapInFilter([a],o.name+"_overlay",new k.PGMOverlayFilterSpec(l));break;case"screen":a=this.wrapInFilter([a],o.name,new x.PGMScreenFilterSpec(l));break;case"multiply":a=this.wrapInFilter([a],o.name,A.PGMColorTransformFilterSpec.createColorizeTransform(l))}if(o.blurRadius>.05&&(a=this.wrapInFilter([a],o.name,new v.PGMBlurFilterSpec(r,o.blurRadius,n.entity))),1!=o.mix){var c=new B.PGMSimpleGroup(a.entity+"-mix-filtered",new O.PGMNodeMetadata(a.meta.id,"filter-"+o.name+"-mix-opacity"),T.PGMAnimationList.EMPTY,[new M.PGMReference(a)]),d=new M.PGMReference(c,S.PGMCompositingParams.DEFAULT.withOpacity(o.mix),T.PGMAnimationList.EMPTY);a=new B.PGMSimpleGroup(a.entity+"-mix",new O.PGMNodeMetadata(a.meta.id,"filter-"+o.name+"-mix"),T.PGMAnimationList.EMPTY,[new M.PGMReference(t),d])}}return a},wrapInFilter:function(e,t,n){var r=e.map((function(e){return new M.PGMReference(e)}),this);return this.wrapRefsInFilter(r,t,n)},wrapRefsInFilter:function(e,t,n){var r=e[0].child.entity+"-"+t,o=new O.PGMNodeMetadata(e[0].child.meta.id,"filter-"+t),a=T.PGMAnimationList.EMPTY;return new E.PGMFilter(r,o,a,e,n)}}}),r)},djAF:function(e,t,n){var r,o=t,a=n("oAGj"),i=n("ascj"),s=n("FNB+"),l=n("fWxZ"),u=n("P83h"),c=n("pnSN"),d=n("iCxV"),h=n("fNpk"),p=n("tGKA"),f=n("VkKB"),m=n("JO5d"),g=n("Zifs"),y=n("fiuZ"),_=n("35Q0"),T=n("u2iI"),C=n("byfQ"),v=n("9YN4"),P=n("Q+4n"),S=n("8t9B"),A=n("hgLm"),D=n("sIWg"),E=n("1NAc"),R=n("LGJg");o.ShapeForma=(r=function(){this.relativeScale_=1,this.cachedMaskImage_=null},a.defineClass({name:"ShapeForma",ctor:r,superName:"Forma",statics:{KIND:{get:function(){return"Shape"}},PROPERTY_ARTWORK:"artwork",PROPERTY_CONTENTID:"content-id",PROPERTY_SHAPELIBRARYID:"shape-id",PROPERTY_SIZE:"size",PROPERTY_SLICE_BOX:"slice-box",PROPERTY_PRESCALE:"prescale",PROPERTY_LEGACY_RENDER:"legacy-render",PROPERTY_SHAPE_STYLE_DEPRECATED:"style",PROPERTY_CONTENT_REGION:"content-region",PROPERTY_TEXT_BOX:"text-box",SCHEMA_CLASS_NAME:{get:function(){return"ShapeForma"}},factory:{get:function(){return function(e,t,n,o){if(null!=t){var i=a.as(a.opt(a.opt(o,(function(e){return e.backLink})),(function(e){return e.dereference()})),c.GroupForma),s=a.as(a.opt(a.opt(o,(function(e){return e.backLink})),(function(e){return e.dereference()})),l.FormaPage);return h.LegacyCoreAssert.isTrue(null!=i||null!=s,"ShapeForma needs a parent group or page",void 0,"ShapeForma","ShapeForma.swift",33),null!=i?r.init_3144(e,t,n,i):r.init_7dbd(e,t,n,s)}return r.init_d1c9(e,n)}}},_implements:function(e){return"IDBObject"==e||"TheoMessageSubscriber"==e||"TheoMessagePublisher"==e}},props:{init_3144:function(e,t,n,o){var i;a.super_init(this,s.Forma,s.Forma.prototype.init_3144,e,t,n,o),null!=this.shapeLibraryID&&(_.ShapeLibrary.applyToShapeForma(this,this.shapeLibraryID),(i=this.getProperty(r.PROPERTY_ARTWORK))&&(i.shouldWrite=!1,this.setProperty(r.PROPERTY_ARTWORK,i)))},init_7dbd:function(e,t,n,o){var i;a.super_init(this,s.Forma,s.Forma.prototype.init_7dbd,e,t,n,o),null!=this.shapeLibraryID&&(_.ShapeLibrary.applyToShapeForma(this,this.shapeLibraryID),(i=this.getProperty(r.PROPERTY_ARTWORK))&&(i.shouldWrite=!1,this.setProperty(r.PROPERTY_ARTWORK,i)))},init_812f:function(e,t){for(var n={kind:function(){return r.KIND},style:function(){return T.ShapeStyle.createDefault()},size:function(){return new E.TheoSize(1,1)},"legacy-render":function(){return!1}},o=a.clone(t),i=a.iter(n);!i.done;i.next()){var l=i.key,u=i.value;null==t[l]&&(o[l]=u())}a.super_init(this,s.Forma,s.Forma.prototype.init_812f,e,o)},init_d1c9:function(e,t){var n;a.super_init(this,s.Forma,s.Forma.prototype.init_d1c9,e,t),null!=this.shapeLibraryID&&(_.ShapeLibrary.applyToShapeForma(this,this.shapeLibraryID),(n=this.getProperty(r.PROPERTY_ARTWORK))&&(n.shouldWrite=!1,this.setProperty(r.PROPERTY_ARTWORK,n)))},init_7186:function(e){var t={kind:r.KIND,style:T.ShapeStyle.createDefault(),size:new E.TheoSize(1,1),"legacy-render":!1};this.init_812f(e,t)},postDecode:function(){var e;if(s.Forma.prototype.postDecode.call(this),this.isGridCell()&&null==this.getProperty(s.Forma.PROPERTY_INTENT)&&this.set(s.Forma.PROPERTY_INTENT,s.Forma.INTENT_GRID_CELL),((e=a.opt(this.page.document,(function(e){return e.versionDecoded.vers})))||null!=e?e:0)<v.TheoDocumentVersion.BasicShapes){var t=this.style.colors.fieldPrimary;a.eq(g._equality_SolidColor_SolidColor,t,this.style.colors.fieldSecondary)||this.style.colors.setColor(i.ColorRole.FieldSecondary,t),this.legacyRender=!0}},className:{get:function(){return r.SCHEMA_CLASS_NAME}},updateEventForProperty:function(e){return e==r.PROPERTY_ARTWORK?new u.FormaContentChangedEvent(this):e==r.PROPERTY_PRESCALE?new u.FormaGeometryChangedEvent(this):e==r.PROPERTY_SLICE_BOX||e==r.PROPERTY_CONTENT_REGION?new u.FormaContentChangedEvent(this):e==r.PROPERTY_SIZE?new u.FormaGeometryChangedEvent(this):e==r.PROPERTY_CONTENTID||e==r.PROPERTY_SHAPELIBRARYID?new u.FormaContentChangedEvent(this):s.Forma.prototype.updateEventForProperty.call(this,e)},didChangeState:function(e){null==e[r.PROPERTY_ARTWORK]&&null==e[r.PROPERTY_PRESCALE]&&null==e[r.PROPERTY_SLICE_BOX]&&null==e[r.PROPERTY_SIZE]||(this.artworkSized_=null),s.Forma.prototype.didChangeState.call(this,e)},match:function(e){var t,n,o;if(s.Forma.prototype.match.call(this,e),t=a.as(e,r)){var l=new u.FormaGeometryChangedEvent(this);this.beginUpdate(l),this.artwork_=t.canonicalArtwork.clone(),this.preScale=t.preScale,this.sliceBox=t.sliceBox,this.contentRegion=t.contentRegion,this.size=t.size,this.legacyRender=t.legacyRender,this.endUpdate(l)}(n=a.as(e.controller,S.TypeLockupController))&&null!=(o=a.opt(n.lockupStyle,(function(e){return e.textBacked})))&&o&&this.style.colors.setColorId(i.ColorRole.FieldPrimary,e.style.colors.colorID(i.ColorRole.FieldSecondary))},artwork_:{get:function(){var e,t=new A.TheoRectanglePath(D.TheoRect.fromSize(this.size||new E.TheoSize(1,1)));return(e=a.as(this.get(r.PROPERTY_ARTWORK),C.TheoArtworkNode))||null!=e?e:C.TheoArtworkShape.init_9312(null,[t])},set:function(e){this.set(r.PROPERTY_ARTWORK,e)}},canonicalArtwork:{get:function(){return this.artwork_},set:function(e){var t=new u.FormaContentChangedEvent(this);this.beginUpdate(t),this.artwork_=e,this.artworkSized_=null,this.endUpdate(t)}},preScale:{get:function(){return a.as(this.get(r.PROPERTY_PRESCALE),"Double")},set:function(e){if(e!=this.preScale){var t=new u.FormaGeometryChangedEvent(this);this.beginUpdate(t),this.set(r.PROPERTY_PRESCALE,e),this.artworkSized_=null,this.endUpdate(t)}}},legacyRender:{get:function(){return this.get(r.PROPERTY_LEGACY_RENDER)},set:function(e){this.set(r.PROPERTY_LEGACY_RENDER,e)}},sizedArtwork:{get:function(){if(null==this.artworkSized_){var e,t,n,r;if(e=this.artwork_.bounds){var o;o=null!=this.preScale&&isFinite(this.preScale)?this.preScale:Math.min(this.size.width/e.width,this.size.height/e.height),o*=this.relativeScale_;var i=this.strokeInsetAdjustmentFromBase(),s=y.ShapeFacade.getCornerOrInitialPrescaleForForma(this);i=i.multiply(s);var l=this.size.expandXY(i.left+i.right,i.top+i.bottom),u=D.TheoRect.fromSize(l);this.artworkSized_=this.artwork_.applySlicing(e,u,this.sliceBox,o,!0)}else a.opt(d.Host.logging,(function(e){return e.warning("No bounds obtained from artwork")}));if(this.intent==f.MediaMetadata.DESIGNINTENT_ICON&&(t=this.artworkSized_)&&(n=t.bounds)&&(this.artworkSized_=t.applyTransform(p.Matrix2D.translation(n.origin.invert()))),r=a.as(this.controller,m.ShapeController)){var c=r.currentStrokeWeightMultiplier;1!=c&&(this.artworkSized_=this.artworkSized_.applyStrokeWidthMultiplier(c))}}return this.artworkSized_}},sliceBox:{get:function(){return a.as(this.get(r.PROPERTY_SLICE_BOX),D.TheoRect)},set:function(e){var t=new u.FormaContentChangedEvent(this);this.beginUpdate(t),this.set(r.PROPERTY_SLICE_BOX,e),this.artworkSized_=null,this.endUpdate(t)}},relativeScale:{get:function(){return this.relativeScale_},set:function(e){var t=new u.FormaContentChangedEvent(this);this.beginUpdate(t),this.relativeScale_=e,this.artworkSized_=null,this.endUpdate(t)}},contentRegion:{get:function(){return a.as(this.get(r.PROPERTY_CONTENT_REGION),D.TheoRect)},set:function(e){var t=new u.FormaContentChangedEvent(this);this.beginUpdate(t),this.set(r.PROPERTY_CONTENT_REGION,e),this.endUpdate(t)}},size:{get:function(){return a.as(this.get(r.PROPERTY_SIZE),E.TheoSize)},set:function(e){if(this.size!=e){var t=new u.FormaGeometryChangedEvent(this);this.beginUpdate(t),this.set(r.PROPERTY_SIZE,e),this.artworkSized_=null,this.endUpdate(t)}}},bounds:{get:function(){return this.boundsInCoordSpace(p.Matrix2D.Identity)},set:function(e){var t;if(t=e){if(this.size.equal(t.size))return;this.size=t.size}else h.LegacyCoreAssert.fail("shouldnt be setting nil bounds for a shape",void 0,"ShapeForma","ShapeForma.swift",359)}},boundsInCoordSpace:function(e){var t;if(t=this.calcBounds()){var n=this.strokeInsetAdjustmentFromBase(),r=y.ShapeFacade.getCornerOrInitialPrescaleForForma(this);return n=n.multiply(r),(t=t.offsetXY(n.left,n.top)).transform(e)}return null},calcBounds:function(){var e;return(e=this.size)?D.TheoRect.fromSize(e):null},strokeInsetAdjustmentFromBase:function(){var e;if(e=a.as(this.controller,m.ShapeController)){var t,n,r=e.currentStrokeWeightMultiplier;if(1!=r&&(t=this.artwork_.bounds)&&(n=this.artwork_.getBoundsWithMultiplier(r))){var o=n.minY-t.minY,i=n.minX-t.minX,s=t.maxY-n.maxY,l=t.maxX-n.maxX;return this.isVerticalLine()?(o=0,s=0):this.isHorizontalLine()&&(i=0,l=0),new P.TheoInsets(o,i,s,l)}}return P.TheoInsets.Zero},contentID:{get:function(){return a.as(this.get(r.PROPERTY_CONTENTID),"String")},set:function(e){if(e!=this.contentID){var t=new u.FormaContentChangedEvent(this);this.beginUpdate(t),this.set(r.PROPERTY_CONTENTID,e),this.endUpdate(t)}}},contentNode:{get:function(){var e=this;return null==this.contentID?null:a.opt(this.page.document,(function(t){return t.content.nodeByID(e.contentID)}))},set:function(e){this.contentID=null==e?null:e.id}},shapeLibraryID:{get:function(){return a.as(this.get(r.PROPERTY_SHAPELIBRARYID),"String")},set:function(e){if(e!=this.shapeLibraryID){var t,n=new u.FormaContentChangedEvent(this);this.beginUpdate(n),this.set(r.PROPERTY_SHAPELIBRARYID,e),(t=this.getProperty(r.PROPERTY_ARTWORK))&&(t.shouldWrite=!1,this.setProperty(r.PROPERTY_ARTWORK,t)),this.endUpdate(n)}}},isGraphic:function(){return!0},isShape:function(){return!0},isLine:function(){return this.isHorizontalLine()||this.isVerticalLine()},isVerticalLine:function(){var e,t,n;return!!((e=a.as(this.style,T.ShapeStyle))&&(t=a.as(this.canonicalArtwork,C.TheoArtworkShape))&&(n=t.bounds)&&n.width==e.strokeBaseWeight)},isHorizontalLine:function(){var e,t,n;return!!((e=a.as(this.style,T.ShapeStyle))&&(t=a.as(this.canonicalArtwork,C.TheoArtworkShape))&&(n=t.bounds)&&n.height==e.strokeBaseWeight)},maskImage:{get:function(){if(null==this.cachedMaskImage_){var e=this.persisted?this.database.beginTransaction("cache_mask",null):null;d.Host.imageAnalysis.setShapeFormaTransparencyMask(this,25),a.opt(e,(function(e){return e.rollback()}))}return this.cachedMaskImage_},set:function(e){this.cachedMaskImage_=e}},getAverageAlpha:function(e){if(this.isGridCell())return 1;var t,n,r=e.transform(this.totalPlacement.inverse);if(this.contentNode instanceof R.VectorContentNode&&(t=this.maskImage)&&(n=this.bounds)){var o,i=a.toDouble(t.cols)/a.toDouble(n.width),s=a.toDouble(t.rows)/a.toDouble(n.height),l=r.multiplyXY(i,s).rounded();if(o=l.intersectionWith(new D.TheoRect(0,0,t.size.width,t.size.height)))return t.sumRegion(o)/l.area}return 1},removeArtworkSized:function(){var e=new u.FormaPathChangedEvent(this);this.beginUpdate(e),this.artworkSized_=null,this.endUpdate(e)}}}),r)},enh0:function(e,t,n){var r,o=t,a=n("oAGj"),i=n("SpAV"),s=n("ascj"),l=n("FNB+"),u=n("QgZx"),c=n("fWxZ"),d=n("P83h"),h=n("pnSN"),p=n("53P9"),f=n("iCxV"),m=n("fNpk"),g=n("cEEQ"),y=n("c+uM"),_=n("Zifs"),T=n("a9ow"),C=n("9YN4"),v=n("8t9B"),P=n("3UhB"),S=n("x4Gy"),A=n("oKlP"),D=n("uUew"),E=n("sIWg"),R=n("LCGV");o.TextForma=(r=function(){this.renderRuns=new S.RenderRuns,this.graphemeCount_=-1,this.cachedText_=null,this.cachedFont_=null,this.cachedSize_=null,this.cachedColor_=null,this.cachedStrokeColor_=null,this.cachedStrokeWidth_=null,this.cachedTextLook_=null,this.cachedTracking_=null},a.defineClass({name:"TextForma",ctor:r,superName:"Forma",statics:{KIND:{get:function(){return"Text"}},PROPERTY_SIZE:"size",PROPERTY_TEXT:"text",PROPERTY_TEXT_STYLE:"text-style",PROPERTY_FILLCOLOR_DEPRECATED:"fill-color",PROPERTY_RANGEINLOCKUP:"range-in-lockup",PROPERTY_ROWINDEX:"row-index",SCHEMA_CLASS_NAME:{get:function(){return"TextForma"}},factory:{get:function(){return function(e,t,n,o){if(null!=t){var i=a.as(a.opt(a.opt(o,(function(e){return e.backLink})),(function(e){return e.dereference()})),h.GroupForma),s=a.as(a.opt(a.opt(o,(function(e){return e.backLink})),(function(e){return e.dereference()})),c.FormaPage);return m.LegacyCoreAssert.isTrue(null!=i||null!=s,"TextForma needs a parent group or page",void 0,"TextForma","TextForma.swift",26),null!=i?r.init_3144(e,t,n,i):r.init_7dbd(e,t,n,s)}return r.init_d1c9(e,n)}}},STROKEWIDTH_ZERO:0,TRACKING_ZERO:0,_implements:function(e){return"IDBObject"==e||"TheoMessageSubscriber"==e||"TheoMessagePublisher"==e}},props:{init_3144:function(e,t,n,r){a.super_init(this,l.Forma,l.Forma.prototype.init_3144,e,t,n,r)},init_7dbd:function(e,t,n,r){a.super_init(this,l.Forma,l.Forma.prototype.init_7dbd,e,t,n,r)},init_812f:function(e,t){for(var n={kind:function(){return r.KIND},style:function(){return R.TextStyle.createDefault()},text:function(){return S.TextModel.init_d41d()}},o=a.clone(t),i=a.iter(n);!i.done;i.next()){var s=i.key,u=i.value;null==t[s]&&(o[s]=u())}a.super_init(this,l.Forma,l.Forma.prototype.init_812f,e,o)},init_7186:function(e){var t={kind:r.KIND,style:R.TextStyle.createDefault(),text:S.TextModel.init_d41d()};this.init_812f(e,t)},init_d1c9:function(e,t){a.super_init(this,l.Forma,l.Forma.prototype.init_d1c9,e,t)},className:{get:function(){return r.SCHEMA_CLASS_NAME}},didChangeState:function(e){a.count(e)>0&&(this.cachedBounds_=null,this.cachedSize_=null),a.keys(e).includes(r.PROPERTY_TEXT)&&(this.cachedText_=null,this.graphemeCount_=-1,this.cachedFont_=null,this.cachedSize_=null,this.cachedColor_=null,this.cachedStrokeColor_=null,this.cachedStrokeWidth_=null,this.cachedTextLook_=null,this.cachedTracking_=null),l.Forma.prototype.didChangeState.call(this,e)},clearCache:function(){l.Forma.prototype.clearCache.call(this),this.renderRuns.clear()},updateEventForProperty:function(e){return e==r.PROPERTY_TEXT?new d.FormaGeometryChangedEvent(this):l.Forma.prototype.updateEventForProperty.call(this,e)},postDecode:function(){var e,t,n,r,o;if(l.Forma.prototype.postDecode.call(this),(t=a.opt(this.model_.getProperty(S.TextModel.PROPERTY_FONT_NAME),(function(e){return e.arrayValue})))&&(n=a.opt(a.first(t),(function(e){return e.dictionaryValue})))&&(r=a.opt(n[T.TextAttribute.PROPERTY_VALUE],(function(e){return e.dictionaryValue})))&&null!=(o=a.opt(r[u.FontDescriptor.PROPERTY_POSTSCRIPT_NAME],(function(e){return e.stringValue})))){var i=this.fontDescriptor;i.postScriptName==o&&i.availability==u.FontAvailability.LOADED||a.opt(this.page.document,(function(e){return e.recordMissingFont(o)}))}var c,d,h=(e=a.opt(this.page.document,(function(e){return e.versionDecoded.vers})))||null!=e?e:0;if(h<C.TheoDocumentVersion.Grouping){var p=this.fontColor;a.eq(_._equality_SolidColor_SolidColor,p,this.style.colors.fieldPrimary)||this.style.colors.setColor(s.ColorRole.FieldPrimary,p)}h<=C.TheoDocumentVersion.FourColorsAndOpacities&&(c=this.lockupStyle)&&(d=c.colors.fieldPrimary)&&!a.eq(_._equality_SolidColor_SolidColor,this.style.colors.fieldPrimary,d)&&(p=this.fontColor,this.textLook==y.LockupTextLook.FillAndOutline2?this.style.colors.setColor(s.ColorRole.FieldSecondary,p):y.LockupStyle.isShadowLook(this.textLook)&&this.style.colors.setColor(s.ColorRole.Shadow,p))},model_:{get:function(){return this.get(r.PROPERTY_TEXT)},set:function(e){this.set(r.PROPERTY_TEXT,e)}},textStyle:{get:function(){return a.as(this.get(r.PROPERTY_TEXT_STYLE),R.TextStyle)},set:function(e){this.set(r.PROPERTY_TEXT_STYLE,e)}},rangeInLockup_:{get:function(){var e;return(e=a.as(this.get(r.PROPERTY_RANGEINLOCKUP),D.TextRange))||null!=e?e:new D.TextRange(0,0)},set:function(e){this.set(r.PROPERTY_RANGEINLOCKUP,e)}},rowIndex_:{get:function(){var e;return(e=a.as(this.get(r.PROPERTY_ROWINDEX),"Int"))||null!=e?e:0},set:function(e){this.set(r.PROPERTY_ROWINDEX,e)}},graphemeCount:{get:function(){return-1==this.graphemeCount_&&(this.graphemeCount_=p.GraphemeUtils.countGraphemes(this.model_.text)),this.graphemeCount_}},isText:function(){return!0},boundsInCoordSpace:function(e){if(0==this.text.length)return E.TheoRect.Zero;if(null==this.cachedBounds_){var t=this.fontStrokeWidth;this.cachedBounds_=f.Host.textModelUtils.measureBoundsForLayout(this.text,this.fontDescriptor,this.fontSize,this.tracking),t!=r.STROKEWIDTH_ZERO&&(this.cachedBounds_=this.cachedBounds_.insetXY(-t/2,-t/2))}return this.cachedBounds_.transform(e)},baselineBoundsInCoordSpace:function(e){return 0==this.text.length?E.TheoRect.Zero:f.Host.textModelUtils.measureBaselineBounds(this.text,this.fontDescriptor,this.fontSize,this.tracking).transform(e)},setTextProperties:function(e,t,n,r,o,l,u,c,h,p,f){var m=new d.FormaGeometryChangedEvent(this);this.beginUpdate(m);var g=this.model_;null!=this.cachedText_&&e==this.cachedText_||(g.text=e,this.cachedText_=e,this.graphemeCount_=-1),g.setAttr(t,S.TextModel.PROPERTY_FONT_NAME),g.setAttr(n,S.TextModel.PROPERTY_FONT_SIZE),g.setAttr(r,S.TextModel.PROPERTY_FONT_COLOR),g.setAttr(o,S.TextModel.PROPERTY_FONT_STROKE_COLOR),g.setAttr(l,S.TextModel.PROPERTY_FONT_STROKE_WIDTH),g.setAttr(u,S.TextModel.PROPERTY_TEXT_LOOK),g.setAttr(c,S.TextModel.PROPERTY_TRACKING),this.cachedFont_=null,this.cachedSize_=null,this.cachedColor_=null,this.cachedStrokeColor_=null,this.cachedStrokeWidth_=null,this.cachedTextLook_=null,this.cachedTracking_=null,this.cachedBounds_=null,this.rangeInLockup_=h,this.rowIndex_=p;var T=this.fontColor;i.CoreAssertDebugOnly.isTrue(f==s.ColorRole.FieldPrimary||f==s.ColorRole.FieldSecondary||f==s.ColorRole.Shadow,"we currently only use primary, secondary or shadow as roles for textForma items",void 0,"TextForma.setTextProperties","TextForma.swift",263),i.CoreAssertDebugOnly.isTrue(f==s.ColorRole.FieldSecondary&&u==y.LockupTextLook.FillAndOutline2||f!=s.ColorRole.FieldSecondary,"currently colorRole secondary is only used for puffy text",void 0,"TextForma.setTextProperties","TextForma.swift",264),f!=s.ColorRole.FieldSecondary&&null!=this.style.colors.fieldSecondary&&this.style.colors.setColor(s.ColorRole.FieldSecondary,null),f!=s.ColorRole.Shadow&&null!=this.style.colors.shadow&&this.style.colors.setColor(s.ColorRole.Shadow,null),f!=s.ColorRole.FieldPrimary&&this.style.colors.setColor(f,T),a.eq(_._equality_SolidColor_SolidColor,this.style.colors.fieldPrimary,T)||this.style.colors.setColor(s.ColorRole.FieldPrimary,T),this.endUpdate(m)},clearTextFormaText:function(){var e=new d.FormaGeometryChangedEvent(this);this.beginUpdate(e);var t=this.model_;null!=this.cachedText_&&this.text==this.cachedText_||(t.text="",this.cachedText_="",this.graphemeCount_=-1),this.endUpdate(e)},text:{get:function(){var e;return null!=(e=this.cachedText_)?e:(this.cachedText_=this.model_.text,this.cachedText_)}},fontDescriptor:{get:function(){var e;return(e=this.cachedFont_)?e:(this.cachedFont_=a.opt(this.model_.fontName,(function(e){return e.value}))||a.opt(a.opt(this.lockupStyle,(function(e){return e.font})),(function(e){return e.fontData})),m.LegacyCoreAssert.isTrue(null!=this.cachedFont_,"Why isn't there a font set?",void 0,"TextForma","TextForma.swift",313),this.cachedFont_||S.TextModel.defaultFontName.value)}},fontSize:{get:function(){var e,t;return null!=(t=this.cachedSize_)?t:(this.cachedSize_=a.opt(this.model_.fontSize,(function(e){return e.value})),m.LegacyCoreAssert.isTrue(null!=this.cachedSize_,"Why isn't there a size set in the model?",void 0,"TextForma","TextForma.swift",323),(e=this.cachedSize_)||null!=e?e:S.TextModel.defaultFontSize.value)}},fontColor:{get:function(){var e;return(e=this.cachedColor_)?e:(this.cachedColor_=a.opt(this.model_.fontColor,(function(e){return e.value}))||a.opt(this.lockupStyle,(function(e){return e.colors.fieldPrimary})),m.LegacyCoreAssert.isTrue(null!=this.cachedColor_,"Why isn't there a color set?",void 0,"TextForma","TextForma.swift",333),this.cachedColor_||S.TextModel.defaultFontColor.value)}},fontStrokeColor:{get:function(){var e;return(e=this.cachedStrokeColor_)?e:(this.cachedStrokeColor_=a.opt(this.model_.fontStrokeColor,(function(e){return e.value}))||a.opt(this.lockupStyle,(function(e){return e.colors.fieldSecondary})),m.LegacyCoreAssert.isTrue(null!=this.cachedStrokeColor_,"Why isn't there a color set?",void 0,"TextForma","TextForma.swift",343),this.cachedStrokeColor_||S.TextModel.defaultFontStrokeColor.value)}},textLook:{get:function(){var e,t,n;return null!=(t=this.cachedTextLook_)?t:(null!=(n=a.opt(this.model_.textLook,(function(e){return e.value})))&&(this.cachedTextLook_=y.LockupTextLook.toCaseValue(n)),this.cachedTextLook_=(e=this.cachedTextLook_)||null!=e?e:y.LockupTextLook.Fill,this.cachedTextLook_)}},fontStrokeWidth:{get:function(){var e,t;return null!=(t=this.cachedStrokeWidth_)?t:(this.cachedStrokeWidth_=(e=a.opt(this.model_.fontStrokeWidth,(function(e){return e.value})))||null!=e?e:r.STROKEWIDTH_ZERO,this.cachedStrokeWidth_)}},tracking:{get:function(){var e,t;return null!=(t=this.cachedTracking_)?t:(this.cachedTracking_=(e=a.opt(this.model_.tracking,(function(e){return e.value})))||null!=e?e:r.TRACKING_ZERO,this.cachedTracking_)}},rangeInLockup:{get:function(){return this.rangeInLockup_}},lockupForma:{get:function(){var e=function(e){return e.visit(l.FormaTraversal.NearestAncestor,(function(e,t,n){var r;return!!(r=e.controller)&&r instanceof v.TypeLockupController}))};return m.LegacyCoreAssert.isTrue(e(this)==a.opt(a.opt(this.parent,(function(e){return e.parent})),(function(e){return e.parent})),"Unexpected number of nodes between text forma and lockup forma",void 0,"TextForma","TextForma.swift",391),a.as(e(this),h.GroupForma)}},lockupStyle:{get:function(){return a.as(a.opt(this.lockupForma,(function(e){return e.style})),y.LockupStyle)}},isRangeStart:function(){var e,t=this.text.includes("");if(e=a.as(a.opt(this.lockupForma,(function(e){return e.controller})),v.TypeLockupController))for(var n=a.iter(e.getCharacterStyleRanges());!n.done;n.next()){var r=n.value;if(t){if(r.end==this.rangeInLockup.end)return!0}else if(r.start==this.rangeInLockup.start)return!0}return!1},isRangeEnd:function(){var e,t=this.text.includes("");if(e=a.as(a.opt(this.lockupForma,(function(e){return e.controller})),v.TypeLockupController))for(var n=a.iter(e.getCharacterStyleRanges());!n.done;n.next()){var r=n.value;if(t){if(r.start==this.rangeInLockup.start)return!0}else if(r.end==this.rangeInLockup.end)return!0}return!1},rowIndex:{get:function(){return this.rowIndex_}},getBoundsCenter:function(){var e;if(e=a.opt(this.bounds,(function(e){return e.center}))){if(!f.Host.textModelUtils.usePGMRenderer())return e;var t,n;if(null!=(t=a.opt(a.as(a.opt(this.lockupForma,(function(e){return e.controller})),v.TypeLockupController),(function(e){return e.text})))&&(n=a.opt(a.opt(this.lockupStyle,(function(e){return e.font})),(function(e){return e.fontData})))){var r=g.getTypographicBoundingRatiosOfString(t,n,!1),o=r.heightRatio*this.fontSize/2+n.capRatio*this.fontSize-r.textVerticalOffsetRatio*this.fontSize;return new A.TheoPoint(e.x,o)}return e}return A.TheoPoint.ZERO},isDecorationTextForma:function(){return this.style.colors.count>1},isWhiteSpace:function(){return P.TypeLockupUtils.isWhiteSpace(this.model_.text)}}}),r)},f9IM:function(e,t,n){var r,o=t,a=n("oAGj"),i=n("URxh"),s=n("c2hD"),l=n("YxjU"),u=n("RkYL");o.MotionSourceStacked=(r=function(){},a.defineClass({name:"MotionSourceStacked",ctor:r,statics:{getSrcKeyframes:function(e){var t=[],n=l.MotionSourceFadeInV.getSrcKeyframes(e),r=s.MotionSourceFadeInH.getSrcKeyframes(e);return t.push(n[0]),t.push(new i.KeyFrame(u.TheoTime.fromSeconds(.25),n[1].timingFunction,n[1].placement,n[1].bounds,n[1].style)),t.push(new i.KeyFrame(u.TheoTime.fromSeconds(.25),r[0].timingFunction,r[0].placement,r[0].bounds,r[0].style)),t.push(new i.KeyFrame(u.TheoTime.fromSeconds(.5),r[1].timingFunction,r[1].placement,r[1].bounds,r[1].style)),t.push(new i.KeyFrame(u.TheoTime.fromSeconds(.5),r[0].timingFunction,r[0].placement.inverse,r[0].bounds,r[0].style)),t.push(new i.KeyFrame(u.TheoTime.fromSeconds(.75),r[1].timingFunction,r[1].placement,r[1].bounds,r[1].style)),t.push(new i.KeyFrame(u.TheoTime.fromSeconds(.75),n[0].timingFunction,n[0].placement.inverse,n[0].bounds,n[0].style)),t.push(new i.KeyFrame(u.TheoTime.fromSeconds(1),n[1].timingFunction,n[1].placement,n[1].bounds,n[1].style)),t}}}),r)},fAXt:function(e,t,n){var r,o=t,a=n("oAGj"),i=n("0wFF"),s=n("gXiO"),l=n("6ZWm"),u=n("cmoc"),c=n("P83h"),d=n("X0GW"),h=n("iCxV"),p=n("lmwz"),f=n("fNpk"),m=n("tGKA"),g=n("oKlP");o.TransformFacade=(r=function(){s.CoreObject.call(this)},a.defineClass({name:"TransformFacade",ctor:r,superName:"CoreObject",statics:{translateForma:function(e,t){e.move(m.Matrix2D.translation(t))},nudgeFormaeInPageSpace:function(e,t){if(f.LegacyCoreAssert.isTrue(e.length>0,"can't nudge 0 formae",void 0,"TransformFacade.nudgeFormaeInPageSpace","TransformFacade.swift",25),0!=e.length){var n,o=1,s=a.first(e);(n=a.opt(a.opt(s,(function(e){return e.page.view})),(function(e){return e.getViewportTransform()})))&&(o=Math.sqrt(Math.abs(n.determinant)));var l=t.divide(o);l=l.multiply(2),r.translateFormaeInPageSpace(e,l),e.length>1?a.opt(h.Host.logging,(function(t){return t.logToAnalytics(i.AnalyticsConstants.kAnalyticsDataMultipleNudged,{contextualData1:"formae count: "+e.length})})):s.isImage()?a.opt(h.Host.logging,(function(e){return e.logToAnalytics(i.AnalyticsConstants.kAnalyticsDataImageNudged,{})})):s.isShape()?a.opt(h.Host.logging,(function(e){return e.logToAnalytics(i.AnalyticsConstants.kAnalyticsDataShapeNudged,{})})):s.isText()&&a.opt(h.Host.logging,(function(e){return e.logToAnalytics(i.AnalyticsConstants.kAnalyticsDataTextNudged,{})}))}},translateFormaeInPageSpace:function(e,t){r.transformFormaeInPageSpaceAboutPoint(e,m.Matrix2D.translation(t),g.TheoPoint.ZERO)},transformFormaeInPageSpaceAboutPoint:function(e,t,n,r){var o;void 0===r&&(r=null);for(var i=m._asterisk_Matrix2D_Matrix2D(m._asterisk_Matrix2D_Matrix2D(m.Matrix2D.translation(g._negate_TheoPoint(n)),t),m.Matrix2D.translation(n)),s=a.iter(e);!s.done;s.next()){var h,f,y=s.value,_=y;if(null==y.controller||y.controller.floating&&!p.ImageFacade.inCropMode(y)||(h=a.as(y,u.FrameForma))&&(_=h.childAt(0)),f=_.parent){var T=new c.FormaAnimationTransactionEvent(_);T.duration=0,_.beginUpdate(T);var C,v=_.placement,P=m._asterisk_Matrix2D_Matrix2D(m._asterisk_Matrix2D_Matrix2D(f.totalPlacement,i),f.totalPlacement.inverse);if(_.move(P),C=a.as(f.controller,l.FrameController)){var S;(S=a.opt(r,(function(e){return e.transformValues})))&&(_.placement=_.placement.scaleTo(S.xscale,S.yscale));var A,D=v.transformValues.xscale;C.updateAfterChildTransform(),Math.abs(D-_.placement.transformValues.xscale)<.001&&1!=Math.abs(t.transformValues.xscale)&&(_.placement=v,C.updateCropModeImage(),(A=p.ImageFacade.getCutoutMaskFormaForForma(_))&&p.ImageFacade.updateCutoutMaskPlacement(_,A))}((o=a.opt(a.opt(_.parent,(function(e){return e.controller})),(function(e){return e.userGroup})))||null!=o)&&o&&d.GroupFacade.updateUserGroupHierarchy(_.parent),_.endUpdate(T)}}},justTransformFormaInPageSpaceAboutPoint:function(e,t,n){var r;if(r=e.parent){var o=m._asterisk_Matrix2D_Matrix2D(m._asterisk_Matrix2D_Matrix2D(m.Matrix2D.translation(g._negate_TheoPoint(n)),t),m.Matrix2D.translation(n)),a=m._asterisk_Matrix2D_Matrix2D(m._asterisk_Matrix2D_Matrix2D(r.totalPlacement,o),r.totalPlacement.inverse);e.move(a)}},transformInPageSpaceAboutFormaUV:function(e,t,n){r.transformFormaeInPageSpaceAboutPoint([e],t,m._asterisk_TheoPoint_Matrix2D(e.bounds.evalXY(n.x,n.y),e.totalPlacement))},transformAboutFormaCenter:function(e,t){var n;if(n=e.parent){var o=new g.TheoPoint(.5,.5);if(n.controller instanceof l.FrameController){var a=n.bounds.transform(e.parent.totalPlacement).center,i=e.totalPlacement.inverse.transformPoint(a);o=e.bounds.locatePoint(i)}r.transformInPageSpaceAboutFormaUV(e,t,o)}else f.LegacyCoreAssert.fail("trying to rotate a forma which doesnt have a parent",void 0,"TransformFacade.transformAboutFormaCenter","TransformFacade.swift",168)},scaleForma:function(e,t){var n=m.Matrix2D.scalingXY(t,t);r.transformAboutFormaCenter(e,n)},flipForma:function(e,t){var n=t?m.Matrix2D.scalingXY(1,-1):m.Matrix2D.scalingXY(-1,1);r.transformAboutFormaCenter(e,n)},isFormaFlipped:function(e,t){return t?e.placement.a>0&&e.placement.d<0:e.placement.a<0&&e.placement.d>0},rotateForma:function(e,t){var n=m.Matrix2D.rotation(Math.cos(t),Math.sin(t));r.transformAboutFormaCenter(e,n)},currentRotation:function(e){var t,n,r;return(t=a.as(e,u.FrameForma))&&(n=a.opt(a.opt(t.page.document,(function(e){return e.controller})),(function(e){return e.selection})))&&n.inCropMode&&(r=p.ImageFacade.getImageFormaForForma(t))?r.rotation():e.rotation()}}}),r)},fNpk:function(e,t,n){var r,o=t,a=n("oAGj"),i=n("SpAV"),s=n("gXiO"),l=n("iCxV"),u=n("8vXU");o.LegacyCoreAssert=(r=function(){s.CoreObject.call(this)},a.defineClass({name:"LegacyCoreAssert",ctor:r,superName:"CoreObject",statics:{newLog:function(e){return a.opt(l.Host.logging,(function(t){return t.newLog(e)}))||new u.CoreLog(e,u.CoreLogToCoreAssert.INSTANCE)},kSwiftFileSuffix:".swift",fail:function(e,t,n,r,o){void 0===t&&(t={}),void 0===n&&(n="LegacyCoreAssert.fail"),void 0===r&&(r="LegacyCoreAssert.swift"),void 0===o&&(o=34),i.CoreAssertDebugOnly.fail(e,t,n,r,o)},isTrue:function(e,t,n,r,o,a){void 0===n&&(n={}),void 0===r&&(r="LegacyCoreAssert.isTrue"),void 0===o&&(o="LegacyCoreAssert.swift"),void 0===a&&(a=43),i.CoreAssertDebugOnly.isTrue(e,t,n,r,o,a)},isFalse:function(e,t,n,r,o,a){void 0===n&&(n={}),void 0===r&&(r="LegacyCoreAssert.isFalse"),void 0===o&&(o="LegacyCoreAssert.swift"),void 0===a&&(a=52),i.CoreAssertDebugOnly.isFalse(e,t,n,r,o,a)}}}),r)},fVJ2:function(e,t,n){var r,o,a,i=t,s=n("oAGj"),l=n("gXiO"),u=n("N5RB"),c=n("O60Y"),d=n("dJuF"),h=n("SmK9"),p=n("13MC"),f=n("ZhwN"),m=n("iCxV"),g=n("fNpk");i.IDBObject=s.defineProtocol("IDBObject",{database:"IDatabase",state:"IDBObjectState",persisted:"Boolean",className:"String",getProperty:"(String) -> DBProperty",setProperty:"(String, DBProperty) -> Void",removeProperty:"(String) -> Void",abandonChanges:"() -> Void"}),i.DBDeletedObject=(r=function(e){this.db_=e,l.CoreObject.call(this),this.state_=new p.DBObjectDeletedState(this)},s.defineClass({name:"DBDeletedObject",ctor:r,superName:"CoreObject",statics:{_implements:function(e){return"IDBObject"==e}},props:{database:{get:function(){return this.db_}},state:{get:function(){return this.state_},set:function(e){g.LegacyCoreAssert.fail("Cannot set the state of a deleted object",void 0,"DBDeletedObject","DBObject.swift",58)}},persisted:{get:function(){return!1}},getProperty:function(e){return null},setProperty:function(e,t){g.LegacyCoreAssert.fail("Cannot set a proeprty on a deleted object",void 0,"DBDeletedObject.setProperty","DBObject.swift",63)},removeProperty:function(e){g.LegacyCoreAssert.fail("Cannot remove a property from a deleted object",void 0,"DBDeletedObject.removeProperty","DBObject.swift",64)},className:{get:function(){return""}},abandonChanges:function(){}}}),r),i.DBObject=(o=function(){this.initialState_=null,this.childObjects_=[],this.childObjectProperties_={},this.noOpSetter=function(e){},this.cachedValues_={},this.decodedObjects_={},this.validateOnSet=!1},s.defineClass({name:"DBObject",ctor:o,superName:"CoreObject",statics:{instantiateItemDescendants:function(e,t){var n,r,a;if(n=s.as(e,o))n.instantiateDescendants();else if(r=s.as(e,["Array","Any"])){var i;if(i=t.arrayValue)for(var l=s.iter(s.toSequence(i));!l.done;l.next()){var u=l.value,c=u.offset,d=u.element;o.instantiateItemDescendants(r[c],d)}}else(a=s.as(e,["Dictionary","String","Any"]))&&t.isDictionary&&t.forEachDictionaryProperty((function(e,t){var n;null!=(n=a[e])&&o.instantiateItemDescendants(n,t)}))},_implements:function(e){return"IDBObject"==e}},props:{database:{get:function(){return g.LegacyCoreAssert.isTrue(null!=this.db_,"Constant objects are not bound to a database",void 0,"DBObject","DBObject.swift",100),this.db_}},state:{get:function(){return this.state_||this.initialState},set:function(e){var t;if(g.LegacyCoreAssert.isTrue(null!=this.db_,"Cannot change the state of a constant object",void 0,"DBObject","DBObject.swift",107),g.LegacyCoreAssert.isTrue(!(this.initialState_ instanceof p.DBChildObjectState)||e===this.initialState_,"Child objects should have their states changed via a parent object.",void 0,"DBObject","DBObject.swift",108),t=s.as(e,p.DBChildObjectState))this.state_=t,this.initialState_=t;else if(null==this.state_&&null==this.initialState_&&(this.initialState_=e,this.state_=e),e!==this.state_){var n=s.clone(s.opt(this.state_,(function(t){return t.diff(e)})));null!=n&&s.count(n)>0&&this.willChangeState(n),this.state_=e,this.db_.objectStateChanged(e),null!=n&&s.count(n)>0&&(s.removeAll(this.cachedValues_),this.didChangeState(n))}}},removeChildObject:function(e){var t;null!=(t=s.indexOf(this.childObjects_,e))&&(e.removeAllChildren(),this.childObjects_.splice(t,1))},removeAllChildren:function(){for(var e=s.iter(this.childObjects_);!e.done;e.next()){var t=e.value;t.removeAllChildren(),t.persisted&&s.opt(s.as(this.db_.mutableState,p.DBMutableState),(function(e){return e.removeObject(t.id)}))}this.childObjects_.splice(0),s.removeAll(this.childObjectProperties_)},persistToDatabase:function(e,t){this.db_=e,this.guid_=t;for(var n=s.iter(this.childObjects_);!n.done;n.next()){var r=n.value;g.LegacyCoreAssert.isFalse(r.persisted,"Child object already persisted when its parent wasn't",void 0,"DBObject.persistToDatabase","DBObject.swift",160),e.addObject(f.GUIDUtils.makeGUID(),r)}},addChildObject:function(e,t){var n;e.convertToChildObject(this,t),this.persisted&&!e.persisted&&this.database.addObject(f.GUIDUtils.makeGUID(),e),null==t.parent&&((n=this.childObjectProperties_[t.name])&&this.removeChildObject(n),this.childObjectProperties_[t.name]=e),this.childObjects_.push(e)},createChildObject:function(e,t){var n,r=null;if(null!=(n=i.DBHostObject.factory(e))){var a,l=p.DBChildObjectState.init_94ed(this,t),u=f.GUIDUtils.makeGUID();if(null!=(r=s.as(n(u,this.db_,l,null),o)))l.object=r,s.opt(this.db_,(function(e){return e.addObject(u,r)})),null==t.parent&&((a=this.childObjectProperties_[t.name])&&this.removeChildObject(a),this.childObjectProperties_[t.name]=r),this.childObjects_.push(r)}return r},childObjects:{get:function(){return this.childObjects_.concat()}},descendantObjectsMA:{get:function(){for(var e=this.childObjects_.slice(0,this.childObjects_.length),t=s.iter(this.childObjects_);!t.done;t.next()){var n=t.value;s.append(e,n.descendantObjectsMA)}return e}},descendantObjects:{get:function(){return this.descendantObjectsMA.concat()}},recursivelyAddChildObjectsToArray:function(e){for(var t=s.iter(this.childObjects_);!t.done;t.next()){var n=t.value;s.append(e,n.childObjects_),n.recursivelyAddChildObjectsToArray(e)}},descendantObjectsStates:{get:function(){if(0==this.childObjects_.length)return null;var e=[];return s.append(e,this.childObjects_),this.recursivelyAddChildObjectsToArray(e),e.map((function(e){return e.state}),this)}},convertToChildObject:function(e,t){if(!this.isChildObject){var n=s.clone(this.state.allProperties),r=p.DBChildObjectState.init_7008(this,e,t);this.initialState_=r,this.state_=r,r.setProperties(n),r.savePendingProperties()}return this.state},isChildObject:{get:function(){return this.initialState_ instanceof p.DBChildObjectState}},persisted:{get:function(){return null!=this.db_}},initialized:{get:function(){return null!=this.initialState_}},willChangeState:function(e){},didChangeState:function(e){},className:{get:function(){return g.LegacyCoreAssert.fail("Object class name not provided",void 0,"DBObject","DBObject.swift",260),""}},init_3f7c:function(e){var t,n=e instanceof p.DBChildObjectState;this.guid_=n?f.GUIDUtils.makeGUID():"",l.CoreObject.call(this),!n&&s.is(e,p.IDBObjectMutableState)?(this.initialState_=p.DBObjectState.init_2a9a(this,e.allProperties),this.state_=p.DBObjectMutableState.init_226b(this.initialState_)):(this.initialState_=e,this.state_=e,(t=s.as(e,p.DBChildObjectState))&&(t.object=this))},init_dd5d:function(e,t){this.guid_="",l.CoreObject.call(this),this.initialState_=p.DBObjectMutableState.init_2a9a(this,e),this.state_=this.initialState_;for(var n=s.clone(e),r=s.iter(t);!r.done;r.next()){var o,a=r.key,i=r.value;(o=h.DBSchema.currentSchema.getPropertyCodec(a,this.className))&&(n[a]=o.encode(d.DBNamePath.init_b14a(a),i,this))}this.initialState_=p.DBObjectState.init_2a9a(this,n),this.state_=p.DBObjectMutableState.init_226b(this.initialState_)},init_866e:function(e,t){var n,r=e instanceof p.DBChildObjectState;this.guid_=t,l.CoreObject.call(this),!r&&s.is(e,p.IDBObjectMutableState)?(this.initialState_=p.DBObjectState.init_2a9a(this,e.allProperties),this.state_=p.DBObjectMutableState.init_226b(this.initialState_)):(this.initialState_=e,this.state_=e,(n=s.as(e,p.DBChildObjectState))&&(n.object=this))},init_11e0:function(e){this.db_=e,this.guid_=f.GUIDUtils.makeGUID(),l.CoreObject.call(this),this.db_.addObject(this.guid_,this)},init_5079:function(e,t,n,r){this.db_=e,this.guid_=s.isEmpty(r)?f.GUIDUtils.makeGUID():r,l.CoreObject.call(this),this.initialState_=p.DBObjectMutableState.init_2a9a(this,t),this.state_=this.initialState_;for(var o=s.clone(t),a=s.iter(n);!a.done;a.next()){var i,u=a.key,c=a.value;(i=h.DBSchema.currentSchema.getPropertyCodec(u,this.className))&&(o[u]=i.encode(d.DBNamePath.init_b14a(u),c,this))}this.initialState_=p.DBObjectState.init_2a9a(this,o),this.state_=null,this.db_.addObject(this.guid_,this)},init_3181:function(e,t,n){var r;this.db_=e,this.guid_=n,l.CoreObject.call(this),(r=s.as(t,p.IDBObjectMutableState))?this.initialState_=r.assign(this):this.initialState_=t,this.state_=s.as(this.initialState_,p.DBChildObjectState),this.db_.addObject(this.guid_,this)},init_67b3:function(e){this.db_=e.database,this.guid_=f.GUIDUtils.makeGUID(),l.CoreObject.call(this),this.db_.addObject(this.guid_,this)},id:{get:function(){return this.guid_}},fork:function(e){return this.forkWithLink(e,null)},forkWithLink:function(e,t){return this.forkToDatabase(e,!0,s.opt(t,(function(e){return e.database}))||this.db_,t)},forkPropertyToDatabase:function(e,t,n,r,a){var i,l=this,u=null;if(null!=n.linkID){if(t){var h=s.as(n.objValue,o);if(null!=h){var p,m=f.GUIDUtils.makeGUID(),g=null!=a?c.DBLink.init_8408(m,a,r):null;(p=s.opt(h,(function(e){return e.forkToDatabase(m,!0,a,g)})))&&(u=d.DBProperty.objProperty(d.DBNamePath.init_b14a(e),p,this.className,r))}}}else if(i=n.arrayValue){for(var y=[],_=s.iter(s.toSequence(i));!_.done;_.next()){var T,C=_.value,v=C.offset,P=C.element;(T=this.forkPropertyToDatabase(s.toString(v),t,P,r,a))&&y.push(T)}u=null!=n.className?d.DBProperty.arrayEncoded(d.DBNamePath.init_b14a(e),y,n.className):d.DBProperty.arrayProperty(d.DBNamePath.init_b14a(e),y)}else if(n.isDictionary){var S={};n.forEachDictionaryProperty((function(e,n){var o;(o=l.forkPropertyToDatabase(e,t,n,r,a))&&(S[e]=o)})),u=null!=n.className?d.DBProperty.dictEncoded(d.DBNamePath.init_b14a(e),S,n.className):d.DBProperty.dictProperty(d.DBNamePath.init_b14a(e),S)}else u=n.copy();return u},forkToDatabase:function(e,t,n,r){var a,l=null;if(null!=(a=i.DBHostObject.factory(this.className))){for(var u=s.clone(this.state.allProperties),c={},d=s.iter(u);!d.done;d.next()){var h,f=d.key,m=d.value;(h=this.forkPropertyToDatabase(f,t,m,e,n))&&(c[f]=h)}var g=p.DBObjectMutableState.init_6271(this.className,c);l=s.as(a(e,n,g,r),o)}return l},getCodec:function(e){return h.DBSchema.currentSchema.getPropertyCodec(e,this.className)},clearCache:function(){s.removeAll(this.cachedValues_)},abandonChanges:function(){this.clearCache()},host:{get:function(){var e,t;return(e=s.as(this.state_,p.DBChildObjectState))&&(t=s.as(e.parentObject,o))?t.host:s.as(s.opt(this.db_,(function(e){return e.host})),i.DBHostObject)}},get:function(e){var t,n,r,a,i,l,u,c,p,f=this,y=this.getProperty(e);if(null==y||y instanceof d.DBDeletedProperty)return null;if(null!=(i=this.cachedValues_[e]))return i;if(l=this.childObjectProperties_[e]){if(s.opt(y,(function(e){return e.className==l.className})))return l;g.LegacyCoreAssert.isTrue(s.opt(y,(function(e){return"AlphaBlendFilter"==e.className||s.opt(y,(function(e){return"CompositeFilter"==e.className}))})),"Unexpected className",{className:(t=s.opt(y,(function(e){return e.className})))||null!=t?t:"nil",childObjectClassName:l.className},"DBObject.get","DBObject.swift",496),s.opt(m.Host.logging,(function(e){return e.info("ClassName is "+((n=s.opt(y,(function(e){return e.className})))||null!=n?n:"nil")+" childObject ClassName is "+l.className)}))}if(null!=(u=this.decodedObjects_[e])&&(c=this.database.getObject(u))){if(s.opt(y,(function(e){return e.className==c.className})))return c;g.LegacyCoreAssert.isTrue(s.opt(y,(function(e){return"AlphaBlendFilter"==e.className||s.opt(y,(function(e){return"CompositeFilter"==e.className}))})),"Unexpected className",{className:(r=s.opt(y,(function(e){return e.className})))||null!=r?r:"nil",dbObjectClassName:c.className},"DBObject.get","DBObject.swift",510),s.opt(m.Host.logging,(function(e){return e.info("ClassName is "+((a=s.opt(y,(function(e){return e.className})))||null!=a?a:"nil")+" database obj ClassName is "+c.className)}))}if(p=y){var _=s.opt(this.host,(function(e){return e.decodingSchema})),T=h.DBSchema.currentSchema.getPropertyCodec(e,this.className)||s.opt(_,(function(t){return t.getPropertyCodec(e,f.className)}));if(null!=T){var C,v=T.decode(p,this);return(C=s.as(v,o))?C.persisted&&(this.decodedObjects_[e]=C.id):null!=v&&(this.cachedValues_[e]=v),v}}return this.cachedValues_[e]},set:function(e,t){var n;s.removeKey(this.decodedObjects_,e),null==t?(s.removeKey(this.cachedValues_,e),this.removeProperty(e)):(n=h.DBSchema.currentSchema.getPropertyCodec(e,this.className))&&(this.cachedValues_[e]=t,this.updateProperty(e,t)||this.setProperty(e,n.encode(d.DBNamePath.init_b14a(e),t,this)))},mutable:{get:function(){return null!=this.db_&&(s.is(this.state_,p.IDBObjectMutableState)||null!=this.db_.mutableState)}},schemaRule:{get:function(){return h.DBSchema.currentSchema.rulesByName[this.className]}},getProperty:function(e){return this.state.getProperty(e)},setProperty:function(e,t){var n=this;if(!t.isEqual(this.getProperty(e))){g.LegacyCoreAssert.isTrue(!this.persisted||null!=this.db_.mutableState,"Cannot change the state of a persisted "+this.className+" object when the database is immutable",void 0,"DBObject.setProperty","DBObject.swift",559);var r,o=s.is(this.state_,p.IDBObjectMutableState)?s.as(this.state_,p.IDBObjectMutableState):s.opt(s.opt(this.db_,(function(e){return e.mutableState})),(function(e){return e.newObjectState(n)}));if(r=o){var a;if(this.isChildObject&&s.opt(s.opt(this.db_,(function(e){return e.mutableState})),(function(e){return e.setObjectState(n,r)})),this.validateOnSet&&(a=s.opt(this.schemaRule,(function(t){return t.getPropertyRule(e)})))){var i,l=a.validateProperty(t);if(i=s.as(l,h.DBValidationError))return void g.LegacyCoreAssert.fail("Failed to write property",{property:e,error:i.error},"DBObject.setProperty","DBObject.swift",574)}r.setProperty(e,t)}}},updateProperty:function(e,t){var n,r;return!(!(n=s.as(this.state_,p.IDBObjectMutableState))||!(r=h.DBSchema.currentSchema.getPropertyCodec(e,this.className)))&&n.updateProperty(e,t,r)},removeProperty:function(e){var t=this,n=this.getProperty(e);if(null!=n&&!(n instanceof d.DBDeletedProperty)){g.LegacyCoreAssert.isTrue(!this.persisted||null!=this.db_.mutableState,"Cannot remove a property from a persisted "+this.className+" object when the database is immutable",void 0,"DBObject.removeProperty","DBObject.swift",594);var r,o,a=s.is(this.state_,p.IDBObjectMutableState)?this.state_:this.db_.mutableState.newObjectState(this);if(this.validateOnSet&&(r=s.opt(this.schemaRule,(function(e){return e.getRequiredProperties()})))&&r.includes(e))return void g.LegacyCoreAssert.fail("Cannot remove required property",{property:e},"DBObject.removeProperty","DBObject.swift",603);this.isChildObject&&s.opt(s.opt(this.db_,(function(e){return e.mutableState})),(function(e){return e.setObjectState(t,a)})),a.removeProperty(e),(o=this.childObjectProperties_[e])&&(this.removeChildObject(o),s.removeKey(this.childObjectProperties_,e),this.persisted&&s.opt(s.as(this.db_.mutableState,p.DBMutableState),(function(e){return e.removeObject(o.id)})))}},matchProperties:function(e){g.LegacyCoreAssert.isTrue(!this.persisted||null!=this.db_.mutableState,"Cannot change the state of a persisted object when the database is immutable",void 0,"DBObject.matchProperties","DBObject.swift",626);var t=s.is(this.state_,p.IDBObjectMutableState)?this.state_:this.db_.mutableState.newObjectState(this);t.clear();for(var n=s.iter(e);!n.done;n.next()){var r=n.key,o=n.value;t.setProperty(r,o)}for(var a=s.iter(this.childObjects);!a.done;a.next()){var i=a.value;i.clearCache(),s.opt(s.as(i.state,p.DBChildObjectState),(function(e){return e.abandonPendingProperties()}))}this.clearCache()},makeMutable:function(){s.opt(this.db_,(function(e){return null!=e.mutableState}))&&this.db_.mutableState.makeObjectMutable(this)},emptyState:{get:function(){return null==this.emptyState_&&(this.emptyState_=p.DBObjectState.init_be8f(this)),this.emptyState_}},initialState:{get:function(){return this.initialState_||this.emptyState}},mutableState:{get:function(){return s.is(this.state_,p.IDBObjectMutableState)?this.state_:this.db_.mutableState.newObjectState(this)}},instantiateDescendants:function(){for(var e=s.iter(this.state.allProperties);!e.done;e.next()){var t,n,r=e.key,a=e.value;a.schemaType!=h.DBSchemaType.ArrayType&&a.schemaType!=h.DBSchemaType.ObjectType||null!=(t=this.get(r))&&(n=this.getProperty(r))&&o.instantiateItemDescendants(t,n)}},willCommitState:function(){},didCommitState:function(){}}}),o),i.DBHostObject=(a=function(){this.hostDB_=new u.PostDB},s.defineClass({name:"DBHostObject",ctor:a,superName:"DBObject",statics:{factories_:{},registerFactory:function(e,t){return null==a.factories_[e]&&(a.factories_[e]=t),a.factories_[e]},factory:function(e){return a.factories_[e]},_implements:function(e){return"IDBObject"==e}},props:{init_1be9:function(e,t,n){this.schema_=h.DBSchema.init_2af7(e);var r=this.hostDB_.beginTransaction("decode",null);this.initialStateID_=this.schema_.validateAndRead(t,this.hostDB_,(function(e){for(var t="Errors: ",r=s.iter(e);!r.done;r.next())t=t+"\n"+r.value.error;n(t)})),s.super_init(this,i.DBObject,i.DBObject.prototype.init_5079,this.hostDB_,{},{},this.initialStateID_),r.end(),this.hostDB_.host=this},init_7341:function(e,t){var n;void 0===t&&(t=null),this.schema_=h.DBSchema.init_2af7(e);var r=this.hostDB_.beginTransaction("decode",null);this.initialStateID_="",s.super_init(this,i.DBObject,i.DBObject.prototype.init_5079,this.hostDB_,{},{},(n=t)||null!=n?n:f.GUIDUtils.makeGUID()),r.end(),this.hostDB_.host=this},init_b80b:function(e){var t;void 0===e&&(e=null),this.schema_=null;var n=this.hostDB_.beginTransaction("decode",null);this.initialStateID_="",s.super_init(this,i.DBObject,i.DBObject.prototype.init_5079,this.hostDB_,{},{},(t=e)||null!=t?t:f.GUIDUtils.makeGUID()),n.end(),this.hostDB_.host=this},decodingSchema:{get:function(){return this.schema_||h.DBSchema.currentSchema}},willApplyDatabaseState:function(e){},didApplyDatabaseState:function(e){}}}),a)},fWxZ:function(e,t,n){var r,o,a=t,i=n("oAGj"),s=n("6NRR"),l=n("KSe6"),u=n("CWW7"),c=n("9WSY"),d=n("yhkb"),h=n("quOg"),p=n("lqhW"),f=n("FNB+"),m=n("NxMp"),g=n("cmoc"),y=n("ylxa"),_=n("ML5t"),T=n("OdB2"),C=n("P83h"),v=n("9Lk3"),P=n("pnSN"),S=n("ZhwN"),A=n("iCxV"),D=n("U010"),E=n("fdtz"),R=n("b/QB"),F=n("fNpk"),I=n("Quhx"),b=n("358a"),O=n("NbJN"),k=n("AxS/"),M=n("K0Rh"),N=n("9YN4"),L=n("enh0"),x=n("8t9B"),B=n("sIWg"),w=n("1NAc");a.PageModelVersions=i.defineEnum("PageModelVersions",{INVALID:-1,INITIAL:0}),a.FormaPage=(r=function(){this.formaFactory_=new m.DefaultFormaFactory,this.formaCache_={},this.pgmSource_=null,this.modelVersion_=a.PageModelVersions.INITIAL,this.colorLibrary_=null},o={},i.defineClass({name:"FormaPage",ctor:r,superName:"PostDCXObject",statics:{SCHEMA_CLASS_NAME:"FormaPage",factory:{get:function(){return void 0===o.factory&&(o.factory=function(e,t,n,o){var a=i.as(i.opt(i.opt(o,(function(e){return e.backLink})),(function(e){return e.dereference()})),N.TheoDocument);return F.LegacyCoreAssert.isTrue(null!=a,"FormaPage needs a parent document",void 0,"FormaPage","FormaPage.swift",20),r.init_3144(e,t,n,a)}),o.factory},set:function(e){o.factory=e}},PROPERTY_KIND:"kind",PROPERTY_PAGE_SIZE:"size",PROPERTY_TEMPLATE_ID:"template-id",PROPERTY_THEME_ID:"theme-id",PROPERTY_COLOR_LIBRARY:"color-library",PROPERTY_SIZE_ID:"size-id",PROPERTY_ORIGINAL_SIZE_ID:"original-size-id",PROPERTY_CUSTOM_SIZE_FORMAT:"custom-size-format",PROPERTY_CUSTOM_SIZE_PPI:"custom-size-ppi",PROPERTY_EXPORT_DATA:"export-data",PROPERTY_CHILDREN:"children",DEFAULT_SIZE_ID:"Instagram",DEFAULT_ORIGINAL_SIZE_ID:"Unknown",DEFAULT_CUSTOM_SIZE_FORMAT:{get:function(){return void 0===o.DEFAULT_CUSTOM_SIZE_FORMAT&&(o.DEFAULT_CUSTOM_SIZE_FORMAT=y.PageExportFormat.PIXELS),o.DEFAULT_CUSTOM_SIZE_FORMAT}},DEFAULT_CUSTOM_SIZE_PPI:300,DEFAULT_PAGE_SIZE:{get:function(){return void 0===o.DEFAULT_PAGE_SIZE&&(o.DEFAULT_PAGE_SIZE=new w.TheoSize(1200,1200)),o.DEFAULT_PAGE_SIZE}},DCXTYPE:{get:function(){return"application/vnd.adobe.theo.forma+dcx"}},PATH:{get:function(){return"forma-document"}},_implements:function(e){return"IDBObject"==e||"TheoMessagePublisher"==e}},props:{init_3144:function(e,t,n,r){this.document_=r,this.imageFilterLibrary_=new R.ImageFilterLibrary,this.imageCutoutLibrary_=new D.ImageCutoutLibrary,this.animationLibrary_=new l.AnimationLibrary,this.refineCutoutController_=new O.RefineCutoutController,i.super_init(this,I.PostDCXObject,I.PostDCXObject.prototype.init_3181,t,n,e),this.colorLibraryController_=new d.ColorLibraryController(this.colorLibrary,this),this.animationController_=new s.AnimationController(this)},init_d0e4:function(e){this.document_=e,this.imageFilterLibrary_=new R.ImageFilterLibrary,this.imageCutoutLibrary_=new D.ImageCutoutLibrary,this.animationLibrary_=new l.AnimationLibrary,this.refineCutoutController_=new O.RefineCutoutController,i.super_init(this,I.PostDCXObject,I.PostDCXObject.prototype.init_11e0,e.database),this.set(I.PostDCXObject.PROPERTY_PATH,S.GUIDUtils.makeGUID()),this.set(I.PostDCXObject.PROPERTY_TYPE,r.DCXTYPE),this.set(r.PROPERTY_PAGE_SIZE,r.DEFAULT_PAGE_SIZE),this.set(r.PROPERTY_SIZE_ID,r.DEFAULT_SIZE_ID),this.set(r.PROPERTY_COLOR_LIBRARY,c.ColorLibrary.init_d41d()),this.colorLibraryController_=new d.ColorLibraryController(this.colorLibrary,this),this.animationController_=new s.AnimationController(this),this.root_=i.as(this.createForma(M.RootForma.KIND),P.GroupForma)},cleanupEmptyTextLockups:function(){var e=[];this.root_.visitAll(f.FormaTraversal.PreOrder,(function(t){var n;(n=i.as(t.controller,x.TypeLockupController))&&i.isEmpty(n.text)&&e.push(t)})),u.CreationFacade.deleteFormae(e,(function(){}))},postDecode:function(){var e,t=this;null==this.colorLibrary.color(i.as(this.colorLibraryController.getThemeColorKeys()[0],"String"))&&i.opt(this.colorLibraryController_,(function(e){return e.applyLegacyColorThemeFromDocument(t.document_)})),i.opt(this.colorLibraryController_,(function(e){return e.ensureDerivedColorsAreSet()})),this.cleanupEmptyTextLockups(),this.root_.visitAll(f.FormaTraversal.PostOrderWithAuxiliaries,(function(e){return e.postDecode()})),((e=i.opt(this.document,(function(e){return e.versionDecoded.vers})))||null!=e?e:0)<N.TheoDocumentVersion.MultiplePages&&(this.themeID=i.opt(this.document,(function(e){return e.content.root.getTag(k.RootContentNode.THEME_ID_TAG)})))},className:{get:function(){return r.SCHEMA_CLASS_NAME}},document:{get:function(){return this.document_}},view:{get:function(){return this.view_},set:function(e){this.view_=e}},pgm:{get:function(){return this.pgmSource_=this.pgmSource_||new _.FormaPagePGMSource(this),this.pgmSource_}},setPageSizeFromDesignSize:function(e){var t=Math.max(this.pageSize_.width,this.pageSize_.height),n=e.aspectRatio>1?Math.round(t/e.aspectRatio):t,r=Math.round(e.aspectRatio*n);this.sizeID=e.id,this.customSizeFormat=e.exportData.format,this.customSizePPI=e.exportData.PPI,this.templateID=null,this.setPageSize(new w.TheoSize(r,n),e.exportData)},setPageSize:function(e,t){if(void 0===t&&(t=null),null!=t&&Math.abs((t.dimensions.aspectRatio-e.aspectRatio)/Math.max(t.dimensions.aspectRatio,e.aspectRatio))>.02)F.LegacyCoreAssert.fail("Incompatible dimensions",void 0,"FormaPage.setPageSize","FormaPage.swift",187);else{var n,o=!1;e.equal(this.pageSize_)||(o=!0,this.pageSize_=e,this.root.bounds=B.TheoRect.fromSize(e),this.publish(new T.PageSizeUpdateMessage(this,e))),(n=i.opt(i.opt(this.document,(function(e){return e.controller})),(function(e){return e.designController.view})))&&this==b.PagesFacade.getActivePage(this.document)&&(o||e.equal(r.DEFAULT_PAGE_SIZE))&&n.pageSizeChanged(),this.exportData_=t}},getExportDataWithLimitTo:function(e){return this.getExportData(e,null)},getPageExportData:function(){return this.getExportData(null,null)},getExportData:function(e,t){var n=null;if(null!=this.exportData_)n=this.exportData_;else{var r=p.DesignSizeLibrary.getById(this.sizeID);null!=r&&(n=r.exportData)}var o=this.pageSize_.aspectRatio,a=null!=t?t:p.DesignSizeLibrary.MAX_EDGE;null==n&&(n=o<1?new y.FormaPageExportData(new w.TheoSize(Math.round(a*o),a),y.PageExportFormat.PIXELS):new y.FormaPageExportData(new w.TheoSize(a,Math.round(a/o)),y.PageExportFormat.PIXELS));var i=Math.max(n.pixelDimensions.width,n.pixelDimensions.height);return null!=e&&i>e&&(a=e,n=o<1?new y.FormaPageExportData(new w.TheoSize(Math.round(a*o),a),y.PageExportFormat.PIXELS):new y.FormaPageExportData(new w.TheoSize(a,Math.round(a/o)),y.PageExportFormat.PIXELS)),n},pageSize_:{get:function(){var e;return(e=i.as(this.get(r.PROPERTY_PAGE_SIZE),w.TheoSize))||null!=e?e:r.DEFAULT_PAGE_SIZE},set:function(e){this.set(r.PROPERTY_PAGE_SIZE,e)}},pageSize:{get:function(){return this.pageSize_}},templateID:{get:function(){return i.as(this.get(r.PROPERTY_TEMPLATE_ID),"String")},set:function(e){this.set(r.PROPERTY_TEMPLATE_ID,e)}},themeID:{get:function(){return i.as(this.get(r.PROPERTY_THEME_ID),"String")},set:function(e){this.set(r.PROPERTY_THEME_ID,e)}},sizeID:{get:function(){var e;return(e=i.as(this.get(r.PROPERTY_SIZE_ID),"String"))||null!=e?e:r.DEFAULT_SIZE_ID},set:function(e){this.set(r.PROPERTY_SIZE_ID,e)}},originalSizeID:{get:function(){var e;return(e=i.as(this.get(r.PROPERTY_ORIGINAL_SIZE_ID),"String"))||null!=e?e:r.DEFAULT_ORIGINAL_SIZE_ID},set:function(e){this.set(r.PROPERTY_ORIGINAL_SIZE_ID,e)}},customSizeFormat:{get:function(){var e,t,n=(e=i.as(this.get(r.PROPERTY_CUSTOM_SIZE_FORMAT),"Int"))||null!=e?e:r.DEFAULT_CUSTOM_SIZE_FORMAT;return(t=y.PageExportFormat.toCaseValue(n))||null!=t?t:r.DEFAULT_CUSTOM_SIZE_FORMAT},set:function(e){this.set(r.PROPERTY_CUSTOM_SIZE_FORMAT,e)}},customSizePPI:{get:function(){var e;return(e=i.as(this.get(r.PROPERTY_CUSTOM_SIZE_PPI),"Double"))||null!=e?e:r.DEFAULT_CUSTOM_SIZE_PPI},set:function(e){this.set(r.PROPERTY_CUSTOM_SIZE_PPI,e)}},colorLibrary:{get:function(){return null==this.colorLibrary_&&(this.colorLibrary_=i.as(this.get(r.PROPERTY_COLOR_LIBRARY),c.ColorLibrary)),this.colorLibrary_}},setColorLibrary:function(e){this.colorLibrary_=e,this.set(r.PROPERTY_COLOR_LIBRARY,e)},colorLibraryController:{get:function(){return this.colorLibraryController_}},exportData_:{get:function(){return i.as(this.get(r.PROPERTY_EXPORT_DATA),y.FormaPageExportData)},set:function(e){this.set(r.PROPERTY_EXPORT_DATA,e)}},exportData:{get:function(){return this.exportData_}},children_:{get:function(){var e;return(e=i.as(this.get(r.PROPERTY_CHILDREN),["Array",f.Forma]))||null!=e?e:[]}},root_:{get:function(){return this.children_.length>0?i.as(this.children_[0],P.GroupForma):null},set:function(e){if(null!=e&&0==this.children_.length){var t=i.clone(i.as(this.get(r.PROPERTY_CHILDREN),["Array",f.Forma]));null!=t&&t.length>0?(t[0]=e,this.set(r.PROPERTY_CHILDREN,t)):this.set(r.PROPERTY_CHILDREN,[i.as(e,f.Forma)])}}},root:{get:function(){return this.root_}},hasRoot:function(){return null!=this.root_},imageFilterLibrary:{get:function(){return this.imageFilterLibrary_}},imageCutoutLibrary:{get:function(){return this.imageCutoutLibrary_}},animationLibrary:{get:function(){return this.animationLibrary_}},layoutLibrary:{get:function(){return this.document.gridLibrary}},animationController:{get:function(){return this.animationController_}},refineCutoutController:{get:function(){return this.refineCutoutController_}},imageColors:{get:function(){var e,t,n=[],r=i.clone(this.root_.filterWithCallback((function(e){return e instanceof E.ImageForma})));return r.length>0&&(e=i.as(r[0],E.ImageForma))&&(t=i.opt(e.contentNode,(function(e){return e.image})))&&i.append(n,t.getImageColors(10)),n}},formaByID:function(e){var t;return(t=this.formaCache_[e])?t:(t=this.root.formaByID(e))?(this.formaCache_[e]=t,t):null},getAllSelectableTopLevel:function(){var e;return null!=this.root_&&this.root_.childCount>0&&(e=i.as(this.root_.childAt(0),P.GroupForma))&&i.as(e.controller,v.GridController)?e.visitAsArray(f.FormaTraversal.JustChildren):[]},selectableFormaeIntersectingRect:function(e){var t=[];return this.root_.visit(f.FormaTraversal.PreOrder,(function(n,r,o){var a,s;return null!=n.controller&&n.controller.canMultiSelect&&!n.controller.userGroupChild&&(n.isFullCanvas||B.TheoRect.PointInCommon(e,n.totalPlacement.inverse,n.bounds)&&((a=i.as(n.parent,g.FrameForma))?B.TheoRect.PointInCommon(e,a.totalPlacement.inverse,a.bounds)&&t.push(n):(s=i.as(n,L.TextForma))?t.push(s.lockupForma):t.push(n))),!1})),t},formaAtPoint:function(e,t,n,r){void 0===t&&(t=0),void 0===n&&(n=null),void 0===r&&(r=null);var o,a=this,s=null;return this.root_.visit(f.FormaTraversal.PreOrder,(function(l,u,c){var d;if(d=i.opt(l.totalPlacement.inverse,(function(t){return t.transformPoint(e)}))){var p=Math.sqrt(Math.abs(l.totalPlacement.determinant));F.LegacyCoreAssert.isTrue(0!=p,"framescale is zero",void 0,"FormaPage.formaAtPoint","FormaPage.swift",473);var f=t/p;if(l.containsPoint(d,f)&&!l.isFullCanvas){if(a.document.controller.interactionMode==h.InteractionMode.AutomaticGrid&&null!=l.controller&&l.controller.floating&&!A.Host.platform.isWeb)return!0;if(null!=r&&0==r(l))return!1;if(((o=i.opt(l.controller,(function(e){return e.userGroup})))||null!=o)&&o)return!1;if(null!=n){for(var m=!1,y=i.iter(n);!y.done;y.next()){var _=y.value;if(l.kind==_&&(!l.isShape()||null!=l.controller)){m=!0;break}}if(0==m)return!1}var T,C;if(T=i.as(l.parent,g.FrameForma)){if(C=i.opt(T.totalPlacement.inverse,(function(t){return t.transformPoint(e)}))){var v=Math.sqrt(Math.abs(T.totalPlacement.determinant));F.LegacyCoreAssert.isTrue(0!=v,"framescale is zero",void 0,"FormaPage.formaAtPoint","FormaPage.swift",512);var P=t/v;T.containsPoint(C,P)&&(s=l)}}else s=l}}return!1})),s},formaAtPointInSelection:function(e,t){var n=null;return t.forEachSelected((function(t){return t.visit(f.FormaTraversal.PreOrder,(function(t,r,o){var a;if((a=i.opt(t.totalPlacement.inverse,(function(t){return t.transformPoint(e)})))&&t.containsPoint(a)&&!t.isFullCanvas){if(t instanceof L.TextForma)return n=t,!0;var s,l;(s=i.as(t.parent,g.FrameForma))?(l=i.opt(s.totalPlacement.inverse,(function(t){return t.transformPoint(e)})))&&s.containsPoint(l)&&(n=t):n=t}return!1}))})),n},createForma:function(e){var t=this.formaFactory_.createForma(this,e);if(null==t)return null;var n=new C.FormaCreatedEvent(t);return this.beginUpdate(n),t.initializeToDefaults(),this.endUpdate(n),t},createFormaWithController:function(e,t){var n=this.formaFactory_.createForma(this,e);if(null==n)return null;var r=new C.FormaCreatedEvent(n);return this.beginUpdate(r),n.initializeToDefaults(),n.controller=i.opt(i.opt(this.document_,(function(e){return e.controller})),(function(e){return e.controllerFactory.createController(t,n)})),this.endUpdate(r),n},createModelForma:function(e){var t=this.formaFactory_.createForma(this,e);return null==t?null:(t.isModel=!0,t)},beginUpdate:function(e){null!=this.view_&&(e.token=this.view_.beginViewUpdate(e)),this.publish(new T.FormaBeginUpdateMessage(this,e))},endUpdate:function(e){var t,n=!1;(t=i.as(e,C.FormaInsertedChildrenEvent))?n=0==t.children.length:(e instanceof C.FormaNullChangedEvent||e instanceof C.FormaAnimationChangedEvent||e instanceof C.AnimationStateChangedEvent||this.animationController.playing||this.animationLibrary.isModifyingModelForAnimation)&&(n=!0),n||(this.modelVersion_+=1),this.publish(new T.FormaEndUpdateMessage(this,e)),i.opt(this.view_,(function(t){return t.endViewUpdate(e.token)}))},formaCache:{get:function(){return this.formaCache_}},clearFormaCache:function(){this.formaCache_={}},removeFormaFromCache:function(e){i.removeKey(this.formaCache_,e)},modelVersion:{get:function(){return this.modelVersion_}}}}),r)},fdtz:function(e,t,n){var r,o,a,i=t,s=n("oAGj"),l=n("ascj"),u=n("FNB+"),c=n("6ZWm"),d=n("cmoc"),h=n("fWxZ"),p=n("P83h"),f=n("pnSN"),m=n("NkBu"),g=n("q5zr"),y=n("lmwz"),_=n("uWOl"),T=n("fNpk"),C=n("tGKA"),v=n("VkKB"),P=n("Zifs"),S=n("sIWg");i.LRUColorCacheEntry=(r=function(e,t){this.key=e,this.value=t},s.defineClass({name:"LRUColorCacheEntry",ctor:r}),r),i.LRUColorCache=(o=function(e){this.cachedItemsByKey_={},this.cachedItemsLRU_=[],void 0===e&&(e=50),this.maxEntries_=e},s.defineClass({name:"LRUColorCache",ctor:o,props:{get:function(e){var t;return(t=this.cachedItemsByKey_[e])?(s.remove(this.cachedItemsLRU_,t),this.cachedItemsLRU_.splice(0,0,t),t.value):null},remove:function(e){var t;(t=this.cachedItemsByKey_[e])&&(s.removeKey(this.cachedItemsByKey_,e),s.remove(this.cachedItemsLRU_,t))},add:function(e,t){(n=this.cachedItemsByKey_[e])&&(s.removeKey(this.cachedItemsByKey_,e),s.remove(this.cachedItemsLRU_,n));var n=new i.LRUColorCacheEntry(e,t);this.cachedItemsByKey_[e]=n,this.cachedItemsLRU_.splice(0,0,n);var r=this.cachedItemsLRU_.length;r>this.maxEntries_&&this.cachedItemsLRU_.splice(this.maxEntries_,r-this.maxEntries_)}}}),o),i.ImageForma=(a=function(){this.cachedBounds_=null,this.cachedContent_=null,this.avgColorCache_=new i.LRUColorCache,this.changeSubscriptions_=[]},s.defineClass({name:"ImageForma",ctor:a,superName:"Forma",statics:{KIND:{get:function(){return"Image"}},PROPERTY_CONTENTID:"content-id",PROPERTY_IMAGE_STYLE_DEPRECATED:"image-style",SCHEMA_CLASS_NAME:{get:function(){return"ImageForma"}},factory:{get:function(){return function(e,t,n,r){if(null!=t){var o=s.as(s.opt(s.opt(r,(function(e){return e.backLink})),(function(e){return e.dereference()})),f.GroupForma),i=s.as(s.opt(s.opt(r,(function(e){return e.backLink})),(function(e){return e.dereference()})),h.FormaPage);return T.LegacyCoreAssert.isTrue(null!=o||null!=i,"ImageForma needs a parent group or page",void 0,"ImageForma","ImageForma.swift",73),null!=o?a.init_3144(e,t,n,o):a.init_7dbd(e,t,n,i)}return a.init_d1c9(e,n)}}},propagateMaskContentChange:function(e){var t,n;if((t=s.opt(e,(function(e){return e.parent})))&&(n=y.ImageFacade.getImageFormaForForma(t))){var r=new p.FormaContentChangedEvent(n);n.beginUpdate(r),n.endUpdate(r)}},_implements:function(e){return"IDBObject"==e||"TheoMessageSubscriber"==e||"TheoMessagePublisher"==e}},props:{deprecatedStyle_:{get:function(){return s.as(this.get(a.PROPERTY_IMAGE_STYLE_DEPRECATED),_.ImageStyle)}},init_3144:function(e,t,n,r){s.super_init(this,u.Forma,u.Forma.prototype.init_3144,e,t,n,r),null!=this.deprecatedStyle_&&this.protectedSetStyle(this.deprecatedStyle_)},init_7dbd:function(e,t,n,r){s.super_init(this,u.Forma,u.Forma.prototype.init_7dbd,e,t,n,r),null!=this.deprecatedStyle_&&this.protectedSetStyle(this.deprecatedStyle_)},init_812f:function(e,t){for(var n={kind:function(){return a.KIND},style:function(){return _.ImageStyle.createDefault()}},r=s.clone(t),o=s.iter(n);!o.done;o.next()){var i=o.key,l=o.value;null==t[i]&&(r[i]=l())}s.super_init(this,u.Forma,u.Forma.prototype.init_812f,e,r)},init_7186:function(e){var t={kind:a.KIND,style:_.ImageStyle.createDefault()};this.init_812f(e,t)},init_d1c9:function(e,t){s.super_init(this,u.Forma,u.Forma.prototype.init_d1c9,e,t),null!=this.deprecatedStyle_&&this.protectedSetStyle(this.deprecatedStyle_)},initializeDefaultState:function(){null!=this.deprecatedStyle_&&this.protectedSetStyle(this.deprecatedStyle_),u.Forma.prototype.initializeDefaultState.call(this)},decodeController:function(){var e;null==this.controller&&(e=s.opt(this.page.document,(function(e){return e.controller})))&&(this.controller=e.controllerFactory.createController(m.ImageController.KIND,this)),u.Forma.prototype.decodeController.call(this)},className:{get:function(){return a.SCHEMA_CLASS_NAME}},updateEventForProperty:function(e){return e==a.PROPERTY_CONTENTID?new p.FormaContentChangedEvent(this):u.Forma.prototype.updateEventForProperty.call(this,e)},postDecode:function(){var e,t,n,r,o;(e=this.contentNode)&&(this.ensureContentNodeListeners(),(t=e.mediaMetadata)&&null!=(n=t.designIntent)&&(n==v.MediaMetadata.DESIGNINTENT_LOGO&&(this.intent=u.Forma.INTENT_LOGO),n==v.MediaMetadata.DESIGNINTENT_PATTERN&&(this.intent=u.Forma.INTENT_PATTERN),n==v.MediaMetadata.DESIGNINTENT_FLOATING_IMAGE&&(this.intent=u.Forma.INTENT_FLOATING_IMAGE))),this.isGridCell()&&null==this.getProperty(u.Forma.PROPERTY_INTENT)&&this.set(u.Forma.PROPERTY_INTENT,u.Forma.INTENT_GRID_CELL),(r=s.opt(this.parent,(function(e){return e.controller})))&&r.kind!=c.FrameController.KIND&&(o=s.as(this.page.createFormaWithController(d.FrameForma.KIND,c.FrameController.KIND),d.FrameForma))&&(s.opt(this.parent,(function(e){return e.appendChild(o)})),o.bounds=this.bounds,o.placement=this.placement,this.placement=C.Matrix2D.Identity,o.appendChild(this,!1),o.allowUserMove=!0),u.Forma.prototype.postDecode.call(this)},contentNode:{get:function(){var e,t;null!=(e=this.contentID)&&((!(t=this.cachedContent_)||t.id!=e)&&(this.cachedContent_=s.as(s.opt(this.page.document,(function(t){return t.content.nodeByID(e)})),g.ImageContentNode)));return this.cachedContent_},set:function(e){this.cachedContent_=e,this.contentID=s.opt(e,(function(e){return e.id}))}},contentUrl:{get:function(){return s.opt(this.contentNode,(function(e){return e.url}))}},mimeType:{get:function(){return s.opt(this.contentNode,(function(e){return e.mimeType}))}},contentID:{get:function(){return s.as(this.get(a.PROPERTY_CONTENTID),"String")},set:function(e){var t=new p.FormaContentChangedEvent(this);this.beginUpdate(t),this.removeListenersFromContentNode(),this.set(a.PROPERTY_CONTENTID,e),this.addListenersToContentNode(),this.cachedBounds_=null,s.opt(this.cachedContent_,(function(t){return t.id!=e}))&&(this.cachedContent_=null),this.avgColorCache_=new i.LRUColorCache,this.endUpdate(t),this.intent==u.Forma.INTENT_CUTOUT_MASK&&a.propagateMaskContentChange(this)}},didChangeState:function(e){u.Forma.prototype.didChangeState.call(this,e),this.intent==u.Forma.INTENT_CUTOUT_MASK&&s.keys(e).includes(a.PROPERTY_CONTENTID)&&a.propagateMaskContentChange(this)},addListenersToContentNode:function(){var e,t=this;this.intent==u.Forma.INTENT_CUTOUT_MASK&&(e=this.contentNode)&&this.changeSubscriptions_.push(e.subscribeWithCallback((function(e){return a.propagateMaskContentChange(t)}),g.ImageContentChangedMessage.TYPE))},removeListenersFromContentNode:function(){for(;0==!this.changeSubscriptions_.length;)s.opt(this.changeSubscriptions_.pop(),(function(e){return e.unsubscribe()}))},ensureContentNodeListeners:function(){this.removeListenersFromContentNode(),this.addListenersToContentNode()},match:function(e){var t,n=this.placement;if(u.Forma.prototype.match.call(this,e),t=s.as(e,a)){if(this.applyStyle(t.style),0==this.style.colors.hasReferencedColorsFromColorLibrary()){var r,o,i=this.page.colorLibraryController.applyLegacyFilterColorsAndReturnKeys(this.style);null!=(r=i.primaryKey)&&this.style.colors.setColorId(l.ColorRole.FieldPrimary,r),null!=(o=i.secondaryKey)&&this.style.colors.setColorId(l.ColorRole.FieldSecondary,o)}e.contentID!=this.contentID&&(this.placement=n)}},boundsInCoordSpace:function(e){var t;return null==this.cachedBounds_&&(t=this.contentNode)&&(this.cachedBounds_=S.TheoRect.fromXYWH(0,0,s.toDouble(t.pixelWidth),s.toDouble(t.pixelHeight))),s.opt(this.cachedBounds_,(function(t){return t.transform(e)}))},invalidateCachedBounds:function(){var e=new p.FormaBoundsInvalidatedEvent(this);this.beginUpdate(e),this.cachedBounds_=null,this.endUpdate(e)},getFocusRegion:function(){var e;return(e=s.opt(this.contentNode,(function(e){return e.focusRegion})))?e.transform(this.placement):null},getAverageEdge:function(e){var t,n=e.transform(this.placement.inverse);return(t=this.contentNode)?t.getAverageEdge(n):0},getFaceIntersections:function(e){var t,n,r=e.transform(this.placement.inverse);if((t=this.contentNode)&&(n=t.image)){var o=s.toDouble(n.getWidth())/s.toDouble(t.pixelWidth),a=s.toDouble(n.getHeight())/s.toDouble(t.pixelHeight);return n.getFaceIntersections(r.multiplyXY(o,a))}return 0},getAverageColor:function(e){var t;if((t=this.avgColorCache_.get(e.asString))&&!s.eq(P._equality_SolidColor_SolidColor,t,P.SolidColor.BLACK))return t;var n,r,o=e.transform(this.placement.inverse);if((n=this.contentNode)&&(r=n.image)){var a,i=s.toDouble(r.getWidth())/s.toDouble(n.pixelWidth),l=s.toDouble(r.getHeight())/s.toDouble(n.pixelHeight);if(a=r.getAverageColor(o.multiplyXY(i,l),s.as(this.style,_.ImageStyle)))return this.avgColorCache_.add(e.asString,a),a}return null},hasAlpha:function(){return null!=this.contentNode&&this.contentNode.hasAlpha},isImage:function(){return!0}}}),a)},fiuZ:function(e,t,n){var r,o=t,a=n("oAGj"),i=n("gXiO"),s=n("3DEm"),l=n("JO5d"),u=n("u2iI"),c=n("fAXt"),d=n("oKlP");o.ShapeFacade=(r=function(){i.CoreObject.call(this)},a.defineClass({name:"ShapeFacade",ctor:r,superName:"CoreObject",statics:{hasFillColor:function(e){for(var t=a.iter(e);!t.done;t.next()){var n,r=t.value;if((n=a.as(r.controller,l.ShapeController))&&n.primaryColorVisible())return!0}return!1},hasStrokeColor:function(e){for(var t=a.iter(e);!t.done;t.next()){var n,r=t.value;if((n=a.as(r.controller,l.ShapeController))&&n.secondaryColorVisible())return!0}return!1},canSetCornerPreScale:function(e){return!1},applyCornerPreScale:function(e,t){for(var n=a.iter(t);!n.done;n.next()){var o,i=n.value;if(o=a.as(i.controller,l.ShapeController)){var s=i.boundsInCoordSpace(i.totalPlacement),u=i.bounds,h=r.getStrokeWeightMultiplierForForma(i),p=r.getCornerOrInitialPrescaleForForma(i);o.applyCornerPreScale(e);var f=a.clone(r.getStrokeWeightMultiplierRangeForForma(i)),m=r.getCornerPrescaleForForma(i),g=Math.min(Math.max(h*p/m,f[0]),f[1]);g!=h&&r.applyStrokeWeightMultiplier(g,[i]),i.bounds=u;var y,_,T=i.boundsInCoordSpace(i.totalPlacement);if((y=a.opt(s,(function(e){return e.center})))&&(_=a.opt(T,(function(e){return e.center})))){var C=y.subtract(_);C.isEqual(d.TheoPoint.ZERO)||c.TransformFacade.translateForma(i,C)}}}},getCornerPreScaleRangeForForma:function(e){var t,n=u.ShapeStyle.PRESCALE_MIN_DEFAULT,r=u.ShapeStyle.PRESCALE_MAX_DEFAULT;return(t=a.as(e.controller,l.ShapeController))&&(n=Math.min(t.prescaleMin,n),r=Math.max(t.prescaleMax,r)),[n,r]},getCornerPrescaleForForma:function(e){var t;if(t=a.as(e.controller,l.ShapeController)){var n=t.cornerPrescale;if(null!=n)return n}return 1},getCornerOrInitialPrescaleForForma:function(e){var t;if(t=a.as(e.controller,l.ShapeController)){var n=t.cornerPrescale;return null!=n?n:t.getInitialPrescale()}return 1},getBaseCornerScaleForForma:function(e){var t;return(t=a.as(e.controller,l.ShapeController))?t.prescaleBase:u.ShapeStyle.PRESCALE_BASE_DEFAULT},canSetStrokeWeightMultiplier:function(e){for(var t=a.iter(e);!t.done;t.next()){var n,o=t.value;if(n=a.as(o.controller,l.ShapeController)){var i=a.clone(r.getStrokeWeightMultiplierRangeForForma(o));if(n.secondaryColorVisible()&&(i[0]!=u.ShapeStyle.STROKE_WEIGHT_MULTIPLIER_DEFAULT||i[1]!=u.ShapeStyle.STROKE_WEIGHT_MULTIPLIER_DEFAULT))return!0}}return!1},applyStrokeWeightMultiplier:function(e,t){for(var n=a.iter(t);!n.done;n.next()){var o,i=n.value;if(o=a.as(i.controller,l.ShapeController)){var s=Math.min(Math.max(o.strokeWeightMultiplierMin,e),o.strokeWeightMultiplierMax);o.applyStrokeWeightMultiplier(s),s>0&&r.applyStrokeColorIfNone([i])}}},applyStrokeMultiplierIfZeroStroke:function(e){for(var t=a.iter(e);!t.done;t.next()){var n,o=t.value;if((n=a.as(o.controller,l.ShapeController))&&0==n.currentStrokeWeightMultiplier){var i=a.clone(r.getStrokeWeightMultiplierRangeForForma(o)),u=s.MathUtils.getMean(i)/2;r.applyStrokeWeightMultiplier(u,[o])}}},applyZeroStrokeMultiplierIfNone:function(e){for(var t=a.iter(e);!t.done;t.next()){var n,o=t.value;(n=a.as(o.controller,l.ShapeController))&&n.hasNoneStrokeColor()&&r.applyStrokeWeightMultiplier(0,[o])}},applyBorderIfBorderIsZero:function(e){var t=e.filter((function(e){return 1==r.canSetStrokeWeightMultiplier([e])&&0==r.getStrokeWeightMultiplierForForma(e)}),this);r.applyStrokeWeightMultiplier(1,t)},applyStrokeColorIfNone:function(e){for(var t=a.iter(e);!t.done;t.next()){var n,r=t.value;(n=a.as(r.controller,l.ShapeController))&&n.hasNoneStrokeColor()&&n.assignStrokeColor()}},getStrokeWeightMultiplierRangeForForma:function(e){var t,n=u.ShapeStyle.STROKE_WEIGHT_MULTIPLIER_DEFAULT,o=u.ShapeStyle.STROKE_WEIGHT_MULTIPLIER_DEFAULT;if((t=a.as(e.controller,l.ShapeController))&&(n=Math.min(t.strokeWeightMultiplierMin,n),o=Math.max(t.strokeWeightMultiplierMax,o),t.hasNoneFillColor())){var i=r.getStrokeMultiplierIncrement(e);n=Math.max(n,i)}return[n,o]},getStrokeWeightMultiplierForForma:function(e){var t;return(t=a.as(e.controller,l.ShapeController))?t.currentStrokeWeightMultiplier:u.ShapeStyle.STROKE_WEIGHT_MULTIPLIER_DEFAULT},getStrokeBaseWeightForForma:function(e){var t;return(t=a.as(e.controller,l.ShapeController))?t.strokeBaseWeight:u.ShapeStyle.STROKE_BASE_WEIGHT_DEFAULT},getUserStrokeWeightForForma:function(e){var t=r.getStrokeWeightMultiplierForForma(e);return this.convertStrokeWeightFromModelToUserSpace(e,t)},convertStrokeWeightFromModelToUserSpace:function(e,t){var n=r.getStrokeBaseWeightForForma(e),o=r.getCornerOrInitialPrescaleForForma(e),a=e.totalPlacement.extractedScale;return s.MathUtils.nearestMultiple(n*t*o*Math.max(a.scale.x,a.scale.y),1)},convertStrokeWeightFromUserToModelSpace:function(e,t){var n=r.getStrokeBaseWeightForForma(e),o=r.getCornerOrInitialPrescaleForForma(e),a=e.totalPlacement.extractedScale;return t/(n*o*Math.max(a.scale.x,a.scale.y))},getStrokeMultiplierIncrement:function(e){var t=r.getStrokeBaseWeightForForma(e),n=r.getCornerOrInitialPrescaleForForma(e),o=e.totalPlacement.extractedScale,a=1/(t*n*Math.max(o.scale.x,o.scale.y));return 2/(t*n*Math.max(o.scale.x,o.scale.y))-a},sliderToStrokeMultiplier:function(e,t){var n=r.getStrokeMultiplierIncrement(t),o=s.MathUtils.nearestMultiple(e,n),i=a.clone(r.getStrokeWeightMultiplierRangeForForma(t));return Math.min(Math.max(o,i[0]),i[1])},getUserCornerSizeForForma:function(e){var t=r.getModelCornerPreScaleForForma(e);return r.convertCornerPreScaleFromModelToUserSpace(e,t)},getModelCornerPreScaleForForma:function(e){var t,n=u.ShapeStyle.PRESCALE_BASE_DEFAULT;return(t=a.as(e.controller,l.ShapeController))&&(n=r.getCornerOrInitialPrescaleForForma(e)/t.getInitialPrescale()),n},convertCornerPreScaleFromModelToUserSpace:function(e,t){var n,o=t;if(n=a.as(e.controller,l.ShapeController)){var i=r.getBaseCornerScaleForForma(e),u=t*n.getInitialPrescale(),c=e.totalPlacement.extractedScale;o=s.MathUtils.nearestMultiple(i*u*Math.max(c.scale.x,c.scale.y),1),o=Math.max(1,o)}return o},convertCornerPreScaleFromUserToModelSpace:function(e,t){var n,o=t;if(n=a.as(e.controller,l.ShapeController)){var i=r.getBaseCornerScaleForForma(e),s=e.totalPlacement.extractedScale;o=t/(i*Math.max(s.scale.x,s.scale.y))/n.getInitialPrescale()}return o},sliderToCornerSize:function(e,t){var n=s.MathUtils.nearestMultiple(e,.001),o=a.clone(r.getCornerPreScaleRangeForForma(t));return Math.min(Math.max(n,o[0]),o[1])}}}),r)},"gBh/":function(e,t,n){var r,o=t,a=n("oAGj"),i=n("gXiO");o.ColorThemeFacade=(r=function(){i.CoreObject.call(this)},a.defineClass({name:"ColorThemeFacade",ctor:r,superName:"CoreObject",statics:{applyColorTheme:function(e,t,n){n.colorLibraryController.applyColorTheme(e,t,!0)},shuffleColorTheme:function(e){for(var t={},n=a.iter(e);!n.done;n.next()){var r=n.value;t=a.clone(r.colorLibraryController.shuffleColorAssignmentsUsingMap(t))}},modifyColorTheme:function(e,t,n){n.colorLibraryController.setTheoColorToLibrary(e,t)}}}),r)},gpZI:function(e,t,n){var r,o,a=t,i=n("oAGj"),s=n("gXiO"),l=n("ascj"),u=n("6ZWm"),c=n("cmoc"),d=n("lmwz"),h=n("fNpk"),p=n("c+uM"),f=n("JO5d"),m=n("Zifs"),g=n("djAF"),y=n("u2iI"),_=n("umUn"),T=n("T6jX"),C=n("8t9B");a.SavedColorState=(r=function(e,t,n,r){this.formae=i.clone(e),this.colorLibraryState=t,this.primaryColorIDs=i.clone(n),this.secondaryColorIDs=i.clone(r)},i.defineClass({name:"SavedColorState",ctor:r,superName:"CoreObject"}),r),a.ColorFacade=(o=function(){s.CoreObject.call(this)},i.defineClass({name:"ColorFacade",ctor:o,superName:"CoreObject",statics:{applyColorsToForma:function(e,t,n,r){var a;void 0===n&&(n=!1),void 0===r&&(r=0);var s,h,p=r%2==0?l.ColorRole.FieldPrimary:l.ColorRole.FieldSecondary;if(e.isTypeLockup())return(s=i.opt(i.as(e.controller,C.TypeLockupController),(function(e){return e.styleController})))&&(n&&i.opt(i.opt(e.page.document,(function(e){return e.controller})),(function(e){return e.selection.inCharStyleMode=!0})),o.getDominantColorRoleOfLockup(e)==l.ColorRole.FieldSecondary&&(p=p==l.ColorRole.FieldPrimary?l.ColorRole.FieldSecondary:l.ColorRole.FieldPrimary),s.applyColors(t,p)),e;if(e instanceof c.FrameForma){if(h=T.TheoDocumentUtils.getCellBackgroundShape(e))i.opt(h.controller,(function(e){return e.applyColors(t,p)}));else if(null!=i.as(e.controller,u.FrameController))return d.ImageFacade.replaceImageWithColors(e,t)}else if(e instanceof g.ShapeForma){var f=o.getDominantColorRoleOfShape(e);i.opt(e.controller,(function(e){return e.applyColors(t,f)})),null==e.style.colors.color(l.ColorRole.FieldSecondary)||((a=i.opt(e.controller,(function(e){return e.secondaryColorVisible()})))||null!=a)&&a||i.opt(e.controller,(function(e){return e.applyColors(t,l.ColorRole.FieldSecondary)}))}else i.opt(e.controller,(function(e){return e.applyColors(t,p)}));return e},applyColorsWithRoleToForma:function(e,t,n){var r;if(void 0===n&&(n=!1),e.isTypeLockup()){if((r=i.opt(i.as(e.controller,C.TypeLockupController),(function(e){return e.styleController})))&&(n&&i.opt(i.opt(e.page.document,(function(e){return e.controller})),(function(e){return e.selection.inCharStyleMode=!0})),u=i.opt(e.controller,(function(e){return e.getCurrentColorsWithRole(r.targetedLockupStyle)})))){var a=i.clone(o.updateColorsWithRole(t,u));r.applyColorsWithRole(a)}}else if(e.isShape()){var s;if(s=i.as(e.controller,f.ShapeController)){var u=i.clone(s.getCurrentColorsWithRole(e.style));a=i.clone(o.updateColorsWithRole(t,u)),s.applyColorsWithRole(a);for(var c=i.iter(a);!c.done;c.next()){var d=c.value;if(!i.eq(m._equality_SolidColor_SolidColor,d.color,m.SolidColor.ZERO)){var h=_.TheoColor.init_5344(d.color);d.role!=l.ColorRole.FieldPrimary||s.secondaryColorVisible()?d.role!=l.ColorRole.FieldSecondary||s.primaryColorVisible()||s.applyColors([h],l.ColorRole.FieldPrimary):s.applyColors([h],l.ColorRole.FieldSecondary)}}}}return e},updateColorsWithRole:function(e,t){for(var n=t.concat(),r=i.iter(e);!r.done;r.next())for(var o=r.value,a=i.iter(n);!a.done;a.next()){var s=a.value;o.role==s.role&&(s.color=o.color.rgbColor)}return n},applyColorsToFormae:function(e,t,n,r){return void 0===n&&(n=!1),void 0===r&&(r=0),e.map((function(e){return o.applyColorsToForma(e,t,n,r)}),this)},applyNoneColorToFormae:function(e,t){return void 0===t&&(t=l.ColorRole.FieldPrimary),e.map((function(e){return h.LegacyCoreAssert.isTrue(e.kind==c.FrameForma.KIND||e.kind==g.ShapeForma.KIND,"Only frame or shape forma can have primary color as nil",void 0,"ColorFacade.applyNoneColorToFormae","ColorFacade.swift",154),e.style.colors.setColor(t,null),e}),this)},applyColorsWithRoleToFormae:function(e,t,n){return void 0===n&&(n=!1),e.map((function(e){return o.applyColorsWithRoleToForma(e,t,n)}),this)},getDominantColorRoleOfShape:function(e){var t;return e.isShape()&&(t=i.as(e.style,y.ShapeStyle))&&t.shapeType==y.ShapeType.Stroke?l.ColorRole.FieldSecondary:l.ColorRole.FieldPrimary},getDominantColorRoleOfLockup:function(e){var t;if(e.isTypeLockup()&&(t=i.opt(i.as(e.controller,C.TypeLockupController),(function(e){return e.styleController})))){var n=t.targetedLockupStyle;return n.textLook==p.LockupTextLook.KnockoutOnly||n.textLook==p.LockupTextLook.OutlineOnly?l.ColorRole.FieldSecondary:l.ColorRole.FieldPrimary}return l.ColorRole.FieldPrimary},getSavedColorState:function(e){var t,n;h.LegacyCoreAssert.isTrue(e.length>0,"empty Forma array",void 0,"ColorFacade.getSavedColorState","ColorFacade.swift",194);var r=e[0].page.colorLibraryController.recordUndoState(),o=e.map((function(e){return(t=e.style.colors.colorID(l.ColorRole.FieldPrimary))||null!=t?t:""}),this),i=e.map((function(e){return(n=e.style.colors.colorID(l.ColorRole.FieldSecondary))||null!=n?n:""}),this);return new a.SavedColorState(e,r,o,i)}}}),o)},hEh8:function(e,t,n){var r,o=t,a=n("oAGj"),i=n("RO7T"),s=n("lWlM"),l=n("iCxV"),u=n("8vXU"),c=n("rxGp");o.DCXNodeDecoder=(r=function(e,t){this.node_=t,i.BaseNodeDecoder.call(this,e),l.Host.logging.logForCategory(c.LogCategories.kDecode,"init "+a.toString(this.id)+" "+a.toString(this.name)+" "+a.toString(this.type)+" "+a.toString(this.path),u.LogLevelEnum.INFO_LEVEL)},a.defineClass({name:"DCXNodeDecoder",ctor:r,superName:"BaseNodeDecoder",statics:{_implements:function(e){return"IImportDataObject"==e}},props:{getPropertyOnNode:function(e){var t=a.as(this.node_.getValue(e),"AnyObject");return l.Host.logging.logForCategory(c.LogCategories.kDecode,a.toString(this.node_.nodeId)+" getPropertyOnNode "+e+" "+a.toString(t),u.LogLevelEnum.INFO_LEVEL),t},forEachChild:function(e){for(var t=0,n=a.iter(this.branch_.getChildrenOfNode(this.node_));!n.done;n.next()){var o=n.value;e(new r(this.branch_,o),t),t+=1}},forEachComponent:function(e){for(var t=0,n=a.iter(this.branch_.getComponentsOfNode(this.node_));!n.done;n.next()){var r=n.value;e(new s.DCXComponentDecoder(this.branch_,r),t),t+=1}}}}),r)},hndY:function(e,t,n){var r,o,a,i=t,s=n("oAGj"),l=n("OdB2"),u=n("Bcdx"),c=n("w/+j"),d=n("P83h"),h=n("iCxV"),p=n("IUM5"),f=n("fNpk"),m=n("K17h"),g=n("sq5L"),y=n("bauG"),_=n("euLT"),T=n("PlOi"),C=n("b94u"),v=n("ZA1K"),P=n("bAjp"),S=n("mj5y"),A=n("s3Tu"),D=n("t+nd"),E=n("fnrT"),R=n("uYSz"),F=n("KDc2"),I=n("T6jX"),b=n("sIWg"),O=n("qSCS");i.FormaDamage=(r=function(){this.descendants=!1,this.transform=!1},s.defineClass({name:"FormaDamage",ctor:r,props:{onlyTransform:function(){return!this.descendants&&this.transform},onlyDescendants:function(){return this.descendants&&!this.transform}}}),r),i.FormaPGMCacheEntry=(o=function(e,t){this.damage=null,this.forma=e,this.ref=t},s.defineClass({name:"FormaPGMCacheEntry",ctor:o,props:{addDamage:function(){return null==this.damage&&(this.damage=new i.FormaDamage),this.damage},damageDescendants:function(){this.addDamage().descendants=!0},damageTransform:function(){this.addDamage().transform=!0}}}),o),i.FormaPGMCache=(a=function(e,t,n){this.graph_=null,this.formaCache_={},this.mappers=u.FormaToPGMMapperFactory.instance,this.cachedGraphRef_=null,this.cachedGraph_=g.PGMGraph.EMPTY,this.validationCount_=0,this.fastValidationCount_=0,this.pageSubscription_=null,this.page=e,this.settings=t,this.adhoc=n,this.log=f.LegacyCoreAssert.newLog("FormaPGMCache-"+t.asString),this.pageSubscription_=e.subscribe(this,l.FormaEndUpdateMessage.TYPE)},s.defineClass({name:"FormaPGMCache",ctor:a,statics:{reportedFailures:{},failOnce:function(e){var t;((t=a.reportedFailures[e])||null!=t)&&t||(a.reportedFailures[e]=!0,f.LegacyCoreAssert.fail(e,void 0,"FormaPGMCache.failOnce","FormaPGMCache.swift",385))},_implements:function(e){return"TheoMessageSubscriber"==e||"FormaToPGMFactory"==e}},props:{destroy:function(){var e;(e=this.pageSubscription_)&&(s.opt(this.page,(function(t){return t.unsubscribe(e)})),this.pageSubscription_=null),s.removeAll(this.formaCache_)},onMessage:function(e){var t;if(t=s.as(e,l.FormaEndUpdateMessage)){var n,r,o=t.event.forma,a=!0;if((n=o)&&(r=this.formaCache_[n.formaID])&&(t.event instanceof d.FormaTransformChangedEvent?r.damageTransform():t.event instanceof d.FormaNullChangedEvent||t.event instanceof d.FormaAlignmentChangedEvent?a=!1:t.event instanceof d.FormaAnimationChangedEvent?this.settings.asDynamic?(this.log.info("animation changed invalidation on "+n.kind),s.removeKey(this.formaCache_,n.formaID)):a=!1:s.removeKey(this.formaCache_,n.formaID),o=n.parent),a){for(;null!=o;)s.opt(this.formaCache_[o.formaID],(function(e){return e.damageDescendants()})),o=o.parent;this.graph_=null}}},getPGMReferenceForForma:function(e){var t,n=this.formaCache_[e.formaID];if(t=this.mappers.getMapper(e)){var r,o;if(r=n){var s;if(!(s=r.damage))return r.ref;if(s.onlyTransform()&&t.canDoSimpleTransformUpdate(r))return r.ref=r.ref.withPlacement(e.placement),r.damage=null,r.ref}return this.validationCount_+=1,(o=t.makePGMRef(e,this.settings,this,n))?o.child instanceof _.PGMNullNode?null:(this.formaCache_[e.formaID]=new i.FormaPGMCacheEntry(e,o),o):(a.failOnce("Mapper at path "+I.TheoDocumentUtils.debugFormaPath(e)+" did not produce a reference."),null)}return a.failOnce("No pgm mapper available at path "+I.TheoDocumentUtils.debugFormaPath(e)+" "),null},childReferences:function(e){for(var t=[],n=s.iter(e.childrenAsArray);!n.done;n.next()){var r,o=n.value;(r=this.getPGMReferenceForForma(o))&&t.push(r)}return t},referenceForForma:function(e){return this.getPGMReferenceForForma(e)},getGraph:function(){return this.validate(),this.graph_},resourcesForGraph:function(e){var t=this,n={},r={};return e.visit((function(e){var o,i,l,u,d,f,m=null;if(o=s.as(e,y.PGMImage))m=o.contentID;else if(i=s.as(e,A.PGMVideo))m=i.contentID;else if(l=s.as(e,v.PGMSVG))m=l.contentID;else if(u=s.as(e,P.PGMText)){var g,_=u.style.font.postScriptName;if(null==r[_]&&(r[_]=u.style.font,(S=s.opt(t.page,(function(e){return e.document})))&&(g=s.opt(h.Host.fontProvider,(function(e){return e.descriptorForPostScriptName(_,S)}))))){var C;switch(g.source){case 2:C=new E.StorageSpecApplicationResource(p.CATEGORY_ID_FONT,p.FONT_RESOURCE_ID_EMBEDDED_PREFIX+_);break;case 1:case 3:C=new E.StorageSpecApplicationResource(p.CATEGORY_ID_FONT,p.FONT_RESOURCE_ID_SPARK_PREFIX+_);break;case 4:var S,I;(S=s.opt(t.page,(function(e){return e.document})))&&(I=s.opt(h.Host.brandkitManager,(function(e){return e.brandkitForDocument(S)})))?C=new R.StorageSpecExternalCC(R.StorageSpecExternalCC.BRANDKIT_SYNC_GROUP,I.id,null,_,null,null,null):(a.failOnce("can't obtain a brandkit for a custom font "+_),C=new F.StorageSpecInvalid);break;case 5:case 6:C=new D.StorageSpecAdobeFont(_);break;default:a.failOnce("unexpected font source for "+_),C=new F.StorageSpecInvalid}n["font:"+_]=new T.PGMResourceProvider("font/otf",C)}}null!=(d=m)&&(S=s.opt(t.page,(function(e){return e.document})))&&null==n[d]&&((f=s.as(S.content.nodeByID(d),O.URLBasedContentNode))?n[d]=c.FormaToPGMUtils.createResourceProviderForContentNode(f):a.failOnce("couldn't look up content by ID; no resource available"))})),new C.PGMResourceProviderList(n)},getGraphForForma:function(e){var t;return(t=this.getPGMReferenceForForma(e))?(t===this.cachedGraphRef_||(this.cachedGraph_=new g.PGMGraph(t.child,e.bounds,this.settings.asDynamic?S.PGMUtils.calculateDuration(t):0,this.resourcesForGraph(t.child)),this.cachedGraphRef_=t),this.cachedGraph_):(a.failOnce("getGraphForForma: couldn't get a reference from which to build a graph."),null)},validate:function(){var e,t;if(null==this.graph_&&(e=this.page))if(this.validationCount_=0,this.fastValidationCount_=0,t=this.getPGMReferenceForForma(e.root)){var n=0;if(this.settings.asDynamic){var r,o=!1;(r=e.animationController.animationStyle)&&(o=!r.isNoStyle()),n=o?m.MotionUtils.determineTotalDuration(e).seconds:S.PGMUtils.calculateDuration(t)}this.log.info("validate: "+this.validationCount_+" slow, "+this.fastValidationCount_+" fast");var i=e.pageSize;this.graph_=new g.PGMGraph(t.child,b.TheoRect.fromSize(i),n,this.resourcesForGraph(t.child))}else a.failOnce("failed to generate a reference for root")}}}),a)},i1Gv:function(e,t,n){var r,o,a=t,i=n("oAGj"),s=n("URxh"),l=n("iCxV");a.FormaAnimationFactory=(r=function(){this.lookup_={},this.lookup_[s.FormaAnimation.KIND]=function(){return s.FormaAnimation.createDefault()}},o={},i.defineClass({name:"FormaAnimationFactory",ctor:r,superName:"CoreObject",statics:{instance:{get:function(){return void 0===o.instance&&(o.instance=new r),o.instance}}},props:{create:function(e){var t;return null!=(t=this.lookup_[e])?t():(i.opt(l.Host.logging,(function(t){return t.warning("no constructor for forma style kind = "+e)})),null)}}}),r)},iFIB:function(e,t,n){var r,o=t,a=n("oAGj"),i=n("gXiO"),s=n("TP4q"),l=n("3v9D");o.GridLearning=(r=function(){i.CoreObject.call(this)},a.defineClass({name:"GridLearning",ctor:r,superName:"CoreObject",statics:{learnGridMappingWeights:function(e){if(0==e.length)return{weights:[],bestStyle:null};for(var t={},n=a.iter(e);!n.done;n.next()){var o=n.value,i=new s.GridScore(o.gridStyle,o.gridFrame,o.layoutItems);t[o.docID]={score:i,features:i.getFeatures()}}for(var l=new s.GridScore(e[0].gridStyle,e[0].gridFrame,e[0].layoutItems),u=a.clone(l.getWeights()),c=null,d=a.iter(a.range(0,500,!1));!d.done;d.next()){for(var h=d.value,p=a.repeat(0,u.length),f=0,m=0,g=null,y=0,_=a.iter(e);!_.done;_.next()){var T,C=t[(o=_.value).docID];if(C.score.setWeights(u),T=r.getBestGridLayout(o,u)){g=T.gridStyle,f+=C.score.score,m+=T.score;for(var v=a.clone(T.getFeatures()),P=a.iter(a.range(0,u.length,!1));!P.done;P.next())p[A=P.value]+=v[A]-C.features[A];y+=1}}if(f/=a.toDouble(e.length),m/=a.toDouble(e.length),a.info(a.toString("\nNIO iteration "+h+" G: %5.02f fInit: %5.02f fOpt: %5.02f avg mismatch %5.02f",m-f,f,m)),m-f<.001){c=g;break}for(var S=a.iter(a.range(0,u.length,!1));!S.done;S.next()){var A,D=p[A=S.value]/a.toDouble(y);u[A]+=-1*D*.01}}return{weights:u,bestStyle:c}},getBestGridLayout:function(e,t){var n=a.clone(l.LayoutSuggester.init_cb42(e,t).createSuggestions());return 0==!n.length?n[0].weightedScore:null}}}),r)},jC54:function(e,t,n){var r,o=t,a=n("oAGj"),i=n("gXiO");o.ModelWeightLibrary=(r=function(){i.CoreObject.call(this)},a.defineClass({name:"ModelWeightLibrary",ctor:r,superName:"CoreObject",statics:{weights:{DefaultDesignScore:{Maxzoomlevel:{mean:.00018027334267821125,std:.8132335406308514,weight:-.08010375273536166},textareanotcontrasting:{mean:-.0033339994317995274,std:.25020875502904477,weight:-.14415975362288352},shapesareanotcontrasting:{mean:-.0005424908444142923,std:.16815414319793917,weight:-.030270956800708296},lockupareaoutofbounds:{mean:.0003963054774770136,std:.03879175427738692,weight:-.1289655276464355},minfontsize:{mean:.4162329663731091,std:27.695820940950014,weight:.04372203001144579},maxfontsize:{mean:.4612274707747426,std:57.444985900183354,weight:.10830759811249395},mintextarea:{mean:488.9105104765153,std:89533.71385858732,weight:-.013866098359443309},maxtextarea:{mean:1325.1752065666267,std:186711.01621053327,weight:-.2361503759042213},minshapesize:{mean:-55.646916071109146,std:44574.83972690322,weight:.029270742827542353},maxshapesize:{mean:-201.25488977770246,std:46340.96127095905,weight:-.08223116203941933},lockupareaoverlapping:{mean:.00020290565299043752,std:.03925994410311496,weight:-.1636881423600194},Maxemptyspace:{mean:-.004717028998489912,std:.1976916685529546,weight:-.11662298994579136},textincorrectalign:{mean:-.004764058495477163,std:.2987539130553497,weight:-.03690998410689036},emptygridsquares:{mean:-.0007268850555160692,std:.14877245350943186,weight:-.23283917900645912},overlappingmultiplegridcells:{mean:-.008452699670100044,std:.4087079047503421,weight:-.0569178307172981},maxaspectratio:{mean:.021926589002448465,std:3.1432119741395548,weight:.21439804312559388},breakingflowX:{mean:-.006980250264133872,std:.45684350428459336,weight:.011093192112083617},breakingflowY:{mean:-.008525554047037538,std:.4077234799494897,weight:-.06308947475173525},BreakingHorisontalSymmetryinsidevisualparent:{mean:412041.9613712293,std:45212121.039130844,weight:-.034310695376294276},marginsaretoosmall:{mean:-32649.714698565716,std:4443401.694947285,weight:-.028229129254167384},balanceofvisualparentX:{mean:-.007559473558332495,std:.3227787688513554,weight:-.13312017596904124},balanceofvisualparentY:{mean:-.010450324811186476,std:.4524201239517186,weight:-.09532942482280946},totalalignmentlines:{mean:-.0009045680687471732,std:.5654767847212782,weight:.007683119790124987},CellAspectRatio:{mean:-.000866027015147402,std:1.4808460165726252,weight:-.2282126421778498},AreaPercentImages:{mean:.0011783622381679377,std:.3209991901820274,weight:.40897766247230655},ImageCellContentFit:{mean:-.0010022863121065778,std:.06839864851764367,weight:-.035663159273769146},AverageCellSize:{mean:-.003853477920843118,std:.3674675336869799,weight:-.0861206668785603},AverageImageCellSize:{mean:.0014705706334928255,std:.30689611738107436,weight:-.310870215199779},AverageTextCellSize:{mean:.0030857846907960075,std:.3190234573570835,weight:.03296304542028719},ImageCellVariance:{mean:.0008047901252859525,std:.06410991367658431,weight:-.024296079984680582},TextCellVariance:{mean:.0036032703466117107,std:.14545169804975572,weight:.08747903039684307},OverallCellVariance:{mean:.010513688422152926,std:.3036485447684895,weight:.006791166993508748},TypeSymmetryAcrosstheXAxis:{mean:.0025981146277427093,std:.43849102556669445,weight:-.2902662035011975},TypeSymmetryAcrosstheYAxis:{mean:-.0007791864813152262,std:.45283696286437347,weight:-.23419662370595393},TypeAsymmetryAcrosstheXAxis:{mean:.008912652724408086,std:.7331157676033474,weight:-.09727780755199468},TypeAsymmetryAcrosstheYAxis:{mean:.010873023708513306,std:.6982196294438795,weight:.03350849616250007},CellSymmetryAcrosstheXAxis:{mean:-.001132162147191269,std:.33392704164452364,weight:.06266679976903884},CellSymmetryAcrosstheYAxis:{mean:-.0005155668142621847,std:.33292297327240367,weight:-.058041551211506504},CellAsymmetryAcrosstheXAxis:{mean:.001132162147191268,std:.33392704164452364,weight:-.06266679976903927},CellAsymmetryAcrosstheYAxis:{mean:.0005155668139908147,std:.3329229732722636,weight:.058041551397742044},AverageImageXVal:{mean:-.0015815559988986917,std:.15008002059800904,weight:-.06098982378772082},AverageImageYVal:{mean:7891179554016043e-20,std:.1438772538377358,weight:-.10273553740768389},AverageTextXVal:{mean:.0049443186134623075,std:.25262901903129675,weight:-.025304213039208205},AverageTextYVal:{mean:.004664303074648295,std:.26747263439055524,weight:.012656120935728677},ImageSpreadinXDimension:{mean:-.00310888031836687,std:.28336827022361394,weight:.24726198560445092},ImageSpreadinYDimension:{mean:.0031367634820247538,std:.27346012927936375,weight:.1989040843352687},TextSpreadinXDimension:{mean:.00650620828022051,std:.4043232862187427,weight:-.1293283969219272},TextSpreadinYDimension:{mean:.007645995665318362,std:.40379994376989187,weight:-.011516607422389176},MaxImageXOffsetFromCenter:{mean:.0016157427991856622,std:.14246903105574066,weight:-.020089296400970874},MaxImageYOffsetFromCenter:{mean:-.0008679463633771875,std:.12934639704481982,weight:-.15444476815025124},MaxTextXOffsetFromCenter:{mean:.0007758562872193546,std:.10612718654583783,weight:-.08563320326004221},MaxTextYOffsetFromCenter:{mean:.0025601067703762033,std:.14804047677121857,weight:.0002795079579061673},TextFocused:{mean:1.1008033251432315e-9,std:3.747646504742835e-7,weight:.011466692333776875},TextDispersement:{mean:.006047062110539865,std:.38381427709455296,weight:.025895655099346427},AdjacentMatches:{mean:.001957343375687507,std:.24482209931437043,weight:-.021211802454498736},AdjacentMismatches:{mean:.005279201174289879,std:.4373270531182902,weight:.0011997430973767964},PreviousOrder:{mean:-.004296698326549073,std:.7698699665723179,weight:-.004121330693776555},PreviousPosition:{mean:.0040594447624014525,std:.4015754424391129,weight:.02671704069247397},PreviousPositionFlip:{mean:.009238177093947593,std:1.072273993426883,weight:.14746380228860045}},DefaultGridScore:{CellAspectRatio:{mean:0,std:1,weight:-.571428571428571},AreaPercentImages:{mean:0,std:1,weight:.3},ImageCellContentFit:{mean:0,std:1,weight:-10},AverageCellSize:{mean:0,std:1,weight:.4},AverageImageCellSize:{mean:0,std:1,weight:.3},AverageTextCellSize:{mean:0,std:1,weight:.2},ImageCellVariance:{mean:0,std:1,weight:-.7},TextCellVariance:{mean:0,std:1,weight:-.7},OverallCellVariance:{mean:0,std:1,weight:0},TypeSymmetryAcrosstheXAxis:{mean:0,std:1,weight:1.42857142857143},TypeSymmetryAcrosstheYAxis:{mean:0,std:1,weight:1.42857142857143},TypeAsymmetryAcrosstheXAxis:{mean:0,std:1,weight:-1.42857142857143},TypeAsymmetryAcrosstheYAxis:{mean:0,std:1,weight:-1.42857142857143},CellSymmetryAcrosstheXAxis:{mean:0,std:1,weight:.285714285714286},CellSymmetryAcrosstheYAxis:{mean:0,std:1,weight:.285714285714286},CellAsymmetryAcrosstheXAxis:{mean:0,std:1,weight:-.285714285714286},CellAsymmetryAcrosstheYAxis:{mean:0,std:1,weight:-.285714285714286},AverageImageXVal:{mean:0,std:1,weight:0},AverageImageYVal:{mean:0,std:1,weight:0},AverageTextXVal:{mean:0,std:1,weight:0},AverageTextYVal:{mean:0,std:1,weight:0},ImageSpreadinXDimension:{mean:0,std:1,weight:.571428571428571},ImageSpreadinYDimension:{mean:0,std:1,weight:.571428571428571},TextSpreadinXDimension:{mean:0,std:1,weight:.571428571428571},TextSpreadinYDimension:{mean:0,std:1,weight:.571428571428571},MaxImageXOffsetFromCenter:{mean:0,std:1,weight:0},MaxImageYOffsetFromCenter:{mean:0,std:1,weight:0},MaxTextXOffsetFromCenter:{mean:0,std:1,weight:0},MaxTextYOffsetFromCenter:{mean:0,std:1,weight:0},TextFocused:{mean:0,std:1,weight:.142857142857143},TextDispersement:{mean:0,std:1,weight:1.17142857142857},AdjacentMatches:{mean:0,std:1,weight:-2.85714285714286},AdjacentMismatches:{mean:0,std:1,weight:2.85714285714286},PreviousOrder:{mean:0,std:1,weight:-1},PreviousPosition:{mean:0,std:1,weight:-1},PreviousPositionFlip:{mean:0,std:1,weight:-.5},PreviousImageSize:{mean:0,std:1,weight:-10}}},getData:function(e,t){return a.keys(r.weights).includes(e)&&a.keys(r.weights[e]).includes(t)?r.weights[e][t]:{mean:0,std:1,weight:0}}}}),r)},"jV/A":function(e,t,n){var r,o=t,a=n("oAGj"),i=n("gXiO"),s=n("fNpk"),l=n("sIWg"),u=n("1NAc");o.PROPERTY_ID="id",o.PROPERTY_IMAGE="image",o.PROPERTY_NAME="name",o.PROPERTY_SIZE="size",o.PROPERTY_EDITING_RESOLUTION="editing-resolution",o.PROPERTY_PUBLISH_RESOLUTION="publish-resolution",o.PROPERTY_URI="uri",o.PROPERTY_LOCKUP_STRINGS="lockup-strings",o.PROPERTY_FOCUS="focus",o.PROPERTY_NUM_IMAGES="num-images",o.PROPERTY_NUM_SHAPES="num-shapes",o.PROPERTY_NUM_RETARGETABLE_BACKGROUND_IMAGES="num-retargetable-background-images",o.PROPERTY_NUM_RETARGETABLE_FLOATING_IMAGES="num-retargetable-floating-images",o.PROPERTY_EDGE_MAP="edges",o.PROPERTY_LAYOUT_ID="layout-id",o.PROPERTY_NUM_GRID_CELLS="num-grids-cells",o.PROPERTY_VISUAL_GROUP_INFO="visual-group-info",o.PROPERTY_TEXT_ROLES="text-roles",o.PROPERTY_SHAPE_ROLES="shape-roles",o.PROPERTY_SALIENT_COVERAGE="salient-coverage",o.PROPERTY_NUM_MOVEABLE="num-moveable",o.PROPERTY_NUM_GIFS="gifs-count",o.PROPERTY_CP_DOCID="cpId",o.PROPERTY_PREVIEW_URL="previewUrl",o.PROPERTY_MANIFEST_URL="manifestUrl",o.PROPERTY_FILTER_FORMAE="content-formae",o.RetargetDocumentExemplar=(r=function(e,t,n,r,o,s,l,u,c,d,h,p,f,m,g,y,_,T,C,v,P,S,A,D,E,R){this.id=e,this.cpId=n,this.previewUrl=r,this.manifestUrl=o,this.uri=d,this.name=t,this.size=s,this.editingResolution=l,this.publishResolution=u,this.image=c,this.lockupStrings=a.clone(h),this.focus=p,this.numImages=f,this.edgeMap=a.clone(m),this.layoutID=g,this.numGridCells=y,this.numMoveable=_,this.numShapes=T,this.numRetargetableBackgroundImages=C,this.numRetargetableFloatingImages=v,this.visualGroupInfo=a.clone(P),this.textRoles=a.clone(S),this.shapeRoles=a.clone(A),this.salientCoverage=D,this.gifsCount=E,this.filterFormae=a.clone(R),i.CoreObject.call(this)},a.defineClass({name:"RetargetDocumentExemplar",ctor:r,superName:"CoreObject",statics:{decodeJson:function(e){var t,n,i,c,d,h,p,f,m,g,y,_,T,C,v;if(null==e);else if(v=a.as(e,["Dictionary","String","Any"])){var P;if(null!=(P=a.as(v[o.PROPERTY_ID],"String"))){var S,A=v[o.PROPERTY_EDGE_MAP];null!=A&&null!=(I=a.clone(a.as(A,["Array","Double"])))&&(S=a.clone(I));var D=[],E=v[o.PROPERTY_LOCKUP_STRINGS];null!=E&&(I=a.as(E,["Array","String"]))&&a.append(D,I);var R=[],F=v[o.PROPERTY_TEXT_ROLES];null!=F&&(I=a.as(F,["Array","String"]))&&a.append(R,I);var I,b=[],O=v[o.PROPERTY_SHAPE_ROLES];null!=O&&(I=a.as(O,["Array","String"]))&&a.append(b,I);var k=a.clone(v[o.PROPERTY_VISUAL_GROUP_INFO]),M=a.as(v[o.PROPERTY_FOCUS],"AnyObject"),N=null!=M?M.length:0;return new r(P,(t=a.as(v[o.PROPERTY_NAME],"String"))||null!=t?t:"",(n=a.as(v[o.PROPERTY_CP_DOCID],"String"))||null!=n?n:"",(i=a.as(v[o.PROPERTY_PREVIEW_URL],"String"))||null!=i?i:"",(c=a.as(v[o.PROPERTY_MANIFEST_URL],"String"))||null!=c?c:"",u.TheoSize.decodeJson(a.as(v[o.PROPERTY_SIZE],"AnyObject"))||u.TheoSize.Zero,(d=a.as(v[o.PROPERTY_EDITING_RESOLUTION],"Double"))||null!=d?d:1,(h=a.as(v[o.PROPERTY_PUBLISH_RESOLUTION],"Double"))||null!=h?h:1,(p=a.as(v[o.PROPERTY_IMAGE],"String"))||null!=p?p:"",(f=a.as(v[o.PROPERTY_URI],"String"))||null!=f?f:"",D,null!=M&&N>0?l.TheoRect.decodeJson(M):null,(m=a.as(v[o.PROPERTY_NUM_IMAGES],"Double"))||null!=m?m:0,S,(g=a.as(v[o.PROPERTY_LAYOUT_ID],"String"))||null!=g?g:"",(y=a.as(v[o.PROPERTY_NUM_GRID_CELLS],"Double"))||null!=y?y:0,a.toDouble(D.length),(_=a.as(v[o.PROPERTY_NUM_SHAPES],"Double"))||null!=_?_:0,a.as(v[o.PROPERTY_NUM_RETARGETABLE_BACKGROUND_IMAGES],"Double"),a.as(v[o.PROPERTY_NUM_RETARGETABLE_FLOATING_IMAGES],"Double"),null!=k?k:{},R,b,(T=a.as(v[o.PROPERTY_SALIENT_COVERAGE],"Double"))||null!=T?T:0,(C=a.as(v[o.PROPERTY_NUM_GIFS],"Double"))||null!=C?C:0,a.as(v[o.PROPERTY_FILTER_FORMAE],["Array","String"]))}}else s.LegacyCoreAssert.fail("decodeJson: not a dictionary",void 0,"RetargetDocumentExemplar.decodeJson","RetargetDocumentExemplar.swift",264);return null}},props:{editingSize:{get:function(){return this.size.multiply(this.editingResolution)}},publishSize:{get:function(){return this.size.multiply(this.publishResolution)}},encodeJson:function(){var e={};return e[o.PROPERTY_ID]=this.id,e[o.PROPERTY_NAME]=this.name,e[o.PROPERTY_CP_DOCID]=this.cpId,e[o.PROPERTY_PREVIEW_URL]=this.previewUrl,e[o.PROPERTY_MANIFEST_URL]=this.manifestUrl,e[o.PROPERTY_SIZE]=this.size.encodeJson(),e[o.PROPERTY_PUBLISH_RESOLUTION]=this.publishResolution,e[o.PROPERTY_IMAGE]=this.image,e[o.PROPERTY_URI]=this.uri,e[o.PROPERTY_LOCKUP_STRINGS]=a.clone(this.lockupStrings),null!=this.focus&&(e[o.PROPERTY_FOCUS]=this.focus.encodeJson()),null!=this.edgeMap&&(e[o.PROPERTY_EDGE_MAP]=a.clone(this.edgeMap)),e[o.PROPERTY_NUM_IMAGES]=this.numImages,e[o.PROPERTY_LAYOUT_ID]=this.layoutID,e[o.PROPERTY_NUM_GRID_CELLS]=this.numGridCells,e[o.PROPERTY_NUM_MOVEABLE]=this.numMoveable,e[o.PROPERTY_NUM_SHAPES]=this.numShapes,e[o.PROPERTY_NUM_RETARGETABLE_BACKGROUND_IMAGES]=this.numRetargetableBackgroundImages,e[o.PROPERTY_NUM_RETARGETABLE_FLOATING_IMAGES]=this.numRetargetableFloatingImages,e[o.PROPERTY_VISUAL_GROUP_INFO]=a.clone(this.visualGroupInfo),e[o.PROPERTY_TEXT_ROLES]=a.clone(this.textRoles),e[o.PROPERTY_SHAPE_ROLES]=a.clone(this.shapeRoles),e[o.PROPERTY_SALIENT_COVERAGE]=this.salientCoverage,e[o.PROPERTY_NUM_GIFS]=this.gifsCount,null!=this.filterFormae&&(e[o.PROPERTY_FILTER_FORMAE]=a.clone(this.filterFormae)),e}}}),r)},kSRw:function(e,t,n){var r,o=t,a=n("oAGj"),i=n("fWxZ"),s=n("pnSN"),l=n("fNpk");o.SmartGroupForma=(r=function(){},a.defineClass({name:"SmartGroupForma",ctor:r,superName:"GroupForma",statics:{KIND:{get:function(){return"smart-group"}},PROPERTY_BOUNDS_DEPRECATED:"bounds",PROPERTY_CLIPMODE:"clipmode",SCHEMA_CLASS_NAME:{get:function(){return"SmartGroupForma"}},factory:{get:function(){return function(e,t,n,o){if(null!=t){var u=a.as(a.opt(a.opt(o,(function(e){return e.backLink})),(function(e){return e.dereference()})),s.GroupForma),c=a.as(a.opt(a.opt(o,(function(e){return e.backLink})),(function(e){return e.dereference()})),i.FormaPage);return l.LegacyCoreAssert.isTrue(null!=u||null!=c,"SmartGroupForma needs a parent group or page",void 0,"SmartGroupForma","SmartGroupForma.swift",28),null!=u?s.GroupForma.init_3144(e,t,n,u):s.GroupForma.init_7dbd(e,t,n,c)}return r.init_d1c9(e,n)}}},_implements:function(e){return"IDBObject"==e||"TheoMessageSubscriber"==e||"TheoMessagePublisher"==e}},props:{init_3144:function(e,t,n,r){a.super_init(this,s.GroupForma,s.GroupForma.prototype.init_3144,e,t,n,r)},init_7dbd:function(e,t,n,r){a.super_init(this,s.GroupForma,s.GroupForma.prototype.init_7dbd,e,t,n,r)},init_812f:function(e,t){for(var n={kind:function(){return r.KIND}},o=a.clone(t),i=a.iter(n);!i.done;i.next()){var l=i.key,u=i.value;null==t[l]&&(o[l]=u())}a.super_init(this,s.GroupForma,s.GroupForma.prototype.init_812f,e,o)},init_7fcf:function(e,t){var n={kind:t};this.init_812f(e,n)},init_d1c9:function(e,t){a.super_init(this,s.GroupForma,s.GroupForma.prototype.init_d1c9,e,t)},className:{get:function(){return r.SCHEMA_CLASS_NAME}}}}),r)},kVgh:function(e,t,n){var r,o=t,a=n("oAGj"),i=n("dJuF"),s=n("ZhwN"),l=n("fNpk"),u=n("Quhx");o.ColorSwatch=(r=function(){},a.defineClass({name:"ColorSwatch",ctor:r,superName:"PostDCXObject",statics:{SCHEMA_CLASS_NAME:"ColorSwatch",PROPERTY_NUM_TAGS:"numTags",PROPERTY_TAG_KEY_PREFIX:"key-",PROPERTY_TAG_VALUE_PREFIX:"value-",PROPERTY_TAGS:"tags",_implements:function(e){return"IDBObject"==e||"TheoMessagePublisher"==e}},props:{init_7e49:function(e,t,n){this.parent_=n,a.super_init(this,u.PostDCXObject,u.PostDCXObject.prototype.init_3181,n.database,t,e)},init_d0e4:function(e){for(var t=e.database,n={path:function(){return s.GUIDUtils.makeGUID()}},r={},o=a.iter(n);!o.done;o.next()){var i=o.key,l=o.value;r[i]=l()}this.parent_=e,a.super_init(this,u.PostDCXObject,u.PostDCXObject.prototype.init_5079,t,{},r,"")},className:{get:function(){return r.SCHEMA_CLASS_NAME}},parent:{get:function(){return this.parent_}},numTags:{get:function(){var e;return(e=a.as(this.get(r.PROPERTY_NUM_TAGS),"Int"))||null!=e?e:0},set:function(e){this.set(r.PROPERTY_NUM_TAGS,e)}},rawTags_:{get:function(){for(var e,t,n={},o=a.iter(a.range(0,this.numTags,!1));!o.done;o.next()){var i=o.value,s=(e=a.opt(this.getProperty(r.PROPERTY_TAG_KEY_PREFIX+a.toString(i)),(function(e){return e.stringValue})))||null!=e?e:"",l=(t=a.opt(this.getProperty(r.PROPERTY_TAG_VALUE_PREFIX+a.toString(i)),(function(e){return e.stringValue})))||null!=t?t:"";n[s]=l}return n},set:function(e){for(var t=0,n=this.numTags,o=a.iter(e);!o.done;o.next()){var s=o.key,l=o.value,u=r.PROPERTY_TAG_KEY_PREFIX+a.toString(t),c=r.PROPERTY_TAG_VALUE_PREFIX+a.toString(t);this.setProperty(u,i.DBProperty.stringProperty(i.DBNamePath.init_b14a(u),s)),this.setProperty(c,i.DBProperty.stringProperty(i.DBNamePath.init_b14a(c),l)),t+=1}if(this.numTags=t,t<n)for(var d=a.iter(a.range(t,n,!1));!d.done;d.next()){var h=d.value;this.removeProperty(r.PROPERTY_TAG_KEY_PREFIX+a.toString(h)),this.removeProperty(r.PROPERTY_TAG_VALUE_PREFIX+a.toString(h))}}},tags:{get:function(){return a.keys(this.rawTags_)}},tag:function(e){return this.rawTags_[e]},contains:function(e){return null!=this.rawTags_[e]},clearTags:function(){this.rawTags_={}},match:function(e){this.clearTags();for(var t=a.iter(e.tags);!t.done;t.next()){var n=t.value;this.setTag(n,e.tag(n))}},setTag:function(e,t){var n=a.clone(this.rawTags_);null==t?a.removeKey(n,e):n[e]=t,this.rawTags_=a.clone(n)},publish:function(e){a.opt(this.parent_,(function(t){return t.publishForChild(e)}))},solidRepresentation:{get:function(){return l.LegacyCoreAssert.fail("stub",void 0,"ColorSwatch","ColorSwatch.swift",107),null}},kind:{get:function(){return l.LegacyCoreAssert.fail("stub",void 0,"ColorSwatch","ColorSwatch.swift",112),""}}}}),r)},kYI4:function(e,t,n){var r,o=t,a=n("oAGj"),i=n("0wFF"),s=n("CWW7"),l=n("gXiO"),u=n("yGNn"),c=n("ascj"),d=n("gBh/"),h=n("QgZx"),p=n("ZK0l"),f=n("iCxV"),m=n("3lr5"),g=n("8vXU"),y=n("q5zr"),_=n("fdtz"),T=n("rxGp"),C=n("fNpk"),v=n("c+uM"),P=n("VkKB"),S=n("358a"),A=n("umUn"),D=n("VJ9E"),E=n("8t9B");o.AUTHORING_CONTEXT_TYPE_LOGO="LOGO",o.AUTHORING_CONTEXT_TYPE_FONT="FONT",o.AUTHORING_CONTEXT_TYPE_COLOR="COLOR",o.SPARK_LOGO_ROLE_PRIMARY="primary-logo",o.SPARK_LOGO_ROLE_SECONDARY="secondary-logo",o.SPARK_LOGO_ROLE_POST_STAMP="post-stamp",o.IAuthoringContextManager=a.defineProtocol("IAuthoringContextManager",{authoringContexts:"Array<IAuthoringContext>",authoringContext:"(String) -> IAuthoringContext",getOwnedAuthoringContextIDs:"() -> Array<String>",getDefaultBrandIdFromServer:"() -> String",createAuthoringContext:"(String, Boolean) -> IAuthoringContext"}),o.IAuthoringContext=a.defineProtocol("IAuthoringContext",{id:"String",name:"String",activated:"Boolean",isDefault:"Boolean",contextID:"String",urn:"String",colors:"Array<IAuthoringContextColor>",fonts:"Array<IAuthoringContextFont>",logos:"Array<IAuthoringContextLogo>",isMinimal:"Boolean",isValidVersion:"Boolean",ownedByCurrentUser:"Boolean",isBrandkitComplete:"() -> Boolean"}),o.IAuthoringContextColor=a.defineProtocol("IAuthoringContextColor",{id:"String",acRoles:"Array<String>",red:"Double",green:"Double",blue:"Double",alpha:"Double"}),o.IAuthoringContextFont=a.defineProtocol("IAuthoringContextFont",{id:"String",acRoles:"Array<String>",sourceType:"String",descriptor:"FontDescriptor"}),o.IAuthoringContextLogo=a.defineProtocol("IAuthoringContextLogo",{id:"String",acRoles:"Array<String>",acName:"String",url:"String",pixelWidth:"Integer",pixelHeight:"Integer",mimeType:"String"}),o.BrandingFacade=(r=function(){l.CoreObject.call(this)},a.defineClass({name:"BrandingFacade",ctor:r,superName:"CoreObject",statics:{brandifyDocument:function(e,t,n,o,a){return void 0===n&&(n=!0),void 0===o&&(o=!0),void 0===a&&(a=!0),C.LegacyCoreAssert.isTrue(""!=t.id,"need a valid authoring context to brandify",void 0,"BrandingFacade.brandifyDocument","BrandingFacade.swift",122),r.addBrandLogo(e,t,o).then((function(o){return a&&r.brandifyColors(e,t),n&&r.brandifyFonts(e,t),null}))},addBrandLogo:function(e,t,n){void 0===n&&(n=!0);var i=u.CorePromise.resolve(null);if(n){var l,c=t.logos.filter((function(e){return!a.isEmpty(e.url)&&e.acRoles.includes(o.SPARK_LOGO_ROLE_POST_STAMP)}),this);if(l=a.first(c))for(var d=a.iter(e);!d.done;d.next()){var h,p=d.value;if((h=p.document)&&null==a.first(p.root.filterWithCallback((function(e){return e.isLogo()&&e.kind==_.ImageForma.KIND})))){var f=r.makeLogoContentNode(l,h);i=i.then((function(e){return s.CreationFacade.addContent(p,f,void 0,void 0,new s.AddFormaParams(void 0,void 0,null))}))}}}return i},brandifyColors:function(e,t,n){void 0===n&&(n=!1),r.updateBrandedColorPalette(e,t,n)},updateBrandColorsForPage:function(e,t,n){for(var r=a.iter(t);!r.done;r.next()){var o,i=r.value;if(e)if(null!=(u=i.root.controller.getGridController())){C.LegacyCoreAssert.isTrue(u.gridStyle.gridCells.length>=1,"expecting to have a grid with at least one cell",void 0,"BrandingFacade.updateBrandColorsForPage","BrandingFacade.swift",191);var s=u.forma.childAt(0).style.colors.colorID(c.ColorRole.FieldPrimary);null!=s&&(o=i.colorLibraryController.getTheoColorForKey(s))}else{var l=i.root.style.colors.colorID(c.ColorRole.FieldPrimary);null!=l&&(o=i.colorLibraryController.getTheoColorForKey(l))}if(i.colorLibraryController.applyColorTheme(n,"brandkit"),e&&null!=o){var u,h=i.colorLibraryController.getKeyOfColorInTheme(o);null==h&&(h=i.colorLibraryController.addNewThemeKeyWithColor(o)),null!=(u=i.root.controller.getGridController())?u.forma.childAt(0).style.colors.setColorId(c.ColorRole.FieldPrimary,h):i.root.style.colors.setColorId(c.ColorRole.FieldPrimary,h)}}e||d.ColorThemeFacade.shuffleColorTheme(t)},updateBrandedColorPalette:function(e,t,n){for(var o=0,i=0,s=[],l=a.iter(e);!l.done;l.next())l.value.colorLibraryController.getTheoColorsUsedInPage(s);for(var u=a.iter(s);!u.done;u.next()){var c=u.value;c.isBrandkitSecondaryColor()&&(i+=1),c.isBrandkitShade()&&(o+=1)}for(var d=i>0&&i>=o,h=[],p=a.iter(t.colors);!p.done;p.next()){var m=p.value,y=A.TheoColor.init_bb45(m);(d&&(y.isBrandkitSecondaryColor()||y.isBrandkitPrimaryColor())||!d&&y.isBrandkitShade())&&h.push(y)}h.length>0?r.updateBrandColorsForPage(n,e,h):f.Host.logging.logForCategory(T.LogCategories.kMultibrand,"addBranding asked to update color palette, but brandkit doesn't have any colors. Hope that's ok.",g.LogLevelEnum.INFO_LEVEL)},brandifyFonts:function(e,t){var n;if(n=a.opt(a.first(e),(function(e){return e.document})))for(var o=r.getHeadlineFontForBrandify(n,t),i=a.iter(e);!i.done;i.next()){var s=i.value;if(null!=o){for(var l=!1,u=a.iter(s.root.filterWithCallback((function(e){return e.isTypeLockup()})));!u.done;u.next()){var c,d=u.value;(c=a.as(d.style,v.LockupStyle))&&(c.font=o,l=!0)}0==l&&f.Host.logging.logForCategory(T.LogCategories.kMultibrand,"addBranding asked to apply fonts, but document contains no text lockups, so we can't. Hope that's ok.",g.LogLevelEnum.INFO_LEVEL)}}},getHeadlineFontForBrandify:function(e,t){var n=r.getTheoFontForRole(D.TheoFont.SPARK_FONT_ROLE_HEADLINE,t);if(null==n)if(t.fonts.length>0){var o,a=t.fonts[0];(o=r.getFontFromIncludedFonts(a.descriptor))?n=D.TheoFont.init_9e5c(o,a.id,a.acRoles):(f.Host.logging.logForCategory(T.LogCategories.kMultibrand,"addBranding asked to apply fonts, but brandkit doesn't have a headline font, so we're just picking some random font. Hope that's ok.",g.LogLevelEnum.INFO_LEVEL),n=D.TheoFont.init_9e5c(f.Host.fontProvider.getIncludedFonts(e).fontAt(0)))}else f.Host.logging.logForCategory(T.LogCategories.kMultibrand,"addBranding asked to apply fonts, but brandkit doesn't have any fonts. Hope that's ok.",g.LogLevelEnum.INFO_LEVEL);return n},whichUserUploadedFontsWillBeUsedInBrandify:function(e,t){var n,o=[];if((n=r.getHeadlineFontForBrandify(e,t))&&n.fontData.source==h.FontSource.USER_UPLOAD)for(var i=a.iter(e.filterWithCallback((function(e){return e.isTypeLockup()})));!i.done;i.next()){var s=i.value;if(null!=a.as(s.style,v.LockupStyle)){o.push(n.fontData.touaName);break}}return o},getCustomFontsForBrand:function(e){return e.fonts.filter((function(e){var t;return null!=(t=e.sourceType)&&"user-uploaded"==t}),this)},getCustomFontNamesForBrand:function(e){var t;return e.fonts.filter((function(e){var t;return null!=(t=e.sourceType)&&"user-uploaded"==t}),this).map((function(e){return(t=a.opt(e.descriptor,(function(e){return e.touaName})))||null!=t?t:""}),this).filter((function(e){return""!=e}),this)},getEmbeddableFontNamesForBrand:function(e){var t;return e.fonts.filter((function(e){var t;return null!=(t=e.sourceType)&&"user-uploaded"==t&&a.opt(e.descriptor,(function(e){return e.fsType==h.FontEmbeddability.INSTALLABLE}))}),this).map((function(e){return(t=a.opt(e.descriptor,(function(e){return e.touaName})))||null!=t?t:""}),this).filter((function(e){return""!=e}),this)},getTheoFontForRole:function(e,t){for(var n,o=a.iter(t.fonts);!o.done;o.next()){var i,s=o.value;if(i=r.getFontFromIncludedFonts(s.descriptor)){var l=D.TheoFont.init_9e5c(i,s.id,s.acRoles);if(l.getSparkFontRole()==e){n=l;break}}}return n},getFontFromIncludedFonts:function(e){if(null==e)return null;var t,n=f.Host.fontProvider.getIncludedFonts(m.ANY_DOCUMENT);return null!=(t=n.indexOf(e))?n.fontAt(t):null},changeBranding:function(e,t){return u.CorePromise.resolve(null).then((function(n){return null==t?""==e.authoringContextID?null:r.removeBranding(e):e.authoringContextID==t.id?null:""==e.authoringContextID?(a.opt(f.Host.brandkitManager,(function(e){return e.activateBrand(t.id)})),null):r.addBranding(e,t)}))},addBranding:function(e,t){C.LegacyCoreAssert.isTrue(""!=t.id,"need a valid authoring context to add branding",void 0,"BrandingFacade.addBranding","BrandingFacade.swift",484);var n=[];return S.PagesFacade.visitPages(e,(function(e){return n.push(e),!0})),r.applyLogoForAddBranding(e,t).then((function(o){return a.opt(f.Host.fontProvider,(function(e){return e.registerBrandFonts(t.id)})),r.applyBrandFontsForAddBranding(n,t),r.applyColorsForAddBranding(n,t),a.opt(f.Host.brandkitManager,(function(e){return e.activateBrand(t.id)})),e.setAuthoringContext(t),null}))},applyLogoForAddBranding:function(e,t){for(var n=[],o=a.iter(e.filterWithCallback((function(e){return e.isLogo()&&e.kind==_.ImageForma.KIND})));!o.done;o.next()){var i=o.value;n.push(i)}for(var l=u.CorePromise.resolve(null),c=a.iter(n);!c.done;c.next()){var d=c.value,h=a.as(e.content.nodeByID(d.contentID),y.ImageContentNode),p=r.getReplacementLogoContentNode(e,t,h.getSparkLogoRole());null!=p&&(l=l.then((function(e){return s.CreationFacade.addContent(d.page,p,void 0,void 0,new s.AddFormaParams(void 0,void 0,d.parent))})))}return l},applyColorsForAddBranding:function(e,t){for(var n=[],r=a.iter(t.colors);!r.done;r.next()){var o=r.value;n.push(A.TheoColor.init_bb45(o))}if(n.length>0)for(var i=a.iter(e);!i.done;i.next())i.value.colorLibraryController.updateSparkColorsByRole(n)},applyBrandFontsForAddBranding:function(e,t){for(var n,r=[],o=a.iter(t.fonts);!o.done;o.next()){var i=o.value,s=D.TheoFont.init_a314(i);r.push(s),s.getSparkFontRole()==D.TheoFont.SPARK_FONT_ROLE_BODY&&(n=s)}for(var l=a.iter(e);!l.done;l.next())for(var u=l.value,c=a.iter(u.root.filterWithCallback((function(e){return e.isTypeLockup()})));!c.done;c.next()){var d,h=c.value;if(d=a.as(h.style,v.LockupStyle)){var p;if((p=d.font)&&p.isSparkFont()){for(var f,m=n,g=a.iter(r);!g.done;g.next())if(i=g.value,p.getSparkFontRole()==i.getSparkFontRole()){m=i;break}(f=m)&&(d.font=f)}for(var y=a.iter(d.characterStyles);!y.done;y.next()){var _,T=y.value;if((_=T.font)&&_.isSparkFont()){m=n;for(var C=a.iter(r);!C.done;C.next())if(i=C.value,_.getSparkFontRole()==i.getSparkFontRole()){m=i;break}null!=m&&(T.font=m)}}}}},whichUserUploadedFontsWouldBeUsedInBrandSwitch:function(e,t,n){var r,o,i=[];if((r=t)&&(o=n)){var s,l=[];a.opt(f.Host.fontProvider,(function(e){return e.registerBrandFonts(o.id)}));for(var u=a.iter(o.fonts);!u.done;u.next()){var c=u.value,d=D.TheoFont.init_a314(c);d.fontData.source==h.FontSource.USER_UPLOAD&&(l.push(d),d.getSparkFontRole()==D.TheoFont.SPARK_FONT_ROLE_BODY&&(s=d))}if(a.opt(f.Host.fontProvider,(function(e){return e.refreshBrandkitFonts(r.id)})),0==!l.length)for(var p=a.iter(e.filterWithCallback((function(e){return e.isTypeLockup()})));!p.done;p.next()){var m,g=p.value;if(m=a.as(g.style,v.LockupStyle)){var y;if((y=m.font)&&y.isSparkFont()){for(var _=s,T=a.iter(l);!T.done;T.next())if(c=T.value,y.getSparkFontRole()==c.getSparkFontRole()){_=c;break}null!=(S=a.opt(_,(function(e){return e.fontData.touaName})))&&(i.includes(S)||i.push(S))}for(var C=a.iter(m.characterStyles);!C.done;C.next()){var P;if((P=C.value.font)&&P.isSparkFont()){_=s;for(var S,A=a.iter(l);!A.done;A.next())if(c=A.value,P.getSparkFontRole()==c.getSparkFontRole()){_=c;break}null!=(S=a.opt(_,(function(e){return e.fontData.touaName})))&&(i.includes(S)||i.push(S))}}}}}return i},getReplacementLogoContentNode:function(e,t,n){for(var i,s=a.iter(t.logos);!s.done;s.next())for(var l=s.value,u=a.iter(l.acRoles);!u.done;u.next()){var c=u.value;if(c==n)return r.makeLogoContentNode(l,e);c==o.SPARK_LOGO_ROLE_PRIMARY&&(i=l)}return null!=i?r.makeLogoContentNode(i,e):null},removeBranding:function(e){return r.removeAllBrandkitFontsAndLogos(e),e.setAuthoringContext(null),u.CorePromise.resolve(null)},removeAllBrandkitFontsAndLogos:function(e){var t;if(t=e.controller)for(var n=a.iter(e.filterWithCallback((function(e){return e.isTypeLockup()||e.isLogo()})));!n.done;n.next()){var o=n.value;if(o.isTypeLockup()){var i,s;if((i=a.as(o.style,v.LockupStyle))&&(s=i.font)&&s.isSparkFont()){var l=r.getNonBKFontForRemapping(s);f.Host.logging.logForCategory(T.LogCategories.kMultibrand,"Replacing brandkit font "+s.fontData.postScriptName+" with non-BK font "+l.postScriptName,g.LogLevelEnum.INFO_LEVEL),i.font=D.TheoFont.init_9e5c(l)}}else{var u;t.selection.deselectForma(o),(u=o.parent)&&a.opt(a.as(u.controller,p.GroupController),(function(e){return e.removeFormaFromGroup(o)}));var c=o.controller.settings;null!=c&&c==t.controllerSettingsState.settings&&(t.controllerSettingsState.settings=null)}}else C.LegacyCoreAssert.fail("Document has no controller",void 0,"BrandingFacade.removeAllBrandkitFontsAndLogos","BrandingFacade.swift",729)},getNonBKFontForRemapping:function(e){return e.fontData.source==h.FontSource.EMBEDDED?e.fontData:e.fontData.serif?e.fontData.blackness>=7?r.getFontWithPostscriptName("Lora-Regular"):e.fontData.italic?r.getFontWithPostscriptName("OldStandardTT-Italic"):r.getFontWithPostscriptName("Lora-Regular"):e.fontData.calligraphic?r.getFontWithPostscriptName("Yellowtail"):e.fontData.blackness>=7?r.getFontWithPostscriptName("SourceSansPro-Black"):e.fontData.italic?r.getFontWithPostscriptName("CallunaSans-Italic"):r.getFontWithPostscriptName("Raleway")},getFontWithPostscriptName:function(e){return f.Host.fontProvider.descriptorForPostScriptName(e,m.ANY_DOCUMENT)},brandDocumentForElement:function(e,t,n){var r=f.Host.brandkitManager.brandkitForElement(t,n);C.LegacyCoreAssert.isTrue(null!=r,"Adding a branded element but can't find the brandkit it belongs to",{elementType:n},"BrandingFacade.brandDocumentForElement","BrandingFacade.swift",776),a.opt(f.Host.logging,(function(e){return e.logToAnalytics(i.AnalyticsConstants.kAnalyticsDataBrandkitElementUsed,{elementType:n})})),null!=r&&(""==e.authoringContextID?(f.Host.logging.logForCategory(T.LogCategories.kMultibrand,"** Branding document, because it now contains a branded element of type "+n,g.LogLevelEnum.INFO_LEVEL),a.opt(f.Host.logging,(function(t){return t.logToAnalytics(i.AnalyticsConstants.kAnalyticsEventAddedBrandingToProject,{projectID:e.uuid})}))):e.authoringContextID!=r.id&&f.Host.logging.logForCategory(T.LogCategories.kMultibrand,"** Re-Branding document, because it was branded (for a different brand) and now contains a branded element of type "+n,g.LogLevelEnum.INFO_LEVEL),e.setAuthoringContext(r))},unBrandDocumentIfNoBrandedElements:function(e){""!=e.authoringContextID&&(r.doesDocumentContainBrandedElements(e,!1)||(e.setAuthoringContext(null),f.Host.logging.logForCategory(T.LogCategories.kMultibrand,"** Unbranding document, because it no longer contains any branded elements",g.LogLevelEnum.INFO_LEVEL)))},isDocumentBranded:function(e,t){return""!=e.authoringContextID&&(!t||r.getDocumentBrandedElementsUsage(e,!0).length>0)},kBrandUsageColor:"color",kBrandUsageFont:"font",kBrandUsageCustomFont:"customFont",kBrandUsageLogo:"logo",getDocumentBrandedElementsUsage:function(e,t,n){void 0===n&&(n=!0);var o=!1,i=!1,s=!1,l=!1,u=[];if(!t&&r.areAnySparkColorsInUse(e)&&(u.push(r.kBrandUsageColor),o=!0,1==n))return u;for(var c=a.iter(e.filterWithCallback((function(e){return e.isLogo()||e.isTypeLockup()})));!c.done;c.next()){var d=c.value;if(d.isTypeLockup())!i&&r.doesLockupUseBrandedFonts(d)&&(u.push(r.kBrandUsageFont),i=!0),!s&&r.doesLockupUseCustomFonts(d)&&(u.push(r.kBrandUsageCustomFont),s=!0);else if(!l&&d.isLogo()&&null!=d.contentID){var h;(h=a.as(e.content.nodeByID(d.contentID),y.ImageContentNode))&&null!=h.sparkElementID&&""!=h.sparkElementID&&(u.push(r.kBrandUsageLogo),l=!0)}if(n&&(o||i||s||l))return u;if(o&&i&&s&&l)break}return u},doesDocumentContainBrandedElements:function(e,t){return r.getDocumentBrandedElementsUsage(e,t).length>0},areSparkFontsInUse:function(e,t){if(0==t.length)return!1;for(var n=a.iter(e.filterWithCallback((function(e){return e.isTypeLockup()})));!n.done;n.next()){var r,o=n.value;if(r=a.as(o.style,v.LockupStyle)){var i;if((i=r.font)&&null!=i.sparkElementID&&i.sparkElementID.length>0&&t.includes(i.sparkElementID))return!0;for(var s=a.iter(r.characterStyles);!s.done;s.next()){var l;if((l=s.value.font)&&null!=l.sparkElementID&&l.sparkElementID.length>0&&t.includes(l.sparkElementID))return!0}}}return!1},updateSparkFont:function(e,t){for(var n=!1,r=a.iter(e.filterWithCallback((function(e){return e.isTypeLockup()})));!r.done;r.next()){var o,i=r.value;if(o=a.as(i.style,v.LockupStyle)){var s;if(s=o.font){var l=s.sparkElementID;null!=l&&l.length>0&&l==t.id&&(n=!0,o.font=D.TheoFont.init_a314(t))}for(var u=a.iter(o.characterStyles);!u.done;u.next()){var c=u.value;null!=c.font&&null!=c.font.sparkElementID&&c.font.sparkElementID.length>0&&c.font.sparkElementID==t.id&&(n=!0,c.font=D.TheoFont.init_a314(t))}}}C.LegacyCoreAssert.isTrue(n,"asked to update spark font which isn't currently used.",void 0,"BrandingFacade.updateSparkFont","BrandingFacade.swift",999)},relinkSparkFont:function(e,t,n){for(var r=!1,o=a.iter(e.filterWithCallback((function(e){return e.isTypeLockup()})));!o.done;o.next()){var i,s=o.value;if(i=a.as(s.style,v.LockupStyle)){var l;if(l=i.font){var u=l.sparkElementID;null!=u&&u.length>0&&u==t&&(r=!0,i.font=D.TheoFont.init_a314(n))}for(var c=a.iter(i.characterStyles);!c.done;c.next()){var d=c.value;null!=d.font&&null!=d.font.sparkElementID&&d.font.sparkElementID.length>0&&d.font.sparkElementID==t&&(r=!0,d.font=D.TheoFont.init_a314(n))}}}C.LegacyCoreAssert.isTrue(r,"asked to relink spark font which isn't currently used.",void 0,"BrandingFacade.relinkSparkFont","BrandingFacade.swift",1038)},doesLockupUseBrandedFonts:function(e){var t;if(t=a.as(e.style,v.LockupStyle)){var n;if((n=t.font)&&null!=n.sparkElementID&&n.sparkElementID.length>0)return!0;for(var r=a.iter(t.characterStyles);!r.done;r.next()){var o=r.value;if(null!=o.font&&null!=o.font.sparkElementID&&o.font.sparkElementID.length>0)return!0}}else C.LegacyCoreAssert.fail("doesLockupUseBrandedFonts called for something which is not a type lockup",void 0,"BrandingFacade.doesLockupUseBrandedFonts","BrandingFacade.swift",1071);return!1},doesLockupUseCustomFonts:function(e){var t;if(t=a.as(e.style,v.LockupStyle)){var n;if((n=t.font)&&n.fontData.source==h.FontSource.USER_UPLOAD)return!0;for(var r=a.iter(t.characterStyles);!r.done;r.next()){var o=r.value;if(null!=o.font&&o.font.fontData.source==h.FontSource.USER_UPLOAD)return!0}}else C.LegacyCoreAssert.fail("doesLockupUseCustomFonts called for something which is not a type lockup",void 0,"BrandingFacade.doesLockupUseCustomFonts","BrandingFacade.swift",1106);return!1},areSparkLogosInUse:function(e,t){if(0==t.length)return!1;for(var n=a.iter(e.filterWithCallback((function(e){return e.isLogo()&&e.kind==_.ImageForma.KIND})));!n.done;n.next()){var r,o=n.value;if((r=a.as(e.content.nodeByID(o.contentID),y.ImageContentNode))&&null!=r.sparkElementID&&""!=r.sparkElementID&&t.includes(r.sparkElementID))return!0}return!1},updateSparkLogo:function(e,t){for(var n=!1,o=a.iter(e.filterWithCallback((function(e){return e.isLogo()&&e.kind==_.ImageForma.KIND})));!o.done;o.next()){var i=o.value,l=a.as(e.content.nodeByID(i.contentID),y.ImageContentNode);if(a.opt(l,(function(e){return null!=e.sparkElementID&&a.opt(l,(function(e){return""!=e.sparkElementID}))&&t.id==a.opt(l,(function(e){return e.sparkElementID}))}))){n=!0;var u=r.makeLogoContentNode(t,e);s.CreationFacade.addContent(i.page,u,void 0,void 0,new s.AddFormaParams(void 0,void 0,i.parent))}}C.LegacyCoreAssert.isTrue(n,"asked to update spark logo which isn't currently used.",void 0,"BrandingFacade.updateSparkLogo","BrandingFacade.swift",1158)},relinkSparkLogo:function(e,t,n){for(var o=!1,i=a.iter(e.filterWithCallback((function(e){return e.isLogo()&&e.kind==_.ImageForma.KIND})));!i.done;i.next()){var l=i.value,u=a.as(e.content.nodeByID(l.contentID),y.ImageContentNode);if(a.opt(u,(function(e){return null!=e.sparkElementID&&a.opt(u,(function(e){return""!=e.sparkElementID}))&&t==a.opt(u,(function(e){return e.sparkElementID}))}))){o=!0;var c=r.makeLogoContentNode(n,e);s.CreationFacade.addContent(l.page,c,void 0,void 0,new s.AddFormaParams(void 0,void 0,l.parent))}}C.LegacyCoreAssert.isTrue(o,"asked to relink spark logo which isn't currently used.",void 0,"BrandingFacade.relinkSparkLogo","BrandingFacade.swift",1182)},isImageBrandedLogo:function(e){var t;return!(null==e.contentID||!(t=a.as(e.page.document.content.nodeByID(e.contentID),y.ImageContentNode))||!e.isLogo()||null==t.sparkElementID||""==t.sparkElementID)},makeLogoContentNode:function(e,t){var n=t.content.createNode(y.ImageContentNode.KIND,null);return n.url=e.url,n.pixelWidth=e.pixelWidth,n.pixelHeight=e.pixelHeight,n.mimeType=e.mimeType,n.setRoles(e.acRoles),n.sparkElementID=e.id,n.mediaMetadata=P.MediaMetadata.init_4d41(void 0,void 0,void 0,void 0,void 0,void 0,"brandkit",void 0,void 0,void 0,void 0,P.MediaMetadata.DESIGNINTENT_LOGO),n},areSparkColorsInUse:function(e,t){if(0==t.length)return!1;var n=!1;return S.PagesFacade.visitPages(e,(function(e){return!e.colorLibraryController.areSparkColorsInUse(t)||(n=!0,!1)})),n},areAnySparkColorsInUse:function(e){var t=!1;return S.PagesFacade.visitPages(e,(function(e){return!e.colorLibraryController.areAnySparkColorsInUse()||(t=!0,!1)})),t},updateSparkColor:function(e,t){S.PagesFacade.visitPages(e,(function(e){return e.colorLibraryController.updateSparkColor(A.TheoColor.init_bb45(t)),!0}))},getBrandkitColorsForUI:function(e,t){var n,r,o=!1,i=[];if((n=a.as(a.opt(t,(function(e){return e.controller})),E.TypeLockupController))&&n.styleController.isCurrentlyShowingMultipleColors()){o=!0;var s=n.lockupStyle.colors.theoColor(c.ColorRole.FieldPrimary),l=n.lockupStyle.colors.theoColor(c.ColorRole.FieldSecondary);null!=s&&s.isBrandkitColor()&&null!=l&&l.isBrandkitColor()&&(i=[s,l])}for(var u=[],d=a.iter(e.colors);!d.done;d.next()){var h=d.value,p=A.TheoColor.init_bb45(h);if(0==o)u.push([p]),p.isBrandkitPrimaryColor()&&(r=p,p.isBrandkitShade()&&u.push([A.TheoColor.init_bb45(h)]));else{var f=0,m="";if(p.isBrandkitPrimaryColor())r=p,f=5;else if(p.isBrandkitSecondaryColor())f=3;else if(p.isBrandkitShade()){f=1;var g=p.getBrandkitShadeRole();if(g.startsWith(A.SHADE_ROLE_PREFIX)){var y=g.substr(A.SHADE_ROLE_PREFIX.length),_=(a.toInt(y)+3)%7;m=A.SHADE_ROLE_PREFIX+a.toString(_)}}else f=1;for(var T=0,C=a.clone(a.shuffle(e.colors)),v=a.iter(C);!v.done;v.next()){var P=v.value,S=A.TheoColor.init_bb45(P);if((""==m&&Math.abs(p.rgbColor.lightness-S.rgbColor.lightness)>30||m==S.getBrandkitShadeRole())&&(u.push([p,S]),(T+=1)>=f))break}}}if(o&&i.length>0){for(var D=!1,R=a.iter(u);!R.done;R.next()){var F=R.value;if(F[0].sparkElementID==i[0].sparkElementID&&F[1].sparkElementID==i[1].sparkElementID){D=!0;break}}D||u.push(i)}return a.sortInPlace(u,(function(e,t){var n=e[0],o=t[0];if(null!=r){if(n===r)return o!==r;if(o===r)return!1}if(n.isBrandkitSecondaryColor())return!o.isBrandkitSecondaryColor()||n.rgbColor.lightness<o.rgbColor.lightness;if(o.isBrandkitSecondaryColor())return!1;var a=n.getBrandkitShadeRole(),i=o.getBrandkitShadeRole();return null!=a?null==i||a<i:null==i&&n.rgbColor.lightness<o.rgbColor.lightness})),u},getTheoColorForSolidColor:function(e,t){if(null!=e)for(var n=a.iter(e.colors);!n.done;n.next()){var r=n.value,o=A.TheoColor.init_bb45(r);if(o.rgbColor.isEqual(t))return o}return A.TheoColor.init_5344(t,null,null)}}}),r)},kwVJ:function(e,t,n){var r,o=t,a=n("oAGj"),i=n("IUM5"),s=n("tGKA"),l=n("Ird5"),u=n("jfma"),c=n("sq5L"),d=n("bauG"),h=n("yjxF"),p=n("Aj79"),f=n("PlOi"),m=n("g6aL"),g=n("fnrT"),y=n("sIWg");o.PGMWatermarkingUtils=(r=function(){},a.defineClass({name:"PGMWatermarkingUtils",ctor:r,statics:{WATERMARK_ENTITY:"watermark",WATERMARK_GROUP_ENTITY:"add-watermark-group",WATERMARK_CONTENT_TYPE:"image/png",WATERMARK_RESOURCE_ID:"watermark-spark.png",WATERMARK_V2_RESOURCE_ID:"watermark-spark-v2.png",WATERMARK_EXPRESS_RESOURCE_ID:"watermark-express.png",WATERMARK_WIDTH:743,WATERMARK_HEIGHT:80,WATERMARK_SCALE:.5,addWatermark:function(e){var t,n,o=new d.PGMImage(r.WATERMARK_ENTITY,h.PGMNodeMetadata.EMPTY,l.PGMAnimationList.EMPTY,y.TheoRect.fromXYWH(0,0,r.WATERMARK_WIDTH,r.WATERMARK_HEIGHT),r.WATERMARK_EXPRESS_RESOURCE_ID),_=new p.PGMReference(o,new u.PGMCompositingParams(s.Matrix2D.translationXY(e.bounds.width-r.WATERMARK_WIDTH,e.bounds.height-r.WATERMARK_HEIGHT).scaleXYfromPoint(e.bounds.evalXY(1,1),r.WATERMARK_SCALE,r.WATERMARK_SCALE)));return t=(n=a.as(e.root,m.PGMSimpleGroup))?n.withEntityAndChildren(n.entity,n.children.concat([_])):new m.PGMSimpleGroup(r.WATERMARK_GROUP_ENTITY,h.PGMNodeMetadata.EMPTY,l.PGMAnimationList.EMPTY,[new p.PGMReference(e.root),_]),new c.PGMGraph(t,e.bounds,e.duration,e.resources.adding(o.contentID,new f.PGMResourceProvider(r.WATERMARK_CONTENT_TYPE,new g.StorageSpecApplicationResource(i.CATEGORY_ID_IMAGES,r.WATERMARK_EXPRESS_RESOURCE_ID))))}}}),r)},lJxM:function(e,t,n){var r,o=t,a=n("oAGj"),i=n("HRWw"),s=n("A6KL"),l=n("fNpk"),u=n("x4Gy");o.TextContentNode=(r=function(){},a.defineClass({name:"TextContentNode",ctor:r,superName:"ContentNode",statics:{KIND:{get:function(){return"text"}},SCHEMA_CLASS_NAME:{get:function(){return"TextContentNode"}},factory:{get:function(){return function(e,t,n,o){var i=a.as(a.opt(a.opt(o,(function(e){return e.backLink})),(function(e){return e.dereference()})),s.GroupContentNode);return l.LegacyCoreAssert.isTrue(null!=i,"Content nodes need a parent",void 0,"TextContentNode","TextContentNode.swift",16),r.init_3144(e,t,n,i)}}},PROPERTY_TEXT_MODEL:"text-model",_implements:function(e){return"IDBObject"==e||"TheoMessagePublisher"==e}},props:{init_3144:function(e,t,n,r){a.super_init(this,i.ContentNode,i.ContentNode.prototype.init_3144,e,t,n,r)},init_5972:function(e,t){a.super_init(this,i.ContentNode,i.ContentNode.prototype.init_8b5c,e,"text",t),this.set(r.PROPERTY_TEXT_MODEL,u.ContentTextModel.init_d41d())},className:{get:function(){return r.SCHEMA_CLASS_NAME}},textModel:{get:function(){return this.get(r.PROPERTY_TEXT_MODEL)},set:function(e){this.set(r.PROPERTY_TEXT_MODEL,e)}},text:{get:function(){return this.textModel.text},set:function(e){this.textModel.text=e}},insertTextUsingSubstring:function(e){this.textModel.insertTextUsingSubstring(e)},replaceText:function(e){this.textModel.replaceText(e)},subscribeWithCallbackToTextModel:function(e,t){return this.textModel.subscribeWithCallback(e,t)},match:function(e,t){var n;void 0===t&&(t=null),(n=a.as(e,r))&&this.textModel.match(n.textModel),i.ContentNode.prototype.match.call(this,e,t)}}}),r)},lWlM:function(e,t,n){var r,o=t,a=n("oAGj"),i=n("gXiO"),s=n("iCxV");o.DCXComponentDecoder=(r=function(e,t){this.branch_=e,this.component_=t,i.CoreObject.call(this)},a.defineClass({name:"DCXComponentDecoder",ctor:r,superName:"CoreObject",statics:{_implements:function(e){return"IImportDataComponent"==e}},props:{id:{get:function(){return this.component_.componentId}},name:{get:function(){return this.component_.name}},path:{get:function(){return this.component_.path}},mimeType:{get:function(){return this.component_.type}},etag:{get:function(){return this.component_.etag}},url:{get:function(){var e;return null!=(e=this.branch_.getPathForComponent(this.component_))?a.opt(s.Host.persistUtils,(function(t){return t.fileUrlForPath(e)})):null}}}}),r)},lmwz:function(e,t,n){var r,o=t,a=n("oAGj"),i=n("0wFF"),s=n("SpAV"),l=n("aO0D"),u=n("SDMx"),c=n("gpZI"),d=n("CWW7"),h=n("gXiO"),p=n("yGNn"),f=n("Bpjk"),m=n("ascj"),g=n("FNB+"),y=n("6ZWm"),_=n("cmoc"),T=n("JEzR"),C=n("P83h"),v=n("9Lk3"),P=n("ZK0l"),S=n("6Rk9"),A=n("4mVB"),D=n("ZhwN"),E=n("iCxV"),R=n("xYeW"),F=n("8vXU"),I=n("kJ8p"),b=n("IUM5"),O=n("Qlvz"),k=n("U010"),M=n("q5zr"),N=n("fdtz"),L=n("uWOl"),x=n("fNpk"),B=n("tGKA"),w=n("VkKB"),G=n("358a"),Y=n("uxH+"),U=n("K0Rh"),V=n("JO5d"),j=n("djAF"),H=n("35Q0"),W=n("fAXt"),K=n("8t9B"),X=n("oKlP"),z=n("sIWg"),q=n("zjod");o.ImageFacade=(r=function(){h.CoreObject.call(this)},a.defineClass({name:"ImageFacade",ctor:r,superName:"CoreObject",statics:{disableCCStorageForDeepcut:!0,replaceImageWithColors:function(e,t){var n=e;if(e instanceof _.FrameForma||e instanceof N.ImageForma&&e.parent instanceof _.FrameForma){var r,o,i=a.as(e,_.FrameForma)||e.parent;(r=a.as(e.parent,U.RootForma))?(d.CreationFacade.deleteFormae([i],null),null!=t&&c.ColorFacade.applyColorsToForma(r,t),n=r):(n=i,(o=a.opt(a.as(i.controller,y.FrameController),(function(e){return e.replaceWithColoredShape()})))&&(null!=t?c.ColorFacade.applyColorsToForma(o,t):a.opt(o.controller,(function(e){return e.shuffleColorAssignment()})),n=o))}return n},replaceImagesWithColors:function(e,t){return e.map((function(e){return r.replaceImageWithColors(e,t)}),this)},applyImageFilter:function(e,t,n){a.clone(n?r.getBackgroundImagesFromPage(G.PagesFacade.getActivePage(e.document)):e.selection.asFormaArray()).forEach((function(e){var n;if(n=r.getImageFormaForForma(e)){t.adjustments=O.ImageAdjustments.createDefault();var o=n.style;t.adjustments=o.adjustments,r.applyImageStyle(t,[e])}}))},applyImageStyle:function(e,t){for(var n=a.iter(t);!n.done;n.next()){var o,i=n.value;(o=r.getImageFormaForForma(i))&&(a.opt(a.opt(o.root,(function(e){return e.animation})),(function(e){return e.invalidate()})),o.applyStyle(e))}},getImageStyleForForma:function(e){var t;return(t=r.getImageFormaForForma(e))?a.as(t.style,L.ImageStyle):null},isFrame:function(e){return e instanceof _.FrameForma},getImageContentForForma:function(e){var t;return(t=r.getImageFormaForForma(e))?t.contentNode:null},getImageFormaForForma:function(e){var t,n,r;if(t=a.as(e,N.ImageForma))return t;if(n=a.as(e,q.VideoForma))return n;if((r=a.as(e,_.FrameForma))&&r.childCount>0){for(var o=a.iter(r.childrenAsArray);!o.done;o.next()){var i,s=o.value;if(i=a.as(s,N.ImageForma))return i}return null}return null},getMaskFormaForFormaByIntent:function(e,t){var n;return(n=r.getFrameFormaForForma(e))?n.findAuxiliary((function(e){return e.hasIntent(t)})):a.opt(e,(function(e){return 1==e.hasIntent(t)}))?e:null},getMaskFormaForForma:function(e){return r.getMaskFormaForFormaByIntent(e,g.Forma.INTENT_IMAGE_MASK)},getCutoutMaskFormaForForma:function(e){return a.as(r.getMaskFormaForFormaByIntent(e,g.Forma.INTENT_CUTOUT_MASK),N.ImageForma)},setCutoutModeForForma:function(e,t){var n,o,i;if((n=r.getFrameFormaForForma(e))&&(o=r.getImageFormaForForma(e))&&(i=a.as(n.style,T.FrameStyle))){var s=new C.FormaCutoutChangedEvent(o);o.beginUpdate(s),i.cutoutMode=t,o.endUpdate(s)}},getCutoutModeForForma:function(e){var t,n;return(t=r.getFrameFormaForForma(e))&&(n=a.as(t.style,T.FrameStyle))?n.cutoutMode:k.CutoutMode.Off},getVideoFormaForForma:function(e){var t;return(t=a.as(e,_.FrameForma))&&t.childCount>0?a.as(t.childAt(0),q.VideoForma):a.as(e,q.VideoForma)},getFrameFormaForForma:function(e){var t,n;return(t=a.as(a.opt(e,(function(e){return e.parent})),_.FrameForma))?t:(n=a.as(e,N.ImageForma))?a.as(n.parent,_.FrameForma):a.as(e,_.FrameForma)},getBackgroundImagesFromPage:function(e){for(var t=[],n=a.iter(e.root.filterWithCallback((function(e){return e.kind==_.FrameForma.KIND&&e.isBackgroundImage()&&e.childCount>0})));!n.done;n.next()){var r=n.value;t.push(r.childAt(0))}return t},getCropRatioId:function(e){var t;return(t=r.getFrameFormaForForma(e))?t.cropRatioId:f.CropRatioPresetLibrary.FREEFORM_ID},setImageCropToFreeform:function(e){var t;if((t=r.getFrameFormaForForma(e))&&t.cropRatioId!=f.CropRatioPresetLibrary.FREEFORM_ID){var n=new C.FormaTransformChangedEvent(t);t.beginUpdate(n),t.cropRatioId=f.CropRatioPresetLibrary.FREEFORM_ID,t.endUpdate(n)}},usesFreeformCropPreset:function(e){return r.getCropRatioId(e)==f.CropRatioPresetLibrary.FREEFORM_ID},migrateImageRotationToFrame:function(e,t){var n,r,o=e.placement.transformValues;if((n=t.bounds)&&(r=t.parent)){var a=Math.atan2(o.rotSine,o.rotCosine);if(Math.abs(a)>.001){var i=B.Matrix2D.rotation(o.rotCosine,o.rotSine),s=B._asterisk_TheoPoint_Matrix2D(n.evalXY(.5,.5),t.totalPlacement),l=B._asterisk_Matrix2D_Matrix2D(B._asterisk_Matrix2D_Matrix2D(B.Matrix2D.translation(X._negate_TheoPoint(s)),i),B.Matrix2D.translation(s)),u=B._asterisk_Matrix2D_Matrix2D(B._asterisk_Matrix2D_Matrix2D(r.totalPlacement,l),r.totalPlacement.inverse);t.move(u),W.TransformFacade.rotateForma(e,-a),o=e.placement.transformValues}}return o},resetCrop:function(e,t){var n,o,i,s;if(void 0===t&&(t=!0),(n=r.getFrameFormaForForma(e))&&(o=a.as(n.controller,y.FrameController))&&(i=e.bounds)&&(s=e.page.root.bounds)){var l=s.insetXY(10,10),u=e.finalFrame||l,c=u.center,d=new C.FormaTransformChangedEvent(n);n.beginUpdate(d);for(var h=r.migrateImageRotationToFrame(e,n),p=h.xscale,m=h.yscale,g=!1,_=0;!g&&_<10;){var T=i.transform(B.Matrix2D.scalingXY(p,m)),v=z.TheoRect.fromSize(T.size);o.setBoundsWithCropType(v,y.CropType.FitBorder);var P=(u=e.finalFrame||l).center;if(o.move(B.Matrix2D.translation(X._minus_TheoPoint_TheoPoint(c,P))),t)if(0==e.totalPlacement.transformPoints(i.points).filter((function(e){return l.containsPoint(e)}),this).length){u=e.finalFrame||l;var S=l.intersectionWith(u)||l,A=Math.max(u.width/S.width,u.height/S.height);A=Math.max(A,1.05),0==_&&(c=S.center),p/=A,m/=A,_+=1}else g=!0;else g=!0}10==_&&a.opt(E.Host.logging,(function(e){return e.warning("resetCrop did not converge")})),n.cropRatioId=f.CropRatioPresetLibrary.ORIGINAL_ID,n.endUpdate(d),o.updateCropModeImage()}},cropImageToRatio:function(e,t,n){var o,i,s,l,u;if(void 0===t&&(t=0),void 0===n&&(n=null),r.canCropImage(e)){if(r.removeMaskForForma(e),(i=r.getFrameFormaForForma(e))&&(s=r.getImageFormaForForma(e))&&(l=s.finalFrame)&&(u=s.bounds)){var c,d;t<=0?(d=u.aspectRatio,c=f.CropRatioPresetLibrary.ORIGINAL_ID):(d=t,c=(o=f.CropRatioPresetLibrary.getIdForRatio(t))||null!=o?o:f.CropRatioPresetLibrary.FREEFORM_ID);var h=i.controller,p=l.origin,m=new C.FormaTransformChangedEvent(i);i.beginUpdate(m);var g=n||i.bounds,_=z.TheoRect.fromSize(g.fitAspectRatioWithin(d)),T=h.isImageCropped()?y.CropType.PreserveFocusAndScale:y.CropType.FitBorder;h.setBoundsWithCropType(_,T);var v=a.opt(s.finalFrame,(function(e){return e.origin}))||X.TheoPoint.ZERO;h.move(B.Matrix2D.translation(X._minus_TheoPoint_TheoPoint(p,v))),i.cropRatioId=c,i.endUpdate(m),h.updateCropModeImage()}}else a.opt(E.Host.logging,(function(e){return e.warning("Asked to crop an image that can't be.")}))},snapFrameToVisibleImage:function(e,t){var n,o;if((n=a.opt(e.finalFrame,(function(e){return e.center})))&&(o=a.as(t.controller,y.FrameController))){var i,s,l=new C.FormaTransformChangedEvent(t);t.beginUpdate(l),(i=r.calcSnapFrameToVisibleImageBounds(e,t))&&(o.setBoundsWithCropType(i,y.CropType.PreserveFocusAndScale),(s=a.opt(e.finalFrame,(function(e){return e.center})))&&o.move(B.Matrix2D.translation(X._minus_TheoPoint_TheoPoint(n,s)))),t.endUpdate(l)}},calcSnapFrameToVisibleImageBounds:function(e,t,n){var o,i;if(void 0===n&&(n=.99),(o=e.bounds)&&(i=t.bounds)){var s=e.placement,l=s.transformValues,u=Math.atan2(l.rotSine,l.rotCosine);if(Math.abs(u)<.001)return r.calcSnapFrameToVisibleImageBoundsUnrotated(o,i,s,n);var c=a.clone(S.GeometryFacade.getIntersectionPolygon(i,o,B.Matrix2D.Identity,e.placement));if(S.GeometryFacade.areaOfConvexPolygon(c)<n*i.area){var d=B.Matrix2D.rotation(Math.cos(u),Math.sin(u)),h=S.GeometryFacade.centerOfPolygon(c),p=t.totalPlacement.transformPoint(h);return W.TransformFacade.justTransformFormaInPageSpaceAboutPoint(t,d,p),W.TransformFacade.justTransformFormaInPageSpaceAboutPoint(e,d.inverse,p),s=e.placement,r.calcSnapFrameToVisibleImageBoundsUnrotated(o,i,s,n)}}return null},calcSnapFrameToVisibleImageBoundsUnrotated:function(e,t,n,r){var o;return void 0===r&&(r=.99),(o=n.transformRect(e).intersectionWith(t))&&o.area<r*t.area?o:null},inCropMode:function(e){return r.pageInCropMode(a.opt(e,(function(e){return e.page})))},pageInCropMode:function(e){var t;return null!=(t=a.opt(a.opt(a.opt(e,(function(e){return e.document})),(function(e){return e.controller})),(function(e){return e.selection.inCropMode})))&&t},enterCropMode:function(e){var t,n;return!(!(t=a.as(a.opt(e.parent,(function(e){return e.controller})),y.FrameController))||!(n=a.opt(e.controller,(function(e){return e.owner})))||(n.selection.inCropMode=!0,t.enterCropMode(),0))},exitCropMode:function(e){var t;if((r=a.as(a.opt(e.parent,(function(e){return e.controller})),y.FrameController))&&(t=a.opt(e.controller,(function(e){return e.owner})))&&(t.selection.inCropMode=!1,r.cleanupCropVisualization()),a.as(e.controller,Y.RootController)&&(t=a.opt(e.controller,(function(e){return e.owner})))){t.selection.inCropMode=!1;for(var n=a.iter(e.filterByKind(_.FrameForma.KIND));!n.done;n.next()){var r,o=n.value;(r=a.as(o.controller,y.FrameController))&&r.cleanupCropVisualization()}}},getTempCropImageForForma:function(e){var t;if(t=a.opt(a.opt(e,(function(e){return e.parent})),(function(e){return e.visitAsArray(g.FormaTraversal.JustChildren)})))for(var n=a.iter(t);!n.done;n.next()){var r=n.value;if(r.hasIntent(g.Forma.INTENT_TEMP_IMAGE_CROP)&&r.kind==_.FrameForma.KIND)return r}return null},canSetBackgroundImage:function(e){var t,n;return!(!(t=a.as(e,_.FrameForma))||!(n=t.controller))&&e.isImage()&&!t.isLogo()&&n.floating&&!e.isSticker()&&!n.userGroupMember},canSetFloatingImage:function(e){var t,n;return!(!(t=e)||!(n=t.controller))&&t.isImage()&&!t.isLogo()&&!n.floating&&!t.isVideo()&&!n.userGroupMember},canApplyCutout:function(e){var t;return!!(t=e)&&t.isImage()&&!t.isLogo()&&!t.isVideo()&&!t.isSticker()},canApplyBackgroundColor:function(e){var t,n;return!(!(t=a.as(e,_.FrameForma))||!(n=a.as(t.controller,y.FrameController)))&&t.isImage()&&(n.isBackgroundImageWithAlpha()||n.hasCutout)},isPotentialBackgroundImage:function(e){var t;return!!(t=a.as(e,_.FrameForma))&&(!t.isLogo()&&!t.isSticker()&&!t.controller.userGroupMember||t.isBackgroundImage())},isFloatingImage:function(e){var t,n;return!(!(t=a.as(e,_.FrameForma))||!(n=t.controller))&&n.floating},canCropImage:function(e){var t,n;return!(!(t=r.getFrameFormaForForma(e))||!(n=t.controller))&&!t.isLogo()&&n.floating&&!e.isSticker()},addHiddenImageToGrid:function(e){var t,n,o;(t=a.opt(a.as(a.opt(e.root,(function(e){return e.controller})),Y.RootController),(function(e){return e.getGridController()})))&&(n=a.as(e,_.FrameForma))&&(o=r.getImageFormaForForma(n))&&(o.style.opacity=1,o.intent=g.Forma.INTENT_GRID_CELL,n.intent=g.Forma.INTENT_GRID_CELL,n.allowUserMove=!1,t.removeFormaFromGroup(n),t.addFormaToGroup(n))},setBackgroundImage:function(e){e.isBackgroundImage()||(x.LegacyCoreAssert.isTrue(r.canSetBackgroundImage(e),"asked to pin an image that can't be pinned",void 0,"ImageFacade.setBackgroundImage","ImageFacade.swift",669),r.setBackgroundOrFloatingImage(e,!0))},setFloatingImage:function(e){var t;(t=e.controller)&&t.floating||(x.LegacyCoreAssert.isTrue(r.canSetFloatingImage(e),"asked to float an image that can't be floated",void 0,"ImageFacade.setFloatingImage","ImageFacade.swift",679),r.setBackgroundOrFloatingImage(e,!1))},setBackgroundOrFloatingImage:function(e,t){var n,o,i,s;if(!(e.isBackgroundImage()&&t||!e.isBackgroundImage()&&!t)&&(n=a.opt(a.as(a.opt(e.root,(function(e){return e.controller})),Y.RootController),(function(e){return e.getGridController()})))&&(o=a.as(e,_.FrameForma))&&(i=r.getImageFormaForForma(o))&&(s=o.finalFrame)){var l,u=a.opt(i.finalFrame,(function(e){return e.intersectionWith(s)})),c=new C.FormaStyleChangedEvent(n.forma);n.forma.beginUpdate(c),t&&(r.formaHasMask(o)&&r.removeMaskForForma(e),a.opt(i.controller,(function(e){return e.rotate(o.rotationInRadians())})),i.style.opacity=1,o.cropRatioId=f.CropRatioPresetLibrary.FREEFORM_ID,null!=(l=n.getBasicShapeLayoutColor())&&a.opt(e.root,(function(e){return e.style.colors.setColorId(m.ColorRole.FieldPrimary,l)})));var d=!1;if(!t&&null!=n.formaMappingSwiftDict[o.formaID]){var h=n.gridStyle.name.includes(A.GridStyle.SINGLE_LAYOUT_NAME)||n.gridStyle.name.includes(A.GridStyle.BALANCED_LAYOUT_NAME)||n.gridStyle.name==A.GridStyle.CUSTOM_LAYOUT_NAME;(n.getBackgroundShapes().length>0||!h)&&(n.removeFormaWithoutGridModification(o),d=!0)}if(d||n.removeFormaFromGroup(o),o.allowUserMove=!t,o.intent=t?g.Forma.INTENT_GRID_CELL:g.Forma.INTENT_FLOATING_IMAGE,i.intent=t?g.Forma.INTENT_GRID_CELL:g.Forma.INTENT_FLOATING_IMAGE,!t){var p=s.center;(null!=u?u.area/s.area:1)<.8?(o.bounds=z.TheoRect.fromSize(u.size),p=u.center):o.bounds=a.opt(o.bounds,(function(e){return e.scale(.95,new X.TheoPoint(0,0))})),o.moveCenterToPoint(p)}if(n.addFormaToGroupWithCurrentImage(o),!t){var y,T=o.parent,v=a.clone(T.filterByControllerKind(K.TypeLockupController.KIND));if(v.length>0){for(var P,S=v[0];null!=S&&null==T.indexOfChild(S);)S=S.parent;(P=S)?T.insertBefore(o,P,!0):x.LegacyCoreAssert.fail("Parenting confusion while moving image to fore; not reordering",void 0,"ImageFacade.setBackgroundOrFloatingImage","ImageFacade.swift",791)}(y=r.getCutoutMaskFormaForForma(o))&&r.setTightCropToCutoutMask(o,y,!1)}n.forma.endUpdate(c)}},getFrameForForma:function(e){var t;return(t=a.as(e,_.FrameForma))?t:e instanceof N.ImageForma||e instanceof q.VideoForma?a.as(e.parent,_.FrameForma):null},logCutoutProgressToAnalytics:function(e,t,n,r){var o;if(void 0===r&&(r=null),o=E.Host.logging){var a,i={mode:t,duration:n,platformID:o.platformID()};null!=(a=r)&&(i.error=a),o.logToNewRelic(e,i)}},generateMaskFromImageBytes:function(e,t,n){var o,i,s,l,u;return(o=a.opt(e.contentNode,(function(e){return e.image})))&&null!=(i=e.mimeType)&&(s=E.Host.network)&&(l=E.Host.dataFactory)&&(u=E.Host.logging)?o.getImageRepresentationData(i,n).then((function(e){var n;if(n=a.as(e,R.HostDataProtocol)){t.data=l.createFromFormData({file:new R.HostNetworkFormDatum(n,"masksource")});var o=u.getCurrentTime();return s.request(t).then((function(e){return r.logCutoutProgressToAnalytics(F.RemoteLoggingEvent.CUTOUT_SUCCESS,"upload",a.toInt(1e3*(u.getCurrentTime()-o))),e})).fail((function(e){var t,n=e;return r.logCutoutProgressToAnalytics(F.RemoteLoggingEvent.CUTOUT_ERROR,"upload",a.toInt(1e3*(u.getCurrentTime()-o)),a.toString(n)),(t=a.as(n,I.HostNetworkError))&&(n=k.ImageCutoutErrorLibrary.mapServerErrorToMaskError(t)),p.CorePromise.reject(n)}))}return x.LegacyCoreAssert.fail("Failed to get resized image.",void 0,"ImageFacade.generateMaskFromImageBytes","ImageFacade.swift",880),p.CorePromise.reject("Failed to get resized image.")})):(x.LegacyCoreAssert.fail("Invalid image data or Host instance(s).",void 0,"ImageFacade.generateMaskFromImageBytes","ImageFacade.swift",885),p.CorePromise.reject("Invalid image data or Host instance(s)."))},generateMaskFromCCStorageImage:function(e,t){var n,o,i,s,l,u,c;if((n=a.opt(e.contentNode,(function(e){return e.image})))&&(o=e.contentNode)&&null!=(i=n.getStoragePath(o))&&(s=E.Host.network)&&(l=E.Host.dataFactory)&&(u=E.Host.logging)&&(c=l.createFromString("cc-storage://"+i,"text/plain"))){t.data=l.createFromFormData({url:new R.HostNetworkFormDatum(c)});var d=u.getCurrentTime();return s.request(t).then((function(e){return r.logCutoutProgressToAnalytics(F.RemoteLoggingEvent.CUTOUT_SUCCESS,"cc-storage",a.toInt(1e3*(u.getCurrentTime()-d))),e})).fail((function(e){var t,n=e,o=a.toString(n);return(t=a.as(n,I.HostNetworkError))&&(t.type==I.HostNetworkErrorType.NotFound&&(o="image not found on CC Storage"),n=k.ImageCutoutErrorLibrary.mapServerErrorToMaskError(t)),r.logCutoutProgressToAnalytics(F.RemoteLoggingEvent.CUTOUT_ERROR,"cc-storage",a.toInt(1e3*(u.getCurrentTime()-d)),o),p.CorePromise.reject(n)}))}return x.LegacyCoreAssert.fail("Invalid image data or Host instance(s).",void 0,"ImageFacade.generateMaskFromCCStorageImage","ImageFacade.swift",937),p.CorePromise.reject("Invalid image data or Host instance(s).")},setModelVersionFromResponse:function(e,t){var n,r;(n=e.headers)&&null!=(r=n["x-version"])&&(t.modelVersion=r,t.model==k.ImageCutoutModelLibrary.CURRENT_MODEL&&k.ImageCutoutModelLibrary.instance.setModelVersion(r))},processNetworkResponseAndSaveImage:function(e,t){var n,o;return(n=a.as(e,I.HostNetworkResponse))&&(o=n.data)?(r.setModelVersionFromResponse(n,t),E.Host.network.saveImageComponent(o,n.mimeType)):p.CorePromise.reject("Invalid network response")},generateCutoutMaskForImage:function(e,t,n,o){var i;return void 0===o&&(o=!1),(i=r.getImageFormaForForma(e))?k.ImageCutoutModelLibrary.buildMaskNetworkRequestForConfig(t,k.MASK_ENDPOINT,I.HostNetworkRequestMethod.post,n).then((function(e){var n;return(n=a.as(e,I.HostNetworkRequest))?o||r.disableCCStorageForDeepcut?r.generateMaskFromImageBytes(i,n,t.maskSize):r.generateMaskFromCCStorageImage(i,n).then((function(e){return t.maskSize=k.CutoutMaskSize.ORIGINAL,e})).fail((function(e){var o;return(o=a.as(e,I.HostNetworkError))&&o.type==I.HostNetworkErrorType.NotFound?r.generateMaskFromImageBytes(i,n,t.maskSize):p.CorePromise.reject(e)})):p.CorePromise.reject("Invalid network request object")})):p.CorePromise.reject("Invalid image or frame")},processMask:function(e,t,n,o){var i,l;if(void 0===o&&(o=!0),(i=a.as(n,I.HostNetworkResponse))&&(l=i.data)){var u,c,d,h,f=a.opt(a.opt(e.page.document,(function(e){return e.controller})),(function(e){return e.saveMgr}));return null!=(d=a.opt(E.Host.imageAnalysis,(function(e){return e.createTempMaskURL(l)})))&&(o&&a.opt(f,(function(e){return e.suspend()})),u=r.applyCutoutMaskToImage(e,d,"",null,t)),(o||null==u)&&(c=r.processNetworkResponseAndSaveImage(n,t).then((function(n){var o,i;return(o=a.as(n,I.HostComponentResponse))?(i=u)?r.updateTempCutoutMaskWithComponentizedMask(e,i,o).then((function(e){return a.opt(f,(function(e){return e.resume()})),e})).fail((function(e){return s.CoreAssert.fail("Failed to substitute temporary cutout mask with componentized mask",{error:a.toString(e)},"ImageFacade.processMask","ImageFacade.swift",1060)})):r.applyCutoutMaskToImage(e,o.url,o.type,o.id,t):p.CorePromise.reject("Invalid component response object")}))),(h=u)?h:c}return p.CorePromise.reject("Invalid network response")},retryNewMaskFromCC:function(e,t,n){var o,i;if((o=r.getImageFormaForForma(e))&&(i=E.Host.logging)){var s=i.getCurrentTime();return r.logCutoutProgressToAnalytics(F.RemoteLoggingEvent.CUTOUT_RETRY,"cc-storage",a.toInt(1e3*(i.getCurrentTime()-s))),k.ImageCutoutModelLibrary.buildMaskNetworkRequestForConfig(t,k.MASK_ENDPOINT,I.HostNetworkRequestMethod.post,n).then((function(n){var l;return(l=a.as(n,I.HostNetworkRequest))?r.generateMaskFromCCStorageImage(o,l).then((function(n){return t.maskSize=k.CutoutMaskSize.ORIGINAL,r.logCutoutProgressToAnalytics(F.RemoteLoggingEvent.CUTOUT_RETRY_SUCCESS,"cc-storage",a.toInt(1e3*(i.getCurrentTime()-s))),r.processMask(e,t,n)})):p.CorePromise.reject("Invalid network request object")}))}return p.CorePromise.reject("Invalid image data or Host instance(s).")},updateTempCutoutMaskWithComponentizedMask:function(e,t,n){return t.then((function(t){var r,o,i,s,l;return(r=a.as(t,N.ImageForma))&&(o=r.contentNode)&&null!=(i=o.url)&&(s=e.page.document)&&(l=a.opt(s.controller,(function(e){return e.undoRedoMgr})))?new p.CorePromise((function(e,t){a.opt(E.Host.imageAnalysis,(function(e){return e.disposeTempMaskURL(i)})),s.maskSubstitutionController.substitute(i,n.id,n.url,n.type),l.invalidatePatches((function(){return e(r)}))})):p.CorePromise.reject("Invalid forma or content node or db.")}))},getNewMaskForImage:function(e,t,n,o){return void 0===o&&(o=!1),r.generateCutoutMaskForImage(e,t,n,o).then((function(n){var a=E.Host.platform.isWeb&&!o;return r.processMask(e,t,n,!a)}))},runDeepCutDirectly:function(e,t){void 0===t&&(t=k.ImageCutoutModelLibrary.DEFAULT_TIMEOUT);var n=new k.CutoutMaskMetadata(k.ImageCutoutModelLibrary.CURRENT_MODEL,k.ImageCutoutModelLibrary.DEFAULT_MASK_SIZE,null);return r.generateCutoutMaskForImage(e,n,t,!1).then((function(e){var t,o;return(t=a.as(e,I.HostNetworkResponse))&&(o=t.data)?(r.setModelVersionFromResponse(t,n),[o,n]):p.CorePromise.reject("Invalid image data for cutout mask")}))},hasRefinedCutout:function(e){var t,n;return!(!(t=r.getCutoutMaskFormaForForma(e))||!(n=t.contentNode))&&null==n.getTag(M.ImageContentNode.IMAGE_MASK_METADATA_TAG)},isRefineCutoutUnmaskedImageVisible:function(e){return a.opt(e,(function(e){return 1==e.page.refineCutoutController.isUnmaskedImageVisible()}))},getCutoutMaskMetadataForForma:function(e){var t,n,o;return(t=r.getCutoutMaskFormaForForma(e))&&(n=t.contentNode)&&null!=(o=n.getTag(M.ImageContentNode.IMAGE_MASK_METADATA_TAG))?k.CutoutMaskMetadata.decode(o):null},createCutoutMaskForImage:function(e,t,n,o,i){void 0===i&&(i=!1);var s=r.getCutoutMaskFormaForForma(e),l=new k.CutoutMaskMetadata(t,n,null);if(null==s)return r.getNewMaskForImage(e,l,o,i);var u=a.opt(a.opt(s,(function(e){return e.contentNode})),(function(e){return e.getTag(M.ImageContentNode.IMAGE_MASK_METADATA_TAG)})),c=k.CutoutMaskMetadata.decode(u),d=a.opt(c,(function(e){return e.maskSize==k.CutoutMaskSize.ORIGINAL}));return k.ImageCutoutModelLibrary.isMaskUptodateWithCurrentModel(c).then((function(t){var n;return null!=(n=a.as(t,"Bool"))&&n?d||r.disableCCStorageForDeepcut?s:r.retryNewMaskFromCC(e,l,o).fail((function(e){return s})):r.getNewMaskForImage(e,l,o)}))},createAndLoadCutoutMaskForImage:function(e,t,n,o,i,l){return void 0===t&&(t=k.ImageCutoutModelLibrary.CURRENT_MODEL),void 0===n&&(n=k.ImageCutoutModelLibrary.DEFAULT_MASK_SIZE),void 0===o&&(o=k.ImageCutoutModelLibrary.DEFAULT_TIMEOUT),void 0===l&&(l=!1),i==k.CutoutMode.Off?(s.CoreAssertDebugOnly.fail("Asked to create cutout mask with cutout mode OFF",void 0,"ImageFacade.createAndLoadCutoutMaskForImage","ImageFacade.swift",1298),p.CorePromise.resolve(null)):r.createCutoutMaskForImage(e,t,n,o,l).then((function(e){var t,n;return(t=a.as(e,N.ImageForma))&&(n=t.contentNode)?n.whenLoaded().thenReturn(e):e}))},createAndLoadCutoutMaskForReplacementImage:function(e,t){var n;return(n=a.as(e,_.FrameForma))?r.createAndLoadCutoutMaskForImage(n,void 0,void 0,void 0,t,!0).then((function(e){return e})).fail((function(e){return a.opt(E.Host.logging,(function(t){return t.logToNewRelic(F.RemoteLoggingEvent.CUTOUT_ERROR_AFTER_REPLACE,{error:a.toString(e)})})),null})):p.CorePromise.resolve(null)},finalizeCutoutAfterMaskLoad:function(e,t,n,o,s,l,u){void 0===o&&(o=null),void 0===s&&(s=null),void 0===l&&(l=!0),void 0===u&&(u=!0);var c,d,h=new C.FormaAnimationTransactionEvent(e);if(h.duration=0,e.beginUpdate(h),r.setCutoutModeForForma(e,n),(c=o)&&(d=c.frame))if(e.matchColors(c),r.setTightCropToCutoutMask(e,t)){var p=e.rotationInRadians();a.opt(e.controller,(function(e){return e.rotate(-p)})),a.opt(e.controller,(function(e){return e.fitInArea(d)})),a.opt(e.controller,(function(e){return e.rotate(p)})),S.GeometryFacade.fitInPage(e,s,void 0,void 0,void 0,1.25)}else e.isBackgroundImage()||r.matchTrimmedRegion(c,e);else if(l&&r.setTightCropToCutoutMask(e,t),u){var f=k.ImageCutoutLibrary.getCutoutModeString(n);a.opt(E.Host.logging,(function(e){return e.logToAnalytics(i.AnalyticsConstants.kAnalyticsDataEditImageRemoveBackgroundApplied,{contextualData1:"appliedCutout: "+f})}))}e.isBackgroundImage()&&a.opt(a.as(a.opt(e.parent,(function(e){return e.controller})),P.GroupController),(function(e){return e.updateGroup()})),e.endUpdate(h)},removeCutoutMaskFromImage:function(e){return r.setCutoutModeForForma(e,k.CutoutMode.Off),p.CorePromise.resolve(null)},formaHasMask:function(e){return null!=r.getMaskFormaForForma(e)},formaHasShapeMask:function(e){return r.getMaskFormaForForma(e)instanceof j.ShapeForma},setAuxiliaryForForma:function(e,t,n){var o;if(o=r.getFrameFormaForForma(e)){var a,i,s,l=new C.FormaContentChangedEvent(o);if(o.beginUpdate(l),(a=r.getMaskFormaForFormaByIntent(o,n))&&o.removeAuxiliary(a),(i=t)&&(i.intent=n,o.appendAuxiliary(i)),e.endUpdate(l),s=r.getImageFormaForForma(e)){var u=new C.FormaContentChangedEvent(s);s.beginUpdate(u),s.endUpdate(u)}}},setMaskForForma:function(e,t){r.setAuxiliaryForForma(e,t,g.Forma.INTENT_IMAGE_MASK)},removeMaskForForma:function(e){r.setMaskForForma(e,null)},setCutoutForForma:function(e,t){var n;r.setAuxiliaryForForma(e,t,g.Forma.INTENT_CUTOUT_MASK),(n=t)&&r.updateCutoutMaskPlacement(e,n)},removeCutoutForForma:function(e){r.setCutoutForForma(e,null),r.setCutoutModeForForma(e,k.CutoutMode.Off)},getMaskForForma:function(e){var t,n,o,i,s=r.getMaskFormaForForma(e);return(t=a.as(s,j.ShapeForma))&&null!=(n=t.shapeLibraryID)?l.CropAssetLibrary.getCropShapeFromID(n):(o=a.as(s,N.ImageForma))&&null!=(i=o.contentNode.getTag(M.ImageContentNode.ASSET_ID_TAG))?l.CropAssetLibrary.getRasterMaskFromID(i):null},applyMaskToForma:function(e,t,n,o){var i;if(void 0===n&&(n=null),void 0===o&&(o=!1),i=a.as(e,_.FrameForma)){var s,u,c,d=null,h=new C.FormaApplyMaskEvent(i);return i.beginUpdate(h),(s=a.as(t,l.CropShape))?d=r.applyShapeMaskToImage(e,s.id,n,o):(u=a.as(t,l.RasterMask))&&(d=r.applyRasterMaskToImage(e,u,n,o)),(c=d)?c.then((function(e){var t;if(t=a.as(i.controller,y.FrameController)){if(r.formaHasMask(i)){var n=new C.FormaGeometryChangedEvent(i);i.beginUpdate(n),t.fitChildrenToFrame(),i.endUpdate(n)}t.fitting=y.FitType.None,t.updateCropModeImage()}return i.cropRatioId=f.CropRatioPresetLibrary.NONE_ID,i.endUpdate(h),e})):p.CorePromise.reject("Invalid CropAsset type.")}return p.CorePromise.reject("Invalid frame.")},applyShapeMaskToImage:function(e,t,n,o){var i;if(void 0===n&&(n=null),void 0===o&&(o=!1),i=a.as(e,_.FrameForma)){var s,l,u,c,d,h=r.formaHasMask(i),f=a.opt(a.opt(r.getImageFormaForForma(i),(function(e){return e.finalFrame})),(function(e){return e.origin}));if((s=n)&&a.opt(a.as(i.controller,y.FrameController),(function(e){return e.setBoundsWithCropType(s,y.CropType.PreserveFocusAndScale)})),r.removeMaskForForma(i),null!=t&&(l=a.as(i.page.createFormaWithController(j.ShapeForma.KIND,V.ShapeController.KIND),j.ShapeForma))){H.ShapeLibrary.applyToShapeForma(l,t);var m,T,C=l.canonicalArtwork;if(!o&&(m=C.bounds)&&(T=i.bounds)){var v=T.fitAspectRatioWithin(m.aspectRatio);i.bounds=z.TheoRect.fromXYWH(T.minX,T.minY,v.width,v.height)}l.preScale=null,l.allowUserMove=!1,l.intent=g.Forma.INTENT_IMAGE_MASK,r.setMaskForForma(i,l)}return(T=i.bounds)&&(u=a.opt(r.getImageFormaForForma(i),(function(e){return e.bounds})))&&!r.formaHasMask(i)&&h&&null==n&&(v=T.fitAspectRatioWithin(u.aspectRatio),i.bounds=z.TheoRect.fromXYWH(T.minX,T.minY,v.width,v.height)),(c=f)&&(d=a.opt(a.opt(r.getImageFormaForForma(i),(function(e){return e.finalFrame})),(function(e){return e.origin})))&&i.move(B.Matrix2D.translation(X._minus_TheoPoint_TheoPoint(c,d))),p.CorePromise.resolve(r.getMaskFormaForForma(e))}return p.CorePromise.reject("frame is nil")},applyRasterMaskToImage:function(e,t,n,o){var i,s,l;if(void 0===n&&(n=null),void 0===o&&(o=!1),(i=r.getFrameFormaForForma(e))&&(s=t)&&null!=(l=E.Host.resourceUtils.urlForResource(b.CATEGORY_ID_RASTER_MASK,s.id))){var u=new d.AddFormaParams(void 0,void 0,void 0,void 0,d.AddFormaParentingHint.doNotAddFormaForContentToTree),c={"image-role":M.ImageContentNode.ROLE_MASK,"asset-id":s.id};return d.CreationFacade.addImage(e.page,l,s.mimeType,s.width,s.height,!1,void 0,u,c).then((function(e){var t;return(t=a.as(e,N.ImageForma))?(r.setMaskForForma(i,t),t):p.CorePromise.reject("imageCN is nil")}))}return p.CorePromise.reject("frame is invalid")},getBoundingBoxAndMask:function(e,t){var n;void 0===t&&(t=5);var r,o,i,s,l,c,d={source:{bytes:e},saliency:{boundingBoxRectangles:!0,mask:!0}},h=new u.CoreContentJSON(a.as(d,["Dictionary","String","Any"]),"application/json;charset=UTF-8");if((r=E.Host.network)&&(o=E.Host.imageAnalysis)&&(i=E.Host.dataFactory)&&(s=E.Host.resourceUtils)&&(l=E.Host.logging)&&(c=i.createFromCoreContent(h))){var f=l.newLog("host");return p.CorePromise.all([r.getAuthToken(),o.getSaliencyAPIEndpoint(),o.getSaliencyAPIKey()]).then((function(e){var o,i,u,d,h=a.clone(a.as(e,["Array","Any"]));if(x.LegacyCoreAssert.isTrue(a.opt(h,(function(e){return 3==e.length})),"Expected three CorePromise results.",void 0,"ImageFacade.getBoundingBoxAndMask","ImageFacade.swift",1662),(o=h)&&null!=(i=a.as(o[0],"String"))&&null!=(u=a.as(o[1],"String"))&&null!=(d=a.as(o[2],"String"))){var m=s.makeGUID(),g=new I.HostNetworkRequest(u+"/imageAnalysis");g.timeout=t,g.method=I.HostNetworkRequestMethod.post,g.headers.Authorization="Bearer "+i,g.headers["X-API-Key"]=d,g.headers["X-Request-Id"]=m,g.data=c;var y=l.getCurrentTime(),_={saliency:{boundingBoxRectangles:[]}};return r.request(g).then((function(e){var t,n;if((t=a.as(e,I.HostNetworkResponse))&&(n=t.data)){var r=1e3*(l.getCurrentTime()-y);return f.info("Successfully got Saliency BoundingBoxAndMask in "+r+"ms."),n.asJSON()}return f.warning("Invalid Saliency BoundingBoxAndMask API response type."),_})).fail((function(e){var r;return(r=a.as(e,I.HostNetworkError))?r.type==I.HostNetworkErrorType.Timeout?f.warning("Saliency BoundingBoxAndMask timed-out after "+1e3*t+"ms. request-id: "+m):f.warning("Error getting Saliency BoundingBoxAndMask: ["+((n=r.status)||null!=n?n:-1)+"] "+r.description+". request-id: "+m):f.warning("Error getting Saliency BoundingBoxAndMask. request-id: "+m),_}))}return p.CorePromise.reject("Invalid auth data")}))}return p.CorePromise.reject("Invalid Host instances")},updateCutoutMaskPlacement:function(e,t){var n,o,a;if((n=r.getImageFormaForForma(e))&&(o=n.bounds)&&(a=t.bounds)){x.LegacyCoreAssert.isTrue(a.width>0&&a.height>0,"Invalid mask bounds.",void 0,"ImageFacade.updateCutoutMaskPlacement","ImageFacade.swift",1726);var i=o.width/a.width,s=o.height/a.height;t.placement=B.Matrix2D.scalingXY(i,s).concat(n.placement)}else x.LegacyCoreAssert.fail("Failed to update cutout mask bounds - invalid image or mask bounds.",void 0,"ImageFacade.updateCutoutMaskPlacement","ImageFacade.swift",1732)},applyCutoutMaskToImage:function(e,t,n,o,i){var s,l;if(void 0===o&&(o=null),void 0===i&&(i=null),l=a.as(e,_.FrameForma)){var u=new d.AddFormaParams(void 0,void 0,void 0,void 0,d.AddFormaParentingHint.doNotAddFormaForContentToTree),h={"image-role":M.ImageContentNode.ROLE_MASK,"image-mask-metadata":(s=a.opt(i,(function(e){return e.encode()})))||null!=s?s:""};return d.CreationFacade.addImage(e.page,t,n,void 0,void 0,void 0,void 0,u,h,o).then((function(e){var t;return(t=a.as(e,N.ImageForma))?a.opt(t.contentNode,(function(e){return null==e.trimmedBounds}))?(t.removeFromParent(),p.CorePromise.reject(new I.HostCutoutMaskError(I.HostCutoutMaskErrorType.NoForegroundObjectImage))):(c.ColorFacade.applyNoneColorToFormae([l]),r.setCutoutForForma(l,t),r.setCutoutModeForForma(l,k.CutoutMode.Off),t):p.CorePromise.reject("mask is not an ImageForma.")}))}return p.CorePromise.reject("frame is nil")},canSetTightCropToCutoutMask:function(e,t){var n,o;return void 0===t&&(t=!0),!(!(n=e)||!(o=n.controller)||r.formaHasShapeMask(n)||n.isBackgroundImage()||o.userGroupChild||t&&null!=n.style.colors.fieldPrimary)},setTightCropToCutoutMask:function(e,t,n){if(void 0===n&&(n=!0),!r.canSetTightCropToCutoutMask(e,n))return!1;var o,i,s,l,u;if((o=r.getImageFormaForForma(e))&&(i=a.as(e.controller,y.FrameController))&&(s=o.bounds)&&(l=t.bounds)&&(u=a.opt(t.contentNode,(function(e){return e.trimmedBounds})))){var c,d,h=u.multiplyXY(s.width/l.width,s.height/l.height);if((c=a.opt(o.placement.inverse,(function(t){return t.transformRect(e.bounds)})))&&(d=h.intersectionWith(c))){var p=new C.FormaGeometryChangedEvent(e);e.beginUpdate(p);var f=o.placement.transformRect(d),m=o.totalPlacement.transformPoint(d.center);e.bounds=z.TheoRect.fromSize(f.size);var g=B.Matrix2D.translation(X._minus_TheoPoint_TheoPoint(e.bounds.center,o.placement.transformPoint(d.center)));o.move(g),i.fitChildrenToFrame(),e.move(B.Matrix2D.translation(X._minus_TheoPoint_TheoPoint(m,e.finalFrame.center))),e.endUpdate(p)}}return!0},getTrimmedRegionForMatching:function(e,t){var n,o,i,s;return(n=t.bounds)&&(o=r.getCutoutMaskFormaForForma(e))&&(i=o.bounds)&&(s=a.opt(o.contentNode,(function(e){return e.trimmedBounds})))?s.multiplyXY(n.width/i.width,n.height/i.height):null},getTrimmedRegionCropBoundsAndArea:function(e,t,n){var r=a.clone(S.GeometryFacade.getIntersectionPolygon(e,t,B.Matrix2D.Identity,n)),o=z.TheoRect.boundsOfPoints(r)||z.TheoRect.Zero,i=S.GeometryFacade.areaOfConvexPolygon(r),s=n.transformRect(t).intersectionWith(e)||z.TheoRect.Zero,l=s.area;return(i<.05*l||i>l)&&(o=s,i=l),{croppedBounds:o,croppedArea:i}},matchTrimmedRegion:function(e,t){var n,o,a,i,l,u;if((n=e.frame)&&(o=t.frame)&&(a=e.bounds)&&(i=t.bounds)&&(l=r.getImageFormaForForma(e))&&(u=r.getImageFormaForForma(t))){s.CoreAssertDebugOnly.isTrue(n.equalWithAccuracy(o,.01),"matchTrimmedRegion expects congruent frames",void 0,"ImageFacade.matchTrimmedRegion","ImageFacade.swift",1901);var c,d,h=u.rotationInRadians();if(s.CoreAssertDebugOnly.isTrue(Math.abs(h)<.01,"matchTrimmedRegion expects the destination image to be unrotated",void 0,"ImageFacade.matchTrimmedRegion","ImageFacade.swift",1903),(c=r.getTrimmedRegionForMatching(e,l))&&(d=r.getTrimmedRegionForMatching(t,u))){var p=r.getTrimmedRegionCropBoundsAndArea(a,c,l.placement);c=p.croppedBounds;var f=e.placement.transformValues,m=p.croppedArea*f.xscale*f.yscale;if(m>0){d=u.placement.transformRect(d);var g=t.placement.transformValues,y=d.area*g.xscale*g.yscale,_=S.GeometryFacade.getClosestPin(a,c),T=B._asterisk_TheoPoint_Matrix2D(c.evalXY(_.x,_.y),e.placement),C=B._asterisk_TheoPoint_Matrix2D(T,t.placement.inverse),v=d.evalXY(_.x,_.y),P=X._minus_TheoPoint_TheoPoint(C,v);W.TransformFacade.translateForma(u,P),d=d.offset(P);var A,D=Math.sqrt(m/y);null!=(A=S.GeometryFacade.getScaleToFit(d,i,C))&&(D=Math.min(D,A)),W.TransformFacade.transformFormaeInPageSpaceAboutPoint([u],B.Matrix2D.scalingXY(D,D),B._asterisk_TheoPoint_Matrix2D(C,t.totalPlacement))}}}},canAddImages:function(e,t){return t+e.filterByControllerKind(y.FrameController.KIND).length<=v.GridController.MAX_IMAGE_COUNT},addPlaceholderImage:function(e){var t,n,r;return null!=(t=E.Host.resourceUtils.urlForResource(b.CATEGORY_ID_IMAGE,"placeholder"))&&(n=e.document)&&(r=a.opt(E.Host.imageAnalysis,(function(e){return e.createHostImage(t,!1,null)})))?r.getImageRepresentationData("image/png",Math.max(r.getHeight(),r.getWidth())).then((function(t){var o;return(o=a.as(t,R.HostDataProtocol))?E.Host.network.saveImageComponent(o,"image/png").then((function(t){var o,i;return(o=a.as(t,I.HostComponentResponse))?(i=a.as(n.content.createNode(M.ImageContentNode.KIND,D.GUIDUtils.makeGUID()),M.ImageContentNode))?(i.url=o.url,i.mimeType="image/png",i.pixelWidth=r.getWidth(),i.pixelHeight=r.getHeight(),i.mediaMetadata=w.MediaMetadata.init_4d41(),i.componentID=o.id,d.CreationFacade.addContent(e,i,null,!1,new d.AddFormaParams(void 0,void 0,void 0,d.FloatingImageStrategy.Always)).then((function(e){var t=a.as(e,g.Forma);return null!=t?p.CorePromise.resolve(t):(x.LegacyCoreAssert.fail("expected a forma result from CreationFacade.addContent",void 0,"ImageFacade.addPlaceholderImage","ImageFacade.swift",2008),p.CorePromise.resolve(null))}))):p.CorePromise.resolve(null):p.CorePromise.reject(t)})):p.CorePromise.resolve(null)})):p.CorePromise.resolve(null)}}}),r)},mGL3:function(e,t,n){var r,o=t,a=n("oAGj"),i=n("gXiO"),s=n("QgZx"),l=n("ZhwN"),u=n("iCxV"),c=n("fNpk");o.OrderedFontSet=(r=function(){this.descriptors_=[],this.familyKeys_=[],this.familyFaces_=[],this.clock_=0,this.fontSetID=l.GUIDUtils.makeGUID(),i.CoreObject.call(this)},a.defineClass({name:"OrderedFontSet",ctor:r,superName:"CoreObject",statics:{fromList:function(e){for(var t=new r,n=a.iter(e);!n.done;n.next()){var o=n.value;t.append(o)}return t}},props:{descriptors:{get:function(){return this.descriptors_.concat()}},count:{get:function(){return this.descriptors_.length}},familyCount:{get:function(){return this.familyKeys_.length}},familyAt:function(e){return a.as(this.familyKeys_[e],"String")},facesInFamily:function(e){var t=a.indexOf(this.familyKeys_,e);return null==t?(a.opt(u.Host.logging,(function(t){return t.warning("Invalid family ("+e+") in facesInFamily()")})),null):a.sort(this.familyFaces_[t],(function(e,t){var n=e.source==s.FontSource.TYPEKIT_PREMIUM||e.source==s.FontSource.TYPEKIT_FREE,r=t.source==s.FontSource.TYPEKIT_PREMIUM||t.source==s.FontSource.TYPEKIT_FREE;return!(!n||r)||!(!n&&r)&&(0==e.usWeightClass||0==t.usWeightClass?e.weight==t.weight?(e.italic||0!=e.italicAngle)==(t.italic||0!=t.italicAngle)?e.label.length<t.label.length:!e.italic&&0==e.italicAngle:e.weight<t.weight:e.usWeightClass==t.usWeightClass?e.usWidthClass==t.usWidthClass?e.weight==t.weight?(e.italic||0!=e.italicAngle)==(t.italic||0!=t.italicAngle)?e.label.length<t.label.length:!e.italic&&0==e.italicAngle:e.weight<t.weight:e.usWidthClass<t.usWidthClass:e.usWeightClass<t.usWeightClass)}))},defaultFaceInFamily:function(e){var t=a.clone(this.facesInFamily(e)||[]);function n(e){for(var n=a.iter(t);!n.done;n.next()){var r=n.value;if(r.displayFaceName.includes(e))return r}return null}c.LegacyCoreAssert.isTrue(0==!t.length,"facesInFamily is empty",{family:e},"OrderedFontSet.defaultFaceInFamily","OrderedFontSet.swift",111);for(var r=a.iter(["Regular","Normal","Plain","Book","Display"]);!r.done;r.next())if(o=n(r.value))return o;for(var o,i,s=1e5,l=1e5,u=a.iter(t);!u.done;u.next()){var d=u.value,h=d.usWeightClass;h=0==h?d.weight:h,!d.italic&&Math.abs(h-400)<s?(s=Math.abs(h-400),o=d):d.italic&&Math.abs(h-400)<l&&(l=Math.abs(h-400),i=d)}return null!=o?o:null!=i?i:a.first(t)},fontAt:function(e){return e<0||e>=this.descriptors_.length?(c.LegacyCoreAssert.fail("Invalid index in fontAt()",{index:e},"OrderedFontSet.fontAt","OrderedFontSet.swift",165),null):this.descriptors_[e]},forEach:function(e){this.descriptors_.forEach(e)},indexOf:function(e){return a.indexOfEq(this.descriptors_,e,s._equality_FontDescriptor_FontDescriptor)},getIndexOfPostScriptName:function(e){for(var t=0,n=a.iter(this.descriptors_);!n.done;n.next()){if(n.value.postScriptName==e)return t;t+=1}return null},filter:function(e){return this.descriptors_.filter(e,this)},find:function(e){return this.descriptors_.find(e,this)},append:function(e){if(!this.contains(e)){this.clock_+=1,this.descriptors_.push(e);var t=e.displayFamilyName,n=a.indexOf(this.familyKeys_,t);null==n&&(this.familyKeys_.push(t),this.familyFaces_.push([])),n=a.indexOf(this.familyKeys_,t),this.familyFaces_[n].push(e)}},contains:function(e){return a.containsEq(this.descriptors_,e,s._equality_FontDescriptor_FontDescriptor)},remove:function(e){this.clock_+=1,a.remove(this.descriptors_,e);var t=e.displayFamilyName,n=a.indexOf(this.familyKeys_,t);if(null!=n){var r=this.familyFaces_[n];a.remove(r,e),0==r.length&&(a.remove(this.familyKeys_,t),this.familyFaces_.splice(n,1))}},clone:function(){var e=new r;return this.descriptors_.forEach((function(t){return e.append(t)})),e},sort:function(){var e=a.sort(this.descriptors_,(function(e,t){return e.postScriptName>t.postScriptName}));this.descriptors_=[];for(var t=a.iter(e);!t.done;t.next()){var n=t.value;this.descriptors_.push(n)}},revisionNumber:{get:function(){return this.clock_}}}}),r)},muPB:function(e,t,n){var r,o,a=t,i=n("oAGj"),s=n("ytEx"),l=n("iCxV"),u=n("C4JV"),c=n("Puiz"),d=n("9YN4");a.JSONDocumentDecoder=(r=function(e){var t,n,r,o={};(t=e.getComponentWithAbsolutePath(u.JSON_CONTENT_PATH_DCX2D))&&null!=(n=e.getPathForComponent(t))?null!=(r=i.opt(l.Host.persistUtils,(function(e){return e.readJsonContentFromFile(n)})))&&(o=r):i.opt(l.Host.logging,(function(e){return e.warning("Could not find dom component!")})),c.JSONNodeDecoder.call(this,e,o)},o={},i.defineClass({name:"JSONDocumentDecoder",ctor:r,superName:"JSONNodeDecoder",statics:{getRequiredSynchronousComponents:function(e){return[u.JSON_CONTENT_PATH_DCX2D]},localizedDefaultName:{get:function(){return void 0===o.localizedDefaultName&&(o.localizedDefaultName=i.opt(l.Host.locale,(function(e){return e.getLocalizedDefaultDocumentName()}))),o.localizedDefaultName}},_implements:function(e){return"IImportDataObject"==e}},props:{isDefaultName:function(e){return null==e||e==d.TheoDocument.DEFAULT_NAME||e==r.localizedDefaultName||""==e},getPropertyOnNode:function(e){if(e==s.PROPERTY_KEY_ID)return i.as(this.branch_.getValue(s.PROPERTY_KEY_ID),"AnyObject");if(e==s.PROPERTY_KEY_NAME){var t=r.localizedDefaultName,n=i.as(this.branch_.getValue(e),"String"),o=i.as(c.JSONNodeDecoder.prototype.getPropertyOnNode.call(this,e),"String");return this.isDefaultName(n)&&!this.isDefaultName(o)?t=o:this.isDefaultName(o)&&!this.isDefaultName(n)||null!=n?t=n:null!=o&&(t=o),i.as(t,"AnyObject")}var a=c.JSONNodeDecoder.prototype.getPropertyOnNode.call(this,e);return null==a&&(a=i.as(this.branch_.getValue(e),"AnyObject")),a}}}),r)},mxdD:function(e,t,n){var r,o=t,a=n("oAGj"),i=n("gXiO"),s=n("FNB+"),l=n("cmoc"),u=n("RkYL"),c=n("sW6f"),d=n("zjod"),h=n("QTen");o.VideoFacade=(r=function(){i.CoreObject.call(this)},a.defineClass({name:"VideoFacade",ctor:r,superName:"CoreObject",statics:{getVideoFormaForForma:function(e){var t;return(t=a.as(e,l.FrameForma))&&t.childCount>0?a.as(t.childAt(0),d.VideoForma):a.as(e,d.VideoForma)},getTrueVideoFormaForForma:function(e){var t;return(t=r.getVideoFormaForForma(e))&&!t.isSticker()?t:null},setTransientTimeForVideoForma:function(e,t,n,o){var a,i;(a=r.getVideoStyleForForma(e))&&(i=r.getVideoContentForForma(e))&&(a.setTransientTime(t,n),i.setTransientOffset(o))},resetTransientTimeForVideoForma:function(e){var t,n;(t=r.getVideoStyleForForma(e))&&(n=r.getVideoContentForForma(e))&&(t.resetTransientTime(),n.resetTransientOffset())},changeVideoVolume:function(e,t){for(var n=a.iter(e);!n.done;n.next()){var o,i=n.value;(o=r.getVideoStyleForForma(i))&&(o.volumeLevel=t)}},getVideosOnPage:function(e,t){return void 0===t&&(t=!0),e.root.filterWithCallback((function(e){return e instanceof d.VideoForma&&(t||!e.isSticker())}))},getVideoCountOnPage:function(e,t){void 0===t&&(t=!0);for(var n=0,r=a.iter(e.root.visitAsArray(s.FormaTraversal.PreOrder));!r.done;r.next()){var o=r.value;o instanceof d.VideoForma&&(t||!o.isSticker())&&(n+=1)}return n},getStickerCountInDoc:function(e){var t=0;return e.visitAll(s.FormaTraversal.PreOrder,(function(e){e instanceof d.VideoForma&&e.isSticker()&&(t+=1)})),t},getStickerCountInPages:function(e){for(var t=0,n=a.iter(e);!n.done;n.next())for(var r=n.value,o=a.iter(r.root.visitAsArray(s.FormaTraversal.PreOrder));!o.done;o.next()){var i=o.value;i instanceof d.VideoForma&&i.isSticker()&&(t+=1)}return t},videoContentIsLivePhoto:function(e){var t;return null!=(t=a.opt(e,(function(e){return e.getTag(c.VideoContentNode.LIVE_PHOTO_TAG)})))&&"true"==t},formaIsLivePhoto:function(e){var t;return!!(t=r.getVideoContentForForma(e))&&r.videoContentIsLivePhoto(t)},formaIsGIFVideo:function(e){var t;return!!(t=r.getVideoContentForForma(e))&&t.isGIF},getVideoContentForForma:function(e){var t;return(t=r.getVideoFormaForForma(e))?t.videoContentNode:null},getVideoStyleForForma:function(e){var t;return(t=r.getVideoFormaForForma(e))?a.as(t.style,h.VideoStyle):null},getStartTimeForVideoForma:function(e,t){void 0===t&&(t=!1);var n,o,a,i=u.TheoTime.Zero;return(n=r.getVideoStyleForForma(e))&&(i=n.startTime),t&&(o=r.getVideoContentForForma(e))&&(a=o.offsetInOriginal)&&(i=i.add(a)),i},getDurationInSecondsForVideo:function(e){return r.getDurationForVideo(e).seconds},getVideoTimeForVideoWithTimeInTotalLoop:function(e,t){var n=r.getDurationInSecondsForVideo(e),o=t.seconds%n;return u.TheoTime.fromSeconds(o,t.timescale)},getDurationForVideo:function(e){var t,n,r=u.TheoTime.Zero;if(t=e.videoContentNode)if(n=a.as(e.style,h.VideoStyle))r=n.duration;else{var o=a.clone(t.times);o.length>0&&(r=o[o.length-1])}return r},addVideoContent:function(e,t,n,r,o,i,s,l,u,d,h,p){var f,m,g;return(f=a.as(a.opt(e,(function(e){return e.createNode(c.VideoContentNode.KIND,null)})),c.VideoContentNode))?(f.url=t,f.mimeType=n,f.width=r,f.height=o,f.duration=i,f.mediaMetadata=u,f.localIdentifier=d,f.setTimes(h),p&&f.setTag(c.VideoContentNode.LIVE_PHOTO_TAG,"true"),(m=s)&&(f.offsetInOriginal=m),(g=l)&&(f.originalDuration=g),f):null}}}),r)},nPwb:function(e,t,n){var r,o=t,a=n("oAGj");o.PGMFacade=(r=function(){},a.defineClass({name:"PGMFacade",ctor:r}),r)},"nQ+V":function(e,t,n){var r,o=t,a=n("oAGj"),i=n("95jH");o.MotionEntryStacked=(r=function(){this.srcId="MotionSourceStacked",this.logic=new i.MotionLogicStacked,this.args={lineDur:.3,endPadDur:1}},a.defineClass({name:"MotionEntryStacked",ctor:r,statics:{_implements:function(e){return"MotionEntry"==e}}}),r)},nUE5:function(e,t,n){var r,o=t,a=n("oAGj"),i=n("iCxV"),s=n("wL85"),l=n("qTtJ"),u=n("f9IM");o.MotionSource=(r=function(){},a.defineClass({name:"MotionSource",ctor:r,statics:{getSourceAnimation:function(e,t){return"MotionSourceStacked"==e?u.MotionSourceStacked.getSrcKeyframes(t):"MotionSrcFadeIn"==e?l.MotionSrcFadeIn.getSrcKeyframes(t):"MotionSrcDropIn"==e?s.MotionSrcDropIn.getSrcKeyframes(t):(""!=e&&a.opt(i.Host.logging,(function(t){return t.warning("Unknown source animation: "+e)})),[])}}}),r)},oTAR:function(e,t,n){var r,o=t,a=n("oAGj"),i=n("CWW7"),s=n("gXiO"),l=n("yGNn"),u=n("ascj"),c=n("FNB+"),d=n("ZK0l"),h=n("iCxV"),p=n("/BuD"),f=n("fNpk"),m=n("tGKA"),g=n("VkKB"),y=n("3DEm"),_=n("JO5d"),T=n("djAF"),C=n("fiuZ"),v=n("u2iI"),P=n("B8ge"),S=n("byfQ"),A=n("umUn"),D=n("hgLm"),E=n("oKlP"),R=n("sIWg"),F=n("1NAc"),I=n("LGJg");o.SVGParserUtils=(r=function(){s.CoreObject.call(this)},a.defineClass({name:"SVGParserUtils",ctor:r,superName:"CoreObject",statics:{k_two_pi:6.283185307179586,k_pi:3.141592653589793,kNumericRegEX:"[+-]?(([0-9]*\\.[0-9]+)|([0-9]+\\.?))([eE][+-]?[0-9]+)?",shapeTypeFromPaths:function(e){for(var t=!1,n=!1,r=a.iter(e);!r.done;r.next()){var o=r.value;if(o.pathFillType==D.TheoPath.PATHFILL_NONE){if(t=!0,n)return v.ShapeType.FillAndStroke}else if(n=!0,t||(t=0!=o.pathStrokeWeight),t)return v.ShapeType.FillAndStroke}return t?v.ShapeType.Stroke:v.ShapeType.Fill},theoArtworkFromSVGData:function(e,t){if(null!=e){var n=r.parseSVGToPathData(e);return r.theoArtworkFromSVGPathData(n,t)}return null},theoArtworkFromSVGPathData:function(e,t){var n,r,o,i=S.TheoArtworkShape.init_d1d0(null,e.paths,u.ColorRole.FieldPrimary,u.ColorRole.FieldPrimary),s=(n=a.as(e.customAttributes["stroke-multiplier-min"],"Double"))||null!=n?n:v.ShapeStyle.STROKE_WEIGHT_MULTIPLIER_MIN_DEFAULT,l=(r=a.as(e.customAttributes["stroke-multiplier-max"],"Double"))||null!=r?r:v.ShapeStyle.STROKE_WEIGHT_MULTIPLIER_MAX_DEFAULT,c=s==v.ShapeStyle.STROKE_WEIGHT_MULTIPLIER_MIN_DEFAULT&&l==v.ShapeStyle.STROKE_WEIGHT_MULTIPLIER_MAX_DEFAULT,d=i.bounds;if(e.viewBox.containsWithAccuracy(d,.05)||0==d.area)o=t?i.cloneWithBounds(d):i.cloneWithBounds(e.viewBox);else if(c){var h;if(t){var f=e.viewBox.intersectionWith(d);h=new D.TheoRectanglePath(f)}else h=new D.TheoRectanglePath(e.viewBox);o=new S.TheoArtworkClipGroup(null,[i],h)}else o=i;var m=e.sliceBox.width>0||e.sliceBox.height>0?e.sliceBox:null,g=e.contentBox.width*e.contentBox.height>0?e.contentBox:null,y=e.shapeType,_=a.clone(e.customAttributes);return new p.ArtworkInfo(o,m,g,y,_)},createShapeFromSVGURL:function(e,t,n){var o;return(o=a.opt(h.Host.pathUtils,(function(e){return e.artworkFromURL(t,!0)})))?r.createShapeFromTheoArtwork(e,t,o,n):(f.LegacyCoreAssert.fail("artworkFromURL failed",void 0,"SVGParserUtils.createShapeFromSVGURL","SVGParserUtils.swift",161),null)},createShapeFromTheoArtwork:function(e,t,n,r){var o;if(o=e.document){var i=o.content.createNode(I.VectorContentNode.KIND,null);i.url=t,i.mimeType="image/svg+xml",i.mediaMetadata=g.MediaMetadata.init_a9d7(r,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,g.MediaMetadata.DESIGNINTENT_ICON);var s,l,u=n.artwork.bounds;if(null==u&&(u=n.contentRegion),null==u&&(a.info("failed to get size of the SVG. Making one up"),u=new R.TheoRect(0,0,50,50)),f.LegacyCoreAssert.isTrue(null!=u,"How do we not have an artSize?",void 0,"SVGParserUtils.createShapeFromTheoArtwork","SVGParserUtils.swift",200),i.size=u.size,o.content.root.appendChild(i),s=a.as(e.createFormaWithController(T.ShapeForma.KIND,_.ShapeController.KIND),T.ShapeForma))return s.contentNode=i,s.canonicalArtwork=n.artwork,s.sliceBox=n.sliceBox,s.contentRegion=n.contentRegion,(l=a.as(s.style,v.ShapeStyle))&&1==l.copyCustomAttributes(n.customAttributes)&&(l.shapeType=n.shapeType),s.size=i.size,s.intent=c.Forma.INTENT_ICON,s.legacyRender=!1,s}return null},addShapeFromTheoArtwork:function(e,t,n,o,a){var i;return(i=r.createShapeFromTheoArtwork(e,n,o,a))?r.addShapeToPage(e,i,t,null):l.CorePromise.reject("Could not create shape from artwork")},addShapeFromSVGURL:function(e,t,n,o){var a;return(a=r.createShapeFromSVGURL(e,n,o))?r.addShapeToPage(e,a,t):l.CorePromise.reject("unable to create artwork info")},addShapeToPage:function(e,t,n,r){var o;void 0===r&&(r=null);var s,c,h=l.CorePromise.resolve(null);if((s=n)&&(c=a.as(a.opt(s.parent,(function(e){return e.controller})),d.GroupController))){c.replaceChildWithForma(s,t,!0),a.opt(a.opt(t.controller,(function(e){return e.owner})),(function(e){return e.selection.deselectForma(s,!1)}));var p=v.ShapeType.Fill,m=v.ShapeStyle.STROKE_BASE_WEIGHT_DEFAULT,g=a.clone(C.ShapeFacade.getStrokeWeightMultiplierRangeForForma(t)),y=v.ShapeStyle.STROKE_WEIGHT_MULTIPLIER_DEFAULT;if((P=a.as(t.style,v.ShapeStyle))&&(p=P.shapeType,m=P.strokeBaseWeight,P.isBasicShape())){var _=C.ShapeFacade.getStrokeWeightMultiplierForForma(s),T=C.ShapeFacade.convertStrokeWeightFromModelToUserSpace(s,_);y=C.ShapeFacade.convertStrokeWeightFromUserToModelSpace(t,T)}if(t.style.kind==s.style.kind){var P;t.style.match(s.style),(P=a.as(t.style,v.ShapeStyle))&&(P.strokeWeightMultiplierMin=g[0],P.strokeWeightMultiplierMax=g[1],P.shapeType=p,P.strokeBaseWeight=m),C.ShapeFacade.applyStrokeWeightMultiplier(y,[t]);var S=t.style.colors.fieldPrimary;if(null!=S&&!t.controller.secondaryColorVisible()){var D=A.TheoColor.init_5344(S);t.controller.applyColors([D],u.ColorRole.FieldSecondary)}}}else h=i.CreationFacade.addForma(e,t,new i.AddFormaParams(void 0,void 0,n,void 0,void 0,r)).then((function(e){return t.controller.shuffleColorAssignment(),null}));return h.then((function(e){var n,r;return(n=a.as(t.contentNode,I.VectorContentNode))?((r=t.canonicalArtwork.bounds)?n.size=r.size:(f.LegacyCoreAssert.isTrue(!1,"How do we not have canonical artwork bounds?",{url:(o=a.opt(n.mediaMetadata,(function(e){return e.sourceURL})))||null!=o?o:"unknown"},"SVGParserUtils.addShapeToPage","SVGParserUtils.swift",391),n.size=new F.TheoSize(100,100)),l.CorePromise.resolve(t)):l.CorePromise.reject("expected the icon shape to have a vector content node backing it.")}))},parseSVGToPathData:function(e){var t=new P.SVGParser;return h.Host.pathUtils.parseSVGXMLData(e,t),t.createTheoPathFromParsedDom()},parseSVGTransform:function(e){var t=m.Matrix2D.Identity;if(null!=e)for(var n=a.clone(h.Host.pathUtils.matchesForRegexInString("(matrix|translate|scale|rotate|skewX|skewY)\\s*\\([^)]+\\)",e)),o=a.iter(n);!o.done;o.next()){var i=o.value,s=a.clone(h.Host.pathUtils.matchesForRegexInString("(matrix|translate|scale|rotate|skewX|skewY)",i));f.LegacyCoreAssert.isTrue(1==s.length,"unexpected number of transform type matches in one transform string",void 0,"SVGParserUtils.parseSVGTransform","SVGParserUtils.swift",428);var l=s[0],u=a.clone(h.Host.pathUtils.matchesForRegexInString("\\(([^)]+)\\)",i));f.LegacyCoreAssert.isTrue(1==u.length,"unexpected number of transform args matches in one transform string",void 0,"SVGParserUtils.parseSVGTransform","SVGParserUtils.swift",432);for(var c=u[0],d=[],p=a.clone(h.Host.pathUtils.matchesForRegexInString("[-+]?[0-9]*\\.?[0-9]+([eE][-+]?[0-9]+)?",c)),g=a.iter(p);!g.done;g.next()){var y=g.value;d.push(h.Host.pathUtils.parseStringToDouble(y))}var _=m.Matrix2D.Identity;switch(l){case"matrix":f.LegacyCoreAssert.isTrue(6==d.length,"unexpected # of arguments for matrix",void 0,"SVGParserUtils.parseSVGTransform","SVGParserUtils.swift",446),_=new m.Matrix2D(d[0],d[1],d[2],d[3],d[4],d[5]);break;case"translate":f.LegacyCoreAssert.isTrue(1==d.length||2==d.length,"unexpected # of arguments for translate",void 0,"SVGParserUtils.parseSVGTransform","SVGParserUtils.swift",451),_=m.Matrix2D.translationXY(d[0],d.length>1?d[1]:0);break;case"scale":f.LegacyCoreAssert.isTrue(1==d.length||2==d.length,"unexpected # of arguments for scale",void 0,"SVGParserUtils.parseSVGTransform","SVGParserUtils.swift",456),_=m.Matrix2D.scalingXY(d[0],d.length>1?d[1]:d[0]);break;case"rotate":f.LegacyCoreAssert.isTrue(1==d.length||3==d.length,"unexpected # of arguments for rotate",void 0,"SVGParserUtils.parseSVGTransform","SVGParserUtils.swift",461);var T=d[0]*r.k_pi/180;1==d.length?_=m.Matrix2D.rotation(Math.cos(T),Math.sin(T)):3==d.length&&(_=(_=(_=m.Matrix2D.translationXY(d[1],d[2])).precat(m.Matrix2D.rotation(Math.cos(T),Math.sin(T)))).precat(m.Matrix2D.translationXY(-d[1],-d[2])));break;case"skewX":f.LegacyCoreAssert.isTrue(1==d.length,"unexpected # of arguments for skewX",void 0,"SVGParserUtils.parseSVGTransform","SVGParserUtils.swift",473),_=new m.Matrix2D(1,0,Math.tan(d[0]*r.k_pi/180),1,0,0);break;case"skewY":f.LegacyCoreAssert.isTrue(1==d.length,"unexpected # of arguments for skewY",void 0,"SVGParserUtils.parseSVGTransform","SVGParserUtils.swift",478),_=new m.Matrix2D(1,Math.tan(d[0]*r.k_pi/180),0,1,0,0);break;default:f.LegacyCoreAssert.fail("unknown SVG transform type",{type:l},"SVGParserUtils.parseSVGTransform","SVGParserUtils.swift",483)}t=t.precat(_)}return t},parseSVGBox:function(e){if(null==e)return R.TheoRect.Zero;for(var t=[],n=a.clone(h.Host.pathUtils.matchesForRegexInString(r.kNumericRegEX,e)),o=a.iter(n);!o.done;o.next()){var i=o.value;i.length>0&&t.length<4&&t.push(h.Host.pathUtils.parseStringToDouble(i))}return 4==t.length?R.TheoRect.fromXYWH(t[0],t[1],t[2],t[3]):R.TheoRect.Zero},svgArcToPath:function(e,t,n,o,i,s,l,u){var c=m._asterisk_Matrix2D_Matrix2D(m.Matrix2D.rotation(Math.cos(-o),Math.sin(-o)),m.Matrix2D.scalingXY(1/t,1/n)),d=c.transformPoint(e),h=c.transformPoint(l),p=y.MathUtils.CircleCircleIntersection(d,1,h,1),g=i==s?p.rightCenter:p.leftCenter;if(g.isValidPoint)c=m._asterisk_Matrix2D_Matrix2D(c,m.Matrix2D.translation(E._negate_TheoPoint(g)));else{g=E._plus_TheoPoint_TheoPoint(d,h).divide(2),c=m._asterisk_Matrix2D_Matrix2D(c,m.Matrix2D.translation(E._negate_TheoPoint(g)));var _=y.MathUtils.VectorNorm(E._minus_TheoPoint_TheoPoint(d,g));f.LegacyCoreAssert.isTrue(_>=1,"unexpected value for upscale",void 0,"SVGParserUtils.svgArcToPath","SVGParserUtils.swift",536),c=m._asterisk_Matrix2D_Matrix2D(c,m.Matrix2D.scalingXY(1/_,1/_))}d=E._minus_TheoPoint_TheoPoint(d,g),h=E._minus_TheoPoint_TheoPoint(h,g);var T=Math.atan2(d.y,d.x),C=Math.atan2(h.y,h.x);!s&&T<C&&(T+=r.k_two_pi),s&&T>C&&(T-=r.k_two_pi);var v=a.clone(y.MathUtils.ArcToBezier3(T,C,6));f.LegacyCoreAssert.isTrue(19==v.length,"unexpected number of points",void 0,"SVGParserUtils.svgArcToPath","SVGParserUtils.swift",567);for(var P=c.inverse,S=a.iter(a.stride(1,v.length-2,3));!S.done;S.next()){var A=S.value;if(P.isIdentity)u.cubicBezier(v[A].x,v[A].y,v[A+1].x,v[A+1].y,v[A+2].x,v[A+2].y);else{var R=D.TheoPathBuilder.init_d41d();R.cubicBezier(v[A].x,v[A].y,v[A+1].x,v[A+1].y,v[A+2].x,v[A+2].y),u.addPath(R.path,P)}}},scanCoordinateData:function(e){for(var t=[],n=a.clone(h.Host.pathUtils.matchesForRegexInString(r.kNumericRegEX,e)),o=a.iter(n);!o.done;o.next()){var i=o.value;t.push(i)}return t},scanPathData:function(e){for(var t=[],n=a.clone(h.Host.pathUtils.matchesForRegexInString("[,\\x20\\x09\\x0D\\x0A]*[ZzHhVvMmLlTtQqSsCcAa]([,\\x20\\x09\\x0D\\x0A]*[+-]?(([0-9]*\\.[0-9]+)|([0-9]+\\.?))([eE][+-]?[0-9]+)?)*",e)),o=a.iter(n);!o.done;o.next()){var i=o.value,s=h.Host.pathUtils.firstMatchForRegexInString("[ZzHhVvMmLlTtQqSsCcAa]",i);f.LegacyCoreAssert.isTrue(1==s.length,"unexpected length for path token",{token:s},"SVGParserUtils.scanPathData","SVGParserUtils.swift",611);var l=0;switch(s){case"Z":case"z":l=0;break;case"H":case"h":case"V":case"v":l=1;break;case"M":case"m":case"L":case"l":case"T":case"t":l=2;break;case"Q":case"q":case"S":case"s":l=4;break;case"C":case"c":l=6;break;case"A":case"a":l=7;break;default:l=0}t.push(s);for(var u=l,c=a.clone(h.Host.pathUtils.matchesForRegexInString(r.kNumericRegEX,i)),d=a.iter(c);!d.done;d.next()){var p=d.value;0==u&&("M"!=s&&"m"!=s||("M"==s&&(s="L"),"m"==s&&(s="l")),u=l,t.push(s)),u-=1,t.push(p)}0!=u&&f.LegacyCoreAssert.fail("svg path had wrong number of arguments",{type:s,expected:l,found:l-u},"SVGParserUtils.scanPathData","SVGParserUtils.swift",666)}return t},parseStyleStringToAttrDict:function(e){for(var t={},n=e.split(";"),r=a.iter(n);!r.done;r.next()){var o=r.value.trim();if(o.length>0){var i=o.split(":");if(2==i.length){var s=i[0].trim(),l=i[1].trim();t[s]=l}else 0!=i.length&&a.info("unexpected number of string components - just expecting a key string and a value string")}}return t},getAttrDoubleForKey:function(e,t,n){var r=e[t];return null!=r?(r.endsWith("px")&&(r=r.substr(0,r.length-"px".length)),h.Host.pathUtils.parseStringToDouble(r)):n},getSVGEndcapType:function(e){var t,n=D.TheoPath.PATHEND_BUTT;if(null!=(t=e["stroke-linecap"]))switch(t){case"round":n=D.TheoPath.PATHEND_ROUND;break;case"square":n=D.TheoPath.PATHEND_SQUARE}return n},getSVGPathJoin:function(e){var t,n=D.TheoPath.PATHJOIN_MITER;if(null!=(t=e["stroke-linejoin"]))switch(t){case"round":n=D.TheoPath.PATHJOIN_ROUND;break;case"bevel":n=D.TheoPath.PATHJOIN_BEVEL}return n},getSVGStrokeWt:function(e){var t=0,n=e["stroke-width"],r=e.stroke;return null!=r&&r.length>0&&"none"!=r&&(t=null!=n&&n.length>0?h.Host.pathUtils.parseStringToDouble(n):1),t},getSVGStrokeBaseWeight:function(e){var t=v.ShapeStyle.STROKE_BASE_WEIGHT_DEFAULT,n=e["stroke-base-weight"];return null!=n&&n.length>0&&(t=h.Host.pathUtils.parseStringToDouble(n)),t},getSVGStrokeMultiplierInitial:function(e){var t=v.ShapeStyle.STROKE_WEIGHT_MULTIPLIER_DEFAULT,n=e["stroke-multiplier-initial"];return null!=n&&n.length>0&&(t=h.Host.pathUtils.parseStringToDouble(n)),t},getSVGStrokeMultiplierMin:function(e){var t=v.ShapeStyle.STROKE_WEIGHT_MULTIPLIER_MIN_DEFAULT,n=e["stroke-multiplier-min"];return null!=n&&n.length>0&&(t=h.Host.pathUtils.parseStringToDouble(n)),t},getSVGStrokeMultiplierMax:function(e){var t=v.ShapeStyle.STROKE_WEIGHT_MULTIPLIER_MAX_DEFAULT,n=e["stroke-multiplier-max"];return null!=n&&n.length>0&&(t=h.Host.pathUtils.parseStringToDouble(n)),t},getSVGPrescaleBase:function(e){var t=v.ShapeStyle.PRESCALE_BASE_DEFAULT,n=e["prescale-base"];return null!=n&&n.length>0&&(t=h.Host.pathUtils.parseStringToDouble(n)),t},getSVGPrescaleMin:function(e){var t=v.ShapeStyle.PRESCALE_MIN_DEFAULT,n=e["prescale-min"];return null!=n&&n.length>0&&(t=h.Host.pathUtils.parseStringToDouble(n)),t},getSVGPrescaleMax:function(e){var t=v.ShapeStyle.PRESCALE_MAX_DEFAULT,n=e["prescale-max"];return null!=n&&n.length>0&&(t=h.Host.pathUtils.parseStringToDouble(n)),t},getSVGSMiterLimit:function(e){var t=4,n=e["stroke-miterlimit"];return null!=n&&n.length>0&&(t=h.Host.pathUtils.parseStringToDouble(n)),t}}}),r)},p15M:function(e,t,n){var r,o,a=t,i=n("oAGj"),s=n("gXiO"),l=n("2bF5"),u=n("/9Bx"),c=n("R19c");a.ImageAdjustmentMaps=(r=function(){this.colorMap=[],this.sMap=[],this.hMap=[],this.threeChannelColorMap=[],this.cm=[]},i.defineClass({name:"ImageAdjustmentMaps",ctor:r,superName:"CoreObject",props:{set:function(e,t,n,r,o){this.colorMap=i.clone(e),this.sMap=i.clone(t),this.hMap=i.clone(n),this.threeChannelColorMap=i.clone(r),this.cm=i.clone(o)}}}),r),a.MoaAdjustments=(o=function(){s.CoreObject.call(this)},i.defineClass({name:"MoaAdjustments",ctor:o,superName:"CoreObject",statics:{computeColorMaps:function(e){return o.computeColorMapsFromValues(e.shadows,e.highlights,e.saturation,e.brightness,e.exposure,e.contrast,e.warmth,e.tint,e.fade,e.vibrance)},computeColorMapsFromValues:function(e,t,n,r,o,s,d,h,p,f){var m=new a.ImageAdjustmentMaps,g=i.clone(u.MoaColorMap.createIdentityColorMap()),y=0!=r||0!=o||0!=s,_=0!=d||0!=h||0!=p;if(0!=r){var T=i.clone(u.MoaColorMap.createBrightnessColorMap(r));g=i.clone(u.MoaColorMap.combineColorMaps(g,T))}if(0!=o){var C=i.clone(u.MoaColorMap.createExposureColorMap(o));g=i.clone(u.MoaColorMap.combineColorMaps(g,C))}if(0!=s){var v=i.clone(u.MoaColorMap.createContrastColorMap(s));g=i.clone(u.MoaColorMap.combineColorMaps(g,v))}var P=i.clone(u.MoaColorMap.createShadowsColorMap(e)),S=i.clone(u.MoaColorMap.createHighlightsColorMap(t)),A=i.clone(u.MoaColorMap.createIdentityColorMap()),D=i.clone(u.MoaColorMap.createIdentityColorMap()),E=i.clone(u.MoaColorMap.createIdentityColorMap());if(0!=p){var R=i.clone(u.MoaColorMap.createFadeColorMap(p));A=i.clone(u.MoaColorMap.combineColorMaps(A,R)),D=i.clone(u.MoaColorMap.combineColorMaps(D,R)),E=i.clone(u.MoaColorMap.combineColorMaps(E,R))}if(0!=d){var F=i.clone(u.MoaColorMap.createWarmthColorMaps(d));A=i.clone(u.MoaColorMap.combineColorMaps(A,F[0])),D=i.clone(u.MoaColorMap.combineColorMaps(D,F[1])),E=i.clone(u.MoaColorMap.combineColorMaps(E,F[2]))}if(0!=h){var I=i.clone(u.MoaColorMap.createTintColorMaps(h));A=i.clone(u.MoaColorMap.combineColorMaps(A,I[0])),D=i.clone(u.MoaColorMap.combineColorMaps(D,I[1])),E=i.clone(u.MoaColorMap.combineColorMaps(E,I[2]))}if(y)for(var b=i.iter(i.range(0,l.MoaConstants.kMoaColorMapSizeRGB,!1));!b.done;b.next())g[k=b.value]=u.MoaColorMap.MoaColorClamp(Math.round(g[k]));if(_)for(var O=i.iter(i.range(0,l.MoaConstants.kMoaColorMapSizeRGB,!1));!O.done;O.next()){var k;A[k=O.value]=u.MoaColorMap.MoaColorClamp(Math.round(A[k])),D[k]=u.MoaColorMap.MoaColorClamp(Math.round(D[k])),E[k]=u.MoaColorMap.MoaColorClamp(Math.round(E[k]))}var M=n,N=f;if(M+N>l.MoaConstants.kSatVibranceSumMax){var L=M+N;M=l.MoaConstants.kSatVibranceSumMax*M/L,N=l.MoaConstants.kSatVibranceSumMax*N/L}var x=[1,0,0,0,0,1,0,0,0,0,1,0];0!=N&&c.MoaColorMatrix.applyVibranceToColorMatrix(x,N),0!=M&&c.MoaColorMatrix.applySaturationToColorMatrix(x,M),u.MoaColorMap.roundColorMap(P),u.MoaColorMap.roundColorMap(S);var B=i.repeat([],3);return B[0]=i.clone(A),B[1]=i.clone(D),B[2]=i.clone(E),m.set(g,P,S,B,x),m}}}),o)},pFDI:function(e,t,n){var r,o=t,a=n("oAGj"),i=n("Z25M"),s=n("FNB+"),l=n("6ZWm"),u=n("wc1n"),c=n("dE3O"),d=n("ERpL");o.ShapeFeatureExtractor=(r=function(e,t){void 0===t&&(t=[]),this.root_=e.root,this.forma_=e,this.forFeatures_=a.clone(t),this.featureEvals_=[],u.FeatureExtractor.call(this),this.initFeatures(),this.evaluateFeatures()},a.defineClass({name:"ShapeFeatureExtractor",ctor:r,superName:"FeatureExtractor",statics:{_implements:function(e){return"FeatureExtractorProtocol"==e}},props:{initFeatures:function(){this.featureEvals_=[["BoundingBox",[this.evaluateBoundingBox,u.FeatureType.Complex]],["ShapeWidth",[this.evaluateShapeWidth,u.FeatureType.Numerical]],["ShapeHeight",[this.evaluateShapeHeight,u.FeatureType.Numerical]],["Area",[this.evaluateArea,u.FeatureType.Numerical]],["CenterX",[this.evaluateCenterX,u.FeatureType.Numerical]],["CenterY",[this.evaluateCenterY,u.FeatureType.Numerical]],["RotCosine",[this.evaluateRotCosine,u.FeatureType.Numerical]],["RotSine",[this.evaluateRotSine,u.FeatureType.Numerical]],["PercentageDesignArea",[this.evaluatePercentageDesignArea,u.FeatureType.Numerical]],["PercentageOutofBounds",[this.evaluatePercentageOutofBounds,u.FeatureType.Numerical]],["PageHeight",[this.evaluatePageHeight,u.FeatureType.Numerical]],["PageWidth",[this.evaluatePageWidth,u.FeatureType.Numerical]],["ShapeCount",[this.evaluateShapeCount,u.FeatureType.Numerical]],["TextCount",[this.evaluateTextCount,u.FeatureType.Numerical]],["BackgroundImageCount",[this.evaluateBackgroundImageCount,u.FeatureType.Numerical]],["ForegroundImageCount",[this.evaluateForegroundImageCount,u.FeatureType.Numerical]]],this.evaluateOverlappingFeatures(),this.evaluateShapeMaskFeatures()},evaluateOverlappingFeatures:function(){for(var e=a.clone(this.root_.visitAsArray(s.FormaTraversal.PreOrder)),t=0,n=0,r=0,o=0,i=a.iter(e);!i.done;i.next()){var l=i.value;if(null!=l.controller&&l.controller.floating&&!l.isGridCell()&&"temp-struct-vis"!=l.intent&&l!=this.forma_){if(l.parent==this.forma_.parent){var c=this.forma_.parent.indexOfChild(this.forma_),d=this.forma_.parent.indexOfChild(l);if(null!=c&&null!=d&&c>d)continue}var h,p,f;if((h=l.finalFrame)&&(p=this.forma_.finalFrame)&&(f=h.intersectionWith(p))){var m=this.forma_.getAverageAlpha(h),g=f.area/p.area;m>.01&&g>.05&&(l.isTypeLockup()?(n+=1,r+=m*g):(t+=1,o+=m*g))}}}this.setFeature("OverlappingGraphicCount",t,u.FeatureType.Numerical),this.setFeature("OverlappingTextCount",n,u.FeatureType.Numerical),this.setFeature("PercentageTextOverlap",r,u.FeatureType.Numerical),this.setFeature("PercentageGraphicOverlap",o,u.FeatureType.Numerical)},evaluateShapeMaskFeatures:function(){var e,t=0,n=0;if((e=this.forma_.maskImage)&&!e.isEmpty()){var r=c.ImageProcessingUtils.getEdgeMagnitudeImage(e);t=e.sum()/a.toDouble(e.numElements),n=r.sum()/a.toDouble(e.numElements)}this.setFeature(d.ShapeRoleFeatures.MaskAverage,t,u.FeatureType.Numerical),this.setFeature(d.ShapeRoleFeatures.MaskAverageEdge,n,u.FeatureType.Numerical)},evaluateFeatures:function(){for(var e=0==this.forFeatures_.length,t=a.iter(this.featureEvals_);!t.done;t.next()){var n=t.value;if(e||!e&&this.forFeatures_.includes(n[0])){var r=n[1],o=(0,r[0])(this);this.setFeature(n[0],o,r[1])}}},evaluateBoundingBox:function(e){return i.DesignFeatureUtils.getFormaBoundingBox(e.forma_)},evaluateShapeWidth:function(e){return i.DesignFeatureUtils.getFormaWidth(e.forma_)},evaluateShapeHeight:function(e){return i.DesignFeatureUtils.getFormaHeight(e.forma_)},evaluateArea:function(e){return e.numericalFeatures_.ShapeWidth*e.numericalFeatures_.ShapeHeight},evaluateCenterX:function(e){return i.DesignFeatureUtils.getFormaCenterX(e.forma_)},evaluateCenterY:function(e){return i.DesignFeatureUtils.getFormaCenterY(e.forma_)},evaluateRotCosine:function(e){return e.forma_.totalPlacement.transformValues.rotCosine},evaluateRotSine:function(e){return e.forma_.totalPlacement.transformValues.rotSine},evaluatePercentageDesignArea:function(e){var t=e.root_.finalFrame.area;return e.numericalFeatures_.Area/t},evaluatePercentageOutofBounds:function(e){var t,n,r=0;return(t=e.forma_.finalFrame)&&(n=e.root_.finalFrame.intersectionWith(t))&&(r=(t.area-n.area)/t.area),r},evaluateOverlappingGraphicCount:function(e){var t,n,r=0;return(t=e.forma_.finalFrame)&&(n=e.root_.finalFrame.intersectionWith(t))&&(r=(t.area-n.area)/t.area),r},evaluateShapeCount:function(e){return i.DesignFeatureUtils.getShapeCount(e.root_)},evaluateTextCount:function(e){return i.DesignFeatureUtils.getTextCount(e.root_)},evaluatePageWidth:function(e){return i.DesignFeatureUtils.getPageWidth(e.root_)},evaluatePageHeight:function(e){return i.DesignFeatureUtils.getPageHeight(e.root_)},evaluateBackgroundImageCount:function(e){return a.toDouble(e.root_.filterWithCallback((function(e){return null!=e.controller&&e.controller.kind==l.FrameController.KIND&&e.isGridCell()})).length)},evaluateForegroundImageCount:function(e){return a.toDouble(e.root_.filterWithCallback((function(e){return null!=e.controller&&e.controller.kind==l.FrameController.KIND&&!e.isGridCell()})).length)}}}),r)},"pR+7":function(e,t,n){var r,o,a=t,i=n("oAGj"),s=n("7Pku"),l=n("w/+j"),u=n("fNpk"),c=n("Ird5"),d=n("jLWG"),h=n("jfma"),p=n("yjxF"),f=n("Aj79"),m=n("Ucb9"),g=n("K0Rh"),y=n("Zifs"),_=n("hgLm");a.RootFormaToPGMMapper=(r=function e(){s.FormaToPGMMapper.call(this,e.FORMA_KIND)},o={},i.defineClass({name:"RootFormaToPGMMapper",ctor:r,superName:"FormaToPGMMapper",statics:{FORMA_KIND:{get:function(){return void 0===o.FORMA_KIND&&(o.FORMA_KIND=g.RootForma.KIND),o.FORMA_KIND}},instance:{get:function(){return void 0===o.instance&&(o.instance=new r),o.instance}},createMapper:function(e){return r.instance}},props:{makePGMRef:function(e,t,n,r){var o,a,s;if((o=i.as(e,g.RootForma))&&(a=n.childReferences(o))&&(s=o.bounds)){var T,C=new _.TheoRectanglePath(s),v=o.style.colors.fieldPrimary||y.SolidColor.WHITE,P=v.withAlphaOf(v.alpha*t.backgroundOpacityOverride);if(P.alpha>0){var S=new f.PGMReference(new m.PGMShape(o.formaID+"-background",new p.PGMNodeMetadata(o.formaID,"background"),c.PGMAnimationList.EMPTY,s,[C],P));T=[l.FormaToPGMUtils.applyAnimations(t,e,S)].concat(a)}else T=i.clone(a);return l.FormaToPGMUtils.applyAnimations(t,e,new f.PGMReference(new d.PGMClip(o.formaID,new p.PGMNodeMetadata(o.formaID,"clip"),c.PGMAnimationList.EMPTY,T,[C]),new h.PGMCompositingParams(o.placement,o.style.opacity)))}return u.LegacyCoreAssert.fail("root forma child reference generation failed",void 0,"RootFormaToPGMMapper.makePGMRef","RootFormaToPGMMapper.swift",87),null}}}),r)},pmb0:function(e,t,n){var r,o=t,a=n("oAGj"),i=n("VQVe"),s=n("FNB+"),l=n("KkVW"),u=n("3/rh"),c=n("Pn67"),d=n("nQ+V"),h=n("SAU6"),p=n("nUE5");o.EXPOSE_MOTION_STYLE=!1,o.MotionFacade=(r=function(){},a.defineClass({name:"MotionFacade",ctor:r,statics:{ANIM_STYLE_NAME_STACKED:"Stacked",ANIM_STYLE_NAME_COMPOSITE:"Composite",getCurrentAnimationStyle:function(){return r._animStyle},applyEntryToForma:function(e,t){var n=p.MotionSource.getSourceAnimation(t.srcId,e);t.logic.apply(e,n,t.args)},canApplyStyle:function(e){return e.name==r.ANIM_STYLE_NAME_STACKED||e.name==r.ANIM_STYLE_NAME_COMPOSITE||e.name==i.AnimationStyle.NAME_DYNAMIC&&3==e.variant},createAllAnimationStyles:function(){return o.EXPOSE_MOTION_STYLE?[i.AnimationStyle.init_e14f(r.ANIM_STYLE_NAME_STACKED,0,1,i.AnimationStyleCategory.Text),i.AnimationStyle.init_e14f(r.ANIM_STYLE_NAME_COMPOSITE,0,1,i.AnimationStyleCategory.Text)]:[]},applyStyle:function(e,t){if(r.canApplyStyle(t))if(r._animStyle=t,t.name==i.AnimationStyle.NAME_DYNAMIC)r.applyEntryToForma(e,new h.MotionEntryStackedRoot);else{var n,o=[],p=new c.MotionEntryNone;e.visitAll(s.FormaTraversal.PreOrder,(function(e){r.applyEntryToForma(e,p),e.isTypeLockup()&&o.push(e)})),(n=a.first(o))&&(t.name==r.ANIM_STYLE_NAME_COMPOSITE?(r.applyEntryToForma(n,new l.MotionEntryDropIn),r.applyEntryToForma(n,new u.MotionEntryFadeIn)):t.name==r.ANIM_STYLE_NAME_STACKED&&r.applyEntryToForma(n,new d.MotionEntryStacked))}}}}),r)},pnSN:function(e,t,n){var r,o=t,a=n("oAGj"),i=n("13MC"),s=n("FNB+"),l=n("fWxZ"),u=n("QbzR"),c=n("P83h"),d=n("9Lk3"),h=n("ZK0l"),p=n("fNpk"),f=n("c+uM"),m=n("tGKA"),g=n("Quhx"),y=n("8t9B"),_=n("sIWg");o.GroupForma=(r=function(){this.cachedChildren_=null,this.cachedAuxiliaries_=null},a.defineClass({name:"GroupForma",ctor:r,superName:"Forma",statics:{KIND:{get:function(){return"group"}},PROPERTY_BOUNDS:"bounds",PROPERTY_CHILDREN:"children",OLD_PROPERTY_CHARSTYLES:"character-styles",OLD_PROPERTY_CHARSTYLERANGES:"charstyle-ranges",SCHEMA_CLASS_NAME:{get:function(){return"GroupForma"}},factory:{get:function(){var e;return function(t,n,o,i){if(null!=n){var s=a.as(a.opt(a.opt(i,(function(e){return e.backLink})),(function(e){return e.dereference()})),g.PostDCXObject),u=a.as(s,r),c=(e=a.as(s,l.FormaPage))||null!=e?e:a.opt(u,(function(e){return e.page}));return p.LegacyCoreAssert.isTrue(null!=c,"GroupForma needs a parent page",void 0,"GroupForma","GroupForma.swift",27),null!=u?r.init_3144(t,n,o,u):r.init_7dbd(t,n,o,c)}return r.init_d1c9(t,o)}}},childrenPostOrder:function(e,t,n){for(var r=null,o=0,i=t.childCount,l=t.auxiliaryCount,u=a.iter(a.range(0,t.childCount,!1));!u.done;u.next()){var c=u.value;if(null!=(r=t.childAt(c).visit(e,(function(e,t,r){return n(e,t+1,(o+=1)-1)}))))return r}if(e==s.FormaTraversal.PostOrderWithAuxiliaries)for(var d=a.iter(a.range(0,t.auxiliaryCount,!1));!d.done;d.next())if(c=d.value,null!=(r=t.auxiliaryAt(c).visit(e,(function(e,t,r){return n(e,t+1,(o+=1)-1)}))))return r;return p.LegacyCoreAssert.isTrue(i<=t.childCount,"this function should not delete any children",void 0,"GroupForma.childrenPostOrder","GroupForma.swift",775),p.LegacyCoreAssert.isTrue(l<=t.auxiliaryCount,"this function should not delete any auxiliaries",void 0,"GroupForma.childrenPostOrder","GroupForma.swift",776),n(t,0,o)?t:r},childrenPreOrder:function(e,t,n){var r=null,o=0;if(n(t,0,o))return t;for(var i=t.childCount,l=t.auxiliaryCount,u=a.iter(a.range(0,t.childCount,!1));!u.done;u.next()){var c=u.value;if(null!=(r=t.childAt(c).visit(e,(function(e,t,r){return n(e,t+1,(o+=1)-1)}))))return r}if(e==s.FormaTraversal.PreOrderWithAuxiliaries)for(var d=a.iter(a.range(0,t.auxiliaryCount,!1));!d.done;d.next())if(c=d.value,null!=(r=t.auxiliaryAt(c).visit(e,(function(e,t,r){return n(e,t+1,(o+=1)-1)}))))return r;return p.LegacyCoreAssert.isTrue(i<=t.childCount,"this function should not delete any children",void 0,"GroupForma.childrenPreOrder","GroupForma.swift",821),p.LegacyCoreAssert.isTrue(l<=t.auxiliaryCount,"this function should not delete any auxiliaries",void 0,"GroupForma.childrenPreOrder","GroupForma.swift",822),r},childrenOnly:function(e,t){for(var n=a.iter(a.range(0,e.childCount,!1));!n.done;n.next()){var r=n.value,o=e.childAt(r);if(t(o,1,r))return o}return null},childrenAndAuxiliaries:function(e,t){var n;return(n=r.childrenOnly(e,t))?n:r.auxiliariesOnly(e,t)},auxiliariesOnly:function(e,t){for(var n=a.iter(a.range(0,e.auxiliaryCount,!1));!n.done;n.next()){var r,o=n.value;if((r=e.auxiliaryAt(o))&&t(r,1,o))return r}return null},_implements:function(e){return"IDBObject"==e||"TheoMessageSubscriber"==e||"TheoMessagePublisher"==e}},props:{init_3144:function(e,t,n,r){a.super_init(this,s.Forma,s.Forma.prototype.init_3144,e,t,n,r)},init_7dbd:function(e,t,n,r){a.super_init(this,s.Forma,s.Forma.prototype.init_7dbd,e,t,n,r)},init_812f:function(e,t){for(var n={kind:function(){return r.KIND},children:function(){return[]}},o=a.clone(t),i=a.iter(n);!i.done;i.next()){var l=i.key,u=i.value;null==t[l]&&(o[l]=u())}a.super_init(this,s.Forma,s.Forma.prototype.init_812f,e,o)},init_7fcf:function(e,t){var n={kind:t};this.init_812f(e,n)},init_d1c9:function(e,t){a.super_init(this,s.Forma,s.Forma.prototype.init_d1c9,e,t)},destroy:function(){s.Forma.prototype.destroy.call(this);for(var e=a.iter(this.children_);!e.done;e.next())e.value.destroy();for(var t=a.iter(this.auxiliaries_);!t.done;t.next())t.value.destroy()},className:{get:function(){return r.SCHEMA_CLASS_NAME}},updateEventForProperty:function(e){return e==r.PROPERTY_BOUNDS?new c.FormaGeometryChangedEvent(this):e==r.PROPERTY_CHILDREN?new c.FormaHierarchyChangedEvent(this):s.Forma.prototype.updateEventForProperty.call(this,e)},postDecode:function(){var e;s.Forma.prototype.postDecode.call(this),this.populateChildrenAndAux(),this.controller instanceof y.TypeLockupController&&(e=a.as(this.style,f.LockupStyle))&&(e.wheelUsed=!1),this.controller instanceof d.GridController&&(this.validateOnSet=!0)},setProperty:function(e,t){s.Forma.prototype.setProperty.call(this,e,t),p.LegacyCoreAssert.isTrue(null!=this.getProperty(s.Forma.PROPERTY_KIND),"Group forma missing kind; base state inaccessible",{id:this.id},"GroupForma.setProperty","GroupForma.swift",119),p.LegacyCoreAssert.isTrue(null!=this.getProperty(g.PostDCXObject.PROPERTY_PATH),"Group forma missing path; base state inaccessible",{id:this.id},"GroupForma.setProperty","GroupForma.swift",120)},charStylesArray_:{get:function(){var e,t=null;if(e=a.opt(this.getProperty(r.OLD_PROPERTY_CHARSTYLES),(function(e){return e.dictionaryValue}))){t={};for(var n=a.iter(e);!n.done;n.next()){var o,i=n.key,s=n.value;(o=a.as(u.FormaStyle.codec.decode(s,this),f.LockupStyle))&&(t[i]=o)}}return t}},charStylesRangesArray:{get:function(){var e,t=null;if(e=a.opt(this.getProperty(r.OLD_PROPERTY_CHARSTYLERANGES),(function(e){return e.dictionaryValue}))){t={};for(var n=a.iter(e);!n.done;n.next()){var o=n.key,i=n.value,s=a.clone(i.arrayValue);if(null!=s){var l=s.map((function(e){return e.intValue}),this).filter((function(e){return null!=e}),this).map((function(e){return e}),this);t[o]=a.clone(l)}}}return t}},bounds_:{get:function(){return a.as(this.get(r.PROPERTY_BOUNDS),_.TheoRect)},set:function(e){this.set(r.PROPERTY_BOUNDS,e)}},children_:{get:function(){return this.populateChildrenAndAux(),this.cachedChildren_}},populateChildrenAndAux:function(){var e,t=null==this.cachedChildren_,n=null==this.cachedAuxiliaries_;if((t||n)&&(this.cachedChildren_=this.cachedChildren_||[],this.cachedAuxiliaries_=this.cachedAuxiliaries_||[],e=a.as(this.get(r.PROPERTY_CHILDREN),["Array",s.Forma])))for(var o=a.iter(e);!o.done;o.next()){var i=o.value,l=i.hasTag(s.Forma.TAG_IS_AUXILIARY);t&&!l?a.opt(this.cachedChildren_,(function(e){return e.push(i)})):n&&l&&a.opt(this.cachedAuxiliaries_,(function(e){return e.push(i)}))}},auxiliaries_:{get:function(){return this.populateChildrenAndAux(),this.cachedAuxiliaries_}},flushChildren:function(){if(null!=this.cachedChildren_||null!=this.cachedAuxiliaries_){p.LegacyCoreAssert.isTrue(a.is(this.state,i.IDBObjectMutableState),"flushChildren - group state not mutable!",void 0,"GroupForma.flushChildren","GroupForma.swift",200);var e,t,n=[];if((e=this.cachedChildren_)&&(n=e.concat()),t=this.cachedAuxiliaries_)for(var o=a.iter(t);!o.done;o.next()){var s=o.value;n.push(s)}this.set(r.PROPERTY_CHILDREN,n)}},clearCache:function(){this.flushChildren(),s.Forma.prototype.clearCache.call(this),this.cachedChildren_=null,this.cachedAuxiliaries_=null},childrenAsArray:{get:function(){return this.children_.concat()}},willCommitState:function(){this.flushChildren(),s.Forma.prototype.willCommitState.call(this)},willChangeState:function(e){var t=this;s.Forma.prototype.willChangeState.call(this,e),a.keys(e).includes(r.PROPERTY_CHILDREN)&&(a.opt(this.cachedChildren_,(function(e){return e.forEach((function(e){e.parent===t&&e.setParent(null)}))})),this.cachedChildren_=null,a.opt(this.cachedAuxiliaries_,(function(e){return e.forEach((function(e){e.parent===t&&e.setParent(null)}))})),this.cachedAuxiliaries_=null)},didChangeState:function(e){var t,n=this;a.keys(e).includes(r.PROPERTY_CHILDREN)&&(p.LegacyCoreAssert.isTrue(null==this.cachedChildren_,"Re-get of children happened while trying to change states",void 0,"GroupForma.didChangeState","GroupForma.swift",259),p.LegacyCoreAssert.isTrue(null==this.cachedAuxiliaries_,"Re-get of auxiliaries happened while trying to change states",void 0,"GroupForma.didChangeState","GroupForma.swift",260),this.cachedChildren_=null,this.cachedAuxiliaries_=null,(t=a.as(this.get(r.PROPERTY_CHILDREN),["Array",s.Forma]))&&t.forEach((function(e){return e.setParent(n,null==e.parent||e.parent!=n)}))),s.Forma.prototype.didChangeState.call(this,e)},setParent:function(e,t){if(void 0===t&&(t=!1),s.Forma.prototype.setParent.call(this,e,!1),t)for(var n=a.iter(this.childrenAsArray);!n.done;n.next())n.value.setParent(this,!0)},state:{get:function(){return s.Forma._getters.state.call(this)},set:function(e){a.is(s.Forma._getters.state.call(this),i.IDBObjectMutableState)&&this.flushChildren(),s.Forma._setters.state.call(this,e)}},bounds:{get:function(){return null!=this.bounds_?this.bounds_:this.childrenBoundsInCoordSpace(m.Matrix2D.Identity)},set:function(e){var t=this;if(!(null!=e&&null!=this.bounds_&&e.equal(this.bounds_)||null==e&&null==this.bounds_)){var n=new c.FormaGeometryChangedEvent(this);this.beginUpdate(n),a.opt(a.as(this.controller,h.GroupController),(function(e){return e.beginUpdateGroup(t.bounds_)})),this.bounds_=e,a.opt(a.as(this.controller,h.GroupController),(function(e){return e.updateGroup()})),a.opt(a.as(this.controller,h.GroupController),(function(e){return e.endUpdateGroup()})),this.endUpdate(n)}}},setBounds:{get:function(){return this.bounds_}},contentID:{get:function(){if(null!=(r=s.Forma._getters.contentID.call(this)))return r;var e=[];if(this.visit(s.FormaTraversal.JustChildren,(function(t,n,r){var o;return null!=(o=t.contentID)&&e.push(o),!1})),0==e.length)return null;a.sortInPlace(e);for(var t="",n=a.iter(e);!n.done;n.next()){var r;t+=r=n.value}return t}},match:function(e){if(s.Forma.prototype.match.call(this,e),!this.bounds.equal(e.bounds))if(null!=this.controller&&this.controller.maintainAspectRatio){var t=e.bounds.fitAspectRatioWithin(this.bounds.aspectRatio);this.bounds=_.TheoRect.fromXYWH(e.bounds.minX,e.bounds.minY,t.width,t.height)}else this.bounds=e.bounds},visit:function(e,t){switch(e){case 1:case 7:return r.childrenPreOrder(e,this,t);case 2:case 8:return r.childrenPostOrder(e,this,t);case 6:return r.childrenOnly(this,t);case 9:return r.auxiliariesOnly(this,t);case 10:return r.childrenAndAuxiliaries(this,t);default:return s.Forma.prototype.visit.call(this,e,t)}},insertChildrenInternal:function(e,t,n){if(t<0||t>this.children_.length)p.LegacyCoreAssert.fail("insertChildrenInternal: invalid index",{index:t},"GroupForma.insertChildrenInternal","GroupForma.swift",400);else{for(var r=a.iter(e);!r.done;r.next())if((l=r.value).page.uuid!=this.page.uuid)return void p.LegacyCoreAssert.fail("insertChildrenAt: attempting to insert children from a different page",void 0,"GroupForma.insertChildrenInternal","GroupForma.swift",407);var o=new c.FormaInsertedChildrenEvent(this,e,t);this.beginUpdate(o),this.makeMutable();for(var i=t,s=a.iter(e);!s.done;s.next()){var l,u=(l=s.value).totalPlacement,d=i;if(null!=l.parent&&(l.parent!=this?l.parent.removeChild(l):(i>0&&i==this.children_.length&&(d-=1),a.remove(this.children_,l))),l.setParent(this),this.children_.splice(d,0,l),i+=1,n){var h=l.totalPlacement;h.equal(u)||l.move(m.Matrix2D.concat2(h.inverse,u))}}this.endUpdate(o)}},insertChildrenAt:function(e,t,n){void 0===n&&(n=!1),this.insertChildrenInternal(e,t,n)},appendChild:function(e,t){void 0===t&&(t=!1);var n=[];n.push(e),this.insertChildrenInternal(n,this.children_.length,t)},appendChildren:function(e,t){void 0===t&&(t=!1),this.insertChildrenAt(e,this.children_.length,t)},insertBefore:function(e,t,n){void 0===n&&(n=!1),null==t?this.insertChildAt(e,this.children_.length,n):t.parent!==this?(p.LegacyCoreAssert.fail("insertBefore: refForma must be a child of this forma; appending",void 0,"GroupForma.insertBefore","GroupForma.swift",467),this.insertChildAt(e,this.children_.length,n)):this.insertChildAt(e,a.indexOfEq(this.children_,t,s._equality_Forma_Forma),n)},insertChildAt:function(e,t,n){void 0===n&&(n=!1);var r=[];r.push(e),this.insertChildrenAt(r,t,n)},removeChildrenAt:function(e,t){var n=this;if(e<0||t<0||e+t>this.children_.length)p.LegacyCoreAssert.fail("removeChildrenAt: Invalid index or count",{index:e,count:t},"GroupForma.removeChildrenAt","GroupForma.swift",482);else if(0==t);else{var r=this.children_.slice(e,e+t),o=new c.FormaRemovedChildrenEvent(this,r,e);this.beginUpdate(o),this.makeMutable();for(var i=a.iter(r);!i.done;i.next())i.value.setParent(null);this.children_.splice(e,t),this.endUpdate(o),r.forEach((function(e){return n.page.removeFormaFromCache(e.formaID)}))}},removeChild:function(e){var t;null!=(t=a.indexOfEq(this.children_,e,s._equality_Forma_Forma))?this.removeChildAt(t):p.LegacyCoreAssert.fail("Child is not part of this group",void 0,"GroupForma.removeChild","GroupForma.swift",510)},removeChildAt:function(e){this.removeChildrenAt(e,1)},removeAllChildren:function(){this.removeChildrenAt(0,this.children_.length)},indexOfChild:function(e){return a.indexOfEq(this.children_,e,s._equality_Forma_Forma)},indexOfTop:function(e){for(var t=-1,n=a.iter(a.range(0,this.childCount,!1).reversed());!n.done;n.next()){var r=n.value;if(e(this.childAt(r))){t=r;break}}return t},findDescendant:function(e){for(var t=a.iter(this.children_);!t.done;t.next()){var n,o,i=t.value;if(e(i))return i;if((n=a.as(i,r))&&(o=n.findDescendant(e)))return o}return null},findChild:function(e){return this.children_.find(e,this)},childAt:function(e){return p.LegacyCoreAssert.isTrue(e>=0&&e<this.children_.length,"requested for child at out of range index",void 0,"GroupForma.childAt","GroupForma.swift",558),e>=0&&e<this.children_.length?this.children_[e]:null},childCount:{get:function(){return this.children_.length}},boundsInCoordSpace:function(e){return null!=this.bounds_?this.bounds_.transform(e):this.childrenBoundsInCoordSpace(e)},childrenFinalFrame:{get:function(){return this.childrenBoundsInCoordSpace(this.totalPlacement)}},childrenFrame:{get:function(){return this.childrenBoundsInCoordSpace(this.placement)}},childrenBoundsInCoordSpace:function(e){var t=null;return this.children_.forEach((function(n){var o;if(o=a.as(n,r))t=_.TheoRect.unionOf(t,o.childrenBoundsInCoordSpace(n.placement.concat(e)));else if(!n.isFullCanvas){var i=n.boundsInCoordSpace(n.placement.concat(e));t=_.TheoRect.unionOf(t,i)}})),t},auxiliaryCount:{get:function(){return this.auxiliaries_.length}},auxiliaryAt:function(e){return p.LegacyCoreAssert.isTrue(e>=0&&e<this.auxiliaries_.length,"requested for auxiliary at out of range index",void 0,"GroupForma.auxiliaryAt","GroupForma.swift",609),e>=0&&e<this.auxiliaries_.length?this.auxiliaries_[e]:null},indexOfAuxiliary:function(e){return a.indexOfEq(this.auxiliaries_,e,s._equality_Forma_Forma)},findAuxiliary:function(e){return this.auxiliaries_.find(e,this)},appendAuxiliary:function(e){var t=[];t.push(e),this.insertAuxiliaryInternal(t,this.auxiliaries_.length)},removeAuxiliary:function(e){var t;null!=(t=a.indexOfEq(this.auxiliaries_,e,s._equality_Forma_Forma))?this.removeAuxiliaryAt(t):p.LegacyCoreAssert.fail("Auxiliary is not part of this group",void 0,"GroupForma.removeAuxiliary","GroupForma.swift",637)},removeAuxiliaryAt:function(e){this.removeAuxiliariesAt(e,1)},removeAuxiliariesAt:function(e,t){if(e<0||t<0||e+t>this.auxiliaries_.length)p.LegacyCoreAssert.fail("removeAuxiliariesAt: Invalid index or count",{index:e,count:t},"GroupForma.removeAuxiliariesAt","GroupForma.swift",647);else if(t>0){var n=this.auxiliaries_.slice(e,e+t),r=new c.FormaRemovedAuxiliariesEvent(this,n,e);this.beginUpdate(r),this.makeMutable();for(var o=a.iter(n);!o.done;o.next())o.value.setParent(null);this.auxiliaries_.splice(e,t),this.endUpdate(r)}},insertAuxiliaryInternal:function(e,t){if(t<0||t>this.auxiliaries_.length)p.LegacyCoreAssert.fail("insertAuxiliaryInternal: invalid index",{index:t},"GroupForma.insertAuxiliaryInternal","GroupForma.swift",666);else{for(var n=a.iter(e);!n.done;n.next()){if((l=n.value).page.uuid!=this.page.uuid)return void p.LegacyCoreAssert.fail("insertAuxiliaryInternal: attempting to insert formae from a different page",void 0,"GroupForma.insertAuxiliaryInternal","GroupForma.swift",673);l.setTag(s.Forma.TAG_IS_AUXILIARY)}var r=new c.FormaInsertedAuxiliariesEvent(this,e,t);this.beginUpdate(r),this.makeMutable();for(var o=t,i=a.iter(e);!i.done;i.next()){var l,u;(u=(l=i.value).parent)&&(u!=this?u.removeAuxiliary(l):a.remove(this.auxiliaries_,l)),o>this.auxiliaries_.length&&(o=this.auxiliaries_.length),l.setParent(this),this.auxiliaries_.splice(o,0,l),o+=1}this.endUpdate(r)}},isImage:function(){return this.children_.length>0&&null==this.children_.find((function(e){return!e.isImage()}),this)},isGraphic:function(){return this.children_.length>0&&null==this.children_.find((function(e){return!e.isGraphic()}),this)},isText:function(){return this.children_.length>0&&null==this.children_.find((function(e){return!e.isText()}),this)},isShape:function(){return this.children_.length>0&&null==this.children_.find((function(e){return!e.isShape()}),this)},isVideo:function(){return this.children_.length>0&&null==this.children_.find((function(e){return!e.isVideo()}),this)},isLogo:function(){return this.children_.length>0&&null==this.children_.find((function(e){return!e.isLogo()}),this)},isSticker:function(){return this.children_.length>0&&null==this.children_.find((function(e){return!e.isSticker()}),this)}}}),r)},q5zr:function(e,t,n){var r,o,a=t,i=n("oAGj"),s=n("CWW7"),l=n("yGNn"),u=n("A6KL"),c=n("iCxV"),d=n("2rlr"),h=n("REQJ"),p=n("fNpk"),f=n("90dd"),m=n("sIWg"),g=n("qSCS");a.ImageContentNode=(r=function(){this.computeSaliencyPromise_=null,this.saliencyIntegral_=null,this.edgeIntegral_=null,this.MAX_SALIENCY_DIM=20,this.setFocusPromise_=null,this.image_=null},i.defineClass({name:"ImageContentNode",ctor:r,superName:"URLBasedContentNode",statics:{KIND:{get:function(){return"image"}},SCHEMA_CLASS_NAME:{get:function(){return"ImageContentNode"}},factory:{get:function(){return function(e,t,n,o){var a=i.as(i.opt(i.opt(o,(function(e){return e.backLink})),(function(e){return e.dereference()})),u.GroupContentNode);return p.LegacyCoreAssert.isTrue(null!=a,"Content nodes need a parent",void 0,"ImageContentNode","ImageContentNode.swift",16),r.init_3144(e,t,n,a)}}},PROPERTY_PIXEL_WIDTH:"pixel-width",PROPERTY_PIXEL_HEIGHT:"pixel-height",PROPERTY_IMAGE_COLOR_DATA:"image-color-data",PROPERTY_IMAGE_HAS_ALPHA:"image-has_alpha",PROPERTY_SALIENCY_WIDTH:"saliency-width",PROPERTY_SALIENCY_HEIGHT:"saliency-height",PROPERTY_SALIENCY_DATA:"saliency-data",PROPERTY_EDGE_DATA:"edge-data",PROPERTY_FOCUS_REGION:"focus-region",PROPERTY_TRIMMED_BOUNDS:"trimmed-bounds",IMAGE_MASK_ROLE_TAG:{get:function(){return"image-role"}},IMAGE_MASK_METADATA_TAG:{get:function(){return"image-mask-metadata"}},ROLE_MASK:{get:function(){return"mask"}},ASSET_ID_TAG:{get:function(){return"asset-id"}},_implements:function(e){return"IDBObject"==e||"TheoMessagePublisher"==e}},props:{init_3144:function(e,t,n,r){i.super_init(this,g.URLBasedContentNode,g.URLBasedContentNode.prototype.init_3144,e,t,n,r)},init_26a9:function(e,t){i.super_init(this,g.URLBasedContentNode,g.URLBasedContentNode.prototype.init_c3fa,e,"image",t)},init_5972:function(e,t){i.super_init(this,g.URLBasedContentNode,g.URLBasedContentNode.prototype.init_8b5c,e,"image",t)},className:{get:function(){return r.SCHEMA_CLASS_NAME}},willCommitState:function(){var e,t,n,o,a,i,s;(e=this.saliencyData_)&&(this.set(r.PROPERTY_SALIENCY_DATA,e),this.saliencyData_=null),(t=this.edgeData_)&&(this.set(r.PROPERTY_EDGE_DATA,t),this.edgeData_=null),null!=(n=this.saliencyWidth_)&&(this.set(r.PROPERTY_SALIENCY_WIDTH,n),this.saliencyWidth_=null),null!=(o=this.saliencyHeight_)&&(this.set(r.PROPERTY_SALIENCY_HEIGHT,o),this.saliencyHeight_=null),(a=this.focusRegion_)&&(this.set(r.PROPERTY_FOCUS_REGION,a),this.focusRegion_=null),(i=this.trimmedBounds_)&&(this.set(r.PROPERTY_TRIMMED_BOUNDS,i),this.trimmedBounds_=null),null!=(s=this.hasAlpha_)&&(this.set(r.PROPERTY_IMAGE_HAS_ALPHA,s),this.hasAlpha_=null),g.URLBasedContentNode.prototype.willCommitState.call(this)},pixelWidth:{get:function(){var e;return(e=i.as(this.get(r.PROPERTY_PIXEL_WIDTH),"Int"))||null!=e?e:0},set:function(e){this.set(r.PROPERTY_PIXEL_WIDTH,e)}},pixelHeight:{get:function(){var e;return(e=i.as(this.get(r.PROPERTY_PIXEL_HEIGHT),"Int"))||null!=e?e:0},set:function(e){this.set(r.PROPERTY_PIXEL_HEIGHT,e)}},imageColorData:{get:function(){return i.as(this.get(r.PROPERTY_IMAGE_COLOR_DATA),["Array",h.ImageColorData])}},saliencyWidth:{get:function(){var e,t;return null==this.get(r.PROPERTY_SALIENCY_WIDTH)&&null==this.saliencyWidth_&&this.computeSaliencyData(),(e=i.as(this.get(r.PROPERTY_SALIENCY_WIDTH),"Int"))||null!=e?e:(t=this.saliencyWidth_)||null!=t?t:0}},saliencyHeight:{get:function(){var e,t;return null==this.get(r.PROPERTY_SALIENCY_HEIGHT)&&null==this.saliencyHeight_&&this.computeSaliencyData(),(e=i.as(this.get(r.PROPERTY_SALIENCY_HEIGHT),"Int"))||null!=e?e:(t=this.saliencyHeight_)||null!=t?t:0}},saliencyData:{get:function(){var e;return null==this.get(r.PROPERTY_SALIENCY_DATA)&&null==this.saliencyData_&&this.computeSaliencyData(),(e=i.as(this.get(r.PROPERTY_SALIENCY_DATA),["Array","Double"]))?e:this.saliencyData_}},edgeData:{get:function(){var e;return null==this.get(r.PROPERTY_EDGE_DATA)&&null==this.edgeData_&&this.computeEdgeData(),(e=i.as(this.get(r.PROPERTY_EDGE_DATA),["Array","Double"]))||null!=e?e:this.edgeData_}},getSaliencyDataDimensions:function(){if(0==this.pixelWidth||0==this.pixelHeight)return null;var e,t,n=this.MAX_SALIENCY_DIM,r=i.toDouble(this.pixelWidth)/i.toDouble(this.pixelHeight);return r>1?(e=i.toInt(n),t=i.toInt(n/r)):(e=i.toInt(n*r),t=i.toInt(n)),0==e||0==t?null:{width:e,height:t}},computeSaliencyData:function(){var e,t,n=this;if((e=this.image)&&null!=(t=this.getSaliencyDataDimensions())){if(null!=this.computeSaliencyPromise_)return;this.computeSaliencyPromise_=e.whenAsyncFeaturesLoaded().then((function(r){var o=0==n.database.transactionDepth?n.database.beginTransaction("compute_saliency",null):null;n.makeMutable();var a=i.clone(e.getSaliencyData(t.width,t.height));return a.length>0&&(n.saliencyWidth_=t.width,n.saliencyHeight_=t.height,n.saliencyData_=i.clone(a),n.computeSaliencyIntegral()),i.opt(o,(function(e){return e.mergeWithPrevious()})),n.computeSaliencyPromise_=null,null}))}},computeSaliencyIntegral:function(){var e;(e=this.saliencyData)&&e.length>0&&(this.saliencyIntegral_=i.clone(this.createIntegralImage(e,this.saliencyWidth,this.saliencyHeight)))},createIntegralImage:function(e,t,n){for(var r=i.repeat(0,t*n),o=i.repeat([],n),a=i.repeat([],n),s=i.iter(i.range(0,n,!1));!s.done;s.next())for(var l=s.value,u=i.iter(i.range(0,t,!1));!u.done;u.next()){var c=u.value,d=c>0&&l>0?r[(l-1)*t+(c-1)]:0,h=l>0?r[(l-1)*t+c]:0,p=c>0?r[l*t+(c-1)]:0,f=e[l*t+c];r[l*t+c]=f+h+p-d,o[l].push(f),a[l].push(f+h+p-d)}return r},computeEdgeData:function(){var e,t;if((e=this.image)&&null!=(t=this.getSaliencyDataDimensions())){var n=0==this.database.transactionDepth?this.database.beginTransaction("compute_edge_data",null):null;this.makeMutable(),this.saliencyWidth_=t.width,this.saliencyHeight_=t.height,this.edgeData_=i.clone(e.getEdgeData(this.saliencyWidth_,this.saliencyHeight_)),this.computeEdgeIntegral(),i.opt(n,(function(e){return e.mergeWithPrevious()}))}},computeEdgeIntegral:function(){var e;(e=this.edgeData)&&e.length>0&&(this.edgeIntegral_=i.clone(this.createIntegralImage(e,this.saliencyWidth,this.saliencyHeight)))},getAverageEdge:function(e){var t;if(c.Host.platform.isWeb||c.Host.platform.isService){if(null!=this.saliencyData&&null==this.saliencyIntegral_&&this.computeSaliencyIntegral(),(t=this.saliencyIntegral_)&&t.length>0)return this.getAverageSaliencyOrEdge(e,t,this.saliencyWidth,this.saliencyHeight)}else if(null!=this.edgeData&&null==this.edgeIntegral_&&this.computeEdgeIntegral(),(t=this.edgeIntegral_)&&t.length>0)return this.getAverageSaliencyOrEdge(e,t,this.saliencyWidth,this.saliencyHeight);return 0},getAverageSaliencyOrEdge:function(e,t,n,r){if(0==this.saliencyWidth||0==this.saliencyHeight)return 0;var o=i.toDouble(n)/i.toDouble(this.pixelWidth),a=i.toDouble(r)/i.toDouble(this.pixelHeight),s=e.multiplyXY(o,a),l=i.toInt(Math.max(i.toInt(s.minY),0)),u=i.toInt(Math.min(i.toInt(s.maxY),r-1)),c=i.toInt(Math.max(i.toInt(s.minX),0)),d=i.toInt(Math.min(i.toInt(s.maxX),n-1));if(l>=u||c>=d)return 0;var h=t[l*n+c],p=t[l*n+d],f=t[u*n+c],m=t[u*n+d]+h-p-f,g=(d-c)*(u-l);return i.toDouble(m)/i.toDouble(g)},computeFocusRegion:function(){var e;(e=this.image)&&e.loaded()&&(this.focusRegion_=e.getFocus())},focusRegion:{get:function(){var e,t;return null==i.as(this.get(r.PROPERTY_FOCUS_REGION),m.TheoRect)&&null==this.focusRegion_&&this.computeFocusRegion(),(t=(e=i.as(this.get(r.PROPERTY_FOCUS_REGION),m.TheoRect))||null!=e?e:this.focusRegion_)?0==t.width||0==t.height?m.TheoRect.fromXXYY(0,i.toDouble(this.pixelWidth),0,i.toDouble(this.pixelHeight)):m.TheoRect.fromXXYY(t.minX*i.toDouble(this.pixelWidth),t.maxX*i.toDouble(this.pixelWidth),t.minY*i.toDouble(this.pixelHeight),t.maxY*i.toDouble(this.pixelHeight)):null},set:function(e){var t;(t=e)&&p.LegacyCoreAssert.isTrue(t.maxX<=1&&t.maxY<=1,"focusRegion must be 0-1",void 0,"ImageContentNode","ImageContentNode.swift",353),this.focusRegion_=null,this.set(r.PROPERTY_FOCUS_REGION,e)}},computeTrimmedBounds:function(){var e;if((e=this.image)&&e.loaded()){var t,n=0==this.database.transactionDepth?this.database.beginTransaction("compute_trimmed_bounds",null):null;this.makeMutable(),this.trimmedBounds_=null,(t=e.getTrimmedBounds())&&isFinite(t.minX)&&isFinite(t.maxX)&&isFinite(t.minY)&&isFinite(t.maxY)&&(this.trimmedBounds_=t),i.opt(n,(function(e){return e.mergeWithPrevious()}))}},trimmedBounds:{get:function(){var e;return null==i.as(this.get(r.PROPERTY_TRIMMED_BOUNDS),m.TheoRect)&&null==this.trimmedBounds_&&this.computeTrimmedBounds(),(e=i.as(this.get(r.PROPERTY_TRIMMED_BOUNDS),m.TheoRect))||null!=e?e:this.trimmedBounds_},set:function(e){this.trimmedBounds_=null,this.set(r.PROPERTY_TRIMMED_BOUNDS,e)}},whenLoaded:function(){var e=this;return new l.CorePromise((function(t,n){var r;(r=e.image)?r.whenLoaded().then((function(e){return t(r)})):n("Content node's image is nil")}))},createImageFeatures:function(){var e=this;i.opt(this.image,(function(t){return t.whenLoaded().then((function(t){return e.persisted&&(e.focusRegion,i.clone(e.saliencyData),i.clone(e.edgeData),i.clone(e.imageColorData)),null}))}))},computeHasAlpha:function(){var e;"image/jpeg"==this.mimeType?this.hasAlpha_=!1:(e=this.image)&&(this.hasAlpha_=e.hasAlpha())},hasAlpha:{get:function(){var e,t;return null==this.get(r.PROPERTY_IMAGE_HAS_ALPHA)&&null==this.hasAlpha_&&this.computeHasAlpha(),(e=i.as(this.get(r.PROPERTY_IMAGE_HAS_ALPHA),"Bool"))||null!=e?e:!(!(t=this.hasAlpha_)&&null==t)&&t},set:function(e){this.hasAlpha_=null,this.set(r.PROPERTY_IMAGE_HAS_ALPHA,e)}},isMask:{get:function(){return this.getTag(r.IMAGE_MASK_ROLE_TAG)==r.ROLE_MASK}},hasAlphaSafe:{get:function(){return i.as(this.get(r.PROPERTY_IMAGE_HAS_ALPHA),"Bool")}},image:{get:function(){var e=this;return null==this.image_&&null!=this.url&&(this.image_=c.Host.imageAnalysis.createHostImage(this.url,this.hasAlphaSafe,this)),null==this.image_||this.isMask||null!=this.get(r.PROPERTY_FOCUS_REGION)||null==this.setFocusPromise_&&(this.setFocusPromise_=i.opt(this.image_,(function(t){return t.whenAsyncFeaturesLoaded().then((function(t){return e.setFocusPromise_=null,i.opt(e.database.appliedState,(function(t){return null!=t.getObjectStateByID(e.id)}))&&(e.focusRegion_=i.opt(e.image_,(function(e){return e.getFocus()}))),null}))}))),this.image_},set:function(e){this.image_=e}},hostImageLoaded:{get:function(){var e;return!!(e=this.image_)&&e.loaded()}},releaseResources:function(){this.image_=null},recreateImageAndFeatures:function(){var e=this;return this.image_=null,this.whenLoaded().then((function(t){var n;return(n=i.as(t,d.HostImage))&&(e.hasAlpha=n.hasAlpha(),e.pixelWidth=n.getWidth(),e.pixelHeight=n.getHeight(),e.isMask||(e.computeEdgeData(),e.computeSaliencyData(),e.computeFocusRegion()),e.computeTrimmedBounds()),t}))},copyTo:function(e){var t;return(t=i.as(e.content.createNode(r.KIND,null),r))?(s.CreationFacade.addContentNodeToDocument(t,e),t.match(this),t):null},componentID:{get:function(){return g.URLBasedContentNode._getters.componentID.call(this)},set:function(e){g.URLBasedContentNode._setters.componentID.call(this,e),this.onSourceUpdated()}},url:{get:function(){return g.URLBasedContentNode._getters.url.call(this)},set:function(e){g.URLBasedContentNode._setters.url.call(this,e),this.onSourceUpdated()}},didChangeState:function(e){g.URLBasedContentNode.prototype.didChangeState.call(this,e);var t=i.keys(e);(t.includes(g.URLBasedContentNode.PROPERTY_DATA_URL)||t.includes(g.URLBasedContentNode.PROPERTY_COMPONENT_URL)||t.includes(g.URLBasedContentNode.PROPERTY_COMPONENT_ID)||t.includes(g.URLBasedContentNode.PROPERTY_COMPONENTS))&&this.onSourceUpdated()},onSourceUpdated:function(){this.publish(new a.ImageContentChangedMessage(this))}}}),r),a.ImageContentChangedMessage=(o=function e(t){this.model=t,f.TheoMessage.call(this,e.TYPE,t)},i.defineClass({name:"ImageContentChangedMessage",ctor:o,superName:"TheoMessage",statics:{TYPE:{get:function(){return"ImageContentChangedMessage"}}}}),o)},qSCS:function(e,t,n){var r,o=t,a=n("oAGj"),i=n("SpAV"),s=n("HRWw"),l=n("fNpk"),u=n("VkKB");o.URLBasedContentNode=(r=function(){this.remappedUrl_=null},a.defineClass({name:"URLBasedContentNode",ctor:r,superName:"ContentNode",statics:{SCHEMA_CLASS_NAME:{get:function(){return"URLBasedContentNode"}},DATA_URL_PREFIX:"data:",PROPERTY_DATA_URL:"data-url",PROPERTY_MIMETYPE:"mimetype",PROPERTY_MEDIA_METADATA:"media-metadata",PROPERTY_SPARK_ELEMENTID:"element-id",PROPERTY_SPARK_ROLES:"roles",PROPERTY_LOCAL_IDENTIFIER:"local-identifier",PROPERTY_COMPONENTS:"components",PROPERTY_COMPONENT_URL:"url",PROPERTY_COMPONENT_MIMETYPE:"mimeType",PROPERTY_COMPONENT_ID:"id",DO_NOT_LOAD_DATA_URL:"do-not-load",ACP_PREFIX:"acp:",CP_PREFIX:"cp:",_implements:function(e){return"IDBObject"==e||"TheoMessagePublisher"==e}},props:{init_3144:function(e,t,n,r){a.super_init(this,s.ContentNode,s.ContentNode.prototype.init_3144,e,t,n,r)},init_5e75:function(e,t,n,r){a.super_init(this,s.ContentNode,s.ContentNode.prototype.init_5e75,e,t,n,r)},init_8b5c:function(e,t,n){a.super_init(this,s.ContentNode,s.ContentNode.prototype.init_8b5c,e,t,n)},init_c3fa:function(e,t,n){a.super_init(this,s.ContentNode,s.ContentNode.prototype.init_c3fa,e,t,n)},className:{get:function(){return r.SCHEMA_CLASS_NAME}},setDoNotLoadURL:function(){var e;(e=a.as(this.get(r.PROPERTY_COMPONENTS),["Array",["Dictionary","String","Any"]]))&&1==e.length&&(this.url=r.DO_NOT_LOAD_DATA_URL)},saveComponentDescription:function(e,t,n){var o,i,s,u,c,d=(o=e)||null!=o?o:(i=this.componentID)||null!=i?i:this.id,h=(s=t)||null!=s?s:this.url,p=(u=n)||null!=u?u:this.mimeType,f={};(c=a.as(this.get(r.PROPERTY_COMPONENTS),["Array",["Dictionary","String","Any"]]))&&(l.LegacyCoreAssert.isTrue(1==c.length,"Expecting only one component",void 0,"URLBasedContentNode.saveComponentDescription","URLBasedContentNode.swift",74),c.length>0&&(f=a.clone(c[0]))),f[r.PROPERTY_COMPONENT_ID]=d,null!=h&&(f[r.PROPERTY_COMPONENT_URL]=h),null!=p&&(f[r.PROPERTY_COMPONENT_MIMETYPE]=p),this.set(r.PROPERTY_COMPONENTS,[f])},url:{get:function(){var e,t=a.as(this.get(r.PROPERTY_DATA_URL),"String");return null==t&&(e=a.as(this.get(r.PROPERTY_COMPONENTS),["Array",["Dictionary","String","Any"]]))&&e.length>0&&(t=a.as(e[0][r.PROPERTY_COMPONENT_URL],"String")),t},set:function(e){null==e?(this.set(r.PROPERTY_DATA_URL,null),this.set(r.PROPERTY_COMPONENTS,null)):e.startsWith(r.DATA_URL_PREFIX)?(this.set(r.PROPERTY_DATA_URL,e),this.set(r.PROPERTY_COMPONENTS,null)):(this.saveComponentDescription(null,e,null),this.set(r.PROPERTY_DATA_URL,null))}},componentID:{get:function(){var e,t;return(t=a.as(this.get(r.PROPERTY_COMPONENTS),["Array",["Dictionary","String","Any"]]))&&(l.LegacyCoreAssert.isTrue(1==t.length,"componentID components count not equal 1.",{count:t.length},"URLBasedContentNode","URLBasedContentNode.swift",142),t.length>0&&(e=a.as(t[0][r.PROPERTY_COMPONENT_ID],"String"))),e},set:function(e){this.saveComponentDescription(e,null,null)}},mimeType:{get:function(){return a.as(this.get(r.PROPERTY_MIMETYPE),"String")},set:function(e){this.set(r.PROPERTY_MIMETYPE,e),null!=a.as(this.get(r.PROPERTY_COMPONENTS),["Array",["Dictionary","String","Any"]])&&this.saveComponentDescription(null,null,e)}},remappedUrl:{get:function(){return this.remappedUrl_},set:function(e){var t,n=a.opt(this.url,(function(e){return 1==e.startsWith(r.ACP_PREFIX)}));i.CoreAssertDebugOnly.isTrue(n,"Recording remapped URL for non-ACP url",{url:(t=this.url)||null!=t?t:"nil"},"URLBasedContentNode","URLBasedContentNode.swift",176),this.remappedUrl_=e}},sparkRoles:{get:function(){return a.as(this.get(r.PROPERTY_SPARK_ROLES),["Array","String"])}},setRoles:function(e){this.set(r.PROPERTY_SPARK_ROLES,e)},clearRoles:function(){this.set(r.PROPERTY_SPARK_ROLES,null)},getSparkLogoRole:function(){var e;if(e=this.sparkRoles)for(var t=a.iter(e);!t.done;t.next()){var n=t.value;switch(n){case"primary-logo":case"secondary-logo":return n;default:continue}}return null},sparkElementID:{get:function(){return a.as(this.get(r.PROPERTY_SPARK_ELEMENTID),"String")},set:function(e){this.set(r.PROPERTY_SPARK_ELEMENTID,e)}},mediaMetadata:{get:function(){return a.as(this.get(r.PROPERTY_MEDIA_METADATA),u.MediaMetadata)},set:function(e){this.set(r.PROPERTY_MEDIA_METADATA,e)}},localIdentifier:{get:function(){return a.as(this.get(r.PROPERTY_LOCAL_IDENTIFIER),"String")},set:function(e){this.set(r.PROPERTY_LOCAL_IDENTIFIER,e)}},match:function(e,t){var n;void 0===t&&(t=null);var o=a.clone(t),i=(n=a.opt(a.as(e,r),(function(e){return e.url})))||null!=n?n:"",l=i.startsWith(r.ACP_PREFIX),u=i.startsWith(r.CP_PREFIX);(i==r.DO_NOT_LOAD_DATA_URL||l||u)&&(o=(t||[]).concat([r.PROPERTY_COMPONENTS])),s.ContentNode.prototype.match.call(this,e,o),(l||u)&&(this.url=i)}}}),r)},qTtJ:function(e,t,n){var r,o=t,a=n("oAGj"),i=n("URxh"),s=n("tGKA"),l=n("K17h"),u=n("RkYL"),c=n("xm77");o.MotionSrcFadeIn=(r=function(){},a.defineClass({name:"MotionSrcFadeIn",ctor:r,statics:{getSrcKeyframes:function(e){var t=[],n=u.TheoTime.Zero,r=u.TheoTime.fromSeconds(1),o=s.Matrix2D.Identity,a=s.Matrix2D.Identity,d=l.MotionUtils.createOpacityStyle(e,0),h=e.style.clone();return t.push(new i.KeyFrame(n,c.TimingFunctionType.Linear,o,null,d)),t.push(new i.KeyFrame(r,c.TimingFunctionType.Linear,a,null,h)),t}}}),r)},qsM9:function(e,t,n){var r,o=t,a=n("oAGj"),i=n("ascj"),s=n("dJuF"),l=n("URxh"),u=n("QgZx"),c=n("ylxa"),d=n("QbzR"),h=n("tQF8"),p=n("iCxV"),f=n("3lr5"),m=n("Qlvz"),g=n("REQJ"),y=n("fNpk"),_=n("tGKA"),T=n("VkKB"),C=n("Zifs"),v=n("byfQ"),P=n("umUn"),S=n("9YN4"),A=n("VJ9E"),D=n("BgH2"),E=n("hgLm"),R=n("oKlP"),F=n("uUew"),I=n("sIWg"),b=n("1NAc"),O=n("RkYL"),k=n("xm77");o.Codecs=(r=function(){},a.defineClass({name:"Codecs",ctor:r,statics:{solidColorCodec:{get:function(){return s.DBPropertyCodec.typeCodec("SolidColor")||s.DBPropertyCodec.registerCodec("SolidColor",s.DBPropertyCodec.codec((function(e,t,n){var r,o=s.DBProperty.deleted(e);if(r=a.as(t,C.SolidColor)){var i={red:s.DBProperty.doubleProperty(e.append("red"),r.red),green:s.DBProperty.doubleProperty(e.append("green"),r.green),blue:s.DBProperty.doubleProperty(e.append("blue"),r.blue),alpha:s.DBProperty.doubleProperty(e.append("alpha"),r.alpha)};o=s.DBProperty.dictEncoded(e,i,"SolidColor")}else y.LegacyCoreAssert.fail("Expected SolidColor",{actual:t},"Codecs","Codecs.swift",25);return o}),(function(e,t){if(null!=e){var n,r,o,i,s;if((n=a.opt(e,(function(e){return e.dictionaryValue})))&&null!=(r=a.opt(n.red,(function(e){return e.doubleValue})))&&null!=(o=a.opt(n.green,(function(e){return e.doubleValue})))&&null!=(i=a.opt(n.blue,(function(e){return e.doubleValue})))&&null!=(s=a.opt(n.alpha,(function(e){return e.doubleValue}))))return new C.SolidColor(r,o,i,s);y.LegacyCoreAssert.fail("Expected a color dictionary.",void 0,"Codecs","Codecs.swift",39)}return null}),"SolidColor"))}},theoColorCodec:{get:function(){var e=this;return s.DBPropertyCodec.typeCodec("TheoColor")||s.DBPropertyCodec.registerCodec("TheoColor",s.DBPropertyCodec.codec((function(e,t,n){var r,o=s.DBProperty.deleted(e);if(r=a.as(t,P.TheoColor)){var i={red:s.DBProperty.doubleProperty(e.append("red"),r.rgbColor.red),green:s.DBProperty.doubleProperty(e.append("green"),r.rgbColor.green),blue:s.DBProperty.doubleProperty(e.append("blue"),r.rgbColor.blue),alpha:s.DBProperty.doubleProperty(e.append("alpha"),r.rgbColor.alpha)},l=[];if(null!=r.sparkRoles)for(var u=a.iter(a.toSequence(r.sparkRoles));!u.done;u.next()){var c=u.value,d=c.offset,h=c.element;l.push(s.DBProperty.stringProperty(e.append("sparkRoles").append(a.toString(d)),h))}0==!l.length&&(i.sparkRoles=s.DBProperty.arrayProperty(e.append("sparkRoles"),l)),null!=r.sparkElementID&&(i.sparkElementID=s.DBProperty.stringProperty(e.append("sparkElementID"),r.sparkElementID)),o=s.DBProperty.dictEncoded(e,i,"TheoColor")}else y.LegacyCoreAssert.fail("Expected TheoColor",{actual:t},"Codecs","Codecs.swift",73);return o}),(function(t,n){if(null!=t){var r,o,i,s,l;if((r=a.opt(t,(function(e){return e.dictionaryValue})))&&null!=(o=a.opt(r.red,(function(e){return e.doubleValue})))&&null!=(i=a.opt(r.green,(function(e){return e.doubleValue})))&&null!=(s=a.opt(r.blue,(function(e){return e.doubleValue})))&&null!=(l=a.opt(r.alpha,(function(e){return e.doubleValue})))){var u=a.clone(a.opt(a.opt(r.sparkRoles,(function(e){return e.arrayValue})),(function(t){return t.map((function(e){return e.stringValue}),e)}))),c=a.opt(r.sparkElementID,(function(e){return e.stringValue}));return P.TheoColor.init_5344(new C.SolidColor(o,i,s,l),c,u)}y.LegacyCoreAssert.fail("Expected a color dictionary.",void 0,"Codecs","Codecs.swift",89)}return null}),"TheoColor"))}},paletteIDCodec:{get:function(){return s.DBPropertyCodec.typeCodec("PaletteID")||s.DBPropertyCodec.registerCodec("PaletteID",s.DBPropertyCodec.codec((function(e,t,n){var r,o,i=s.DBProperty.deleted(e);return null!=(r=a.as(t,"String"))?i=s.DBProperty.stringProperty(e,r):null!=(o=a.as(t,"Int"))&&(i=s.DBProperty.stringProperty(e,a.toString(o))),i}),(function(e,t){if(null!=e){var n,r;if(null!=(n=a.opt(e,(function(e){return e.stringValue}))))return n;if(null!=(r=a.opt(e,(function(e){return e.intValue}))))return a.toString(r)}return""}),"PaletteID"))}},theoTimeCodec:{get:function(){return s.DBPropertyCodec.typeCodec("TheoTime")||s.DBPropertyCodec.registerCodec("TheoTime",s.DBPropertyCodec.codec((function(e,t,n){var r,o=s.DBProperty.deleted(e);return(r=a.as(t,O.TheoTime))&&(o=s.DBProperty.arrayProperty(e,[s.DBProperty.intProperty(e.append("0"),r.value),s.DBProperty.intProperty(e.append("1"),r.timescale)])),o}),(function(e,t){if(null!=e){var n;if((n=a.opt(e,(function(e){return e.arrayValue})))&&2==n.length){var r=n[0].intValue,o=n[1].intValue;if(null!=r&&null!=o)return new O.TheoTime(r,o)}y.LegacyCoreAssert.fail("Expected an array of 2 ints.",void 0,"Codecs","Codecs.swift",142)}return null}),"TheoTime"))}},theoSizeCodec:{get:function(){return s.DBPropertyCodec.typeCodec("TheoSize")||s.DBPropertyCodec.registerCodec("TheoSize",s.DBPropertyCodec.codec((function(e,t,n){var r,o=s.DBProperty.deleted(e);return(r=a.as(t,b.TheoSize))&&(o=s.DBProperty.arrayProperty(e,[s.DBProperty.doubleProperty(e.append("0"),r.width),s.DBProperty.doubleProperty(e.append("1"),r.height)])),o}),(function(e,t){if(null!=e){var n;if((n=a.opt(e,(function(e){return e.arrayValue})))&&2==n.length){var r=n[0].doubleValue,o=n[1].doubleValue;if(null!=r&&null!=o)return new b.TheoSize(r,o)}y.LegacyCoreAssert.fail("Expected an array of 2 doubles.",void 0,"Codecs","Codecs.swift",170)}return null}),"TheoSize"))}},theoPointCodec:{get:function(){return s.DBPropertyCodec.typeCodec("TheoPoint")||s.DBPropertyCodec.registerCodec("TheoPoint",s.DBPropertyCodec.codec((function(e,t,n){var r,o=s.DBProperty.deleted(e);return(r=a.as(t,R.TheoPoint))&&(o=s.DBProperty.arrayProperty(e,[s.DBProperty.doubleProperty(e.append("0"),r.x),s.DBProperty.doubleProperty(e.append("1"),r.y)])),o}),(function(e,t){if(null!=e){var n;if((n=a.opt(e,(function(e){return e.arrayValue})))&&2==n.length){var r=n[0].doubleValue,o=n[1].doubleValue;if(null!=r&&null!=o)return new R.TheoPoint(r,o)}y.LegacyCoreAssert.fail("Expected an array of 2 doubles.",void 0,"Codecs","Codecs.swift",198)}return null}),"TheoPoint"))}},theoRectCodec:{get:function(){return s.DBPropertyCodec.typeCodec("TheoRect")||s.DBPropertyCodec.registerCodec("TheoRect",s.DBPropertyCodec.codec((function(e,t,n){var r,o=s.DBProperty.deleted(e);return(r=a.as(t,I.TheoRect))&&(o=s.DBProperty.arrayProperty(e,[s.DBProperty.doubleProperty(e.append("0"),r.minX),s.DBProperty.doubleProperty(e.append("1"),r.minY),s.DBProperty.doubleProperty(e.append("2"),r.maxX),s.DBProperty.doubleProperty(e.append("3"),r.maxY)])),o}),(function(e,t){if(null!=e){var n,r;if(n=a.opt(e,(function(e){return e.arrayValue}))){if(4==n.length){var o=n[0].doubleValue,i=n[1].doubleValue,s=n[2].doubleValue,l=n[3].doubleValue;if(null!=o&&null!=i&&null!=s&&null!=l)return new I.TheoRect(o,i,s,l)}}else if(null!=(r=a.opt(e,(function(e){return e.stringValue})))){var u=r.split(",");if(4==u.length)return I.TheoRect.fromXXYY(a.toDouble(u[0]),a.toDouble(u[1]),a.toDouble(u[2]),a.toDouble(u[3]))}y.LegacyCoreAssert.fail("Expected a string or an array of 4 doubles.",void 0,"Codecs","Codecs.swift",233)}return null}),"TheoRect"))}},matrix2DCodec:{get:function(){return s.DBPropertyCodec.typeCodec("Matrix2D")||s.DBPropertyCodec.registerCodec("Matrix2D",s.DBPropertyCodec.codec((function(e,t,n){var r,o=s.DBProperty.deleted(e);return(r=a.as(t,_.Matrix2D))&&(o=s.DBProperty.arrayProperty(e,[s.DBProperty.doubleProperty(e.append("0"),r.a),s.DBProperty.doubleProperty(e.append("1"),r.b),s.DBProperty.doubleProperty(e.append("2"),r.c),s.DBProperty.doubleProperty(e.append("3"),r.d),s.DBProperty.doubleProperty(e.append("4"),r.tx),s.DBProperty.doubleProperty(e.append("5"),r.ty)])),o}),(function(e,t){var n;if(n=a.opt(e,(function(e){return e.arrayValue})))if(6==n.length){var r=n[0].doubleValue,o=n[1].doubleValue,i=n[2].doubleValue,s=n[3].doubleValue,l=n[4].doubleValue,u=n[5].doubleValue;if(null!=r&&null!=o&&null!=i&&null!=s&&null!=l&&null!=u)return new _.Matrix2D(r,o,i,s,l,u)}else y.LegacyCoreAssert.fail("Expected an array of 6 numeric elements.",void 0,"Codecs","Codecs.swift",262);return _.Matrix2D.Identity}),"Matrix2D"))}},colorRoleCodec:{get:function(){return s.DBPropertyCodec.typeCodec("ColorRole")||s.DBPropertyCodec.registerCodec("ColorRole",s.DBPropertyCodec.codec((function(e,t,n){var r,o=s.DBProperty.deleted(e);if(null!=(r=a.as(t,i.ColorRole)))switch(r){case 3:o=s.DBProperty.stringProperty(e,"border");break;case 4:o=s.DBProperty.stringProperty(e,"shadow");break;case 1:o=s.DBProperty.stringProperty(e,"field-primary");break;case 2:o=s.DBProperty.stringProperty(e,"field-secondary");break;default:o=s.DBProperty.deleted(e)}return o}),(function(e,t){var n;if(null!=(n=a.opt(e,(function(e){return e.stringValue}))))switch(n){case"border":return i.ColorRole.Border;case"shadow":return i.ColorRole.Shadow;case"field-primary":return i.ColorRole.FieldPrimary;case"field-secondary":return i.ColorRole.FieldSecondary;default:return i.ColorRole.None}return i.ColorRole.None}),"ColorRole"))}},textRangeCodec:{get:function(){return s.DBPropertyCodec.typeCodec("TextRange")||s.DBPropertyCodec.registerCodec("TextRange",s.DBPropertyCodec.codec((function(e,t,n){var r,o=s.DBProperty.deleted(e);return(r=a.as(t,F.TextRange))&&(o=s.DBProperty.arrayProperty(e,[s.DBProperty.intProperty(e.append("0"),r.start),s.DBProperty.intProperty(e.append("1"),r.end)])),o}),(function(e,t){var n;if(null!=e&&(n=a.opt(e,(function(e){return e.arrayValue})))){var r=n[0].intValue,o=n[1].intValue;if(null!=r&&null!=o)return new F.TextRange(r,o);y.LegacyCoreAssert.fail("TextRange decoder: Expected an array of 2 integers",void 0,"Codecs","Codecs.swift",317)}return null}),"TextRange"))}},gridCellCodec:{get:function(){return s.DBPropertyCodec.typeCodec("GridCell")||s.DBPropertyCodec.registerCodec("GridCell",s.DBPropertyCodec.codec((function(e,t,n){var r,o=s.DBProperty.deleted(e);if(r=a.as(t,h.GridCell)){var i,l=[s.DBPropertyCodec.typeCodec("TheoRect").encode(e.append("0"),r.bounds,null),s.DBProperty.doubleProperty(e.append("1"),r.opacity)];null!=(i=r.colorID)&&l.push(s.DBProperty.stringProperty(e.append("2"),i)),o=s.DBProperty.arrayProperty(e,l)}return o}),(function(e,t){var n;if(n=a.opt(e,(function(e){return e.arrayValue}))){var r=s.DBPropertyCodec.typeCodec("TheoRect").decode(n[0],t),o=n[1].doubleValue,i=n.length>2?n[2].stringValue:null;return new h.GridCell(r,i,o)}return null}),"GridCell"))}},fontDescriptorCodec:{get:function(){var e="FontDescriptor";return s.DBPropertyCodec.typeCodec(e)||s.DBPropertyCodec.registerCodec(e,s.DBPropertyCodec.codec((function(t,n,r){var o,i=s.DBProperty.deleted(t);return(o=a.as(n,u.FontDescriptor))&&(i=s.DBProperty.dictEncoded(t,a.dict(["postscript-name",s.DBProperty.stringProperty(t.append("postscript-name"),o.postScriptName)]),e)),i}),(function(e,t){var n,r;if((n=a.opt(e,(function(e){return e.dictionaryValue})))&&null!=(r=a.opt(n["postscript-name"],(function(e){return e.stringValue})))){var o=t.persisted?a.as(t.database.host,S.TheoDocument):f.ANY_DOCUMENT,i=p.Host.fontProvider.descriptorForPostScriptName(r,o);return p.Host.fontProvider.getIncludedFonts(o).contains(i)?i:p.Host.textModelUtils.defaultFont()}return null}),e))}},fontCodec:{get:function(){var e=this;return s.DBPropertyCodec.typeCodec("TheoFont")||s.DBPropertyCodec.registerCodec("TheoFont",s.DBPropertyCodec.codec((function(e,t,n){var r,o=s.DBProperty.deleted(e);if(r=a.as(t,A.TheoFont)){var i=[];if(null!=r.sparkRoles)for(var l=a.iter(a.toSequence(r.sparkRoles));!l.done;l.next()){var u=l.value,c=u.offset,d=u.element;i.push(s.DBProperty.stringProperty(e.append("sparkRoles").append(a.toString(c)),d))}var h=r.sparkElementID,p=a.dict(["postscript-name",s.DBProperty.stringProperty(e.append("postscript-name"),r.fontData.postScriptName)]);0==!i.length&&(p.sparkRoles=s.DBProperty.arrayProperty(e.append("sparkRoles"),i)),null!=h&&(p.sparkElementID=s.DBProperty.stringProperty(e.append("sparkElementID"),h)),o=s.DBProperty.dictEncoded(e,p,"TheoFont")}return o}),(function(t,n){var r,o;if((r=a.opt(t,(function(e){return e.dictionaryValue})))&&null!=(o=a.opt(r["postscript-name"],(function(e){return e.stringValue})))){var i,s=n.persisted?a.as(n.database.host,S.TheoDocument):f.ANY_DOCUMENT,l=p.Host.fontProvider.descriptorForPostScriptName(o,s),c=a.clone(a.opt(a.opt(r.sparkRoles,(function(e){return e.arrayValue})),(function(t){return t.map((function(e){return e.stringValue}),e)}))),d=a.opt(r.sparkElementID,(function(e){return e.stringValue}));return!n.persisted||l.postScriptName==o&&l.availability==u.FontAvailability.LOADED||(i=s)&&i.recordMissingFont(o),A.TheoFont.init_9e5c(l,d,c)}return null}),"TheoFont"))}},mediaMetadataCodec:{get:function(){return s.DBPropertyCodec.typeCodec("MediaMetadata")||s.DBPropertyCodec.registerCodec("MediaMetadata",s.DBPropertyCodec.codec((function(e,t,n){var r,o=s.DBProperty.deleted(e);if(r=a.as(t,T.MediaMetadata)){var i,l,u,c,d,h,p,f,m,g,y,_,C,v,P,S,A,D={};null!=(i=r.searchSource)&&(D.source=s.DBProperty.stringProperty(e.append("source"),i)),null!=(l=r.searchTerm)&&(D.search=s.DBProperty.stringProperty(e.append("search"),l)),null!=(u=r.title)&&(D.photo_name=s.DBProperty.stringProperty(e.append("photo_name"),u)),null!=(c=r.tags)&&(D.tags=s.DBProperty.stringProperty(e.append("tags"),c)),null!=(d=r.licenseType)&&(D.type=s.DBProperty.stringProperty(e.append("type"),d)),null!=(h=r.sourceName)&&(D.source_name=s.DBProperty.stringProperty(e.append("source_name"),h)),null!=(p=r.sourceURL)&&(D.source_url=s.DBProperty.stringProperty(e.append("source_url"),p)),null!=(f=r.ownerName)&&(D.owner=s.DBProperty.stringProperty(e.append("owner"),f)),null!=(m=r.assetID)&&(D.asset_id=s.DBProperty.stringProperty(e.append("asset_id"),m)),null!=(g=r.creatorUserID)&&(D.creator_user_id=s.DBProperty.stringProperty(e.append("creator_user_id"),g)),null!=(y=r.creatorDisplayName)&&(D.creator_display_name=s.DBProperty.stringProperty(e.append("creator_display_name"),y)),null!=(_=r.designIntent)&&(D.design_intent=s.DBProperty.stringProperty(e.append("design_intent"),_)),null!=(C=r.libraryID)&&(D.library_id=s.DBProperty.stringProperty(e.append("library_id"),C)),null!=(v=r.libraryName)&&(D.library_name=s.DBProperty.stringProperty(e.append("library_name"),v)),null!=(P=r.createdDate)&&(D.created_date=s.DBProperty.doubleProperty(e.append("created_date"),P)),null!=(S=r.modifiedDate)&&(D.modified_date=s.DBProperty.doubleProperty(e.append("modified_date"),S)),null!=(A=r.searchProps)&&(D.search_props=s.DBProperty.stringProperty(e.append("search_props"),A)),o=s.DBProperty.dictEncoded(e,D,"MediaMetadata")}return o}),(function(e,t){var n;return(n=a.opt(e,(function(e){return e.dictionaryValue})))?T.MediaMetadata.init_4d41(a.opt(n.source,(function(e){return e.stringValue})),a.opt(n.search,(function(e){return e.stringValue})),a.opt(n.photo_name,(function(e){return e.stringValue})),a.opt(n.tags,(function(e){return e.stringValue})),a.opt(n.type,(function(e){return e.stringValue})),a.opt(n.source_url,(function(e){return e.stringValue})),a.opt(n.source_name,(function(e){return e.stringValue})),a.opt(n.owner,(function(e){return e.stringValue})),a.opt(n.asset_id,(function(e){return e.stringValue})),a.opt(n.creator_user_id,(function(e){return e.stringValue})),a.opt(n.creator_display_name,(function(e){return e.stringValue})),a.opt(n.design_intent,(function(e){return e.stringValue})),a.opt(n.library_id,(function(e){return e.stringValue})),a.opt(n.library_name,(function(e){return e.stringValue})),a.opt(n.created_date,(function(e){return e.doubleValue})),a.opt(n.modified_date,(function(e){return e.doubleValue})),a.opt(n.search_props,(function(e){return e.stringValue}))):null}),"MediaMetadata"))}},imageColorDataCodec:{get:function(){var e="ImageColorData";return s.DBPropertyCodec.typeCodec(e)||s.DBPropertyCodec.registerCodec(e,s.DBPropertyCodec.codec((function(t,n,r){var o,i=s.DBProperty.deleted(t);if(o=a.as(n,g.ImageColorData)){var l={red:s.DBProperty.doubleProperty(t.append("red"),o.rgbColor.red),green:s.DBProperty.doubleProperty(t.append("green"),o.rgbColor.green),blue:s.DBProperty.doubleProperty(t.append("blue"),o.rgbColor.blue),alpha:s.DBProperty.doubleProperty(t.append("alpha"),o.rgbColor.alpha),coverage:s.DBProperty.doubleProperty(t.append("coverage"),o.coverage)};i=s.DBProperty.dictEncoded(t,l,e)}else y.LegacyCoreAssert.fail("Expected TheoColor",{actual:n},"Codecs","Codecs.swift",546);return i}),(function(e,t){if(null!=e){var n,r,o,i,s,l;if((n=a.opt(e,(function(e){return e.dictionaryValue})))&&null!=(r=a.opt(n.red,(function(e){return e.doubleValue})))&&null!=(o=a.opt(n.green,(function(e){return e.doubleValue})))&&null!=(i=a.opt(n.blue,(function(e){return e.doubleValue})))&&null!=(s=a.opt(n.alpha,(function(e){return e.doubleValue})))&&null!=(l=a.opt(n.coverage,(function(e){return e.doubleValue}))))return new g.ImageColorData(new C.SolidColor(r,o,i,s),l);y.LegacyCoreAssert.fail("Expected a color dictionary.",void 0,"Codecs","Codecs.swift",561)}return null}),e))}},pathDictionary:function(e,t){return{type:s.DBProperty.stringProperty(e.append("type"),t.type),fillRule:s.DBProperty.stringProperty(e.append("fillRule"),t.pathFillType),endType:s.DBProperty.stringProperty(e.append("endType"),t.pathEndcapType),joinType:s.DBProperty.stringProperty(e.append("joinType"),t.pathJoinType),strokeWeight:s.DBProperty.doubleProperty(e.append("strokeWeight"),t.pathStrokeWeight),miterLimit:s.DBProperty.doubleProperty(e.append("miterLimit"),t.pathMiterLimit)}},pathProperties:function(e){return{type:a.opt(e.type,(function(e){return e.stringValue})),fill:a.opt(e.fillRule,(function(e){return e.stringValue})),end:a.opt(e.endType,(function(e){return e.stringValue})),join:a.opt(e.joinType,(function(e){return e.stringValue})),stroke:a.opt(e.strokeWeight,(function(e){return e.doubleValue})),miterLimit:a.opt(e.miterLimit,(function(e){return e.doubleValue}))}},pathCodec:{get:function(){return s.DBPropertyCodec.typeCodec("TheoPathTypes")||s.DBPropertyCodec.registerCodec("TheoPathTypes",s.DBPropertyCodec.codec((function(e,t,n){var o=s.DBProperty.deleted(e);return t instanceof E.TheoEmptyPath?o=r.emptyPathCodec.encode(e,t,n):t instanceof E.TheoRectanglePath?o=r.rectanglePathCodec.encode(e,t,n):t instanceof E.TheoEllipsePath?o=r.ellipsePathCodec.encode(e,t,n):t instanceof E.TheoArbitraryPath?o=r.arbitraryPathCodec.encode(e,t,n):y.LegacyCoreAssert.fail("Unknown path type",{type:t},"Codecs","Codecs.swift",602),o}),(function(e,t){if(null!=e){var n;if(n=a.opt(e,(function(e){return e.dictionaryValue}))){y.LegacyCoreAssert.isTrue(a.opt(n.type,(function(e){return null!=e.stringValue})),"Missing path type",void 0,"Codecs","Codecs.swift",609);var o=n.type.stringValue;switch(o){case"empty":return r.emptyPathCodec.decode(e,t);case"rect":return r.rectanglePathCodec.decode(e,t);case"ellipse":return r.ellipsePathCodec.decode(e,t);case"arbitrary":return r.arbitraryPathCodec.decode(e,t);default:y.LegacyCoreAssert.fail("Unknown path type",{type:o},"Codecs","Codecs.swift",621)}return null}y.LegacyCoreAssert.fail("Expected a path dictionary.",void 0,"Codecs","Codecs.swift",625)}return null}),"TheoPathTypes"))}},emptyPathCodec:{get:function(){return s.DBPropertyCodec.typeCodec("TheoEmptyPath")||s.DBPropertyCodec.registerCodec("TheoEmptyPath",s.DBPropertyCodec.codec((function(e,t,n){var o,i=s.DBProperty.deleted(e);return(o=a.as(t,E.TheoEmptyPath))?i=s.DBProperty.dictEncoded(e,r.pathDictionary(e,o),"TheoEmptyPath"):y.LegacyCoreAssert.fail("Expected TheoEmptyPath",{actual:t},"Codecs","Codecs.swift",640),i}),(function(e,t){if(null!=e){var n;if(n=a.opt(e,(function(e){return e.dictionaryValue})))return y.LegacyCoreAssert.isTrue(a.opt(n.type,(function(e){return"empty"==e.stringValue})),"Expected an empty path",void 0,"Codecs","Codecs.swift",647),new E.TheoEmptyPath;y.LegacyCoreAssert.fail("Expected a path dictionary.",void 0,"Codecs","Codecs.swift",650)}return null}),"TheoEmptyPath"))}},rectanglePathCodec:{get:function(){var e,t,n,o,i,l="TheoRectanglePath";return s.DBPropertyCodec.typeCodec(l)||s.DBPropertyCodec.registerCodec(l,s.DBPropertyCodec.codec((function(e,t,n){var o,i=s.DBProperty.deleted(e);if(o=a.as(t,E.TheoRectanglePath)){var u=a.clone(r.pathDictionary(e,o));u.coords=r.theoRectCodec.encode(e.append("coords"),o.rect,n),i=s.DBProperty.dictEncoded(e,u,l)}else y.LegacyCoreAssert.fail("Expected TheoRectanglePath",{actual:t},"Codecs","Codecs.swift",667);return i}),(function(s,l){if(null!=s){var u;if(u=a.opt(s,(function(e){return e.dictionaryValue}))){var c,d=r.pathProperties(u),h=d.type,p=d.fill,f=d.end,m=d.join,g=d.stroke,_=d.miterLimit;return y.LegacyCoreAssert.isTrue("rect"==h,"Expected a rectangle path",void 0,"Codecs","Codecs.swift",675),(c=a.as(r.theoRectCodec.decode(u.coords,l),I.TheoRect))?new E.TheoRectanglePath(c,(e=p)||null!=e?e:E.TheoPath.PATHFILL_DEFAULT,(t=f)||null!=t?t:E.TheoPath.PATHEND_DEFAULT,(n=m)||null!=n?n:E.TheoPath.PATHJOIN_DEFAULT,(o=g)||null!=o?o:E.TheoPath.PATHSTROKE_DEFAULT,(i=_)||null!=i?i:E.TheoPath.PATHMITERLIMIT_DEFAULT):(y.LegacyCoreAssert.fail("Expected a rectangle path dictionary.",void 0,"Codecs","Codecs.swift",679),null)}y.LegacyCoreAssert.fail("Expected a path dictionary.",void 0,"Codecs","Codecs.swift",682)}return null}),l))}},ellipsePathCodec:{get:function(){var e,t,n,o,i,l="TheoEllipsePath";return s.DBPropertyCodec.typeCodec(l)||s.DBPropertyCodec.registerCodec(l,s.DBPropertyCodec.codec((function(e,t,n){var o,i=s.DBProperty.deleted(e);if(o=a.as(t,E.TheoEllipsePath)){var u=a.clone(r.pathDictionary(e,o));u.coords=r.theoRectCodec.encode(e.append("coords"),o.rect,n),i=s.DBProperty.dictEncoded(e,u,l)}else y.LegacyCoreAssert.fail("Expected TheoEllipsePath",{actual:t},"Codecs","Codecs.swift",699);return i}),(function(s,l){if(null!=s){var u;if(u=a.opt(s,(function(e){return e.dictionaryValue}))){var c,d=r.pathProperties(u),h=d.type,p=d.fill,f=d.end,m=d.join,g=d.stroke,_=d.miterLimit;return y.LegacyCoreAssert.isTrue("ellipse"==h,"Expected an ellipse path",void 0,"Codecs","Codecs.swift",707),(c=a.as(r.theoRectCodec.decode(u.coords,l),I.TheoRect))?new E.TheoEllipsePath(c,(e=p)||null!=e?e:E.TheoPath.PATHFILL_DEFAULT,(t=f)||null!=t?t:E.TheoPath.PATHEND_DEFAULT,(n=m)||null!=n?n:E.TheoPath.PATHJOIN_DEFAULT,(o=g)||null!=o?o:E.TheoPath.PATHSTROKE_DEFAULT,(i=_)||null!=i?i:E.TheoPath.PATHMITERLIMIT_DEFAULT):(y.LegacyCoreAssert.fail("Expected an ellipse path dictionary.",void 0,"Codecs","Codecs.swift",711),null)}y.LegacyCoreAssert.fail("Expected a path dictionary.",void 0,"Codecs","Codecs.swift",714)}return null}),l))}},arbitraryPathCodec:{get:function(){var e,t,n,o,i,l="TheoArbitraryPath";return s.DBPropertyCodec.typeCodec(l)||s.DBPropertyCodec.registerCodec(l,s.DBPropertyCodec.codec((function(e,t,n){var o,i=s.DBProperty.deleted(e);if(o=a.as(t,E.TheoArbitraryPath)){var u=a.clone(r.pathDictionary(e,o)),c=a.clone(E.TheoPathBuilder.getEncodedOperations(e.append("ops"),o));u.ops=s.DBProperty.arrayProperty(e.append("ops"),c),i=s.DBProperty.dictEncoded(e,u,l)}else y.LegacyCoreAssert.fail("Expected TheoArbitraryPath",{actual:t},"Codecs","Codecs.swift",732);return i}),(function(s,l){if(null!=s){var u;if(u=a.opt(s,(function(e){return e.dictionaryValue}))){var c=r.pathProperties(u),d=c.type,h=c.fill,p=c.end,f=c.join,m=c.stroke,g=c.miterLimit;y.LegacyCoreAssert.isTrue("arbitrary"==d,"Expected an arbitrary path",void 0,"Codecs","Codecs.swift",740);var _=a.clone(a.opt(u.ops,(function(e){return e.arrayValue})));return null!=_?E.TheoPathBuilder.init_7691(_,(e=h)||null!=e?e:E.TheoPath.PATHFILL_DEFAULT,(t=p)||null!=t?t:E.TheoPath.PATHEND_DEFAULT,(n=f)||null!=n?n:E.TheoPath.PATHJOIN_DEFAULT,(o=m)||null!=o?o:E.TheoPath.PATHSTROKE_DEFAULT,(i=g)||null!=i?i:E.TheoPath.PATHMITERLIMIT_DEFAULT).path:(y.LegacyCoreAssert.fail("Expected an arbitrary path dictionary.",void 0,"Codecs","Codecs.swift",745),null)}y.LegacyCoreAssert.fail("Expected a path dictionary.",void 0,"Codecs","Codecs.swift",748)}return null}),l))}},artworkNodeCodec:{get:function(){var e="TheoArtworkNodeTypes";return s.DBPropertyCodec.typeCodec(e)||s.DBPropertyCodec.registerCodec(e,s.DBPropertyCodec.codec((function(e,t,n){var o=s.DBProperty.deleted(e);return t instanceof v.TheoArtworkShape?o=r.artworkShapeCodec.encode(e,t,n):t instanceof v.TheoArtworkClipGroup?o=r.artworkClipGroupCodec.encode(e,t,n):t instanceof v.TheoArtworkGroup?o=r.artworkGroupCodec.encode(e,t,n):y.LegacyCoreAssert.fail("Unknown artwork type",{actual:t},"Codecs","Codecs.swift",766),o}),(function(e,t){if(null!=e){var n;if(n=a.opt(e,(function(e){return e.dictionaryValue}))){y.LegacyCoreAssert.isTrue(a.opt(n[v.TheoArtworkNode.PROPERTY_TYPE],(function(e){return null!=e.stringValue})),"Missing artwork type",void 0,"Codecs","Codecs.swift",773);var o=n[v.TheoArtworkNode.PROPERTY_TYPE].stringValue;switch(o){case"shape":return r.artworkShapeCodec.decode(e,t);case"group":return r.artworkGroupCodec.decode(e,t);case"clip-group":return r.artworkClipGroupCodec.decode(e,t);default:y.LegacyCoreAssert.fail("Unknown artwork type",{artworkType:o},"Codecs","Codecs.swift",783)}return null}y.LegacyCoreAssert.fail("Expected an artwork dictionary.",void 0,"Codecs","Codecs.swift",787)}return null}),e))}},artworkShapeCodec:{get:function(){var e,t,n,o=this,l="TheoArtworkShape";return s.DBPropertyCodec.typeCodec(l)||s.DBPropertyCodec.registerCodec(l,s.DBPropertyCodec.codec((function(e,t,n){var i,u=s.DBProperty.deleted(e);if(i=a.as(t,v.TheoArtworkShape)){var c=s.DBProperty.stringProperty(e.append(v.TheoArtworkNode.PROPERTY_UID),i.uid),d=s.DBProperty.stringProperty(e.append(v.TheoArtworkNode.PROPERTY_TYPE),i.type),h=r.colorRoleCodec.encode(e.append(v.TheoArtworkNode.PROPERTY_FILLCOLORROLE),i.fillColorRole,n),p=r.colorRoleCodec.encode(e.append(v.TheoArtworkNode.PROPERTY_STROKECOLORROLE),i.strokeColorRole,n),f=null!=i.fillColor?r.solidColorCodec.encode(e.append(v.TheoArtworkNode.PROPERTY_FILLCOLOR),i.fillColor,n):null,m=null!=i.strokeColor?r.solidColorCodec.encode(e.append(v.TheoArtworkNode.PROPERTY_STROKECOLOR),i.strokeColor,n):null,g=s.DBProperty.doubleProperty(e.append(v.TheoArtworkNode.PROPERTY_STROKEWIDTH),i.strokeWidth),_=null!=i.overrideBounds?r.theoRectCodec.encode(e.append(v.TheoArtworkNode.PROPERTY_OVERRIDE_BOUNDS),i.overrideBounds,n):null,T=a.toSequence(i.paths).map((function(t){return r.pathCodec.encode(e.append(v.TheoArtworkNode.PROPERTY_PATHS).append(a.toString(t.offset)),t.element,n)}),o),C={"immutable-id":c,type:d,paths:s.DBProperty.arrayProperty(e.append(v.TheoArtworkNode.PROPERTY_PATHS),T),"fill-color-role":h,"stroke-color-role":p,"stroke-width":g};null!=f&&(C[v.TheoArtworkNode.PROPERTY_FILLCOLOR]=f),null!=m&&(C[v.TheoArtworkNode.PROPERTY_STROKECOLOR]=m),null!=_&&(C[v.TheoArtworkNode.PROPERTY_OVERRIDE_BOUNDS]=_),u=s.DBProperty.dictEncoded(e,C,l)}else y.LegacyCoreAssert.fail("Expected TheoArtworkShape",{actual:t},"Codecs","Codecs.swift",823);return u}),(function(s,l){if(null!=s){var u;if(u=a.opt(s,(function(e){return e.dictionaryValue}))){y.LegacyCoreAssert.isTrue(a.opt(u[v.TheoArtworkNode.PROPERTY_TYPE],(function(e){return"shape"==e.stringValue})),"Expected a shape node",void 0,"Codecs","Codecs.swift",830);var c=a.opt(u[v.TheoArtworkNode.PROPERTY_UID],(function(e){return e.stringValue})),d=a.as(r.solidColorCodec.decode(u[v.TheoArtworkNode.PROPERTY_FILLCOLOR],l),C.SolidColor),h=(e=a.as(r.colorRoleCodec.decode(u[v.TheoArtworkNode.PROPERTY_FILLCOLORROLE],l),i.ColorRole))||null!=e?e:i.ColorRole.None,p=a.as(r.solidColorCodec.decode(u[v.TheoArtworkNode.PROPERTY_STROKECOLOR],l),C.SolidColor),f=(t=a.as(r.colorRoleCodec.decode(u[v.TheoArtworkNode.PROPERTY_STROKECOLORROLE],l),i.ColorRole))||null!=t?t:i.ColorRole.None,m=(n=a.opt(u[v.TheoArtworkNode.PROPERTY_STROKEWIDTH],(function(e){return e.doubleValue})))||null!=n?n:0,g=a.as(r.theoRectCodec.decode(u[v.TheoArtworkNode.PROPERTY_OVERRIDE_BOUNDS],l),I.TheoRect),_=a.as(r.pathCodec.decode(u[v.TheoArtworkNode.PROPERTY_PATH],l),E.TheoPath),T=a.clone(null!=_?[_]:u[v.TheoArtworkNode.PROPERTY_PATHS].arrayValue.map((function(e){return r.pathCodec.decode(e,l)}),o));return v.TheoArtworkShape.init_d1d0(c,T,h,f,d,p,m,g)}y.LegacyCoreAssert.fail("Expected an artwork dictionary.",void 0,"Codecs","Codecs.swift",842)}return null}),l))}},artworkGroupCodec:{get:function(){var e=this,t="TheoArtworkGroup";return s.DBPropertyCodec.typeCodec(t)||s.DBPropertyCodec.registerCodec(t,s.DBPropertyCodec.codec((function(n,o,i){var l,u=s.DBProperty.deleted(n);if(l=a.as(o,v.TheoArtworkGroup)){var c=s.DBProperty.stringProperty(n.append(v.TheoArtworkNode.PROPERTY_UID),l.uid),d=s.DBProperty.stringProperty(n.append(v.TheoArtworkNode.PROPERTY_TYPE),l.type),h=a.toSequence(l.children).map((function(e){return r.artworkNodeCodec.encode(n.append(v.TheoArtworkNode.PROPERTY_CHILD_NODES).append(a.toString(e.offset)),e.element,i)}),e),p={"immutable-id":c,type:d,nodes:s.DBProperty.arrayProperty(n.append(v.TheoArtworkNode.PROPERTY_CHILD_NODES),h)};u=s.DBProperty.dictEncoded(n,p,t)}else y.LegacyCoreAssert.fail("Expected TheoArtworkGroup",{actual:o},"Codecs","Codecs.swift",861);return u}),(function(t,n){if(null!=t){var o;if(o=a.opt(t,(function(e){return e.dictionaryValue}))){y.LegacyCoreAssert.isTrue(a.opt(o[v.TheoArtworkNode.PROPERTY_TYPE],(function(e){return"group"==e.stringValue})),"Expected a group node",void 0,"Codecs","Codecs.swift",868);var i=a.opt(o[v.TheoArtworkNode.PROPERTY_UID],(function(e){return e.stringValue})),s=a.clone(a.opt(o[v.TheoArtworkNode.PROPERTY_CHILD_NODES],(function(e){return e.arrayValue}))||o[v.TheoArtworkNode.PROPERTY_NODES].arrayValue).map((function(e){return r.artworkNodeCodec.decode(e,n)}),e);return new v.TheoArtworkGroup(i,s)}y.LegacyCoreAssert.fail("Expected an artwork dictionary.",void 0,"Codecs","Codecs.swift",874)}return null}),t))}},artworkClipGroupCodec:{get:function(){var e=this,t="TheoArtworkClipGroup";return s.DBPropertyCodec.typeCodec(t)||s.DBPropertyCodec.registerCodec(t,s.DBPropertyCodec.codec((function(n,o,i){var l,u=s.DBProperty.deleted(n);if(l=a.as(o,v.TheoArtworkClipGroup)){var c=s.DBProperty.stringProperty(n.append(v.TheoArtworkNode.PROPERTY_UID),l.uid),d=s.DBProperty.stringProperty(n.append(v.TheoArtworkNode.PROPERTY_TYPE),l.type),h=r.pathCodec.encode(n.append(v.TheoArtworkNode.PROPERTY_PATH),l.path,i),p=a.toSequence(l.children).map((function(e){return r.artworkNodeCodec.encode(n.append(v.TheoArtworkNode.PROPERTY_CHILD_NODES).append(a.toString(e.offset)),e.element,i)}),e),f={"immutable-id":c,type:d,path:h,nodes:s.DBProperty.arrayProperty(n.append(v.TheoArtworkNode.PROPERTY_CHILD_NODES),p)};u=s.DBProperty.dictEncoded(n,f,t)}else y.LegacyCoreAssert.fail("Expected TheoArtworkClipGroup",{actual:o},"Codecs","Codecs.swift",893);return u}),(function(t,n){if(null!=t){var o;if(o=a.opt(t,(function(e){return e.dictionaryValue}))){y.LegacyCoreAssert.isTrue(a.opt(o[v.TheoArtworkNode.PROPERTY_TYPE],(function(e){return"clip-group"==e.stringValue})),"Expected a clip group node",void 0,"Codecs","Codecs.swift",900);var i=a.opt(o[v.TheoArtworkNode.PROPERTY_UID],(function(e){return e.stringValue})),s=r.pathCodec.decode(o[v.TheoArtworkNode.PROPERTY_PATH],n),l=a.clone(a.opt(o[v.TheoArtworkNode.PROPERTY_CHILD_NODES],(function(e){return e.arrayValue}))||o[v.TheoArtworkNode.PROPERTY_NODES].arrayValue).map((function(e){return r.artworkNodeCodec.decode(e,n)}),e);return new v.TheoArtworkClipGroup(i,l,s)}y.LegacyCoreAssert.fail("Expected an artwork dictionary.",void 0,"Codecs","Codecs.swift",907)}return null}),t))}},pageExportDataCodec:{get:function(){var e,t="FormaPageExportData";return s.DBPropertyCodec.typeCodec(t)||s.DBPropertyCodec.registerCodec(t,s.DBPropertyCodec.codec((function(e,n,o){var i,l=s.DBProperty.deleted(e);if(i=a.as(n,c.FormaPageExportData)){var u={dimensions:r.theoSizeCodec.encode(e.append(c.FormaPageExportData.PROPERTY_DIMENSIONS),i.dimensions,o),format:s.DBProperty.intProperty(e.append(c.FormaPageExportData.PROPERTY_FORMAT),i.format)};null!=i.ppi&&(u[c.FormaPageExportData.PROPERTY_PPI]=s.DBProperty.doubleProperty(e.append(c.FormaPageExportData.PROPERTY_PPI),i.ppi)),l=s.DBProperty.dictEncoded(e,u,t)}else y.LegacyCoreAssert.fail("Expected FormaPageExportData",{actual:n},"Codecs","Codecs.swift",928);return l}),(function(t,n){if(null!=t){var o;if(o=a.opt(t,(function(e){return e.dictionaryValue}))){var i=r.theoSizeCodec.decode(o[c.FormaPageExportData.PROPERTY_DIMENSIONS],n),s=o[c.FormaPageExportData.PROPERTY_FORMAT].intValue,l=a.opt(o[c.FormaPageExportData.PROPERTY_PPI],(function(e){return e.doubleValue}));return new c.FormaPageExportData(i,(e=c.PageExportFormat.toCaseValue(s))||null!=e?e:c.PageExportFormat.PIXELS,l)}y.LegacyCoreAssert.fail("Expected an artwork dictionary.",void 0,"Codecs","Codecs.swift",940)}return null}),t))}},keyFrameCodec:{get:function(){var e,t;return s.DBPropertyCodec.typeCodec("KeyFrame")||s.DBPropertyCodec.registerCodec("KeyFrame",s.DBPropertyCodec.codec((function(e,t,n){var o,i=s.DBProperty.deleted(e);if(o=a.as(t,l.KeyFrame)){var u,c,h=a.dict(["start-time",r.theoTimeCodec.encode(e.append("start-time"),o.time,n),"timing-function",s.DBProperty.stringProperty(e.append("timing-function"),o.timingFunction),"placement",r.matrix2DCodec.encode(e.append("placement"),o.placement,n)]);(u=o.bounds)&&(h.bounds=r.theoRectCodec.encode(e.append("bounds"),u,n)),(c=o.style)&&(h.style=d.FormaStyle.codec.encode(e.append("style"),c,n)),i=s.DBProperty.dictEncoded(e,h,"KeyFrame")}else(h=a.as(t,["Dictionary","String",s.DBProperty]))?i=s.DBProperty.dictEncoded(e,h,"KeyFrame"):y.LegacyCoreAssert.fail("Expected KeyFrame",{actual:t},"Codecs","Codecs.swift",972);return i}),(function(n,o){if(null!=n){var i;if(i=a.opt(n,(function(e){return e.dictionaryValue}))){for(var s=a.iter(i);!s.done;s.next()){var u=s.key;s.value.reroot(n.namePath.append(u))}var c,h=r.theoTimeCodec.decode(i["start-time"],o),p=(e=k.TimingFunctionType.toCaseValue((t=a.opt(i["timing-function"],(function(e){return e.stringValue})))||null!=t?t:""))||null!=e?e:k.TimingFunctionType.EaseInOut,f=r.matrix2DCodec.decode(i.placement,o),m=a.as(d.FormaStyle.codec.decode(i.style,o),d.FormaStyle),g=null;return(c=i.bounds)&&(g=a.as(r.theoRectCodec.decode(c,o),I.TheoRect)),new l.KeyFrame(h,p,f,g,m)}y.LegacyCoreAssert.fail("Expected a KeyFrame dictionary.",void 0,"Codecs","Codecs.swift",993)}return null}),"KeyFrame"))}},imageAdjustmentsCodec:{get:function(){var e,t,n,r,o,i,l,u,c,d,h,p,f="ImageAdjustments";return s.DBPropertyCodec.typeCodec(f)||s.DBPropertyCodec.registerCodec(f,s.DBPropertyCodec.codec((function(e,t,n){var r,o=s.DBProperty.deleted(e);if(r=a.as(t,m.ImageAdjustments)){var i=a.dict(["blur",s.DBProperty.doubleProperty(e.append("blur"),r.blur),"sharpness",s.DBProperty.doubleProperty(e.append("sharpness"),r.sharpness),"shadows",s.DBProperty.doubleProperty(e.append("shadows"),r.shadows),"highlights",s.DBProperty.doubleProperty(e.append("highlights"),r.highlights),"saturation",s.DBProperty.doubleProperty(e.append("saturation"),r.saturation),"brightness",s.DBProperty.doubleProperty(e.append("brightness"),r.brightness),"exposure",s.DBProperty.doubleProperty(e.append("exposure"),r.exposure),"contrast",s.DBProperty.doubleProperty(e.append("contrast"),r.contrast),"warmth",s.DBProperty.doubleProperty(e.append("warmth"),r.warmth),"tint",s.DBProperty.doubleProperty(e.append("tint"),r.tint),"fade",s.DBProperty.doubleProperty(e.append("fade"),r.fade),"vibrance",s.DBProperty.doubleProperty(e.append("vibrance"),r.vibrance)]);o=s.DBProperty.dictEncoded(e,i,f)}else y.LegacyCoreAssert.fail("Expected ImageAdjustments",{actual:t},"Codecs","Codecs.swift",1033);return o}),(function(s,f){if(null!=s){var g;if(g=a.opt(s,(function(e){return e.dictionaryValue})))return new m.ImageAdjustments((e=a.opt(g.blur,(function(e){return e.doubleValue})))||null!=e?e:0,(t=a.opt(g.sharpness,(function(e){return e.doubleValue})))||null!=t?t:0,(n=a.opt(g.shadows,(function(e){return e.doubleValue})))||null!=n?n:0,(r=a.opt(g.highlights,(function(e){return e.doubleValue})))||null!=r?r:0,(o=a.opt(g.saturation,(function(e){return e.doubleValue})))||null!=o?o:0,(i=a.opt(g.brightness,(function(e){return e.doubleValue})))||null!=i?i:0,(l=a.opt(g.exposure,(function(e){return e.doubleValue})))||null!=l?l:0,(u=a.opt(g.contrast,(function(e){return e.doubleValue})))||null!=u?u:0,(c=a.opt(g.warmth,(function(e){return e.doubleValue})))||null!=c?c:0,(d=a.opt(g.tint,(function(e){return e.doubleValue})))||null!=d?d:0,(h=a.opt(g.fade,(function(e){return e.doubleValue})))||null!=h?h:0,(p=a.opt(g.vibrance,(function(e){return e.doubleValue})))||null!=p?p:0);y.LegacyCoreAssert.fail("Expected a ImageAdjustments dictionary.",void 0,"Codecs","Codecs.swift",1053)}return null}),f))}},textPathSegmentCodec:{get:function(){var e="TextPathSegment";return s.DBPropertyCodec.typeCodec(e)||s.DBPropertyCodec.registerCodec(e,s.DBPropertyCodec.codec((function(t,n,o){var i,l=s.DBProperty.deleted(t);if(i=a.as(n,D.TextPathSegment)){var u={p0:r.theoPointCodec.encode(t.append(D.TextPathSegment.PROPERTY_P0),i.p0,o),p1:r.theoPointCodec.encode(t.append(D.TextPathSegment.PROPERTY_P1),i.p1,o),p2:r.theoPointCodec.encode(t.append(D.TextPathSegment.PROPERTY_P2),i.p2,o),p3:r.theoPointCodec.encode(t.append(D.TextPathSegment.PROPERTY_P3),i.p3,o)};l=s.DBProperty.dictEncoded(t,u,e)}else y.LegacyCoreAssert.fail("Expected TextPathSegment",{actual:n},"Codecs","Codecs.swift",1077);return l}),(function(e,t){if(null!=e){var n;if(n=a.opt(e,(function(e){return e.dictionaryValue}))){var o=r.theoPointCodec.decode(n[D.TextPathSegment.PROPERTY_P0],t),i=r.theoPointCodec.decode(n[D.TextPathSegment.PROPERTY_P1],t),s=r.theoPointCodec.decode(n[D.TextPathSegment.PROPERTY_P2],t),l=r.theoPointCodec.decode(n[D.TextPathSegment.PROPERTY_P3],t);return new D.TextPathSegment(o,i,s,l)}y.LegacyCoreAssert.fail("Expected path segment dictionary.",void 0,"Codecs","Codecs.swift",1090)}return null}),e))}},textPathCodec:{get:function(){var e=this;return s.DBPropertyCodec.typeCodec("TextPath")||s.DBPropertyCodec.registerCodec("TextPath",s.DBPropertyCodec.codec((function(t,n,o){var i,l=s.DBProperty.deleted(t);if(i=a.as(n,D.TextPath)){var u=s.DBProperty.doubleProperty(t.append(D.TextPath.PROPERTY_FLEX),i.flex),c=a.toSequence(i.segments).map((function(e){return r.textPathSegmentCodec.encode(t.append(D.TextPath.PROPERTY_SEGMENTS).append(a.toString(e.offset)),e.element,o)}),e),d={flex:u,segment:s.DBProperty.arrayProperty(t.append(D.TextPath.PROPERTY_SEGMENTS),c)};l=s.DBProperty.dictEncoded(t,d,"TextPath")}else y.LegacyCoreAssert.fail("Expected TextPath",{actual:n},"Codecs","Codecs.swift",1109);return l}),(function(t,n){if(null!=t){var o;if(o=a.opt(t,(function(e){return e.dictionaryValue}))){var i=o[D.TextPath.PROPERTY_FLEX].doubleValue,s=a.clone(o[D.TextPath.PROPERTY_SEGMENTS].arrayValue).map((function(e){return r.textPathSegmentCodec.decode(e,n)}),e);return new D.TextPath(s,i)}y.LegacyCoreAssert.fail("Expected text path dictionary.",void 0,"Codecs","Codecs.swift",1122)}return null}),"TextPath"))}}}}),r)},rxGp:function(e,t,n){var r,o,a=t,i=n("oAGj"),s=n("gXiO");a.LogCategories=(r=function(){s.CoreObject.call(this)},o={},i.defineClass({name:"LogCategories",ctor:r,superName:"CoreObject",statics:{kLaunch:"Launch",kOSInfo:"OSInfo",kUnimplemented:"Unimplemented!",kDocList:"DocList",kDocListMemory:"DocListMemory",kTheoMessage:"TheoMessage",kTransaction:"Transaction",kUndoMgr:"UndoManager",kSaveMgr:"SaveManager",kDrag:"Drag",kTheoDocument:"TheoDocument",kDocPersistenceFactory:"DocPersistenceFactory",kEncode:"Encode",kDecode:"Decode",kMultibrand:"MultiBrand",kFont:"Font",kCollaboration:"Collaboration",kImage:"Image",kDocMetadata:"DocMetadata",kStockImage:"StockImage",kOrganizer:"Organizer",kDesignView:"DesignView",kDesignViewToken:"DesignViewToken",kCoachmark:"Coachmark",kAlert:"Alert",kAnalytics:"Analytics",kIconUsage:"IconUsage",kInApp:"InApp",kNewRelicAttributes:"NewRelicAttributes",kNewRelic:"NewRelic",kCCLibraries:"CCLibraries",categories:{get:function(){return void 0===o.categories&&(o.categories=i.dict([r.kLaunch,{enabled:!0,timed:!0},r.kOSInfo,{enabled:!1,timed:!1},r.kUnimplemented,{enabled:!0,timed:!1},r.kDocList,{enabled:!1,timed:!1},r.kDocListMemory,{enabled:!1,timed:!1},r.kTheoMessage,{enabled:!1,timed:!1},r.kTransaction,{enabled:!1,timed:!1},r.kUndoMgr,{enabled:!1,timed:!1},r.kSaveMgr,{enabled:!1,timed:!1},r.kDrag,{enabled:!1,timed:!1},r.kTheoDocument,{enabled:!1,timed:!1},r.kDocPersistenceFactory,{enabled:!1,timed:!1},r.kEncode,{enabled:!1,timed:!1},r.kDecode,{enabled:!1,timed:!1},r.kMultibrand,{enabled:!1,timed:!1},r.kFont,{enabled:!1,timed:!1},r.kCollaboration,{enabled:!1,timed:!1},r.kImage,{enabled:!1,timed:!1},r.kDocMetadata,{enabled:!1,timed:!1},r.kStockImage,{enabled:!1,timed:!1},r.kOrganizer,{enabled:!1,timed:!0},r.kDesignView,{enabled:!1,timed:!0},r.kDesignViewToken,{enabled:!1,timed:!1},r.kCoachmark,{enabled:!1,timed:!1},r.kAlert,{enabled:!1,timed:!1},r.kAnalytics,{enabled:!1,timed:!1},r.kIconUsage,{enabled:!1,timed:!1},r.kInApp,{enabled:!1,timed:!1},r.kNewRelicAttributes,{enabled:!1,timed:!1},r.kNewRelic,{enabled:!1,timed:!1},r.kCCLibraries,{enabled:!1,timed:!1}])),o.categories},set:function(e){o.categories=e}}}}),r)},"s/Zj":function(e,t,n){var r,o=t,a=n("oAGj"),i=n("gXiO");o.MoaTransform=(r=function(){this.transformMatrix_=[],this.identityTransform=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},a.defineClass({name:"MoaTransform",ctor:r,superName:"CoreObject",props:{init_d41d:function(){i.CoreObject.call(this),this.copy(this.identityTransform)},init_8c4b:function(e){i.CoreObject.call(this),this.copy(e)},transformMatrix:{get:function(){return this.transformMatrix_}},setIdentity:function(){this.transformMatrix_=a.clone(this.identityTransform)},copy:function(e){this.transformMatrix_=a.clone(e)},preRotateX:function(e){var t=r.init_8c4b([1,0,0,0,0,Math.cos(e),-Math.sin(e),0,0,Math.sin(e),Math.cos(e),0,0,0,0,1]);this.preTransform(t)},preTransform:function(e){var t=r.init_d41d();t.copy(this.transformMatrix),this.matrixMultiply(e,t)},matrixMultiply:function(e,t){var n=a.clone(e.transformMatrix),r=a.clone(t.transformMatrix);this.transformMatrix_[0]=n[0]*r[0]+n[1]*r[4]+n[2]*r[8]+n[3]*r[12],this.transformMatrix_[1]=n[0]*r[1]+n[1]*r[5]+n[2]*r[9]+n[3]*r[13],this.transformMatrix_[2]=n[0]*r[2]+n[1]*r[6]+n[2]*r[10]+n[3]*r[14],this.transformMatrix_[3]=n[0]*r[3]+n[1]*r[7]+n[2]*r[11]+n[3]*r[15],this.transformMatrix_[4]=n[4]*r[0]+n[5]*r[4]+n[6]*r[8]+n[7]*r[12],this.transformMatrix_[5]=n[4]*r[1]+n[5]*r[5]+n[6]*r[9]+n[7]*r[13],this.transformMatrix_[6]=n[4]*r[2]+n[5]*r[6]+n[6]*r[10]+n[7]*r[14],this.transformMatrix_[7]=n[4]*r[3]+n[5]*r[7]+n[6]*r[11]+n[7]*r[15],this.transformMatrix_[8]=n[8]*r[0]+n[9]*r[4]+n[10]*r[8]+n[11]*r[12],this.transformMatrix_[9]=n[8]*r[1]+n[9]*r[5]+n[10]*r[9]+n[11]*r[13],this.transformMatrix_[10]=n[8]*r[2]+n[9]*r[6]+n[10]*r[10]+n[11]*r[14],this.transformMatrix_[11]=n[8]*r[3]+n[9]*r[7]+n[10]*r[11]+n[11]*r[15],this.transformMatrix_[12]=n[12]*r[0]+n[13]*r[4]+n[14]*r[8]+n[15]*r[12],this.transformMatrix_[13]=n[12]*r[1]+n[13]*r[5]+n[14]*r[9]+n[15]*r[13],this.transformMatrix_[14]=n[12]*r[2]+n[13]*r[6]+n[14]*r[10]+n[15]*r[14],this.transformMatrix_[15]=n[12]*r[3]+n[13]*r[7]+n[14]*r[11]+n[15]*r[15]},preRotateY:function(e){var t=r.init_8c4b([Math.cos(e),0,Math.sin(e),0,0,1,0,0,-Math.sin(e),0,Math.cos(e),0,0,0,0,1]);this.preTransform(t)},preScaleXY:function(e,t){var n=r.init_8c4b([e,0,0,0,0,t,0,0,0,0,1,0,0,0,0,1]);this.preTransform(n)}}}),r)},s3ad:function(e,t,n){var r,o,a=t,i=n("oAGj"),s=n("7Pku"),l=n("w/+j"),u=n("iCxV"),c=n("fNpk"),d=n("Ird5"),h=n("jfma"),p=n("bauG"),f=n("jSYS"),m=n("KB91"),g=n("wH/i"),y=n("yjxF"),_=n("Aj79"),T=n("sJQG"),C=n("s3Tu"),v=n("zjod"),P=n("mxdD");a.VideoFormaToPGMMapper=(r=function e(){s.FormaToPGMMapper.call(this,e.FORMA_KIND)},o={},i.defineClass({name:"VideoFormaToPGMMapper",ctor:r,superName:"FormaToPGMMapper",statics:{FORMA_KIND:{get:function(){return void 0===o.FORMA_KIND&&(o.FORMA_KIND=v.VideoForma.KIND),o.FORMA_KIND}},instance:{get:function(){return void 0===o.instance&&(o.instance=new r),o.instance}},createMapper:function(e){return r.instance}},props:{makePGMRef:function(e,t,n,r){var o,a,s,S;if((s=i.as(e,v.VideoForma))&&(S=s.bounds)){var A,D,E="unknown";if((A=s.videoContentNode)&&(E=A.isGIF?"gif":"video"),((o=i.opt(u.Host.videoUtils,(function(e){return e.hostSupportsPGMVideos()})))||null!=o)&&o){var R;if(null!=(R=s.videoContentID)){var F,I=P.VideoFacade.getDurationForVideo(s),b=P.VideoFacade.getStartTimeForVideoForma(s,!(!(a=i.opt(s.videoContentNode,(function(e){return e.isForLocalVideo})))&&null==a)&&a),O=b.seconds,k=b;if(s.mode==v.VideoMode.trim&&(k=s.currentTime),I.seconds>0){var M=new f.PGMLinearFunction(new T.PGMRange(0,I.seconds),T.PGMRange.UNIT),N=new m.PGMLoopingFunction(new T.PGMRange(0,I.seconds),M);F=new d.PGMAnimationList([new g.PGMMediaPlayAnimation(N)])}else F=d.PGMAnimationList.EMPTY;return l.FormaToPGMUtils.applyAnimations(t,e,new _.PGMReference(new C.PGMVideo(s.formaID,new y.PGMNodeMetadata(s.formaID,E),F,S,R,O,k.seconds),new h.PGMCompositingParams(s.placement,s.style.opacity)))}return c.LegacyCoreAssert.fail("videoForma has a nil videoContentID",void 0,"VideoFormaToPGMMapper.makePGMRef","VideoFormaToPGMMapper.swift",86),null}return E="poster",null!=(D=s.contentID)?l.FormaToPGMUtils.applyAnimations(t,e,new _.PGMReference(new p.PGMImage(s.formaID+"-"+E,new y.PGMNodeMetadata(s.formaID,E),d.PGMAnimationList.EMPTY,S,D),new h.PGMCompositingParams(s.placement,s.style.opacity))):(c.LegacyCoreAssert.fail("videoForma has a nil contentID",void 0,"VideoFormaToPGMMapper.makePGMRef","VideoFormaToPGMMapper.swift",110),null)}return c.LegacyCoreAssert.fail("not a video forma, or no bounds",void 0,"VideoFormaToPGMMapper.makePGMRef","VideoFormaToPGMMapper.swift",115),null}}}),r)},sW6f:function(e,t,n){var r,o=t,a=n("oAGj"),i=n("CWW7"),s=n("A6KL"),l=n("fNpk"),u=n("RkYL"),c=n("qSCS");o.VideoContentNode=(r=function(){this._isForLocalVideo=!1},a.defineClass({name:"VideoContentNode",ctor:r,superName:"URLBasedContentNode",statics:{KIND:{get:function(){return"video"}},SCHEMA_CLASS_NAME:{get:function(){return"VideoContentNode"}},factory:{get:function(){return function(e,t,n,o){var i=a.as(a.opt(a.opt(o,(function(e){return e.backLink})),(function(e){return e.dereference()})),s.GroupContentNode);return l.LegacyCoreAssert.isTrue(null!=i,"Content nodes need a parent",void 0,"VideoContentNode","VideoContentNode.swift",18),r.init_3144(e,t,n,i)}}},LIVE_PHOTO_TAG:"LivePhoto",PROPERTY_WIDTH:"width",PROPERTY_HEIGHT:"height",PROPERTY_DURATION:"duration",PROPERTY_TIME_SAMPLES:"time-samples",PROPERTY_CHILDREN:"children",PROPERTY_ORIGINAL_DURATION:"original-duration",PROPERTY_OFFSET_IN_ORIGINAL:"offset-in-original",_implements:function(e){return"IDBObject"==e||"TheoMessagePublisher"==e}},props:{init_3144:function(e,t,n,r){a.super_init(this,c.URLBasedContentNode,c.URLBasedContentNode.prototype.init_3144,e,t,n,r)},init_26a9:function(e,t){a.super_init(this,c.URLBasedContentNode,c.URLBasedContentNode.prototype.init_c3fa,e,"video",t),this.set(r.PROPERTY_WIDTH,0),this.set(r.PROPERTY_HEIGHT,0),this.set(r.PROPERTY_DURATION,u.TheoTime.Zero),this.set(r.PROPERTY_TIME_SAMPLES,[])},init_5972:function(e,t){a.super_init(this,c.URLBasedContentNode,c.URLBasedContentNode.prototype.init_8b5c,e,"video",t),this.set(r.PROPERTY_WIDTH,0),this.set(r.PROPERTY_HEIGHT,0),this.set(r.PROPERTY_DURATION,u.TheoTime.Zero),this.set(r.PROPERTY_TIME_SAMPLES,[])},className:{get:function(){return r.SCHEMA_CLASS_NAME}},width:{get:function(){return this.get(r.PROPERTY_WIDTH)},set:function(e){this.set(r.PROPERTY_WIDTH,e)}},height:{get:function(){return this.get(r.PROPERTY_HEIGHT)},set:function(e){this.set(r.PROPERTY_HEIGHT,e)}},duration:{get:function(){return this.get(r.PROPERTY_DURATION)},set:function(e){this.set(r.PROPERTY_DURATION,e)}},originalDuration:{get:function(){var e;return(e=a.as(this.get(r.PROPERTY_ORIGINAL_DURATION),u.TheoTime))||null!=e?e:this.duration},set:function(e){this.set(r.PROPERTY_ORIGINAL_DURATION,e)}},offsetInOriginal:{get:function(){var e;return(e=this._transientOffsetInOriginal)?e:a.as(this.get(r.PROPERTY_OFFSET_IN_ORIGINAL),u.TheoTime)},set:function(e){l.LegacyCoreAssert.isTrue(null==this._transientOffsetInOriginal,"Can't set offsetInOriginal while have transient value",void 0,"VideoContentNode","VideoContentNode.swift",89),this.set(r.PROPERTY_OFFSET_IN_ORIGINAL,e)}},setTransientOffset:function(e){this._transientOffsetInOriginal=e},resetTransientOffset:function(){this._transientOffsetInOriginal=null},wasTrimmed:{get:function(){var e;return!!(e=a.as(this.get(r.PROPERTY_ORIGINAL_DURATION),u.TheoTime))&&!e.secondsEqual(this.duration)}},times:{get:function(){var e;return(e=a.as(this.get(r.PROPERTY_TIME_SAMPLES),["Array",u.TheoTime]))||null!=e?e:[]}},isGIF:{get:function(){var e;return null!=(e=this.mimeType)&&e.includes("gif")}},setTimes:function(e){this.set(r.PROPERTY_TIME_SAMPLES,e)},concatTimes:function(e){this.set(r.PROPERTY_TIME_SAMPLES,this.times.concat(e))},addTime:function(e){this.set(r.PROPERTY_TIME_SAMPLES,this.times.concat([e]))},timesAsNSArray:{get:function(){for(var e=[],t=a.iter(this.times);!t.done;t.next()){var n=t.value;e.push(n)}return e.concat()}},isForLocalVideo:{get:function(){return this._isForLocalVideo},set:function(e){this._isForLocalVideo=e}},copyTo:function(e){var t;return(t=a.as(e.content.createNode(r.KIND,null),r))?(i.CreationFacade.addContentNodeToDocument(t,e),t.match(this),t):null}}}),r)},tQF8:function(e,t,n){var r,o=t,a=n("oAGj"),i=n("gXiO"),s=n("fNpk"),l=n("3DEm"),u=n("oKlP"),c=n("sIWg");o.GridCellHandle=a.defineEnum("GridCellHandle",{Left:0,Right:1,Top:2,Bottom:3,TopLeft:4,TopRight:5,BottomLeft:6,BottomRight:7}),o.GridCell=(r=function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=1),this.region_=e,this.colorID_=t,this.opacity_=n,i.CoreObject.call(this)},a.defineClass({name:"GridCell",ctor:r,superName:"CoreObject",statics:{BOUNDS_ACCURACY:.001,positionForHandle:function(e){return e==o.GridCellHandle.Top?new u.TheoPoint(.5,0):e==o.GridCellHandle.Bottom?new u.TheoPoint(.5,1):e==o.GridCellHandle.Left?new u.TheoPoint(0,.5):e==o.GridCellHandle.Right?new u.TheoPoint(1,.5):e==o.GridCellHandle.TopLeft?new u.TheoPoint(0,0):e==o.GridCellHandle.TopRight?new u.TheoPoint(1,0):e==o.GridCellHandle.BottomLeft?new u.TheoPoint(0,1):e==o.GridCellHandle.BottomRight?new u.TheoPoint(1,1):(s.LegacyCoreAssert.fail("Incorrect handle type",void 0,"GridCell.positionForHandle","GridCell.swift",170),new u.TheoPoint(.5,.5))},handlePositions:function(){return[r.positionForHandle(o.GridCellHandle.Top),r.positionForHandle(o.GridCellHandle.Bottom),r.positionForHandle(o.GridCellHandle.Left),r.positionForHandle(o.GridCellHandle.Right)]},handles:function(){return[o.GridCellHandle.Top,o.GridCellHandle.Bottom,o.GridCellHandle.Left,o.GridCellHandle.Right]},cornerHandles:function(){return[o.GridCellHandle.TopLeft,o.GridCellHandle.TopRight,o.GridCellHandle.BottomLeft,o.GridCellHandle.BottomRight]},handleForPosition:function(e){for(var t=a.iter(r.handles());!t.done;t.next()){var n=t.value;if(e.distanceTo(r.positionForHandle(n))<.001)return n}return s.LegacyCoreAssert.fail("Incorrect handle position",void 0,"GridCell.handleForPosition","GridCell.swift",202),null},fromArray:function(e){if(0==e.length||e.length>3)return s.LegacyCoreAssert.fail("GridCell.fromArray: Array has incorrect # of elements",void 0,"GridCell.fromArray","GridCell.swift",214),null;var t;if(t=c.TheoRect.decodeJson(a.as(e[0],"AnyObject"))){var n=e[1],o=null;return e.length>2&&(o=a.toString(e[2])),new r(t,o,n)}return null},decodeJson:function(e){return null==e?null:a.is(e,["Array","Any"])?r.fromArray(e):(s.LegacyCoreAssert.fail("GridCell: Not an array",void 0,"GridCell.decodeJson","GridCell.swift",246),null)}},props:{bounds:{get:function(){return this.region_},set:function(e){this.region_=e}},colorID:{get:function(){return this.colorID_},set:function(e){this.colorID_=e}},opacity:{get:function(){return this.opacity_},set:function(e){this.opacity_=e}},clone:function(){return new r(this.region_,this.colorID_,this.opacity_)},flip:function(){return new r(new c.TheoRect(this.bounds.minY,this.bounds.minX,this.bounds.maxY,this.bounds.maxX),this.colorID_,this.opacity_)},copyTo:function(e,t,n){var o,a;return void 0===e&&(e=null),void 0===t&&(t=null),void 0===n&&(n=null),new r(e||this.region_,(o=t)||null!=o?o:this.colorID_,(a=n)||null!=a?a:this.opacity_)},symmetricWith:function(e){var t=this.region_,n=e.bounds;if(t.equal(n))return!1;var r=new u.TheoPoint(1-t.center.x,t.center.y),o=new u.TheoPoint(t.center.x,1-t.center.y);return r.distanceTo(n.center)<.01||o.distanceTo(n.center)<.01},mergeableWith:function(e){var t=this.region_.unionWith(e.bounds);return!(this.region_.L1Distance(e.bounds)>.001)&&l.MathUtils.absDouble(t.area-(this.bounds.area+e.bounds.area))<.01},mergeWith:function(e){return s.LegacyCoreAssert.isTrue(this.mergeableWith(e),"cell must be adjacent",void 0,"GridCell.mergeWith","GridCell.swift",140),this.copyTo(this.region_.unionWith(e.bounds))},handlePosition:function(e){return this.region_.eval(r.positionForHandle(e))},encode:function(){return s.LegacyCoreAssert.fail("GridCell: Use encodeJson(), not encode()",void 0,"GridCell.encode","GridCell.swift",251),[]},encodeJson:function(){var e=[];return e.push(this.region_.encodeJson()),s.LegacyCoreAssert.isFalse(isNaN(this.opacity),"Can't persist NaN opacity value",void 0,"GridCell.encodeJson","GridCell.swift",259),e.push(a.as(this.opacity,"AnyObject")),null!=this.colorID_&&e.push(a.as(this.colorID_,"AnyObject")),a.as(e,"AnyObject")},isEqual:function(e){var t;return!!(t=a.as(e,r))&&this.bounds.equalWithAccuracy(t.bounds,r.BOUNDS_ACCURACY)&&this.colorID==t.colorID&&this.opacity==t.opacity}}}),r),o._equality_GridCell_GridCell=function(e,t){return e.isEqual(t)}},txj3:function(e,t,n){var r,o=t,a=n("oAGj"),i=n("fNpk"),s=n("ThKb");o.NNMLPClassifier=(r=function(e,t,n){this._finalSoftmax=!0,void 0===n&&(n=!0),i.LegacyCoreAssert.isTrue(e.length==t.length,"counts of coefficients and intercepts do not match",void 0,"NNMLPClassifier.init","NNMLPClassifier.swift",18),this._coefficients=a.clone(e),this._intercepts=a.clone(t);var r=e.length;this._classNum=e[r-1].rows,this._finalSoftmax=n,a.defctor(this)},a.defineClass({name:"NNMLPClassifier",ctor:r,props:{predict:function(e){return i.LegacyCoreAssert.isTrue(1==e.cols,"can't predict for multi-column input",void 0,"NNMLPClassifier.predict","NNMLPClassifier.swift",28),a.clone(this.forwardPropagate(e)).AL},forwardPropagate:function(e){for(var t={},n=[],r=e,o=this.hiddenLayerNumber(),i=a.iter(a.range(0,o,!1));!i.done;i.next()){var s=i.value,l=r,u=this._coefficients[s],c=this._intercepts[s],d=a.clone(this.linearActivationForward(l,u,c,"relu"));r=d.A,n.push(d.cache)}if(1!=this._classNum&&this._finalSoftmax){var h=a.clone(this.linearActivationForward(r,this._coefficients[o],this._intercepts[o],"softmax"));n.push(h.cache),t.AL=h.A,t.caches=a.clone(n)}else{var p=a.clone(this.linearActivationForward(r,this._coefficients[o],this._intercepts[o],"sigmoid"));n.push(p.cache),t.AL=p.A,t.caches=a.clone(n)}return t},backwardPropagate:function(e,t,n){var r={},o=[],l=[],u=[],c=n.length;i.LegacyCoreAssert.isTrue(e.cols==t.cols&&e.rows==t.rows,"probability vector and output vector dimensions do not match",void 0,"NNMLPClassifier.backwardPropagate","NNMLPClassifier.swift",104);var d=a.clone(n[c-1]);if(1==this._classNum){var h=s.TheoMatrix.ones(t.rows,t.cols),p=t.divide(e).subtract(h.subtract(t).divide(h.subtract(e))).multiplyConstant(-1),f=a.clone(this.linearActivationBackward(p,d,"sigmoid"));o.push(f.dAprev),l.push(f.dW),u.push(f.db)}else{var m=e.subtract(t),g=a.clone(this.linearActivationBackward(m,d,"softmax"));o.push(g.dAprev),l.push(g.dW),u.push(g.db)}for(var y=a.iter(a.range(0,c-2,!0).reversed());!y.done;y.next()){var _=y.value;d=a.clone(n[_]);var T=a.clone(this.linearActivationBackward(o[o.length-1],d,"relu"));o.push(T.dAprev),l.push(T.dW),u.push(T.db)}return r.dAs=a.reverse(o),r.dWs=a.reverse(l),r.dbs=a.reverse(u),r},computeCost:function(e,t){var n=t.cols;if(i.LegacyCoreAssert.isTrue(n>0,"number of columns in output vector must be positive",void 0,"NNMLPClassifier.computeCost","NNMLPClassifier.swift",139),1==this._classNum){var r=s.TheoMatrix.ones(t.rows,t.cols),o=t.multiply(e.matrixLog()),l=r.subtract(t).multiply(r.subtract(e).matrixLog()),u=o.add(l);return a.toDouble(a.toInt(-1/n))*u.sumRows().value(0,0)}return t.transpose().matrixMultiply(e.matrixLog()).value(0,0)*(-1/a.toDouble(n))},linearForward:function(e,t,n){var r={};return r.Z=t.matrixMultiply(e).add(n),r.cache={A:e,W:t,b:n},r},linearActivationForward:function(e,t,n,r){var o={},i={},s=a.clone(this.linearForward(e,t,n)),l=s.Z;return i.linearCache=s.cache,i.activationCache=l,o.cache=a.clone(i),"sigmoid"==r?o.A=l.sigmoid():"relu"==r?o.A=l.relu():"softmax"==r&&(o.A=this.softmaxActivation(l)),o},hiddenLayerNumber:function(){return this._coefficients.length-1},linearBackward:function(e,t,n,r){var o={},s=t.cols,l=e.matrixMultiply(t.transpose()).multiplyConstant(a.toDouble(a.toInt(1/s))),u=e.sumColumns().multiplyConstant(a.toDouble(a.toInt(1/s))),c=n.transpose().matrixMultiply(e);return i.LegacyCoreAssert.isTrue(l.cols==n.cols&&l.rows==n.rows,"weight and gradient matrix dimensions do not match",void 0,"NNMLPClassifier.linearBackward","NNMLPClassifier.swift",223),i.LegacyCoreAssert.isTrue(u.cols==r.cols&&u.rows==r.rows,"bias and gradient matrix dimensions do not match",void 0,"NNMLPClassifier.linearBackward","NNMLPClassifier.swift",224),i.LegacyCoreAssert.isTrue(c.cols==t.cols&&c.rows==t.rows,"activation and gradient matrix dimensions do not match",void 0,"NNMLPClassifier.linearBackward","NNMLPClassifier.swift",225),o.dAprev=c,o.dW=l,o.db=u,o},linearActivationBackward:function(e,t,n){var r=a.clone(t.linearCache),o=r.A,i=r.W,s=r.b,l=t.activationCache,u={};if("sigmoid"==n){var c=this.sigmoidBackward(e,l);u=a.clone(this.linearBackward(c,o,i,s))}else"relu"==n?(c=this.reluBackward(e,l),u=a.clone(this.linearBackward(c,o,i,s))):"softmax"==n&&(c=e,u=a.clone(this.linearBackward(c,o,i,s)));return u},softmaxActivation:function(e){i.LegacyCoreAssert.isTrue(1==e.cols,"can't calculate softmax activation for multi-column input",void 0,"NNMLPClassifier.softmaxActivation","NNMLPClassifier.swift",266);var t=e.exp(),n=t.sum();return t.multiplyConstant(a.toDouble(1/n))},sigmoidBackward:function(e,t){var n=s.TheoMatrix.ones(t.rows,t.cols),r=t.sigmoid(),o=e.multiply(r).multiply(n.subtract(r));return i.LegacyCoreAssert.isTrue(o.cols==t.cols&&o.rows==t.rows,"sigmoid backward result's dimensions incorrect",void 0,"NNMLPClassifier.sigmoidBackward","NNMLPClassifier.swift",277),o},reluBackward:function(e,t){i.LegacyCoreAssert.isTrue(e.cols==t.cols&&e.rows==t.rows,"relu backward input dimensions incorrect",void 0,"NNMLPClassifier.reluBackward","NNMLPClassifier.swift",282);for(var n=[],r=a.iter(a.range(0,e.rows,!1));!r.done;r.next()){for(var o=r.value,l=[],u=a.iter(a.range(0,e.cols,!1));!u.done;u.next()){var c=u.value;t.value(o,c)>=0?l.push(e.value(o,c)):l.push(0)}n.push(l)}var d=new s.TheoMatrix(n);return i.LegacyCoreAssert.isTrue(d.cols==t.cols&&d.rows==t.rows,"relu backward result's dimensions incorrect",void 0,"NNMLPClassifier.reluBackward","NNMLPClassifier.swift",296),d}}}),r)},u2iI:function(e,t,n){var r,o,a=t,i=n("oAGj"),s=n("ascj"),l=n("QbzR"),u=n("Zifs");a.ShapeType=i.defineEnum("ShapeType",{Fill:0,Stroke:1,FillAndStroke:2}),a.ShapeStyle=(r=function(){this.deprecatedPrimaryColor=null},o={},i.defineClass({name:"ShapeStyle",ctor:r,superName:"FormaStyle",statics:{STROKE_BASE_WEIGHT_DEFAULT:0,STROKE_WEIGHT_MULTIPLIER_DEFAULT:1,STROKE_WEIGHT_MULTIPLIER_MIN_DEFAULT:1,STROKE_WEIGHT_MULTIPLIER_MAX_DEFAULT:1,PRESCALE_BASE_DEFAULT:1,PRESCALE_MIN_DEFAULT:1,PRESCALE_MAX_DEFAULT:1,SHAPE_TYPE_DEFAULT:{get:function(){return void 0===o.SHAPE_TYPE_DEFAULT&&(o.SHAPE_TYPE_DEFAULT=a.ShapeType.Fill),o.SHAPE_TYPE_DEFAULT}},PROPERTY_STROKE_BASE_WEIGHT:"stroke-base-weight",PROPERTY_STROKE_WEIGHT_MULTIPLIER:"stroke-weight-multiplier",PROPERTY_STROKE_WEIGHT_MULTIPLIER_MIN:"stroke-weight-multiplier-min",PROPERTY_STROKE_WEIGHT_MULTIPLIER_MAX:"stroke-weight-multiplier-max",PROPERTY_PRESCALE_BASE:"prescale-base",PROPERTY_PRESCALE_MIN:"prescale-min",PROPERTY_PRESCALE_MAX:"prescale-max",PROPERTY_SHAPE_TYPE:"shape-type",SHAPE_TYPE_FILL:"fill",SHAPE_TYPE_STROKE:"stroke",SHAPE_TYPE_FILLANDSTROKE:"fillandstroke",SCHEMA_CLASS_NAME:{get:function(){return"ShapeStyle"}},KIND:{get:function(){return"ShapeStyle"}},factory:{get:function(){return function(e,t,n,o){return r.init_866e(n,e)}}},createDefault:function(){return r.init_d41d()},_implements:function(e){return"IDBObject"==e||"TheoMessagePublisher"==e||"ColorTableOwner"==e}},props:{init_866e:function(e,t){var n;i.super_init(this,l.FormaStyle,l.FormaStyle.prototype.init_866e,e,t),(n=i.as(this.get(l.FormaStyle.PROPERTY_COLORS_DEPRECATED),["Array",u.SolidColor]))&&n.length>=1&&(this.deprecatedPrimaryColor=n[0])},init_d41d:function(){i.super_init(this,l.FormaStyle,l.FormaStyle.prototype.init_5afe,r.KIND,l.FormaStyle.OPACITY_DEFAULT,s.ColorTable.createDefaultPair())},willCommitState:function(){null!=this.deprecatedPrimaryColor&&(this.colors.fieldPrimary=this.deprecatedPrimaryColor,this.colors.fieldSecondary=this.deprecatedPrimaryColor,this.deprecatedPrimaryColor=null),l.FormaStyle.prototype.willCommitState.call(this)},className:{get:function(){return r.SCHEMA_CLASS_NAME}},colorTableSupportsRole:function(e){return e==s.ColorRole.FieldPrimary||e==s.ColorRole.FieldSecondary},hasCustomAttributes:function(e){var t,n,o,a,s,l,u,c=(t=i.as(e["stroke-base-weight"],"Double"))||null!=t?t:r.STROKE_BASE_WEIGHT_DEFAULT,d=(n=i.as(e["stroke-multiplier-initial"],"Double"))||null!=n?n:r.STROKE_WEIGHT_MULTIPLIER_DEFAULT,h=(o=i.as(e["stroke-multiplier-min"],"Double"))||null!=o?o:r.STROKE_WEIGHT_MULTIPLIER_MIN_DEFAULT,p=(a=i.as(e["stroke-multiplier-max"],"Double"))||null!=a?a:r.STROKE_WEIGHT_MULTIPLIER_MAX_DEFAULT,f=(s=i.as(e["prescale-base"],"Double"))||null!=s?s:r.PRESCALE_BASE_DEFAULT,m=(l=i.as(e["prescale-min"],"Double"))||null!=l?l:r.PRESCALE_MIN_DEFAULT,g=(u=i.as(e["prescale-max"],"Double"))||null!=u?u:r.PRESCALE_MAX_DEFAULT;return c!=r.STROKE_BASE_WEIGHT_DEFAULT||d!=r.STROKE_WEIGHT_MULTIPLIER_DEFAULT||h!=r.STROKE_WEIGHT_MULTIPLIER_MIN_DEFAULT||p!=r.STROKE_WEIGHT_MULTIPLIER_MAX_DEFAULT||f!=r.PRESCALE_BASE_DEFAULT||m!=r.PRESCALE_MIN_DEFAULT||g!=r.PRESCALE_MAX_DEFAULT},isBasicShape:function(){return this.strokeBaseWeight!=r.STROKE_BASE_WEIGHT_DEFAULT||this.strokeWeightMultiplier!=r.STROKE_WEIGHT_MULTIPLIER_DEFAULT||this.strokeWeightMultiplierMin!=r.STROKE_WEIGHT_MULTIPLIER_MIN_DEFAULT||this.strokeWeightMultiplierMax!=r.STROKE_WEIGHT_MULTIPLIER_MAX_DEFAULT||this.prescaleBase!=r.PRESCALE_BASE_DEFAULT||this.prescaleMin!=r.PRESCALE_MIN_DEFAULT||this.prescaleMax!=r.PRESCALE_MAX_DEFAULT},copyCustomAttributes:function(e){var t,n,o,a,s,l,u;return this.strokeBaseWeight=(t=i.as(e["stroke-base-weight"],"Double"))||null!=t?t:r.STROKE_BASE_WEIGHT_DEFAULT,this.strokeWeightMultiplier=(n=i.as(e["stroke-multiplier-initial"],"Double"))||null!=n?n:r.STROKE_WEIGHT_MULTIPLIER_DEFAULT,this.strokeWeightMultiplierMin=(o=i.as(e["stroke-multiplier-min"],"Double"))||null!=o?o:r.STROKE_WEIGHT_MULTIPLIER_MIN_DEFAULT,this.strokeWeightMultiplierMax=(a=i.as(e["stroke-multiplier-max"],"Double"))||null!=a?a:r.STROKE_WEIGHT_MULTIPLIER_MAX_DEFAULT,this.prescaleBase=(s=i.as(e["prescale-base"],"Double"))||null!=s?s:r.PRESCALE_BASE_DEFAULT,this.prescaleMin=(l=i.as(e["prescale-min"],"Double"))||null!=l?l:r.PRESCALE_MIN_DEFAULT,this.prescaleMax=(u=i.as(e["prescale-max"],"Double"))||null!=u?u:r.PRESCALE_MAX_DEFAULT,this.hasCustomAttributes(e)},strokeBaseWeight:{get:function(){var e;return(e=i.as(this.get(r.PROPERTY_STROKE_BASE_WEIGHT),"Double"))||null!=e?e:r.STROKE_BASE_WEIGHT_DEFAULT},set:function(e){e!=this.strokeBaseWeight&&(this.notifyBefore(),this.set(r.PROPERTY_STROKE_BASE_WEIGHT,e),this.notifyAfter())}},strokeWeightMultiplier:{get:function(){var e;return(e=i.as(this.get(r.PROPERTY_STROKE_WEIGHT_MULTIPLIER),"Double"))||null!=e?e:r.STROKE_WEIGHT_MULTIPLIER_DEFAULT},set:function(e){e!=this.strokeWeightMultiplier&&(this.notifyBefore(),this.set(r.PROPERTY_STROKE_WEIGHT_MULTIPLIER,e),this.notifyAfter())}},strokeWeightMultiplierMin:{get:function(){var e;return(e=i.as(this.get(r.PROPERTY_STROKE_WEIGHT_MULTIPLIER_MIN),"Double"))||null!=e?e:r.STROKE_WEIGHT_MULTIPLIER_MIN_DEFAULT},set:function(e){e!=this.strokeWeightMultiplierMin&&(this.notifyBefore(),this.set(r.PROPERTY_STROKE_WEIGHT_MULTIPLIER_MIN,e),this.notifyAfter())}},strokeWeightMultiplierMax:{get:function(){var e;return(e=i.as(this.get(r.PROPERTY_STROKE_WEIGHT_MULTIPLIER_MAX),"Double"))||null!=e?e:r.STROKE_WEIGHT_MULTIPLIER_MAX_DEFAULT},set:function(e){e!=this.strokeWeightMultiplierMax&&(this.notifyBefore(),this.set(r.PROPERTY_STROKE_WEIGHT_MULTIPLIER_MAX,e),this.notifyAfter())}},prescaleBase:{get:function(){var e;return(e=i.as(this.get(r.PROPERTY_PRESCALE_BASE),"Double"))||null!=e?e:r.PRESCALE_BASE_DEFAULT},set:function(e){e!=this.prescaleBase&&(this.notifyBefore(),this.set(r.PROPERTY_PRESCALE_BASE,e),this.notifyAfter())}},prescaleMin:{get:function(){var e;return(e=i.as(this.get(r.PROPERTY_PRESCALE_MIN),"Double"))||null!=e?e:r.PRESCALE_MIN_DEFAULT},set:function(e){e!=this.prescaleMin&&(this.notifyBefore(),this.set(r.PROPERTY_PRESCALE_MIN,e),this.notifyAfter())}},prescaleMax:{get:function(){var e;return(e=i.as(this.get(r.PROPERTY_PRESCALE_MAX),"Double"))||null!=e?e:r.PRESCALE_MAX_DEFAULT},set:function(e){e!=this.prescaleMax&&(this.notifyBefore(),this.set(r.PROPERTY_PRESCALE_MAX,e),this.notifyAfter())}},shapeType:{get:function(){var e;switch((e=i.as(this.get(r.PROPERTY_SHAPE_TYPE),"String"))||null!=e?e:r.SHAPE_TYPE_FILL){case"fill":return a.ShapeType.Fill;case"stroke":return a.ShapeType.Stroke;case"fillandstroke":return a.ShapeType.FillAndStroke;default:return a.ShapeType.Fill}},set:function(e){if(e!=this.shapeType){switch(this.notifyBefore(),e){case 0:this.set(r.PROPERTY_SHAPE_TYPE,r.SHAPE_TYPE_FILL);break;case 1:this.set(r.PROPERTY_SHAPE_TYPE,r.SHAPE_TYPE_STROKE);break;case 2:this.set(r.PROPERTY_SHAPE_TYPE,r.SHAPE_TYPE_FILLANDSTROKE);break;default:this.set(r.PROPERTY_SHAPE_TYPE,r.SHAPE_TYPE_FILL)}this.notifyAfter()}}}}}),r)},uMFj:function(e,t,n){var r,o=t,a=n("oAGj"),i=n("x0BK"),s=n("9YN4");o.DCXDocumentEncoder=(r=function(e){i.DCXNodeEncoder.call(this,e,e.root);var t=[s.TheoDocument.COMPONENT_RELATIONSHIP_METADATA,s.TheoDocument.COMPONENT_RELATIONSHIP_RENDITION];this.prepareCompositeForSave(t)},a.defineClass({name:"DCXDocumentEncoder",ctor:r,superName:"DCXNodeEncoder",statics:{_implements:function(e){return"IExportDataObject"==e}},props:{finish:function(){i.DCXNodeEncoder.prototype.finish.call(this),this.discardStashedComponents()}}}),r)},uUew:function(e,t,n){var r,o=t,a=n("oAGj"),i=n("gXiO"),s=n("fNpk");o.TextRange=(r=function(e,t){this.start=e,this.end=t,s.LegacyCoreAssert.isTrue(t>=e&&e>=0,"TextRange is invalid",{start:e,end:t},"TextRange.init","TextRange.swift",19),i.CoreObject.call(this)},a.defineClass({name:"TextRange",ctor:r,superName:"CoreObject",statics:{makeRangesContiguous:function(e){for(var t=a.iter(a.toSequence(e));!t.done;t.next()){var n=t.value,o=n.offset,i=n.element;o+1<e.length&&(e[o]=new r(i.start,e[o+1].start))}}},props:{length:{get:function(){return this.end-this.start}},asString:{get:function(){return"["+this.start+"-"+this.end+"]"}},contains:function(e){return e.start>=this.start&&e.end<=this.end},unionWith:function(e){return new r(Math.min(this.start,e.start),Math.max(this.end,e.end))}}}),r)},uWOl:function(e,t,n){var r,o=t,a=n("oAGj"),i=n("ascj"),s=n("QbzR"),l=n("Qlvz"),u=n("SDdr"),c=n("Zifs");o.ImageStyle=(r=function(){this.firstCommit=!1},a.defineClass({name:"ImageStyle",ctor:r,superName:"FormaStyle",statics:{SCHEMA_CLASS_NAME:{get:function(){return"ImageStyle"}},KIND:{get:function(){return"ImageStyle"}},DEFAULT_NAME:"None",PROPERTY_NAME:"name",PROPERTY_FILTER_NAME_DEPRECATED:"filter-name",NAME_NONE:"None",NAME_GREYSCALE:"Greyscale",NAME_DARKEN:"Darken",NAME_BLUR:"Blur",NAME_OVERLAY:"Overlay",NAME_MULTIPLY:"Multiply",NAME_BLEND:"Blend",NAME_DUOTONE:"DuoTone",NAME_SCREEN:"Screen",NAME_NEWDUOTONE:"NewDuoTone",factory:{get:function(){return function(e,t,n,o){return r.init_866e(n,e)}}},makeSafeName:function(e){if(e.includes("Overlay")||e.includes("DuoTone")||e.includes("Multiply")){var t=e.substr(e.length-1);if(t>="0"&&t<="9")return e.substr(0,e.length-1)}return e},createDefault:function(){return r.init_1265(r.DEFAULT_NAME,i.ColorTable.createDefault())},_implements:function(e){return"IDBObject"==e||"TheoMessagePublisher"==e||"ColorTableOwner"==e}},props:{init_866e:function(e,t){this.firstCommit=!0,a.super_init(this,s.FormaStyle,s.FormaStyle.prototype.init_866e,e,t)},init_a6fe:function(e,t,n,o){void 0===o&&(o=null);var i,l={name:r.makeSafeName(t)};if(i=o)for(var u=a.iter(i);!u.done;u.next()){var c=u.key,d=u.value;l[c]=d}a.super_init(this,s.FormaStyle,s.FormaStyle.prototype.init_5afe,e,s.FormaStyle.OPACITY_DEFAULT,n,null,null,l)},init_1265:function(e,t,n,o){void 0===t&&(t=null),void 0===n&&(n=null),void 0===o&&(o=null);var i,u={name:r.makeSafeName(e)};if(i=o)for(var c=a.iter(i);!c.done;c.next()){var d=c.key,h=c.value;u[d]=h}a.super_init(this,s.FormaStyle,s.FormaStyle.prototype.init_5afe,r.KIND,s.FormaStyle.OPACITY_DEFAULT,t,n,l.ImageAdjustments.createDefault(),u)},init_dd5d:function(e,t){a.super_init(this,s.FormaStyle,s.FormaStyle.prototype.init_dd5d,e,t)},colors_:{get:function(){var e=this,t=s.FormaStyle._getters.colors_.call(this);return a.opt(t,(function(e){return null==e.library}))&&a.opt(t,(function(t){return t.setColorLibraryWithoutSubscribing(e.colorLibrary)})),t},set:function(e){s.FormaStyle._setters.colors_.call(this,e)}},clone:function(){var e,t=this,n=s.FormaStyle.prototype.clone.call(this);return(e=a.as(a.opt(n,(function(e){return e.filter})),u.AlphaBlendFilter))&&(a.opt(e.filter1,(function(e){return e.style=a.opt(a.opt(a.as(t.filter,u.AlphaBlendFilter),(function(e){return e.filter1})),(function(e){return e.style}))})),a.opt(e.filter2,(function(e){return e.style=a.opt(a.opt(a.as(t.filter,u.AlphaBlendFilter),(function(e){return e.filter2})),(function(e){return e.style}))}))),n},willCommitState:function(){this.firstCommit&&(this.ensureStyleName(),this.updateDeprecatedColorTable(),this.firstCommit=!1),s.FormaStyle.prototype.willCommitState.call(this)},ensureStyleName:function(){var e,t;if(null!=(t=a.as(this.get(r.PROPERTY_NAME),"String"))){var n=t;if(t.includes(r.NAME_OVERLAY)||t.includes(r.NAME_DUOTONE)||t.includes(r.NAME_MULTIPLY)){var o=t.substr(t.length-1);o>="0"&&o<="9"&&(n=t.substr(0,t.length-1))}n!=t&&(this.name=n)}else{var i=a.opt(this.filter,(function(e){return e.name})),s=a.as(this.get(r.PROPERTY_FILTER_NAME_DEPRECATED),"String"),l=(e=s)||null!=e?e:i;if(null!=l)switch(l){case"Greyscale":this.name="Greyscale";break;case"GreyscaleDark":this.name="Darken";break;case"Monochrome":this.name="Greyscale";break;case"Duotone":this.name="DuoTone1";break;case"DesaturateMultiply":this.name="Multiply1";break;case"ReduceContrastOverlay":this.name="Overlay1";break;default:this.name=l}if(null!=s)switch(s){case"Greyscale":this.filter=u.CompositeFilter.init_514f(this,"Greyscale",1,"none",!0);break;case"GreyscaleDark":this.colors.fieldPrimary=c.SolidColor.BLACK,this.filter=u.CompositeFilter.init_514f(this,"Darken",.5,"normal",!1);break;case"Monochrome":this.filter=u.CompositeFilter.init_514f(this,"DesaturateMultiply",1,"multiply",!0,void 0,"offset",.5,1);break;case"Duotone":this.filter=u.CompositeFilter.init_514f(this,"Duotone",1,"normal",void 0,void 0,"duotone");break;case"DesaturateMultiply":this.filter=u.CompositeFilter.init_514f(this,"DesaturateMultiply",1,"multiply",!0,void 0,"offset",.5,1);break;case"ReduceContrastOverlay":this.filter=u.CompositeFilter.init_514f(this,"ReduceContrastOverlay",.5,"overlay",!1,.5,"offset",1,1);break;case"FillColor":this.filter=u.CompositeFilter.init_514f(this,"Normal",.5,"normal",!1);break;default:this.filter=null}}},updateDeprecatedColorTable:function(){var e;(e=a.as(this.get(s.FormaStyle.PROPERTY_COLORS_DEPRECATED),["Array",c.SolidColor]))&&(e.length>=1&&(this.colors.fieldPrimary=e[0]),e.length>=2&&(this.colors.fieldSecondary=e[1]))},className:{get:function(){return r.SCHEMA_CLASS_NAME}},name:{get:function(){var e;return(e=a.as(this.get(r.PROPERTY_NAME),"String"))||null!=e?e:r.DEFAULT_NAME},set:function(e){this.set(r.PROPERTY_NAME,e)}},isColorizedFilter:{get:function(){return!["None","Greyscale","Blur","Darken"].includes(this.name)}},isColorEditable:{get:function(){return this.name==r.NAME_NEWDUOTONE}},isMixableFilter:{get:function(){return this.name==r.NAME_DARKEN}},isShuffleable:{get:function(){return this.isColorizedFilter||this.isMixableFilter}},colorTableSupportsRole:function(e){return e==i.ColorRole.FieldPrimary||e==i.ColorRole.FieldSecondary},equals:function(e){if(null==this.filter&&null!=e.filter||null!=this.filter&&null==e.filter)return!1;var t=null==this.filter&&null==e.filter,n=t||this.filter.equals(e.filter),r=t||this.colors.equalTo(e.colors),o=a.opt(this.adjustments,(function(t){return t.equals(e.adjustments)}));return n&&r&&o},description:{get:function(){if(null!=this.filter&&this.filter instanceof u.CompositeFilter){var e=this.filter,t="Style: "+this.name+", Op: "+e.colorOperation+", Filter: "+e.name,n=", params: (m="+a.toString(e.mix)+", c="+a.toString(e.contrast)+", b="+a.toString(e.blurRadius)+")";return null!=this.colors.fieldPrimary?t+n+this.colors.fieldPrimary.rgbHex:t+n}return this.name}}}}),r)},uZuM:function(e,t,n){var r,o,a=t,i=n("oAGj"),s=n("QbzR"),l=n("JEzR"),u=n("4mVB"),c=n("iCxV"),d=n("uWOl"),h=n("c+uM"),p=n("2ALn"),f=n("u2iI"),m=n("LCGV"),g=n("QTen");a.FormaStyleFactory=(r=function(){this.lookup_={},this.lookup_[s.FormaStyle.KIND]=function(){return s.FormaStyle.createDefault()},this.lookup_[d.ImageStyle.KIND]=function(){return d.ImageStyle.createDefault()},this.lookup_[m.TextStyle.KIND]=function(){return m.TextStyle.createDefault()},this.lookup_[f.ShapeStyle.KIND]=function(){return f.ShapeStyle.createDefault()},this.lookup_[p.RootStyle.KIND]=function(){return p.RootStyle.createDefault()},this.lookup_[h.LockupStyle.KIND]=function(){return h.LockupStyle.createDefault()},this.lookup_[g.VideoStyle.KIND]=function(){return g.VideoStyle.createDefault()},this.lookup_[u.GridStyle.KIND]=function(){return u.GridStyle.createDefault()},this.lookup_[l.FrameStyle.KIND]=function(){return l.FrameStyle.createDefault()}},o={},i.defineClass({name:"FormaStyleFactory",ctor:r,superName:"CoreObject",statics:{instance:{get:function(){return void 0===o.instance&&(o.instance=new r),o.instance}}},props:{create:function(e){var t;return null!=(t=this.lookup_[e])?t():(i.opt(c.Host.logging,(function(t){return t.warning("no constructor for forma style kind = "+e)})),null)}}}),r)},uj1m:function(e,t,n){var r,o=t,a=n("oAGj"),i=n("iCxV"),s=n("ThKb");o.MLPModel=(r=function(e,t,n,r,o,i,s,l){this.featureScalingMean=e,this.featureScalingStd=t,this.coefficients=a.clone(n),this.intercepts=a.clone(r),this.shapes=a.clone(o||[]),this.fonts=a.clone(i||[]),this.layouts=a.clone(s||[]),this.roles=a.clone(l||[]),this.fontMap={},this.finalSoftmax=!0},a.defineClass({name:"MLPModel",ctor:r,statics:{cache:{},loadNNModel:function(e){if(null==r.cache[e]){var t,n=null;if(t=a.opt(i.Host.learning,(function(t){return t.loadNNJSON(e)}))){var o,l=new s.TheoMatrix([t.featureScalingMean]),u=new s.TheoMatrix([t.featureScalingStd]);if(o=a.as(t.model,["Dictionary","String","Any"])){for(var c=a.clone(o.coefs),d=[],h=a.iter(c);!h.done;h.next()){var p=h.value;d.push(new s.TheoMatrix(p).transpose())}for(var f=a.clone(o.intercepts),m=[],g=a.iter(f);!g.done;g.next()){var y=g.value;m.push(new s.TheoMatrix([y]).transpose())}for(var _={},T=a.iter(["shapes","fonts","layouts","roles"]);!T.done;T.next()){var C=T.value;null!=o[C]?_[C]=a.clone(o[C]):_[C]=[]}n=new r(l,u,d,m,_.shapes,_.fonts,_.layouts,_.roles)}}r.cache[e]=n}return r.cache[e]}},props:{data:function(){for(var e=[],t=[],n=a.iter(this.coefficients);!n.done;n.next()){var r=n.value;e.push(r.transpose().asArray)}for(var o=a.iter(this.intercepts);!o.done;o.next()){var i=o.value;t.push(i.transpose().asFlatArray)}return a.clone(a.as({model:{coefs:e,intercepts:t,shapes:this.shapes,fonts:this.fonts,layouts:this.layouts,roles:this.roles},featureScalingMean:this.featureScalingMean.asFlatArray,featureScalingStd:this.featureScalingStd.asFlatArray},["Dictionary","String","Any"]))}}}),r)},voyk:function(e,t,n){var r,o=t,a=n("oAGj"),i=n("fNpk");o.TheoJSONEncoder=(r=function(e){this.json_={},this.children=[],this.components=null,this.namespace_="",void 0===e&&(e=""),this.namespace_=e},a.defineClass({name:"TheoJSONEncoder",ctor:r,statics:{_implements:function(e){return"IExportDataObject"==e}},props:{json:function(){for(var e=a.clone(this.json_),t=a.iter(e);!t.done;t.next()){var n,o=t.key,i=t.value;(n=a.as(i,r))&&(e[o]=a.clone(n.json()))}return 0==this.children.length||(e.children=this.children.map((function(e){return e.json()}),this)),e},setPath:function(e){this.json_.path=e},setName:function(e){this.json_.name=e},setType:function(e){this.json_.type=e},setProperty:function(e,t){null!=t&&(this.json_[this.namespace_+e]=t)},setOptionalStringProperty:function(e,t){this.json_[this.namespace_+e]=t},setStringProperty:function(e,t){this.json_[this.namespace_+e]=t},setStringPropertyNoNamespace:function(e,t){this.json_[e]=t},setNumberProperty:function(e,t){i.LegacyCoreAssert.isFalse(isNaN(t),"Can't set NaN for prop.",{property:e},"TheoJSONEncoder.setNumberProperty","TheoJSONEncoder.swift",52),this.json_[this.namespace_+e]=t},setIntProperty:function(e,t){this.json_[this.namespace_+e]=t},setBooleanProperty:function(e,t){this.json_[this.namespace_+e]=t},setOptionalBooleanProperty:function(e,t){this.json_[this.namespace_+e]=t},findChild:function(e){return null},appendChild:function(e){var t=new r(this.namespace_);return t.setStringPropertyNoNamespace("id",e),this.children.push(t),t},appendComponent:function(e,t,n){null==this.components&&(this.components=[]),this.components.push({id:e,url:t,mimeType:n}),this.json_.components=a.clone(this.components)},setCompositeID:function(e){this.json_.id=e},setManifestProperty:function(e,t,n){},setDocumentSize:function(e,t){}}}),r)},"w/+j":function(e,t,n){var r,o=t,a=n("oAGj"),i=n("ko5Z"),s=n("WF+G"),l=n("iCxV"),u=n("q5zr"),c=n("SDdr"),d=n("fNpk"),h=n("c+uM"),p=n("tGKA"),f=n("Ird5"),m=n("WjWV"),g=n("Iv44"),y=n("dmHI"),_=n("9MJV"),T=n("jSYS"),C=n("WUDy"),v=n("sJQG"),P=n("PlOi"),S=n("W6ub"),A=n("Ucb9"),D=n("9K9k"),E=n("/eOI"),R=n("bAjp"),F=n("f/aw"),I=n("zW52"),b=n("bJhu"),O=n("mj5y"),k=n("RiZt"),M=n("KQHZ"),N=n("6ftY"),L=n("uYSz"),x=n("VXZl"),B=n("KDc2"),w=n("GOtr"),G=n("ll2+"),Y=n("GtBD"),U=n("sIWg"),V=n("xm77"),j=n("sW6f");o.FormaToPGMUtils=(r=function(){},a.defineClass({name:"FormaToPGMUtils",ctor:r,statics:{cpEnv:"prod",createTimeFunc:function(e,t){var n,r=new v.PGMRange(e.time.seconds,t.time.seconds);switch(t.timingFunction){case"Linear":n=new T.PGMLinearFunction(r,v.PGMRange.UNIT);break;case"Step":case"Step0":case"Step1":n=new T.PGMLinearFunction(r,new v.PGMRange(0,0));break;case"EaseIn":case"EaseOut":case"EaseInOut":var o=e.timingFunction==V.TimingFunctionType.EaseIn?E.PGMEasingType.EaseIn:e.timingFunction==V.TimingFunctionType.EaseOut?E.PGMEasingType.EaseOut:E.PGMEasingType.EaseInAndOut;n=new E.PGMSineEasingFunction(o,r,v.PGMRange.UNIT);break;default:a.opt(l.Host.logging,(function(t){return t.warning("Timing-func not yet converyed to PGM: "+e.timingFunction)})),n=new T.PGMLinearFunction(r,v.PGMRange.UNIT)}return n},determineOpacity:function(e){var t;return(t=a.as(e.style,h.LockupStyle))?t.textOpacity:a.opt(e.style,(function(e){return e.opacity}))},createTransformAnimation:function(e,t,n){var o,a=e.compositing.placement,i=t.placement,s=n.placement;return i.isIdentity&&s.isIdentity||(o=new I.PGMTransformAnimation(r.createTimeFunc(t,n),new I.PGMTransformedBounds(a.concat(i),O.PGMUtils.calcBounds(e.child,p.Matrix2D.Identity)||U.TheoRect.Zero),new I.PGMTransformedBounds(a.concat(s),O.PGMUtils.calcBounds(e.child,p.Matrix2D.Identity)||U.TheoRect.Zero))),o},createOpacityAnimation:function(e,t){var n,o=r.determineOpacity(e);if(null==o)return n;var a=r.determineOpacity(t);return null==a?n:n=new C.PGMOpacityAnimation(r.createTimeFunc(e,t),o,a)},createTextAnimation:function(e,t,n){var o,i=a.as(e,R.PGMText);if(null==i)return o;var s=a.opt(t.style,(function(e){return e.colors.fieldPrimary}));if(null==s)return o;var l=a.opt(n.style,(function(e){return e.colors.fieldPrimary}));if(null==l)return o;null==i.style.fillColor&&(s=null,l=null);var u=a.opt(t.style,(function(e){return e.colors.fieldSecondary})),c=a.opt(n.style,(function(e){return e.colors.fieldSecondary}));null==u&&(u=i.style.strokeColor),null==c&&(c=i.style.strokeColor);var d=new b.PGMTextStyle(i.style.font,s,u,i.style.strokeWidth,i.style.tracking),h=new b.PGMTextStyle(i.style.font,l,c,i.style.strokeWidth,i.style.tracking);return o=new F.PGMTextAnimation(r.createTimeFunc(t,n),t.bounds||i.bounds,d,n.bounds||i.bounds,h,S.PGMRenderRuns.init_378c(t.renderRuns),S.PGMRenderRuns.init_378c(n.renderRuns))},createShapeAnimation:function(e,t,n){var o,i=a.as(e,A.PGMShape);if(null==i)return o;var s=a.opt(t.style,(function(e){return e.colors.fieldPrimary}));if(null==s)return o;var l=a.opt(n.style,(function(e){return e.colors.fieldPrimary}));return null==l?o:o=new D.PGMShapeAnimation(r.createTimeFunc(t,n),s,t.bounds||i.bounds,l,n.bounds||i.bounds)},createFilterAnimation:function(e,t,n){var o,i,s,l,u,d;if(i=a.as(e,y.PGMFilter))if((s=a.as(i.spec,g.PGMBlurFilterSpec))&&(l=a.as(a.opt(t.style,(function(e){return e.filter})),c.CompositeFilter))&&(u=a.as(a.opt(n.style,(function(e){return e.filter})),c.CompositeFilter))){var h=new g.PGMBlurFilterSpec(s.edgeClamp,l.blurRadius,s.originalImageEntity),p=new g.PGMBlurFilterSpec(s.edgeClamp,u.blurRadius,s.originalImageEntity);o=new _.PGMFilterAnimation(r.createTimeFunc(t,n),h,p)}else if(d=a.as(i.spec,m.PGMBlendFilterSpec)){var f=d.weights[0],T=d.weights[1],C=new m.PGMBlendFilterSpec([f,T]),v=new m.PGMBlendFilterSpec([T,f]);o=new _.PGMFilterAnimation(r.createTimeFunc(t,n),C,v)}return o},createContentAnimation:function(e,t,n){var o,a=e.child;return a instanceof R.PGMText?o=r.createTextAnimation(a,t,n):a instanceof A.PGMShape?o=r.createShapeAnimation(a,t,n):a instanceof y.PGMFilter&&(o=r.createFilterAnimation(a,t,n)),o},convertAnimation:function(e,t,n,o){void 0===n&&(n=!0),void 0===o&&(o=!0);var i=[];if(!(t.keyFrames.length>1))return i;for(var s=t.keyFrames.length-2,l=a.iter(a.range(0,s,!0));!l.done;l.next()){var u,c,d,h=l.value,p=t.keyFrames[h],f=t.keyFrames[h+1];if(f.time!=p.time)n&&((u=r.createTransformAnimation(e,p,f))&&i.push(u),(c=r.createOpacityAnimation(p,f))&&i.push(c)),o&&(d=r.createContentAnimation(e,p,f))&&i.push(d)}return i},createAnimations:function(e,t){var n,o=[];if(n=t.animation){var i=a.clone(r.convertAnimation(e,n));a.append(o,i)}return f.PGMAnimationList.fromArray(o)},applyAnimations:function(e,t,n){if(!e.asDynamic)return n;var o=r.createAnimations(n,t),a=n.animations.merge(o);return n.withAnimations(a)},createResourceProviderForContentNode:function(e){var t,n,o,l,c=e.mimeType,h=e.localIdentifier,p=a.as(e,j.VideoContentNode);if(null!=h&&null!=p&&p.isForLocalVideo){var f,m=null;null!=(f=p.url)&&f.startsWith("file:")&&(m=new s.CorePath(f.substr("file:".length))),l=new Y.StorageSpecLocalIdentifier(h,m)}else if(null!=(f=(t=e.remappedUrl)||null!=t?t:e.url))if(f.startsWith("component:"))(C=f.substr("component:".length).split("/")).length>2&&"logo"==C[2]&&C.splice(2,1),c=a.opt(a.as(e,u.ImageContentNode),(function(e){return 1==e.isMask}))?"image/png":C.length>=3?a.replaceAll(C[2],"+","/"):c,a.opt(e.document.parent,(function(e){return e.id!=C[0]}))?l=new L.StorageSpecExternalCC(L.StorageSpecExternalCC.POST_DOCUMENTS_SYNC_GROUP,C[0],C[1],null,c,null,null):C.length>=2?l=new w.StorageSpecLocalComposite(C[1],c):(d.LegacyCoreAssert.fail("unexpected component encoding",void 0,"FormaToPGMUtils.createResourceProviderForContentNode","FormaToPGMUtils.swift",384),l=new B.StorageSpecInvalid);else if(f.startsWith("cp:")){var g=f.substr("cp:".length),y=(C=g.split("/"))[0];if(C.splice(0,1),"original"==C[0]&&C.splice(0,1),C.length>=1){var _=C.join("/");l=new N.StorageSpecCommunityPlatform(y,new s.CorePath(_),null,r.cpEnv)}else d.LegacyCoreAssert.fail("unexpected component encoding",void 0,"FormaToPGMUtils.createResourceProviderForContentNode","FormaToPGMUtils.swift",402),l=new B.StorageSpecInvalid}else if(f.startsWith("acp:")){var T=f.substr("acp:".length);l=new k.StorageSpecAdobeContentPlatform(T)}else if(f.startsWith("ac:")){var C;(C=f.substr("ac:".length).split("/")).length>=3&&"logo"==C[2]&&C.splice(2,1);var v=C.length>=3&&null!=["image+","video+","audio+","font+","application+"].find((function(e){return C[2].startsWith(e)}),this),S=C.length>=3&&!v?C[2]:null,A=null==S?2:3;C.length>A&&(c=a.replaceAll(C[A],"+","/")),l=new L.StorageSpecExternalCC(L.StorageSpecExternalCC.BRANDKIT_SYNC_GROUP,C[0],C[1],null,c,null,S)}else if(f.startsWith("file:")){var D=f.substr("file:".length);l=new G.StorageSpecLocalFile(new s.CorePath(D))}else if(f.startsWith("data:")){var E;if(null!=(E=a.indexOf(f,"base64,"))){var R=f.substr(E+"base64,".length),F=f.substr("data:".length,E-"data:".length);F.endsWith(";")&&(c=F.substr(0,F.length-1)),l=new M.StorageSpecContentLiteral(new i.CoreContentBase64(R,(n=c)||null!=n?n:""))}else d.LegacyCoreAssert.fail("data URL is not base64; unsupported",void 0,"FormaToPGMUtils.createResourceProviderForContentNode","FormaToPGMUtils.swift",457),l=new B.StorageSpecInvalid}else f.startsWith("http:")||f.startsWith("https:")||f.startsWith("blob:")?l=new x.StorageSpecHTTP(f):f.startsWith("/storage/")?l=new G.StorageSpecLocalFile(new s.CorePath(f)):(d.LegacyCoreAssert.fail("URL does not have a known pattern",void 0,"FormaToPGMUtils.createResourceProviderForContentNode","FormaToPGMUtils.swift",474),l=new B.StorageSpecInvalid);else d.LegacyCoreAssert.fail("no URL to inspect",void 0,"FormaToPGMUtils.createResourceProviderForContentNode","FormaToPGMUtils.swift",478),l=new B.StorageSpecInvalid;return new P.PGMResourceProvider((o=c)||null!=o?o:"",l)}}}),r)},wL85:function(e,t,n){var r,o=t,a=n("oAGj"),i=n("URxh"),s=n("tGKA"),l=n("oKlP"),u=n("RkYL"),c=n("xm77");o.MotionSrcDropIn=(r=function(){},a.defineClass({name:"MotionSrcDropIn",ctor:r,statics:{getSrcKeyframes:function(e){var t=[],n=u.TheoTime.Zero,r=u.TheoTime.fromSeconds(1),o=s.Matrix2D.translation(new l.TheoPoint(0,-400)),a=s.Matrix2D.Identity,d=e.style.clone();return t.push(new i.KeyFrame(n,c.TimingFunctionType.Linear,o,null,d)),t.push(new i.KeyFrame(r,c.TimingFunctionType.Linear,a,null,d)),t}}}),r)},wNKJ:function(e,t,n){var r,o=t,a=n("oAGj"),i=n("gXiO"),s=n("quOg"),l=n("FNB+"),u=n("6ZWm"),c=n("cmoc"),d=n("OdB2"),h=n("P83h"),p=n("9Lk3"),f=n("ZK0l"),m=n("pnSN"),g=n("X0GW"),y=n("iCxV"),_=n("fdtz"),T=n("lmwz"),C=n("fNpk"),v=n("tGKA"),P=n("358a"),S=n("KIfs"),A=n("K0Rh"),D=n("djAF"),E=n("6Tzw"),R=n("T6jX"),F=n("oKlP"),I=n("sIWg");o.DragFacade=(r=function(){i.CoreObject.call(this)},a.defineClass({name:"DragFacade",ctor:r,superName:"CoreObject",statics:{processBeginFormaDrag:function(e){var t,n=e.dragDelegate.dragController;if(t=a.opt(n.owner,(function(e){return e.document}))){var r=P.PagesFacade.getActivePage(t);r.publish(new d.BeginFormaDragMessage(r)),n.afterProcessBeginFormaDrag(e)}},processFormaDrag:function(e){var t=e.dragDelegate.dragController;t.beforeProcessFormaDrag(e);var n=[],o=!(1==e.dragDelegate.modifierKeys.control)&&1==e.dragDelegate.draggedFormae.length;return e.dragDelegate.forEachDraggedForma((function(t,a){n=n.concat(r.processOneFormaDrag(e,t,a,o))})),t.afterProcessFormaDrag(e),n},processOneFormaDrag:function(e,t,n,o){var i=[],l=e.drag;if(null==e.dragDelegate.dragController.owner)return i;if(null==t.controller)return i;var u=e.dragDelegate.dragController.owner,c=t.controller,p=u.selection;if(!c.moveable||u.interactionMode==s.InteractionMode.SelectionFocused&&p.selectedCount>0&&!p.isSelected(t))return i;var f,m=new h.FormaTransformChangedEvent(t);if(t.beginUpdate(m),r.doMove(l,t,n,p),o&&(i=a.clone(r.doSnap(l,t,n))),t.endUpdate(m),f=u.document){var g=P.PagesFacade.getActivePage(f);g.publish(new d.FormaDragMessage(g))}return i},doMove:function(e,t,n,r){var o,i=a.opt(t.parent,(function(e){return e.totalPlacement.inverse}))||v.Matrix2D.Identity,s=e.freeMovement(i),l=s.movement;switch(s.rise,s.run,o=t.parent instanceof c.FrameForma?t.parent.bounds.center:v._asterisk_TheoPoint_Matrix2D(t.bounds.center,n),e.dragMode){case 1:l=e.noScale(i,o);break;case 2:l=e.noRotation(i,o)}C.LegacyCoreAssert.isFalse(0==l.determinant,"movement determinant should be non-zero",void 0,"DragFacade.doMove","DragFacade.swift",104),v._asterisk_Matrix2D_Matrix2D(v._asterisk_Matrix2D_Matrix2D(v.Matrix2D.translation(o),l),v.Matrix2D.translation(F._negate_TheoPoint(o))),e.uncommitedMovement=l;var u,d=v._asterisk_Matrix2D_Matrix2D(n,l);(u=t.controller)&&u.place(d)},doSnap:function(e,t,n){var r,o,i=[];o=t.parent instanceof c.FrameForma?t.parent.bounds.center:v._asterisk_TheoPoint_Matrix2D(t.bounds.center,n);var s,u=t.bounds.locatePoint(t.placement.inverse.transformPoint(o)),d=e.dragMode==S.DragMode.NoScaleNoSkew,h=e.activePace();s=!(!(r=a.opt(y.Host.platform,(function(e){return e.isWeb})))&&null==r||!r)||h==S.DragPace.MediumPace||e.currentlySnapped,e.dragMode==S.DragMode.UniformScaleNoRotationNoSkew&&(s=!1);var f,m,g,_=a.clone(t.filterByControllerKind(p.GridController.KIND,l.FormaTraversal.NearestAncestor));if((f=a.as(a.opt(a.first(_),(function(e){return e.controller})),p.GridController))&&f.isChildSwappable(t)&&s&&(s=d),(m=T.ImageFacade.getFrameFormaForForma(t))&&(s=m.controller.floating),g=t.controller){var C=e.currentlySnapped;if(e.currentlySnapped=!1,s){var P,A=g.setSnappedPlacement(d?u:null,8/e.viewportScale,!0);(P=A.snapLines)&&(i=a.clone(P)),null!=A.movement&&(e.currentlySnapped=!0),!C&&e.currentlySnapped&&e.commitDrag()}}return i},processEndFormaDrag:function(e){var t,n,o,i=e.dragDelegate.dragController;if(o=a.as(i,u.FrameController))o.processEndFormaDrag(e);else{var s=e.drag.viewportScale,l=26/s,c=0;e.drag.pointers.length>1&&(c=24/s),E.SelectionFacade.enableAdditionalMultiSelectGestures()&&a.opt(i,(function(t){return t.owner.selection.replaceSelectionWithFormae(e.dragDelegate.draggedFormae)}));var h,p=!(!(t=a.opt(i,(function(e){return e.owner.selection.inCropMode})))&&null==t)&&t;if(e.dragDelegate.forEachDraggedForma((function(e,t){r.rescueFormaToPageBounds(e,l,c),p||!(n=a.opt(e.controller,(function(e){return e.userGroupChild})))&&null==n||!n||g.GroupFacade.updateUserGroupHierarchy(e.parent)})),h=a.opt(i,(function(e){return e.owner.document}))){var _=P.PagesFacade.getActivePage(h);_.publish(new d.EndFormaDragMessage(_))}e.dragDelegate.forEachDraggedForma((function(e,t){var n;if(n=a.opt(e.root,(function(e){return e.filterWithCallback((function(e){return e instanceof m.GroupForma&&null!=e.controller}))})))for(var r=a.iter(n);!r.done;r.next()){var o,i=r.value;(o=a.as(i.controller,f.GroupController))&&o.canClaimForma(e)&&o.claimForma(e)}else y.Host.logging.error("Error: forma has not root "+e.print())})),a.opt(i,(function(t){return t.afterProcessEndFormaDrag(e)}))}},rescueFormaToPageBounds:function(e,t,n,o){var a;if(void 0===t&&(t=50),void 0===n&&(n=50),void 0===o&&(o=new F.TheoPoint(.5,.5)),a=e.root){var i=a.bounds,s=v.Matrix2D.Identity;r.rescueToArbitraryBounds(e,i,s,t,n,o)}},rescueToArbitraryBounds:function(e,t,n,r,o,i){var s;if(void 0===i&&(i=new F.TheoPoint(.5,.5)),s=e.parent){var l=e.totalPlacement,u=e.bounds,c=r*Math.sqrt(Math.abs(n.determinant)),d=t.insetXY(c,c),h=u.maximumSpan(l);if(h<o){C.LegacyCoreAssert.isTrue(h>0,"forma's span is not positive",void 0,"DragFacade.rescueToArbitraryBounds","DragFacade.swift",269);var p=u.eval(i),f=l.transformPoint(p),m=v.Matrix2D.translation(f.multiply(-1)).concat(v.Matrix2D.uniformScaling(o/h).concat(v.Matrix2D.translation(f))),g=(y=s.totalPlacement).concat(m.concat(y.inverse));a.opt(e.controller,(function(e){return e.move(g)}))}if(l=e.totalPlacement,!I.TheoRect.PointInCommon(u,v._asterisk_Matrix2D_Matrix2D(l,n.inverse),t)){var y,_=I.TheoRect.JustTouch(u,l,d,n);g=(y=s.totalPlacement).concat(_.concat(y.inverse)),a.opt(e.controller,(function(e){return e.move(g)}))}}},getSwappableFormae:function(e){var t=a.first(e.dragDelegate.draggedFormae);a.opt(t,(function(e){return e.kind==_.ImageForma.KIND}))&&(t=a.opt(t,(function(e){return e.parent})));var n,o=e.dragDelegate.dragController,i=[];return null==t||(n=a.opt(a.opt(o,(function(e){return e.owner})),(function(e){return e.document})))&&P.PagesFacade.getActivePage(n).root.visitAll(l.FormaTraversal.PreOrder,(function(e){r.isFormaSwappable(e,n)&&i.push(e)})),i},getSwapState:function(e,t,n,o,i){var s=r.getSwapTargetForma(e,t,n),l=o;(l||null!=s)&&(l=!0,null!=i&&a.opt(a.first(e.dragDelegate.draggedFormae),(function(e){return e.placement=i})));var u,c=e.drag.pointers[0].currentLocation;if(u=a.opt(e.dragDelegate.dragController.owner,(function(e){return e.document}))){var d=P.PagesFacade.getActivePage(u).formaAtPoint(c),h=null!=d&&d.kind==A.RootForma.KIND;null==s&&h&&(s=n,l=o)}return[l,s]},getSwapTargetForma:function(e,t,n){var o=e.drag;if(1!=e.dragDelegate.draggedFormae.length)return null;var i=a.first(e.dragDelegate.draggedFormae);a.opt(i,(function(e){return e.kind==_.ImageForma.KIND}))&&(i=a.opt(i,(function(e){return e.parent})));var s=e.dragDelegate.dragController,u=a.opt(a.opt(s,(function(e){return e.owner})),(function(e){return e.document}));if(1!=o.pointers.length||null==i||null==u)return null;if(!r.isFormaSwappable(i,u))return null;var c=o.pointers[0].currentLocation,d=P.PagesFacade.getActivePage(u).pageSize;if(c.x<0||c.x>d.width||c.y<0||c.y>d.height)return null;for(var h=null,p=a.iter(t);!p.done;p.next()){var f=p.value;if(f.finalFrame.containsPoint(c)&&r.inSwappableRegion(i,f,c,u)){h=f;break}}return null==n&&a.eq(l._equality_Forma_Forma,h,i)&&(h=null),h},isFormaSwappable:function(e,t){return!(e.kind==A.RootForma.KIND||e.kind==m.GroupForma.KIND||null!=e.controller&&e.controller.moveable||!e.isGridCell()||null==r.getGridForma(e.page)||(n=a.as(e,D.ShapeForma))&&null!=R.TheoDocumentUtils.getCellBackgroundImage(n));var n},getGridForma:function(e){var t=a.clone(e.root.filterByControllerKind(p.GridController.KIND));return t.length>0?t[0]:null},inSwappableRegion:function(e,t,n,o){var a=r.getGridForma(t.page),i=0;if(null!=a&&(i=a.controller.spacing),null==e.finalFrame||null==t.finalFrame)return!1;var s=e.finalFrame.minY==t.finalFrame.maxY+i,l=e.finalFrame.maxY==t.finalFrame.minY-i,u=e.finalFrame.minX==t.finalFrame.maxX+i,c=e.finalFrame.maxX==t.finalFrame.minX-i,d=s&&u||s&&c||l&&u||l&&c,h=e.finalFrame.minY>=t.finalFrame.minY&&e.finalFrame.minY<=t.finalFrame.maxY||t.finalFrame.minY>=e.finalFrame.minY&&t.finalFrame.minY<=e.finalFrame.maxY||d,p=e.finalFrame.minX>=t.finalFrame.minX&&e.finalFrame.minX<=t.finalFrame.maxX||t.finalFrame.minX>=e.finalFrame.minX&&t.finalFrame.minX<=e.finalFrame.maxX||d,f=s&&h,m=l&&h,g=u&&p,y=c&&p;if(f||m||g||y){var _=t.finalFrame.minY,T=t.finalFrame.maxY,C=t.finalFrame.minX,v=t.finalFrame.maxX,P=T-_,S=v-C;return f&&(T-=.2*P),m&&(_+=.2*P),g&&(v-=.2*S),y&&(C+=.2*S),n.x>=C&&n.y>=_&&n.x<=v&&n.y<=T}return!0}}}),r)},wc1n:function(e,t,n){var r,o,a=t,i=n("oAGj"),s=n("Bqrm"),l=n("c3Vl"),u=n("pnSN"),c=n("cbNz"),d=n("KsJe"),h=n("Yudi"),p=n("pFDI");a.FeatureExtractorProtocol=i.defineProtocol("FeatureExtractorProtocol",{features:"Dictionary<String>",numericalFeatures:"Dictionary<String>",categoricalFeatures:"Dictionary<String>"}),a.FeatureExtractor=(r=function(){this.numericalFeatures_={},this.categoricalFeatures_={},this.complexFeatures_={},this.allFeatures_={}},i.defineClass({name:"FeatureExtractor",ctor:r,statics:{_implements:function(e){return"FeatureExtractorProtocol"==e}},props:{setFeature:function(e,t,n){n==a.FeatureType.Categorical?this.categoricalFeatures_[e]=i.as(t,"String"):n==a.FeatureType.Numerical?this.numericalFeatures_[e]=i.as(t,"Double"):this.complexFeatures_[e]=t,this.allFeatures_[e]=t},getFeature:function(e){return this.allFeatures_[e]},features:{get:function(){return this.allFeatures_}},numericalFeatures:{get:function(){return this.numericalFeatures_}},categoricalFeatures:{get:function(){return this.categoricalFeatures_}},featureForKey:function(e){return null!=this.features[e]?this.features[e]:null},numericFeatureForKey:function(e){return null!=this.numericalFeatures[e]?this.numericalFeatures[e]:null},categoricalFeatureForKey:function(e){return null!=this.categoricalFeatures_[e]?this.categoricalFeatures_[e]:null}}}),r),a.FeatureExtractorFactory=(o=function(){},i.defineClass({name:"FeatureExtractorFactory",ctor:o,statics:{getFeatureExtractor:function(e,t,n){switch(void 0===n&&(n=[]),e){case 0:return new l.DesignStyleFeatureExtractor(t,n);case 1:return new d.LockupStyleFeatureExtractor(t,n);case 2:return new c.GridStyleFeatureExtractor(i.as(t,u.GroupForma),void 0,void 0,void 0,void 0,void 0,n);case 3:return new s.DesignConstraintFeatureExtractor(t,n);case 4:return new p.ShapeFeatureExtractor(t,n);case 5:return new h.RetargetFeatureExtractor(t,!1,n);case 6:return new h.RetargetFeatureExtractor(t,!0,n);case 7:return new h.RetargetFeatureExtractor(t,!0,n,!0)}}}}),o),a.FeatureExtractorType=i.defineEnum("FeatureExtractorType",{DesignStyle:0,LockupStyle:1,GridStyle:2,DesignConstraint:3,Shape:4,Retarget:5,RetargetTemplate:6,RetargetTemplatePlusVisGroups:7}),a.FeatureType=i.defineEnum("FeatureType",{Numerical:0,Categorical:1,Complex:2})},x0BK:function(e,t,n){var r,o=t,a=n("oAGj"),i=n("ytEx"),s=n("iCxV"),l=n("8vXU"),u=n("rxGp");o.DCXNodeEncoder=(r=function(e,t){this.node_=t,i.BaseNodeEncoder.call(this,e,t)},a.defineClass({name:"DCXNodeEncoder",ctor:r,superName:"BaseNodeEncoder",statics:{_implements:function(e){return"IExportDataObject"==e}},props:{getPropertyOnNode:function(e){return a.as(this.node_.getValue(e),"AnyObject")},setPropertyOnNode:function(e,t){s.Host.logging.logForCategory(u.LogCategories.kEncode,a.toString(this.id)+" setPropertyOnNode "+e+" "+a.toString(t),l.LogLevelEnum.INFO_LEVEL),null!=t?this.node_.setValue(e,t):this.node_.removeValue(e)},createChildEncoder:function(e){var t=this.branch_.appendNode(e,null,this.node_);return new r(this.branch_,t)},findChild:function(e){return null==e?null:(t=this.branch_.getChildrenOfNode(this.node_).find((function(t){return a.as(t.getValue(i.PROPERTY_KEY_PATH),"String")==e}),this))?(s.Host.logging.logForCategory(u.LogCategories.kEncode,a.toString(this.id)+" foundChild "+t.nodeId,l.LogLevelEnum.INFO_LEVEL),new r(this.branch_,t)):i.BaseNodeEncoder.prototype.findChild.call(this,e);var t}}}),r)},x35w:function(e,t,n){var r,o=t,a=n("oAGj"),i=n("gXiO"),s=n("ascj"),l=n("FNB+"),u=n("9Lk3"),c=n("fNpk"),d=n("uxH+");o.GridFacade=(r=function(){i.CoreObject.call(this)},a.defineClass({name:"GridFacade",ctor:r,superName:"CoreObject",statics:{getPageGrid:function(e,t){var n=a.clone(e.root.filterByControllerKind(u.GridController.KIND));return n.length>0?a.as(n[0].controller,u.GridController):t?a.opt(a.as(e.root.controller,d.RootController),(function(e){return e.createGridControllerIfNone()})):null},createPaddedCollage:function(e){var t;return(t=r.getPageGrid(e,!0))?(t.setMarginAndSpacing(10,10),t.forma.root.style.colors.setColorId(s.ColorRole.FieldPrimary,"white"),t.forma):(c.LegacyCoreAssert.fail("couldn't get a grid controller",void 0,"GridFacade.createPaddedCollage","GridFacade.swift",45),null)},setPageGridParameters:function(e,t,n){var o;(o=r.getPageGrid(e,!0))?isNaN(t)||isNaN(n)?isNaN(t)?isNaN(n)||(o.margin=n):o.spacing=t:o.setMarginAndSpacing(t,n):c.LegacyCoreAssert.fail("couldn't get a grid controller",void 0,"GridFacade.setPageGridParameters","GridFacade.swift",67)},isChildSwappable:function(e){var t,n=a.clone(e.filterByControllerKind(u.GridController.KIND,l.FormaTraversal.NearestAncestor));return!!(t=a.as(a.opt(a.first(n),(function(e){return e.controller})),u.GridController))&&t.isChildSwappable(e)},swapChildren:function(e,t){var n,o=a.clone(e.filterByControllerKind(u.GridController.KIND,l.FormaTraversal.NearestAncestor));(n=a.as(a.opt(a.first(o),(function(e){return e.controller})),u.GridController))&&r.isChildSwappable(e)&&r.isChildSwappable(t)&&n.swapGridChildren(e,t)},setMoveableShift:function(e,t){e.moveableShift=t},getMoveableShift:function(e){return e.moveableShift},applyGridStyle:function(e,t,n){var o;(o=r.getPageGrid(n,!1))?o.applyStyle(e,t):c.LegacyCoreAssert.fail("couldn't get a grid controller",void 0,"GridFacade.applyGridStyle","GridFacade.swift",127)}}}),r)},x4Gy:function(e,t,n){var r,o,a,i,s,l,u,c=t,d=n("oAGj"),h=n("SpAV"),p=n("gXiO"),f=n("dJuF"),m=n("QgZx"),g=n("ZhwN"),y=n("iCxV"),_=n("fNpk"),T=n("c+uM"),C=n("Quhx"),v=n("Zifs"),P=n("a9ow"),S=n("enh0"),A=n("90dd");c.SolidColorRun=(r=function(e,t){this.attr=e,this.range=t},d.defineClass({name:"SolidColorRun",ctor:r}),r),c.SolidColorRuns=(o=function(){this.runArrays_=[],p.CoreObject.call(this)},d.defineClass({name:"SolidColorRuns",ctor:o,superName:"CoreObject",props:{apply:function(e,t){0!=t.length&&this.runArrays_.push(new c.SolidColorRun(e,t))},clear:function(){this.runArrays_.splice(0)},applyNewAlpha:function(e,t){for(var n=d.iter(e.runArrays);!n.done;n.next()){var r=n.value,o=(1-t)*r.attr.alpha+1*t,a=new v.SolidColor(r.attr.red,r.attr.green,r.attr.blue,o);this.apply(a,r.range)}},runArrays:{get:function(){return this.runArrays_}},clone:function(){for(var e=new o,t=d.iter(this.runArrays_);!t.done;t.next()){var n=t.value;e.apply(n.attr,n.range)}return e},asString:{get:function(){for(var e="",t=d.iter(this.runArrays_);!t.done;t.next()){var n=t.value;e=e+" "+n.range.asString+" "+n.attr.asString}return e}}}}),o),c.RenderRuns=(a=function(){this.fillColors=new c.SolidColorRuns,this.strokeColors=new c.SolidColorRuns,p.CoreObject.call(this)},d.defineClass({name:"RenderRuns",ctor:a,superName:"CoreObject",props:{applyColors:function(e,t,n){0!=n.length&&(this.fillColors.apply(e,n),this.strokeColors.apply(t,n))},copyColorAlpha:function(e,t){for(var n=e.fontColor,r=e.fontStrokeColor,o=d.iter(t.fillColors.runArrays);!o.done;o.next()){var a=o.value,i=new v.SolidColor(n.red,n.green,n.blue,a.attr.alpha);this.fillColors.apply(i,a.range)}for(var s=d.iter(t.strokeColors.runArrays);!s.done;s.next()){var l=s.value,u=new v.SolidColor(r.red,r.green,r.blue,l.attr.alpha);this.strokeColors.apply(u,l.range)}},setAlphaFromAnimation:function(e,t,n){this.clear(),this.fillColors.applyNewAlpha(e.fillColors,n),this.strokeColors.applyNewAlpha(e.strokeColors,n)},clear:function(){this.fillColors.clear(),this.strokeColors.clear()},clone:function(){var e=new a;return e.fillColors=this.fillColors.clone(),e.strokeColors=this.strokeColors.clone(),e},asString:{get:function(){return"Fill:"+this.fillColors.asString+" Stroke:"+this.strokeColors.asString}}}}),a),c.ContentTextModel=(i=function(){},d.defineClass({name:"ContentTextModel",ctor:i,superName:"TextModel",statics:{SCHEMA_CLASS_NAME:{get:function(){return"ContentTextModel"}},codec:{get:function(){return f.DBPropertyCodec.registerCodec(i.SCHEMA_CLASS_NAME,f.DBPropertyCodec.directObjectCodec(i.SCHEMA_CLASS_NAME))}},factory:{get:function(){return function(e,t,n,r){return i.init_866e(n,e)}}},_implements:function(e){return"IDBObject"==e||"TheoMessagePublisher"==e}},props:{init_d41d:function(){var e={text:[new P.UTF16Attribute("")]};d.super_init(this,c.TextModel,c.TextModel.prototype.init_dd5d,{},e)},init_5aae:function(e){var t={},n={};if(null!=e)t=d.clone(e.state.allProperties);else{var r=[new P.UTF16Attribute("")];n[c.TextModel.PROPERTY_UTF16_NAME]=d.clone(r)}d.super_init(this,c.TextModel,c.TextModel.prototype.init_dd5d,t,n)},init_866e:function(e,t){d.super_init(this,c.TextModel,c.TextModel.prototype.init_866e,e,t);for(var n=d.iter(c.TextModel.allAttributeNames_);!n.done;n.next()){var r=n.value;r!=c.TextModel.PROPERTY_UTF16_NAME&&d.opt(this.getProperty(r),(function(e){return e.shouldWrite=!1}))}},className:{get:function(){return i.SCHEMA_CLASS_NAME}},clone:function(){return i.init_5aae(this)},match:function(e){this.set(c.TextModel.PROPERTY_UTF16_NAME,e.get(c.TextModel.PROPERTY_UTF16_NAME)),this.publish(new c.TextModelDidInsertMessage(this,0,this.text))},isEqual:function(e){var t;return!!(t=d.as(e,c.TextModel))&&this.text==t.text}}}),i),c.TextModel=(s=function(){},l={},d.defineClass({name:"TextModel",ctor:s,superName:"PostPublishingObject",statics:{PROPERTY_UTF16_NAME:"text",PROPERTY_FONT_NAME:"font-name",PROPERTY_FONT_SIZE:"font-size",PROPERTY_FONT_COLOR:"font-color",PROPERTY_FONT_STROKE_COLOR:"font-strokecolor",PROPERTY_FONT_STROKE_WIDTH:"font-strokewidth",PROPERTY_TEXT_LOOK:"text-look",PROPERTY_TRACKING:"tracking",SCHEMA_CLASS_NAME:{get:function(){return"TextModel"}},codec:{get:function(){return f.DBPropertyCodec.registerCodec(s.SCHEMA_CLASS_NAME,f.DBPropertyCodec.directObjectCodec(s.SCHEMA_CLASS_NAME))}},factory:{get:function(){return function(e,t,n,r){return s.init_866e(n,e)}}},defaultText:{get:function(){return null==s.defaultText_&&(s.defaultText_=new P.UTF16Attribute("")),s.defaultText_}},defaultFontColor:{get:function(){return null==s.defaultFontColor_&&(s.defaultFontColor_=new P.FontColorAttribute(y.Host.textModelUtils.defaultColor())),s.defaultFontColor_}},defaultFontName:{get:function(){return null==s.defaultFontName_&&(s.defaultFontName_=new P.FontDescriptorAttribute(y.Host.textModelUtils.defaultFont())),s.defaultFontName_}},defaultFontSize:{get:function(){return null==s.defaultFontSize_&&(s.defaultFontSize_=new P.FontSizeAttribute(y.Host.textModelUtils.defaultFontSize())),s.defaultFontSize_}},defaultFontStrokeColor:{get:function(){return null==s.defaultFontStrokeColor_&&(s.defaultFontStrokeColor_=new P.FontStrokeColorAttribute(y.Host.textModelUtils.defaultColor())),s.defaultFontStrokeColor_}},defaultFontStrokeWidth:{get:function(){return null==s.defaultFontStrokeWidth_&&(s.defaultFontStrokeWidth_=new P.FontStrokeWidthAttribute(S.TextForma.STROKEWIDTH_ZERO)),s.defaultFontStrokeWidth_}},defaultTextLook:{get:function(){return null==s.defaultTextLook_&&(s.defaultTextLook_=new P.TextLookAttribute(T.LockupTextLook.Fill)),s.defaultTextLook_}},defaultTracking:{get:function(){return null==s.defaultTracking_&&(s.defaultTracking_=new P.TrackingAttribute(S.TextForma.TRACKING_ZERO)),s.defaultTracking_}},allAttributeNames_:{get:function(){return void 0===l.allAttributeNames_&&(l.allAttributeNames_=[s.PROPERTY_UTF16_NAME,s.PROPERTY_FONT_COLOR,s.PROPERTY_FONT_NAME,s.PROPERTY_FONT_SIZE,s.PROPERTY_FONT_STROKE_COLOR,s.PROPERTY_FONT_STROKE_WIDTH,s.PROPERTY_TEXT_LOOK,s.PROPERTY_TRACKING]),l.allAttributeNames_}},defaultAttribute:function(e){switch(e){case"text":return s.defaultText;case"font-color":return s.defaultFontColor;case"font-name":return s.defaultFontName;case"font-size":return s.defaultFontSize;case"font-strokecolor":return s.defaultFontStrokeColor;case"font-strokewidth":return s.defaultFontStrokeWidth;case"text-look":return s.defaultTextLook;case"tracking":return s.defaultTracking;default:return null}},_implements:function(e){return"IDBObject"==e||"TheoMessagePublisher"==e}},props:{init_d41d:function(){d.super_init(this,C.PostPublishingObject,C.PostPublishingObject.prototype.init_dd5d,{},{})},init_dd5d:function(e,t){d.super_init(this,C.PostPublishingObject,C.PostPublishingObject.prototype.init_dd5d,e,t)},init_36cd:function(e){d.super_init(this,C.PostPublishingObject,C.PostPublishingObject.prototype.init_dd5d,d.opt(e,(function(e){return e.state.allProperties}))||{},{})},init_866e:function(e,t){d.super_init(this,C.PostPublishingObject,C.PostPublishingObject.prototype.init_866e,e,t)},className:{get:function(){return s.SCHEMA_CLASS_NAME}},textAttr:{get:function(){var e;return(e=d.as(d.opt(d.as(this.get(s.PROPERTY_UTF16_NAME),["Array",P.TextAttribute]),(function(e){return e[0]})),P.UTF16Attribute))||null!=e?e:s.defaultText},set:function(e){this.set(s.PROPERTY_UTF16_NAME,[e])}},fontColor:{get:function(){var e;return(e=d.as(this.get(s.PROPERTY_FONT_COLOR),["Array",P.TextAttribute]))?d.as(d.first(e),P.FontColorAttribute):null}},fontName:{get:function(){var e;return(e=d.as(this.get(s.PROPERTY_FONT_NAME),["Array",P.TextAttribute]))?d.as(d.first(e),P.FontDescriptorAttribute):null}},fontSize:{get:function(){var e;return(e=d.as(this.get(s.PROPERTY_FONT_SIZE),["Array",P.TextAttribute]))?d.as(d.first(e),P.FontSizeAttribute):null}},fontStrokeColor:{get:function(){var e;return(e=d.as(this.get(s.PROPERTY_FONT_STROKE_COLOR),["Array",P.TextAttribute]))?d.as(d.first(e),P.FontStrokeColorAttribute):null}},fontStrokeWidth:{get:function(){var e;return(e=d.as(this.get(s.PROPERTY_FONT_STROKE_WIDTH),["Array",P.TextAttribute]))?d.as(d.first(e),P.FontStrokeWidthAttribute):null}},textLook:{get:function(){var e;return(e=d.as(this.get(s.PROPERTY_TEXT_LOOK),["Array",P.TextAttribute]))?d.as(d.first(e),P.TextLookAttribute):null}},tracking:{get:function(){var e;return(e=d.as(this.get(s.PROPERTY_TRACKING),["Array",P.TextAttribute]))?d.as(d.first(e),P.TrackingAttribute):null}},description:{get:function(){for(var e,t="TextModel: ",n=d.iter(s.allAttributeNames_);!n.done;n.next()){var r=n.value;t+=r+": "+((e=d.opt(d.first(d.as(this.get(r),["Array",P.TextAttribute])),(function(e){return e.description})))||null!=e?e:"<unset>")+" | "}return t}},runArraysByAttrName:{get:function(){for(var e={},t=d.iter(s.allAttributeNames_);!t.done;t.next()){var n=t.value,r=d.clone(d.as(this.get(n),["Array",P.TextAttribute]));if(null!=r)e[n]=d.clone(r);else{var o=s.defaultAttribute(n);null!=o&&(e[n]=[o])}}return e}},text:{get:function(){return this.textAttr.value},set:function(e){e!=this.textAttr.value&&(this.textAttr=new P.UTF16Attribute(e))}},isEqual:function(e){var t;if(t=d.as(e,s)){var n=d.clone(this.runArraysByAttrName),r=d.clone(t.runArraysByAttrName);if(d.count(r)!=d.count(n))return!1;for(var o=d.iter(n);!o.done;o.next()){var a,i=o.key,l=o.value;if(!(a=r[i]))return!1;if(a[0]!=l[0])return!1}return!0}return!1},hash:{get:function(){return d.hashValue(this.text)}},setAttr:function(e,t){var n;if(null!=e)if(t!=s.PROPERTY_UTF16_NAME)if(t==s.PROPERTY_FONT_NAME)(n=d.as(e,m.FontDescriptor))&&(d.eq(m._equality_FontDescriptor_FontDescriptor,n,d.opt(this.fontName,(function(e){return e.value})))||this.set(t,[new P.FontDescriptorAttribute(n)]));else if(t==s.PROPERTY_FONT_SIZE){var r;if(null!=(r=d.as(e,"Double"))){if(r==d.opt(this.fontSize,(function(e){return e.value})))return;if(0==r){_.LegacyCoreAssert.fail("attempted to set font size to 0.0",void 0,"TextModel.setAttr","TextModel.swift",476);var o=new P.FontSizeAttribute(1);this.set(t,[o])}else this.set(t,[new P.FontSizeAttribute(r)])}}else if(t==s.PROPERTY_FONT_COLOR)(a=d.as(e,v.SolidColor))&&(d.eq(v._equality_SolidColor_SolidColor,a,d.opt(this.fontColor,(function(e){return e.value})))||this.set(t,[new P.FontColorAttribute(a)]));else if(t==s.PROPERTY_FONT_STROKE_COLOR){var a;(a=d.as(e,v.SolidColor))&&(d.eq(v._equality_SolidColor_SolidColor,a,d.opt(this.fontStrokeColor,(function(e){return e.value})))||this.set(t,[new P.FontStrokeColorAttribute(a)]))}else if(t==s.PROPERTY_FONT_STROKE_WIDTH){var i;null!=(i=d.as(e,"Double"))&&i!=d.opt(this.fontStrokeWidth,(function(e){return e.value}))&&this.set(t,[new P.FontStrokeWidthAttribute(i)])}else if(t==s.PROPERTY_TEXT_LOOK){var l;null!=(l=d.as(e,T.LockupTextLook))&&l!=d.opt(this.textLook,(function(e){return e.value}))&&this.set(t,[new P.TextLookAttribute(l)])}else if(t==s.PROPERTY_TRACKING){var u;null!=(u=d.as(e,"Double"))&&u!=d.opt(this.tracking,(function(e){return e.value}))&&this.set(t,[new P.TrackingAttribute(u)])}else h.CoreAssert.fail("Missing setAttr code for "+t,void 0,"TextModel.setAttr","TextModel.swift",521);else h.CoreAssert.fail("Attempted to set text through apply!",void 0,"TextModel.setAttr","TextModel.swift",459);else null!=this.get(t)&&this.set(t,null)},match:function(e){for(var t=d.iter(s.allAttributeNames_);!t.done;t.next()){var n=t.value;this.set(n,e.get(n))}this.publish(new c.TextModelDidInsertMessage(this,0,this.text))},clone:function(){return this.fork(g.GUIDUtils.makeGUID())},insertTextUsingSubstring:function(e){var t=e+this.text.substr(0);this.text=t,this.publish(new c.TextModelDidInsertMessage(this,0,e))},replaceText:function(e){this.text=e,this.publish(new c.TextModelDidInsertMessage(this,0,e))}}}),s),c.TextModelDidInsertMessage=(u=function e(t,n,r){this.model=t,this.index=n,this.text=r,A.TheoMessage.call(this,e.TYPE,t)},d.defineClass({name:"TextModelDidInsertMessage",ctor:u,superName:"TheoMessage",statics:{TYPE:{get:function(){return"TextModelDidInsertMessage"}}}}),u)},y8UA:function(e,t,n){var r=t,o=n("oAGj");r.DocumentEvaluationScore=o.defineProtocol("DocumentEvaluationScore",{evaluateDocument:"() -> Void",reject:"() -> Boolean",print:"() -> String",evalScore:"() -> Double"})},yGNn:function(e,t,n){var r,o,a=t,i=n("oAGj"),s=n("gXiO"),l=n("ZhwN"),u=n("iCxV"),c=n("fNpk");a.CorePromise=(r=function(e,t,n){this.chainingFn=null,this.finishFns=[],this.dependentPromises=[],this.finalized=!1,this.resolved=!1,this.finalValue=null,void 0===t&&(t=null),void 0===n&&(n=null);var r,o=this;if(this.guid=l.GUIDUtils.makeGUID(),s.CoreObject.call(this),null!=(r=e))i.opt(u.Host.exception,(function(e){return e.executeWithExceptionHandler((function(){return r((function(e){o.finalized?c.LegacyCoreAssert.fail("can't resolve a resolved/rejected promise",void 0,"CorePromise.init","CorePromise.swift",61):o.finalize(e,!0)}),(function(e){o.finalized?c.LegacyCoreAssert.fail("can't reject a resolved/rejected promise",void 0,"CorePromise.init","CorePromise.swift",68):o.finalize(e,!1)}))}),(function(e){return o.finalize(e,!1)}))}));else if(null!=t||null!=n){var a=this;this.chainingFn=function(e,r){var o;(o=a)&&i.opt(u.Host.exception,(function(a){return a.executeWithExceptionHandler((function(){if(r)if(null!=t){var a=t(e);o.handleChainResult(a,!0)}else o.finalize(e,!0);else null!=n?(a=n(e),o.handleChainResult(a,!0)):o.finalize(e,!1)}),(function(e){return o.finalize(e,!1)}))}))}}else c.LegacyCoreAssert.fail("no origin, resolve, or reject specified; this promise is useless",void 0,"CorePromise.init","CorePromise.swift",113)},i.defineClass({name:"CorePromise",ctor:r,superName:"CoreObject",statics:{make:function(e){return new r(e)},resolve:function(e){return new r((function(t,n){return t(e)}))},reject:function(e){return new r((function(t,n){return n(e)}))},deferred:function(){return new a.DeferredPromise},all:function(e){for(var t=r.resolve(null),n=i.repeat(null,e.length),o=function(e,t){return function(r){return e.then((function(e){return n[t]=e,e}))}},a=i.iter(i.range(0,e.length,!1));!a.done;a.next()){var s=a.value,l=e[s];t=t.then(o(l,s))}return t.then((function(e){return n}))},fromCoreError:function(e){return null==e?r.resolve(null):r.reject(e)}},props:{finalize:function(e,t){this.finalized=!0,this.finalValue=e,this.resolved=t,c.LegacyCoreAssert.isFalse(e instanceof r,"Should never finalize with a promise as value",void 0,"CorePromise.finalize","CorePromise.swift",171);for(var n=i.iter(this.dependentPromises);!n.done;n.next())n.value.handleUpstreamFinal(this);for(var o=i.iter(this.finishFns);!o.done;o.next())(0,o.value)(e,t)},handleUpstreamFinal:function(e){var t;null!=(t=this.chainingFn)?(t(e.finalValue,e.resolved),this.chainingFn=null):c.LegacyCoreAssert.fail("why is an origin promise being called by an upstream promise?",void 0,"CorePromise.handleUpstreamFinal","CorePromise.swift",193)},handleChainResult:function(e,t){var n,o=this;(n=i.as(e,r))?n.chainPromise((function(e){return o.handleChainResult(e,!0)}),(function(e){return o.handleChainResult(e,!1)})):this.finalize(e,t)},chainPromise:function(e,t){var n=new r(null,e,t);return this.dependentPromises.push(n),this.finalized&&n.handleUpstreamFinal(this),n},then:function(e){return this.chainPromise(e,null)},fail:function(e){return this.chainPromise(null,e)},thenReturn:function(e){return this.then((function(t){return e}))},finished:function(e){this.finalized?e(this.finalValue,this.resolved):this.finishFns.push(e)}}}),r),a.DeferredPromise=(o=function(){this.resolver=null,this.rejector=null,this.promise_=null;var e=this;s.CoreObject.call(this),this.promise_=new a.CorePromise((function(t,n){e.resolver=t,e.rejector=n}))},i.defineClass({name:"DeferredPromise",ctor:o,superName:"CoreObject",props:{promise:{get:function(){return this.promise_}},resolve:function(e){this.promise.finalized||i.opt(this.resolver,(function(t){return t(e)}))},reject:function(e){this.promise.finalized||i.opt(this.rejector,(function(t){return t(e)}))}}}),o)},ylxa:function(e,t,n){var r,o,a=t,i=n("oAGj"),s=n("fWxZ"),l=n("fNpk"),u=n("1NAc");a.PageExportFormat=i.defineEnum("PageExportFormat",{PIXELS:0,MILLIMETERS:1,INCHES:2}),a.describePageExportFormat=function(e){switch(e){case 0:return"pixels";case 1:return"millimeters";case 2:return"inches"}},a.FormaPageExportData=(r=function(e,t,n){void 0===n&&(n=null),this.dimensions_=e,this.format_=t,this.ppi_=n,null!=n||t!=a.PageExportFormat.MILLIMETERS&&t!=a.PageExportFormat.INCHES||l.LegacyCoreAssert.fail("Must specify ppi for mm or inches",void 0,"FormaPageExportData.init","FormaPageExportData.swift",49)},o={},i.defineClass({name:"FormaPageExportData",ctor:r,superName:"CoreObject",statics:{PROPERTY_DIMENSIONS:"dimensions",PROPERTY_FORMAT:"format",PROPERTY_PPI:"ppi",MM_TO_INCHES:{get:function(){return void 0===o.MM_TO_INCHES&&(o.MM_TO_INCHES=1/25.4),o.MM_TO_INCHES}},POINTS_PER_INCH:72,DEFAULT_PPI:300,exportPixels:function(e){return new r(e,a.PageExportFormat.PIXELS,null)},exportInches:function(e,t){return new r(e,a.PageExportFormat.INCHES,t)},exportMillimeters:function(e,t){return new r(e,a.PageExportFormat.MILLIMETERS,t)},decodeJson:function(e){var t;if(null==e)return null;var n=i.as(e,["Dictionary","String","Any"]);if(null==n)return l.LegacyCoreAssert.fail("FormaPageExportData.decodeJSON : object passed isn't a dictionary",void 0,"FormaPageExportData.decodeJson","FormaPageExportData.swift",128),null;var o,s,c,d=null,h=a.PageExportFormat.PIXELS,p=u.TheoSize.Zero;return(o=u.TheoSize.decodeJson(i.as(n[r.PROPERTY_DIMENSIONS],"AnyObject")))&&(p=o),null!=(s=i.as(n[r.PROPERTY_FORMAT],"Int"))?h=(t=a.PageExportFormat.toCaseValue(s))||null!=t?t:a.PageExportFormat.PIXELS:l.LegacyCoreAssert.fail("Must have format encoded",void 0,"FormaPageExportData.decodeJson","FormaPageExportData.swift",144),null!=(c=i.as(n[r.PROPERTY_PPI],"Double"))&&(d=c),new r(p,h,d)}},props:{dimensions:{get:function(){return this.dimensions_}},format:{get:function(){return this.format_}},PPI:{get:function(){return null==this.ppi?s.FormaPage.DEFAULT_CUSTOM_SIZE_PPI:this.ppi_}},ppi:{get:function(){return this.ppi_}},pixelDimensions:{get:function(){return this.format_==a.PageExportFormat.MILLIMETERS?this.dimensions_.multiply(r.MM_TO_INCHES*this.ppi_):this.format_==a.PageExportFormat.INCHES?this.dimensions_.multiply(this.ppi_):(l.LegacyCoreAssert.isTrue(this.format_==a.PageExportFormat.PIXELS,"unexpected page export format",{format:this.format_},"FormaPageExportData","FormaPageExportData.swift",87),this.dimensions_)}},pointDimensions:{get:function(){return this.format_==a.PageExportFormat.MILLIMETERS?this.dimensions_.multiply(r.MM_TO_INCHES*r.POINTS_PER_INCH):this.format_==a.PageExportFormat.INCHES?this.dimensions_.multiply(r.POINTS_PER_INCH):(l.LegacyCoreAssert.isTrue(this.format_==a.PageExportFormat.PIXELS,"unexpected page export format",{format:this.format_},"FormaPageExportData","FormaPageExportData.swift",104),this.dimensions_)}},encodeJson:function(){var e={};return e[r.PROPERTY_DIMENSIONS]=this.dimensions_.encodeJson(),e[r.PROPERTY_FORMAT]=this.format_,null!=this.ppi_&&(e[r.PROPERTY_PPI]=this.ppi_),e},isEqual:function(e){var t;return!!(t=i.as(e,r))&&this.format==t.format&&this.dimensions.width==t.dimensions.width&&this.dimensions.height==t.dimensions.height&&this.PPI==t.PPI},asString:{get:function(){var e="";switch(this.format){case 2:e="in";break;case 1:e="mm"}var t=Math.round(10*this.dimensions.width)/10,n=Math.round(10*this.dimensions.height)/10;return i.replaceAll(t+" x "+n+" "+e,".0","").trim()}}}}),r)},ytEx:function(e,t,n){var r,o=t,a=n("oAGj"),i=n("gXiO"),s=n("3OP7"),l=n("iCxV"),u=n("fNpk");o.PROPERTY_KEY_ID="id",o.PROPERTY_KEY_TYPE="type",o.PROPERTY_KEY_NAME="name",o.PROPERTY_KEY_PATH="path",o.PROPERTY_KEY_MIMETYPE="mimeType",o.PROPERTY_KEY_ETAG="etag",o.PROPERTY_KEY_URL="url",o.PROPERTY_KEY_RELATIONSHIP="rel",o.ASSETS_PATH="assets",o.BaseNodeEncoder=(r=function(e,t){this.childNodeEncoders_=[],this.branch_=e,this.componentNode_=t,i.CoreObject.call(this)},a.defineClass({name:"BaseNodeEncoder",ctor:r,superName:"CoreObject",statics:{_implements:function(e){return"IExportDataObject"==e}},props:{prepareCompositeForSave:function(e){u.LegacyCoreAssert.isTrue(null==this.stashNode_,"creating a stashNode when we already have one?",void 0,"BaseNodeEncoder.prepareCompositeForSave","BaseNodeEncoder.swift",35),this.stashNode_=this.createTempNode(this.branch_.root);for(var t=a.iter(this.branch_.allComponents);!t.done;t.next()){var n=t.value;null!=n.relationship&&e.includes(n.relationship)||this.branch_.moveComponent(n,this.createTempNode(this.stashNode_))}for(var r=a.iter(this.branch_.getChildrenOfNode(this.branch_.root));!r.done;r.next()){var i=r.value,s=a.as(i.getValue(o.PROPERTY_KEY_RELATIONSHIP),"String");null!=s&&e.includes(s)||i.nodeId!=this.stashNode_.nodeId&&i.path!=o.ASSETS_PATH&&this.branch_.removeNode(i)}},createTempNode:function(e){var t=a.opt(l.Host.resourceUtils,(function(e){return e.makeGUID()}));return this.branch_.appendNode(t,t,e)},discardStashedComponents:function(){this.branch_.removeNode(this.stashNode_)},getPropertyOnNode:function(e){return u.LegacyCoreAssert.fail("must be overridden",void 0,"BaseNodeEncoder.getPropertyOnNode","BaseNodeEncoder.swift",80),null},setPropertyOnNode:function(e,t){u.LegacyCoreAssert.fail("must be overridden",void 0,"BaseNodeEncoder.setPropertyOnNode","BaseNodeEncoder.swift",85)},id:{get:function(){return a.as(this.getPropertyOnNode(o.PROPERTY_KEY_ID),"String")}},path:{get:function(){return a.as(this.getPropertyOnNode(o.PROPERTY_KEY_PATH),"String")}},setName:function(e){this.setPropertyOnNode(o.PROPERTY_KEY_NAME,a.as(e,"AnyObject"))},setType:function(e){this.setPropertyOnNode(o.PROPERTY_KEY_TYPE,a.as(e,"AnyObject"))},setPath:function(e){this.setPropertyOnNode(o.PROPERTY_KEY_PATH,a.as(e,"AnyObject"))},setProperty:function(e,t){var n=s.DocumentPersistenceFactory.namespacedPropertyName(e);this.setPropertyOnNode(n,t)},setOptionalStringProperty:function(e,t){this.setProperty(e,a.as(t,"AnyObject"))},setStringProperty:function(e,t){this.setProperty(e,a.as(t,"AnyObject"))},setNumberProperty:function(e,t){u.LegacyCoreAssert.isFalse(isNaN(t),"Can't set NaN for prop.",{property:e},"BaseNodeEncoder.setNumberProperty","BaseNodeEncoder.swift",122),this.setProperty(e,a.as(t,"AnyObject"))},setIntProperty:function(e,t){this.setProperty(e,a.as(t,"AnyObject"))},setBooleanProperty:function(e,t){this.setProperty(e,a.as(t,"AnyObject"))},setOptionalBooleanProperty:function(e,t){this.setProperty(e,a.as(t,"AnyObject"))},createChildEncoder:function(e){return u.LegacyCoreAssert.fail("must be overridden",void 0,"BaseNodeEncoder.createChildEncoder","BaseNodeEncoder.swift",139),new r(this.branch_,this.componentNode_)},findChild:function(e){return null==e?null:this.childNodeEncoders_.find((function(t){return t.path==e}),this)},appendChild:function(e){var t=this.createChildEncoder(e);return this.childNodeEncoders_.push(t),t},appendComponent:function(e,t,n){var r,o=a.opt(l.Host.pathUtils,(function(e){return e.absolutePathFromURL(t)})),i=e,s=a.clone(a.opt(a.opt(l.Host.pathUtils,(function(e){return e.lastPathComponentFromURL(t)})),(function(e){return e.split(".")})));if(null!=s&&s.length>1){var u=a.last(s);a.isEmpty(u)||(i+="."+u)}if(r=this.branch_.getComponentWithId(e)){if(this.nodeHasComponentWithPath(r.path)||a.opt(r.path,(function(e){return 1==e.includes("/")}))){var c=r.mutableCopy;c.path=i,r=this.branch_.updateComponent(c,null,!1)}this.branch_.moveComponent(r,this.componentNode_)}else a.opt(o,(function(e){return 1==e.startsWith("shapes/")}))||this.branch_.addComponent(e,e,n,null,i,this.componentNode_,o,!0,null)},nodeHasComponentWithPath:function(e){if(null!=e)for(var t=a.iter(this.branch_.getComponentsOfNode(this.componentNode_));!t.done;t.next())if(t.value.path==e)return!0;return!1},setCompositeID:function(e){},setDocumentSize:function(e,t){},setManifestProperty:function(e,t,n){n?this.getManifestEncoder().setProperty(e,t):this.getManifestEncoder().setPropertyOnNode(e,t)},getManifestEncoder:function(){return this},finish:function(){for(var e=a.iter(this.childNodeEncoders_);!e.done;e.next())e.value.finish()}}}),r)},yumk:function(e,t,n){var r,o,a=t,i=n("oAGj"),s=n("iCxV"),l=n("SDdr");a.ImageFilterFactory=(r=function(){this.lookup_={},this.lookup_[l.ImageFilter.KIND]=function(){return l.ImageFilter.createDefault()},this.lookup_[l.AlphaBlendFilter.KIND]=function(){return l.AlphaBlendFilter.createDefault()},this.lookup_[l.CompositeFilter.KIND]=function(){return l.CompositeFilter.createDefault()}},o={},i.defineClass({name:"ImageFilterFactory",ctor:r,superName:"CoreObject",statics:{instance:{get:function(){return void 0===o.instance&&(o.instance=new r),o.instance}}},props:{create:function(e){var t;return null!=(t=this.lookup_[e])?t():(i.opt(s.Host.logging,(function(t){return t.warning("no constructor for filter kind = "+e)})),null)}}}),r)},"zW/s":function(e,t,n){var r,o,a=t,i=n("oAGj"),s=n("7Pku"),l=n("w/+j"),u=n("fNpk"),c=n("Ird5"),d=n("jfma"),h=n("yjxF"),p=n("Aj79"),f=n("ZA1K"),m=n("WWR6");a.VectorFormaToPGMMapper=(r=function e(){s.FormaToPGMMapper.call(this,e.FORMA_KIND)},o={},i.defineClass({name:"VectorFormaToPGMMapper",ctor:r,superName:"FormaToPGMMapper",statics:{FORMA_KIND:{get:function(){return void 0===o.FORMA_KIND&&(o.FORMA_KIND=m.VectorForma.KIND),o.FORMA_KIND}},instance:{get:function(){return void 0===o.instance&&(o.instance=new r),o.instance}},createMapper:function(e){return r.instance}},props:{makePGMRef:function(e,t,n,r){var o;return(o=i.as(e,m.VectorForma))?l.FormaToPGMUtils.applyAnimations(t,e,new p.PGMReference(new f.PGMSVG(o.formaID,new h.PGMNodeMetadata(o.formaID,"VectorForma"),c.PGMAnimationList.EMPTY,o.bounds,o.contentNode.url),new d.PGMCompositingParams(o.placement,o.style.opacity))):(u.LegacyCoreAssert.fail("VectorFormaToPGMMapper called for something that's not a VectorForma",void 0,"VectorFormaToPGMMapper.makePGMRef","VectorFormaToPGMMapper.swift",49),null)}}}),r)},zjY7:function(e,t,n){var r,o,a,i,s,l=t,u=n("oAGj"),c=n("cZuM"),d=n("gXiO"),h=n("FNB+"),p=n("6ZWm"),f=n("pnSN"),m=n("ZhwN"),g=n("iCxV"),y=n("fNpk"),_=n("c+uM"),T=n("uj1m"),C=n("3DEm"),v=n("txj3"),P=n("7Ta2"),S=n("djAF"),A=n("T6jX"),D=n("8t9B"),E=n("ThKb"),R=n("oKlP"),F=n("sIWg"),I=n("qSCS");l.PairingFeatures=u.defineEnum("PairingFeatures",{BOUNDARY_DISTANCE:"boundary_distance",CENTER_DISTANCE:"center_distance",X_ALIGNED:"x_aligned",Y_ALIGNED:"y_aligned",LEFT_ALIGNED:"left_aligned",CENTER_X_ALIGNED:"center_x_aligned",RIGHT_ALIGNED:"right_aligned",TOP_ALIGNED:"top_aligned",CENTER_Y_ALIGNED:"center_y_aligned",BOTTOM_ALIGNED:"bottom_aligned",HEIGHT_DIFF:"height_diff",WIDTH_DIFF:"width_diff",AREA_DIFF:"area_diff",CONTAINMENT_MISMATCH:"containment_mismatch",INTERSECTION:"intersection",CONTAINMENT_CHILD_COUNT:"containment_child_count",CHILD_COUNT_MATCH:"child_count_match",UNION_POSITION_X:"union_position_x",UNION_POSITION_Y:"union_position_y",UNION_NUM_NON_INTERSECT:"union_num_non_intersect",UNION_AREA:"union_area",UNION_EMPTY_SPACE:"union_empty_space",OUT_OF_BOUNDS_MISMATCH:"out_of_bounds_mismatch",OPACITY_DIFFERENCE:"opacity_difference",COLOR_DISTANCE:"color_distance",FONT_SIZE_DISTANCE:"font_size_distance",POSITION_X_FIRST:"position_x_first",POSITION_Y_FIRST:"position_y_first",POSITION_X_SECOND:"position_x_second",POSITION_Y_SECOND:"position_y_second",AREA_FIRST:"area_first",AREA_SECOND:"area_second",IS_SHAPE_FIRST:"is_shape_first",IS_TEXT_FIRST:"is_text_first",IS_IMAGE_FIRST:"is_image_first",IS_SHAPE_SECOND:"is_shape_second",IS_TEXT_SECOND:"is_text_second",IS_IMAGE_SECOND:"is_image_second",TYPE_MISMATCH:"type_mismatch"}),l.GroupLayoutStrategy=u.defineEnum("GroupLayoutStrategy",{Default:0,VerticalFlow:1,HorizontalFlow:2}),l.VisualNode=(r=function(){this.origNode=null,this.constraintLeft=!1,this.constraintRight=!1,this.constraintWidth=!1,this.constraintTop=!1,this.constraintBottom=!1,this.constraintHeight=!1,this.bgConstraint=!1,this.id=m.GUIDUtils.makeGUID()},u.defineClass({name:"VisualNode",ctor:r,superName:"CoreObject",props:{frame:{get:function(){return this.frame_},set:function(e){null==this.frame_&&(this.initFrame=e),this.frame_=e}},root:{get:function(){for(var e=this.parent;null!=e&&null!=e.parent;)e=e.parent;return e}},shortID:{get:function(){return this.id.substr(0,4)}},maintainAspectRatio:{get:function(){return!1}},clone:function(){var e=new r;return e.frame=this.frame,e.initFrame=this.initFrame,e.origNode=this,e.bgConstraint=this.bgConstraint,e},description:{get:function(){return"???: "+this.shortID+" "+this.frameString}},frameString:{get:function(){var e=u.toString(Math.round(this.frame.minX)),t=u.toString(Math.round(this.frame.maxX)),n=u.toString(Math.round(this.frame.minY)),r=u.toString(Math.round(this.frame.maxY));return" x: "+e+" "+t+" ("+u.toString(Math.round(this.frame.width))+"), y:"+n+" "+r+" ("+u.toString(Math.round(this.frame.height))+")"}},resetConstraints:function(e){void 0===e&&(e=null),null!=e&&e||this.resetXConstraints(),(null==e||e)&&this.resetYConstraints()},resetXConstraints:function(){this.constraintLeft=!1,this.constraintRight=!1,this.constraintWidth=!1},resetYConstraints:function(){this.constraintTop=!1,this.constraintBottom=!1,this.constraintHeight=!1},print:function(){for(var e="",t=[this];t.length>0;){var n,r=t[0];t.splice(0,1),(n=u.as(r,l.VisualNodeGroup))&&(t=n.children.concat(t));for(var o=r.parent;null!=o;)o=u.opt(o,(function(e){return e.parent})),e+="\t";e+=r.description+"\n"}return e}}}),r),l.VisualNodeLeaf=(o=function(e,t){this.hasForegroundRole_=null,this.hasBackgroundRole_=null,void 0===t&&(t=null),this.forma=e,l.VisualNode.call(this),this.frame=null!=t?t:e.frame},u.defineClass({name:"VisualNodeLeaf",ctor:o,superName:"VisualNode",props:{maintainAspectRatio:{get:function(){return this.forma.controller.maintainAspectRatio}},clone:function(){var e=new o(this.forma,this.frame);return e.origNode=this,e},hasForegroundRole:{get:function(){if(null!=this.hasForegroundRole_)return this.hasForegroundRole_;if(this.forma.isTypeLockup())return this.hasForegroundRole_=!0,!0;var e=u.clone((new P.RoleSuggester).getRole(this.forma));return e.role!=P.InferredRoleType.Seperator&&e.role!=P.InferredRoleType.GraphicContent||!this.forma.isTypeLockup()?(this.hasForegroundRole_=!1,!1):(this.hasForegroundRole_=!0,!0)}},hasBackgroundRole:{get:function(){if(null!=this.hasBackgroundRole_)return this.hasBackgroundRole_;var e=u.clone((new P.RoleSuggester).getRole(this.forma));return e.role==P.InferredRoleType.Background&&e.confidence>.5||e.secondaryRole==P.InferredRoleType.Background&&e.secondaryConfidence>.5?(this.hasBackgroundRole_=!0,!0):(this.hasBackgroundRole_=!1,!1)}},description:{get:function(){var e,t,n="";if(e=u.as(this.forma.controller,D.TypeLockupController)){var r=u.replaceAll(e.text.substr(0,6),"\n","");n="T: "+this.shortID+" "+r}else if(t=u.as(this.forma,S.ShapeForma)){var o,a;n="S: "+this.shortID+" ",(o=u.opt(u.as(t.contentNode,I.URLBasedContentNode),(function(e){return e.mediaMetadata})))&&null!=(a=o.searchTerm)&&(n+=a)}else n=this.forma.controller instanceof p.FrameController?"I: "+this.shortID+" ":"???: "+this.shortID+" "+this.forma.controller.kind;return n+=this.frameString}}}}),o),l.VisualNodeGroup=(a=function(e,t){if(this.alignments=[],void 0===t&&(t=null),this.children=u.clone(e),this.maintainAspectRatio_=!1,l.VisualNode.call(this),null==t){if(this.frame=F.TheoRect.Zero,e.length>0){this.frame=e[0].frame;for(var n=u.iter(e);!n.done;n.next()){var r=n.value;this.frame=this.frame.unionWith(r.frame)}}}else this.frame=t;for(var o=u.iter(e);!o.done;o.next()){var a;(a=(r=o.value).parent)&&a.removeChildren([r]),r.parent=this}this.setMaintainAspectRatio()},u.defineClass({name:"VisualNodeGroup",ctor:a,superName:"VisualNode",statics:{extractNodeInfo:function(e){var t,n,r={};if(t=u.as(e,a)){r.type=u.as("Group","AnyObject"),r.frame=t.frame.encodeJson(),r.layoutStrategy=u.as(t.layoutStrategyString,"AnyObject");for(var o=[],i=u.iter(t.children);!i.done;i.next()){var s=i.value;o.push(a.extractNodeInfo(s))}r.children=u.as(o,"AnyObject")}return(n=u.as(e,l.VisualNodeLeaf))&&(r.type=u.as(n.forma.controller.kind,"AnyObject"),r.formaId=u.as(n.forma.formaID,"AnyObject"),r.frame=n.forma.finalFrame.encodeJson(),r.role=u.as((new P.RoleSuggester).getRole(n.forma).role,"AnyObject")),r}},props:{maintainAspectRatio:{get:function(){return this.maintainAspectRatio_},set:function(e){this.maintainAspectRatio_=e}},layoutStrategyString:{get:function(){var e;if(null!=(e=this.layoutStrategy)){if(e==l.GroupLayoutStrategy.Default)return"default";if(e==l.GroupLayoutStrategy.VerticalFlow)return"vertical";if(e==l.GroupLayoutStrategy.HorizontalFlow)return"horizontal"}return"None"}},setMaintainAspectRatio:function(){this.maintainAspectRatio_=!1;for(var e=u.iter(this.children);!e.done;e.next()){var t,n=e.value;if((t=this.frame.intersectionWith(n.frame))&&Math.abs(t.area-this.frame.area)/this.frame.area<.1)return void(this.maintainAspectRatio_=n.maintainAspectRatio)}for(var r=0,o=u.iter(this.children);!o.done;o.next()){var a;n=o.value,(a=u.as(n,l.VisualNodeLeaf))&&a.maintainAspectRatio&&(r+=1)}r==this.children.length&&this.children.length>0&&(this.maintainAspectRatio_=!0)},clone:function(){for(var e=[],t=u.iter(this.children);!t.done;t.next()){var n=t.value;e.push(n.clone())}var r=new a(e,this.frame);r.origNode=this,r.layoutStrategy=this.layoutStrategy,r.alignments=u.clone(this.alignments),r.bgConstraint=this.bgConstraint;for(var o=u.iter(e);!o.done;o.next())(n=o.value).parent=r;return r},addChildren:function(e){for(var t={},n=[],r=u.iter(e);!r.done;r.next()){var o=r.value;n.push(o.id),t[o.id]=o}for(var a=u.iter(n);!a.done;a.next()){var i;(i=(o=t[a.value]).parent)&&i.removeChildren([o]),this.children.push(o),o.parent=this}},removeChildren:function(e){for(var t=u.iter(e);!t.done;t.next()){var n=t.value;this.children.includes(n)&&u.remove(this.children,n)}},descendents:{get:function(){for(var e=[],t=u.iter(this.children);!t.done;t.next()){var n,r=t.value;e.push(r),(n=u.as(r,a))&&(e=e.concat(n.descendents))}return e}},leafDescendents:{get:function(){for(var e=[],t=u.iter(this.children);!t.done;t.next()){var n,r,o=t.value;(n=u.as(o,l.VisualNodeLeaf))&&e.push(n),(r=u.as(o,a))&&(e=e.concat(r.leafDescendents))}return e}},filledGroup:{get:function(){for(var e=u.iter(this.leafDescendents);!e.done;e.next())if(e.value.frame.equalWithAccuracy(this.frame,1))return!0;return!1}},description:{get:function(){var e=this.bgConstraint?" bg":"";return"G: "+this.shortID+" "+this.layoutStrategyString+e+" "+this.frameString}},encodeToJson:function(){return u.clone(a.extractNodeInfo(this))}}}),a),l.VisualNodeData=(i=function(){this.formae=[],this.fontSize=[],this.opacities=[],this.colors=[],this.unionIntersections={},this.nodeDistances={},this.alignments={},this.intersections=[],this.parentContainment=[],this.childContainment=[]},u.defineClass({name:"VisualNodeData",ctor:i,props:{frame:{get:function(){return this.node.frame}},init_d79d:function(e){this.node=e},init_b16c:function(e,t,n){this.node=e,this.formae=t.formae.concat(n.formae),this.fontSize=t.fontSize.concat(n.fontSize),this.opacities=t.opacities.concat(n.opacities),this.colors=t.colors.concat(n.colors);for(var r=u.iter(t.alignments);!r.done;r.next())for(var o=r.key,a=r.value,i=u.iter(n.alignments);!i.done;i.next()){var s=i.key,l=i.value;o==s&&(this.alignments[o]=a.concat(l))}},init_ff0a:function(e,t){this.node=e;var n,r,o=e.forma;this.formae.push(o),(n=o.style.colors.fieldPrimary)&&this.colors.push(n),(n=o.style.colors.fieldSecondary)&&this.colors.push(n),this.opacities.push(o.style.opacity),(r=u.as(o.controller,D.TypeLockupController))&&this.fontSize.push(r.getCurrentFontSize());for(var a=c.AlignmentDetector.init_a00d(o,t),i=u.iter(a.detectFormaAlignments(c.AlignmentDetector.DISTANCE_THRESHOLD,void 0,!1));!i.done;i.next()){var s=i.value;if(u.containsEq(t,s.forma,h._equality_Forma_Forma)){var l=s.forma.formaID;null==this.alignments[l]&&(this.alignments[l]=[]),this.alignments[l].push(s)}}},nodeIntersection:function(e,t){for(var n=[],r=u.iter(e);!r.done;r.next()){var o=r.value;t.includes(o)&&n.push(o)}return n},setPairwiseDistanceTerms:function(e){if(this.intersections=u.clone(this.nodeIntersection(this.intersections,e)),this.parentContainment=u.clone(this.nodeIntersection(this.parentContainment,e)),this.childContainment=u.clone(this.nodeIntersection(this.childContainment,e)),null==this.node||u.opt(this.node,(function(e){return null==e.frame})))u.info("ERROR: in setPairwiseDistanceTerms");else for(var t=u.iter(e);!t.done;t.next()){var n=t.value,r=n.id;if(n!=this.node&&null==this.nodeDistances[r]){if(null!=n.inferenceData)for(var o=u.iter(n.inferenceData.formae);!o.done;o.next()){var a=o.value,i=u.clone(this.alignments[a.formaID]);null!=i&&(this.alignments[r]=u.clone(i))}if(null==n.frame)return void u.info("ERROR: in setPairwiseDistanceTerms");var s,l=n.frame;(s=l.intersectionWith(this.node.frame))&&(s.area/this.frame.area>.95?this.parentContainment.push(n):s.area/l.area>.95&&this.childContainment.push(n),this.intersections.push(n)),this.nodeDistances[r]=this.frame.L1Distance(l),this.unionIntersections[r]=[];for(var c=this.frame.unionWith(l),d=u.iter(e);!d.done;d.next()){var h=d.value;h!=n&&this.node!=h&&h.frame.intersects(c)&&this.unionIntersections[r].push(h)}}}}}}),i),l.VisualStructureDetector=(s=function(e,t){this.SPACING_REL_MERGE_THRESHOLD=.25,this.SPACING_ABS_MERGE_THRESHOLD=20,this.nodes_=[],this.pairwiseGroupScores_={},this.fastDetection_=!1;var n,r,o=this;this.parentForma_=t,this.fastDetection_=e.length>A.TheoDocumentUtils.DESIGN_COMPLEXITY_HEURISTIC_THRESHOLD;for(var a=u.iter(e);!a.done;a.next()){var i=a.value,s=new l.VisualNodeLeaf(i),c=l.VisualNodeData.init_ff0a(s,this.fastDetection_?[]:e);s.inferenceData=c,s.frame=u.opt(s.frame,(function(e){return e.intersectionWith(o.parentForma_.bounds)})),null!=s.frame?this.nodes_.push(s):u.opt(g.Host.logging,(function(e){return e.info("node.frame == nil in VisualStructureDetector")}))}for(var h=u.iter(this.nodes_);!h.done;h.next())(s=h.value).inferenceData.node=s,s.inferenceData.setPairwiseDistanceTerms(this.nodes_);if(this.bgFrames_=[],(n=t.finalFrame)&&(r=u.opt(this.parentForma_.root,(function(e){return e.filterWithCallback((function(e){return null!=e.controller&&e.isGridCell()}))})))){for(var p=u.iter(r);!p.done;p.next()){var f;if((f=(i=p.value).finalFrame)&&n.contains(f)){var m=i.bounds.transform(i.totalPlacement.concat(t.totalPlacement.inverse));n.equal(f)&&y.LegacyCoreAssert.isTrue(t.bounds.equal(m),"Expected parent bounds to match transformed bounds of bg forma (because final frames match)",void 0,"VisualStructureDetector.init","VisualStructureDetector.swift",808),this.bgFrames_.push(m)}}if(this.bgFrames_.length>0)for(var _=u.iter(u.range(0,4,!1));!_.done;_.next()){for(var T=null,C=[new R.TheoPoint(.5,0),new R.TheoPoint(0,.5),new R.TheoPoint(.5,1),new R.TheoPoint(1,.5)],v=u.iter(C);!v.done;v.next()){for(var P=v.value,S=t.bounds.eval(P),D=null,E=1/0,I=u.iter(this.bgFrames_);!I.done;I.next()){var b=(m=I.value).eval(P),O=.5==P.x?Math.abs(S.y-b.y):Math.abs(S.x-b.x);E>O&&(E=O,D=m)}if(null!=D&&E>0){var k=.5==P.x?t.bounds.horizontalLine(P.y):t.bounds.verticalLine(P.x),M=.5==P.x?D.horizontalLine(P.y):D.verticalLine(P.x),N=F.TheoRect.boundsOfPoints([k.p1,k.p2,M.p1,M.p2]);(null==T||T.area<N.area)&&(T=N)}}if(null==T)break;this.bgFrames_.push(T)}}d.CoreObject.call(this)},u.defineClass({name:"VisualStructureDetector",ctor:s,superName:"CoreObject",props:{inferVisualStructure:function(){if(0==this.nodes_.length)return null;for(var e=[],t=[],n=u.iter(this.nodes_);!n.done;n.next()){var r=n.value;this.isBackgroundElement(r)?e.push(r):t.push(r)}var o=this.groupNodes(e),a=this.groupNodes(t);return null==o?a:(null==a||o.addChildren(a.children),o)},groupNodes:function(e){if(0==e.length)return null;var t=u.clone(this.fastDetection_?this.fastMergeNodes(e):this.mergeNodes(e)),n=u.clone(this.createBackgroundGroupNodes(t));return new l.VisualNodeGroup(n,this.parentForma_.bounds)},scoreNodeGrouping:function(e,t){var n,r,o,a={};if((n=e.inferenceData)&&(r=t.inferenceData)&&(o=u.opt(r.formae[0].parent,(function(e){return e.bounds})))){var i,s=e.frame.unionWith(t.frame);if(i=n.unionIntersections[t.id]){for(var d=u.clone(n.intersections),h=u.clone(r.intersections),p=0,f=u.iter(i);!f.done;f.next()){var m=f.value;d.includes(m)||h.includes(m)||(p+=1)}a[l.PairingFeatures.UNION_NUM_NON_INTERSECT]=u.toDouble(p)}var g=u.clone(n.parentContainment),y=u.clone(r.parentContainment);n.childContainment.includes(t)?a[l.PairingFeatures.CONTAINMENT_CHILD_COUNT]=u.toDouble(n.childContainment.length-1):r.childContainment.includes(e)&&(a[l.PairingFeatures.CONTAINMENT_CHILD_COUNT]=u.toDouble(r.childContainment.length-1)),g.includes(t)&&u.remove(g,t),y.includes(e)&&u.remove(y,e);for(var _=0,C=u.iter(g.concat(y));!C.done;C.next()){var P=C.value;g.includes(P)&&y.includes(P)||(_+=1)}a[l.PairingFeatures.CONTAINMENT_MISMATCH]=_,a[l.PairingFeatures.BOUNDARY_DISTANCE]=n.nodeDistances[t.id],a[l.PairingFeatures.CENTER_DISTANCE]=n.frame.center.distanceTo(r.frame.center);var S,A=u.clone(n.alignments[t.id]),D=u.clone(r.alignments[e.id]);if(null!=A&&null!=D)for(var R=u.iter(A);!R.done;R.next())for(var F=R.value,I=u.iter(D);!I.done;I.next()){var b=I.value;F.line.type==b.line.type&&(F.line.type==c.AlignmentType.CenterX?a[l.PairingFeatures.CENTER_X_ALIGNED]=1:F.line.type==c.AlignmentType.Left?a[l.PairingFeatures.LEFT_ALIGNED]=1:F.line.type==c.AlignmentType.Right?a[l.PairingFeatures.RIGHT_ALIGNED]=1:F.line.type==c.AlignmentType.Top?a[l.PairingFeatures.TOP_ALIGNED]=1:F.line.type==c.AlignmentType.CenterY?a[l.PairingFeatures.CENTER_Y_ALIGNED]=1:F.line.type==c.AlignmentType.Bottom&&(a[l.PairingFeatures.BOTTOM_ALIGNED]=1),F.line.type==c.AlignmentType.CenterX||F.line.type==c.AlignmentType.Left||F.line.type==c.AlignmentType.Right?a[l.PairingFeatures.X_ALIGNED]=1:a[l.PairingFeatures.Y_ALIGNED]=1)}if(S=n.frame.intersectionWith(r.frame)){var O=S.area/Math.max(n.frame.area,r.frame.area);a[l.PairingFeatures.INTERSECTION]=O}for(var k=0,M=u.iter(n.formae);!M.done;M.next()){for(var N=M.value,L=!1,x=u.iter(r.formae);!x.done;x.next())((G=x.value).isTypeLockup()&&N.isTypeLockup()||G.isGraphic()&&N.isGraphic())&&(L=!0);L||(k=1)}for(var B=u.iter(r.formae);!B.done;B.next()){N=B.value,L=!1;for(var w=u.iter(n.formae);!w.done;w.next()){var G;((G=w.value).isTypeLockup()&&N.isTypeLockup()||G.isGraphic()&&N.isGraphic())&&(L=!0)}L||(k=1)}a[l.PairingFeatures.TYPE_MISMATCH]=k;for(var Y=null,U=u.iter(n.colors);!U.done;U.next())for(var V=U.value,j=u.iter(r.colors);!j.done;j.next()){var H=j.value;Y=null==Y?V.distanceTo(H):Math.min(Y,V.distanceTo(H))}a[l.PairingFeatures.COLOR_DISTANCE]=null!=Y?Y:0;for(var W=null,K=u.iter(n.opacities);!K.done;K.next())for(var X=K.value,z=u.iter(r.opacities);!z.done;z.next()){var q=z.value;W=null==W?Math.abs(X-q):Math.min(W,Math.abs(X-q))}a[l.PairingFeatures.OPACITY_DIFFERENCE]=null!=W?W:0;for(var Z=null,J=u.iter(n.fontSize);!J.done;J.next())for(var Q=J.value,$=u.iter(r.fontSize);!$.done;$.next()){var ee=$.value;Z=null==Z?Math.abs(Q-ee):Math.min(Z,Math.abs(Q-ee))}a[l.PairingFeatures.FONT_SIZE_DISTANCE]=null!=Z?Z:0;var te=!o.contains(n.frame)&&o.contains(r.frame)||o.contains(n.frame)&&!o.contains(r.frame);a[l.PairingFeatures.OUT_OF_BOUNDS_MISMATCH]=te?1:0;var ne=n,re=r;n.frame.center.y>r.frame.center.y&&(ne=r,re=n),a[l.PairingFeatures.POSITION_X_FIRST]=ne.frame.center.x/o.width,a[l.PairingFeatures.POSITION_Y_FIRST]=ne.frame.center.y/o.height,a[l.PairingFeatures.AREA_FIRST]=ne.frame.area,a[l.PairingFeatures.POSITION_X_SECOND]=re.frame.center.x/o.width,a[l.PairingFeatures.POSITION_Y_SECOND]=re.frame.center.y/o.height,a[l.PairingFeatures.AREA_SECOND]=re.frame.area;for(var oe=u.iter(ne.formae);!oe.done;oe.next())(N=oe.value).isTypeLockup()?a[l.PairingFeatures.IS_TEXT_FIRST]=1:N.isShape()?a[l.PairingFeatures.IS_SHAPE_FIRST]=1:N.isImage()&&(a[l.PairingFeatures.IS_IMAGE_FIRST]=1);for(var ae=u.iter(re.formae);!ae.done;ae.next())(N=ae.value).isTypeLockup()?a[l.PairingFeatures.IS_TEXT_SECOND]=1:N.isShape()?a[l.PairingFeatures.IS_SHAPE_SECOND]=1:N.isImage()&&(a[l.PairingFeatures.IS_IMAGE_SECOND]=1);a[l.PairingFeatures.UNION_EMPTY_SPACE]=Math.max(0,s.area-n.frame.area-r.frame.area),a[l.PairingFeatures.UNION_AREA]=s.area,a[l.PairingFeatures.UNION_POSITION_X]=s.center.x/o.height,a[l.PairingFeatures.UNION_POSITION_Y]=s.center.y/o.width,a[l.PairingFeatures.HEIGHT_DIFF]=Math.abs(n.frame.height-r.frame.height),a[l.PairingFeatures.WIDTH_DIFF]=Math.abs(n.frame.width-r.frame.width),a[l.PairingFeatures.AREA_DIFF]=Math.abs(n.frame.area-r.frame.area);for(var ie,se=[],le=u.iter(["union_position_x","y_aligned","is_text_second","right_aligned","is_shape_first","containment_child_count","is_image_first","is_image_second","type_mismatch","position_x_second","containment_mismatch","height_diff","union_area","union_empty_space","area_first","top_aligned","area_second","bottom_aligned","center_y_aligned","center_distance","union_position_y","is_text_first","opacity_difference","intersection","out_of_bounds_mismatch","position_y_first","is_shape_second","position_x_first","width_diff","union_num_non_intersect","left_aligned","color_distance","center_x_aligned","boundary_distance","position_y_second","x_aligned","area_diff","font_size_distance"]);!le.done;le.next()){var ue;null!=(ue=a[le.value])?se.push(ue):se.push(0)}if(ie=T.MLPModel.loadNNModel("VisualGrouping")){var ce=u.clone(se),de=new E.TheoMatrix([ce]).subtract(ie.featureScalingMean).divide(ie.featureScalingStd);return{score:1-new v.NNMLPClassifier(ie.coefficients,ie.intercepts,ie.finalSoftmax).predict(de.transpose()).transpose().asArray[0][0],features:a}}}return{score:1/0,features:{}}},mergeWithParentIfPossible:function(e,t){var n,r,o,a;if(void 0===t&&(t=!1),(n=u.as(e,l.VisualNodeGroup))&&null!=(r=n.spacing)&&(o=n.parent)&&null!=(a=o.spacing)){if(n.layoutStrategy!=o.layoutStrategy)return;if(n.layoutStrategy==l.GroupLayoutStrategy.Default)return u.remove(o.children,n),void o.addChildren(n.children);for(var i=[],s=u.iter(o.alignments);!s.done;s.next())for(var c=s.value,d=u.iter(n.alignments);!d.done;d.next())c==d.value&&(i.includes(c)||i.push(c));(i.length>0||!t)&&(o.alignments=u.clone(i),o.spacing=(r+a)/2,u.remove(o.children,n),o.addChildren(n.children))}},getNodeForForma:function(e){for(var t=u.iter(this.nodes_);!t.done;t.next()){var n=t.value;if(u.containsEq(n.inferenceData.formae,e,h._equality_Forma_Forma))return n}return null},getScoreNodeFeatures:function(e,t){return this.scoreNodeGrouping(this.getNodeForForma(e),this.getNodeForForma(t))},isBackgroundElement:function(e){var t,n;if((t=u.as(e,l.VisualNodeLeaf))&&(n=t.forma.finalFrame)){if(t.forma.isBackgroundImage())return!0;if(t.forma.isGridCell())return!0;if(n.contains(this.parentForma_.finalFrame)||t.forma.isGraphic()&&!this.parentForma_.finalFrame.contains(n.insetRel(.1,.1,.1,.1)))return!0;var r;if(r=u.as(t.forma.controller,D.TypeLockupController)){var o=r.getAverageFontSize();return 1==r.text.length&&o>1e3}return t.hasBackgroundRole}return!1},nodesMergeable:function(e,t){return this.isBackgroundElement(e)!=this.isBackgroundElement(t)},getPairwiseScore:function(e,t){var n,r=e.id+t.id;if(null!=(n=this.pairwiseGroupScores_[r]))return n;var o=this.scoreNodeGrouping(e,t);return this.pairwiseGroupScores_[r]=o.score,o.score},scoreVisualGroupMerge:function(e,t,n){if(e==t)return y.LegacyCoreAssert.fail("probably an error if we're trying to merge something with outself",void 0,"VisualStructureDetector.scoreVisualGroupMerge","VisualStructureDetector.swift",1347),1;var r,o;if((r=u.as(e,l.VisualNodeLeaf))&&(o=u.as(t,l.VisualNodeLeaf)))return this.getPairwiseScore(r,o);var a,i=[e];(a=u.as(e,l.VisualNodeGroup))&&(i=u.clone(a.children));var s,c=[t];(s=u.as(t,l.VisualNodeGroup))&&(c=u.clone(s.children));for(var d=0,h=u.iter(i);!h.done;h.next())for(var p=h.value,f=u.iter(c);!f.done;f.next()){var m=f.value;d=Math.max(d,this.scoreVisualGroupMerge(p,m,n))}for(var g=u.iter(n);!g.done;g.next()){var _=g.value;if(_!=e&&_!=t){var T=e.frame.unionWith(t.frame).intersectionWith(_.frame);if(!e.frame.intersects(_.frame)&&!t.frame.intersects(_.frame)&&null!=T&&T.area/_.frame.area>.25)return 0}}return d},scoreRegionMerge:function(e,t,n,r){void 0===r&&(r=0);var o=e.frame.yDistance(t.frame,!1),a=e.frame.xDistance(t.frame,!1);if(o>0&&a>0)return-1/0;for(var i=u.iter(n);!i.done;i.next()){var s,c=i.value;if(c!=e&&c!=t&&(s=e.frame.unionWith(t.frame).intersectionWith(c.frame))&&s.area/c.frame.area>.1)return-1/0}if(o<r&&a<r)return-1/0;var d=a<o,h=Math.max(o,a),p=Math.max(-1*Math.min(o,a),0);if(h>200)return-1/0;for(var f=p/(d?Math.max(e.frame.width,t.frame.width):Math.max(e.frame.height,t.frame.height)),m=h/Math.max(this.parentForma_.bounds.width,this.parentForma_.bounds.height),g=0,y=u.iter([e,t]);!y.done;y.next()){var _,T=y.value;(_=u.as(T,l.VisualNodeGroup))&&(_.layoutStrategy==l.GroupLayoutStrategy.VerticalFlow&&d&&(g+=1),_.layoutStrategy!=l.GroupLayoutStrategy.HorizontalFlow||d||(g+=1))}var C,v,P=d?F.TheoRect.ONE_BY_ONE.scaleXY(1e3,1):F.TheoRect.ONE_BY_ONE.scaleXY(1,1e3),S=.5*(1-P.similarity(e.frame))+.5*(1-P.similarity(t.frame));return(C=this.getBackgroundFrame(e))&&(v=this.getBackgroundFrame(t))&&(f=p/(d?Math.min(e.frame.width,t.frame.width):Math.min(e.frame.height,t.frame.height)),!C.equal(v)&&f<.9)?0:.5+(f+10*(1-m)+.1*g+.5*S)},getContainingGraphicNode:function(e,t){for(var n=u.iter(t);!n.done;n.next()){var r,o=n.value;if((r=u.as(o,l.VisualNodeLeaf))&&r.forma.isGraphic()&&r.frame.contains(e.frame))return r}return null},createBackgroundGroupNodes:function(e){for(var t=[],n=u.iter(e);!n.done;n.next()){var r=n.value,o=u.as(r,l.VisualNodeLeaf),a=u.as(r,l.VisualNodeGroup),i=this.getBackgroundFrame(r),s=null!=i&&i.equal(this.parentForma_.bounds);if(null!=o||null!=a&&a.filledGroup||!s){var c=r.parent,d=new l.VisualNodeGroup([r]);if(u.opt(c,(function(e){return e.addChildren([d])})),t.push(d),d.layoutStrategy=l.GroupLayoutStrategy.Default,null!=o){var h=l.VisualNodeData.init_ff0a(o,[o.forma]);d.inferenceData=h}else d.inferenceData=r.inferenceData;s||(d.frame=i,d.bgConstraint=!0)}else t.push(r)}return t=u.sort(t,(function(e,t){return e.frame.center.y<t.frame.center.y}))},fastMergeNodes:function(e){for(var t=u.clone(e),n=[];t.length>0;){for(var r=t[0],o=r.frame||F.TheoRect.Zero,a=[],i=u.iter(t);!i.done;i.next()){var s,c,d=i.value;(s=d.frame)&&(c=o.intersectionWith(s))&&c.area/s.area>.05&&(a.push(d),o=o.unionWith(s))}if(a.length>1){var h=new l.VisualNodeGroup(a,o);t.push(h);for(var p=u.iter(a);!p.done;p.next()){var f=p.value;u.remove(t,f),this.mergeWithParentIfPossible(f,!1)}}else n.push(r),u.remove(t,r)}return this.mergeNodes(n)},mergeNodes:function(e){for(var t=this,n=u.clone(e),r=u.iter(n);!r.done;r.next()){var o=r.value;u.opt(o.inferenceData,(function(e){return e.setPairwiseDistanceTerms(n)}))}for(var a=0,i=u.iter([!0,!1]);!i.done;i.next())for(var s=i.value,c=u.iter([!0,!1]);!c.done;c.next())for(var d=c.value;n.length>1||a>100;){a+=1;for(var h=0,p=null,f=u.iter(u.range(0,n.length,!1));!f.done;f.next())for(var m=f.value,g=u.sort(n,(function(e,t){return e.frame.L1Distance(n[m].frame)<t.frame.L1Distance(n[m].frame)})),y=u.iter(u.range(0,Math.min(5,g.length),!1));!y.done;y.next()){var _=y.value;if(n[m]!=g[_]){if(d){var T=this.getContainingGraphicNode(n[m],e),v=this.getContainingGraphicNode(g[_],e);if(T==g[_]||v==n[m])continue;if(null!=T&&T!=v||null!=v&&T!=v)continue}var P=s?this.scoreVisualGroupMerge(n[m],g[_],n):this.scoreRegionMerge(n[m],g[_],n);P>.5&&P>h&&(p={nodeA:n[m],nodeB:g[_]},h=P)}}if(null==p)break;var S=new l.VisualNodeGroup([p.nodeA,p.nodeB]);S.frame=u.opt(S.frame,(function(e){return e.intersectionWith(t.parentForma_.bounds)}));var A=-1*C.MathUtils.minDouble(p.nodeA.frame.maxX-p.nodeB.frame.minX,p.nodeB.frame.maxX-p.nodeA.frame.minX),D=-1*C.MathUtils.minDouble(p.nodeA.frame.maxY-p.nodeB.frame.minY,p.nodeB.frame.maxY-p.nodeA.frame.minY);S.layoutStrategy=A<0&&D>=0?l.GroupLayoutStrategy.VerticalFlow:D<0&&A>=0?l.GroupLayoutStrategy.HorizontalFlow:l.GroupLayoutStrategy.Default,S.bgConstraint=p.nodeA.bgConstraint&&p.nodeB.bgConstraint;var E,R,F=u.clone(u.opt(p.nodeA.inferenceData,(function(e){return e.alignments[p.nodeB.id]})));if(null!=F){var I=u.sort(F,(function(e,t){return e.offset.length()<t.offset.length()}));S.alignments.includes(I[0].line.type)||S.alignments.push(I[0].line.type)}if(S.spacing=p.nodeA.frame.L1Distance(p.nodeB.frame),(E=p.nodeA.inferenceData)&&(R=p.nodeB.inferenceData)){var b=l.VisualNodeData.init_b16c(S,E,R);S.inferenceData=b,s&&(S.spacing=u.opt(p.nodeA.inferenceData,(function(e){return e.nodeDistances[p.nodeB.id]})))}n.push(S),this.mergeWithParentIfPossible(p.nodeA,!1),this.mergeWithParentIfPossible(p.nodeB,!1),u.remove(n,p.nodeA),u.remove(n,p.nodeB);for(var O=u.iter(n);!O.done;O.next())o=O.value,u.opt(o.inferenceData,(function(e){return e.setPairwiseDistanceTerms(n)}))}return n},getBackgroundFrame:function(e){if(!this.parentForma_.bounds.contains(e.frame))return null;var t,n=[];(t=u.as(e,l.VisualNodeGroup))?n=u.clone(t.leafDescendents):null!=(a=u.as(e,l.VisualNodeLeaf))&&(n=[a]);for(var r=null,o=u.iter(n);!o.done;o.next()){var a,i,s,c=(a=o.value).frame;(i=u.as(a.forma.controller,D.TypeLockupController))&&null!=(s=u.opt(i.lockupStyle,(function(e){return e.backing})))&&(s!=_.LockupBacking.BannerHorizontal&&s!=_.LockupBacking.BannerVertical&&s!=_.LockupBacking.Banner||(c=u.opt(u.as(a.forma,f.GroupForma),(function(e){return e.childrenFrame}))));var d,h=!1;if(d=c)for(var p=u.iter(this.bgFrames_);!p.done;p.next()){var m=p.value;m.contains(d)&&(h=!0,r=u.opt(r,(function(e){return e.unionWith(m)}))||m)}h||(r=this.parentForma_.bounds)}return r||this.parentForma_.bounds}}}),s)},zjod:function(e,t,n){var r,o=t,a=n("oAGj"),i=n("fWxZ"),s=n("P83h"),l=n("pnSN"),u=n("Qlvz"),c=n("fdtz"),d=n("uWOl"),h=n("fNpk"),p=n("9YN4"),f=n("RkYL"),m=n("fGVU"),g=n("sW6f"),y=n("QTen");o.VideoPlayerStatus=a.defineEnum("VideoPlayerStatus",{stopped:0,playing:1}),o.VideoMode=a.defineEnum("VideoMode",{stillImage:0,playback:1,publish:2,trim:3}),o.VideoForma=(r=function(){this.cachedVideoContent_=null,this.currentTime_=f.TheoTime.Zero,this.playerStatus_=o.VideoPlayerStatus.stopped,this.mode_=o.VideoMode.stillImage},a.defineClass({name:"VideoForma",ctor:r,superName:"ImageForma",statics:{KIND:{get:function(){return"Video"}},PROPERTY_VIDEO_CONTENTID:"video-content-id",SCHEMA_CLASS_NAME:{get:function(){return"VideoForma"}},factory:{get:function(){return function(e,t,n,o){if(null!=t){var s=a.as(a.opt(a.opt(o,(function(e){return e.backLink})),(function(e){return e.dereference()})),l.GroupForma),u=a.as(a.opt(a.opt(o,(function(e){return e.backLink})),(function(e){return e.dereference()})),i.FormaPage);return h.LegacyCoreAssert.isTrue(null!=s||null!=u,"VideoForma needs a parent group or page",void 0,"VideoForma","VideoForma.swift",45),null!=s?r.init_3144(e,t,n,s):r.init_7dbd(e,t,n,u)}return r.init_d1c9(e,n)}}},_implements:function(e){return"IDBObject"==e||"TheoMessageSubscriber"==e||"TheoMessagePublisher"==e}},props:{init_3144:function(e,t,n,r){a.super_init(this,c.ImageForma,c.ImageForma.prototype.init_3144,e,t,n,r)},init_7dbd:function(e,t,n,r){a.super_init(this,c.ImageForma,c.ImageForma.prototype.init_7dbd,e,t,n,r)},init_812f:function(e,t){for(var n={kind:function(){return r.KIND},style:function(){return y.VideoStyle.createDefault()}},o=a.clone(t),i=a.iter(n);!i.done;i.next()){var s=i.key,l=i.value;null==t[s]&&(o[s]=l())}a.super_init(this,c.ImageForma,c.ImageForma.prototype.init_812f,e,o)},init_7186:function(e){var t={kind:r.KIND,style:y.VideoStyle.createDefault()};this.init_812f(e,t)},init_d1c9:function(e,t){a.super_init(this,c.ImageForma,c.ImageForma.prototype.init_d1c9,e,t)},getFrameForTime:function(e){var t;if(t=this.videoContentNode){if(0==t.times.length)return 0;var n=a.opt(this.animation,(function(e){return e.startTime}))||t.times[0],r=t.times[t.times.length-1],o=a.opt(this.animation,(function(e){return e.endTime}))||r;if(e.seconds>o.seconds)return t.times.length-1;if(e.seconds-n.seconds<=0)return 0;var i=e.subtract(n),s=new f.TheoTime(a.toInt(i.seconds*a.toDouble(r.timescale))%r.value,r.timescale);if(s.value<t.times[0].value)return 0;for(var l=a.iter(a.range(0,t.times.length-1,!1));!l.done;l.next()){var u=l.value;if(s.value>=t.times[u].value&&s.value<t.times[u+1].value)return u+1}return t.times.length-1}return 0},decodeController:function(){var e;null==this.controller&&(e=a.opt(this.page.document,(function(e){return e.controller})))&&(this.controller=e.controllerFactory.createController(m.VideoController.KIND,this)),c.ImageForma.prototype.decodeController.call(this)},className:{get:function(){return r.SCHEMA_CLASS_NAME}},updateEventForProperty:function(e){return e==r.PROPERTY_VIDEO_CONTENTID?new s.FormaContentChangedEvent(this):c.ImageForma.prototype.updateEventForProperty.call(this,e)},isVideo:function(){return!0},isSticker:function(){var e,t;return!!((e=this.videoContentNode)&&(t=a.opt(this.parent,(function(e){return e.controller})))&&e.isGIF&&t.moveable)},videoContentNode:{get:function(){var e,t;null!=(e=this.videoContentID)&&((!(t=this.cachedVideoContent_)||t.id!=e)&&(this.cachedVideoContent_=a.as(a.opt(this.page.document,(function(t){return t.content.nodeByID(e)})),g.VideoContentNode)));return this.cachedVideoContent_},set:function(e){var t=new s.FormaContentChangedEvent(this);this.beginUpdate(t),this.cachedVideoContent_=e,this.set(r.PROPERTY_VIDEO_CONTENTID,a.opt(e,(function(e){return e.id}))),this.endUpdate(t)}},videoContentID:{get:function(){return a.as(this.get(r.PROPERTY_VIDEO_CONTENTID),"String")}},currentTime:{get:function(){return this.currentTime_},set:function(e){if(e!=this.currentTime_){var t=new s.FormaVideoTimeChangedEvent(this);this.beginUpdate(t),this.currentTime_=e,this.endUpdate(t)}}},videoPlayerStatus:{get:function(){return this.playerStatus_},set:function(e){if(e!=this.playerStatus_){var t=new s.FormaVideoStateChangedEvent(this);this.beginUpdate(t),this.playerStatus_=e,this.endUpdate(t)}}},mode:{get:function(){return this.mode_},set:function(e){if(e!=this.mode_){var t=new s.FormaVideoStateChangedEvent(this);this.beginUpdate(t),this.mode_=e,this.endUpdate(t)}}},setVideoPlayerStatusAndMode:function(e,t,n){if(n||e!=this.playerStatus_||t!=this.mode_){var r=new s.FormaVideoStateChangedEvent(this);this.beginUpdate(r),this.mode_=t,this.playerStatus_=e,this.endUpdate(r)}},forceStateChange:function(){var e=new s.FormaVideoStateChangedEvent(this);this.beginUpdate(e),this.endUpdate(e)},postDecode:function(){var e,t,n=this;if(c.ImageForma.prototype.postDecode.call(this),t=a.as(this.style,d.ImageStyle)){if(!(this.style instanceof y.VideoStyle)){var r=(e=a.opt(this.page.document,(function(e){return e.versionDecoded.vers})))||null!=e?e:0;h.LegacyCoreAssert.isTrue(r<p.TheoDocumentVersion.VideoSupport,"Why is there no VideoStyle for VideoForma",{version:a.toString(r)},"VideoForma.postDecode","VideoForma.swift",277);var o,i,s=y.VideoStyle.createDefault();(o=this.videoContentNode)&&(s.duration=o.duration),(i=s.mergeWithImageStyle(t))&&this.protectedSetStyle(i),a.opt(this.videoContentNode,(function(e){return null==e.mediaMetadata&&a.opt(n.contentNode,(function(e){return null!=e.mediaMetadata}))}))&&a.opt(this.videoContentNode,(function(e){return e.mediaMetadata=a.opt(n.contentNode,(function(e){return e.mediaMetadata}))}))}t.filter=null,t.adjustments=u.ImageAdjustments.createDefault(),t.name=d.ImageStyle.DEFAULT_NAME}},canApplyStyle:function(e){return c.ImageForma.prototype.canApplyStyle.call(this,e)&&e instanceof y.VideoStyle},applyStyle:function(e){var t,n,r;(t=a.as(e,d.ImageStyle))&&(n=a.as(this.style,y.VideoStyle))&&(r=n.mergeWithImageStyle(t))&&(r.filter=null,r.adjustments=u.ImageAdjustments.createDefault(),r.name=d.ImageStyle.DEFAULT_NAME,this.internalSetStyle(r))},resetToStartTime:function(){var e;if(e=a.as(this.style,y.VideoStyle)){var t=e.startTime;if(t!=this.currentTime_){var n=new s.FormaVideoStateChangedEvent(this);this.beginUpdate(n),this.currentTime_=t,this.endUpdate(n)}}}}}),r)}}]);
//# sourceMappingURL=theo-core-model-2ef57493.js.map